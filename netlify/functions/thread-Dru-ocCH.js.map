{"version":3,"file":"thread-Dru-ocCH.js","names":["route: Route","items: DataItem[]","link"],"sources":["../../lib/routes/yamibo/bbs/thread.ts"],"sourcesContent":["import type { Data, DataItem, Route } from '@/types';\r\nimport type { Context } from 'hono';\r\nimport { load } from 'cheerio';\r\nimport { fetchThread, generateDescription, getDate, bbsOrigin } from '../utils';\r\n\r\nexport const route: Route = {\r\n    name: 'BBS - 讨论串',\r\n    categories: ['bbs'],\r\n    path: '/bbs/thread/:tid',\r\n    example: '/yamibo/bbs/thread/541914',\r\n    parameters: {\r\n        tid: '讨论串 id，可从URL中提取。https://bbs.yamibo.com/forum.php?mod=viewthread&tid=xxxx中的xxx或https://bbs.yamibo.com/thread-aaa-b-c.html中的aaa部分即为tid值',\r\n    },\r\n    maintainers: ['KarasuShin'],\r\n    handler,\r\n    features: {\r\n        antiCrawler: true,\r\n        requireConfig: [\r\n            {\r\n                optional: true,\r\n                name: 'YAMIBO_SALT',\r\n                description:\r\n                    '百合会BBS登录后的认证信息，获取方式：1. 登录百合会BBS网页版 2. 打开浏览器开发者工具，切换到 Application 面板\\n3. 点击侧边栏中的Storage -> Cookies -> https://bbs.yamibo.com 4. 复制 Cookie 中的 EeqY_2132_saltkey 值',\r\n            },\r\n            {\r\n                optional: true,\r\n                name: 'YAMIBO_AUTH',\r\n                description:\r\n                    '百合会BBS登录后的认证信息，获取方式：1. 登录百合会BBS网页版 2. 打开浏览器开发者工具，切换到 Application 面板\\n3. 点击侧边栏中的Storage -> Cookies -> https://bbs.yamibo.com 4. 复制 Cookie 中的 EeqY_2132_auth 值',\r\n            },\r\n        ],\r\n    },\r\n    description: `::: warning\r\n百合会BBS访问部分讨论串需要用户登录认证，请参考配置说明\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const tid = ctx.req.param('tid');\r\n\r\n    const { data, link } = await fetchThread(tid, { ordertype: '1' });\r\n\r\n    if (!data) {\r\n        return {\r\n            title: '讨论串不存在',\r\n            link,\r\n            item: [],\r\n        };\r\n    }\r\n\r\n    const $ = load(data);\r\n    const title = $('title').text().replace(' -  百合会 -  Powered by Discuz!', '');\r\n    const items: DataItem[] = $('#postlist>div[id^=\"post_\"]')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            const isOP = !!$item.has('#fj').length;\r\n            const postId = $item.attr('id')!.match(/\\d+/)![0];\r\n            const $tr = $item.find('table').find('tr').first();\r\n            const profileBlock = $tr.find(`#favatar${postId}`);\r\n            const nickName = profileBlock.find('.authi').text();\r\n            const floor = isOP ? '主楼' : $tr.find(`#postnum${postId} em`).text();\r\n            const link = isOP ? `${bbsOrigin}/forum.php?mod=viewthread&tid=${tid}` : `${bbsOrigin}/forum.php?mod=redirect&goto=findpost&ptid=${tid}&pid=${postId}`;\r\n            const description = generateDescription($item, postId);\r\n\r\n            const createTime = $tr\r\n                .find(`#authorposton${postId}`)\r\n                .text()\r\n                .match(/\\d{4}(?:-\\d{1,2}){2} \\d{2}:\\d{2}/)![0];\r\n\r\n            return {\r\n                title: `${floor} - ${nickName}`,\r\n                link,\r\n                description,\r\n                pubDate: getDate(createTime),\r\n            };\r\n        });\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wVAKA,MAAaA,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,OACb,KAAM,mBACN,QAAS,4BACT,WAAY,CACR,IAAK,yIAET,YAAa,CAAC,cACd,UACA,SAAU,CACN,YAAa,GACb,cAAe,CACX,CACI,SAAU,GACV,KAAM,cACN,YACI;6FAER,CACI,SAAU,GACV,KAAM,cACN,YACI;4FAIhB,YAAa;;MAKjB,eAAe,EAAQ,EAA6B,CAChD,IAAM,EAAM,EAAI,IAAI,MAAM,OAEpB,CAAE,OAAM,QAAS,MAAM,EAAY,EAAK,CAAE,UAAW,MAE3D,GAAI,CAAC,EACD,MAAO,CACH,MAAO,SACP,OACA,KAAM,IAId,IAAM,EAAI,EAAK,GACT,EAAQ,EAAE,SAAS,OAAO,QAAQ,gCAAiC,IACnEC,EAAoB,EAAE,8BACvB,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GACV,EAAO,CAAC,CAAC,EAAM,IAAI,OAAO,OAC1B,EAAS,EAAM,KAAK,MAAO,MAAM,OAAQ,GACzC,EAAM,EAAM,KAAK,SAAS,KAAK,MAAM,QACrC,EAAe,EAAI,KAAK,WAAW,KACnC,EAAW,EAAa,KAAK,UAAU,OACvC,EAAQ,EAAO,KAAO,EAAI,KAAK,WAAW,EAAO,MAAM,OACvDC,EAAO,EAAO,GAAG,EAAU,gCAAgC,IAAQ,GAAG,EAAU,6CAA6C,EAAI,OAAO,IACxI,EAAc,EAAoB,EAAO,GAEzC,EAAa,EACd,KAAK,gBAAgB,KACrB,OACA,MAAM,oCAAqC,GAEhD,MAAO,CACH,MAAO,GAAG,EAAM,KAAK,IACrB,KAAA,EACA,cACA,QAAS,EAAQ,MAI7B,MAAO,CACH,QACA,OACA,KAAM"}