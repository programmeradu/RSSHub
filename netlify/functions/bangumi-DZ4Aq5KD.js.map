{"version":3,"file":"bangumi-DZ4Aq5KD.js","names":["route: Route","utils","cache","episodes: DataItem[]"],"sources":["../../lib/routes/bilibili/bangumi.ts"],"sourcesContent":["import { Data, DataItem, Route, ViewType } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { EpisodeResult } from './types';\r\nimport utils from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/bangumi/media/:mediaid/:embed?',\r\n    name: '番剧',\r\n    parameters: {\r\n        mediaid: '番剧媒体 id, 番剧主页 URL 中获取',\r\n        embed: '默认为开启内嵌视频, 任意值为关闭',\r\n    },\r\n    example: '/bilibili/bangumi/media/9192',\r\n    categories: ['social-media'],\r\n    view: ViewType.Videos,\r\n    maintainers: ['DIYgod', 'nuomi1'],\r\n    handler,\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportRadar: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const mediaId = ctx.req.param('mediaid');\r\n    const embed = !ctx.req.param('embed');\r\n\r\n    const mediaData = await utils.getBangumi(mediaId, cache);\r\n    const seasonId = String(mediaData.season_id);\r\n    const seasonData = await utils.getBangumiItems(seasonId, cache);\r\n\r\n    const episodes: DataItem[] = [];\r\n\r\n    const getEpisode = (item: EpisodeResult, title: string) =>\r\n        ({\r\n            title,\r\n            description: utils.renderOGVDescription(embed, item.cover, item.long_title, seasonId, String(item.id)),\r\n            link: item.share_url,\r\n            image: item.cover.replace('http://', 'https://'),\r\n            language: 'zh-cn',\r\n        }) as DataItem;\r\n\r\n    for (const item of seasonData.main_section.episodes) {\r\n        const episode = getEpisode(item, `第${item.title}话 ${item.long_title}`);\r\n        episodes.push(episode);\r\n    }\r\n\r\n    for (const section of seasonData.section) {\r\n        for (const item of section.episodes) {\r\n            const episode = getEpisode(item, `${item.title} ${item.long_title}`);\r\n            episodes.push(episode);\r\n        }\r\n    }\r\n\r\n    return {\r\n        title: mediaData.title,\r\n        description: mediaData.evaluate,\r\n        link: mediaData.share_url,\r\n        item: episodes,\r\n        image: mediaData.cover.replace('http://', 'https://'),\r\n        language: 'zh-cn',\r\n    } as Data;\r\n}\r\n"],"mappings":"gWAKA,MAAaA,EAAe,CACxB,KAAM,kCACN,KAAM,KACN,WAAY,CACR,QAAS,wBACT,MAAO,qBAEX,QAAS,+BACT,WAAY,CAAC,gBACb,KAAM,EAAS,OACf,YAAa,CAAC,SAAU,UACxB,UACA,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,KAIvB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,EAAI,IAAI,MAAM,WACxB,EAAQ,CAAC,EAAI,IAAI,MAAM,SAEvB,EAAY,MAAMC,EAAM,WAAW,EAASC,GAC5C,EAAW,OAAO,EAAU,WAC5B,EAAa,MAAMD,EAAM,gBAAgB,EAAUC,GAEnDC,EAAuB,GAEvB,GAAc,EAAqB,KACpC,CACG,QACA,YAAaF,EAAM,qBAAqB,EAAO,EAAK,MAAO,EAAK,WAAY,EAAU,OAAO,EAAK,KAClG,KAAM,EAAK,UACX,MAAO,EAAK,MAAM,QAAQ,UAAW,YACrC,SAAU,UAGlB,IAAK,IAAM,KAAQ,EAAW,aAAa,SAAU,CACjD,IAAM,EAAU,EAAW,EAAM,IAAI,EAAK,MAAM,IAAI,EAAK,cACzD,EAAS,KAAK,GAGlB,IAAK,IAAM,KAAW,EAAW,QAC7B,IAAK,IAAM,KAAQ,EAAQ,SAAU,CACjC,IAAM,EAAU,EAAW,EAAM,GAAG,EAAK,MAAM,GAAG,EAAK,cACvD,EAAS,KAAK,GAItB,MAAO,CACH,MAAO,EAAU,MACjB,YAAa,EAAU,SACvB,KAAM,EAAU,UAChB,KAAM,EACN,MAAO,EAAU,MAAM,QAAQ,UAAW,YAC1C,SAAU"}