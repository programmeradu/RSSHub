import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import{logger_default as e}from"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import"./render-CxhTJIsl.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as r}from"./got-CdvI2yKX.js";import{rss_parser_default as i}from"./rss-parser-1vyhErsD.js";import{ProcessItem as a}from"./utils-B3WrB9Mb.js";import{load as o}from"cheerio";const s=`https://navi.cnki.net`,c={path:`/journals/:name`,categories:[`journal`],example:`/cnki/journals/LKGP`,parameters:{name:`期刊缩写，可以在网址中得到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`navi.cnki.net/knavi/journals/:name/detail`]}],name:`期刊`,maintainers:[`Fatpandac`,`Derekmini`,`pseudoyu`],handler:l};async function l(c){let l=c.req.param(`name`),u=`https://rss.cnki.net/kns/rss.aspx?Journal=${l}&Virtual=knavi`,d=await r.get(u);try{let e=await i.parseString(d.data);if(e.items&&e.items.length!==0){let t=e.items.map(e=>({title:e.title,description:e.content,pubDate:n(e.pubDate),link:e.link,author:e.author}));return{title:e.title,link:e.link,description:e.description,item:t}}}catch(t){e.error(t)}let f=`${s}/knavi/journals/${l}/detail`,p=await r.get(f).then(e=>o(e.data)(`head > title`).text()),m=`${s}/knavi/journals/${l}/yearList?pIdx=0`,{code:h,date:g}=await r.get(m).then(e=>{let t=o(e.data),r=t(`.yearissuepage`).find(`dl`).first().find(`dd`).find(`a`).first().attr(`value`),i=n(t(`.yearissuepage`).find(`dl`).first().find(`dd`).find(`a`).first().attr(`id`).replace(`yq`,``),`YYYYMM`);return{code:r,date:i}}),_=`${s}/knavi/journals/${l}/papers?yearIssue=${h}&pageIdx=0&pcode=CJFD,CCJD`,v=await r.post(_),y=o(v.data),b=y(`dd`),x=b.toArray().map(e=>{let t=y(e).find(`a`).first().text(),n=y(e).find(`b`).attr(`id`),r=`https://cnki.net/kcms/detail/detail.aspx?filename=${n}&dbcode=CJFD`;return{title:t,link:r,pubDate:g}}),S=await Promise.all(x.map(e=>t.tryGet(e.link,()=>a(e))));return{title:String(p),link:f,item:S}}export{c as route};
//# sourceMappingURL=journals-D356KeYe.js.map