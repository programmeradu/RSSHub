import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{config as n}from"./config-Dl8a1sIg.js";import{cache_default as r}from"./cache-kimkMTWJ.js";import{art as i}from"./render-CxhTJIsl.js";import{parseDate as a}from"./parse-date-Bgabdhlb.js";import{md5 as o}from"./md5-4BNsOP-F.js";import{got_default as s}from"./got-CdvI2yKX.js";import{config_not_found_default as c}from"./config-not-found-BVqhRP9D.js";import l from"node:path";import{load as u}from"cheerio";import d from"crypto-js";t();const f=`jmcomic1.me`,p=new Set([`18comic.vip`,`18comic.org`,`jmcomic.me`,`jmcomic1.me`,`jm-comic3.art`,`jm-comic.club`,`jm-comic2.ark`]),m=e=>{if(!n.feature.allow_user_supply_unsafe_domain&&!p.has(e))throw new c(`This RSS is disabled unless 'ALLOW_USER_SUPPLY_UNSAFE_DOMAIN' is set to 'true'.`);return`https://${e}`},h=e=>{switch(e){case`another`:return`其他漫畫`;case`doujin`:return`同人`;case`hanman`:return`韓漫`;case`meiman`:return`美漫`;case`short`:return`短篇`;case`single`:return`單本`;default:return null}},g=()=>`https://www.cdnblackmyth.club`,_=async e=>{e=e.replace(/\?$/,``);let t=Date.now(),n=`${t},1.7.5`,r=`${t}18comicAPP`;r=o(r);let i=await s(e,{headers:{token:r,tokenparam:n}}),a=d.enc.Base64.parse(i.data.data),c=d.MD5(t+`185Hcomic3PAPP7R`).toString(),l=d.enc.Utf8.parse(c),u=d.lib.CipherParams.create({ciphertext:a}),f=d.AES.decrypt(u,l,{mode:d.mode.ECB,padding:d.pad.Pkcs7}),p=f.toString(d.enc.Utf8),m=JSON.parse(p);return m},v=async(t,n,o)=>{n=n.replace(/\?$/,``);let c=await s(n),d=u(c.data),f=d(`.video-title`).slice(0,t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):20).toArray().map(e=>(e=d(e),{title:e.text().trim(),link:`${o}${e.prev().find(`a`).attr(`href`)}`,guid:`18comic:${e.prev().find(`a`).attr(`href`)}`}));return f=await Promise.all(f.map(t=>r.tryGet(t.guid,async()=>{let n=await s(t.link),r=u(n.data);return t.pubDate=a(r(`div[itemprop="datePublished"]`).first().attr(`content`)),t.updated=a(r(`div[itemprop="datePublished"]`).last().attr(`content`)),t.category=r(`span[data-type="tags"]`).first().find(`a`).toArray().map(e=>d(e).text()),t.author=r(`span[data-type="author"]`).first().find(`a`).toArray().map(e=>d(e).text()).join(`, `),t.description=i(l.join(e,`templates/description-61c04b78.art`),{introduction:r(`#intro-block .p-t-5`).text(),images:r(`.img_zoom_img img`).toArray().map(e=>r(e).attr(`data-original`)),cover:r(`.thumb-overlay img`).first().attr(`src`),category:t.category}),t}))),{title:d(`title`).text(),link:n,item:f,description:d(`meta[property="og:description"]`).attr(`content`),allowEmpty:!0}};export{v as ProcessItems,h as apiMapCategory,f as defaultDomain,g as getApiUrl,m as getRootUrl,_ as processApiItems};
//# sourceMappingURL=utils-BQ3YzHuJ.js.map