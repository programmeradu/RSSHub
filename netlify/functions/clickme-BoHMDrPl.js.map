{"version":3,"file":"clickme-BoHMDrPl.js","names":["route: Route","got","item","cache"],"sources":["../../lib/routes/clickme/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/:site/:grouping/:name',\r\n    categories: ['other'],\r\n    example: '/clickme/default/category/beauty',\r\n    parameters: { site: '站点，`default`为普通站，`r18`为成人站，其它值默认为普通站', grouping: '分组方式，`category`为分类，`tag`为标签，其他值默认为分类', name: '分类名或标签名，分类名为英文，可以在分类 URL 中找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '文章',\r\n    maintainers: ['hoilc'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const site = ctx.req.param('site') === 'r18' ? 'r18' : '';\r\n    const grouping = ctx.req.param('grouping') === 'tag' ? 'tag' : 'category';\r\n    const name = ctx.req.param('name');\r\n\r\n    const url = `https://${site ? 'r18.' : ''}clickme.net/${grouping.slice(0, 1)}/${encodeURIComponent(name)}`;\r\n\r\n    const { data: response } = await got.post('https://api.clickme.net/article/list', {\r\n        headers: {\r\n            Referer: url,\r\n        },\r\n        searchParams: {\r\n            key: 'clickme',\r\n        },\r\n        form: {\r\n            articleType: site ? 'r18' : 'article',\r\n            subtype: grouping,\r\n            subtypeSlug: name,\r\n            device: '',\r\n            limit: 18,\r\n            page: 1,\r\n        },\r\n    });\r\n\r\n    const category_name = name === 'new' ? '最新' : response.data.items[0].categoryName[0].name;\r\n    const displayed_name = grouping === 'tag' ? name : category_name;\r\n\r\n    const list = response.data.items.map((item) => ({\r\n        title: item.title,\r\n        link: item.url.replace('http://', 'https://'),\r\n        author: item.userNick,\r\n        pubDate: parseDate(item.date, 'X'),\r\n        category: [...item.categoryName.map((item) => item.name), ...item.tags],\r\n    }));\r\n\r\n    const out = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data } = await got.get(item.link);\r\n                const $ = load(data);\r\n                item.description = $('.article-detail-content').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `ClickMe ${site ? 'R18 ' : ''}- ${displayed_name}`,\r\n        link: url,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,yBACN,WAAY,CAAC,SACb,QAAS,mCACT,WAAY,CAAE,KAAM,uCAAwC,SAAU,uCAAwC,KAAM,gCACpH,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,SACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,UAAY,MAAQ,MAAQ,GACjD,EAAW,EAAI,IAAI,MAAM,cAAgB,MAAQ,MAAQ,WACzD,EAAO,EAAI,IAAI,MAAM,QAErB,EAAM,WAAW,EAAO,OAAS,GAAG,cAAc,EAAS,MAAM,EAAG,GAAG,GAAG,mBAAmB,KAE7F,CAAE,KAAM,GAAa,MAAMC,EAAI,KAAK,uCAAwC,CAC9E,QAAS,CACL,QAAS,GAEb,aAAc,CACV,IAAK,WAET,KAAM,CACF,YAAa,EAAO,MAAQ,UAC5B,QAAS,EACT,YAAa,EACb,OAAQ,GACR,MAAO,GACP,KAAM,KAIR,EAAgB,IAAS,MAAQ,KAAO,EAAS,KAAK,MAAM,GAAG,aAAa,GAAG,KAC/E,EAAiB,IAAa,MAAQ,EAAO,EAE7C,EAAO,EAAS,KAAK,MAAM,IAAK,IAAU,CAC5C,MAAO,EAAK,MACZ,KAAM,EAAK,IAAI,QAAQ,UAAW,YAClC,OAAQ,EAAK,SACb,QAAS,EAAU,EAAK,KAAM,KAC9B,SAAU,CAAC,GAAG,EAAK,aAAa,IAAK,GAASC,EAAK,MAAO,GAAG,EAAK,SAGhE,EAAM,MAAM,QAAQ,IACtB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,QAAS,MAAMF,EAAI,IAAI,EAAK,MAC9B,EAAI,EAAK,GAEf,MADA,GAAK,YAAc,EAAE,2BAA2B,OACzC,MAKnB,MAAO,CACH,MAAO,WAAW,EAAO,OAAS,GAAG,IAAI,IACzC,KAAM,EACN,KAAM"}