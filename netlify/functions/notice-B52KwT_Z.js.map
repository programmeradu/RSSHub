{"version":3,"file":"notice-B52KwT_Z.js","names":["got","route: Route","got","cache"],"sources":["../../lib/routes/tongji/sse/_article.ts","../../lib/routes/tongji/sse/notice.ts"],"sourcesContent":["import got from '@/utils/got'; // get web content\r\nimport { load } from 'cheerio'; // html parser\r\n\r\nexport default async function getArticle(item) {\r\n    const response = await got({\r\n        method: 'get',\r\n        url: item.link,\r\n    });\r\n    const data = response.data;\r\n\r\n    const $ = load(data);\r\n    const title = $('div.view-title').text();\r\n    const content = $('#vsb_content').html();\r\n    $('[name=\"_newscontent_fromname\"] ul a').each((_, e) => {\r\n        const href = $(e).attr('href');\r\n        if (href.startsWith('/')) {\r\n            $(e).attr('href', new URL(href, item.link).href);\r\n        }\r\n    });\r\n\r\n    item.title = title;\r\n    item.description = content + ($('ul[style]').length ? $('ul[style]').html() : '');\r\n\r\n    return item;\r\n}\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\n// Warning: The author still knows nothing about javascript!\r\n\r\n// params:\r\n// type: notification type\r\n\r\nimport got from '@/utils/got'; // get web content\r\nimport { load } from 'cheerio'; // html parser\r\nimport getArticle from './_article';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/sse/:type?',\r\n    categories: ['university'],\r\n    example: '/tongji/sse/xytz',\r\n    parameters: { type: '通知类型，默认为 `xytz`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '软件学院通知',\r\n    maintainers: ['sgqy'],\r\n    handler,\r\n    description: `| 本科生通知 | 研究生通知 | 教工通知 | 全体通知 | 学院通知 | 学院新闻 | 学院活动 |\r\n| ---------- | ---------- | -------- | -------- | -------- | -------- | -------- |\r\n| bkstz      | yjstz      | jgtz     | qttz     | xytz     | xyxw     | xyhd     |\r\n\r\n  注意: \\`qttz\\` 与 \\`xytz\\` 在原网站等价.`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://sse.tongji.edu.cn';\r\n    const type = ctx.req.param('type') || 'xytz';\r\n    const subType = ['bkstz', 'yjstz', 'jgtz', 'qttz'];\r\n\r\n    const listUrl = `${baseUrl}/xxzx/${subType.includes(type) ? `xytz/${type}` : type}.htm`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url: listUrl,\r\n    });\r\n    const data = response.data; // content is html format\r\n    const $ = load(data);\r\n\r\n    // get urls\r\n    const detailUrls = $('.data-list li')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const a = item.find('a');\r\n            return {\r\n                title: a.text(),\r\n                link: new URL(a.attr('href'), baseUrl).href,\r\n                pubDate: parseDate(item.find('.data-list-time').text(), 'YYYY-MM-DD'),\r\n            };\r\n        });\r\n\r\n    // get articles\r\n    const articleList = await Promise.all(detailUrls.map((item) => cache.tryGet(item.link, () => getArticle(item))));\r\n\r\n    // feed the data\r\n    return {\r\n        title: '同济大学软件学院',\r\n        link: listUrl,\r\n        item: articleList,\r\n    };\r\n}\r\n"],"mappings":"wWAGA,eAA8B,EAAW,EAAM,CAC3C,IAAM,EAAW,MAAME,EAAI,CACvB,OAAQ,MACR,IAAK,EAAK,OAER,EAAO,EAAS,KAEhB,EAAI,EAAK,GACT,EAAQ,EAAE,kBAAkB,OAC5B,EAAU,EAAE,gBAAgB,OAWlC,OAVA,EAAE,uCAAuC,MAAM,EAAG,IAAM,CACpD,IAAM,EAAO,EAAE,GAAG,KAAK,QACnB,EAAK,WAAW,MAChB,EAAE,GAAG,KAAK,OAAQ,IAAI,IAAI,EAAM,EAAK,MAAM,QAInD,EAAK,MAAQ,EACb,EAAK,YAAc,GAAW,EAAE,aAAa,OAAS,EAAE,aAAa,OAAS,IAEvE,ECXX,MAAaD,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,cACb,QAAS,mBACT,WAAY,CAAE,KAAM,mBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,QACd,UACA,YAAa;;;;oCAOjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,4BACV,EAAO,EAAI,IAAI,MAAM,SAAW,OAChC,EAAU,CAAC,QAAS,QAAS,OAAQ,QAErC,EAAU,GAAG,EAAQ,QAAQ,EAAQ,SAAS,GAAQ,QAAQ,IAAS,EAAK,MAC5E,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAEH,EAAO,EAAS,KAChB,EAAI,EAAK,GAGT,EAAa,EAAE,iBAChB,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAI,EAAK,KAAK,KACpB,MAAO,CACH,MAAO,EAAE,OACT,KAAM,IAAI,IAAI,EAAE,KAAK,QAAS,GAAS,KACvC,QAAS,EAAU,EAAK,KAAK,mBAAmB,OAAQ,iBAK9D,EAAc,MAAM,QAAQ,IAAI,EAAW,IAAK,GAASC,EAAM,OAAO,EAAK,SAAY,EAAW,MAGxG,MAAO,CACH,MAAO,WACP,KAAM,EACN,KAAM"}