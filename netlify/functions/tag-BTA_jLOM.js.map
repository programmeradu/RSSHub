{"version":3,"file":"tag-BTA_jLOM.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/lfsyd/tag.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { ProcessForm, ProcessFeed } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/tag/:tagId?',\r\n    radar: [\r\n        {\r\n            source: ['mob.iyingdi.com/fine/:tagId'],\r\n            target: '/tag/:tagId',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['auto-bot-ty'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const tagId = ctx.req.param('tagId');\r\n    const tagList = {\r\n        17: '炉石传说',\r\n        18: '万智牌',\r\n        16: '游戏王',\r\n        19: '昆特牌',\r\n        20: '影之诗',\r\n        329: '符文之地传奇',\r\n        221: '阴阳师百闻牌',\r\n        112: '英雄联盟',\r\n        389: '电子游戏',\r\n        24: '桌面游戏',\r\n        102: '卡牌游戏',\r\n        23: '玩家杂谈',\r\n        117: '二次元',\r\n    };\r\n    const tagName = tagList[tagId];\r\n    const rootUrl = 'https://www.iyingdi.com';\r\n    const tagUrl = 'https://api.iyingdi.com/web/feed/tag-content-list';\r\n    const form = {\r\n        page: 1,\r\n        size: 30,\r\n        tag_id: tagId,\r\n        timestamp: '',\r\n        version: 0,\r\n    };\r\n\r\n    const response = await got({\r\n        method: 'post',\r\n        url: tagUrl,\r\n        headers: {\r\n            Host: 'api.iyingdi.com',\r\n            'Login-Token': 'nologin',\r\n            Origin: rootUrl,\r\n            Platform: 'pc',\r\n            Referer: `${rootUrl}/`,\r\n        },\r\n        form: ProcessForm(form),\r\n    });\r\n\r\n    const { list } = response.data;\r\n    const tagJson = JSON.parse(list[0].feed.tag_json);\r\n\r\n    const articleList = list.map((item) => ({\r\n        title: item.feed.title,\r\n        pubDate: parseDate(item.feed.show_time * 1000),\r\n        link: `${rootUrl}/tz/post/${item.feed.source_id}`,\r\n        guid: item.feed.title,\r\n        postId: item.feed.source_id,\r\n    }));\r\n\r\n    const items = await ProcessFeed(cache, articleList);\r\n\r\n    return {\r\n        title: `${tagName || tagJson[0].tag} - 旅法师营地 `,\r\n        link: `${rootUrl}/tz/tag/${tagId}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mcAMA,MAAaA,EAAe,CACxB,KAAM,eACN,MAAO,CACH,CACI,OAAQ,CAAC,+BACT,OAAQ,gBAGhB,KAAM,UACN,YAAa,CAAC,eACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,SACtB,EAAU,CACZ,GAAI,OACJ,GAAI,MACJ,GAAI,MACJ,GAAI,MACJ,GAAI,MACJ,IAAK,SACL,IAAK,SACL,IAAK,OACL,IAAK,OACL,GAAI,OACJ,IAAK,OACL,GAAI,OACJ,IAAK,OAEH,EAAU,EAAQ,GAClB,EAAU,0BAEV,EAAO,CACT,KAAM,EACN,KAAM,GACN,OAAQ,EACR,UAAW,GACX,QAAS,GAGP,EAAW,MAAMC,EAAI,CACvB,OAAQ,OACR,IAAK,oDACL,QAAS,CACL,KAAM,kBACN,cAAe,UACf,OAAQ,EACR,SAAU,KACV,QAAS,GAAG,EAAQ,IAExB,KAAM,EAAY,KAGhB,CAAE,QAAS,EAAS,KACpB,EAAU,KAAK,MAAM,EAAK,GAAG,KAAK,UAElC,EAAc,EAAK,IAAK,IAAU,CACpC,MAAO,EAAK,KAAK,MACjB,QAAS,EAAU,EAAK,KAAK,UAAY,KACzC,KAAM,GAAG,EAAQ,WAAW,EAAK,KAAK,YACtC,KAAM,EAAK,KAAK,MAChB,OAAQ,EAAK,KAAK,aAGhB,EAAQ,MAAM,EAAYC,EAAO,GAEvC,MAAO,CACH,MAAO,GAAG,GAAW,EAAQ,GAAG,IAAI,WACpC,KAAM,GAAG,EAAQ,UAAU,IAC3B,KAAM"}