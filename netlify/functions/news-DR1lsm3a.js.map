{"version":3,"file":"news-DR1lsm3a.js","names":["route: Route","got","elem","$","category","cache","response"],"sources":["../../lib/routes/nltimes/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst map = new Map([\r\n    ['top-stories', { title: 'NL Times -- Top Stories', suffix: '/top-stories' }],\r\n    ['health', { title: 'NL Times -- Health', suffix: '/categories/health' }],\r\n    ['crime', { title: 'NL Times -- Crime', suffix: '/categories/crime' }],\r\n    ['politics', { title: 'NL Times -- Politics', suffix: '/categories/politics' }],\r\n    ['business', { title: 'NL Times -- Business', suffix: '/categories/business' }],\r\n    ['tech', { title: 'NL Times -- Tech', suffix: '/categories/tech' }],\r\n    ['culture', { title: 'NL Times -- Culture', suffix: '/categories/culture' }],\r\n    ['sports', { title: 'NL Times -- Sports', suffix: '/categories/sports' }],\r\n    ['weird', { title: 'NL Times -- Weird', suffix: '/categories/weird' }],\r\n    ['1-1-2', { title: 'NL Times -- 1-1-2', suffix: '/categories/1-1-2' }],\r\n]);\r\n\r\nexport const route: Route = {\r\n    path: '/news/:category?',\r\n    categories: ['new-media'],\r\n    example: '/nltimes/news/top-stories',\r\n    parameters: { category: 'category' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['nltimes.nl/categories/:category'],\r\n            target: '/news/:category',\r\n        },\r\n    ],\r\n    name: 'News',\r\n    maintainers: ['Hivol'],\r\n    handler,\r\n    description: `| Top Stories (default) | Health | Crime | Politics | Business | Tech | Culture | Sports | Weird | 1-1-2 |\r\n| --------------------- | ------ | ----- | -------- | -------- | ---- | ------- | ------ | ----- | ----- |\r\n| top-stories           | health | crime | politics | business | tech | culture | sports | weird | 1-1-2 |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? 'top-stories';\r\n    const suffix = map.get(category).suffix;\r\n\r\n    const rootUrl = 'https://www.nltimes.nl';\r\n    const apiUrl = rootUrl + suffix;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: apiUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    const list = $('.news-card')\r\n        .slice(0, 10)\r\n        .toArray()\r\n        .map((elem) => {\r\n            const item = {\r\n                link: $(elem).children('.news-card__title').first().children('a').first().attr('href'),\r\n                title: $(elem).children('.news-card__title').first().children('a').first().text(),\r\n                date: $(elem).children('.news-card__date').first().text(),\r\n                category: $(elem)\r\n                    .children('.news-card__categories')\r\n                    .first()\r\n                    .children('a')\r\n                    .toArray()\r\n                    .map((elem) => $(elem).text()),\r\n            };\r\n            return item;\r\n        });\r\n\r\n    const ProcessFeed = (data) => {\r\n        const $ = load(data);\r\n\r\n        return $('.news-article--body').html();\r\n    };\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) => {\r\n            const title = item.title;\r\n            const date = timezone(parseDate(item.date, 'DD MMMM YYYY - HH:mm'), +1); // Central European Time\r\n            const link = rootUrl + item.link;\r\n            const category = item.category;\r\n\r\n            return cache.tryGet(link, async () => {\r\n                const response = await got({\r\n                    method: 'get',\r\n                    url: link,\r\n                });\r\n\r\n                const description = ProcessFeed(response.data);\r\n                return {\r\n                    title,\r\n                    category,\r\n                    description,\r\n                    pubDate: date,\r\n                    link,\r\n                };\r\n            });\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: map.get(category).title,\r\n        language: 'en',\r\n        link: apiUrl,\r\n        description: map.get(category).title,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAM,EAAM,IAAI,IAAI,CAChB,CAAC,cAAe,CAAE,MAAO,0BAA2B,OAAQ,iBAC5D,CAAC,SAAU,CAAE,MAAO,qBAAsB,OAAQ,uBAClD,CAAC,QAAS,CAAE,MAAO,oBAAqB,OAAQ,sBAChD,CAAC,WAAY,CAAE,MAAO,uBAAwB,OAAQ,yBACtD,CAAC,WAAY,CAAE,MAAO,uBAAwB,OAAQ,yBACtD,CAAC,OAAQ,CAAE,MAAO,mBAAoB,OAAQ,qBAC9C,CAAC,UAAW,CAAE,MAAO,sBAAuB,OAAQ,wBACpD,CAAC,SAAU,CAAE,MAAO,qBAAsB,OAAQ,uBAClD,CAAC,QAAS,CAAE,MAAO,oBAAqB,OAAQ,sBAChD,CAAC,QAAS,CAAE,MAAO,oBAAqB,OAAQ,wBAGvCA,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,aACb,QAAS,4BACT,WAAY,CAAE,SAAU,YACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,mCACT,OAAQ,oBAGhB,KAAM,OACN,YAAa,CAAC,SACd,UACA,YAAa;;6GAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,cACxC,EAAS,EAAI,IAAI,GAAU,OAE3B,EAAU,yBACV,EAAS,EAAU,EAEnB,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,cACV,MAAM,EAAG,IACT,UACA,IAAK,GAAS,CACX,IAAM,EAAO,CACT,KAAM,EAAE,GAAM,SAAS,qBAAqB,QAAQ,SAAS,KAAK,QAAQ,KAAK,QAC/E,MAAO,EAAE,GAAM,SAAS,qBAAqB,QAAQ,SAAS,KAAK,QAAQ,OAC3E,KAAM,EAAE,GAAM,SAAS,oBAAoB,QAAQ,OACnD,SAAU,EAAE,GACP,SAAS,0BACT,QACA,SAAS,KACT,UACA,IAAK,GAAS,EAAEC,GAAM,SAE/B,OAAO,IAGT,EAAe,GAAS,CAC1B,IAAMC,EAAI,EAAK,GAEf,OAAOA,EAAE,uBAAuB,QAG9B,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GAAS,CACf,IAAM,EAAQ,EAAK,MACb,EAAO,EAAS,EAAU,EAAK,KAAM,wBAAyB,GAC9D,EAAO,EAAU,EAAK,KACtBC,EAAW,EAAK,SAEtB,OAAOC,EAAM,OAAO,EAAM,SAAY,CAClC,IAAMC,EAAW,MAAML,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAc,EAAYK,EAAS,MACzC,MAAO,CACH,QACA,SAAA,EACA,cACA,QAAS,EACT,aAMhB,MAAO,CACH,MAAO,EAAI,IAAI,GAAU,MACzB,SAAU,KACV,KAAM,EACN,YAAa,EAAI,IAAI,GAAU,MAC/B,KAAM"}