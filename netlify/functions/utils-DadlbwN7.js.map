{"version":3,"file":"utils-DadlbwN7.js","names":["got","cache"],"sources":["../../lib/routes/6v123/utils.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport iconv from 'iconv-lite';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport async function loadDetailPage(link) {\r\n    const response = await got.get(link, {\r\n        responseType: 'buffer',\r\n    });\r\n    response.data = iconv.decode(response.data, 'gb2312');\r\n\r\n    const $ = load(response.data);\r\n\r\n    return {\r\n        title: $('title')\r\n            .text()\r\n            .replaceAll(/，免费下载，迅雷下载|，6v电影/g, ''),\r\n        description: $('meta[name=\"description\"]').attr('content'),\r\n        enclosure_urls: $('table td')\r\n            .toArray()\r\n            .map((e) => ({\r\n                title: $(e).text().replace('磁力：', ''),\r\n                magnet: $(e).find('a').attr('href'),\r\n            }))\r\n            .filter((item) => item.magnet?.includes('magnet')),\r\n    };\r\n}\r\n\r\nexport async function processItems(ctx, baseURL, exclude) {\r\n    const response = await got.get(baseURL, {\r\n        responseType: 'buffer',\r\n    });\r\n    response.data = iconv.decode(response.data, 'gb2312');\r\n\r\n    const $ = load(response.data);\r\n    const list = $('ul.list')[0].children;\r\n\r\n    const process = await Promise.all(\r\n        list.map((item) => {\r\n            const link = $(item).find('a');\r\n            const href = link.attr('href');\r\n            const pubDate = timezone(parseDate($(item).find('span').text().replaceAll(/[[\\]]/g, ''), 'MM-DD'), +8);\r\n            const text = link.text();\r\n\r\n            if (href === undefined) {\r\n                return;\r\n            }\r\n\r\n            if (exclude && exclude.some((e) => e.test(text))) {\r\n                // 过滤掉满足正则的标题条目\r\n                return;\r\n            }\r\n\r\n            const itemUrl = 'https://www.hao6v.cc' + link.attr('href');\r\n\r\n            return cache.tryGet(itemUrl, async () => {\r\n                const detailInfo = await loadDetailPage(itemUrl);\r\n\r\n                if (detailInfo.enclosure_urls.length > 1) {\r\n                    return detailInfo.enclosure_urls.map((url) => ({\r\n                        enclosure_url: url.magnet,\r\n                        enclosure_type: 'application/x-bittorrent',\r\n                        title: `${link.text()} ( ${url.title} )`,\r\n                        description: detailInfo.description,\r\n                        pubDate,\r\n                        link: itemUrl,\r\n                        guid: `${itemUrl}#${url.title}`,\r\n                    }));\r\n                }\r\n\r\n                return {\r\n                    enclosure_url: detailInfo.enclosure_urls.length === 0 ? '' : detailInfo.enclosure_urls[0].magnet,\r\n                    enclosure_type: 'application/x-bittorrent',\r\n                    title: link.text(),\r\n                    description: detailInfo.description,\r\n                    pubDate,\r\n                    link: itemUrl,\r\n                };\r\n            });\r\n        })\r\n    );\r\n\r\n    return process.filter((item) => item !== undefined).flat();\r\n}\r\n"],"mappings":"oQAOA,eAAsB,EAAe,EAAM,CACvC,IAAM,EAAW,MAAMA,EAAI,IAAI,EAAM,CACjC,aAAc,WAElB,EAAS,KAAO,EAAM,OAAO,EAAS,KAAM,UAE5C,IAAM,EAAI,EAAK,EAAS,MAExB,MAAO,CACH,MAAO,EAAE,SACJ,OACA,WAAW,oBAAqB,IACrC,YAAa,EAAE,4BAA4B,KAAK,WAChD,eAAgB,EAAE,YACb,UACA,IAAK,IAAO,CACT,MAAO,EAAE,GAAG,OAAO,QAAQ,MAAO,IAClC,OAAQ,EAAE,GAAG,KAAK,KAAK,KAAK,WAE/B,OAAQ,GAAS,EAAK,QAAQ,SAAS,YAIpD,eAAsB,EAAa,EAAK,EAAS,EAAS,CACtD,IAAM,EAAW,MAAMA,EAAI,IAAI,EAAS,CACpC,aAAc,WAElB,EAAS,KAAO,EAAM,OAAO,EAAS,KAAM,UAE5C,IAAM,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,WAAW,GAAG,SAEvB,EAAU,MAAM,QAAQ,IAC1B,EAAK,IAAK,GAAS,CACf,IAAM,EAAO,EAAE,GAAM,KAAK,KACpB,EAAO,EAAK,KAAK,QACjB,EAAU,EAAS,EAAU,EAAE,GAAM,KAAK,QAAQ,OAAO,WAAW,SAAU,IAAK,SAAU,GAC7F,EAAO,EAAK,OAMlB,GAJI,IAAS,IAAA,IAIT,GAAW,EAAQ,KAAM,GAAM,EAAE,KAAK,IAEtC,OAGJ,IAAM,EAAU,uBAAyB,EAAK,KAAK,QAEnD,OAAOC,EAAM,OAAO,EAAS,SAAY,CACrC,IAAM,EAAa,MAAM,EAAe,GAcxC,OAZI,EAAW,eAAe,OAAS,EAC5B,EAAW,eAAe,IAAK,IAAS,CAC3C,cAAe,EAAI,OACnB,eAAgB,2BAChB,MAAO,GAAG,EAAK,OAAO,KAAK,EAAI,MAAM,IACrC,YAAa,EAAW,YACxB,UACA,KAAM,EACN,KAAM,GAAG,EAAQ,GAAG,EAAI,WAIzB,CACH,cAAe,EAAW,eAAe,SAAW,EAAI,GAAK,EAAW,eAAe,GAAG,OAC1F,eAAgB,2BAChB,MAAO,EAAK,OACZ,YAAa,EAAW,YACxB,UACA,KAAM,QAMtB,OAAO,EAAQ,OAAQ,GAAS,IAAS,IAAA,IAAW"}