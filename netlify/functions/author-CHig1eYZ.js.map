{"version":3,"file":"author-CHig1eYZ.js","names":["route: Route","cache","ofetch"],"sources":["../../lib/routes/voronoiapp/author.ts"],"sourcesContent":["import type { Data, Route } from '@/types';\r\nimport { CommonDataProperties, CommonRouteProperties, getPostItems } from './common';\r\nimport ofetch from '@/utils/ofetch';\r\nimport cache from '@/utils/cache';\r\n\r\nexport const route: Route = {\r\n    ...CommonRouteProperties,\r\n    name: 'Author Posts',\r\n    path: '/author/:username',\r\n    radar: [\r\n        {\r\n            source: ['www.voronoiapp.com/author/:username'],\r\n            target: '/author/:username',\r\n        },\r\n    ],\r\n    example: '/voronoiapp/author/visualcapitalist',\r\n    parameters: {\r\n        username: 'The username of the author',\r\n    },\r\n    handler: async (ctx) => {\r\n        const { username } = ctx.req.param();\r\n        const uid = await getUidFromUsername(username);\r\n        const items = await getPostItems({ order: 'DESC', author: uid });\r\n        return {\r\n            ...CommonDataProperties,\r\n            title: `Voronoi Posts by ${username}`,\r\n            link: `https://www.voronoiapp.com/author/${username}`,\r\n            item: items,\r\n        } as Data;\r\n    },\r\n};\r\nasync function getUidFromUsername(username: string): Promise<string> {\r\n    return (await cache.tryGet(`voronoiapp-author-${username}`, async () => {\r\n        const response = await ofetch<'text'>(`https://www.voronoiapp.com/author/${username}`);\r\n        const match = response.match(/\\\\\"uid\\\\\":\\\\\"([\\w-]+)\\\\\"/);\r\n        if (!match) {\r\n            throw new Error(`No UID found for username: ${username}`);\r\n        }\r\n        return match[1];\r\n    })) as string;\r\n}\r\n"],"mappings":"qYAKA,MAAaA,EAAe,CACxB,GAAG,EACH,KAAM,eACN,KAAM,oBACN,MAAO,CACH,CACI,OAAQ,CAAC,uCACT,OAAQ,sBAGhB,QAAS,sCACT,WAAY,CACR,SAAU,8BAEd,QAAS,KAAO,IAAQ,CACpB,GAAM,CAAE,YAAa,EAAI,IAAI,QACvB,EAAM,MAAM,EAAmB,GAC/B,EAAQ,MAAM,EAAa,CAAE,MAAO,OAAQ,OAAQ,IAC1D,MAAO,CACH,GAAG,EACH,MAAO,oBAAoB,IAC3B,KAAM,qCAAqC,IAC3C,KAAM,KAIlB,eAAe,EAAmB,EAAmC,CACjE,OAAQ,MAAMC,EAAM,OAAO,qBAAqB,IAAY,SAAY,CACpE,IAAM,EAAW,MAAMC,EAAe,qCAAqC,KACrE,EAAQ,EAAS,MAAM,4BAC7B,GAAI,CAAC,EACD,MAAU,MAAM,8BAA8B,KAElD,OAAO,EAAM"}