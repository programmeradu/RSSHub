{"version":3,"file":"hot-DWRaM0Ft.js","names":["route: Route","got","utils"],"sources":["../../lib/routes/coolapk/hot.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport utils from './utils';\r\nconst getLinkAndTitle = (type, period) => {\r\n    const baseURL = 'https://api.coolapk.com/v6/page/dataList?url=';\r\n    let link;\r\n    const res = {};\r\n    const types = {\r\n        jrrm: {\r\n            title: '今日热门',\r\n            url: baseURL + '%2Ffeed%2FstatList%3FcacheExpires%3D300%26statType%3Dday%26sortField%3Ddetailnum%26title%3D%E4%BB%8A%E6%97%A5%E7%83%AD%E9%97%A8&title=%E4%BB%8A%E6%97%A5%E7%83%AD%E9%97%A8&subTitle=&page=1',\r\n        },\r\n\r\n        dzb: {\r\n            title: '点赞榜',\r\n            sortField: 'likenum',\r\n        },\r\n\r\n        scb: {\r\n            title: '收藏榜',\r\n            sortField: 'favnum',\r\n        },\r\n        plb: {\r\n            title: '评论榜',\r\n            sortField: 'replynum',\r\n        },\r\n        ktb: {\r\n            title: '酷图榜',\r\n            sortField: 'likenum',\r\n        },\r\n    };\r\n\r\n    const periods = {\r\n        daily: {\r\n            description: '日榜',\r\n            statType: 'day',\r\n        },\r\n        weekly: {\r\n            description: '周榜',\r\n            statType: '7days',\r\n        },\r\n    };\r\n\r\n    if (type === 'jrrm') {\r\n        res.link = types.jrrm.url;\r\n        res.title = types.jrrm.title;\r\n        return res;\r\n    } else if (type === 'ktb') {\r\n        const trans = {\r\n            daily: {\r\n                description: '周榜',\r\n                statDays: '7days',\r\n            },\r\n            weekly: {\r\n                description: '月榜',\r\n                statDays: '30days',\r\n            },\r\n        };\r\n        link = `#/feed/coolPictureList?statDays=` + trans[period].statDays + `&listType=statFavNum&buildCard=1&title=` + trans[period].description + `&page=1`;\r\n        res.title = '酷图榜-' + trans[period].description;\r\n    } else {\r\n        link = `#/feed/statList?statType=` + periods[period].statType + `&sortField=` + types[type].sortField + `&title=` + periods[period].description + `&page=1`;\r\n        res.title = types[type].title + `-` + periods[period].description;\r\n    }\r\n    res.link = baseURL + encodeURIComponent(link);\r\n    return res;\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/hot/:type?/:period?',\r\n    categories: ['social-media'],\r\n    example: '/coolapk/hot',\r\n    parameters: { type: '默认为`jrrm`', period: '默认为`daily`' },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'ALLOW_USER_HOTLINK_TEMPLATE',\r\n                optional: true,\r\n                description: '设置为`true`并添加`image_hotlink_template`参数来代理图片',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '热榜',\r\n    maintainers: ['xizeyoupan'],\r\n    handler,\r\n    description: `| 参数名称 | 今日热门 | 点赞榜 | 评论榜 | 收藏榜 | 酷图榜 |\r\n| -------- | -------- | ------ | ------ | ------ | ------ |\r\n| type     | jrrm     | dzb    | plb    | scb    | ktb    |\r\n\r\n| 参数名称 | 日榜  | 周榜   |\r\n| -------- | ----- | ------ |\r\n| period   | daily | weekly |\r\n\r\n::: tip\r\n  今日热门没有周榜，酷图榜日榜的参数会变成周榜，周榜的参数会变成月榜。\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type') || 'jrrm';\r\n    const period = ctx.req.param('period') || 'daily';\r\n    const { link, title } = getLinkAndTitle(type, period);\r\n    const r = await got(link, {\r\n        headers: utils.getHeaders(),\r\n    });\r\n    const data = r.data.data;\r\n    const t = [];\r\n    for (const i of data) {\r\n        if (i.entityType === 'card') {\r\n            for (const k of i.entities) {\r\n                t.push(k);\r\n            }\r\n        } else {\r\n            t.push(i);\r\n        }\r\n    }\r\n\r\n    let out = await Promise.all(t.map((item) => utils.parseDynamic(item)));\r\n\r\n    out = out.filter(Boolean);\r\n\r\n    return {\r\n        title,\r\n        link: 'https://www.coolapk.com/',\r\n        description: `热榜-` + title,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"2WAGA,MAAM,GAAmB,EAAM,IAAW,CACtC,IAAM,EAAU,gDACZ,EACE,EAAM,GACN,EAAQ,CACV,KAAM,CACF,MAAO,OACP,IAAK,EAAU,+LAGnB,IAAK,CACD,MAAO,MACP,UAAW,WAGf,IAAK,CACD,MAAO,MACP,UAAW,UAEf,IAAK,CACD,MAAO,MACP,UAAW,YAEf,IAAK,CACD,MAAO,MACP,UAAW,YAIb,EAAU,CACZ,MAAO,CACH,YAAa,KACb,SAAU,OAEd,OAAQ,CACJ,YAAa,KACb,SAAU,UAIlB,GAAI,IAAS,OAGT,MAFA,GAAI,KAAO,EAAM,KAAK,IACtB,EAAI,MAAQ,EAAM,KAAK,MAChB,KACA,IAAS,MAAO,CACvB,IAAM,EAAQ,CACV,MAAO,CACH,YAAa,KACb,SAAU,SAEd,OAAQ,CACJ,YAAa,KACb,SAAU,WAGlB,EAAO,mCAAqC,EAAM,GAAQ,SAAW,0CAA4C,EAAM,GAAQ,YAAc,UAC7I,EAAI,MAAQ,OAAS,EAAM,GAAQ,iBAEnC,EAAO,4BAA8B,EAAQ,GAAQ,SAAW,cAAgB,EAAM,GAAM,UAAY,UAAY,EAAQ,GAAQ,YAAc,UAClJ,EAAI,MAAQ,EAAM,GAAM,MAAQ,IAAM,EAAQ,GAAQ,YAG1D,MADA,GAAI,KAAO,EAAU,mBAAmB,GACjC,GAGEA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,gBACb,QAAS,eACT,WAAY,CAAE,KAAM,YAAa,OAAQ,cACzC,SAAU,CACN,cAAe,CACX,CACI,KAAM,8BACN,SAAU,GACV,YAAa,gDAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,cACd,UACA,YAAa;;;;;;;;;;MAajB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,OAChC,EAAS,EAAI,IAAI,MAAM,WAAa,QACpC,CAAE,OAAM,SAAU,EAAgB,EAAM,GACxC,EAAI,MAAMC,EAAI,EAAM,CACtB,QAASC,EAAM,eAEb,EAAO,EAAE,KAAK,KACd,EAAI,GACV,IAAK,IAAM,KAAK,EACZ,GAAI,EAAE,aAAe,OACjB,IAAK,IAAM,KAAK,EAAE,SACd,EAAE,KAAK,QAGX,EAAE,KAAK,GAIf,IAAI,EAAM,MAAM,QAAQ,IAAI,EAAE,IAAK,GAASA,EAAM,aAAa,KAI/D,MAFA,GAAM,EAAI,OAAO,SAEV,CACH,QACA,KAAM,2BACN,YAAa,MAAQ,EACrB,KAAM"}