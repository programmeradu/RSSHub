{"version":3,"file":"news-COjqiY5J.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/tass/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    categories: ['traditional-media'],\r\n    example: '/tass/politics',\r\n    parameters: { category: 'Category, can be found in URL, `politics` by default' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['tass.com/:category'],\r\n            target: '/:category',\r\n        },\r\n    ],\r\n    name: 'News',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    description: `| Russian Politics & Diplomacy | World | Business & Economy | Military & Defense | Science & Space | Emergencies | Society & Culture | Press Review | Sports |\r\n| ---------------------------- | ----- | ------------------ | ------------------ | --------------- | ----------- | ----------------- | ------------ | ------ |\r\n| politics                     | world | economy            | defense            | science         | emergencies | society           | pressreview  | sports |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'politics' } = ctx.req.param();\r\n\r\n    const { data: categoryPage, url: link } = await got(`https://tass.com/${category}`);\r\n    const $ = load(categoryPage);\r\n\r\n    const sectionId = $('.container .section-page')\r\n        .attr('ng-init')\r\n        .match(/sectionId\\s*=\\s*(\\d+?);/);\r\n\r\n    const { data: response } = await got.post('https://tass.com/userApi/categoryNewsList', {\r\n        json: {\r\n            sectionId: sectionId[1],\r\n            limit: 20,\r\n            type: 'all',\r\n        },\r\n    });\r\n\r\n    const list = response.newsList.map((item) => ({\r\n        title: item.title,\r\n        description: item.lead,\r\n        link: `https://tass.com${item.link}`,\r\n        pubDate: parseDate(item.date, 'X'),\r\n    }));\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n\r\n                $('.news-media img').each((_, ele) => {\r\n                    if (ele.attribs.src) {\r\n                        ele.attribs.src = ele.attribs.src.replaceAll('/width/1020_b9261fa1', '');\r\n                    }\r\n                });\r\n\r\n                item.description = $('.news-header__lead').prop('outerHTML') + ($('.news-media').prop('outerHTML') ?? '') + $('.text-block').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        link,\r\n        language: 'en',\r\n        image: $('head meta[property=\"og:image\"]').attr('content'),\r\n        icon: $('head link[rel=\"apple-touch-icon\"]').attr('href'),\r\n        logo: $('head link[rel=\"apple-touch-icon\"]').attr('href'),\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,qBACb,QAAS,iBACT,WAAY,CAAE,SAAU,wDACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,sBACT,OAAQ,eAGhB,KAAM,OACN,YAAa,CAAC,UACd,UACA,YAAa;;iKAKjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,YAAe,EAAI,IAAI,QAEpC,CAAE,KAAM,EAAc,IAAK,GAAS,MAAMC,EAAI,oBAAoB,KAClE,EAAI,EAAK,GAET,EAAY,EAAE,4BACf,KAAK,WACL,MAAM,2BAEL,CAAE,KAAM,GAAa,MAAMA,EAAI,KAAK,4CAA6C,CACnF,KAAM,CACF,UAAW,EAAU,GACrB,MAAO,GACP,KAAM,SAIR,EAAO,EAAS,SAAS,IAAK,IAAU,CAC1C,MAAO,EAAK,MACZ,YAAa,EAAK,KAClB,KAAM,mBAAmB,EAAK,OAC9B,QAAS,EAAU,EAAK,KAAM,QAG5B,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAUf,OARA,EAAE,mBAAmB,MAAM,EAAG,IAAQ,CAC9B,EAAI,QAAQ,MACZ,EAAI,QAAQ,IAAM,EAAI,QAAQ,IAAI,WAAW,uBAAwB,OAI7E,EAAK,YAAcC,EAAE,sBAAsB,KAAK,cAAgBA,EAAE,eAAe,KAAK,cAAgB,IAAMA,EAAE,eAAe,OAEtH,MAKnB,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,OACA,SAAU,KACV,MAAO,EAAE,kCAAkC,KAAK,WAChD,KAAM,EAAE,qCAAqC,KAAK,QAClD,KAAM,EAAE,qCAAqC,KAAK,QAClD,KAAM"}