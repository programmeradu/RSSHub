{"version":3,"file":"zxfb-C7gxsg25.js","names":["got","cache","$","route: Route"],"sources":["../../lib/routes/12371/zxfb.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport * as cheerio from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport cache from '@/utils/cache';\r\n\r\nimport { Route } from '@/types';\r\n\r\nconst handler = async (ctx) => {\r\n    const { category = 'zxfb' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 15;\r\n\r\n    const rootUrl = 'https://www.12371.cn/';\r\n    const currentUrl = `${rootUrl}${category}/`;\r\n    const response = await got(currentUrl);\r\n\r\n    const $ = cheerio.load(response.data);\r\n\r\n    const pattern = /item=(\\[{.*?}]);/;\r\n    const newsList = JSON.parse($('script[language=\"javascript\"]').text().match(pattern)?.[1].replaceAll(\"'\", '\"') || '[]');\r\n\r\n    const topNewsList = newsList.slice(0, limit).map((item) => ({\r\n        title: item.title,\r\n        pubDate: timezone(parseDate(item.brief, 'YYYY-MM-DD HH:mm:ss'), 8),\r\n        link: item.link_add,\r\n    }));\r\n\r\n    const items = await Promise.all(\r\n        topNewsList.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got(item.link);\r\n                const $ = cheerio.load(detailResponse.data);\r\n\r\n                item.description = $('.word').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    example: '/12371/zxfb',\r\n    parameters: { category: '新闻分类名，预设 `zxfb`' },\r\n    radar: [\r\n        {\r\n            source: ['www.12371.cn/:category'],\r\n        },\r\n    ],\r\n    name: '最新发布',\r\n    maintainers: ['zvrr'],\r\n    handler,\r\n    url: 'www.12371.cn',\r\n    description: `| 最新发布 |\r\n| :------: |\r\n|   zxfb   |`,\r\n};\r\n"],"mappings":"qZAQA,MAAM,EAAU,KAAO,IAAQ,CAC3B,GAAM,CAAE,WAAW,QAAW,EAAI,IAAI,QAChC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAG/E,EAAa,wBAAa,EAAS,GACnC,EAAW,MAAMA,EAAI,GAErB,EAAI,EAAQ,KAAK,EAAS,MAE1B,EAAU,mBACV,EAAW,KAAK,MAAM,EAAE,iCAAiC,OAAO,MAAM,KAAW,GAAG,WAAW,IAAK,MAAQ,MAE5G,EAAc,EAAS,MAAM,EAAG,GAAO,IAAK,IAAU,CACxD,MAAO,EAAK,MACZ,QAAS,EAAS,EAAU,EAAK,MAAO,uBAAwB,GAChE,KAAM,EAAK,YAGT,EAAQ,MAAM,QAAQ,IACxB,EAAY,IAAK,GACbC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,EAAK,MAChCE,EAAI,EAAQ,KAAK,EAAe,MAItC,MAFA,GAAK,YAAcA,EAAE,SAAS,OAEvB,MAKnB,MAAO,CACH,MAAO,EAAE,SAAS,OAClB,KAAM,EACN,KAAM,IAIDC,EAAe,CACxB,KAAM,cACN,QAAS,cACT,WAAY,CAAE,SAAU,mBACxB,MAAO,CACH,CACI,OAAQ,CAAC,4BAGjB,KAAM,OACN,YAAa,CAAC,QACd,UACA,IAAK,eACL,YAAa"}