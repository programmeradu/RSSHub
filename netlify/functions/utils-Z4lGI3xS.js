import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{art as n}from"./render-CxhTJIsl.js";import{md5 as r}from"./md5-4BNsOP-F.js";import{got_default as i}from"./got-CdvI2yKX.js";import a from"node:path";import{load as o}from"cheerio";t();const s=`https://www.iyingdi.com`,c=async(e,t)=>{let n=await Promise.all(t.map(t=>e.tryGet(t.link,async()=>{let e={post_id:t.postId,timestamp:``},{body:n}=await i({method:`post`,url:`https://api.iyingdi.com/web/post/info`,headers:{Host:`api.iyingdi.com`,"Login-Token":`nologin`,Origin:s,Platform:`pc`,Referer:`${s}/`},form:l(e)});return t.description=u(JSON.parse(n).post.content),t})));return n},l=(e,t)=>{let n=t?`8a11ed3712b699e749185674f1dc20b4`:`b8d5b38577b8bb382b0c783b474b95f9`;return e.key=n,e.timestamp=Math.floor(Date.now()/1e3),e.sign=r(new URLSearchParams(e).toString()),delete e.key,e},u=t=>{let r=/(<p>|<div>)(.*?)?<strong>(标准|狂野)日报投稿.*?<\/strong>(.*?)?(<\/p>|<\/div>)(.|\n)*$/,i=o(t.replace(r,``));return i(`.yingdi-car,.bbspost,.deck-set`).each((t,r)=>{let o=i(r).attr(`class`),c=i(r).attr(`data-id`),l=`${s}/web/tools/hearthstone/decks/setdetail?setid=${c}`,u=o===`yingdi-card bbspost`?`${s}/tz/post/${c}`:l,d=i(r).find(`.card-status .time`).text();i(r).find(`.card-info .title`).text((e,t)=>`${t} ${d}`),i(r).find(`.card-status`).remove(),i(r).find(`.card-info`).wrap(n(a.join(e,`templates/card-038fc8ce.art`),{url:u}))}),i(`.yingdi-image.gif`).each((e,t)=>{let n=i(t).attr(`data-original`);i(t).attr(`src`,n)}),i(`.yingdi-audio`).each((e,t)=>{i(t).find(`.audio-cover`).remove(),i(t).find(`.audio-area.hidden`).attr(`class`,`audio-area`)}),i(`.yingdi-video iframe`).each((t,r)=>{let o=i(r).attr(`src`).match(/bvid=(.*?)&/)[1];if(o){let t=`https://www.bilibili.com/video/${o}`;i(r).after(n(a.join(e,`templates/video-54339745.art`),{url:t}))}}),i(`.yingdi-card.user`).each((e,t)=>{i(t).prev(`p`).remove(),i(t).remove()}),i(`.action-button`).remove(),i(`.yingdi-ballot`).remove(),i(`hr`).remove(),i.html()};export{c as ProcessFeed,l as ProcessForm};
//# sourceMappingURL=utils-Z4lGI3xS.js.map