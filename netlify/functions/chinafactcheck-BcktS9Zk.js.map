{"version":3,"file":"chinafactcheck-BcktS9Zk.js","names":["got","route: Route","got","utils","cache"],"sources":["../../lib/routes/chinafactcheck/utils.ts","../../lib/routes/chinafactcheck/index.ts"],"sourcesContent":["import { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { config } from '@/config';\r\n\r\nconst siteLink = 'https://chinafactcheck.com';\r\n\r\nconst cleanDom = (dom) => {\r\n    dom('*[style]').removeAttr('style');\r\n    dom('br').remove();\r\n    dom('span:empty').remove();\r\n    dom('span').each((_, el) => {\r\n        if (dom(el).html().trim() === '&nbsp;') {\r\n            dom(el).remove();\r\n        }\r\n    });\r\n    dom('p:empty').remove();\r\n    dom('p').each((_, el) => {\r\n        if (dom(el).html().trim() === '') {\r\n            dom(el).remove();\r\n        }\r\n    });\r\n    return dom;\r\n};\r\n\r\nconst getArticleDetail = async (link) => {\r\n    const response = await got(link, {\r\n        headers: {\r\n            'user-agent': config.trueUA,\r\n        },\r\n    });\r\n    const $ = cleanDom(load(response.data));\r\n\r\n    const title = $('.content-head h2').text().trim();\r\n    const author = $('.content-persons p span:last').text().trim();\r\n    const pubDate = parseDate($('.content-time').text().trim(), 'YYYY-MM-DD');\r\n\r\n    const description = $('div[class=content-list-box]').html();\r\n    const category = $('.content-tags a[rel=\"tag\"]')\r\n        .toArray()\r\n        .map((item) => $(item).text().trim());\r\n    return new ArticleDetail(title, author, pubDate, description, category);\r\n};\r\nclass ArticleDetail {\r\n    constructor(title, author, pubDate, description, category) {\r\n        this.title = title;\r\n        this.author = author;\r\n        this.pubDate = pubDate;\r\n        this.description = description;\r\n        this.category = category;\r\n    }\r\n}\r\n\r\nexport default {\r\n    siteLink,\r\n    cleanDom,\r\n    getArticleDetail,\r\n    ArticleDetail,\r\n    trueUA: config.trueUA,\r\n};\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport utils from './utils';\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    radar: [\r\n        {\r\n            source: ['chinafactcheck.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['kdanfly'],\r\n    handler,\r\n    url: 'chinafactcheck.com/',\r\n};\r\n\r\nasync function handler() {\r\n    const response = await got(utils.siteLink, {\r\n        headers: {\r\n            'user-agent': utils.trueUA,\r\n        },\r\n    });\r\n    const $ = load(response.data);\r\n\r\n    const articlesLink = $('.post-info-box .post-thumb a')\r\n        .toArray()\r\n        .map((item) => ({ link: $(item).attr('href') }));\r\n\r\n    const articles = await Promise.all(\r\n        articlesLink.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { title, author, pubDate, description, category } = await utils.getArticleDetail(item.link);\r\n\r\n                item.title = title;\r\n                item.author = author;\r\n                item.pubDate = pubDate;\r\n                item.description = description;\r\n                item.category = category;\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        link: utils.siteLink,\r\n        item: articles,\r\n    };\r\n}\r\n"],"mappings":"yXAKA,MAEM,EAAY,IACd,EAAI,YAAY,WAAW,SAC3B,EAAI,MAAM,SACV,EAAI,cAAc,SAClB,EAAI,QAAQ,MAAM,EAAG,IAAO,CACpB,EAAI,GAAI,OAAO,SAAW,UAC1B,EAAI,GAAI,WAGhB,EAAI,WAAW,SACf,EAAI,KAAK,MAAM,EAAG,IAAO,CACjB,EAAI,GAAI,OAAO,SAAW,IAC1B,EAAI,GAAI,WAGT,GAGL,EAAmB,KAAO,IAAS,CACrC,IAAM,EAAW,MAAME,EAAI,EAAM,CAC7B,QAAS,CACL,aAAc,EAAO,UAGvB,EAAI,EAAS,EAAK,EAAS,OAE3B,EAAQ,EAAE,oBAAoB,OAAO,OACrC,EAAS,EAAE,gCAAgC,OAAO,OAClD,EAAU,EAAU,EAAE,iBAAiB,OAAO,OAAQ,cAEtD,EAAc,EAAE,+BAA+B,OAC/C,EAAW,EAAE,8BACd,UACA,IAAK,GAAS,EAAE,GAAM,OAAO,QAClC,OAAO,IAAI,EAAc,EAAO,EAAQ,EAAS,EAAa,IAElE,IAAM,EAAN,KAAoB,CAChB,YAAY,EAAO,EAAQ,EAAS,EAAa,EAAU,CACvD,KAAK,MAAQ,EACb,KAAK,OAAS,EACd,KAAK,QAAU,EACf,KAAK,YAAc,EACnB,KAAK,SAAW,IAIxB,EAAe,CACX,sCACA,WACA,mBACA,gBACA,OAAQ,EAAO,QCpDnB,MAAaD,EAAe,CACxB,KAAM,IACN,MAAO,CACH,CACI,OAAQ,CAAC,uBACT,OAAQ,KAGhB,KAAM,UACN,YAAa,CAAC,WACd,UACA,IAAK,uBAGT,eAAe,GAAU,CACrB,IAAM,EAAW,MAAMC,EAAIC,EAAM,SAAU,CACvC,QAAS,CACL,aAAcA,EAAM,UAGtB,EAAI,EAAK,EAAS,MAElB,EAAe,EAAE,gCAClB,UACA,IAAK,IAAU,CAAE,KAAM,EAAE,GAAM,KAAK,WAEnC,EAAW,MAAM,QAAQ,IAC3B,EAAa,IAAK,GACdC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,QAAO,SAAQ,UAAS,cAAa,YAAa,MAAMD,EAAM,iBAAiB,EAAK,MAO5F,MALA,GAAK,MAAQ,EACb,EAAK,OAAS,EACd,EAAK,QAAU,EACf,EAAK,YAAc,EACnB,EAAK,SAAW,EACT,MAKnB,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,KAAMA,EAAM,SACZ,KAAM"}