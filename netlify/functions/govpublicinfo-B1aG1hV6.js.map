{"version":3,"file":"govpublicinfo-B1aG1hV6.js","names":[],"sources":["../../lib/routes/gov/sichuan/deyang/govpublicinfo.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport timezone from '@/utils/timezone';\r\n\r\n// 各地区url信息\r\nconst basicInfoDict = {\r\n    绵竹市: {\r\n        rootUrl: 'https://www.mz.gov.cn',\r\n        infoType: {\r\n            fdzdnr: {\r\n                basicUrl: 'https://www.mz.gov.cn/info/iList.jsp?node_id=GKmzs&cat_id=15971&cur_page=1',\r\n                name: '法定主动内容',\r\n            },\r\n            gsgg: {\r\n                basicUrl: 'https://www.mz.gov.cn/info/iList.jsp?node_id=GKmzs&cat_id=24186&cur_page=1',\r\n                name: '公示公告',\r\n            },\r\n        },\r\n    },\r\n};\r\n\r\nconst getInfoUrlList = async (rootUrl, infoBasicUrl) => {\r\n    const response = await got(infoBasicUrl);\r\n    const $ = load(response.data);\r\n    const infoList = $('.list_div li')\r\n        .toArray()\r\n        .map((item) => ({\r\n            title: $('a', item).attr('title'),\r\n            url: `${rootUrl}${$('a', item).attr('href')}`,\r\n        }));\r\n    return infoList;\r\n};\r\n\r\n// 获取信息正文内容\r\nconst getInfoContent = (rootUrl, item) =>\r\n    cache.tryGet(item.url, async () => {\r\n        const response = await got(item.url);\r\n        // 部分网页会跳转其他类型网站,则不解析，直接附超链接\r\n        try {\r\n            const $ = load(response.data);\r\n            const fileList = $('#attribute > span.gk.fj > file')\r\n                .toArray()\r\n                .map((item) => ({\r\n                    name: $(item).text(),\r\n                    url: `${rootUrl}/${$(item).attr('href')}`,\r\n                }));\r\n            const rawDate = $('#attribute > span:nth-child(3)').text().split('：')[1].trim();\r\n            return {\r\n                title: $('h1').text().trim(),\r\n                id: $('#attribute > span:nth-child(1)').text().split('：')[1].trim(),\r\n                infoNum: $('#attribute > span:nth-child(2)').text().split('：')[1].trim(),\r\n                pubDate: parseDate(timezone(rawDate, +8)),\r\n                date: rawDate,\r\n                keyWord: $('#attribute > span:nth-child(6)').text().split('：')[1].trim(),\r\n                source: $('#attribute > span:nth-child(5)').text().split('：')[1].trim(),\r\n                content: $('body > section > article').html(),\r\n                file: fileList,\r\n                link: item.url,\r\n                _isCompleteInfo: true,\r\n            };\r\n        } catch {\r\n            return {\r\n                title: item.title,\r\n                link: item.url,\r\n                _isCompleteInfo: false,\r\n            };\r\n        }\r\n    });\r\n\r\nexport const route: Route = {\r\n    path: '/sichuan/deyang/govpublicinfo/:countyName/:infoType?',\r\n    categories: ['government'],\r\n    example: '/gov/sichuan/deyang/govpublicinfo/绵竹市',\r\n    parameters: { countyName: '区县名（**其他区县整改中，暂时只支持`绵竹市`**）。德阳市、绵竹市、广汉市、什邡市、中江县、罗江区、旌阳区、高新区', infoType: '信息类型。默认值:fdzdnr-“法定主动内容”' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '政府公开信息',\r\n    maintainers: ['zytomorrow'],\r\n    handler,\r\n    description: `| 法定主动内容 | 公示公告 |\r\n| :----------: | :------: |\r\n|    fdzdnr    |   gsgg   |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const countyName = ctx.req.param('countyName');\r\n    const infoType = ctx.req.param('infoType') || 'fdzdnr';\r\n    const infoBasicUrl = basicInfoDict[countyName].infoType[infoType].basicUrl;\r\n    const rootUrl = basicInfoDict[countyName].rootUrl;\r\n    const infoUrlList = await getInfoUrlList(rootUrl, infoBasicUrl);\r\n    const items = await Promise.all(infoUrlList.map((item) => getInfoContent(rootUrl, item)));\r\n\r\n    return {\r\n        title: `政府公开信息-${countyName}-${basicInfoDict[countyName].infoType[infoType].name}`,\r\n        link: infoBasicUrl,\r\n        item: items.map((item) => ({\r\n            title: item.title,\r\n            description: art(path.join(__dirname, './templates/govPublicInfo.art'), { item }),\r\n            link: item.link,\r\n            pubDate: item.pubDate,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"0gBAWA,MAAM,EAAgB,CAClB,IAAK,CACD,QAAS,wBACT,SAAU,CACN,OAAQ,CACJ,SAAU,6EACV,KAAM,UAEV,KAAM,CACF,SAAU,6EACV,KAAM,WAMhB,EAAiB,MAAO,EAAS,IAAiB,CACpD,IAAM,EAAW,MAAM,EAAI,GACrB,EAAI,EAAK,EAAS,MAClB,EAAW,EAAE,gBACd,UACA,IAAK,IAAU,CACZ,MAAO,EAAE,IAAK,GAAM,KAAK,SACzB,IAAK,GAAG,IAAU,EAAE,IAAK,GAAM,KAAK,aAE5C,OAAO,GAIL,GAAkB,EAAS,IAC7B,EAAM,OAAO,EAAK,IAAK,SAAY,CAC/B,IAAM,EAAW,MAAM,EAAI,EAAK,KAEhC,GAAI,CACA,IAAM,EAAI,EAAK,EAAS,MAClB,EAAW,EAAE,kCACd,UACA,IAAK,IAAU,CACZ,KAAM,EAAE,GAAM,OACd,IAAK,GAAG,EAAQ,GAAG,EAAE,GAAM,KAAK,aAElC,EAAU,EAAE,kCAAkC,OAAO,MAAM,KAAK,GAAG,OACzE,MAAO,CACH,MAAO,EAAE,MAAM,OAAO,OACtB,GAAI,EAAE,kCAAkC,OAAO,MAAM,KAAK,GAAG,OAC7D,QAAS,EAAE,kCAAkC,OAAO,MAAM,KAAK,GAAG,OAClE,QAAS,EAAU,EAAS,EAAS,IACrC,KAAM,EACN,QAAS,EAAE,kCAAkC,OAAO,MAAM,KAAK,GAAG,OAClE,OAAQ,EAAE,kCAAkC,OAAO,MAAM,KAAK,GAAG,OACjE,QAAS,EAAE,4BAA4B,OACvC,KAAM,EACN,KAAM,EAAK,IACX,gBAAiB,SAEjB,CACJ,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EAAK,IACX,gBAAiB,OAKpB,EAAe,CACxB,KAAM,uDACN,WAAY,CAAC,cACb,QAAS,wCACT,WAAY,CAAE,WAAY,8DAA+D,SAAU,4BACnG,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,cACd,UACA,YAAa;;8BAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAa,EAAI,IAAI,MAAM,cAC3B,EAAW,EAAI,IAAI,MAAM,aAAe,SACxC,EAAe,EAAc,GAAY,SAAS,GAAU,SAC5D,EAAU,EAAc,GAAY,QACpC,EAAc,MAAM,EAAe,EAAS,GAC5C,EAAQ,MAAM,QAAQ,IAAI,EAAY,IAAK,GAAS,EAAe,EAAS,KAElF,MAAO,CACH,MAAO,UAAU,EAAW,GAAG,EAAc,GAAY,SAAS,GAAU,OAC5E,KAAM,EACN,KAAM,EAAM,IAAK,IAAU,CACvB,MAAO,EAAK,MACZ,YAAa,EAAI,EAAA,KAAA,EAAA,wCAAuD,CAAE,SAC1E,KAAM,EAAK,KACX,QAAS,EAAK"}