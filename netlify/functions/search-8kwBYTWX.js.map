{"version":3,"file":"search-8kwBYTWX.js","names":["cache","ofetch","$","ofetch","route: Route"],"sources":["../../lib/routes/melonbooks/parser.ts","../../lib/routes/melonbooks/search.ts"],"sourcesContent":["import { type DataItem } from '@/types';\r\nimport { CheerioAPI, load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nexport function parseItems($: CheerioAPI, baseUrl: string, fetchRestrictedContent: boolean): Promise<DataItem[]> {\r\n    const list = $('div.item-list ul li')\r\n        .toArray()\r\n        .map((el) => {\r\n            const $el = $(el);\r\n            const a = $el.find('a').first();\r\n            const title = a.attr('title')!;\r\n            const link = fetchRestrictedContent ? `${a.attr('href')}&adult_view=1` : a.attr('href');\r\n            // const author = $el.find('p.search-item-author-author a').text();\r\n            const category = [$el.find('p.item-state').text()];\r\n            const image = $el.find('div.item-image img').attr('data-src');\r\n            return {\r\n                title,\r\n                link,\r\n                category,\r\n                image,\r\n                banner: image,\r\n            };\r\n        });\r\n\r\n    return Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(`${baseUrl}${item.link}`, async () => {\r\n                const res = await ofetch(`${baseUrl}${item.link}`);\r\n                const $ = load(res);\r\n                const description = $.html('div.item-page');\r\n                return {\r\n                    ...item,\r\n                    description,\r\n                };\r\n            })\r\n        )\r\n    ) as unknown as Promise<DataItem[]>;\r\n}\r\n","import { Data, Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseItems } from './parser';\r\nimport { Context } from 'hono';\r\nimport querystring from 'node:querystring';\r\n\r\nexport const handler = async (ctx: Context): Promise<Data | null> => {\r\n    const baseUrl = 'https://www.melonbooks.co.jp';\r\n    const query = ctx.req.param('query') ?? '';\r\n    const url = `${baseUrl}/search/search.php?${query}`;\r\n    const fetchRestrictedContent = querystring.parse(query).adult_view === '1';\r\n\r\n    const res = await ofetch(url);\r\n    const $ = load(res);\r\n    const items = await parseItems($, baseUrl, fetchRestrictedContent);\r\n\r\n    return {\r\n        title: '搜索结果',\r\n        link: url,\r\n        item: items,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/search/:query?',\r\n    categories: ['anime'],\r\n    example: '/melonbooks/search/name=けいおん',\r\n    parameters: { category: '链接参数，对应网址问号后的内容，不携带问号' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        nsfw: true,\r\n    },\r\n    name: '搜索结果',\r\n    maintainers: ['cokemine'],\r\n    description: `::: tip\r\n如果你期望获取限制级内容，可以添加\\`&adult_view=1\\`参数\r\n:::`,\r\n    handler,\r\n};\r\n"],"mappings":"8RAKA,SAAgB,EAAW,EAAe,EAAiB,EAAsD,CAC7G,IAAM,EAAO,EAAE,uBACV,UACA,IAAK,GAAO,CACT,IAAM,EAAM,EAAE,GACR,EAAI,EAAI,KAAK,KAAK,QAClB,EAAQ,EAAE,KAAK,SACf,EAAO,EAAyB,GAAG,EAAE,KAAK,QAAQ,eAAiB,EAAE,KAAK,QAE1E,EAAW,CAAC,EAAI,KAAK,gBAAgB,QACrC,EAAQ,EAAI,KAAK,sBAAsB,KAAK,YAClD,MAAO,CACH,QACA,OACA,WACA,QACA,OAAQ,KAIpB,OAAO,QAAQ,IACX,EAAK,IAAK,GACNA,EAAM,OAAO,GAAG,IAAU,EAAK,OAAQ,SAAY,CAC/C,IAAM,EAAM,MAAMG,EAAO,GAAG,IAAU,EAAK,QACrCD,EAAI,EAAK,GACT,EAAcA,EAAE,KAAK,iBAC3B,MAAO,CACH,GAAG,EACH,mBC1BpB,MAAa,EAAU,KAAO,IAAuC,CACjE,IAAM,EAAU,+BACV,EAAQ,EAAI,IAAI,MAAM,UAAY,GAClC,EAAM,GAAG,EAAQ,qBAAqB,IACtC,EAAyB,EAAY,MAAM,GAAO,aAAe,IAEjE,EAAM,MAAMC,EAAO,GACnB,EAAI,EAAK,GACT,EAAQ,MAAM,EAAW,EAAG,EAAS,GAE3C,MAAO,CACH,MAAO,OACP,KAAM,EACN,KAAM,IAIDC,EAAe,CACxB,KAAM,kBACN,WAAY,CAAC,SACb,QAAS,+BACT,WAAY,CAAE,SAAU,yBACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,KAAM,IAEV,KAAM,OACN,YAAa,CAAC,YACd,YAAa;;KAGb"}