import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{ofetch_default as n}from"./ofetch-Bzt0BXUH.js";import{ViewType as r}from"./types-A5bA50Mg.js";import{load as i}from"cheerio";const a=async r=>{let a=Number.parseInt(r.req.query(`limit`)??`5`,10),o=`https://aflcio.org`,s=new URL(`blog`,o).href,c=await n(s),l=i(c),u=l(`html`).attr(`lang`)??`en`,d=[];d=l(`article.article`).slice(0,a).toArray().map(e=>{let n=l(e),r=n.find(`header.container h1 a`).first(),i=r.text(),a=n.find(`div.section`).html()??``,s=n.find(`div.date-timeline time`).attr(`datetime`),c=r.attr(`href`),d=n.find(`div.date-timeline a.user`).toArray(),f=d.map(e=>{let t=l(e);return{name:t.text(),url:t.attr(`href`)?new URL(t.attr(`href`),o).href:void 0,avatar:void 0}}),p=n.find(`div.section img`).first().attr(`src`)?new URL(n.find(`div.section img`).first().attr(`src`),o).href:void 0,m=s,h={title:i,description:a,pubDate:s?t(s):void 0,link:c?new URL(c,o).href:void 0,author:f,content:{html:a,text:a},image:p,banner:p,updated:m?t(m):void 0,language:u};return h}),d=(await Promise.all(d.map(r=>r.link?e.tryGet(r.link,async()=>{let e=await n(r.link),a=i(e),s=a(`header.article-header h1`).text(),c=a(`div.section-article-body`).html()??``,l=a(`time`).attr(`datetime`),d=a(`div.byline a[property="schema:name"]`).toArray(),f=d.map(e=>{let t=a(e);return{name:t.text(),url:t.attr(`href`)?new URL(t.attr(`href`),o).href:void 0,avatar:void 0}}),p=a(`meta[property="og:image"]`).attr(`content`),m=l,h={title:s,description:c,pubDate:l?t(l):r.pubDate,author:f,content:{html:c,text:c},image:p,banner:p,updated:m?t(m):r.updated,language:u};return{...r,...h}}):r))).filter(e=>!0);let f=l(`title`).text();return{title:f,description:f,link:s,item:d,allowEmpty:!0,image:l(`img.main-logo`).attr(`src`)?new URL(l(`img.main-logo`).attr(`src`),o).href:void 0,author:f.split(/\|/).pop(),language:u,id:s}},o={path:`/blog`,name:`Blog`,url:`aflcio.org`,maintainers:[`nczitzk`],handler:a,example:`/aflcio/blog`,parameters:void 0,description:void 0,categories:[`other`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`aflcio.org/blog`],target:`/blog`}],view:r.Articles};export{a as handler,o as route};
//# sourceMappingURL=blog-D3i8KEPU.js.map