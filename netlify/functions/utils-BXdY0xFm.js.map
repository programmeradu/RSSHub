{"version":3,"file":"utils-BXdY0xFm.js","names":["cache","ofetch"],"sources":["../../lib/routes/apnews/utils.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\n\r\nexport function removeDuplicateByKey(items, key: string) {\r\n    return [...new Map(items.map((x) => [x[key], x])).values()];\r\n}\r\n\r\nexport function fetchArticle(item) {\r\n    return cache.tryGet(item.link, async () => {\r\n        const data = await ofetch(item.link);\r\n        const $ = load(data);\r\n        if ($('#link-ld-json').length === 0) {\r\n            const gtmRaw = $('meta[name=\"gtm-dataLayer\"]').attr('content');\r\n            if (gtmRaw) {\r\n                const gtmParsed = JSON.parse(gtmRaw);\r\n                return {\r\n                    title: gtmParsed.headline,\r\n                    pubDate: parseDate(gtmParsed.publication_date),\r\n                    description: $('div.RichTextStoryBody').html() || $(':is(.VideoLead, .VideoPage-pageSubHeading)').html(),\r\n                    category: gtmParsed.tag_array.split(','),\r\n                    guid: $(\"meta[name='brightspot.contentId']\").attr('content'),\r\n                    author: gtmParsed.author,\r\n                    ...item,\r\n                };\r\n            } else {\r\n                return item;\r\n            }\r\n        }\r\n        const rawLdjson = JSON.parse($('#link-ld-json').text());\r\n        let ldjson;\r\n        if (rawLdjson['@type'] === 'NewsArticle' || (Array.isArray(rawLdjson) && rawLdjson.some((e) => e['@type'] === 'NewsArticle'))) {\r\n            // Regular(Articles, Videos)\r\n            ldjson = Array.isArray(rawLdjson) ? rawLdjson.find((e) => e['@type'] === 'NewsArticle') : rawLdjson;\r\n\r\n            $('div.Enhancement').remove();\r\n            const section = $(\"meta[property='article:section']\").attr('content');\r\n            return {\r\n                ...item,\r\n                title: ldjson.headline,\r\n                pubDate: parseDate(ldjson.datePublished),\r\n                updated: parseDate(ldjson.dateModified),\r\n                description: $('div.RichTextStoryBody').html() || $(':is(.VideoLead, .VideoPage-pageSubHeading)').html(),\r\n                category: [...(section ? [section] : []), ...(ldjson.keywords ?? [])],\r\n                guid: $(\"meta[name='brightspot.contentId']\").attr('content'),\r\n                author: ldjson.author?.map((e) => e.mainEntity),\r\n            };\r\n        } else {\r\n            // Live\r\n            ldjson = rawLdjson;\r\n\r\n            const url = new URL(item.link);\r\n            const description = url.hash ? $(url.hash).parent().find('.LiveBlogPost-body').html() : ldjson.description;\r\n            const pubDate = url.hash ? parseDate(Number.parseInt($(url.hash).parent().attr('data-posted-date-timestamp'), 10)) : parseDate(ldjson.coverageStartTime);\r\n\r\n            return {\r\n                ...item,\r\n                category: ldjson.keywords,\r\n                pubDate,\r\n                description,\r\n                guid: $(\"meta[name='brightspot.contentId']\").attr('content'),\r\n            };\r\n        }\r\n    });\r\n}\r\n"],"mappings":"8LAKA,SAAgB,EAAqB,EAAO,EAAa,CACrD,MAAO,CAAC,GAAG,IAAI,IAAI,EAAM,IAAK,GAAM,CAAC,EAAE,GAAM,KAAK,UAGtD,SAAgB,EAAa,EAAM,CAC/B,OAAOA,EAAM,OAAO,EAAK,KAAM,SAAY,CACvC,IAAM,EAAO,MAAMC,EAAO,EAAK,MACzB,EAAI,EAAK,GACf,GAAI,EAAE,iBAAiB,SAAW,EAAG,CACjC,IAAM,EAAS,EAAE,8BAA8B,KAAK,WACpD,GAAI,EAAQ,CACR,IAAM,EAAY,KAAK,MAAM,GAC7B,MAAO,CACH,MAAO,EAAU,SACjB,QAAS,EAAU,EAAU,kBAC7B,YAAa,EAAE,yBAAyB,QAAU,EAAE,8CAA8C,OAClG,SAAU,EAAU,UAAU,MAAM,KACpC,KAAM,EAAE,qCAAqC,KAAK,WAClD,OAAQ,EAAU,OAClB,GAAG,QAGP,OAAO,EAGf,IAAM,EAAY,KAAK,MAAM,EAAE,iBAAiB,QAC5C,EACJ,GAAI,EAAU,WAAa,eAAkB,MAAM,QAAQ,IAAc,EAAU,KAAM,GAAM,EAAE,WAAa,eAAiB,CAE3H,EAAS,MAAM,QAAQ,GAAa,EAAU,KAAM,GAAM,EAAE,WAAa,eAAiB,EAE1F,EAAE,mBAAmB,SACrB,IAAM,EAAU,EAAE,oCAAoC,KAAK,WAC3D,MAAO,CACH,GAAG,EACH,MAAO,EAAO,SACd,QAAS,EAAU,EAAO,eAC1B,QAAS,EAAU,EAAO,cAC1B,YAAa,EAAE,yBAAyB,QAAU,EAAE,8CAA8C,OAClG,SAAU,CAAC,GAAI,EAAU,CAAC,GAAW,GAAK,GAAI,EAAO,UAAY,IACjE,KAAM,EAAE,qCAAqC,KAAK,WAClD,OAAQ,EAAO,QAAQ,IAAK,GAAM,EAAE,iBAErC,CAEH,EAAS,EAET,IAAM,EAAM,IAAI,IAAI,EAAK,MACnB,EAAc,EAAI,KAAO,EAAE,EAAI,MAAM,SAAS,KAAK,sBAAsB,OAAS,EAAO,YACzF,EAAU,EAAI,KAAO,EAAU,OAAO,SAAS,EAAE,EAAI,MAAM,SAAS,KAAK,8BAA+B,KAAO,EAAU,EAAO,mBAEtI,MAAO,CACH,GAAG,EACH,SAAU,EAAO,SACjB,UACA,cACA,KAAM,EAAE,qCAAqC,KAAK"}