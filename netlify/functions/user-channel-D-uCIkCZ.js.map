{"version":3,"file":"user-channel-D-uCIkCZ.js","names":["route: Route","cache","response","got","cacheIn","utils"],"sources":["../../lib/routes/bilibili/user-channel.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport cacheIn from './cache';\r\nimport utils from './utils';\r\n\r\nconst notFoundData = {\r\n    title: '此 bilibili 频道不存在',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/user/channel/:uid/:sid/:embed?',\r\n    categories: ['social-media'],\r\n    example: '/bilibili/user/channel/2267573/396050',\r\n    parameters: { uid: '用户 id, 可在 UP 主主页中找到', sid: '频道 id, 可在频道的 URL 中找到', embed: '默认为开启内嵌视频, 任意值为关闭' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'UP 主频道的视频列表',\r\n    maintainers: ['weirongxu'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const uid = Number.parseInt(ctx.req.param('uid'));\r\n    const sid = Number.parseInt(ctx.req.param('sid'));\r\n    const embed = !ctx.req.param('embed');\r\n    const limit = ctx.req.query('limit') ?? 25;\r\n\r\n    const link = `https://space.bilibili.com/${uid}/channel/seriesdetail?sid=${sid}`;\r\n\r\n    // 获取频道信息\r\n    const channelInfoLink = `https://api.bilibili.com/x/series/series?series_id=${sid}`;\r\n    const channelInfo = await cache.tryGet(channelInfoLink, async () => {\r\n        const response = await got(channelInfoLink, {\r\n            headers: {\r\n                Referer: link,\r\n            },\r\n        });\r\n        // 频道不存在时返回 null\r\n        return response.data.data;\r\n    });\r\n\r\n    if (!channelInfo) {\r\n        return notFoundData;\r\n    }\r\n    const [userName, face] = await cacheIn.getUsernameAndFaceFromUID(uid);\r\n    const host = `https://api.bilibili.com/x/series/archives?mid=${uid}&series_id=${sid}&only_normal=true&sort=desc&pn=1&ps=${limit}`;\r\n\r\n    const response = await got(host, {\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n\r\n    const data = response.data.data;\r\n    if (!data.archives) {\r\n        return notFoundData;\r\n    }\r\n\r\n    return {\r\n        title: `${userName} 的 bilibili 频道 ${channelInfo.meta.name}`,\r\n        link,\r\n        description: `${userName} 的 bilibili 频道`,\r\n        image: face,\r\n        logo: face,\r\n        icon: face,\r\n        item: data.archives.map((item) => ({\r\n            title: item.title,\r\n            description: utils.renderUGCDescription(embed, item.pic, '', item.aid, undefined, item.bvid),\r\n            pubDate: parseDate(item.pubdate, 'X'),\r\n            link: item.pubdate > utils.bvidTime && item.bvid ? `https://www.bilibili.com/video/${item.bvid}` : `https://www.bilibili.com/video/av${item.aid}`,\r\n            author: userName,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"oiBAOA,MAAM,EAAe,CACjB,MAAO,oBAGEA,EAAe,CACxB,KAAM,kCACN,WAAY,CAAC,gBACb,QAAS,wCACT,WAAY,CAAE,IAAK,sBAAuB,IAAK,uBAAwB,MAAO,qBAC9E,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,cACN,YAAa,CAAC,aACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,OAAO,SAAS,EAAI,IAAI,MAAM,QACpC,EAAM,OAAO,SAAS,EAAI,IAAI,MAAM,QACpC,EAAQ,CAAC,EAAI,IAAI,MAAM,SACvB,EAAQ,EAAI,IAAI,MAAM,UAAY,GAElC,EAAO,8BAA8B,EAAI,4BAA4B,IAGrE,EAAkB,sDAAsD,IACxE,EAAc,MAAMC,EAAM,OAAO,EAAiB,SAAY,CAChE,IAAMC,EAAW,MAAMC,EAAI,EAAiB,CACxC,QAAS,CACL,QAAS,KAIjB,OAAOD,EAAS,KAAK,OAGzB,GAAI,CAAC,EACD,OAAO,EAEX,GAAM,CAAC,EAAU,GAAQ,MAAME,EAAQ,0BAA0B,GAC3D,EAAO,kDAAkD,EAAI,aAAa,EAAI,sCAAsC,IAEpH,EAAW,MAAMD,EAAI,EAAM,CAC7B,QAAS,CACL,QAAS,KAIX,EAAO,EAAS,KAAK,KAK3B,OAJK,EAAK,SAIH,CACH,MAAO,GAAG,EAAS,iBAAiB,EAAY,KAAK,OACrD,OACA,YAAa,GAAG,EAAS,gBACzB,MAAO,EACP,KAAM,EACN,KAAM,EACN,KAAM,EAAK,SAAS,IAAK,IAAU,CAC/B,MAAO,EAAK,MACZ,YAAaE,EAAM,qBAAqB,EAAO,EAAK,IAAK,GAAI,EAAK,IAAK,IAAA,GAAW,EAAK,MACvF,QAAS,EAAU,EAAK,QAAS,KACjC,KAAM,EAAK,QAAUA,EAAM,UAAY,EAAK,KAAO,kCAAkC,EAAK,OAAS,oCAAoC,EAAK,MAC5I,OAAQ,MAfL"}