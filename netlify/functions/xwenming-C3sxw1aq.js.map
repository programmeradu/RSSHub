{"version":3,"file":"xwenming-C3sxw1aq.js","names":["limit: number","baseUrl: string","ofetch","categoryId: number | undefined","categorySlug: string | undefined","targetUrl: string","$: CheerioAPI","items: DataItem[]","title: string","description: string | undefined","pubDate: number | string","linkUrl: string | undefined","categories: string[]","authors: DataItem['author']","guid: string","image: string | undefined","updated: number | string","processedItem: DataItem","route: Route"],"sources":["../../lib/routes/xwenming/index.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { type CheerioAPI, load } from 'cheerio';\r\nimport { type Context } from 'hono';\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const { category } = ctx.req.param();\r\n    const limit: number = Number.parseInt(ctx.req.query('limit') ?? '50', 10);\r\n\r\n    const apiSlug = 'wp-json/wp/v2';\r\n    const baseUrl: string = 'https://www.xwenming.com';\r\n\r\n    const apiUrl = new URL(`${apiSlug}/posts`, baseUrl).href;\r\n    const apiSearchUrl = new URL(`${apiSlug}/categories`, baseUrl).href;\r\n\r\n    const searchResponse = await ofetch(apiSearchUrl, {\r\n        query: {\r\n            search: category,\r\n        },\r\n    });\r\n\r\n    const categoryObj = searchResponse.find((c) => c.slug === category || c.name === category);\r\n    const categoryId: number | undefined = categoryObj?.id ?? undefined;\r\n    const categorySlug: string | undefined = categoryObj?.slug ?? undefined;\r\n\r\n    const response = await ofetch(apiUrl, {\r\n        query: {\r\n            _embed: 'true',\r\n            per_page: limit,\r\n            categories: categoryId,\r\n        },\r\n    });\r\n\r\n    const targetUrl: string = new URL(categorySlug ? `index.php/category/${categorySlug}` : '', baseUrl).href;\r\n\r\n    const targetResponse = await ofetch(targetUrl);\r\n    const $: CheerioAPI = load(targetResponse);\r\n    const language = $('html').attr('lang') ?? 'zh';\r\n\r\n    const items: DataItem[] = response.slice(0, limit).map((item): DataItem => {\r\n        const title: string = item.title?.rendered ?? item.title;\r\n        const description: string | undefined = item.content.rendered;\r\n        const pubDate: number | string = item.date_gmt;\r\n        const linkUrl: string | undefined = item.link;\r\n\r\n        const terminologies = item._embedded?.['wp:term'];\r\n\r\n        const categories: string[] = terminologies?.flat().map((c) => c.name) ?? [];\r\n        const authors: DataItem['author'] =\r\n            item._embedded?.author.map((author) => ({\r\n                name: author.name,\r\n                url: author.link,\r\n                avatar: author.avatar_urls?.['96'] ?? author.avatar_urls?.['48'] ?? author.avatar_urls?.['24'] ?? undefined,\r\n            })) ?? [];\r\n        const guid: string = item.guid?.rendered ?? item.guid;\r\n        const image: string | undefined = item._embedded?.['wp:featuredmedia']?.[0].source_url ?? undefined;\r\n        const updated: number | string = item.modified_gmt ?? pubDate;\r\n\r\n        const processedItem: DataItem = {\r\n            title,\r\n            description,\r\n            pubDate: pubDate ? parseDate(pubDate) : undefined,\r\n            link: linkUrl ?? guid,\r\n            category: categories,\r\n            author: authors,\r\n            guid,\r\n            id: guid,\r\n            content: {\r\n                html: description,\r\n                text: description,\r\n            },\r\n            image,\r\n            banner: image,\r\n            updated: updated ? parseDate(updated) : undefined,\r\n            language,\r\n        };\r\n\r\n        return processedItem;\r\n    });\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        description: $('meta[name=\"description\"]').attr('content'),\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: $('meta[name=\"msapplication-TileImage\"]').attr('content'),\r\n        language,\r\n        id: targetUrl,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    name: '分类',\r\n    url: 'www.xwenming.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/xwenming/news',\r\n    parameters: {\r\n        category: {\r\n            description: '分类，默认为全部，可在对应分类页 URL 中找到',\r\n            options: [\r\n                {\r\n                    label: '全部',\r\n                    value: '',\r\n                },\r\n                {\r\n                    label: '科技前沿',\r\n                    value: 'news',\r\n                },\r\n                {\r\n                    label: '疑难杂症',\r\n                    value: 'solve',\r\n                },\r\n                {\r\n                    label: '通知专栏',\r\n                    value: 'notice',\r\n                },\r\n                {\r\n                    label: '未分类',\r\n                    value: 'uncategorized',\r\n                },\r\n            ],\r\n        },\r\n    },\r\n    description: `:::tip\r\n订阅 [科技前沿](https://www.xwenming.com/index.php/category/news)，其源网址为 \\`https://www.xwenming.com/index.php/category/news\\`，请参考该 URL 指定部分构成参数，此时路由为 [\\`/xwenming/category/news\\`](https://rsshub.app/xwenming/category/news) 或 [\\`/xwenming/category/科技前沿\\`](https://rsshub.app/xwenming/category/科技前沿)。\r\n:::\r\n\r\n| 分类                                                                | ID                                                                  |\r\n| ------------------------------------------------------------------- | ------------------------------------------------------------------- |\r\n| [全部](https://www.xwenming.com)                                    | [<空>](https://rsshub.app/xwenming)                                 |\r\n| [科技前沿](https://www.xwenming.com/index.php/category/news)        | [news](https://rsshub.app/xwenming/category/news)                   |\r\n| [疑难杂症](https://www.xwenming.com/index.php/category/solve)       | [solve](https://rsshub.app/xwenming/category/solve)                 |\r\n| [通知专栏](https://www.xwenming.com/index.php/category/notice)      | [notice](https://rsshub.app/xwenming/category/notice)               |\r\n| [未分类](https://www.xwenming.com/index.php/category/uncategorized) | [uncategorized](https://rsshub.app/xwenming/category/uncategorized) |\r\n`,\r\n    categories: ['new-media'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.xwenming.com', 'www.xwenming.com/index.php/category/:category'],\r\n            target: '/:category',\r\n        },\r\n        {\r\n            title: '全部',\r\n            source: ['www.xwenming.com'],\r\n            target: '/',\r\n        },\r\n        {\r\n            title: '科技前沿',\r\n            source: ['www.xwenming.com/index.php/category/news'],\r\n            target: '/news',\r\n        },\r\n        {\r\n            title: '疑难杂症',\r\n            source: ['www.xwenming.com/index.php/category/solve'],\r\n            target: '/solve',\r\n        },\r\n        {\r\n            title: '通知专栏',\r\n            source: ['www.xwenming.com/index.php/category/notice'],\r\n            target: '/notice',\r\n        },\r\n        {\r\n            title: '未分类',\r\n            source: ['www.xwenming.com/index.php/category/uncategorized'],\r\n            target: '/uncategorized',\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n};\r\n"],"mappings":"8SAQA,MAAa,EAAU,KAAO,IAAgC,CAC1D,GAAM,CAAE,YAAa,EAAI,IAAI,QACvBA,EAAgB,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IAEhE,EAAU,gBACVC,EAAkB,2BAElB,EAAS,IAAI,IAAI,GAAG,EAAQ,QAAS,GAAS,KAC9C,EAAe,IAAI,IAAI,GAAG,EAAQ,aAAc,GAAS,KAEzD,EAAiB,MAAMC,EAAO,EAAc,CAC9C,MAAO,CACH,OAAQ,KAIV,EAAc,EAAe,KAAM,GAAM,EAAE,OAAS,GAAY,EAAE,OAAS,GAC3EC,EAAiC,GAAa,IAAM,IAAA,GACpDC,EAAmC,GAAa,MAAQ,IAAA,GAExD,EAAW,MAAMF,EAAO,EAAQ,CAClC,MAAO,CACH,OAAQ,OACR,SAAU,EACV,WAAY,KAIdG,EAAoB,IAAI,IAAI,EAAe,sBAAsB,IAAiB,GAAI,GAAS,KAE/F,EAAiB,MAAMH,EAAO,GAC9BI,EAAgB,EAAK,GACrB,EAAW,EAAE,QAAQ,KAAK,SAAW,KAErCC,EAAoB,EAAS,MAAM,EAAG,GAAO,IAAK,GAAmB,CACvE,IAAMC,EAAgB,EAAK,OAAO,UAAY,EAAK,MAC7CC,EAAkC,EAAK,QAAQ,SAC/CC,EAA2B,EAAK,SAChCC,EAA8B,EAAK,KAEnC,EAAgB,EAAK,YAAY,WAEjCC,EAAuB,GAAe,OAAO,IAAK,GAAM,EAAE,OAAS,GACnEC,EACF,EAAK,WAAW,OAAO,IAAK,IAAY,CACpC,KAAM,EAAO,KACb,IAAK,EAAO,KACZ,OAAQ,EAAO,cAAc,OAAS,EAAO,cAAc,OAAS,EAAO,cAAc,OAAS,IAAA,OAC/F,GACLC,EAAe,EAAK,MAAM,UAAY,EAAK,KAC3CC,EAA4B,EAAK,YAAY,sBAAsB,GAAG,YAAc,IAAA,GACpFC,EAA2B,EAAK,cAAgB,EAEhDC,EAA0B,CAC5B,QACA,cACA,QAAS,EAAU,EAAU,GAAW,IAAA,GACxC,KAAM,GAAW,EACjB,SAAU,EACV,OAAQ,EACR,OACA,GAAI,EACJ,QAAS,CACL,KAAM,EACN,KAAM,GAEV,QACA,OAAQ,EACR,QAAS,EAAU,EAAU,GAAW,IAAA,GACxC,YAGJ,OAAO,IAGX,MAAO,CACH,MAAO,EAAE,SAAS,OAClB,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,EACN,KAAM,EACN,WAAY,GACZ,MAAO,EAAE,wCAAwC,KAAK,WACtD,WACA,GAAI,IAICC,EAAe,CACxB,KAAM,cACN,KAAM,KACN,IAAK,mBACL,YAAa,CAAC,WACd,UACA,QAAS,iBACT,WAAY,CACR,SAAU,CACN,YAAa,2BACb,QAAS,CACL,CACI,MAAO,KACP,MAAO,IAEX,CACI,MAAO,OACP,MAAO,QAEX,CACI,MAAO,OACP,MAAO,SAEX,CACI,MAAO,OACP,MAAO,UAEX,CACI,MAAO,MACP,MAAO,oBAKvB,YAAa;;;;;;;;;;;EAYb,WAAY,CAAC,aACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,mBAAoB,iDAC7B,OAAQ,cAEZ,CACI,MAAO,KACP,OAAQ,CAAC,oBACT,OAAQ,KAEZ,CACI,MAAO,OACP,OAAQ,CAAC,4CACT,OAAQ,SAEZ,CACI,MAAO,OACP,OAAQ,CAAC,6CACT,OAAQ,UAEZ,CACI,MAAO,OACP,OAAQ,CAAC,8CACT,OAAQ,WAEZ,CACI,MAAO,MACP,OAAQ,CAAC,qDACT,OAAQ,mBAGhB,KAAM,EAAS"}