{"version":3,"file":"utils-DsTiVWfI.js","names":[],"sources":["../../lib/routes/hk01/utils.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst rootUrl = 'https://hk01.com';\r\nconst apiRootUrl = 'https://web-data.api.hk01.com';\r\n\r\nconst ProcessItems = (items, limit, tryGet) =>\r\n    Promise.all(\r\n        items\r\n            .filter((item) => item.type !== 2)\r\n            .slice(0, limit ? Number.parseInt(limit) : 50)\r\n            .map((item) => ({\r\n                title: item.data.title,\r\n                link: `${rootUrl}/sns/article/${item.data.articleId}`,\r\n                pubDate: parseDate(item.data.publishTime * 1000),\r\n                category: item.data.tags.map((t) => t.tagName),\r\n                author: item.data.authors.map((a) => a.publishName).join(', '),\r\n            }))\r\n            .map((item) =>\r\n                tryGet(item.link, async () => {\r\n                    const detailResponse = await got({\r\n                        method: 'get',\r\n                        url: item.link,\r\n                    });\r\n\r\n                    const content = JSON.parse(detailResponse.data.match(/\"__NEXT_DATA__\" type=\"application\\/json\">({\"props\":.*})<\\/script>/)[1]);\r\n\r\n                    item.description = art(path.join(__dirname, 'templates/description.art'), {\r\n                        image: content.props.initialProps.pageProps.article.originalImage.cdnUrl,\r\n                        teasers: content.props.initialProps.pageProps.article.teaser,\r\n                        blocks: content.props.initialProps.pageProps.article.blocks,\r\n                    });\r\n\r\n                    return item;\r\n                })\r\n            )\r\n    );\r\n\r\nexport { rootUrl, apiRootUrl, ProcessItems };\r\n"],"mappings":"qPAKA,MAAM,EAAU,mBACV,EAAa,gCAEb,GAAgB,EAAO,EAAO,IAChC,QAAQ,IACJ,EACK,OAAQ,GAAS,EAAK,OAAS,GAC/B,MAAM,EAAG,EAAQ,OAAO,SAAS,GAAS,IAC1C,IAAK,IAAU,CACZ,MAAO,EAAK,KAAK,MACjB,KAAM,GAAG,EAAQ,eAAe,EAAK,KAAK,YAC1C,QAAS,EAAU,EAAK,KAAK,YAAc,KAC3C,SAAU,EAAK,KAAK,KAAK,IAAK,GAAM,EAAE,SACtC,OAAQ,EAAK,KAAK,QAAQ,IAAK,GAAM,EAAE,aAAa,KAAK,SAE5D,IAAK,GACF,EAAO,EAAK,KAAM,SAAY,CAC1B,IAAM,EAAiB,MAAM,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGR,EAAU,KAAK,MAAM,EAAe,KAAK,MAAM,qEAAqE,IAQ1H,MANA,GAAK,YAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACtE,MAAO,EAAQ,MAAM,aAAa,UAAU,QAAQ,cAAc,OAClE,QAAS,EAAQ,MAAM,aAAa,UAAU,QAAQ,OACtD,OAAQ,EAAQ,MAAM,aAAa,UAAU,QAAQ,SAGlD"}