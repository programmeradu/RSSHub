{"version":3,"file":"offer-vR5r9NdI.js","names":[],"sources":["../../lib/routes/1point3acres/offer.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { art } from '@/utils/render';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/offer/:year?/:major?/:school?',\r\n    categories: ['bbs'],\r\n    example: '/1point3acres/offer/12/null/CMU',\r\n    parameters: { year: '录取年份  id，空为null', major: '录取专业 id，空为null', school: '录取学校 id，空为null' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['offer.1point3acres.com/'],\r\n            target: '/offer',\r\n        },\r\n    ],\r\n    name: '录取结果',\r\n    maintainers: ['EthanWng97'],\r\n    handler,\r\n    url: 'offer.1point3acres.com/',\r\n    description: `::: tip 三个 id 获取方式\r\n  1.  打开 [https://offer.1point3acres.com](https://offer.1point3acres.com)\r\n  2.  打开控制台\r\n  3.  切换到 Network 面板\r\n  4.  点击 搜索 按钮\r\n  5.  点击 results?ps=15\\&pg=1 POST 请求\r\n  6.  找到 Request Payload 请求参数，例如 \\`filters: {planyr: \"13\", planmajor: \"1\", outname_w: \"ACADIAU\"}\\` ，则三个 id 分别为: 13,1,ACADIAU\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    // year 2017-2022\r\n    // 2017:6   2018:11   2019:12   2020:13   2021:14   2022:15\r\n    // CS:1     MIS:2\r\n    const { year = 'null', major = 'null', school = 'null' } = ctx.req.param();\r\n    // const filter = 'filters: {planyr: \"12\", planmajor: \"1\", outname_w: \"CMU\"}';\r\n    const responseBasic = await got.post('https://api.1point3acres.com/offer/results', {\r\n        searchParams: {\r\n            ps: 15,\r\n            pg: 1,\r\n        },\r\n        json: {\r\n            filters: {\r\n                planyr: year === 'null' ? undefined : year,\r\n                planmajor: major === 'null' ? undefined : major,\r\n                outname_w: school === 'null' ? undefined : school,\r\n            },\r\n        },\r\n    });\r\n\r\n    const data = responseBasic.data.results;\r\n    // data.id-> 访问offer具体信息->获取 data.tid\r\n    // if (data.id !== 0) {\r\n    //     out = await Promise.all(\r\n    //         data.map(async (item) => {\r\n    //             var gettidresponse = await got({\r\n    //              method: 'get',\r\n    //              url: 'https://api.1point3acres.com/offer/results/'+ item.id +  '/backgrounds',\r\n    //              headers: {\r\n    //                  authorization: 'eyJhbGciOiJIUzUxMiIsImlhdCI6MTU3Njk5Njc5OSwiZXhwIjoxNTg0ODU5MTk5fQ.eyJ1aWQiOjQ1NzQyN30.0ei5UE6OgLBzN2_IS7xUIbIfW_S1Wzl42q2UeusbboxuzvctO_4Mz6YRr6f0PBLUVZMETxt8F0_4-yqIJ3_kUQ',\r\n    //              },\r\n    //          });\r\n    //         var tid = gettidresponse.data.background.tid;\r\n    //         //https: //www.1point3acres.com/bbs/thread-581177-1-1.html\r\n    //         console.log(tid);\r\n    //         const threadlink = 'https://www.1point3acres.com/bbs/thread-' + tid + '-1-1.html';\r\n    //         console.log(threadlink);\r\n    //         return threadlink;\r\n    //         })\r\n    //     );\r\n    // }\r\n    // let responseBasic_1;\r\n    // responseBasic_1 = await got({\r\n    //     method: 'get',\r\n    //     url: `https://api.1point3acres.com/offer/results/A7m20e4g/backgrounds`,\r\n    //     headers: {\r\n    //         authorization: `eyJhbGciOiJIUzUxMiIsImlhdCI6MTU3Njk5Njc5OSwiZXhwIjoxNTg0ODU5MTk5fQ.eyJ1aWQiOjQ1NzQyN30.0ei5UE6OgLBzN2_IS7xUIbIfW_S1Wzl42q2UeusbboxuzvctO_4Mz6YRr6f0PBLUVZMETxt8F0_4-yqIJ3_kUQ`,\r\n    //     },\r\n    // });\r\n    // const tid = responseBasic_1.data.background.tid;\r\n    return {\r\n        title: '录取结果 - 一亩三分地',\r\n        link: 'https://offer.1point3acres.com',\r\n        item: data.map((item) => ({\r\n            title: `${item.planyr}年${item.planmajor}@${item.outname_w}：${item.result} - 一亩三分地`,\r\n            description: art(path.join(__dirname, 'templates/offer.art'), {\r\n                item,\r\n            }),\r\n            pubDate: parseDate(item.dateline, 'X'),\r\n            link: 'https://offer.1point3acres.com',\r\n            guid: `1point3acres:offer:${year}:${major}:${school}:${item.id}`,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"qYAOA,MAAa,EAAe,CACxB,KAAM,iCACN,WAAY,CAAC,OACb,QAAS,kCACT,WAAY,CAAE,KAAM,kBAAmB,MAAO,iBAAkB,OAAQ,kBACxE,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,2BACT,OAAQ,WAGhB,KAAM,OACN,YAAa,CAAC,cACd,UACA,IAAK,0BACL,YAAa;;;;;;;MAUjB,eAAe,EAAQ,EAAK,CAIxB,GAAM,CAAE,OAAO,OAAQ,QAAQ,OAAQ,SAAS,QAAW,EAAI,IAAI,QAE7D,EAAgB,MAAM,EAAI,KAAK,6CAA8C,CAC/E,aAAc,CACV,GAAI,GACJ,GAAI,GAER,KAAM,CACF,QAAS,CACL,OAAQ,IAAS,OAAS,IAAA,GAAY,EACtC,UAAW,IAAU,OAAS,IAAA,GAAY,EAC1C,UAAW,IAAW,OAAS,IAAA,GAAY,MAKjD,EAAO,EAAc,KAAK,QA8BhC,MAAO,CACH,MAAO,eACP,KAAM,iCACN,KAAM,EAAK,IAAK,IAAU,CACtB,MAAO,GAAG,EAAK,OAAO,GAAG,EAAK,UAAU,GAAG,EAAK,UAAU,GAAG,EAAK,OAAO,UACzE,YAAa,EAAI,EAAA,KAAA,EAAA,gCAA6C,CAC1D,SAEJ,QAAS,EAAU,EAAK,SAAU,KAClC,KAAM,iCACN,KAAM,sBAAsB,EAAK,GAAG,EAAM,GAAG,EAAO,GAAG,EAAK"}