{"version":3,"file":"common-CYM99kjd.js","names":["got","cache","response","$","category","item"],"sources":["../../lib/routes/dnaindia/common.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport logger from '@/utils/logger';\r\n\r\nexport async function handler(ctx) {\r\n    const { category, topic } = ctx.req.param();\r\n    const baseUrl = 'https://www.dnaindia.com';\r\n    let route;\r\n    if (category) {\r\n        route = `/${category}`;\r\n    } else if (topic) {\r\n        route = `/topic/${topic}`;\r\n    } else {\r\n        logger.error('Invalid URL');\r\n    }\r\n    const link = `${baseUrl}${route}`;\r\n    const { data: response } = await got(link);\r\n    const $ = load(response);\r\n\r\n    const listItems = $('div.list-news')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const a = item.find('div.explainer-subtext a');\r\n            return {\r\n                title: a.text(),\r\n                link: `${baseUrl}${a.attr('href')}`,\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        listItems.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n\r\n                const itunes_item_image = $('div.article-img img').attr('src');\r\n                const category = $('div.tags ul li')\r\n                    .toArray()\r\n                    .map((item) => $(item).find('a').text());\r\n                // Process date\r\n                const timeText = $('p.dna-update').text();\r\n                const dateMatch = timeText.match(/Updated\\s*:\\s*([\\w\\s,:\\d]+?)(?:\\s*\\||$)/);\r\n                let time = dateMatch ? dateMatch[1].trim() : '';\r\n                time = time.replace(/\\s+IST$/, '');\r\n                const pubDate = timezone(parseDate(time), +5.5);\r\n                // Get author information\r\n                const authorMeta = $('meta[name=\"author\"]').attr('content');\r\n                const author = authorMeta || 'DNA Web Team';\r\n\r\n                // Process description\r\n                const description = $('div.article-description')\r\n                    .clone()\r\n                    .children('div')\r\n                    .remove()\r\n                    .end()\r\n                    .toArray()\r\n                    .map((element) => $(element).html())\r\n                    .join('');\r\n\r\n                // Return all properties at once\r\n                return {\r\n                    ...item,\r\n                    itunes_item_image,\r\n                    category,\r\n                    pubDate,\r\n                    author,\r\n                    description,\r\n                };\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: 'DNA India',\r\n        link,\r\n        item: items,\r\n        description: 'Latest News on dnaIndia.com',\r\n        logo: 'https://cdn.dnaindia.com/sites/all/themes/dnaindia/favicon-1016.ico',\r\n        icon: 'https://cdn.dnaindia.com/sites/all/themes/dnaindia/favicon-1016.ico',\r\n        language: 'en-us',\r\n    };\r\n}\r\n"],"mappings":"gSAOA,eAAsB,EAAQ,EAAK,CAC/B,GAAM,CAAE,WAAU,SAAU,EAAI,IAAI,QAC9B,EAAU,2BACZ,EACA,EACA,EAAQ,IAAI,IACL,EACP,EAAQ,UAAU,IAElB,EAAO,MAAM,eAEjB,IAAM,EAAO,GAAG,IAAU,IACpB,CAAE,KAAM,GAAa,MAAMA,EAAI,GAC/B,EAAI,EAAK,GAET,EAAY,EAAE,iBACf,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAI,EAAK,KAAK,2BACpB,MAAO,CACH,MAAO,EAAE,OACT,KAAM,GAAG,IAAU,EAAE,KAAK,aAIhC,EAAQ,MAAM,QAAQ,IACxB,EAAU,IAAK,GACXC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAET,EAAoBC,EAAE,uBAAuB,KAAK,OAClDC,EAAWD,EAAE,kBACd,UACA,IAAK,GAASA,EAAEE,GAAM,KAAK,KAAK,QAE/B,EAAWF,EAAE,gBAAgB,OAC7B,EAAY,EAAS,MAAM,2CAC7B,EAAO,EAAY,EAAU,GAAG,OAAS,GAC7C,EAAO,EAAK,QAAQ,UAAW,IAC/B,IAAM,EAAU,EAAS,EAAU,GAAO,KAEpC,EAAaA,EAAE,uBAAuB,KAAK,WAC3C,EAAS,GAAc,eAGvB,EAAcA,EAAE,2BACjB,QACA,SAAS,OACT,SACA,MACA,UACA,IAAK,GAAYA,EAAE,GAAS,QAC5B,KAAK,IAGV,MAAO,CACH,GAAG,EACH,oBACA,SAAA,EACA,UACA,SACA,mBAMhB,MAAO,CACH,MAAO,YACP,OACA,KAAM,EACN,YAAa,8BACb,KAAM,sEACN,KAAM,sEACN,SAAU"}