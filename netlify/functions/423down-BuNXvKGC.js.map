{"version":3,"file":"423down-BuNXvKGC.js","names":[],"sources":["../../lib/routes/423down/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = '' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 18;\r\n\r\n    const domain = '423down.com';\r\n    const rootUrl = `https://www.${domain}`;\r\n    const currentUrl = new URL(category, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('ul.excerpt li')\r\n        .toArray()\r\n        .filter((item) => {\r\n            item = $(item);\r\n\r\n            const link = item.find('h2 a').prop('href');\r\n\r\n            return new RegExp(domain).test(link);\r\n        })\r\n        .slice(0, limit)\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const title = item.find('h2').text();\r\n            const image = item.find('a.pic img').prop('src');\r\n            const description = art(path.join(__dirname, 'templates/description.art'), {\r\n                images: image\r\n                    ? [\r\n                          {\r\n                              src: image,\r\n                              alt: title,\r\n                          },\r\n                      ]\r\n                    : undefined,\r\n                intro: item.find('div.note').text(),\r\n            });\r\n\r\n            return {\r\n                title,\r\n                description,\r\n                pubDate: parseDate(item.find('span.time').text(), 'MM-DD'),\r\n                link: item.find('h2 a').prop('href'),\r\n                category: item\r\n                    .find('span.cat a')\r\n                    .toArray()\r\n                    .map((c) => $(c).text()),\r\n                content: {\r\n                    html: description,\r\n                    text: item.find('div.note').text(),\r\n                },\r\n                image,\r\n                banner: image,\r\n                language,\r\n                enclosure_url: image,\r\n                enclosure_type: image ? `image/${image.split(/\\./).pop()}` : undefined,\r\n                enclosure_title: title,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const title = $$('h1.meta-tit a').text();\r\n                const description =\r\n                    item.description +\r\n                    art(path.join(__dirname, 'templates/description.art'), {\r\n                        description: $$('div.entry').html(),\r\n                    });\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = parseDate($$('p.meta-info').contents().first().text().trim().split(/\\s/)[0], 'YYYY-MM-DD');\r\n                item.category = $$('p.meta-info a[rel=\"category tag\"]')\r\n                    .toArray()\r\n                    .map((c) => $$(c).text());\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.entry').text(),\r\n                };\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const title = $('title').first().text();\r\n    const image = new URL('wp-content/themes/D7/img/423Down.png', rootUrl).href;\r\n\r\n    return {\r\n        title,\r\n        description: $('title').last().text(),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: title.split(/-/).pop()?.trim(),\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category{.+}?',\r\n    name: '423Down',\r\n    url: '423down.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/423down',\r\n    parameters: { category: '分类，默认为首页，可在对应分类页 URL 中找到' },\r\n    description: `::: tip\r\n  若订阅 [Android - 423Down](https://www.423down.com/apk)，网址为 \\`https://www.423down.com/apk\\`。截取 \\`https://www.423down.com/\\` 到末尾的部分 \\`apk\\` 作为参数填入，此时路由为 [\\`/423down/apk\\`](https://rsshub.app/423down/apk)。\r\n:::\r\n\r\n#### [安卓软件](https://www.423down.com/apk)\r\n\r\n| [安卓软件](https://www.423down.com/apk) |\r\n| --------------------------------------- |\r\n| [apk](https://rsshub.app/423down/apk)   |\r\n\r\n#### 电脑软件\r\n\r\n| [原创软件](https://www.423down.com/zd423) | [媒体播放](https://www.423down.com/multimedia)      | [网页浏览](https://www.423down.com/browser)   | [图形图像](https://www.423down.com/image) | [聊天软件](https://www.423down.com/im) |\r\n| ----------------------------------------- | --------------------------------------------------- | --------------------------------------------- | ----------------------------------------- | -------------------------------------- |\r\n| [zd423](https://rsshub.app/423down/zd423) | [multimedia](https://rsshub.app/423down/multimedia) | [browser](https://rsshub.app/423down/browser) | [image](https://rsshub.app/423down/image) | [im](https://rsshub.app/423down/im)    |\r\n\r\n| [办公软件](https://www.423down.com/work) | [上传下载](https://www.423down.com/down) | [实用软件](https://www.423down.com/softtool)    | [系统辅助](https://www.423down.com/systemsoft)      | [系统必备](https://www.423down.com/systemplus)      |\r\n| ---------------------------------------- | ---------------------------------------- | ----------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- |\r\n| [work](https://rsshub.app/423down/work)  | [down](https://rsshub.app/423down/down)  | [softtool](https://rsshub.app/423down/softtool) | [systemsoft](https://rsshub.app/423down/systemsoft) | [systemplus](https://rsshub.app/423down/systemplus) |\r\n\r\n| [安全软件](https://www.423down.com/security)    | [补丁相关](https://www.423down.com/patch) | [硬件相关](https://www.423down.com/hardware)    |\r\n| ----------------------------------------------- | ----------------------------------------- | ----------------------------------------------- |\r\n| [security](https://rsshub.app/423down/security) | [patch](https://rsshub.app/423down/patch) | [hardware](https://rsshub.app/423down/hardware) |\r\n\r\n#### 操作系统\r\n\r\n| [Windows 11](https://www.423down.com/win11) | [Windows 10](https://www.423down.com/win10) | [Windows 7](https://www.423down.com/win7) | [Windows XP](https://www.423down.com/win7/winxp)    | [WinPE](https://www.423down.com/pe-system)        |\r\n| ------------------------------------------- | ------------------------------------------- | ----------------------------------------- | --------------------------------------------------- | ------------------------------------------------- |\r\n| [win11](https://rsshub.app/423down/win11)   | [win10](https://rsshub.app/423down/win10)   | [win7](https://rsshub.app/423down/win7)   | [win7/winxp](https://rsshub.app/423down/win7/winxp) | [pe-system](https://rsshub.app/423down/pe-system) |\r\n  `,\r\n    categories: ['program-update'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['423down.com/:category', '423down.com'],\r\n            target: (params) => {\r\n                const category = params.category;\r\n\r\n                return `/423down${category ? `/${category}` : ''}`;\r\n            },\r\n        },\r\n        {\r\n            title: '首页',\r\n            source: ['www.423down.com'],\r\n            target: '/',\r\n        },\r\n        {\r\n            title: '安卓软件',\r\n            source: ['www.423down.com/apk'],\r\n            target: '/apk',\r\n        },\r\n        {\r\n            title: '电脑软件 - 原创软件',\r\n            source: ['www.423down.com/zd423'],\r\n            target: '/zd423',\r\n        },\r\n        {\r\n            title: '电脑软件 - 媒体播放',\r\n            source: ['www.423down.com/multimedia'],\r\n            target: '/multimedia',\r\n        },\r\n        {\r\n            title: '电脑软件 - 网页浏览',\r\n            source: ['www.423down.com/browser'],\r\n            target: '/browser',\r\n        },\r\n        {\r\n            title: '电脑软件 - 图形图像',\r\n            source: ['www.423down.com/image'],\r\n            target: '/image',\r\n        },\r\n        {\r\n            title: '电脑软件 - 聊天软件',\r\n            source: ['www.423down.com/im'],\r\n            target: '/im',\r\n        },\r\n        {\r\n            title: '电脑软件 - 办公软件',\r\n            source: ['www.423down.com/work'],\r\n            target: '/work',\r\n        },\r\n        {\r\n            title: '电脑软件 - 上传下载',\r\n            source: ['www.423down.com/down'],\r\n            target: '/down',\r\n        },\r\n        {\r\n            title: '电脑软件 - 实用软件',\r\n            source: ['www.423down.com/softtool'],\r\n            target: '/softtool',\r\n        },\r\n        {\r\n            title: '电脑软件 - 系统辅助',\r\n            source: ['www.423down.com/systemsoft'],\r\n            target: '/systemsoft',\r\n        },\r\n        {\r\n            title: '电脑软件 - 系统必备',\r\n            source: ['www.423down.com/systemplus'],\r\n            target: '/systemplus',\r\n        },\r\n        {\r\n            title: '电脑软件 - 安全软件',\r\n            source: ['www.423down.com/security'],\r\n            target: '/security',\r\n        },\r\n        {\r\n            title: '电脑软件 - 补丁相关',\r\n            source: ['www.423down.com/patch'],\r\n            target: '/patch',\r\n        },\r\n        {\r\n            title: '电脑软件 - 硬件相关',\r\n            source: ['www.423down.com/hardware'],\r\n            target: '/hardware',\r\n        },\r\n        {\r\n            title: '操作系统 - Windows 11',\r\n            source: ['www.423down.com/win11'],\r\n            target: '/win11',\r\n        },\r\n        {\r\n            title: '操作系统 - Windows 10',\r\n            source: ['www.423down.com/win10'],\r\n            target: '/win10',\r\n        },\r\n        {\r\n            title: '操作系统 - Windows 7',\r\n            source: ['www.423down.com/win7'],\r\n            target: '/win7',\r\n        },\r\n        {\r\n            title: '操作系统 - Windows XP',\r\n            source: ['www.423down.com/win7/winxp'],\r\n            target: '/win7/winxp',\r\n        },\r\n        {\r\n            title: '操作系统 - WinPE',\r\n            source: ['www.423down.com/pe-system'],\r\n            target: '/pe-system',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}