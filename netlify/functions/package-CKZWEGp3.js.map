{"version":3,"file":"package-CKZWEGp3.js","names":[],"sources":["../../lib/routes/npm/package.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/package/:name{(@[a-z0-9-~][a-z0-9-._~]*/)?[a-z0-9-~][a-z0-9-._~]*}',\r\n    name: 'Package',\r\n    maintainers: ['Fatpandac'],\r\n    categories: ['program-update'],\r\n    example: '/npm/package/rsshub',\r\n    radar: [\r\n        {\r\n            source: ['www.npmjs.com/package/:name'],\r\n        },\r\n    ],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const name = ctx.req.param('name');\r\n    const packageDownloadLastMonthAPI = `https://api.npmjs.org/downloads/point/last-month/${name}`; // 按月统计\r\n    const packageDownloadLastWeekAPI = `https://api.npmjs.org/downloads/point/last-week/${name}`; // 按周统计\r\n    const packageDownloadLastDayAPI = `https://api.npmjs.org/downloads/point/last-day/${name}`; // 按天统计\r\n    const packageVersionAPI = `https://registry.npmjs.org/${name}`; // 包基本信息\r\n\r\n    const downloadCountLastMonthRes = await ofetch(packageDownloadLastMonthAPI);\r\n    const downloadCountLastWeekRes = await ofetch(packageDownloadLastWeekAPI);\r\n    const downloadCountLastDayRes = await ofetch(packageDownloadLastDayAPI);\r\n    const packageVersionRes = await ofetch(packageVersionAPI);\r\n\r\n    const packageVersion = packageVersionRes.time;\r\n    const packageVersionList = Object.keys(packageVersion)\r\n        .map((key) => ({\r\n            version: key,\r\n            time: packageVersion[key],\r\n        }))\r\n        .toReversed();\r\n\r\n    return {\r\n        title: `${name} - npm`,\r\n        link: `https://www.npmjs.com/package/${name}`,\r\n        description: `${name} - npm`,\r\n        item: [\r\n            {\r\n                title: `${name} - npm`,\r\n                description: art(path.join(__dirname, 'templates/package.art'), {\r\n                    packageDownloadCountLastMonth: downloadCountLastMonthRes.downloads,\r\n                    packageDownloadCountLastWeek: downloadCountLastWeekRes.downloads,\r\n                    packageDownloadCountLastDay: downloadCountLastDayRes.downloads,\r\n                    packageVersion: packageVersionList,\r\n                }),\r\n                link: `https://www.npmjs.com/package/${name}`,\r\n                guid: `https://www.npmjs.com/package/${name}${packageVersion.modified}`,\r\n            },\r\n        ],\r\n    };\r\n}\r\n"],"mappings":"2RAMA,MAAa,EAAe,CACxB,KAAM,sEACN,KAAM,UACN,YAAa,CAAC,aACd,WAAY,CAAC,kBACb,QAAS,sBACT,MAAO,CACH,CACI,OAAQ,CAAC,iCAGjB,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAA8B,oDAAoD,IAClF,EAA6B,mDAAmD,IAChF,EAA4B,kDAAkD,IAC9E,EAAoB,8BAA8B,IAElD,EAA4B,MAAM,EAAO,GACzC,EAA2B,MAAM,EAAO,GACxC,EAA0B,MAAM,EAAO,GACvC,EAAoB,MAAM,EAAO,GAEjC,EAAiB,EAAkB,KACnC,EAAqB,OAAO,KAAK,GAClC,IAAK,IAAS,CACX,QAAS,EACT,KAAM,EAAe,MAExB,aAEL,MAAO,CACH,MAAO,GAAG,EAAK,QACf,KAAM,iCAAiC,IACvC,YAAa,GAAG,EAAK,QACrB,KAAM,CACF,CACI,MAAO,GAAG,EAAK,QACf,YAAa,EAAI,EAAA,KAAA,EAAA,kCAA+C,CAC5D,8BAA+B,EAA0B,UACzD,6BAA8B,EAAyB,UACvD,4BAA6B,EAAwB,UACrD,eAAgB,IAEpB,KAAM,iCAAiC,IACvC,KAAM,iCAAiC,IAAO,EAAe"}