{"version":3,"file":"disclosure-CTfXez8T.js","names":["route: Route","queries: Record<string, string>","got"],"sources":["../../lib/routes/sse/disclosure.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/disclosure/:query?',\r\n    categories: ['finance'],\r\n    example: '/sse/disclosure/beginDate=2018-08-18&endDate=2020-08-25&productId=600696',\r\n    parameters: { query: '筛选条件，见示例' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '上市公司信息最新公告披露',\r\n    maintainers: ['harveyqiu'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const query = ctx.req.param('query') ?? ''; // beginDate=2018-08-18&endDate=2020-09-01&productId=600696\r\n    const queries: Record<string, string> = {};\r\n    if (query) {\r\n        for (const pair of query.split('&')) {\r\n            const [key, value] = pair.split('=');\r\n            if (key) {\r\n                queries[key] = value;\r\n            }\r\n        }\r\n    }\r\n    const pageUrl = `https://www.sse.com.cn/assortment/stock/list/info/announcement/index.shtml?productId=${queries.productId}`;\r\n\r\n    const response = await got('https://query.sse.com.cn/security/stock/queryCompanyBulletin.do', {\r\n        searchParams: {\r\n            isPagination: true,\r\n            securityType: '0101,120100,020100,020200,120200',\r\n            reportType: 'ALL',\r\n            'pageHelp.pageSize': 25,\r\n            'pageHelp.pageCount': 50,\r\n            'pageHelp.pageNo': 1,\r\n            'pageHelp.beginPage': 1,\r\n            'pageHelp.cacheSize': 1,\r\n            'pageHelp.endPage': 5,\r\n            _: Date.now(),\r\n            ...queries,\r\n        },\r\n        headers: {\r\n            Referer: pageUrl,\r\n        },\r\n    });\r\n\r\n    const pdfHost = 'https://static.sse.com.cn';\r\n\r\n    const items = response.data.result.map((item) => ({\r\n        title: item.TITLE,\r\n        description: `${pdfHost}${item.URL}`,\r\n        pubDate: parseDate(item.ADDDATE),\r\n        link: `${pdfHost}${item.URL}`,\r\n        author: item.SECURITY_NAME,\r\n    }));\r\n\r\n    return {\r\n        title: `上海证券交易所 - 上市公司信息 - ${items[0].author}最新公告`,\r\n        link: pageUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"qRAIA,MAAaA,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,WACb,QAAS,2EACT,WAAY,CAAE,MAAO,YACrB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,eACN,YAAa,CAAC,aACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,UAAY,GAClCC,EAAkC,GACxC,GAAI,EACA,IAAK,IAAM,KAAQ,EAAM,MAAM,KAAM,CACjC,GAAM,CAAC,EAAK,GAAS,EAAK,MAAM,KAC5B,IACA,EAAQ,GAAO,GAI3B,IAAM,EAAU,wFAAwF,EAAQ,YAE1G,EAAW,MAAMC,EAAI,kEAAmE,CAC1F,aAAc,CACV,aAAc,GACd,aAAc,mCACd,WAAY,MACZ,oBAAqB,GACrB,qBAAsB,GACtB,kBAAmB,EACnB,qBAAsB,EACtB,qBAAsB,EACtB,mBAAoB,EACpB,EAAG,KAAK,MACR,GAAG,GAEP,QAAS,CACL,QAAS,KAIX,EAAU,4BAEV,EAAQ,EAAS,KAAK,OAAO,IAAK,IAAU,CAC9C,MAAO,EAAK,MACZ,YAAa,GAAG,IAAU,EAAK,MAC/B,QAAS,EAAU,EAAK,SACxB,KAAM,GAAG,IAAU,EAAK,MACxB,OAAQ,EAAK,iBAGjB,MAAO,CACH,MAAO,sBAAsB,EAAM,GAAG,OAAO,MAC7C,KAAM,EACN,KAAM"}