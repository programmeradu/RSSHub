{"version":3,"file":"utils-Ci4w1lqo.js","names":[],"sources":["../../lib/routes/dcfever/utils.ts"],"sourcesContent":["import ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport cache from '@/utils/cache';\r\n\r\nconst baseUrl = 'https://www.dcfever.com';\r\n\r\nconst parseItem = (item) =>\r\n    cache.tryGet(item.link, async () => {\r\n        const response = await ofetch(item.link);\r\n        const $ = load(response);\r\n        const content = $('div[itemprop=\"articleBody\"], .column_article_content_html');\r\n\r\n        const pageLinks = $('.article_multi_page a')\r\n            .not('.selected')\r\n            .toArray()\r\n            .map((i) => ({ link: new URL($(i).attr('href'), item.link).href }));\r\n\r\n        if (pageLinks.length) {\r\n            const pages = await Promise.all(\r\n                pageLinks.map(async (pageLink) => {\r\n                    const response = await ofetch(pageLink.link);\r\n                    const $ = load(response);\r\n                    return $('div[itemprop=\"articleBody\"]').html();\r\n                })\r\n            );\r\n            content.append(pages);\r\n        }\r\n\r\n        content.find('img').each((_, e) => {\r\n            if (e.attribs.src?.includes('?')) {\r\n                e.attribs.src = e.attribs.src.split('?')[0];\r\n            }\r\n        });\r\n\r\n        content.find('p a').each((_, e) => {\r\n            e = $(e);\r\n            if (e.text().startsWith('下一頁為')) {\r\n                e.remove();\r\n            }\r\n        });\r\n\r\n        content.find('iframe').each((_, e) => {\r\n            e = $(e);\r\n            if (e.attr('src').startsWith('https://www.facebook.com/plugins/like.php')) {\r\n                e.remove();\r\n            }\r\n        });\r\n\r\n        item.description = content.html();\r\n        item.pubDate = parseDate($('meta[property=\"article:published_time\"]').attr('content'));\r\n\r\n        return item;\r\n    });\r\n\r\nconst parseTradeItem = (item) =>\r\n    cache.tryGet(item.link, async () => {\r\n        const response = await ofetch(item.link);\r\n        const $ = load(response);\r\n\r\n        const photoSelector = $('#trading_item_section .description')\r\n            .contents()\r\n            .filter((_, e) => e.type === 'comment')\r\n            .toArray()\r\n            .map((e) => e.data)\r\n            .join('');\r\n\r\n        const $photo = load(photoSelector, null, false);\r\n\r\n        $photo('.selector_text').remove();\r\n        $photo('.selector_image_div').each((_, div) => {\r\n            delete div.attribs.onclick;\r\n        });\r\n        $photo('.desktop_photo_selector img').each((_, img) => {\r\n            if (img.attribs.src.endsWith('_sqt.jpg')) {\r\n                img.attribs.src = img.attribs.src.replace('_sqt.jpg', '.jpg');\r\n            }\r\n        });\r\n\r\n        item.description = art(path.join(__dirname, 'templates/trading.art'), {\r\n            info: $('.info_col'),\r\n            description: $('.description_text').html(),\r\n            photo: $photo('.desktop_photo_selector').html(),\r\n        });\r\n\r\n        return item;\r\n    });\r\n\r\nexport { baseUrl, parseItem, parseTradeItem };\r\n"],"mappings":"8UAOA,MAAM,EAAU,0BAEV,EAAa,GACf,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAW,MAAM,EAAO,EAAK,MAC7B,EAAI,EAAK,GACT,EAAU,EAAE,6DAEZ,EAAY,EAAE,yBACf,IAAI,aACJ,UACA,IAAK,IAAO,CAAE,KAAM,IAAI,IAAI,EAAE,GAAG,KAAK,QAAS,EAAK,MAAM,QAE/D,GAAI,EAAU,OAAQ,CAClB,IAAM,EAAQ,MAAM,QAAQ,IACxB,EAAU,IAAI,KAAO,IAAa,CAC9B,IAAM,EAAW,MAAM,EAAO,EAAS,MACjC,EAAI,EAAK,GACf,OAAO,EAAE,+BAA+B,UAGhD,EAAQ,OAAO,GA0BnB,OAvBA,EAAQ,KAAK,OAAO,MAAM,EAAG,IAAM,CAC3B,EAAE,QAAQ,KAAK,SAAS,OACxB,EAAE,QAAQ,IAAM,EAAE,QAAQ,IAAI,MAAM,KAAK,MAIjD,EAAQ,KAAK,OAAO,MAAM,EAAG,IAAM,CAC/B,EAAI,EAAE,GACF,EAAE,OAAO,WAAW,SACpB,EAAE,WAIV,EAAQ,KAAK,UAAU,MAAM,EAAG,IAAM,CAClC,EAAI,EAAE,GACF,EAAE,KAAK,OAAO,WAAW,8CACzB,EAAE,WAIV,EAAK,YAAc,EAAQ,OAC3B,EAAK,QAAU,EAAU,EAAE,2CAA2C,KAAK,YAEpE,IAGT,EAAkB,GACpB,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAW,MAAM,EAAO,EAAK,MAC7B,EAAI,EAAK,GAET,EAAgB,EAAE,sCACnB,WACA,QAAQ,EAAG,IAAM,EAAE,OAAS,WAC5B,UACA,IAAK,GAAM,EAAE,MACb,KAAK,IAEJ,EAAS,EAAK,EAAe,KAAM,IAkBzC,OAhBA,EAAO,kBAAkB,SACzB,EAAO,uBAAuB,MAAM,EAAG,IAAQ,CAC3C,OAAO,EAAI,QAAQ,UAEvB,EAAO,+BAA+B,MAAM,EAAG,IAAQ,CAC/C,EAAI,QAAQ,IAAI,SAAS,cACzB,EAAI,QAAQ,IAAM,EAAI,QAAQ,IAAI,QAAQ,WAAY,WAI9D,EAAK,YAAc,EAAI,EAAA,KAAA,EAAA,kCAA+C,CAClE,KAAM,EAAE,aACR,YAAa,EAAE,qBAAqB,OACpC,MAAO,EAAO,2BAA2B,SAGtC"}