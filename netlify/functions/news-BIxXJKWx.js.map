{"version":3,"file":"news-BIxXJKWx.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/rfi/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/:path{.+}?',\r\n    radar: [\r\n        {\r\n            source: ['rfi.fr/*path'],\r\n            target: '/:path',\r\n        },\r\n    ],\r\n    name: 'Generic News',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    url: 'rfi.fr',\r\n    example: '/rfi',\r\n    description: `::: tip\r\n-   To subscribe to [English News](https://www.rfi.fr/en/), which URL is \\`https://www.rfi.fr/en\\`, you can get the route as [\\`/rfi/en\\`](https://rsshub.app/rfi/en).\r\n-   To subscribe to [English Europe News](https://www.rfi.fr/en/europe/), which URL is \\`https://www.rfi.fr/en/europe\\`, you can get the route as [\\`/rfi/en/europe\\`](https://rsshub.app/rfi/en/europe).\r\n-   To subscribe to topic [Paris Olympics 2024](https://www.rfi.fr/en/tag/paris-olympics-2024/), which URL is \\`https://www.rfi.fr/en/tag/paris-olympics-2024\\`, you can get the route as [\\`/rfi/en/tag/paris-olympics-2024\\`](https://rsshub.app/rfi/en/tag/paris-olympics-2024).\r\n:::\r\n\r\n::: warning\r\nThis route does not support podcasts, please use the Offical RSS feed instead.\r\n:::\r\n`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const rootUrl = 'https://www.rfi.fr/';\r\n    const path = ctx.req.param('path') ?? 'en';\r\n    const currentUrl = `${rootUrl}${path.endsWith('/') ? path : `${path}/`}`;\r\n    const response = await got(currentUrl);\r\n\r\n    const $ = load(response.data);\r\n\r\n    $('aside[data-org-type=\"aside-content--highlighted\"], aside[data-org-type=\"aside-content--sponsors\"]').remove();\r\n\r\n    let items = $('.article__title a')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.text(),\r\n                link: new URL(item.attr('href'), currentUrl).href,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got(item.link);\r\n                const content = load(detailResponse.data);\r\n\r\n                content('.m-interstitial, .m-em-quote svg, .o-self-promo').remove();\r\n\r\n                const ldJson = JSON.parse(content('script[type=\"application/ld+json\"]').text() || '[]').find((x) => x['@type'] === 'NewsArticle');\r\n\r\n                item.description = content('.t-content__chapo').prop('outerHTML') + content('.t-content__main-media').prop('outerHTML') + content('.t-content__body').html();\r\n                item.pubDate = parseDate(ldJson?.datePublished);\r\n                item.updated = parseDate(ldJson?.dateModified);\r\n                item.author = ldJson?.author.map((author) => author.name).join(', ');\r\n                item.category = ldJson?.keywords;\r\n\r\n                if (ldJson?.audio) {\r\n                    item.itunes_item_image = ldJson.audio.thumbnailUrl;\r\n                    // TODO: Use Temporal.Duration when https://tc39.es/proposal-temporal/ is GA\r\n                    item.itunes_duration = ldJson.audio.duration\r\n                        .match(/P0DT(\\d+)H(\\d+)M(\\d+)S/)\r\n                        .slice(1)\r\n                        .map((x) => Number.parseInt(x))\r\n                        .reduce((a, b) => a * 60 + b);\r\n                    item.enclosure_url = ldJson.audio.contentUrl;\r\n                    item.enclosure_type = 'audio/mpeg';\r\n                }\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        description: $('meta[name=\"description\"]').attr('content'),\r\n        link: currentUrl,\r\n        image: $('meta[property=\"og:image\"]').attr('content'),\r\n        icon: new URL($('link[rel=\"apple-touch-icon\"]').attr('href'), currentUrl).href,\r\n        logo: new URL($('link[rel=\"apple-touch-icon\"]').attr('href'), currentUrl).href,\r\n        item: items,\r\n        language: $('html').attr('lang'),\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,cACN,MAAO,CACH,CACI,OAAQ,CAAC,gBACT,OAAQ,WAGhB,KAAM,eACN,YAAa,CAAC,WACd,UACA,IAAK,SACL,QAAS,OACT,YAAa,kvBAYjB,eAAe,EAAQ,EAAK,CACxB,IACM,EAAO,EAAI,IAAI,MAAM,SAAW,KAChC,EAAa,sBAAa,EAAK,SAAS,KAAO,EAAO,GAAG,EAAK,KAC9D,EAAW,MAAMC,EAAI,GAErB,EAAI,EAAK,EAAS,MAExB,EAAE,qGAAqG,SAEvG,IAAI,EAAQ,EAAE,qBACT,UACA,IAAK,IACF,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,OACZ,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAY,QAqCzD,MAjCA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,EAAK,MAChC,EAAU,EAAK,EAAe,MAEpC,EAAQ,mDAAmD,SAE3D,IAAM,EAAS,KAAK,MAAM,EAAQ,sCAAsC,QAAU,MAAM,KAAM,GAAM,EAAE,WAAa,eAoBnH,MAlBA,GAAK,YAAc,EAAQ,qBAAqB,KAAK,aAAe,EAAQ,0BAA0B,KAAK,aAAe,EAAQ,oBAAoB,OACtJ,EAAK,QAAU,EAAU,GAAQ,eACjC,EAAK,QAAU,EAAU,GAAQ,cACjC,EAAK,OAAS,GAAQ,OAAO,IAAK,GAAW,EAAO,MAAM,KAAK,MAC/D,EAAK,SAAW,GAAQ,SAEpB,GAAQ,QACR,EAAK,kBAAoB,EAAO,MAAM,aAEtC,EAAK,gBAAkB,EAAO,MAAM,SAC/B,MAAM,0BACN,MAAM,GACN,IAAK,GAAM,OAAO,SAAS,IAC3B,QAAQ,EAAG,IAAM,EAAI,GAAK,GAC/B,EAAK,cAAgB,EAAO,MAAM,WAClC,EAAK,eAAiB,cAGnB,MAKZ,CACH,MAAO,EAAE,SAAS,OAClB,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,EACN,MAAO,EAAE,6BAA6B,KAAK,WAC3C,KAAM,IAAI,IAAI,EAAE,gCAAgC,KAAK,QAAS,GAAY,KAC1E,KAAM,IAAI,IAAI,EAAE,gCAAgC,KAAK,QAAS,GAAY,KAC1E,KAAM,EACN,SAAU,EAAE,QAAQ,KAAK"}