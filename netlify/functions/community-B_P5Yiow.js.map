{"version":3,"file":"community-B_P5Yiow.js","names":["route: Route"],"sources":["../../lib/routes/mixi2/community.ts"],"sourcesContent":["import { type Data, type Route, ViewType } from '@/types';\r\nimport type { Context } from 'hono';\r\nimport { CONFIG_OPTIONS, generatePostDataItem, getClient, postFilter } from './utils';\r\n\r\nconst handler = async (ctx: Context) => {\r\n    const limit = Number.parseInt(ctx.req.query('limit') ?? '20', 10);\r\n    const communityId = ctx.req.param('id');\r\n    const mediaOnly = ctx.req.param('media') === 'media';\r\n\r\n    const client = getClient();\r\n\r\n    const [communityInfo, postsData] = await Promise.all([\r\n        client.getCommunity({\r\n            communityId,\r\n        }),\r\n        client.getCommunityTimeline({\r\n            communityId,\r\n            limit,\r\n            mediaOnly,\r\n        }),\r\n    ]);\r\n\r\n    const personasData = await client.getPersonas({\r\n        personaIds: postsData?.posts.map((post) => post.personaId),\r\n    });\r\n\r\n    return {\r\n        title: `${communityInfo.community.name} - ${mediaOnly ? 'メディア' : 'ポスト'}`,\r\n        description: communityInfo.community.purpose.replaceAll('\\n', ' '),\r\n        link: `https://mixi.social/communities/${communityId}/about`,\r\n        image: communityInfo.community.coverImage.postImage?.largeImageUrl,\r\n        item:\r\n            postsData?.posts?.filter(postFilter).map((post) => ({\r\n                title: communityInfo.community.name,\r\n                ...generatePostDataItem(post, personasData.personas),\r\n            })) ?? [],\r\n    } as Data;\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/community/:id/:media?',\r\n    name: 'コミュニティ',\r\n    categories: ['social-media'],\r\n    example: '/mixi2/community/62e7e813-d242-4c54-a0ee-0aab5b2bbad2',\r\n    parameters: {\r\n        id: {\r\n            description: 'コミュニティID',\r\n        },\r\n        media: {\r\n            description: '`media`を入力するとメディアを含むポストのみを取得、デフォルトは空で全てのポストを取得',\r\n        },\r\n    },\r\n    features: {\r\n        supportRadar: true,\r\n        requireConfig: CONFIG_OPTIONS,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['mixi.social/communities/:id', 'mixi.social/communities/:id/about'],\r\n            target: '/community/:id',\r\n            title: 'コミュニティ - ポスト',\r\n        },\r\n        {\r\n            source: ['mixi.social/communities/:id', 'mixi.social/communities/:id/about'],\r\n            target: '/community/:id/media',\r\n            title: 'コミュニティ - メディア',\r\n        },\r\n    ],\r\n    view: ViewType.SocialMedia,\r\n    handler,\r\n    maintainers: ['KarasuShin'],\r\n};\r\n"],"mappings":"uXAIA,MAAM,EAAU,KAAO,IAAiB,CACpC,IAAM,EAAQ,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IACxD,EAAc,EAAI,IAAI,MAAM,MAC5B,EAAY,EAAI,IAAI,MAAM,WAAa,QAEvC,EAAS,IAET,CAAC,EAAe,GAAa,MAAM,QAAQ,IAAI,CACjD,EAAO,aAAa,CAChB,gBAEJ,EAAO,qBAAqB,CACxB,cACA,QACA,gBAIF,EAAe,MAAM,EAAO,YAAY,CAC1C,WAAY,GAAW,MAAM,IAAK,GAAS,EAAK,aAGpD,MAAO,CACH,MAAO,GAAG,EAAc,UAAU,KAAK,KAAK,EAAY,OAAS,QACjE,YAAa,EAAc,UAAU,QAAQ,WAAW;EAAM,KAC9D,KAAM,mCAAmC,EAAY,QACrD,MAAO,EAAc,UAAU,WAAW,WAAW,cACrD,KACI,GAAW,OAAO,OAAO,GAAY,IAAK,IAAU,CAChD,MAAO,EAAc,UAAU,KAC/B,GAAG,EAAqB,EAAM,EAAa,cACxC,KAINA,EAAe,CACxB,KAAM,yBACN,KAAM,SACN,WAAY,CAAC,gBACb,QAAS,wDACT,WAAY,CACR,GAAI,CACA,YAAa,YAEjB,MAAO,CACH,YAAa,mDAGrB,SAAU,CACN,aAAc,GACd,cAAe,GAEnB,MAAO,CACH,CACI,OAAQ,CAAC,8BAA+B,qCACxC,OAAQ,iBACR,MAAO,gBAEX,CACI,OAAQ,CAAC,8BAA+B,qCACxC,OAAQ,uBACR,MAAO,kBAGf,KAAM,EAAS,YACf,UACA,YAAa,CAAC"}