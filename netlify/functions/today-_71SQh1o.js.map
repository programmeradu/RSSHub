{"version":3,"file":"today-_71SQh1o.js","names":["route: Route","got","cache","$"],"sources":["../../lib/routes/hitwh/today.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst baseUrl = 'https://today.hitwh.edu.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/today',\r\n    categories: ['university'],\r\n    example: '/hitwh/today',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['hitwh.edu.cn/1024/list.htm', 'hitwh.edu.cn/'],\r\n        },\r\n    ],\r\n    name: '今日工大 - 通知公告',\r\n    maintainers: ['raptazure'],\r\n    handler,\r\n    url: 'hitwh.edu.cn/1024/list.htm',\r\n};\r\n\r\nasync function handler() {\r\n    const response = await got(`${baseUrl}/1024/list.htm`, {\r\n        https: {\r\n            rejectUnauthorized: false,\r\n        },\r\n    });\r\n    const $ = load(response.data);\r\n    const type = (filename) => filename.split('.').pop();\r\n    const links = $('.list_list_wrap #wp_news_w10002 ul > li')\r\n        .toArray()\r\n        .map((el) => ({\r\n            pubDate: timezone(parseDate($(el).find('.news-time2').text()), 8),\r\n            link: new URL($(el).find('a').attr('href'), baseUrl).toString(),\r\n            title: $(el).find('a').text(),\r\n        }));\r\n\r\n    return {\r\n        title: '哈尔滨工业大学（威海）通知公告',\r\n        link: `${baseUrl}/1024/list.htm`,\r\n        item: await Promise.all(\r\n            links.map((item) =>\r\n                cache.tryGet(item.link, async () => {\r\n                    if (type(item.link) === 'htm') {\r\n                        try {\r\n                            const { data } = await got(item.link, {\r\n                                https: {\r\n                                    rejectUnauthorized: false,\r\n                                },\r\n                            });\r\n                            const $ = load(data);\r\n                            item.description = $('div.wp_articlecontent').html() && $('div.wp_articlecontent').html().replaceAll('src=\"/', `src=\"${baseUrl}/`).replaceAll('href=\"/', `href=\"${baseUrl}/`).trim();\r\n                            return item;\r\n                        } catch {\r\n                            // intranet\r\n                            item.description = '请进行统一身份认证之后再访问';\r\n                            return item;\r\n                        }\r\n                    } else {\r\n                        // file to download\r\n                        item.description = '此链接为文件，点击以下载';\r\n                        return item;\r\n                    }\r\n                })\r\n            )\r\n        ),\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAM,EAAU,6BAEHA,EAAe,CACxB,KAAM,SACN,WAAY,CAAC,cACb,QAAS,eACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,6BAA8B,mBAG/C,KAAM,cACN,YAAa,CAAC,aACd,UACA,IAAK,8BAGT,eAAe,GAAU,CACrB,IAAM,EAAW,MAAMC,EAAI,GAAG,EAAQ,gBAAiB,CACnD,MAAO,CACH,mBAAoB,MAGtB,EAAI,EAAK,EAAS,MAClB,EAAQ,GAAa,EAAS,MAAM,KAAK,MACzC,EAAQ,EAAE,2CACX,UACA,IAAK,IAAQ,CACV,QAAS,EAAS,EAAU,EAAE,GAAI,KAAK,eAAe,QAAS,GAC/D,KAAM,IAAI,IAAI,EAAE,GAAI,KAAK,KAAK,KAAK,QAAS,GAAS,WACrD,MAAO,EAAE,GAAI,KAAK,KAAK,UAG/B,MAAO,CACH,MAAO,kBACP,KAAM,GAAG,EAAQ,gBACjB,KAAM,MAAM,QAAQ,IAChB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,EAAK,EAAK,QAAU,MACpB,GAAI,CACA,GAAM,CAAE,QAAS,MAAMD,EAAI,EAAK,KAAM,CAClC,MAAO,CACH,mBAAoB,MAGtBE,EAAI,EAAK,GAEf,MADA,GAAK,YAAcA,EAAE,yBAAyB,QAAUA,EAAE,yBAAyB,OAAO,WAAW,SAAU,QAAQ,EAAQ,IAAI,WAAW,UAAW,SAAS,EAAQ,IAAI,OACvK,OACH,CAGJ,MADA,GAAK,YAAc,iBACZ,OAKX,MADA,GAAK,YAAc,eACZ"}