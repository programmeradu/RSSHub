{"version":3,"file":"blog-DYd4GLEW.js","names":["route: Route","ofetch","cache","response","$"],"sources":["../../lib/routes/xbookcn/blog.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\n\r\nexport const route: Route = {\r\n    path: '/:label?', // 路由路径\r\n    categories: ['reading'], // 分类\r\n    example: '/xbookcn/精选作品', // 示例路径\r\n    parameters: { label: '按名称分类，详见https://blog.xbookcn.net/p/all.html' }, // 参数\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        nsfw: true,\r\n    },\r\n    name: '短篇', // 源名称\r\n    maintainers: ['Lyunvy'], // 维护者\r\n    handler: async (ctx) => {\r\n        const { label = '精选作品' } = ctx.req.param(); // 从请求参数中获取 label\r\n        const url = `https://blog.xbookcn.net/search/label/${label}`; // 使用反引号构建 URL\r\n        const response = await ofetch(url); // 请求源链接\r\n        const $ = load(response); // 加载 HTML\r\n\r\n        const articles = $('.blog-posts.hfeed .date-outer').find('.post'); // 查找文章\r\n\r\n        const list = articles.toArray().map((elem) => {\r\n            const a = $(elem).find('.post-title a'); // 获取标题链接\r\n            return {\r\n                title: a.text().trim(), // 标题\r\n                link: a.attr('href'), // 链接\r\n                category: [], // 分类\r\n            };\r\n        });\r\n\r\n        const items = await Promise.all(\r\n            list.map(\r\n                async (item) =>\r\n                    // 使用缓存以避免重复请求\r\n                    await cache.tryGet(item.link, async () => {\r\n                        const response = await ofetch(item.link); // 请求文章链接\r\n                        const $ = load(response); // 加载文章页面\r\n\r\n                        // 获取文章的完整描述\r\n                        item.description = $('.post-body.entry-content').html() || '无内容'; // 抓取指定内容\r\n\r\n                        // 获取分类信息\r\n                        const categories = $('.post-labels a')\r\n                            .toArray()\r\n                            .map((el) => $(el).text().trim());\r\n                        item.category = categories; // 添加多个分类信息\r\n\r\n                        return item; // 返回带有描述和分类的文章对象\r\n                    })\r\n            )\r\n        );\r\n\r\n        return {\r\n            title: 'xbookcn', // 源标题\r\n            link: url, // 源链接\r\n            item: items, // 源文章\r\n        };\r\n    },\r\n};\r\n"],"mappings":"8PAKA,MAAaA,EAAe,CACxB,KAAM,WACN,WAAY,CAAC,WACb,QAAS,gBACT,WAAY,CAAE,MAAO,+CACrB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,KAAM,IAEV,KAAM,KACN,YAAa,CAAC,UACd,QAAS,KAAO,IAAQ,CACpB,GAAM,CAAE,QAAQ,QAAW,EAAI,IAAI,QAC7B,EAAM,yCAAyC,IAC/C,EAAW,MAAMC,EAAO,GACxB,EAAI,EAAK,GAET,EAAW,EAAE,iCAAiC,KAAK,SAEnD,EAAO,EAAS,UAAU,IAAK,GAAS,CAC1C,IAAM,EAAI,EAAE,GAAM,KAAK,iBACvB,MAAO,CACH,MAAO,EAAE,OAAO,OAChB,KAAM,EAAE,KAAK,QACb,SAAU,MAIZ,EAAQ,MAAM,QAAQ,IACxB,EAAK,IACD,KAAO,IAEH,MAAMC,EAAM,OAAO,EAAK,KAAM,SAAY,CACtC,IAAMC,EAAW,MAAMF,EAAO,EAAK,MAC7BG,EAAI,EAAKD,GAGf,EAAK,YAAcC,EAAE,4BAA4B,QAAU,MAG3D,IAAM,EAAaA,EAAE,kBAChB,UACA,IAAK,GAAOA,EAAE,GAAI,OAAO,QAG9B,MAFA,GAAK,SAAW,EAET,MAKvB,MAAO,CACH,MAAO,UACP,KAAM,EACN,KAAM"}