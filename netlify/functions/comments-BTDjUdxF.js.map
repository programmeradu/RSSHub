{"version":3,"file":"comments-BTDjUdxF.js","names":["MarkdownIt","route: Route","ofetch"],"sources":["../../lib/routes/jetbrains/comments.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport MarkdownIt from 'markdown-it';\r\n\r\nconst md = MarkdownIt({ html: true });\r\n\r\nconst rootUrl = 'https://youtrack.jetbrains.com';\r\nconst apiUrl = `${rootUrl}/api`;\r\n\r\nconst ACTIVITY_CATEGORIES = 'IssueCreatedCategory,CommentsCategory';\r\nconst ACTIVITY_FIELDS = 'activities(author(name),category(id),id,issue(description),timestamp,added(author(name),created,id,text,usesMarkdown))';\r\nconst ISSUE_FIELDS = 'summary';\r\n\r\nexport const route: Route = {\r\n    path: '/youtrack/comments/:issueId',\r\n    categories: ['programming'],\r\n    example: '/jetbrains/youtrack/comments/IJPL-174543',\r\n    parameters: {\r\n        issueId: 'Issue ID (e.g., IJPL-174543)',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['youtrack.jetbrains.com/issue/:issueId'],\r\n            target: '/youtrack/comments/:issueId',\r\n        },\r\n    ],\r\n    name: 'YouTrack Issue Comments',\r\n    maintainers: ['NekoAria'],\r\n    handler,\r\n};\r\n\r\nfunction processIssueCreated(activity, issueId) {\r\n    const description = md.render(activity.issue.description);\r\n\r\n    return {\r\n        title: `${activity.author.name} created issue ${issueId}`,\r\n        author: activity.author.name,\r\n        pubDate: parseDate(activity.timestamp),\r\n        link: `${rootUrl}/issue/${issueId}#focus=Comments-${activity.id}`,\r\n        description,\r\n        guid: `${issueId}-comment-${activity.id}`,\r\n    };\r\n}\r\n\r\nfunction processComment(activity, issueId) {\r\n    const comment = activity.added[0];\r\n    const author = comment.author || activity.author;\r\n    const description = comment.usesMarkdown ? md.render(comment.text) : comment.text;\r\n\r\n    return {\r\n        title: `${author.name} commented on ${issueId}`,\r\n        author: author.name,\r\n        pubDate: parseDate(comment.created || activity.timestamp),\r\n        link: `${rootUrl}/issue/${issueId}#focus=Comments-${activity.id}`,\r\n        description,\r\n        guid: `${issueId}-comment-${activity.id}`,\r\n    };\r\n}\r\n\r\nfunction processActivity(activity, issueId) {\r\n    switch (activity.category.id) {\r\n        case 'IssueCreatedCategory':\r\n            return processIssueCreated(activity, issueId);\r\n        case 'CommentsCategory':\r\n            return processComment(activity, issueId);\r\n        default:\r\n            return null;\r\n    }\r\n}\r\n\r\nasync function handler(ctx) {\r\n    const issueId = ctx.req.param('issueId');\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 100;\r\n\r\n    const issueInfo = await ofetch(`${apiUrl}/issues/${issueId}`, {\r\n        query: { fields: ISSUE_FIELDS },\r\n    });\r\n\r\n    const response = await ofetch(`${apiUrl}/issues/${issueId}/activitiesPage`, {\r\n        query: {\r\n            categories: ACTIVITY_CATEGORIES,\r\n            fields: ACTIVITY_FIELDS,\r\n        },\r\n    });\r\n\r\n    const items = response.activities\r\n        .map((activity) => processActivity(activity, issueId))\r\n        .filter((item) => item !== null)\r\n        .sort((a, b) => new Date(b.pubDate).getTime() - new Date(a.pubDate).getTime())\r\n        .slice(0, limit);\r\n\r\n    return {\r\n        title: `YouTrack ${issueId} - ${issueInfo.summary}`,\r\n        link: `${rootUrl}/issue/${issueId}`,\r\n        description: `Comments and activities for YouTrack issue ${issueId}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"2PAKA,MAAM,EAAKA,EAAW,CAAE,KAAM,KAExB,EAAU,iCACV,EAAS,GAAG,EAAQ,MAMbC,EAAe,CACxB,KAAM,8BACN,WAAY,CAAC,eACb,QAAS,2CACT,WAAY,CACR,QAAS,gCAEb,MAAO,CACH,CACI,OAAQ,CAAC,yCACT,OAAQ,gCAGhB,KAAM,0BACN,YAAa,CAAC,YACd,WAGJ,SAAS,EAAoB,EAAU,EAAS,CAC5C,IAAM,EAAc,EAAG,OAAO,EAAS,MAAM,aAE7C,MAAO,CACH,MAAO,GAAG,EAAS,OAAO,KAAK,iBAAiB,IAChD,OAAQ,EAAS,OAAO,KACxB,QAAS,EAAU,EAAS,WAC5B,KAAM,GAAG,EAAQ,SAAS,EAAQ,kBAAkB,EAAS,KAC7D,cACA,KAAM,GAAG,EAAQ,WAAW,EAAS,MAI7C,SAAS,EAAe,EAAU,EAAS,CACvC,IAAM,EAAU,EAAS,MAAM,GACzB,EAAS,EAAQ,QAAU,EAAS,OACpC,EAAc,EAAQ,aAAe,EAAG,OAAO,EAAQ,MAAQ,EAAQ,KAE7E,MAAO,CACH,MAAO,GAAG,EAAO,KAAK,gBAAgB,IACtC,OAAQ,EAAO,KACf,QAAS,EAAU,EAAQ,SAAW,EAAS,WAC/C,KAAM,GAAG,EAAQ,SAAS,EAAQ,kBAAkB,EAAS,KAC7D,cACA,KAAM,GAAG,EAAQ,WAAW,EAAS,MAI7C,SAAS,EAAgB,EAAU,EAAS,CACxC,OAAQ,EAAS,SAAS,GAA1B,CACI,IAAK,uBACD,OAAO,EAAoB,EAAU,GACzC,IAAK,mBACD,OAAO,EAAe,EAAU,GACpC,QACI,OAAO,MAInB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,EAAI,IAAI,MAAM,WACxB,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAE3E,EAAY,MAAMC,EAAO,GAAG,EAAO,UAAU,IAAW,CAC1D,MAAO,CAAE,OAAQ,aAGf,EAAW,MAAMA,EAAO,GAAG,EAAO,UAAU,EAAQ,iBAAkB,CACxE,MAAO,CACH,WAAY,wCACZ,OAAQ,4HAIV,EAAQ,EAAS,WAClB,IAAK,GAAa,EAAgB,EAAU,IAC5C,OAAQ,GAAS,IAAS,MAC1B,MAAM,EAAG,IAAM,IAAI,KAAK,EAAE,SAAS,UAAY,IAAI,KAAK,EAAE,SAAS,WACnE,MAAM,EAAG,GAEd,MAAO,CACH,MAAO,YAAY,EAAQ,KAAK,EAAU,UAC1C,KAAM,GAAG,EAAQ,SAAS,IAC1B,YAAa,8CAA8C,IAC3D,KAAM"}