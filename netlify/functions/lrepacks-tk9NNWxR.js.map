{"version":3,"file":"lrepacks-tk9NNWxR.js","names":[],"sources":["../../lib/routes/lrepacks/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = '' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 12;\r\n\r\n    const rootUrl = 'https://lrepacks.net';\r\n    const currentUrl = new URL(category, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('#main article')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const title = item.find('h3.entry-title').text();\r\n            const description = art(path.join(__dirname, 'templates/description.art'), {\r\n                intro: item.find('div.entry-content').text(),\r\n            });\r\n\r\n            return {\r\n                title,\r\n                description,\r\n                link: item.find('h3.entry-title a').prop('href'),\r\n                category: item\r\n                    .find('span.cat-links')\r\n                    .toArray()\r\n                    .map((c) => $(c).text()),\r\n                language,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const data = JSON.parse($$('script[type=\"application/ld+json\"]').first().text())['@graph']?.[0] ?? undefined;\r\n\r\n                $$('div.entry-content a.highslide[href]').each((_, el) => {\r\n                    el = $$(el);\r\n\r\n                    el.parent().replaceWith(\r\n                        art(path.join(__dirname, 'templates/description.art'), {\r\n                            images: [\r\n                                {\r\n                                    src: el.prop('href'),\r\n                                    alt: el.prop('title'),\r\n                                },\r\n                            ],\r\n                        })\r\n                    );\r\n                });\r\n\r\n                const title = $$('h2.entry-title').text();\r\n                const description =\r\n                    item.description +\r\n                    art(path.join(__dirname, 'templates/description.art'), {\r\n                        description: $$('div.entry-content').html(),\r\n                    });\r\n                const image = $$('meta[property=\"og:image\"]').prop('content');\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = data ? parseDate(data.datePublished) : undefined;\r\n                item.author = data?.author?.name ?? undefined;\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.entry-content').text(),\r\n                };\r\n                item.image = image;\r\n                item.banner = image;\r\n                item.updated = data ? parseDate(data.dateModified) : undefined;\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('div.logo img').prop('src'), rootUrl).href;\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        description: $('meta[name=\"description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: $('meta[property=\"og:site_name\"]').prop('content'),\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    name: 'REPACK скачать',\r\n    url: 'lrepacks.net',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/lrepacks',\r\n    parameters: { category: 'Category, Homepage by default' },\r\n    description: `::: tip\r\n  If you subscribe to [Системные программы](https://lrepacks.net/repaki-sistemnyh-programm/)，where the URL is \\`https://lrepacks.net/repaki-sistemnyh-programm/\\`, extract the part \\`https://lrepacks.net/\\` to the end, which is \\`repaki-sistemnyh-programm\\`, and use it as the parameter to fill in. Therefore, the route will be [\\`/lrepacks/repaki-sistemnyh-programm\\`](https://rsshub.app/lrepacks/repaki-sistemnyh-programm).\r\n\r\n| Category                                                                        | ID                                                                                           |\r\n| ------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------- |\r\n| [Новые репаки на сегодня](https://lrepacks.net/novye-repaki-elchupacabra/)      | [novye-repaki-elchupacabra](https://rsshub.app/lrepacks/novye-repaki-elchupacabra)           |\r\n| [Системные программы](https://lrepacks.net/repaki-sistemnyh-programm/)          | [repaki-sistemnyh-programm](https://rsshub.app/lrepacks/repaki-sistemnyh-programm)           |\r\n| [Программы для графики](https://lrepacks.net/repaki-programm-dlya-grafiki/)     | [repaki-programm-dlya-grafiki](https://rsshub.app/lrepacks/repaki-programm-dlya-grafiki)     |\r\n| [Программы для интернета](https://lrepacks.net/repaki-programm-dlya-interneta/) | [repaki-programm-dlya-interneta](https://rsshub.app/lrepacks/repaki-programm-dlya-interneta) |\r\n| [Мультимедиа программы](https://lrepacks.net/repaki-multimedia-programm/)       | [repaki-multimedia-programm](https://rsshub.app/lrepacks/repaki-multimedia-programm)         |\r\n| [Программы для офиса](https://lrepacks.net/repaki-programm-dlya-ofisa/)         | [repaki-programm-dlya-ofisa](https://rsshub.app/lrepacks/repaki-programm-dlya-ofisa)         |\r\n| [Разные программы](https://lrepacks.net/repaki-raznyh-programm/)                | [repaki-raznyh-programm](https://rsshub.app/lrepacks/repaki-raznyh-programm)                 |\r\n| [Системные библиотеки](https://lrepacks.net/sistemnye-biblioteki/)              | [sistemnye-biblioteki](https://rsshub.app/lrepacks/sistemnye-biblioteki)                     |\r\n| [Важная информация](https://lrepacks.net/informaciya/)                          | [informaciya](https://rsshub.app/lrepacks/informaciya)                                       |\r\n:::`,\r\n    categories: ['program-update'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['lrepacks.net/:category'],\r\n            target: (params) => {\r\n                const category = params.category;\r\n\r\n                return `/lrepacks${category ? `/${category}` : ''}`;\r\n            },\r\n        },\r\n        {\r\n            title: 'Новые репаки на сегодня',\r\n            source: ['lrepacks.net/novye-repaki-elchupacabra/'],\r\n            target: '/novye-repaki-elchupacabra',\r\n        },\r\n        {\r\n            title: 'Системные программы',\r\n            source: ['lrepacks.net/repaki-sistemnyh-programm/'],\r\n            target: '/repaki-sistemnyh-programm',\r\n        },\r\n        {\r\n            title: 'Программы для графики',\r\n            source: ['lrepacks.net/repaki-programm-dlya-grafiki/'],\r\n            target: '/repaki-programm-dlya-grafiki',\r\n        },\r\n        {\r\n            title: 'Программы для интернета',\r\n            source: ['lrepacks.net/repaki-programm-dlya-interneta/'],\r\n            target: '/repaki-programm-dlya-interneta',\r\n        },\r\n        {\r\n            title: 'Мультимедиа программы',\r\n            source: ['lrepacks.net/repaki-multimedia-programm/'],\r\n            target: '/repaki-multimedia-programm',\r\n        },\r\n        {\r\n            title: 'Программы для офиса',\r\n            source: ['lrepacks.net/repaki-programm-dlya-ofisa/'],\r\n            target: '/repaki-programm-dlya-ofisa',\r\n        },\r\n        {\r\n            title: 'Разные программы',\r\n            source: ['lrepacks.net/repaki-raznyh-programm/'],\r\n            target: '/repaki-raznyh-programm',\r\n        },\r\n        {\r\n            title: 'Системные библиотеки',\r\n            source: ['lrepacks.net/sistemnye-biblioteki/'],\r\n            target: '/sistemnye-biblioteki',\r\n        },\r\n        {\r\n            title: 'Важная информация',\r\n            source: ['lrepacks.net/informaciya/'],\r\n            target: '/informaciya',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}