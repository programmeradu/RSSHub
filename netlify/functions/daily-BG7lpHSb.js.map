{"version":3,"file":"daily-BG7lpHSb.js","names":[],"sources":["../../lib/routes/guduodata/daily.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport dayjs from 'dayjs';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst host = 'http://d.guduodata.com';\r\n\r\nconst types = {\r\n    collect: {\r\n        name: '汇总榜',\r\n        categories: {\r\n            drama: '连续剧',\r\n            variety: '综艺',\r\n        },\r\n    },\r\n    bill: {\r\n        name: '排行榜',\r\n        categories: {\r\n            network_drama: '网络剧',\r\n            network_movie: '网络大电影',\r\n            network_variety: '网络综艺',\r\n            tv_drama: '电视剧',\r\n            tv_variety: '电视综艺',\r\n            anime: '国漫',\r\n        },\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/daily',\r\n    categories: ['other'],\r\n    example: '/guduodata/daily',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['guduodata.com/'],\r\n        },\r\n    ],\r\n    name: '日榜',\r\n    maintainers: ['Gem1ni'],\r\n    handler,\r\n    url: 'guduodata.com/',\r\n};\r\n\r\nasync function handler() {\r\n    const now = dayjs().valueOf();\r\n    // yestoday\r\n    const yestoday = dayjs().subtract(1, 'day').format('YYYY-MM-DD');\r\n    const renderRows = (rows) => art(path.join(__dirname, './templates/daily.art'), { rows });\r\n    const items = Object.keys(types).flatMap((key) =>\r\n        Object.keys(types[key].categories).map((category) => ({\r\n            type: key,\r\n            name: `[${yestoday}] ${types[key].name} - ${types[key].categories[category]}`,\r\n            category: category.toUpperCase(),\r\n            url: `${host}/m/v3/billboard/list?type=DAILY&category=${category.toUpperCase()}&date=${yestoday}`,\r\n        }))\r\n    );\r\n    return {\r\n        title: `骨朵数据 - 日榜`,\r\n        link: host,\r\n        description: yestoday,\r\n        item: await Promise.all(\r\n            items.map((item) =>\r\n                cache.tryGet(item.url, async () => {\r\n                    const response = await got.get(`${item.url}&t=${now}`, {\r\n                        headers: { Referer: `http://guduodata.com/` },\r\n                    });\r\n                    const data = response.data.data;\r\n                    return {\r\n                        title: item.name,\r\n                        pubDate: yestoday,\r\n                        link: item.url,\r\n                        description: renderRows(data),\r\n                    };\r\n                })\r\n            )\r\n        ),\r\n    };\r\n}\r\n"],"mappings":"yZAQA,MAAM,EAAO,yBAEP,EAAQ,CACV,QAAS,CACL,KAAM,MACN,WAAY,CACR,MAAO,MACP,QAAS,OAGjB,KAAM,CACF,KAAM,MACN,WAAY,CACR,cAAe,MACf,cAAe,QACf,gBAAiB,OACjB,SAAU,MACV,WAAY,OACZ,MAAO,QAKN,EAAe,CACxB,KAAM,SACN,WAAY,CAAC,SACb,QAAS,mBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,oBAGjB,KAAM,KACN,YAAa,CAAC,UACd,UACA,IAAK,kBAGT,eAAe,GAAU,CACrB,IAAM,EAAM,IAAQ,UAEd,EAAW,IAAQ,SAAS,EAAG,OAAO,OAAO,cAC7C,EAAc,GAAS,EAAI,EAAA,KAAA,EAAA,gCAA+C,CAAE,SAC5E,EAAQ,OAAO,KAAK,GAAO,QAAS,GACtC,OAAO,KAAK,EAAM,GAAK,YAAY,IAAK,IAAc,CAClD,KAAM,EACN,KAAM,IAAI,EAAS,IAAI,EAAM,GAAK,KAAK,KAAK,EAAM,GAAK,WAAW,KAClE,SAAU,EAAS,cACnB,IAAK,GAAG,EAAK,2CAA2C,EAAS,cAAc,QAAQ,QAG/F,MAAO,CACH,MAAO,YACP,KAAM,EACN,YAAa,EACb,KAAM,MAAM,QAAQ,IAChB,EAAM,IAAK,GACP,EAAM,OAAO,EAAK,IAAK,SAAY,CAC/B,IAAM,EAAW,MAAM,EAAI,IAAI,GAAG,EAAK,IAAI,KAAK,IAAO,CACnD,QAAS,CAAE,QAAS,2BAElB,EAAO,EAAS,KAAK,KAC3B,MAAO,CACH,MAAO,EAAK,KACZ,QAAS,EACT,KAAM,EAAK,IACX,YAAa,EAAW"}