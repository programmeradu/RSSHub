{"version":3,"file":"search-Dghb2MoR.js","names":["route: Route","ofetch","cache","response"],"sources":["../../lib/routes/stream-capital/utils.ts","../../lib/routes/stream-capital/search.ts"],"sourcesContent":["import CryptoJS from 'crypto-js';\r\n\r\nconst secret = CryptoJS.enc.Utf8.parse('r4rt5A8L6ye6ts8y');\r\nconst iv = CryptoJS.enc.Utf8.parse('fs0Hkjg8a23u8sE0');\r\n\r\nexport const encrypt = (plainText) =>\r\n    CryptoJS.AES.encrypt(plainText, secret, {\r\n        iv,\r\n        mode: CryptoJS.mode.CBC,\r\n        padding: CryptoJS.pad.Pkcs7,\r\n    }).toString();\r\n\r\nexport const decrypt = (encrypted) =>\r\n    CryptoJS.AES.decrypt(encrypted, secret, {\r\n        iv,\r\n        mode: CryptoJS.mode.CBC,\r\n        padding: CryptoJS.pad.Pkcs7,\r\n    }).toString(CryptoJS.enc.Utf8);\r\n","import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { encrypt, decrypt } from './utils';\r\nimport { EncryptedResponse, WebBlog } from './types';\r\nimport cache from '@/utils/cache';\r\n\r\nexport const route: Route = {\r\n    path: '/search',\r\n    name: '最新',\r\n    categories: ['finance'],\r\n    example: '/stream-capital/search',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    radar: [\r\n        {\r\n            source: ['www.stream-capital.com/search'],\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler() {\r\n    const baseUrl = 'https://www.stream-capital.com';\r\n    const apiBaseUrl = 'https://api.yuanchuan.cn';\r\n\r\n    const response = await ofetch<EncryptedResponse>(`${apiBaseUrl}/yc/webbloglist`, {\r\n        method: 'POST',\r\n        query: {\r\n            apptype: 9,\r\n        },\r\n        body: encrypt(\r\n            JSON.stringify({\r\n                type: 0,\r\n                name: null,\r\n                page: 1,\r\n            })\r\n        ),\r\n    });\r\n\r\n    const list = (JSON.parse(decrypt(response.data)).list as WebBlog[]).map((item) => ({\r\n        title: item.title,\r\n        author: item.userName,\r\n        pubDate: timezone(parseDate(item.ctime, 'YYYY-MM-DD HH:mm:ss'), 8),\r\n        link: `${baseUrl}/article/${item.id}`,\r\n        description: item.content,\r\n        category: item.tags.map((t) => t.tagName),\r\n        id: item.id,\r\n    }));\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await ofetch<EncryptedResponse>(`${apiBaseUrl}/yc/webblogdetail`, {\r\n                    method: 'POST',\r\n                    query: {\r\n                        apptype: 9,\r\n                    },\r\n                    body: encrypt(\r\n                        JSON.stringify({\r\n                            blogId: item.id,\r\n                        })\r\n                    ),\r\n                });\r\n\r\n                item.description = (JSON.parse(decrypt(response.data)) as WebBlog).detailInfo.articleContent;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '最新 - 远川研究所',\r\n        link: `${baseUrl}/search`,\r\n        language: 'zh',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"+VAEA,MAAM,EAAS,EAAS,IAAI,KAAK,MAAM,oBACjC,EAAK,EAAS,IAAI,KAAK,MAAM,oBAEtB,EAAW,GACpB,EAAS,IAAI,QAAQ,EAAW,EAAQ,CACpC,KACA,KAAM,EAAS,KAAK,IACpB,QAAS,EAAS,IAAI,QACvB,WAEM,EAAW,GACpB,EAAS,IAAI,QAAQ,EAAW,EAAQ,CACpC,KACA,KAAM,EAAS,KAAK,IACpB,QAAS,EAAS,IAAI,QACvB,SAAS,EAAS,IAAI,MCThBA,EAAe,CACxB,KAAM,UACN,KAAM,KACN,WAAY,CAAC,WACb,QAAS,yBACT,YAAa,CAAC,UACd,UACA,MAAO,CACH,CACI,OAAQ,CAAC,oCAKrB,eAAe,GAAU,CACrB,IAAM,EAAU,iCACV,EAAa,2BAEb,EAAW,MAAMC,EAA0B,GAAG,EAAW,iBAAkB,CAC7E,OAAQ,OACR,MAAO,CACH,QAAS,GAEb,KAAM,EACF,KAAK,UAAU,CACX,KAAM,EACN,KAAM,KACN,KAAM,OAKZ,EAAQ,KAAK,MAAM,EAAQ,EAAS,OAAO,KAAmB,IAAK,IAAU,CAC/E,MAAO,EAAK,MACZ,OAAQ,EAAK,SACb,QAAS,EAAS,EAAU,EAAK,MAAO,uBAAwB,GAChE,KAAM,GAAG,EAAQ,WAAW,EAAK,KACjC,YAAa,EAAK,QAClB,SAAU,EAAK,KAAK,IAAK,GAAM,EAAE,SACjC,GAAI,EAAK,MAGP,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAW,MAAMF,EAA0B,GAAG,EAAW,mBAAoB,CAC/E,OAAQ,OACR,MAAO,CACH,QAAS,GAEb,KAAM,EACF,KAAK,UAAU,CACX,OAAQ,EAAK,QAOzB,MAFA,GAAK,YAAe,KAAK,MAAM,EAAQE,EAAS,OAAmB,WAAW,eAEvE,MAKnB,MAAO,CACH,MAAO,aACP,KAAM,GAAG,EAAQ,SACjB,SAAU,KACV,KAAM"}