{"version":3,"file":"common-DB3fK00k.js","names":[],"sources":["../../lib/routes/nber/common.ts"],"sourcesContent":["import { getSubPath } from '@/utils/common-utils';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { config } from '@/config';\r\n\r\nasync function getData(url) {\r\n    const response = await ofetch(url);\r\n    return response.results;\r\n}\r\nexport async function handler(ctx) {\r\n    const url = 'https://www.nber.org/api/v1/working_page_listing/contentType/working_paper/_/_/search';\r\n    const baseUrl = 'https://www.nber.org';\r\n    const data = await cache.tryGet(url, () => getData(url), config.cache.routeExpire, false);\r\n    const items = await Promise.all(\r\n        data\r\n            .filter((article) => getSubPath(ctx) === '/papers' || article.newthisweek)\r\n            .map((article) => {\r\n                const link = `${baseUrl}${article.url}`;\r\n                return cache.tryGet(link, async () => {\r\n                    const response = await ofetch(link);\r\n                    const $ = load(response);\r\n                    const downloadLink = $('meta[name=\"citation_pdf_url\"]').attr('content');\r\n                    const fullAbstract = $('.page-header__intro-inner').html();\r\n                    return {\r\n                        title: article.title,\r\n                        author: $('meta[name=\"dcterms.creator\"]').attr('content'),\r\n                        pubDate: parseDate($('meta[name=\"citation_publication_date\"]').attr('content'), 'YYYY/MM/DD'),\r\n                        link,\r\n                        doi: $('meta[name=\"citation_doi\"]').attr('content'),\r\n                        description: art(path.join(__dirname, 'template/description.art'), {\r\n                            fullAbstract,\r\n                            downloadLink,\r\n                        }),\r\n                    };\r\n                });\r\n            })\r\n    );\r\n\r\n    return {\r\n        title: 'NBER Working Paper',\r\n        link: 'https://www.nber.org/papers',\r\n        item: items,\r\n        description: `National Bureau of Economic Research Working Papers articles`,\r\n    };\r\n}\r\n"],"mappings":"obASA,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,MAAM,EAAO,GAC9B,OAAO,EAAS,QAEpB,eAAsB,EAAQ,EAAK,CAC/B,IAAM,EAAM,wFAEN,EAAO,MAAM,EAAM,OAAO,MAAW,EAAQ,GAAM,EAAO,MAAM,YAAa,IAC7E,EAAQ,MAAM,QAAQ,IACxB,EACK,OAAQ,GAAY,EAAW,KAAS,WAAa,EAAQ,aAC7D,IAAK,GAAY,CACd,IAAM,EAAO,uBAAa,EAAQ,MAClC,OAAO,EAAM,OAAO,EAAM,SAAY,CAClC,IAAM,EAAW,MAAM,EAAO,GACxB,EAAI,EAAK,GACT,EAAe,EAAE,iCAAiC,KAAK,WACvD,EAAe,EAAE,6BAA6B,OACpD,MAAO,CACH,MAAO,EAAQ,MACf,OAAQ,EAAE,gCAAgC,KAAK,WAC/C,QAAS,EAAU,EAAE,0CAA0C,KAAK,WAAY,cAChF,OACA,IAAK,EAAE,6BAA6B,KAAK,WACzC,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAkD,CAC/D,eACA,uBAOxB,MAAO,CACH,MAAO,qBACP,KAAM,8BACN,KAAM,EACN,YAAa"}