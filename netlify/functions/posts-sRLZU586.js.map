{"version":3,"file":"posts-sRLZU586.js","names":["route: Route","cache","ofetch"],"sources":["../../lib/routes/zhihu/posts.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport cache from '@/utils/cache';\r\nimport { header, getSignedHeader, processImage } from './utils';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { Articles, Profile } from './types';\r\n\r\nexport const route: Route = {\r\n    path: '/posts/:usertype/:id',\r\n    categories: ['social-media'],\r\n    example: '/zhihu/posts/people/frederchen',\r\n    parameters: { usertype: '作者 id，可在用户主页 URL 中找到', id: '用户类型usertype，参考用户主页的URL。目前有两种，见下表' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.zhihu.com/:usertype/:id/posts', 'www.zhihu.com/:usertype/:id'],\r\n        },\r\n    ],\r\n    name: '用户文章',\r\n    maintainers: ['whtsky', 'Colin-XKL'],\r\n    handler,\r\n    description: `| 普通用户 | 机构用户 |\r\n| -------- | -------- |\r\n| people   | org      |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const usertype = ctx.req.param('usertype');\r\n\r\n    const userProfile = await cache.tryGet(`zhihu:posts:profile:${id}`, async () => {\r\n        const userAPIPath = `/api/v4/${usertype === 'people' ? 'members' : 'org'}/${id}?${new URLSearchParams({\r\n            include: 'allow_message,is_followed,is_following,is_org,is_blocking,employments,answer_count,follower_count,articles_count,gender,badge[?(type=best_answerer)].topics',\r\n        })}`;\r\n\r\n        return await ofetch<Profile>(`https://www.zhihu.com${userAPIPath}`, {\r\n            headers: {\r\n                ...header,\r\n                ...(await getSignedHeader(`https://www.zhihu.com/${usertype}/${id}/`, userAPIPath)),\r\n                Referer: `https://www.zhihu.com/${usertype}/${id}/`,\r\n            },\r\n        });\r\n    });\r\n\r\n    const apiPath = `/api/v4/${usertype === 'people' ? 'members' : 'org'}/${id}/articles?${new URLSearchParams({\r\n        include:\r\n            'data[*].comment_count,suggest_edit,is_normal,thumbnail_extra_info,thumbnail,can_comment,comment_permission,admin_closed_comment,content,voteup_count,created,updated,upvoted_followees,voting,review_info,reaction_instruction,is_labeled,label_info;data[*].vessay_info;data[*].author.badge[?(type=best_answerer)].topics;data[*].author.vip_info;',\r\n        offset: '0',\r\n        limit: '20',\r\n        sort_by: 'created',\r\n    })}`;\r\n\r\n    const signedHeader = await getSignedHeader(`https://www.zhihu.com/${usertype}/${id}/posts`, apiPath);\r\n\r\n    const articleResponse = await ofetch<Articles>(`https://www.zhihu.com${apiPath}`, {\r\n        headers: {\r\n            ...header,\r\n            ...signedHeader,\r\n            Referer: `https://www.zhihu.com/${usertype}/${id}/posts`,\r\n        },\r\n    });\r\n\r\n    const items = articleResponse.data.map((item) => ({\r\n        title: item.title,\r\n        description: processImage(item.content),\r\n        link: `https://zhuanlan.zhihu.com/p/${item.id}`,\r\n        pubDate: parseDate(item.created, 'X'),\r\n        updated: parseDate(item.updated, 'X'),\r\n        author: item.author.name,\r\n    }));\r\n\r\n    return {\r\n        title: `${userProfile.name} 的知乎文章`,\r\n        link: `https://www.zhihu.com/${usertype}/${id}/posts`,\r\n        description: userProfile.headline,\r\n        image: userProfile.avatar_url.split('?')[0],\r\n        // banner: userData?.coverUrl?.split('?')[0],\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"kYAOA,MAAaA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,gBACb,QAAS,iCACT,WAAY,CAAE,SAAU,uBAAwB,GAAI,qCACpD,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,oCAAqC,iCAGtD,KAAM,OACN,YAAa,CAAC,SAAU,aACxB,UACA,YAAa;;0BAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAW,EAAI,IAAI,MAAM,YAEzB,EAAc,MAAMC,EAAM,OAAO,uBAAuB,IAAM,SAAY,CAC5E,IAAM,EAAc,WAAW,IAAa,SAAW,UAAY,MAAM,GAAG,EAAG,GAAG,IAAI,gBAAgB,CAClG,QAAS,kKAGb,OAAO,MAAMC,EAAgB,wBAAwB,IAAe,CAChE,QAAS,CACL,GAAG,EACH,GAAI,MAAM,EAAgB,yBAAyB,EAAS,GAAG,EAAG,GAAI,GACtE,QAAS,yBAAyB,EAAS,GAAG,EAAG,QAKvD,EAAU,WAAW,IAAa,SAAW,UAAY,MAAM,GAAG,EAAG,YAAY,IAAI,gBAAgB,CACvG,QACI,uVACJ,OAAQ,IACR,MAAO,KACP,QAAS,cAGP,EAAe,MAAM,EAAgB,yBAAyB,EAAS,GAAG,EAAG,QAAS,GAEtF,EAAkB,MAAMA,EAAiB,wBAAwB,IAAW,CAC9E,QAAS,CACL,GAAG,EACH,GAAG,EACH,QAAS,yBAAyB,EAAS,GAAG,EAAG,WAInD,EAAQ,EAAgB,KAAK,IAAK,IAAU,CAC9C,MAAO,EAAK,MACZ,YAAa,EAAa,EAAK,SAC/B,KAAM,gCAAgC,EAAK,KAC3C,QAAS,EAAU,EAAK,QAAS,KACjC,QAAS,EAAU,EAAK,QAAS,KACjC,OAAQ,EAAK,OAAO,QAGxB,MAAO,CACH,MAAO,GAAG,EAAY,KAAK,QAC3B,KAAM,yBAAyB,EAAS,GAAG,EAAG,QAC9C,YAAa,EAAY,SACzB,MAAO,EAAY,WAAW,MAAM,KAAK,GAEzC,KAAM"}