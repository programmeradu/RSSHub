{"version":3,"file":"u3c3-CPR31yBq.js","names":["route: Route","got","title","cache","response","$"],"sources":["../../lib/routes/u3c3/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: ['/search/:keyword/:preview?', '/:type?/:preview?'],\r\n    categories: ['multimedia'],\r\n    example: '/u3c3/search/新片速递',\r\n    parameters: { keyword: 'Search keyword', preview: 'Show image preview, off by default, non empty value means on' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: true,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Search',\r\n    maintainers: ['storytellerF'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { type, keywoard, preview } = ctx.req.param();\r\n    // should be:\r\n    // undefined\r\n    // U3C3\r\n    // Videos\r\n    // Photo\r\n    // Book\r\n    // Game\r\n    // Software\r\n    // Other\r\n    const rootURL = 'https://www.u3c3.com';\r\n    let currentURL;\r\n    let title;\r\n    if (keywoard) {\r\n        currentURL = `${rootURL}/?search=${keywoard}`;\r\n        title = `search ${keywoard} - u3c3`;\r\n    } else if (type === undefined) {\r\n        currentURL = rootURL;\r\n        title = 'home - u3c3';\r\n    } else {\r\n        currentURL = `${rootURL}/?type=${type}&p=1`;\r\n        title = `${type} - u3c3`;\r\n    }\r\n\r\n    const response = await got(currentURL);\r\n    const $ = load(response.data);\r\n\r\n    const list = $('body > div.container > div.table-responsive > table > tbody > tr')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const title = item.find('td:nth-of-type(2) > a ').attr('title');\r\n            const guid = rootURL + item.find('td:nth-of-type(2) > a').attr('href');\r\n            const link = guid;\r\n            const pubDate = item.find('td:nth-of-type(5)').text();\r\n            const enclosure_url = item.find('td:nth-of-type(3) > a:nth-of-type(2)').attr('href');\r\n            return {\r\n                title,\r\n                guid,\r\n                link,\r\n                pubDate,\r\n\r\n                enclosure_url,\r\n                enclosure_type: 'application/x-bittorrent',\r\n            };\r\n        });\r\n\r\n    const items = preview\r\n        ? await Promise.all(\r\n              list.map((item) =>\r\n                  cache.tryGet(item.link, async () => {\r\n                      const { data: response } = await got(item.link);\r\n                      const $ = load(response);\r\n\r\n                      item.description = $('div.panel-footer > img:first-child').parent().html();\r\n\r\n                      return item;\r\n                  })\r\n              )\r\n          )\r\n        : list;\r\n\r\n    return {\r\n        title,\r\n        description: title,\r\n        link: currentURL,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mTAKA,MAAaA,EAAe,CACxB,KAAM,CAAC,6BAA8B,qBACrC,WAAY,CAAC,cACb,QAAS,oBACT,WAAY,CAAE,QAAS,iBAAkB,QAAS,gEAClD,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,gBACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAM,WAAU,WAAY,EAAI,IAAI,QAUtC,EAAU,uBACZ,EACA,EACA,GACA,EAAa,GAAG,EAAQ,WAAW,IACnC,EAAQ,UAAU,EAAS,UACpB,IAAS,IAAA,IAChB,EAAa,EACb,EAAQ,gBAER,EAAa,GAAG,EAAQ,SAAS,EAAK,MACtC,EAAQ,GAAG,EAAK,UAGpB,IAAM,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,oEACV,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAMC,EAAQ,EAAK,KAAK,0BAA0B,KAAK,SACjD,EAAO,EAAU,EAAK,KAAK,yBAAyB,KAAK,QACzD,EAAO,EACP,EAAU,EAAK,KAAK,qBAAqB,OACzC,EAAgB,EAAK,KAAK,wCAAwC,KAAK,QAC7E,MAAO,CACH,MAAA,EACA,OACA,OACA,UAEA,gBACA,eAAgB,8BAItB,EAAQ,EACR,MAAM,QAAQ,IACV,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMH,EAAI,EAAK,MACpCI,EAAI,EAAKD,GAIf,MAFA,GAAK,YAAcC,EAAE,sCAAsC,SAAS,OAE7D,MAInB,EAEN,MAAO,CACH,QACA,YAAa,EACb,KAAM,EACN,KAAM"}