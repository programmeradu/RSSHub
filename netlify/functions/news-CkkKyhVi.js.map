{"version":3,"file":"news-CkkKyhVi.js","names":["route: Route","got"],"sources":["../../lib/routes/mihoyo/ys/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst categories = {\r\n    latest: {\r\n        main: {\r\n            id: 719,\r\n            slug: 719,\r\n            title: '最新',\r\n        },\r\n        'zh-tw': {\r\n            id: 395,\r\n            slug: 395,\r\n            title: '最新',\r\n        },\r\n    },\r\n    news: {\r\n        main: {\r\n            id: 720,\r\n            slug: 720,\r\n            title: '新闻',\r\n        },\r\n        'zh-tw': {\r\n            id: 396,\r\n            slug: 396,\r\n            title: '資訊',\r\n        },\r\n    },\r\n    notice: {\r\n        main: {\r\n            id: 721,\r\n            slug: 721,\r\n            title: '公告',\r\n        },\r\n        'zh-tw': {\r\n            id: 397,\r\n            slug: 397,\r\n            title: '公告',\r\n        },\r\n    },\r\n    activity: {\r\n        main: {\r\n            id: 722,\r\n            slug: 722,\r\n            title: '活动',\r\n        },\r\n        'zh-tw': {\r\n            id: 398,\r\n            slug: 398,\r\n            title: '活動',\r\n        },\r\n    },\r\n};\r\n\r\nconst rootUrls = {\r\n    main: 'https://ys.mihoyo.com',\r\n    'zh-tw': 'https://genshin.hoyoverse.com',\r\n};\r\n\r\nconst apiRootUrls = {\r\n    main: 'https://api-takumi-static.mihoyo.com',\r\n    'zh-tw': 'https://api-os-takumi-static.hoyoverse.com',\r\n};\r\n\r\nconst currentUrls = {\r\n    main: '/main/news',\r\n    'zh-tw': '/zh-tw/news',\r\n};\r\n\r\nconst apiUrls = {\r\n    main: '/content_v2_user/app/16471662a82d418a/getContentList',\r\n    'zh-tw': '/content_v2_user/app/a1b1f9d3315447cc/getContentList',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/ys/:location?/:category?',\r\n    categories: ['game'],\r\n    example: '/mihoyo/ys',\r\n    parameters: { location: '区域，可选 `main`（简中）或 `zh-tw`（繁中）', category: '分类，见下表，默认为最新' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['genshin.hoyoverse.com/:location/news'],\r\n            target: '/ys/:location',\r\n        },\r\n    ],\r\n    name: '原神',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `#### 新闻 {#mi-ha-you-yuan-shen-xin-wen}\r\n\r\n| 最新   | 新闻 | 公告   | 活动     |\r\n| ------ | ---- | ------ | -------- |\r\n| latest | news | notice | activity |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const location = ctx.req.param('location') ?? 'main';\r\n    const category = ctx.req.param('category') ?? 'latest';\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 50;\r\n\r\n    const params = {\r\n        main: `iPage=1&sLangKey=zh-cn&iChanId=${categories[category][location].id}&iPageSize=${limit}`,\r\n        'zh-tw': `iPage=1&sLangKey=zh-tw&iChanId=${categories[category][location].id}&iPageSize=${limit}`,\r\n    };\r\n\r\n    const rootUrl = rootUrls[location];\r\n    const apiRootUrl = apiRootUrls[location];\r\n    const apiUrl = `${apiRootUrl}${apiUrls[location]}?${params[location]}`;\r\n    const currentUrl = `${rootUrl}${currentUrls[location]}/${categories[category][location].slug}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: apiUrl,\r\n    });\r\n\r\n    const list = response.data.data.list;\r\n    const items = list.map((item) => ({\r\n        title: item.sTitle,\r\n        description: item.sContent,\r\n        link: `${rootUrl}${currentUrls[location]}/detail/${item.iInfoId}`,\r\n        pubDate: parseDate(item.dtStartTime),\r\n        category: item.sCategoryName,\r\n    }));\r\n\r\n    return {\r\n        title: `原神 - ${categories[category][location].title}`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"qRAIA,MAAM,EAAa,CACf,OAAQ,CACJ,KAAM,CACF,GAAI,IACJ,KAAM,IACN,MAAO,MAEX,QAAS,CACL,GAAI,IACJ,KAAM,IACN,MAAO,OAGf,KAAM,CACF,KAAM,CACF,GAAI,IACJ,KAAM,IACN,MAAO,MAEX,QAAS,CACL,GAAI,IACJ,KAAM,IACN,MAAO,OAGf,OAAQ,CACJ,KAAM,CACF,GAAI,IACJ,KAAM,IACN,MAAO,MAEX,QAAS,CACL,GAAI,IACJ,KAAM,IACN,MAAO,OAGf,SAAU,CACN,KAAM,CACF,GAAI,IACJ,KAAM,IACN,MAAO,MAEX,QAAS,CACL,GAAI,IACJ,KAAM,IACN,MAAO,QAKb,EAAW,CACb,KAAM,wBACN,QAAS,iCAGP,EAAc,CAChB,KAAM,uCACN,QAAS,8CAGP,EAAc,CAChB,KAAM,aACN,QAAS,eAGP,EAAU,CACZ,KAAM,uDACN,QAAS,wDAGAA,EAAe,CACxB,KAAM,4BACN,WAAY,CAAC,QACb,QAAS,aACT,WAAY,CAAE,SAAU,gCAAiC,SAAU,gBACnE,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,wCACT,OAAQ,kBAGhB,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa;;;;wCAOjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,OACxC,EAAW,EAAI,IAAI,MAAM,aAAe,SACxC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GAE3E,EAAS,CACX,KAAM,kCAAkC,EAAW,GAAU,GAAU,GAAG,aAAa,IACvF,QAAS,kCAAkC,EAAW,GAAU,GAAU,GAAG,aAAa,KAGxF,EAAU,EAAS,GACnB,EAAa,EAAY,GACzB,EAAS,GAAG,IAAa,EAAQ,GAAU,GAAG,EAAO,KACrD,EAAa,GAAG,IAAU,EAAY,GAAU,GAAG,EAAW,GAAU,GAAU,OAElF,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAO,EAAS,KAAK,KAAK,KAC1B,EAAQ,EAAK,IAAK,IAAU,CAC9B,MAAO,EAAK,OACZ,YAAa,EAAK,SAClB,KAAM,GAAG,IAAU,EAAY,GAAU,UAAU,EAAK,UACxD,QAAS,EAAU,EAAK,aACxB,SAAU,EAAK,iBAGnB,MAAO,CACH,MAAO,QAAQ,EAAW,GAAU,GAAU,QAC9C,KAAM,EACN,KAAM"}