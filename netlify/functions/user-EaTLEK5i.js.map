{"version":3,"file":"user-EaTLEK5i.js","names":["route: Route","InvalidParameterError","got","cache","response","$","data"],"sources":["../../lib/routes/zcool/user.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { extractArticle, extractWork } from './utils';\r\nimport { isValidHost } from '@/utils/valid-host';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: '/user/:uid',\r\n    categories: ['design'],\r\n    view: ViewType.Pictures,\r\n    example: '/zcool/user/baiyong',\r\n    parameters: { uid: '个性域名前缀或者用户ID' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.zcool.com.cn/u/:id'],\r\n            target: '/user/:id',\r\n        },\r\n    ],\r\n    name: '用户作品',\r\n    description: `  例如:\r\n\r\n    站酷的个人主页 \\`https://baiyong.zcool.com.cn\\` 对应 rss 路径 \\`/zcool/user/baiyong\\`\r\n\r\n    站酷的个人主页 \\`https://www.zcool.com.cn/u/568339\\` 对应 rss 路径 \\`/zcool/user/568339\\``,\r\n    maintainers: ['junbaor'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const uid = ctx.req.param('uid');\r\n    let pageUrl = `https://www.zcool.com.cn/u/${uid}`;\r\n    if (Number.isNaN(uid)) {\r\n        if (!isValidHost(uid)) {\r\n            throw new InvalidParameterError('Invalid uid');\r\n        }\r\n        pageUrl = `https://${uid}.zcool.com.cn`;\r\n    }\r\n    const { data: response } = await got(pageUrl);\r\n    const $ = load(response);\r\n    const data = JSON.parse($('script#__NEXT_DATA__').text());\r\n\r\n    const workList = data.props.pageProps.workList.map((item) => ({\r\n        title: item.title,\r\n        link: item.pageUrl,\r\n        pubDate: parseDate(item.publishTime, 'x'),\r\n        category: [item.objectTypeStr, item.cateStr, item.subCateStr, ...item.tags],\r\n    }));\r\n\r\n    const items = await Promise.all(\r\n        workList.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n\r\n                const data = JSON.parse($('script#__NEXT_DATA__').text());\r\n                if (item.link.startsWith('https://www.zcool.com.cn/article/')) {\r\n                    item.description = extractArticle(data);\r\n                } else if (item.link.startsWith('https://www.zcool.com.cn/work/')) {\r\n                    item.description = extractWork(data);\r\n                }\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: data.props.pageProps.seo.title,\r\n        description: data.props.pageProps.seo.description,\r\n        image: data.props.pageProps.userInfo.avatar.includes('?x-oss-process') ? data.props.pageProps.userInfo.avatar.split('?')[0] : data.props.pageProps.userInfo.avatar,\r\n        link: pageUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"6nBASA,MAAaA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,UACb,KAAM,EAAS,SACf,QAAS,sBACT,WAAY,CAAE,IAAK,gBACnB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,0BACT,OAAQ,cAGhB,KAAM,OACN,YAAa,wKAKb,YAAa,CAAC,WACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,EAAI,IAAI,MAAM,OACtB,EAAU,8BAA8B,IAC5C,GAAI,OAAO,MAAM,GAAM,CACnB,GAAI,CAAC,EAAY,GACb,MAAM,IAAIC,EAAsB,eAEpC,EAAU,WAAW,EAAI,eAE7B,GAAM,CAAE,KAAM,GAAa,MAAMC,EAAI,GAC/B,EAAI,EAAK,GACT,EAAO,KAAK,MAAM,EAAE,wBAAwB,QAE5C,EAAW,EAAK,MAAM,UAAU,SAAS,IAAK,IAAU,CAC1D,MAAO,EAAK,MACZ,KAAM,EAAK,QACX,QAAS,EAAU,EAAK,YAAa,KACrC,SAAU,CAAC,EAAK,cAAe,EAAK,QAAS,EAAK,WAAY,GAAG,EAAK,SAGpE,EAAQ,MAAM,QAAQ,IACxB,EAAS,IAAK,GACVC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAETE,EAAO,KAAK,MAAMD,EAAE,wBAAwB,QAOlD,OANI,EAAK,KAAK,WAAW,qCACrB,EAAK,YAAc,EAAeC,GAC3B,EAAK,KAAK,WAAW,oCAC5B,EAAK,YAAc,EAAYA,IAG5B,MAKnB,MAAO,CACH,MAAO,EAAK,MAAM,UAAU,IAAI,MAChC,YAAa,EAAK,MAAM,UAAU,IAAI,YACtC,MAAO,EAAK,MAAM,UAAU,SAAS,OAAO,SAAS,kBAAoB,EAAK,MAAM,UAAU,SAAS,OAAO,MAAM,KAAK,GAAK,EAAK,MAAM,UAAU,SAAS,OAC5J,KAAM,EACN,KAAM"}