import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import"./md5-4BNsOP-F.js";import"./ofetch-Bzt0BXUH.js";import{got_default as n}from"./got-CdvI2yKX.js";import"./config-not-found-BVqhRP9D.js";import{_access_default as r,_constants_default as i,getFilteredLanguages as a,getMangaMetaByIds as o,toQueryString as s}from"./_feed-BTGNS7pd.js";const c={path:`/user/feed/follow/:lang?`,name:` Follows Feed`,maintainers:[`chrisis58`],description:`Get the latest updates of all the manga you follow on MangaDex.`,example:`/mangadex/user/feed/follow/zh?limit=10`,radar:[{source:[`mangadex.org/titles/feed`],target:`/user/feed/follow`}],categories:[`anime`],parameters:{lang:{description:`The language of the followed manga`}},features:{requireConfig:[{name:`MANGADEX_USERNAME`,description:`MangaDex Username, required when refresh-token is not set`,optional:!0},{name:`MANGADEX_PASSWORD`,description:`MangaDex Password, required when refresh-token is not set`,optional:!0},{name:`MANGADEX_CLIENT_ID`,description:`MangaDex Client ID`,optional:!1},{name:`MANGADEX_CLIENT_SECRET`,description:`MangaDex Client Secret`,optional:!1},{name:`MANGADEX_REFRESH_TOKEN`,description:`MangaDex Refresh Token, required when username and password are not set`,optional:!0}]},handler:l};async function l(c){let l=`${i.API.BASE}/user/follows/manga/feed`,{lang:u}=c.req.param(),d=c.req.query(`limit`)?Number.parseInt(c.req.query(`limit`)):25,f=await r(),p=new Set([...typeof u==`string`?[u]:u||[],...await a()].filter(Boolean)),m=await t.tryGet(`mangadex:user-follows`,async()=>{let t=await n.get(`${l}${s({translatedLanguage:p,order:{publishAt:`desc`},limit:d})}`,{headers:{Authorization:`Bearer ${f}`,"User-Agent":e.trueUA}}),r=t?.data?.data;if(!r)throw Error(`Failed to retrieve user follows from MangaDex API.`);return r},e.cache.routeExpire,!1),h=m.map(e=>e?.relationships.find(e=>e.type===`manga`)?.id),g=await o(h);return{title:`User Follows`,link:`https://mangadex.org/titles/feed`,description:`The latest updates of all the manga you follow on MangaDex.`,item:m.map(e=>{let t=e.relationships.find(e=>e.type===`manga`)?.id,n=g.get(t),r=[e.attributes.volume?`Vol. ${e.attributes.volume}`:null,e.attributes.chapter?`Ch. ${e.attributes.chapter}`:null,e.attributes.title].filter(Boolean).join(` `);return{title:n?.title||`Unknown`,link:`${i.API.MANGA_CHAPTERS}${e.id}`,pubDate:new Date(e.attributes.publishAt),description:r,image:n?.cover}})}}export{c as route};
//# sourceMappingURL=feed-D80ugfjG.js.map