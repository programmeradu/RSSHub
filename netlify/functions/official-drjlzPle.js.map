{"version":3,"file":"official-drjlzPle.js","names":["route: Route","RSSParser","got"],"sources":["../../lib/routes/discourse/official.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { getConfig } from './utils';\r\nimport got from '@/utils/got';\r\nimport RSSParser from '@/utils/rss-parser';\r\n\r\nexport const route: Route = {\r\n    path: '/:configId/official/:path{.+}',\r\n    categories: ['bbs'],\r\n    example: '/discourse/0/official/latest',\r\n    parameters: {\r\n        configId: 'Environment variable configuration id, see above',\r\n        path: 'Discourse RSS path between `domain` and `.rss`. All supported Rss path can be found in [https://meta.discourse.org/t/finding-discourse-rss-feeds/264134](https://meta.discourse.org/t/finding-discourse-rss-feeds/264134). For example: the path of [https://meta.discourse.org/top/all.rss](https://meta.discourse.org/top/all.rss) is `top/all`.',\r\n    },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'DISCOURSE_CONFIG_*',\r\n                description: `Configure the Discourse environment variables referring to [https://docs.rsshub.app/deploy/config#discourse](https://docs.rsshub.app/deploy/config#discourse).`,\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Official RSS',\r\n    maintainers: ['Raikyou', 'dzx-dzx'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { link, key } = getConfig(ctx);\r\n    const path = ctx.req.param('path');\r\n\r\n    const url = `${link}/${path}.rss`;\r\n\r\n    const feed = await RSSParser.parseString(\r\n        (\r\n            await got(url, {\r\n                headers: {\r\n                    'User-Api-Key': key,\r\n                },\r\n            })\r\n        ).data\r\n    );\r\n\r\n    feed.items = feed.items.map((e) => ({\r\n        description: e.content,\r\n        author: e.creator,\r\n        ...e,\r\n    }));\r\n\r\n    return { item: feed.items, ...feed };\r\n}\r\n"],"mappings":"qXAKA,MAAaA,EAAe,CACxB,KAAM,gCACN,WAAY,CAAC,OACb,QAAS,+BACT,WAAY,CACR,SAAU,mDACV,KAAM,sVAEV,SAAU,CACN,cAAe,CACX,CACI,KAAM,qBACN,YAAa,mKAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,eACN,YAAa,CAAC,UAAW,WACzB,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAM,OAAQ,EAAU,GAC1B,EAAO,EAAI,IAAI,MAAM,QAErB,EAAM,GAAG,EAAK,GAAG,EAAK,MAEtB,EAAO,MAAMC,EAAU,aAErB,MAAMC,EAAI,EAAK,CACX,QAAS,CACL,eAAgB,MAG1B,MASN,MANA,GAAK,MAAQ,EAAK,MAAM,IAAK,IAAO,CAChC,YAAa,EAAE,QACf,OAAQ,EAAE,QACV,GAAG,KAGA,CAAE,KAAM,EAAK,MAAO,GAAG"}