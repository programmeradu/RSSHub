{"version":3,"file":"category-20Y3bbwo.js","names":["ofetch"],"sources":["../../lib/routes/dlnews/utils.ts","../../lib/routes/dlnews/category.ts"],"sourcesContent":["import ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst baseUrl = 'https://www.dlnews.com';\r\nconst getData = async (url) => (await ofetch(url)).content_elements;\r\n\r\nconst getList = (data) =>\r\n    data.map((value) => {\r\n        const { _id, headlines, description, publish_date, website_url, taxonomy, credits, promo_items } = value;\r\n        return {\r\n            id: _id,\r\n            title: headlines.basic,\r\n            link: `${baseUrl}${website_url}`,\r\n            description: description.basic,\r\n            author: credits.by.map((v) => v.name).join(', '),\r\n            itunes_item_image: promo_items.basic.url,\r\n            pubDate: parseDate(publish_date),\r\n            category: taxonomy.sections.map((v) => v.name).join(', '),\r\n        };\r\n    });\r\n\r\nexport { getData, getList };\r\n","import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport { getData, getList } from './utils';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport pMap from 'p-map';\r\n\r\nconst _website = 'dlnews';\r\nconst topics = {\r\n    defi: 'DeFi',\r\n    fintech: 'Fintech/VC/Deals',\r\n    'llama-u': 'Llama U',\r\n    markets: 'Markets',\r\n    'people-culture': 'People & Culture',\r\n    regulation: 'Regulation',\r\n    snapshot: 'Snapshot',\r\n    web3: 'Web3',\r\n};\r\nconst extractArticle = (item) =>\r\n    cache.tryGet(item.link, async () => {\r\n        const { data: response } = await got(item.link);\r\n        const $ = load(response);\r\n        const scriptTagContent = $('script#fusion-metadata').text();\r\n        const jsonData = JSON.parse(scriptTagContent.match(/Fusion\\.globalContent=({.*?});Fusion\\.globalContentConfig/)[1]).content_elements;\r\n        const filteredData = [];\r\n        for (const v of jsonData) {\r\n            if (v.type === 'header' && v.content.includes('What weâ€™re reading')) {\r\n                break;\r\n            } else if (v.type === 'custom_embed' && Boolean(v.embed.config.text)) {\r\n                filteredData.push({ type: v.type, data: v.embed.config.text });\r\n            } else if (v.type === 'text' && !v.content.includes('<b>NOW READ: </b>')) {\r\n                filteredData.push({ type: v.type, data: v.content });\r\n            } else {\r\n                switch (v.type) {\r\n                    case 'header':\r\n                        filteredData.push({ type: v.type, data: v.content });\r\n\r\n                        break;\r\n\r\n                    case 'list':\r\n                        filteredData.push({ type: v.type, list_type: v.list_type, items: v.items });\r\n\r\n                        break;\r\n\r\n                    case 'image':\r\n                        filteredData.push({ type: v.type, src: v.url, alt: v.alt_text, caption: v.subtitle });\r\n\r\n                        break;\r\n\r\n                    default:\r\n                        throw new Error(`Unknown type: ${v.type}`);\r\n                }\r\n            }\r\n        }\r\n        item.description = art(path.resolve(__dirname, 'templates/description.art'), filteredData);\r\n        return item;\r\n    });\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    radar: [\r\n        {\r\n            source: ['dlnews.com/articles/:category'],\r\n            target: '/:category',\r\n        },\r\n    ],\r\n    url: 'dlnews.com/articles',\r\n    name: 'Latest News',\r\n    maintainers: ['Rjnishant530'],\r\n    handler,\r\n    example: '/dlnews/people-culture',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category');\r\n    const baseUrl = 'https://www.dlnews.com';\r\n    const apiPath = '/pf/api/v3/content/fetch/articles-api';\r\n    const vertical = category ?? '';\r\n\r\n    const query = {\r\n        author: '',\r\n        date: 'now-1y/d',\r\n        offset: 0,\r\n        query: '',\r\n        size: 15,\r\n        sort: 'display_date:desc',\r\n        vertical,\r\n    };\r\n    const data = await getData(`${baseUrl}${apiPath}?query=${encodeURIComponent(JSON.stringify(query))}&_website=${_website}`);\r\n    const list = getList(data);\r\n    const items = await pMap(list, (item) => extractArticle(item), { concurrency: 3 });\r\n\r\n    return {\r\n        title: Object.hasOwn(topics, category) ? `${topics[category]} : DL News` : 'DL News',\r\n        link: baseUrl,\r\n        item: items,\r\n        description: Object.hasOwn(topics, category) ? `${topics[category]} : News on dlnews.com` : 'Latest News on dlnews.com',\r\n        logo: 'https://www.dlnews.com/pf/resources/favicon.ico?d=284',\r\n        icon: 'https://www.dlnews.com/pf/resources/favicon.ico?d=284',\r\n        language: 'en-us',\r\n    };\r\n}\r\n"],"mappings":"sgBAGA,MACA,EAAA,KAAA,KAAA,MAAA,EAAA,IAAA,iBAEA,EAAA,GAAA,EAAA,IAAA,GAAA,wGAGQ,MAAA,4MCEF,EAAS,CACX,KAAM,OACN,QAAS,mBACT,UAAW,UACX,QAAS,UACT,iBAAkB,mBAClB,WAAY,aACZ,SAAU,WACV,KAAM,QAEJ,EAAkB,GACpB,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAa,MAAM,EAAI,EAAK,MACpC,EAAI,EAAK,GACT,EAAmB,EAAE,0BAA0B,OAC/C,EAAW,KAAK,MAAM,EAAiB,MAAM,6DAA6D,IAAI,iBAC9G,EAAe,GACrB,IAAK,IAAM,KAAK,EACZ,GAAI,EAAE,OAAS,UAAY,EAAE,QAAQ,SAAS,sBAC1C,cACO,EAAE,OAAS,gBAA0B,EAAE,MAAM,OAAO,KAC3D,EAAa,KAAK,CAAE,KAAM,EAAE,KAAM,KAAM,EAAE,MAAM,OAAO,eAChD,EAAE,OAAS,QAAU,CAAC,EAAE,QAAQ,SAAS,qBAChD,EAAa,KAAK,CAAE,KAAM,EAAE,KAAM,KAAM,EAAE,eAE1C,OAAQ,EAAE,KAAV,CACI,IAAK,SACD,EAAa,KAAK,CAAE,KAAM,EAAE,KAAM,KAAM,EAAE,UAE1C,MAEJ,IAAK,OACD,EAAa,KAAK,CAAE,KAAM,EAAE,KAAM,UAAW,EAAE,UAAW,MAAO,EAAE,QAEnE,MAEJ,IAAK,QACD,EAAa,KAAK,CAAE,KAAM,EAAE,KAAM,IAAK,EAAE,IAAK,IAAK,EAAE,SAAU,QAAS,EAAE,WAE1E,MAEJ,QACI,MAAU,MAAM,iBAAiB,EAAE,QAKnD,MADA,GAAK,YAAc,EAAI,EAAA,QAAA,EAAA,sCAAsD,GACtE,IAGF,EAAe,CACxB,KAAM,cACN,MAAO,CACH,CACI,OAAQ,CAAC,iCACT,OAAQ,eAGhB,IAAK,sBACL,KAAM,cACN,YAAa,CAAC,gBACd,UACA,QAAS,0BAGb,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAU,yBAEV,EAAW,GAAY,GAEvB,EAAQ,CACV,OAAQ,GACR,KAAM,WACN,OAAQ,EACR,MAAO,GACP,KAAM,GACN,KAAM,oBACN,YAEE,EAAO,MAAM,EAAQ,GAAG,gDAA2B,mBAAmB,KAAK,UAAU,IAAQ,mBAC7F,EAAO,EAAQ,GACf,EAAQ,MAAM,EAAK,EAAO,GAAS,EAAe,GAAO,CAAE,YAAa,IAE9E,MAAO,CACH,MAAO,OAAO,OAAO,EAAQ,GAAY,GAAG,EAAO,GAAU,YAAc,UAC3E,KAAM,EACN,KAAM,EACN,YAAa,OAAO,OAAO,EAAQ,GAAY,GAAG,EAAO,GAAU,uBAAyB,4BAC5F,KAAM,wDACN,KAAM,wDACN,SAAU"}