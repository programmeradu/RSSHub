import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import{ofetch_default as r}from"./ofetch-Bzt0BXUH.js";import{timezone as i}from"./timezone-BrNu6iXe.js";import a from"node:crypto";const o=e.qingting.id??``,s={path:`/podcast/:id`,categories:[`multimedia`],example:`/qingting/podcast/293411`,parameters:{id:`专辑id, 可在专辑页 URL 中找到`},features:{supportPodcast:!0,requireConfig:[{name:`QINGTING_ID`,optional:!0,description:`用户id， 部分专辑需要会员身份，用户id可以通过从网页端登录蜻蜓fm后使用开发者工具，在控制台中运行JSON.parse(localStorage.getItem("user")).qingting_id获取`}]},radar:[{source:[`qingting.fm/channels/:id`]}],name:`播客`,maintainers:[`RookieZoe`,`huyyi`,`pseudoyu`],handler:l,description:`获取的播放 URL 有效期只有 1 天，需要开启播客 APP 的自动下载功能。`};function c(e,t){let n=`/audiostream/redirect/${e}/${t}?access_token=&device_id=MOBILESITE&qingting_id=${o}&t=${Date.now()}`,r=a.createHmac(`md5`,`fpMn12&38f_2e`).update(n).digest(`hex`).toString();return`https://audio.qingting.fm${n}&sign=${r}`}async function l(e){let a=e.req.param(`id`),s=Number(e.req.query(`limit`))||30,l=`https://i.qingting.fm/capi/v3/channel/${a}`,u=await r(l,{headers:{Referer:`https://www.qingting.fm/`}}),d=u.data.title,f=u.data.thumbs[`400_thumb`],p=u.data.podcasters.map(e=>e.nick_name).join(`,`),m=u.data.description,h=`https://i.qingting.fm/capi/channel/${a}/programs/${u.data.v}?curpage=1&pagesize=${s}&order=asc`,{data:{programs:g}}=await r(h,{headers:{Referer:`https://www.qingting.fm/`}}),{data:_}=await r(`https://i.qingting.fm/capi/v3/channel/${a}?user_id=${o}`),v=_.purchase?.item_type!==0,y=_.user_relevance?.sale_status===`paid`,b=await Promise.all(g.map(async e=>{let o=await t.tryGet(`qingting:podcast:${a}:${e.id}`,async()=>{let t=`https://www.qingting.fm/channels/${a}/programs/${e.id}/`,o=await r(t,{headers:{Referer:`https://www.qingting.fm/`}}),s=JSON.parse(o.match(/},"program":(.*?),"plist":/)[1]),c={title:e.title,link:t,itunes_item_image:e.cover,itunes_duration:e.duration,pubDate:i(n(e.update_time),8),description:s.richtext};return c});return(!v||y||e.isfree)&&(o.enclosure_url=c(a,e.id),o.enclosure_type=`audio/x-m4a`),o}));return{title:`${d} - 蜻蜓FM`,description:m,itunes_author:p,image:f,link:`https://www.qingting.fm/channels/${a}`,item:b}}export{s as route};
//# sourceMappingURL=podcast-DDrENuL0.js.map