import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import o from"node:path";import{load as s}from"cheerio";t();const c={path:`/eshop/hk`,radar:[{source:[`nintendo.com.hk/software/switch`,`nintendo.com.hk/`]}],name:`Unknown`,maintainers:[],handler:l,url:`nintendo.com.hk/software/switch`};async function l(t){let c=await a(`https://www.nintendo.com.hk/data/json/switch_software.json`),l=c.data.filter(({link:e})=>e.startsWith(`https://`)).slice(0,t.req.query(`limit`)?Number(t.req.query(`limit`)):30),u=await Promise.all(l.map(t=>n.tryGet(t.link,async()=>{let{data:n}=await a(t.link),c=s(n),l;if(t.link.startsWith(`https://store.nintendo.com.hk/`)){let t={platform:c(`.platform .product-attribute-val`).text(),game_category:c(`.game_category .product-attribute-val`).text(),release_date:c(`.release_date .product-attribute-val`).text(),publisher:c(`.publisher .product-attribute-val`).text(),no_of_players:c(`.no_of_players .product-attribute-val`).text(),supported_languages:c(`.supported_languages .product-attribute-val`).text(),required_space:c(`.required_space .product-attribute-val`).text(),supported_controllers:c(`.supported_controllers .product-attribute-val`).text(),supported_play_modes:c(`.supported_play_modes .product-attribute-val`).text(),disclaimer:c(`.disclaimer .product-attribute-val p`).text(),price:c(`meta[property="product:price:amount"]`).attr(`content`),currency:c(`meta[property="product:price:currency"]`).attr(`content`)},n=JSON.parse(c(`[type=text/x-magento-init]`).text().match(/{\n\s+"\[data-gal{2}ery-role=gal{2}ery-placeholder]": {\n\s+"mage(?:\/gal{2}ery){2}".*?}{4}(?:\s+}\n){3}/s));l=r(o.join(e,`templates/eshop_hk-48c83453.art`),{attributes:t,description:c(`.description`).html(),gallery:n[`[data-gallery-role=gallery-placeholder]`][`mage/gallery/gallery`].data,host:`store.nintendo.com.hk`})}else if(t.link.startsWith(`https://ec.nintendo.com/`)){let t=JSON.parse(n.match(/NXSTORE\.titleDetail\.jsonData = ({.*?});/)[1]),{data:i}=await a(`https://ec.nintendo.com/api/HK/zh/guest_prices`,{searchParams:{ns_uids:t.id}});l=r(o.join(e,`templates/eshop_hk-48c83453.art`),{host:`ec.nintendo.com`,jsonData:t,priceData:i[0]})}return{title:t.title,description:l,link:t.link,pubDate:i(t.release_date,`YYYY.M.D`)}})));return{title:`Nintendo eShop（港服）新游戏`,link:`https://www.nintendo.com.hk/software/switch/`,description:`Nintendo eShop（港服）新上架的游戏`,item:u}}export{c as route};
//# sourceMappingURL=eshop-hk-o1WFibHg.js.map