import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{rand_user_agent_default as n}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as r}from"./cache-kimkMTWJ.js";import{art as i}from"./render-CxhTJIsl.js";import{parseDate as a}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as o}from"./got-CdvI2yKX.js";import s from"node:path";import{load as c}from"cheerio";import l from"p-map";t();const u=n({browser:`chrome`,os:`android`,device:`mobile`}),d=t=>r.tryGet(t.link,async()=>{let n=t.link.replace(/(?<=^https:\/\/\w+\.wsj\.com)/,`/amp`),r=await o({url:n,method:`get`,headers:{"User-Agent":u}}),l=r.data,d=c(l),f=d(`head > meta[name="description"]`).attr(`content`),p=d(`meta[itemprop="dateModified"]`).attr(`content`),m=d(`meta[itemprop="datePublished"]`).attr(`content`),h=d(`.author > a[rel="author"]`).text(),g=d(`meta[name="keywords"]`).attr(`content`).split(`,`).map(e=>e.trim()),_=d(`article`);t.subTitle=d(`h2.sub-head`).html(),_.find(`.media-object-podcast`).remove(),_.find(`.bylineWrap`).each((e,t)=>{d(t).find(`p`).each(function(){d(this).replaceWith(d(this).html())})}),_.find(`.bigTop-hero`).each((e,t)=>{let n=d(t).find(`amp-img`).attr(`src`),r=d(t).find(`amp-img`).attr(`alt`),i=d(t).find(`.imageCaption`).text().trim(),a=d(t).find(`.imageCredit`).text().trim(),o=d(`<figure><img src="${n}" alt="${r}"><figcaption>${i} <span>${a}</span></figcaption></figure>`);d(o).insertBefore(t),d(t).remove()}),_.find(`amp-img`).each((e,t)=>{let n=d(`<img width="${t.attribs.width}" height="${t.attribs.height}" src="${t.attribs.src}" alt="${t.attribs.alt}">`);d(n).insertBefore(t),d(t).remove()}),_.find(`amp-iframe`).each((e,t)=>{let n=d(`<iframe width="${t.attribs.width}" height="${t.attribs.height}" src="${t.attribs.src}">`);d(n).insertBefore(t),d(t).remove()});let v=[`amp-ad`,`.wsj-ad`,`h1`,`h2`,`.zonedModule`,`.snippet`,`.newsletter-inset`];for(let e of v)_.find(e).each((e,t)=>{d(t).remove()});return _.find(`.paywall`).each((e,t)=>{d(t.childNodes).insertBefore(t),d(t).remove()}),t.article=_.html(),t.description=i(s.join(e,`templates/article-description-4e66f77b.art`),{item:t}),{title:t.title,pubDate:a(m),updated:a(p),author:h,link:t.link,summary:f,description:t.description,category:g,icon:`https://s.wsj.net/media/wsj_launcher-icon-4x.png`,logo:`https://vir.wsj.net/fp/assets/webpack4/img/wsj-logo-big-black.165e51cc.svg`}}),f={"en-us":`https://www.wsj.com`,"zh-cn":`https://cn.wsj.com/zh-hans`,"zh-tw":`https://cn.wsj.com/zh-hant`},p={path:`/:lang/:category?`,categories:[`traditional-media`],example:`/wsj/en-us/opinion`,parameters:{lang:"Language, `en-us`, `zh-cn`, `zh-tw`",category:`Category. See below`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`News`,maintainers:[`oppilate`],handler:m,description:`en_us

| World | U.S. | Politics | Economy | Business | Tech       | Markets | Opinion | Books & Arts | Real Estate | Life & Work | Sytle               | Sports |
| ----- | ---- | -------- | ------- | -------- | ---------- | ------- | ------- | ------------ | ----------- | ----------- | ------------------- | ------ |
| world | us   | politics | economy | business | technology | markets | opinion | books-arts   | realestate  | life-work   | style-entertainment | sports |

  zh-cn / zh-tw

| 国际  | 中国  | 金融市场 | 经济    | 商业     | 科技       | 派        | 专栏与观点 |
| ----- | ----- | -------- | ------- | -------- | ---------- | --------- | ---------- |
| world | china | markets  | economy | business | technology | life-arts | opinion    |

  Provide full article RSS for WSJ topics.`};async function m(e){let t=e.req.param(`lang`),n=e.req.param(`category`)||``,r=f[t],i=` - ${t.toUpperCase()}`,a=r;n.length>0&&(a=`${r}/news/${n}`,i=`${i} - ${n}`);let s=await o({method:`get`,url:a}),u=c(s.data),p=u(`script:contains("window.__STATE__")`).text(),m=JSON.parse(p.match(/{.*}/)[0]).data,h=Object.entries(m).filter(([e,t])=>{if(!e.startsWith(`article`))return!1;let n=t.data.data.url;return n.includes(`wsj.com/articles/`)}).map(([e])=>e),g=h.map(e=>{let t={};return t.title=m[e].data.data.headline,t.link=m[e].data.data.url,t.test=e,t}),_=await l(g,e=>d(e),{concurrency:10});return{title:`WSJ${i}`,link:a,description:`WSJ${i}`,item:_}}export{p as route};
//# sourceMappingURL=news-Iw5oKamz.js.map