{"version":3,"file":"analygarden-BlbLzJyj.js","names":["route: Route","response","got"],"sources":["../../lib/routes/cfachina/analygarden.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/servicesupport/analygarden/:program?',\r\n    categories: ['other'],\r\n    example: '/cfachina/servicesupport/analygarden',\r\n    parameters: { program: '分类，见下表，留空为全部' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['cfachina.org/servicesupport/analygarden/:program?', 'cfachina.org/'],\r\n        },\r\n    ],\r\n    name: '分析师园地',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    description: `| 有色金属类 | 黑色金属类 | 能源化工类 | 贵金属类 | 农产品类 | 金融类 | 指数类 |\r\n| ---------- | ---------- | ---------- | -------- | -------- | ------ | ------ |\r\n| ysjsl      | hsjsl      | nyhgl      | gjsl     | ncpl     | jrl    | zsl    |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let { program = '分析师园地' } = ctx.req.param();\r\n    const baseUrl = 'https://www.cfachina.org';\r\n    let pageData,\r\n        pageUrl = `${baseUrl}/servicesupport/analygarden/`;\r\n\r\n    if (program !== '分析师园地') {\r\n        pageUrl = `${pageUrl}${program}/`;\r\n\r\n        const response = await got(pageUrl);\r\n        const $ = load(response.data);\r\n        program = $('script:contains(\"Paging\")')\r\n            .text()\r\n            .match(/var name = '(.+)';/)[1];\r\n        pageData = {\r\n            category: $('.crumb a')\r\n                .toArray()\r\n                .map((item) => $(item).text())\r\n                .slice(-2),\r\n        };\r\n    }\r\n\r\n    const { data: response } = await got(`${baseUrl}/qx-search/api/wcmSearch/getDataByProgram`, {\r\n        headers: {\r\n            accept: 'application/json, text/plain, */*',\r\n        },\r\n        searchParams: {\r\n            pageNo: 1,\r\n            pageSize: ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20,\r\n            keyword: '',\r\n            startTime: '',\r\n            endTime: '',\r\n            type: '',\r\n            programName: program,\r\n        },\r\n    });\r\n\r\n    const items = response.data.dataList.map((item) => {\r\n        const link = new URL(item.docPubUrl, baseUrl).href;\r\n        return {\r\n            title: item.docTitle,\r\n            author: item.docAuthor,\r\n            link,\r\n            pubDate: timezone(parseDate(item.operTime), +8),\r\n            enclosure_url: link,\r\n            enclosure_type: `application/${link.split('.').pop()}`,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: `${pageData?.category.toReversed().join(' - ') ?? '分析师园地'} - 中国期货业协会`,\r\n        link: pageUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"sWAMA,MAAaA,EAAe,CACxB,KAAM,wCACN,WAAY,CAAC,SACb,QAAS,uCACT,WAAY,CAAE,QAAS,gBACvB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,oDAAqD,mBAGtE,KAAM,QACN,YAAa,CAAC,UACd,UACA,YAAa;;mFAKjB,eAAe,EAAQ,EAAK,CACxB,GAAI,CAAE,UAAU,SAAY,EAAI,IAAI,QAC9B,EAAU,2BACZ,EACA,EAAU,GAAG,EAAQ,8BAEzB,GAAI,IAAY,QAAS,CACrB,EAAU,GAAG,IAAU,EAAQ,GAE/B,IAAMC,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAKD,EAAS,MACxB,EAAU,EAAE,6BACP,OACA,MAAM,sBAAsB,GACjC,EAAW,CACP,SAAU,EAAE,YACP,UACA,IAAK,GAAS,EAAE,GAAM,QACtB,MAAM,KAInB,GAAM,CAAE,KAAM,GAAa,MAAMC,EAAI,GAAG,EAAQ,2CAA4C,CACxF,QAAS,CACL,OAAQ,qCAEZ,aAAc,CACV,OAAQ,EACR,SAAU,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GACjF,QAAS,GACT,UAAW,GACX,QAAS,GACT,KAAM,GACN,YAAa,KAIf,EAAQ,EAAS,KAAK,SAAS,IAAK,GAAS,CAC/C,IAAM,EAAO,IAAI,IAAI,EAAK,UAAW,GAAS,KAC9C,MAAO,CACH,MAAO,EAAK,SACZ,OAAQ,EAAK,UACb,OACA,QAAS,EAAS,EAAU,EAAK,UAAW,GAC5C,cAAe,EACf,eAAgB,eAAe,EAAK,MAAM,KAAK,WAIvD,MAAO,CACH,MAAO,GAAG,GAAU,SAAS,aAAa,KAAK,QAAU,QAAQ,YACjE,KAAM,EACN,KAAM"}