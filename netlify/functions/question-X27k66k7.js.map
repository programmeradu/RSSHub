{"version":3,"file":"question-X27k66k7.js","names":["route: Route","got"],"sources":["../../lib/routes/zhihu/question.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { header, processImage, getSignedHeader } from './utils';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/question/:questionId/:sortBy?',\r\n    categories: ['social-media'],\r\n    example: '/zhihu/question/59895982',\r\n    parameters: { questionId: '问题 id', sortBy: '排序方式：`default`, `created`, `updated`。默认为 `default`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.zhihu.com/question/:questionId'],\r\n            target: '/question/:questionId',\r\n        },\r\n    ],\r\n    name: '问题',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const {\r\n        questionId,\r\n        sortBy = 'default', // default,created,updated\r\n    } = ctx.req.param();\r\n\r\n    // second: get real data from zhihu\r\n    const rootUrl = 'https://www.zhihu.com';\r\n    const apiPath = `/api/v4/questions/${questionId}/answers?${new URLSearchParams({\r\n        include:\r\n            'data[*].is_normal,admin_closed_comment,reward_info,is_collapsed,annotation_action,annotation_detail,collapse_reason,is_sticky,collapsed_by,suggest_edit,comment_count,can_comment,content,editable_content,attachment,voteup_count,reshipment_settings,comment_permission,created_time,updated_time,review_info,relevant_info,question,excerpt,is_labeled,paid_info,paid_info_content,relationship.is_authorized,is_author,voting,is_thanked,is_nothelp,is_recognized;data[*].mark_infos[*].url;data[*].author.follower_count,badge[*].topics;data[*].settings.table_of_content.enabled&offset=0',\r\n        limit: '20',\r\n        sort_by: sortBy,\r\n        platform: 'desktop',\r\n    })}`;\r\n\r\n    const signedHeader = await getSignedHeader(`https://www.zhihu.com/question/${questionId}`, apiPath);\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: rootUrl + apiPath,\r\n        headers: {\r\n            ...header,\r\n            ...signedHeader,\r\n            Referer: `https://www.zhihu.com/question/${questionId}`,\r\n            // Authorization: 'oauth c3cef7c66a1843f8b3a9e6a1e3160e20', // previously hard-coded in js, outdated\r\n        },\r\n    });\r\n\r\n    const listRes = response.data.data;\r\n\r\n    return {\r\n        title: `知乎-${listRes[0].question.title}`,\r\n        link: `https://www.zhihu.com/question/${questionId}`,\r\n        item: listRes.map((item) => {\r\n            const title = `${item.author.name}的回答：${item.excerpt}`;\r\n            const description = `${item.author.name}的回答<br/><br/>${processImage(item.content)}`;\r\n\r\n            return {\r\n                title,\r\n                description,\r\n                author: item.author.name,\r\n                pubDate: parseDate(item.updated_time * 1000),\r\n                guid: item.id.toString(),\r\n                link: `https://www.zhihu.com/question/${questionId}/answer/${item.id}`,\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"+ZAKA,MAAaA,EAAe,CACxB,KAAM,iCACN,WAAY,CAAC,gBACb,QAAS,2BACT,WAAY,CAAE,WAAY,QAAS,OAAQ,sDAC3C,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,sCACT,OAAQ,0BAGhB,KAAM,KACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CACF,aACA,SAAS,WACT,EAAI,IAAI,QAIN,EAAU,qBAAqB,EAAW,WAAW,IAAI,gBAAgB,CAC3E,QACI,mkBACJ,MAAO,KACP,QAAS,EACT,SAAU,cAGR,EAAe,MAAM,EAAgB,kCAAkC,IAAc,GAErF,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,wBAAU,EACf,QAAS,CACL,GAAG,EACH,GAAG,EACH,QAAS,kCAAkC,OAK7C,EAAU,EAAS,KAAK,KAE9B,MAAO,CACH,MAAO,MAAM,EAAQ,GAAG,SAAS,QACjC,KAAM,kCAAkC,IACxC,KAAM,EAAQ,IAAK,GAAS,CACxB,IAAM,EAAQ,GAAG,EAAK,OAAO,KAAK,MAAM,EAAK,UACvC,EAAc,GAAG,EAAK,OAAO,KAAK,eAAe,EAAa,EAAK,WAEzE,MAAO,CACH,QACA,cACA,OAAQ,EAAK,OAAO,KACpB,QAAS,EAAU,EAAK,aAAe,KACvC,KAAM,EAAK,GAAG,WACd,KAAM,kCAAkC,EAAW,UAAU,EAAK"}