{"version":3,"file":"manga-EAq6zaV2.js","names":["ofetch","cache","response","$","route: Route"],"sources":["../../lib/routes/bakamh/manga.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst url = 'https://bakamh.com';\r\n\r\nconst handler = async (ctx) => {\r\n    const { name } = ctx.req.param();\r\n    const limit = Number.parseInt(ctx.req.query('limit'), 15) || 15;\r\n\r\n    const link = `${url}/manga/${name}/`;\r\n    const response = await ofetch(link);\r\n    const $ = load(response);\r\n    const ldJson = JSON.parse($('script[type=\"application/ld+json\"]').text());\r\n    const list = $('li.wp-manga-chapter')\r\n        .toArray()\r\n        .slice(0, limit)\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            const itemDate = $item.find('i').text().replaceAll(' ', '');\r\n\r\n            return {\r\n                title: $item.find('a').text(),\r\n                link: $item.find('a').attr('href'),\r\n                guid: $item.find('a').attr('href'),\r\n                pubDate: itemDate,\r\n            };\r\n        });\r\n\r\n    if (list.length > 0) {\r\n        list[0].pubDate = ldJson.dateModified;\r\n    }\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await ofetch(item.link);\r\n                const $ = load(response);\r\n                const comicpage = $('div.reading-content img');\r\n                const containerDiv = $('<div class=\"image-container\"></div>');\r\n                comicpage.appendTo(containerDiv);\r\n                item.description = containerDiv.html();\r\n                item.pubDate = parseDate(item.pubDate, 'YYYY年M月D日');\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link,\r\n        description: $('.post-content_item p').text(),\r\n        image: $('.summary_image a img').attr('src'),\r\n        item: items,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/manga/:name',\r\n    categories: ['anime'],\r\n    example: '/bakamh/manga/最强家丁',\r\n    parameters: { name: '漫画名称，漫画主页的地址栏中' },\r\n    radar: [\r\n        {\r\n            source: ['bakamh.com/manga/:name/'],\r\n        },\r\n    ],\r\n    name: '漫画更新',\r\n    maintainers: ['yoyobase'],\r\n    handler,\r\n    url: 'bakamh.com',\r\n};\r\n"],"mappings":"mTAMA,MAEM,EAAU,KAAO,IAAQ,CAC3B,GAAM,CAAE,QAAS,EAAI,IAAI,QACnB,EAAQ,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,KAAO,GAEvD,EAAO,4BAAgB,EAAK,GAC5B,EAAW,MAAMA,EAAO,GACxB,EAAI,EAAK,GACT,EAAS,KAAK,MAAM,EAAE,sCAAsC,QAC5D,EAAO,EAAE,uBACV,UACA,MAAM,EAAG,GACT,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GACV,EAAW,EAAM,KAAK,KAAK,OAAO,WAAW,IAAK,IAExD,MAAO,CACH,MAAO,EAAM,KAAK,KAAK,OACvB,KAAM,EAAM,KAAK,KAAK,KAAK,QAC3B,KAAM,EAAM,KAAK,KAAK,KAAK,QAC3B,QAAS,KAIjB,EAAK,OAAS,IACd,EAAK,GAAG,QAAU,EAAO,cAG7B,IAAM,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAW,MAAMF,EAAO,EAAK,MAC7BG,EAAI,EAAKD,GACT,EAAYC,EAAE,2BACd,EAAeA,EAAE,uCAIvB,OAHA,EAAU,SAAS,GACnB,EAAK,YAAc,EAAa,OAChC,EAAK,QAAU,EAAU,EAAK,QAAS,aAChC,MAKnB,MAAO,CACH,MAAO,EAAE,SAAS,OAClB,OACA,YAAa,EAAE,wBAAwB,OACvC,MAAO,EAAE,wBAAwB,KAAK,OACtC,KAAM,IAIDC,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,SACb,QAAS,qBACT,WAAY,CAAE,KAAM,kBACpB,MAAO,CACH,CACI,OAAQ,CAAC,6BAGjB,KAAM,OACN,YAAa,CAAC,YACd,UACA,IAAK"}