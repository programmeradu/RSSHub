{"version":3,"file":"changelog-DlL40SNA.js","names":["route: Route","InvalidParameterError","got"],"sources":["../../lib/routes/tencent/qq/sdk/changelog.ts"],"sourcesContent":["import InvalidParameterError from '@/errors/types/invalid-parameter';\r\nimport { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/qq/sdk/changelog/:platform',\r\n    categories: ['program-update'],\r\n    example: '/tencent/qq/sdk/changelog/iOS',\r\n    parameters: { platform: '平台，iOS / Android' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '更新日志',\r\n    maintainers: ['nuomi1'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const platform = ctx.req.param('platform');\r\n\r\n    let title = '';\r\n    let link = '';\r\n    if (platform === 'iOS') {\r\n        title = 'iOS SDK 历史变更';\r\n        link = 'https://wiki.connect.qq.com/ios_sdk历史变更';\r\n    } else if (platform === 'Android') {\r\n        title = 'Android SDK 历史变更';\r\n        link = 'https://wiki.connect.qq.com/android_sdk历史变更';\r\n    } else {\r\n        throw new InvalidParameterError('not support platform');\r\n    }\r\n\r\n    const response = await got.get(link);\r\n\r\n    const $ = load(response.data);\r\n\r\n    // 获取主要文本，并且过滤空行\r\n    const contents = $('.wp-editor')\r\n        .children('p')\r\n        .filter((_, element) => $(element).text() !== '');\r\n\r\n    const pList = [];\r\n    const titleIndex = [];\r\n\r\n    // 遍历文本 p 标签，并且获取标题索引\r\n    contents.each((index, element) => {\r\n        if ($(element).find('strong').length) {\r\n            titleIndex.push(index);\r\n        }\r\n\r\n        pList.push($(element).text().replace('\\n', ''));\r\n    });\r\n\r\n    // 用标题索引切割数组\r\n    const changelogs = titleIndex.map((_, index) => {\r\n        const section = pList.slice(titleIndex[index], titleIndex[index + 1]);\r\n        const changelog = {\r\n            title: section[0],\r\n            description: section.slice(1).join('\\n'),\r\n        };\r\n\r\n        return changelog;\r\n    });\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        item: changelogs,\r\n    };\r\n}\r\n"],"mappings":"2UAKA,MAAaA,EAAe,CACxB,KAAM,8BACN,WAAY,CAAC,kBACb,QAAS,gCACT,WAAY,CAAE,SAAU,oBACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YAE3B,EAAQ,GACR,EAAO,GACX,GAAI,IAAa,MACb,EAAQ,eACR,EAAO,kDACA,IAAa,UACpB,EAAQ,mBACR,EAAO,mDAEP,MAAM,IAAIC,EAAsB,wBAGpC,IAAM,EAAW,MAAMC,EAAI,IAAI,GAEzB,EAAI,EAAK,EAAS,MAGlB,EAAW,EAAE,cACd,SAAS,KACT,QAAQ,EAAG,IAAY,EAAE,GAAS,SAAW,IAE5C,EAAQ,GACR,EAAa,GAGnB,EAAS,MAAM,EAAO,IAAY,CAC1B,EAAE,GAAS,KAAK,UAAU,QAC1B,EAAW,KAAK,GAGpB,EAAM,KAAK,EAAE,GAAS,OAAO,QAAQ;EAAM,OAI/C,IAAM,EAAa,EAAW,KAAK,EAAG,IAAU,CAC5C,IAAM,EAAU,EAAM,MAAM,EAAW,GAAQ,EAAW,EAAQ,IAC5D,EAAY,CACd,MAAO,EAAQ,GACf,YAAa,EAAQ,MAAM,GAAG,KAAK;IAGvC,OAAO,IAGX,MAAO,CACH,QACA,OACA,KAAM"}