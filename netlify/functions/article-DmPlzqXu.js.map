{"version":3,"file":"article-DmPlzqXu.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/wyzxwk/article.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/article/:id?',\r\n    categories: ['new-media'],\r\n    example: '/wyzxwk/article/shushe',\r\n    parameters: { id: '栏目 id，可在栏目页 URL 中找到，默认为时代观察' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['wyzxwk.com/Article/:id', 'wyzxwk.com/'],\r\n        },\r\n    ],\r\n    name: '栏目',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `时政\r\n\r\n| 时代观察 | 舆论战争 |\r\n| -------- | -------- |\r\n| shidai   | yulun    |\r\n\r\n  经济\r\n\r\n| 经济视点 | 社会民生 | 三农关注 | 产业研究 |\r\n| -------- | -------- | -------- | -------- |\r\n| jingji   | shehui   | sannong  | chanye   |\r\n\r\n  国际\r\n\r\n| 国际纵横 | 国防外交 |\r\n| -------- | -------- |\r\n| guoji    | guofang  |\r\n\r\n  思潮\r\n\r\n| 理想之旅 | 思潮碰撞 | 文艺新生 | 读书交流 |\r\n| -------- | -------- | -------- | -------- |\r\n| lixiang  | sichao   | wenyi    | shushe   |\r\n\r\n  历史\r\n\r\n| 历史视野 | 中华文化 | 中华医药 | 共产党人 |\r\n| -------- | -------- | -------- | -------- |\r\n| lishi    | zhonghua | zhongyi  | cpers    |\r\n\r\n  争鸣\r\n\r\n| 风华正茂 | 工农之声 | 网友杂谈 | 网友时评 |\r\n| -------- | -------- | -------- | -------- |\r\n| qingnian | gongnong | zatan    | shiping  |\r\n\r\n  活动\r\n\r\n| 乌有公告 | 红色旅游 | 乌有讲堂  | 书画欣赏 |\r\n| -------- | -------- | --------- | -------- |\r\n| gonggao  | lvyou    | jiangtang | shuhua   |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id') ?? 'shidai';\r\n\r\n    const rootUrl = 'http://www.wyzxwk.com';\r\n    const currentUrl = `${rootUrl}/Article/${id}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    $('.g-sd').remove();\r\n\r\n    let items = $('h3 a')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.text(),\r\n                link: item.attr('href'),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                if (item.link.indexOf('wyzxwk.com') > 0) {\r\n                    try {\r\n                        const detailResponse = await got({\r\n                            method: 'get',\r\n                            url: item.link,\r\n                        });\r\n                        const content = load(detailResponse.data);\r\n\r\n                        content('.zs-modal-body').prev().nextAll().remove();\r\n\r\n                        const pubDate = detailResponse.data.match(/<span class=\"s-grey-3\">(\\d{4}-\\d{2}-\\d{2})<\\/span>/);\r\n                        if (pubDate) {\r\n                            item.pubDate = parseDate(pubDate[1], 'YYYY-MM-DD');\r\n                        }\r\n\r\n                        item.description = content('article').html();\r\n                    } catch {\r\n                        item.description = '';\r\n                    }\r\n                }\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${$('title').text().split(' - ')[0]} - 乌有之乡网刊`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,gBACN,WAAY,CAAC,aACb,QAAS,yBACT,WAAY,CAAE,GAAI,+BAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,yBAA0B,iBAG3C,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;iDA2CjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,OAAS,SAG5B,EAAa,iCAAsB,IAEnC,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAExB,EAAE,SAAS,SAEX,IAAI,EAAQ,EAAE,QACT,UACA,IAAK,IACF,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,OACZ,KAAM,EAAK,KAAK,WAgC5B,MA5BA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,EAAK,KAAK,QAAQ,cAAgB,EAClC,GAAI,CACA,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAER,EAAU,EAAK,EAAe,MAEpC,EAAQ,kBAAkB,OAAO,UAAU,SAE3C,IAAM,EAAU,EAAe,KAAK,MAAM,sDACtC,IACA,EAAK,QAAU,EAAU,EAAQ,GAAI,eAGzC,EAAK,YAAc,EAAQ,WAAW,YAClC,CACJ,EAAK,YAAc,GAG3B,OAAO,MAKZ,CACH,MAAO,GAAG,EAAE,SAAS,OAAO,MAAM,OAAO,GAAG,WAC5C,KAAM,EACN,KAAM"}