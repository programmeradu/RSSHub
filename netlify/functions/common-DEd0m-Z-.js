import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import{ofetch_default as a}from"./ofetch-Bzt0BXUH.js";import{ViewType as o}from"./types-A5bA50Mg.js";import s from"node:path";import{load as c}from"cheerio";t();const l={path:`/:category/:topic?`,categories:[`traditional-media`],view:o.Articles,example:`/reuters/world/us`,parameters:{category:{description:`find it in the URL, or tables below`,options:[{value:`world`,label:`World`},{value:`business`,label:`Business`},{value:`legal`,label:`Legal`},{value:`markets`,label:`Markets`},{value:`breakingviews`,label:`Breakingviews`},{value:`technology`,label:`Technology`},{value:`graphics`,label:`Graphics`},{value:`authors`,label:`Authors`}],default:`world`},topic:"find it in the URL, or tables below, leave empty for `All`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`reuters.com/:category/:topic?`,`reuters.com/`]}],name:`Category/Topic/Author`,maintainers:[`LyleLee`,`HenryQW`,`proletarius101`,`black-desk`,`nczitzk`,`pseudoyu`],handler:u,description:`-   \`:category\`:

      | World | Business | Legal | Markets | Breakingviews | Technology | Graphics |
      | ----- | -------- | ----- | ------- | ------------- | ---------- | -------- |
      | world | business | legal | markets | breakingviews | technology | graphics |

  -   \`world/:topic\`:

      | All | Africa | Americas | Asia Pacific | China | Europe | India | Middle East | United Kingdom | United States | The Great Reboot | Reuters Next |
      | --- | ------ | -------- | ------------ | ----- | ------ | ----- | ----------- | -------------- | ------------- | ---------------- | ------------ |
      |     | africa | americas | asia-pacific | china | europe | india | middle-east | uk             | us            | the-great-reboot | reuters-next |

  -   \`business/:topic\`:

      | All | Aerospace & Defense | Autos & Transportation | Energy | Environment | Finance | Healthcare & Pharmaceuticals | Media & Telecom | Retail & Consumer | Sustainable Business | Charged | Future of Health | Future of Money | Take Five | Reuters Impact |
      | --- | ------------------- | ---------------------- | ------ | ----------- | ------- | ---------------------------- | --------------- | ----------------- | -------------------- | ------- | ---------------- | --------------- | --------- | -------------- |
      |     | aerospace-defense   | autos-transportation   | energy | environment | finance | healthcare-pharmaceuticals   | media-telecom   | retail-consumer   | sustainable-business | charged | future-of-health | future-of-money | take-five | reuters-impact |

  -   \`legal/:topic\`:

      | All | Government | Legal Industry | Litigation | Transactional |
      | --- | ---------- | -------------- | ---------- | ------------- |
      |     | government | legalindustry  | litigation | transactional |

  -   \`authors/:topic\`:

      | Default | Jonathan Landay | any other authors |
      | ------- | --------------- | ----------------- |
      | reuters | jonathan-landay | their name in URL |

  More could be found in the URL of the category/topic page.`};async function u(t){let o=new Set([`authors`,`tags`]),l=[`world`],u=t.req.param(`category`),d=t.req.param(`topic`)??(u===`authors`?`reuters`:``),f=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):20,p=t.req.query(`sophi`)===`true`&&d!==``&&l.includes(u),m=`/${u}/${d?`${d}/`:``}`,h={Accept:`application/json, text/plain, */*`,"Accept-Language":`en-US,en;q=0.9`,Referer:`https://www.reuters.com/`};try{let{title:l,description:d,rootUrl:g,response:_}=await(async()=>{if(o.has(u)){let e=`https://www.reuters.com/pf/api/v3/content/fetch/articles-by-topic-v1`,t=await a(e,{query:{query:JSON.stringify({offset:0,size:f,topic_url:m,website:`reuters`})},headers:h});return{title:`${t.result.topics[0].name} | Reuters`,description:t.result.topics[0].entity_id,rootUrl:e,response:t}}else{let e=`https://www.reuters.com/pf/api/v3/content/fetch/articles-by-section-alias-or-id-v1`,t=await a(e,{query:{query:JSON.stringify({offset:0,size:f,section_id:m,website:`reuters`,...p?{fetch_type:`sophi`,sophi_page:`*`,sophi_widget:`topic`}:{}})},headers:h});return{title:t.result.section.title,description:t.result.section.section_about,rootUrl:e,response:t}}})(),v=_.result.articles.map(e=>({title:e.title,link:new URL(e.canonical_url,g).href,guid:e.id,pubDate:i(e.published_time),updated:i(e.updated_time),author:e.authors.map(e=>e.name).join(`, `),category:e.kicker.names,description:e.description}));v=v.filter((e,t)=>v.findIndex(t=>e.guid===t.guid)===t);let y=await Promise.allSettled(v.map(o=>t.req.query(`fulltext`)===`true`?n.tryGet(o.link,async()=>{let t=await a(o.link,{headers:h}),n=c(t.data);if(t.url.startsWith(`https://www.reuters.com/investigates/`)){let e=JSON.parse(n(`script[type="application/ld+json"]`).text());return n(`.special-report-article-container .container, #slide-dek, #slide-end, .share-in-article-container`).remove(),o.title=e.headline,o.pubDate=i(e.dateCreated),o.author=e.creator,o.category=e.keywords,o.description=n(`.special-report-article-container`).html(),o}let l=n(`script#fusion-metadata`).text().match(/Fusion.globalContent=({[\S\s]*?});/);if(l){let t=JSON.parse(l[1]);return o.title=t.result.title||o.title,o.description=r(s.join(e,`templates/description-610ff9d2.art`),{result:t.result}),o.pubDate=i(t.result.display_time),o.author=t.result.authors.map(e=>e.name).join(`, `),o.category=t.result.taxonomy.keywords,o}return n(`.title`).remove(),n(`.article-metadata`).remove(),o.title=n(`meta[property="og:title"]`).attr(`content`),o.pubDate=i(t.data.match(/"datePublished":"(.*?)","dateModified/)[1]),o.author=t.data.match(/{"@type":"Person","name":"(.*?)"}/g).map(e=>e.match(/"name":"(.*?)"/)[1]).join(`, `),o.description=n(`article`).html(),o}):o));return v=y.filter(e=>e.status===`fulfilled`).map(e=>e.value),{title:l,description:d,image:`https://www.reuters.com/pf/resources/images/reuters/logo-vertical-default-512x512.png?d=116`,link:`https://www.reuters.com${m}`,item:v}}catch{let e=d?`https://www.reuters.com/arc/outboundfeeds/v4/mobile/section${m}?outputType=json`:`https://www.reuters.com/arc/outboundfeeds/v4/mobile/section/${u}/?outputType=json`,t=await a(e,{headers:h});if(t.wireitems?.length){let e=t.wireitems.map(e=>{let n=e.templates.find(e=>e.template===`story_with_image`)?.story;return n?{title:n.hed,link:e.templates.find(e=>e.template===`story_with_image`)?.template_action?.url,guid:n.usn,pubDate:i(n.updated_at),updated:i(n.updated_at),description:n.lede,author:n.authors?.map(e=>e.name).join(`, `),category:[t.analytics?.topic_channel,t.analytics?.topic_sub_channel].filter(Boolean)}:null}).filter(Boolean);return{title:t.analytics?.title||`${t.wire_name} | Reuters`,description:t.analytics?.content_title,image:`https://www.reuters.com/pf/resources/images/reuters/logo-vertical-default-512x512.png?d=116`,link:t.canonical_action?.url||`https://www.reuters.com${m}`,category:[t.analytics?.topic_channel,t.analytics?.topic_sub_channel].filter(Boolean),item:e.slice(0,f)}}}}export{l as route};
//# sourceMappingURL=common-DEd0m-Z-.js.map