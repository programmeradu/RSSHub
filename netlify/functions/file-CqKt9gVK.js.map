{"version":3,"file":"file-CqKt9gVK.js","names":["route: Route","got"],"sources":["../../lib/routes/github/file.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { config } from '@/config';\r\nimport queryString from 'query-string';\r\n\r\nexport const route: Route = {\r\n    path: '/file/:user/:repo/:branch/:filepath{.+}',\r\n    example: '/github/file/DIYgod/RSSHub/master/README.md',\r\n    parameters: {\r\n        user: 'GitHub user or org name',\r\n        repo: 'repository name',\r\n        branch: 'branch name',\r\n        filepath: 'path of target file',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['github.com/:user/:repo/blob/:branch/*filepath'],\r\n            target: '/file/:user/:repo/:branch/:filepath',\r\n        },\r\n    ],\r\n    name: 'File Commits',\r\n    maintainers: ['zengxs'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const user = ctx.req.param('user');\r\n    const repo = ctx.req.param('repo');\r\n    const branch = ctx.req.param('branch');\r\n    const filepath = ctx.req.param('filepath');\r\n\r\n    const fileUrl = `https://github.com/${user}/${repo}/commits/${branch}/${filepath}`;\r\n\r\n    const headers = {};\r\n    if (config.github && config.github.access_token) {\r\n        headers.Authorization = `token ${config.github.access_token}`;\r\n    }\r\n    const res = await got.get(`https://api.github.com/repos/${user}/${repo}/commits`, {\r\n        searchParams: queryString.stringify({\r\n            sha: branch,\r\n            path: filepath,\r\n        }),\r\n        headers,\r\n    });\r\n    const list = res.data;\r\n    const count = [];\r\n    for (let i = 0; i < Math.min(list.length, 10); i++) {\r\n        count.push(i);\r\n    }\r\n    const resultItems = count.map((i) => {\r\n        const each = list[i];\r\n        return {\r\n            title: each.commit.message.split('\\n')[0],\r\n            description: `<pre>${each.commit.message}</pre>`,\r\n            link: each.html_url,\r\n            author: each.commit.author.name,\r\n            pubDate: new Date(each.commit.committer.date).toUTCString(),\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: `GitHub File - ${user}/${repo}/${branch}/${filepath}`,\r\n        link: fileUrl,\r\n        item: resultItems,\r\n    };\r\n}\r\n"],"mappings":"6QAKA,MAAaA,EAAe,CACxB,KAAM,0CACN,QAAS,8CACT,WAAY,CACR,KAAM,0BACN,KAAM,kBACN,OAAQ,cACR,SAAU,uBAEd,MAAO,CACH,CACI,OAAQ,CAAC,iDACT,OAAQ,wCAGhB,KAAM,eACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAO,EAAI,IAAI,MAAM,QACrB,EAAS,EAAI,IAAI,MAAM,UACvB,EAAW,EAAI,IAAI,MAAM,YAEzB,EAAU,sBAAsB,EAAK,GAAG,EAAK,WAAW,EAAO,GAAG,IAElE,EAAU,GACZ,EAAO,QAAU,EAAO,OAAO,eAC/B,EAAQ,cAAgB,SAAS,EAAO,OAAO,gBAEnD,IAAM,EAAM,MAAMC,EAAI,IAAI,gCAAgC,EAAK,GAAG,EAAK,UAAW,CAC9E,aAAc,EAAY,UAAU,CAChC,IAAK,EACL,KAAM,IAEV,YAEE,EAAO,EAAI,KACX,EAAQ,GACd,IAAK,IAAI,EAAI,EAAG,EAAI,KAAK,IAAI,EAAK,OAAQ,IAAK,IAC3C,EAAM,KAAK,GAEf,IAAM,EAAc,EAAM,IAAK,GAAM,CACjC,IAAM,EAAO,EAAK,GAClB,MAAO,CACH,MAAO,EAAK,OAAO,QAAQ,MAAM;GAAM,GACvC,YAAa,QAAQ,EAAK,OAAO,QAAQ,QACzC,KAAM,EAAK,SACX,OAAQ,EAAK,OAAO,OAAO,KAC3B,QAAS,IAAI,KAAK,EAAK,OAAO,UAAU,MAAM,iBAItD,MAAO,CACH,MAAO,iBAAiB,EAAK,GAAG,EAAK,GAAG,EAAO,GAAG,IAClD,KAAM,EACN,KAAM"}