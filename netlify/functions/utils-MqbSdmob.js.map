{"version":3,"file":"utils-MqbSdmob.js","names":["got"],"sources":["../../lib/routes/plurk/utils.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst baseUrl = 'https://www.plurk.com';\r\n\r\n/**\r\n *\r\n * @param {objects} userIds Array of user ids\r\n * @returns\r\n */\r\nconst fetchFriends = async (userIds) => {\r\n    const { data } = await got.post(`${baseUrl}/Users/fetchFriends`, {\r\n        form: {\r\n            ids: JSON.stringify(userIds),\r\n            r: 'gp',\r\n        },\r\n    });\r\n    return data;\r\n};\r\n\r\n/**\r\n *\r\n * @param {string} plurkGuid plurk guid, should start with 'plurk:'\r\n * @param {object} item plurk object\r\n * @param {string} author author name, can be `null`\r\n * @param {function} tryGet cache get function\r\n * @returns {object} item object\r\n */\r\nconst getPlurk = (plurkGuid, item, author, tryGet) =>\r\n    tryGet(plurkGuid, () => {\r\n        const $ = load(item.content || item.rendered, null, false);\r\n        $('img').each((_, e) => {\r\n            e = $(e);\r\n            e.removeAttr('height').removeAttr('width');\r\n            if (e.attr('alt') && e.attr('alt').startsWith('http')) {\r\n                e.attr('src', e.attr('alt'));\r\n                e.removeAttr('alt');\r\n            }\r\n        });\r\n\r\n        return {\r\n            title: item.content_raw ?? ($.text() || plurkGuid),\r\n            description: $.html(),\r\n            guid: plurkGuid,\r\n            link: item.rendered ? item.link_url : null,\r\n            author,\r\n            pubDate: parseDate(item.posted),\r\n        };\r\n    });\r\n\r\nexport { baseUrl, fetchFriends, getPlurk };\r\n"],"mappings":"oIAIA,MAAM,EAAU,wBAOV,EAAe,KAAO,IAAY,CACpC,GAAM,CAAE,QAAS,MAAMA,EAAI,KAAK,GAAG,EAAQ,qBAAsB,CAC7D,KAAM,CACF,IAAK,KAAK,UAAU,GACpB,EAAG,QAGX,OAAO,GAWL,GAAY,EAAW,EAAM,EAAQ,IACvC,EAAO,MAAiB,CACpB,IAAM,EAAI,EAAK,EAAK,SAAW,EAAK,SAAU,KAAM,IAUpD,OATA,EAAE,OAAO,MAAM,EAAG,IAAM,CACpB,EAAI,EAAE,GACN,EAAE,WAAW,UAAU,WAAW,SAC9B,EAAE,KAAK,QAAU,EAAE,KAAK,OAAO,WAAW,UAC1C,EAAE,KAAK,MAAO,EAAE,KAAK,QACrB,EAAE,WAAW,UAId,CACH,MAAO,EAAK,cAAgB,EAAE,QAAU,GACxC,YAAa,EAAE,OACf,KAAM,EACN,KAAM,EAAK,SAAW,EAAK,SAAW,KACtC,SACA,QAAS,EAAU,EAAK"}