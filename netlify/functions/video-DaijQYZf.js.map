{"version":3,"file":"video-DaijQYZf.js","names":["userInfo: UserInfo","videos: VideoItem[]","route: Route"],"sources":["../../lib/routes/nicovideo/utils.ts","../../lib/routes/nicovideo/video.ts"],"sourcesContent":["import { Essential, UserInfo, VideoItem } from './types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport cache from '@/utils/cache';\r\nimport { config } from '@/config';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\n\r\nexport const getUserInfoById = (id: string) => cache.tryGet(`nicovideo:user:${id}`, () => ofetch<UserInfo>(`https://embed.nicovideo.jp/users/${id}`)) as Promise<UserInfo>;\r\n\r\nexport const getUserVideosById = (id: string) =>\r\n    cache.tryGet(\r\n        `nicovideo:user:${id}:videos`,\r\n        async () => {\r\n            const { data } = await ofetch(`https://nvapi.nicovideo.jp/v3/users/${id}/videos`, {\r\n                headers: {\r\n                    'X-Frontend-Id': '6',\r\n                },\r\n                query: {\r\n                    sortKey: 'registeredAt',\r\n                    sortOrder: 'desc',\r\n                    sensitiveContents: 'mask',\r\n                    pageSize: 100,\r\n                    page: 1,\r\n                },\r\n            });\r\n\r\n            return data.items;\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    ) as Promise<VideoItem[]>;\r\n\r\nexport const renderVideo = (video: Essential, embed: boolean) => art(path.join(__dirname, 'templates/video.art'), { video, embed });\r\n","import type { Context } from 'hono';\r\nimport { DataItem, Route } from '@/types';\r\nimport { UserInfo, VideoItem } from './types';\r\n\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { getUserInfoById, getUserVideosById, renderVideo } from './utils';\r\n\r\nconst handler = async (ctx: Context) => {\r\n    const { id } = ctx.req.param();\r\n    const embed = !ctx.req.param('embed');\r\n\r\n    const userInfo: UserInfo = await getUserInfoById(id);\r\n    const videos: VideoItem[] = await getUserVideosById(id);\r\n\r\n    const items = videos.map(({ essential: video }) => ({\r\n        title: video.title,\r\n        link: `https://www.nicovideo.jp/watch/${video.id}`,\r\n        pubDate: parseDate(video.registeredAt),\r\n        author: [{ name: video.owner.name, avatar: video.owner.iconUrl, url: `https://www.nicovideo.jp/user/${video.owner.id}` }],\r\n        description: renderVideo(video, embed),\r\n        image: video.thumbnail.nHdUrl || video.thumbnail.largeUrl || video.thumbnail.middleUrl,\r\n        upvotes: video.count.like,\r\n        comments: video.count.comment,\r\n    })) as DataItem[];\r\n\r\n    return {\r\n        title: `${userInfo.nickname} - ニコニコ`,\r\n        link: `https://www.nicovideo.jp/user/${id}/video`,\r\n        image: userInfo.icon,\r\n        item: items,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    name: 'User Videos',\r\n    path: '/user/:id/video/:embed?',\r\n    parameters: { id: 'User ID', embed: 'Default to embed the video, set to any value to disable embedding' },\r\n    example: '/nicovideo/user/16690815/video',\r\n    maintainers: ['TonyRL'],\r\n    radar: [\r\n        {\r\n            source: ['www.nicovideo.jp/user/:id', 'www.nicovideo.jp/user/:id/video'],\r\n            target: '/user/:id/video',\r\n        },\r\n    ],\r\n    handler,\r\n};\r\n"],"mappings":"qZAQA,MAAa,EAAmB,GAAe,EAAM,OAAO,kBAAkB,QAAY,EAAiB,oCAAoC,MAElI,EAAqB,GAC9B,EAAM,OACF,kBAAkB,EAAG,SACrB,SAAY,CACR,GAAM,CAAE,QAAS,MAAM,EAAO,uCAAuC,EAAG,SAAU,CAC9E,QAAS,CACL,gBAAiB,KAErB,MAAO,CACH,QAAS,eACT,UAAW,OACX,kBAAmB,OACnB,SAAU,IACV,KAAM,KAId,OAAO,EAAK,OAEhB,EAAO,MAAM,YACb,IAGK,GAAe,EAAkB,IAAmB,EAAI,EAAA,KAAA,EAAA,gCAA6C,CAAE,QAAO,UC1BrH,EAAU,KAAO,IAAiB,CACpC,GAAM,CAAE,MAAO,EAAI,IAAI,QACjB,EAAQ,CAAC,EAAI,IAAI,MAAM,SAEvBA,EAAqB,MAAM,EAAgB,GAC3CC,EAAsB,MAAM,EAAkB,GAE9C,EAAQ,EAAO,KAAK,CAAE,UAAW,MAAa,CAChD,MAAO,EAAM,MACb,KAAM,kCAAkC,EAAM,KAC9C,QAAS,EAAU,EAAM,cACzB,OAAQ,CAAC,CAAE,KAAM,EAAM,MAAM,KAAM,OAAQ,EAAM,MAAM,QAAS,IAAK,iCAAiC,EAAM,MAAM,OAClH,YAAa,EAAY,EAAO,GAChC,MAAO,EAAM,UAAU,QAAU,EAAM,UAAU,UAAY,EAAM,UAAU,UAC7E,QAAS,EAAM,MAAM,KACrB,SAAU,EAAM,MAAM,WAG1B,MAAO,CACH,MAAO,GAAG,EAAS,SAAS,SAC5B,KAAM,iCAAiC,EAAG,QAC1C,MAAO,EAAS,KAChB,KAAM,IAIDC,EAAe,CACxB,KAAM,cACN,KAAM,0BACN,WAAY,CAAE,GAAI,UAAW,MAAO,qEACpC,QAAS,iCACT,YAAa,CAAC,UACd,MAAO,CACH,CACI,OAAQ,CAAC,4BAA6B,mCACtC,OAAQ,oBAGhB"}