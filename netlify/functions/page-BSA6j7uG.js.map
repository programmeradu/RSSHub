{"version":3,"file":"page-BSA6j7uG.js","names":["route: Route","got","utils"],"sources":["../../lib/routes/bilibili/page.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport utils from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/video/page/:bvid/:embed?',\r\n    categories: ['social-media'],\r\n    example: '/bilibili/video/page/BV1i7411M7N9',\r\n    parameters: { bvid: '可在视频页 URL 中找到', embed: '默认为开启内嵌视频, 任意值为关闭' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '视频选集列表',\r\n    maintainers: ['sxzz'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let bvid = ctx.req.param('bvid');\r\n    let aid;\r\n    if (!bvid.startsWith('BV')) {\r\n        aid = bvid;\r\n        bvid = null;\r\n    }\r\n    const embed = !ctx.req.param('embed');\r\n    const link = `https://www.bilibili.com/video/${bvid || `av${aid}`}`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `https://api.bilibili.com/x/web-interface/view?${bvid ? `bvid=${bvid}` : `aid=${aid}`}`,\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n\r\n    const respdata = response.data.data;\r\n    const { title: name, pages: data } = response.data.data;\r\n\r\n    return {\r\n        title: `视频 ${name} 的选集列表`,\r\n        link,\r\n        description: `视频 ${name} 的视频选集列表`,\r\n        item: data\r\n            .sort((a, b) => b.page - a.page)\r\n            .slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 10)\r\n            .map((item) => ({\r\n                title: item.part,\r\n                description: utils.renderUGCDescription(embed, respdata.pic, `${item.part} - ${name}`, respdata.aid, item.cid, respdata.bvid),\r\n                link: `${link}?p=${item.page}`,\r\n            })),\r\n    };\r\n}\r\n"],"mappings":"2UAIA,MAAaA,EAAe,CACxB,KAAM,4BACN,WAAY,CAAC,gBACb,QAAS,oCACT,WAAY,CAAE,KAAM,gBAAiB,MAAO,qBAC5C,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,QACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAI,EAAO,EAAI,IAAI,MAAM,QACrB,EACC,EAAK,WAAW,QACjB,EAAM,EACN,EAAO,MAEX,IAAM,EAAQ,CAAC,EAAI,IAAI,MAAM,SACvB,EAAO,kCAAkC,GAAQ,KAAK,MACtD,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,iDAAiD,EAAO,QAAQ,IAAS,OAAO,MACrF,QAAS,CACL,QAAS,KAIX,EAAW,EAAS,KAAK,KACzB,CAAE,MAAO,EAAM,MAAO,GAAS,EAAS,KAAK,KAEnD,MAAO,CACH,MAAO,MAAM,EAAK,QAClB,OACA,YAAa,MAAM,EAAK,UACxB,KAAM,EACD,MAAM,EAAG,IAAM,EAAE,KAAO,EAAE,MAC1B,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAC5E,IAAK,IAAU,CACZ,MAAO,EAAK,KACZ,YAAaC,EAAM,qBAAqB,EAAO,EAAS,IAAK,GAAG,EAAK,KAAK,KAAK,IAAQ,EAAS,IAAK,EAAK,IAAK,EAAS,MACxH,KAAM,GAAG,EAAK,KAAK,EAAK"}