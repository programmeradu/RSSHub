{"version":3,"file":"category-Bj9CUDPq.js","names":[],"sources":["../../lib/routes/vcb-s/category.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst rootUrl = 'https://vcb-s.com';\r\nconst cateAPIUrl = `${rootUrl}/wp-json/wp/v2/categories`;\r\nconst postsAPIUrl = `${rootUrl}/wp-json/wp/v2/posts`;\r\n\r\nexport const route: Route = {\r\n    path: '/category/:cate',\r\n    categories: ['anime'],\r\n    example: '/vcb-s/category/works',\r\n    parameters: { cate: '分类' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['vcb-s.com/archives/category/:cate'],\r\n        },\r\n    ],\r\n    name: '分类文章',\r\n    maintainers: ['cxfksword'],\r\n    handler,\r\n    url: 'vcb-s.com/',\r\n    description: `| 作品项目 | 科普系列 | 计划与日志 |\r\n| -------- | -------- | ---------- |\r\n| works    | kb       | planlog    |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const cate = ctx.req.param('cate');\r\n    const limit = ctx.req.query('limit') ?? 7;\r\n\r\n    const cateUrl = `${cateAPIUrl}?slug=${cate}`;\r\n    const category = await cache.tryGet(cateUrl, async () => {\r\n        const res = await got.get(cateUrl);\r\n\r\n        if (typeof res.data === 'string') {\r\n            res.data = JSON.parse(res.body.trim());\r\n        }\r\n        return res.data[0];\r\n    });\r\n\r\n    const url = `${postsAPIUrl}?categories=${category.id}&page=1&per_page=${limit}&_embed`;\r\n    const response = await got.get(url);\r\n    if (typeof response.data === 'string') {\r\n        response.data = JSON.parse(response.body.trim());\r\n    }\r\n    const data = response.data;\r\n\r\n    const items = data.map((item) => {\r\n        const description = art(path.join(__dirname, 'templates/post.art'), {\r\n            post: item.content.rendered.replaceAll(/<pre class=\"js-medie-info-detail.*?>(.*?)<\\/pre>/gs, '<pre><code>$1</code></pre>').replaceAll(/<div.+?dw-box-download.+?>(.*?)<\\/div>/gs, '<pre>$1</pre>'),\r\n            medias: item._embedded['wp:featuredmedia'],\r\n        });\r\n\r\n        return {\r\n            title: item.title.rendered,\r\n            link: item.link,\r\n            description,\r\n            pubDate: parseDate(item.date_gmt),\r\n            author: item._embedded.author[0].name,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: `${category.name} | VCB-Studio`,\r\n        link: `${rootUrl}/archives/category/${category.slug}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"ybAQA,MAAM,EAAU,oBACV,EAAa,GAAG,EAAQ,2BACxB,EAAc,GAAG,EAAQ,sBAElB,EAAe,CACxB,KAAM,kBACN,WAAY,CAAC,SACb,QAAS,wBACT,WAAY,CAAE,KAAM,MACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,uCAGjB,KAAM,OACN,YAAa,CAAC,aACd,UACA,IAAK,aACL,YAAa;;uCAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAQ,EAAI,IAAI,MAAM,UAAY,EAElC,EAAU,GAAG,EAAW,QAAQ,IAChC,EAAW,MAAM,EAAM,OAAO,EAAS,SAAY,CACrD,IAAM,EAAM,MAAM,EAAI,IAAI,GAK1B,OAHI,OAAO,EAAI,MAAS,WACpB,EAAI,KAAO,KAAK,MAAM,EAAI,KAAK,SAE5B,EAAI,KAAK,KAGd,EAAM,GAAG,EAAY,cAAc,EAAS,GAAG,mBAAmB,EAAM,SACxE,EAAW,MAAM,EAAI,IAAI,GAC3B,OAAO,EAAS,MAAS,WACzB,EAAS,KAAO,KAAK,MAAM,EAAS,KAAK,SAE7C,IAAM,EAAO,EAAS,KAEhB,EAAQ,EAAK,IAAK,GAAS,CAC7B,IAAM,EAAc,EAAI,EAAA,KAAA,EAAA,+BAA4C,CAChE,KAAM,EAAK,QAAQ,SAAS,WAAW,qDAAsD,8BAA8B,WAAW,2CAA4C,iBAClL,OAAQ,EAAK,UAAU,sBAG3B,MAAO,CACH,MAAO,EAAK,MAAM,SAClB,KAAM,EAAK,KACX,cACA,QAAS,EAAU,EAAK,UACxB,OAAQ,EAAK,UAAU,OAAO,GAAG,QAIzC,MAAO,CACH,MAAO,GAAG,EAAS,KAAK,eACxB,KAAM,GAAG,EAAQ,qBAAqB,EAAS,OAC/C,KAAM"}