{"version":3,"file":"keyword-DU4yRMOo.js","names":["route: Route","cache","got","weiboUtils"],"sources":["../../lib/routes/weibo/keyword.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport querystring from 'node:querystring';\r\nimport got from '@/utils/got';\r\nimport weiboUtils from './utils';\r\nimport timezone from '@/utils/timezone';\r\nimport { fallback, queryToBoolean } from '@/utils/readable-social';\r\nimport { config } from '@/config';\r\n\r\nexport const route: Route = {\r\n    path: '/keyword/:keyword/:routeParams?',\r\n    categories: ['social-media'],\r\n    view: ViewType.SocialMedia,\r\n    example: '/weibo/keyword/RSSHub',\r\n    parameters: { keyword: '你想订阅的微博关键词', routeParams: '额外参数；请参阅上面的说明和表格' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '关键词',\r\n    maintainers: ['DIYgod', 'Rongronggg9'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const keyword = ctx.req.param('keyword');\r\n\r\n    const data = await cache.tryGet(\r\n        `weibo:keyword:${keyword}`,\r\n        async () => {\r\n            const _r = await got({\r\n                method: 'get',\r\n                url: `https://m.weibo.cn/api/container/getIndex?containerid=100103type%3D61%26q%3D${encodeURIComponent(keyword)}%26t%3D0`,\r\n                headers: {\r\n                    Referer: `https://m.weibo.cn/p/searchall?containerid=100103type%3D1%26q%3D${encodeURIComponent(keyword)}`,\r\n                    'MWeibo-Pwa': 1,\r\n                    'X-Requested-With': 'XMLHttpRequest',\r\n                    'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1',\r\n                },\r\n            });\r\n            return _r.data.data.cards;\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    );\r\n\r\n    const routeParams = querystring.parse(ctx.req.param('routeParams'));\r\n\r\n    return weiboUtils.sinaimgTvax({\r\n        title: `又有人在微博提到${keyword}了`,\r\n        link: `http://s.weibo.com/weibo/${encodeURIComponent(keyword)}&b=1&nodup=1`,\r\n        description: `又有人在微博提到${keyword}了`,\r\n        item: data\r\n            .filter((i) => i.mblog)\r\n            .map((item) => {\r\n                item.mblog.created_at = timezone(item.mblog.created_at, +8);\r\n                if (item.mblog.retweeted_status && item.mblog.retweeted_status.created_at) {\r\n                    item.mblog.retweeted_status.created_at = timezone(item.mblog.retweeted_status.created_at, +8);\r\n                }\r\n                return weiboUtils.formatExtended(ctx, item.mblog, undefined, {\r\n                    showAuthorInTitle: fallback(undefined, queryToBoolean(routeParams.showAuthorInTitle), true),\r\n                    showAuthorInDesc: fallback(undefined, queryToBoolean(routeParams.showAuthorInDesc), true),\r\n                });\r\n            }),\r\n    });\r\n}\r\n"],"mappings":"uiBASA,MAAaA,EAAe,CACxB,KAAM,kCACN,WAAY,CAAC,gBACb,KAAM,EAAS,YACf,QAAS,wBACT,WAAY,CAAE,QAAS,aAAc,YAAa,oBAClD,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,MACN,YAAa,CAAC,SAAU,eACxB,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,EAAI,IAAI,MAAM,WAExB,EAAO,MAAMC,EAAM,OACrB,iBAAiB,IACjB,SAAY,CACR,IAAM,EAAK,MAAMC,EAAI,CACjB,OAAQ,MACR,IAAK,+EAA+E,mBAAmB,GAAS,UAChH,QAAS,CACL,QAAS,mEAAmE,mBAAmB,KAC/F,aAAc,EACd,mBAAoB,iBACpB,aAAc,6IAGtB,OAAO,EAAG,KAAK,KAAK,OAExB,EAAO,MAAM,YACb,IAGE,EAAc,EAAY,MAAM,EAAI,IAAI,MAAM,gBAEpD,OAAOC,EAAW,YAAY,CAC1B,MAAO,WAAW,EAAQ,GAC1B,KAAM,4BAA4B,mBAAmB,GAAS,cAC9D,YAAa,WAAW,EAAQ,GAChC,KAAM,EACD,OAAQ,GAAM,EAAE,OAChB,IAAK,IACF,EAAK,MAAM,WAAa,EAAS,EAAK,MAAM,WAAY,GACpD,EAAK,MAAM,kBAAoB,EAAK,MAAM,iBAAiB,aAC3D,EAAK,MAAM,iBAAiB,WAAa,EAAS,EAAK,MAAM,iBAAiB,WAAY,IAEvFA,EAAW,eAAe,EAAK,EAAK,MAAO,IAAA,GAAW,CACzD,kBAAmB,EAAS,IAAA,GAAW,EAAe,EAAY,mBAAoB,IACtF,iBAAkB,EAAS,IAAA,GAAW,EAAe,EAAY,kBAAmB"}