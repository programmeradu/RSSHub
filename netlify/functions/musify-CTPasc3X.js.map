{"version":3,"file":"musify-CTPasc3X.js","names":["limit: number","baseUrl: string","targetUrl: string","ofetch","$: CheerioAPI","items: DataItem[]","$el: Cheerio<Element>","artist: string | undefined","name: string | undefined","title: string","linkUrl: string | undefined","authorEls: Element[]","authors: DataItem['author']","$authorEl: Cheerio<Element>","processedItem: DataItem","$enclosureEl: Cheerio<Element>","enclosureUrl: string | undefined","route: Route"],"sources":["../../lib/routes/musify/index.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nimport { type CheerioAPI, type Cheerio, load } from 'cheerio';\r\nimport type { Element } from 'domhandler';\r\nimport { type Context } from 'hono';\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const { language = '' } = ctx.req.param();\r\n    const limit: number = Number.parseInt(ctx.req.query('limit') ?? '30', 10);\r\n\r\n    const baseUrl: string = 'https://musify.club';\r\n    const targetUrl: string = new URL(language, baseUrl).href;\r\n\r\n    const response = await ofetch(targetUrl);\r\n    const $: CheerioAPI = load(response);\r\n\r\n    const items: DataItem[] = $('div.playlist__item')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((el): Element => {\r\n            const $el: Cheerio<Element> = $(el);\r\n\r\n            const artist: string | undefined = $el.attr('data-artist');\r\n            const name: string | undefined = $el.attr('data-name');\r\n\r\n            const title: string = [artist, name].filter(Boolean).join(' - ');\r\n            const linkUrl: string | undefined = $el.find('a.strong').attr('href');\r\n            const authorEls: Element[] = $el.find('div.playlist__heading a').toArray();\r\n            const authors: DataItem['author'] = authorEls.map((authorEl) => {\r\n                const $authorEl: Cheerio<Element> = $(authorEl);\r\n\r\n                return {\r\n                    name: $authorEl.text(),\r\n                    url: $authorEl.attr('href') ? new URL($authorEl.attr('href') as string, baseUrl).href : undefined,\r\n                    avatar: undefined,\r\n                };\r\n            });\r\n\r\n            let processedItem: DataItem = {\r\n                title,\r\n                link: linkUrl ? new URL(linkUrl, baseUrl).href : undefined,\r\n                author: authors,\r\n            };\r\n\r\n            const $enclosureEl: Cheerio<Element> = $el.find('div.playlist__control');\r\n            const enclosureUrl: string | undefined = $enclosureEl.attr('data-play-url');\r\n\r\n            if (enclosureUrl) {\r\n                processedItem = {\r\n                    ...processedItem,\r\n                    enclosure_url: new URL(enclosureUrl, baseUrl).href,\r\n                    enclosure_type: `audio/${enclosureUrl.split(/\\./).pop()}`,\r\n                    enclosure_title: title,\r\n                    enclosure_length: undefined,\r\n                    itunes_duration: undefined,\r\n                    itunes_item_image: undefined,\r\n                };\r\n            }\r\n\r\n            return processedItem;\r\n        });\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        description: $('meta[property=\"og:description\"]').attr('content'),\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: $('meta[property=\"og:image\"]').attr('content'),\r\n        author: $('meta[property=\"og:site_name\"]').attr('content'),\r\n        id: $('meta[property=\"og:url\"]').attr('content'),\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:language?',\r\n    name: 'Latest',\r\n    url: 'musify.club',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/musify/en',\r\n    parameters: {\r\n        category: {\r\n            description: 'Language, Russian by default',\r\n            options: [\r\n                {\r\n                    label: 'Russian',\r\n                    value: '',\r\n                },\r\n                {\r\n                    label: 'English',\r\n                    value: 'en',\r\n                },\r\n            ],\r\n        },\r\n    },\r\n    description: `:::tip\r\nTo subscribe to [Latest](https://musify.club/en), where the source URL is \\`https://musify.club/en\\`, extract the certain parts from this URL to be used as parameters, resulting in the route as [\\`/musify/en\\`](https://rsshub.app/musify/en).\r\n:::\r\n`,\r\n    categories: ['multimedia'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['musify.club/:language'],\r\n            target: '/:language',\r\n        },\r\n        {\r\n            title: 'Latest',\r\n            source: ['musify.club/en'],\r\n            target: '/en',\r\n        },\r\n        {\r\n            title: '​​Последняя',\r\n            source: ['musify.club'],\r\n            target: '/',\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n};\r\n"],"mappings":"yPAQA,MAAa,EAAU,KAAO,IAAgC,CAC1D,GAAM,CAAE,WAAW,IAAO,EAAI,IAAI,QAC5BA,EAAgB,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IAEhEC,EAAkB,sBAClBC,EAAoB,IAAI,IAAI,EAAU,GAAS,KAE/C,EAAW,MAAMC,EAAO,GACxBC,EAAgB,EAAK,GAErBC,EAAoB,EAAE,sBACvB,MAAM,EAAG,GACT,UACA,IAAK,GAAgB,CAClB,IAAMC,EAAwB,EAAE,GAE1BC,EAA6B,EAAI,KAAK,eACtCC,EAA2B,EAAI,KAAK,aAEpCC,EAAgB,CAAC,EAAQ,GAAM,OAAO,SAAS,KAAK,OACpDC,EAA8B,EAAI,KAAK,YAAY,KAAK,QACxDC,EAAuB,EAAI,KAAK,2BAA2B,UAC3DC,EAA8B,EAAU,IAAK,GAAa,CAC5D,IAAMC,EAA8B,EAAE,GAEtC,MAAO,CACH,KAAM,EAAU,OAChB,IAAK,EAAU,KAAK,QAAU,IAAI,IAAI,EAAU,KAAK,QAAmB,GAAS,KAAO,IAAA,GACxF,OAAQ,IAAA,MAIZC,EAA0B,CAC1B,QACA,KAAM,EAAU,IAAI,IAAI,EAAS,GAAS,KAAO,IAAA,GACjD,OAAQ,GAGNC,EAAiC,EAAI,KAAK,yBAC1CC,EAAmC,EAAa,KAAK,iBAc3D,OAZI,IACA,EAAgB,CACZ,GAAG,EACH,cAAe,IAAI,IAAI,EAAc,GAAS,KAC9C,eAAgB,SAAS,EAAa,MAAM,MAAM,QAClD,gBAAiB,EACjB,iBAAkB,IAAA,GAClB,gBAAiB,IAAA,GACjB,kBAAmB,IAAA,KAIpB,IAGf,MAAO,CACH,MAAO,EAAE,SAAS,OAClB,YAAa,EAAE,mCAAmC,KAAK,WACvD,KAAM,EACN,KAAM,EACN,WAAY,GACZ,MAAO,EAAE,6BAA6B,KAAK,WAC3C,OAAQ,EAAE,iCAAiC,KAAK,WAChD,GAAI,EAAE,2BAA2B,KAAK,aAIjCC,EAAe,CACxB,KAAM,cACN,KAAM,SACN,IAAK,cACL,YAAa,CAAC,WACd,UACA,QAAS,aACT,WAAY,CACR,SAAU,CACN,YAAa,+BACb,QAAS,CACL,CACI,MAAO,UACP,MAAO,IAEX,CACI,MAAO,UACP,MAAO,SAKvB,YAAa,+PAIb,WAAY,CAAC,cACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,yBACT,OAAQ,cAEZ,CACI,MAAO,SACP,OAAQ,CAAC,kBACT,OAAQ,OAEZ,CACI,MAAO,cACP,OAAQ,CAAC,eACT,OAAQ,MAGhB,KAAM,EAAS"}