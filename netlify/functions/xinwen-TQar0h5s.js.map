{"version":3,"file":"xinwen-TQar0h5s.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/byau/xinwen/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:type_id',\r\n    categories: ['university'],\r\n    example: '/byau/news/3674',\r\n    parameters: { type_id: '栏目类型(从菜单栏获取对应 ID)' },\r\n    radar: [\r\n        {\r\n            source: ['xinwen.byau.edu.cn/:type_id/list.htm'],\r\n            target: '/news/:type_id',\r\n        },\r\n    ],\r\n    name: '新闻网',\r\n    maintainers: ['ueiu'],\r\n    handler,\r\n    url: 'xinwen.byau.edu.cn',\r\n    description: `| 学校要闻 | 校园动态 |\r\n| ---- | ----------- |\r\n| 3674 | 3676 |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'http://xinwen.byau.edu.cn/';\r\n\r\n    const typeID = ctx.req.param('type_id');\r\n    const url = `${baseUrl}${typeID}/list.htm`;\r\n\r\n    const response = await got(url);\r\n    const $ = load(response.data);\r\n\r\n    const list = $('.news')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $$ = load(item);\r\n\r\n            const originalItemUrl = $$('a').attr('href');\r\n            // 因为学校要闻的头两个像是固定了跳转专栏页面的，不能相同处理\r\n            const startsWithHttp = originalItemUrl.startsWith('http');\r\n            const itemUrl = startsWithHttp ? originalItemUrl : new URL(originalItemUrl, baseUrl).href;\r\n\r\n            return {\r\n                title: $$('a').text(),\r\n                link: itemUrl,\r\n                pubDate: timezone(parseDate($$('.news_meta').text()), +8),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await got(item.link);\r\n                const $ = load(response.data);\r\n\r\n                item.description = $('.col_news_con').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAaA,EAAe,CACxB,KAAM,iBACN,WAAY,CAAC,cACb,QAAS,kBACT,WAAY,CAAE,QAAS,qBACvB,MAAO,CACH,CACI,OAAQ,CAAC,wCACT,OAAQ,mBAGhB,KAAM,MACN,YAAa,CAAC,QACd,UACA,IAAK,qBACL,YAAa;;kBAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,6BAEV,EAAS,EAAI,IAAI,MAAM,WACvB,EAAM,GAAG,IAAU,EAAO,WAE1B,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,SACV,UACA,IAAK,GAAS,CACX,IAAM,EAAK,EAAK,GAEV,EAAkB,EAAG,KAAK,KAAK,QAE/B,EAAiB,EAAgB,WAAW,QAC5C,EAAU,EAAiB,EAAkB,IAAI,IAAI,EAAiB,GAAS,KAErF,MAAO,CACH,MAAO,EAAG,KAAK,OACf,KAAM,EACN,QAAS,EAAS,EAAU,EAAG,cAAc,QAAS,MAI5D,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAW,MAAMF,EAAI,EAAK,MAC1BG,EAAI,EAAKD,EAAS,MAIxB,MAFA,GAAK,YAAcC,EAAE,iBAAiB,OAE/B,MAKnB,MAAO,CACH,MAAO,EAAE,SAAS,OAClB,KAAM,EACN,KAAM"}