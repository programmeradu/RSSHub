{"version":3,"file":"cccmc-BqzB9rGw.js","names":["limit: number","baseUrl: string","targetUrl: string","ofetch","$: CheerioAPI","items: DataItem[]","regex: RegExp","title: string","pubDateStr: string | undefined","linkUrl: string | undefined","upDatedStr: string | undefined","processedItem: DataItem","cache","$$: CheerioAPI","description: string","authorEls: Element[]","authors: DataItem['author']","$$authorEl: Cheerio<Element>","route: Route","category: string"],"sources":["../../lib/routes/cccmc/index.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { type CheerioAPI, type Cheerio, load } from 'cheerio';\r\nimport type { Element } from 'domhandler';\r\nimport { type Context } from 'hono';\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const { category = 'ywgg/tzgg' } = ctx.req.param();\r\n    const limit: number = Number.parseInt(ctx.req.query('limit') ?? '15', 10);\r\n\r\n    const baseUrl: string = 'https://www.cccmc.org.cn';\r\n    const targetUrl: string = new URL(category.endsWith('/') ? category : `${category}/`, baseUrl).href;\r\n\r\n    const response = await ofetch(targetUrl);\r\n    const $: CheerioAPI = load(response);\r\n    const language = $('html').attr('lang') ?? 'zh-CN';\r\n\r\n    let items: DataItem[] = [];\r\n\r\n    const regex: RegExp = /\\{url:'(.*)',title:'(.*)',time:'(.*)'\\},/g;\r\n\r\n    items =\r\n        response\r\n            .match(regex)\r\n            ?.slice(0, limit)\r\n            .map((item): DataItem => {\r\n                const matches = item.match(/'(.*?)'/);\r\n\r\n                const title: string = matches?.[2] ?? '';\r\n                const pubDateStr: string | undefined = matches?.[3];\r\n                const linkUrl: string | undefined = matches?.[1];\r\n                const upDatedStr: string | undefined = pubDateStr;\r\n\r\n                const processedItem: DataItem = {\r\n                    title,\r\n                    pubDate: pubDateStr ? parseDate(pubDateStr) : undefined,\r\n                    link: linkUrl ? new URL(linkUrl, baseUrl).href : undefined,\r\n                    updated: upDatedStr ? parseDate(upDatedStr) : undefined,\r\n                    language,\r\n                };\r\n\r\n                return processedItem;\r\n            }) ?? [];\r\n\r\n    items = (\r\n        await Promise.all(\r\n            items.map((item) => {\r\n                if (!item.link) {\r\n                    return item;\r\n                }\r\n\r\n                return cache.tryGet(item.link, async (): Promise<DataItem> => {\r\n                    const detailResponse = await ofetch(item.link);\r\n                    const $$: CheerioAPI = load(detailResponse);\r\n\r\n                    const title: string = $$('div.title').text();\r\n                    const description: string = $$('div#article-content').html() ?? '';\r\n                    const pubDateStr: string | undefined = $$('span.time').text().split(/：/).pop();\r\n                    const authorEls: Element[] = $$('span.form, span.from').toArray();\r\n                    const authors: DataItem['author'] = authorEls.map((authorEl) => {\r\n                        const $$authorEl: Cheerio<Element> = $$(authorEl);\r\n\r\n                        return {\r\n                            name: $$authorEl.text().split(/：/).pop() ?? $$authorEl.text(),\r\n                        };\r\n                    });\r\n                    const upDatedStr: string | undefined = pubDateStr;\r\n\r\n                    const processedItem: DataItem = {\r\n                        title,\r\n                        description,\r\n                        pubDate: pubDateStr ? parseDate(pubDateStr) : item.pubDate,\r\n                        author: authors,\r\n                        content: {\r\n                            html: description,\r\n                            text: description,\r\n                        },\r\n                        updated: upDatedStr ? parseDate(upDatedStr) : item.updated,\r\n                        language,\r\n                    };\r\n\r\n                    return {\r\n                        ...item,\r\n                        ...processedItem,\r\n                    };\r\n                });\r\n            })\r\n        )\r\n    ).filter((_): _ is DataItem => true);\r\n\r\n    const title: string = $('title').text();\r\n\r\n    return {\r\n        title,\r\n        description: title.split(/-/)[0].trim(),\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: $('img.logo').attr('src'),\r\n        author: title.split(/-/)?.pop()?.trim(),\r\n        language,\r\n        id: targetUrl,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category{.+}?',\r\n    name: '通用',\r\n    url: 'www.cccmc.org.cn',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/cccmc/ywgg/tzgg',\r\n    parameters: {\r\n        category: '分类，默认为 `ywgg/tzgg`，即通知公告，可在对应分类页 URL 中找到, Category, `ywgg/tzgg`，即通知公告  by default',\r\n    },\r\n    description: `:::tip\r\n若订阅 [综合政策](https://www.cccmc.org.cn/zcfg/zhzc/)，网址为 \\`https://www.cccmc.org.cn/zcfg/zhzc/\\`，请截取 \\`https://www.cccmc.org.cn/\\` 到末尾的部分 \\`zcfg/zhzc\\` 作为 \\`category\\` 参数填入，此时目标路由为 [\\`/cccmc/zcfg/zhzc\\`](https://rsshub.app/cccmc/zcfg/zhzc)。\r\n:::\r\n\r\n<details>\r\n<summary>更多分类</summary>\r\n\r\n#### [会员之家](https://www.cccmc.org.cn/hyzj)\r\n\r\n| [会员之声](https://www.cccmc.org.cn/hyzj/hyzs/) | [会员动态](https://www.cccmc.org.cn/hyzj/hydt/) | [会员推介](https://www.cccmc.org.cn/hyzj/hytj/) |\r\n| ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- |\r\n| [hyzj/hyzs](https://rsshub.app/cccmc/hyzj/hyzs) | [hyzj/hydt](https://rsshub.app/cccmc/hyzj/hydt) | [hyzj/hytj](https://rsshub.app/cccmc/hyzj/hytj) |\r\n\r\n#### [政策法规](https://www.cccmc.org.cn/zcfg)\r\n\r\n| [综合政策](https://www.cccmc.org.cn/zcfg/zhzc/) | [国内贸易](https://www.cccmc.org.cn/zcfg/gnmy/) | [对外贸易](https://www.cccmc.org.cn/zcfg/dwmy/) | [投资合作](https://www.cccmc.org.cn/zcfg/tzhz/) |\r\n| ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- |\r\n| [zcfg/zhzc](https://rsshub.app/cccmc/zcfg/zhzc) | [zcfg/gnmy](https://rsshub.app/cccmc/zcfg/gnmy) | [zcfg/dwmy](https://rsshub.app/cccmc/zcfg/dwmy) | [zcfg/tzhz](https://rsshub.app/cccmc/zcfg/tzhz) |\r\n\r\n#### [行业资讯](https://www.cccmc.org.cn/hyzx)\r\n\r\n| [统计分析](https://www.cccmc.org.cn/hyzx/tjfx/) | [石油化工](https://www.cccmc.org.cn/hyzx/syhg/) | [金属矿产](https://www.cccmc.org.cn/hyzx/jskc/) | [五金建材](https://www.cccmc.org.cn/hyzx/wjjc/) |\r\n| ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- |\r\n| [hyzx/tjfx](https://rsshub.app/cccmc/hyzx/tjfx) | [hyzx/syhg](https://rsshub.app/cccmc/hyzx/syhg) | [hyzx/jskc](https://rsshub.app/cccmc/hyzx/jskc) | [hyzx/wjjc](https://rsshub.app/cccmc/hyzx/wjjc) |\r\n\r\n#### [商业机会](https://www.cccmc.org.cn/syjh/)+\r\n\r\n| [供应信息](https://www.cccmc.org.cn/syjh/gyxx/) | [需求信息](https://www.cccmc.org.cn/syjh/xqxx/) | [合作信息](https://www.cccmc.org.cn/syjh/hzxx/) |\r\n| ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- |\r\n| [syjh/gyxx](https://rsshub.app/cccmc/syjh/gyxx) | [syjh/xqxx](https://rsshub.app/cccmc/syjh/xqxx) | [syjh/hzxx](https://rsshub.app/cccmc/syjh/hzxx) |\r\n\r\n#### [商会党建](https://www.cccmc.org.cn/shdj)\r\n\r\n| [党群动态](https://www.cccmc.org.cn/shdj/dqdt/) | [党内法规](https://www.cccmc.org.cn/shdj/dnfg/) | [青年工作](https://www.cccmc.org.cn/shdj/qngz/) |\r\n| ----------------------------------------------- | ----------------------------------------------- | ----------------------------------------------- |\r\n| [shdj/dqdt](https://rsshub.app/cccmc/shdj/dqdt) | [shdj/dnfg](https://rsshub.app/cccmc/shdj/dnfg) | [shdj/qngz](https://rsshub.app/cccmc/shdj/qngz) |\r\n</details>\r\n`,\r\n    categories: ['new-media'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.cccmc.org.cn/:category'],\r\n            target: (params) => {\r\n                const category: string = params.category;\r\n\r\n                return `/cccmc${category ? `/${category}` : ''}`;\r\n            },\r\n        },\r\n        {\r\n            title: '商业机会 - 供应信息',\r\n            source: ['www.cccmc.org.cn/syjh/gyxx/'],\r\n            target: '/syjh/gyxx',\r\n        },\r\n        {\r\n            title: '商业机会 - 需求信息',\r\n            source: ['www.cccmc.org.cn/syjh/xqxx/'],\r\n            target: '/syjh/xqxx',\r\n        },\r\n        {\r\n            title: '商业机会 - 合作信息',\r\n            source: ['www.cccmc.org.cn/syjh/hzxx/'],\r\n            target: '/syjh/hzxx',\r\n        },\r\n        {\r\n            title: '商会党建 - 党群动态',\r\n            source: ['www.cccmc.org.cn/shdj/dqdt/'],\r\n            target: '/shdj/dqdt',\r\n        },\r\n        {\r\n            title: '商会党建 - 党内法规',\r\n            source: ['www.cccmc.org.cn/shdj/dnfg/'],\r\n            target: '/shdj/dnfg',\r\n        },\r\n        {\r\n            title: '商会党建 - 青年工作',\r\n            source: ['www.cccmc.org.cn/shdj/qngz/'],\r\n            target: '/shdj/qngz',\r\n        },\r\n        {\r\n            title: '行业资讯 - 统计分析',\r\n            source: ['www.cccmc.org.cn/hyzx/tjfx/'],\r\n            target: '/hyzx/tjfx',\r\n        },\r\n        {\r\n            title: '行业资讯 - 石油化工',\r\n            source: ['www.cccmc.org.cn/hyzx/syhg/'],\r\n            target: '/hyzx/syhg',\r\n        },\r\n        {\r\n            title: '行业资讯 - 金属矿产',\r\n            source: ['www.cccmc.org.cn/hyzx/jskc/'],\r\n            target: '/hyzx/jskc',\r\n        },\r\n        {\r\n            title: '行业资讯 - 五金建材',\r\n            source: ['www.cccmc.org.cn/hyzx/wjjc/'],\r\n            target: '/hyzx/wjjc',\r\n        },\r\n        {\r\n            title: '会员之家 - 会员之声',\r\n            source: ['www.cccmc.org.cn/hyzj/hyzs/'],\r\n            target: '/hyzj/hyzs',\r\n        },\r\n        {\r\n            title: '会员之家 - 会员动态',\r\n            source: ['www.cccmc.org.cn/hyzj/hydt/'],\r\n            target: '/hyzj/hydt',\r\n        },\r\n        {\r\n            title: '会员之家 - 会员推介',\r\n            source: ['www.cccmc.org.cn/hyzj/hytj/'],\r\n            target: '/hyzj/hytj',\r\n        },\r\n        {\r\n            title: '政策法规 - 综合政策',\r\n            source: ['www.cccmc.org.cn/zcfg/zhzc/'],\r\n            target: '/zcfg/zhzc',\r\n        },\r\n        {\r\n            title: '政策法规 - 国内贸易',\r\n            source: ['www.cccmc.org.cn/zcfg/gnmy/'],\r\n            target: '/zcfg/gnmy',\r\n        },\r\n        {\r\n            title: '政策法规 - 对外贸易',\r\n            source: ['www.cccmc.org.cn/zcfg/dwmy/'],\r\n            target: '/zcfg/dwmy',\r\n        },\r\n        {\r\n            title: '政策法规 - 投资合作',\r\n            source: ['www.cccmc.org.cn/zcfg/tzhz/'],\r\n            target: '/zcfg/tzhz',\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n};\r\n"],"mappings":"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"}