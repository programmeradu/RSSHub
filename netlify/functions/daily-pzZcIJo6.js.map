{"version":3,"file":"daily-pzZcIJo6.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/readhub/daily.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nimport { rootUrl, apiRootUrl, processItems } from './util';\r\n\r\nexport const route: Route = {\r\n    path: '/daily',\r\n    categories: ['new-media'],\r\n    example: '/readhub/daily',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['readhub.cn/daily'],\r\n        },\r\n    ],\r\n    name: '每日早报',\r\n    maintainers: ['nczitzk', 'fashioncj'],\r\n    handler,\r\n    url: 'readhub.cn/daily',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 11;\r\n\r\n    const currentUrl = new URL('daily', apiRootUrl).href;\r\n    const infoUrl = new URL('daily', rootUrl).href;\r\n\r\n    const { data: currentResponse } = await got(currentUrl);\r\n\r\n    const dailyItems = currentResponse.data.items;\r\n\r\n    let items = dailyItems.slice(0, limit).map((item) => ({\r\n        title: item.title,\r\n        link: new URL(`topic/${item.uid}`, rootUrl).href,\r\n        description: `<p>${item.summary}</p>`,\r\n        guid: item.uid,\r\n    }));\r\n\r\n    items = await processItems(items, cache.tryGet);\r\n\r\n    const { data: currentHTMLResponse } = await got(infoUrl);\r\n    const $ = load(currentHTMLResponse);\r\n\r\n    const author = $('meta[name=\"application-name\"]').prop('content');\r\n    const subtitle = $('meta[property=\"og:title\"]').prop('content');\r\n    const image = 'https://readhub.cn/icons/icon-192x192.png';\r\n    const icon = new URL($('link[rel=\"apple-touch-icon\"]').prop('href'), rootUrl);\r\n\r\n    return {\r\n        item: items,\r\n        title: `${author} - ${route.name}`,\r\n        link: currentUrl,\r\n        description: $('meta[name=\"description\"]').prop('content'),\r\n        language: 'zh',\r\n        image,\r\n        icon,\r\n        logo: icon,\r\n        subtitle,\r\n        author,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"gcAOA,MAAaA,EAAe,CACxB,KAAM,SACN,WAAY,CAAC,aACb,QAAS,iBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,sBAGjB,KAAM,OACN,YAAa,CAAC,UAAW,aACzB,UACA,IAAK,oBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAa,IAAI,IAAI,QAAS,GAAY,KAC1C,EAAU,IAAI,IAAI,QAAS,GAAS,KAEpC,CAAE,KAAM,GAAoB,MAAMC,EAAI,GAEtC,EAAa,EAAgB,KAAK,MAEpC,EAAQ,EAAW,MAAM,EAAG,GAAO,IAAK,IAAU,CAClD,MAAO,EAAK,MACZ,KAAM,IAAI,IAAI,SAAS,EAAK,MAAO,GAAS,KAC5C,YAAa,MAAM,EAAK,QAAQ,MAChC,KAAM,EAAK,OAGf,EAAQ,MAAM,EAAa,EAAOC,EAAM,QAExC,GAAM,CAAE,KAAM,GAAwB,MAAMD,EAAI,GAC1C,EAAI,EAAK,GAET,EAAS,EAAE,iCAAiC,KAAK,WACjD,EAAW,EAAE,6BAA6B,KAAK,WAE/C,EAAO,IAAI,IAAI,EAAE,gCAAgC,KAAK,QAAS,GAErE,MAAO,CACH,KAAM,EACN,MAAO,GAAG,EAAO,KAAK,EAAM,OAC5B,KAAM,EACN,YAAa,EAAE,4BAA4B,KAAK,WAChD,SAAU,KACV,kDACA,OACA,KAAM,EACN,WACA,SACA,WAAY"}