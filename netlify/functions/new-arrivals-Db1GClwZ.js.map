{"version":3,"file":"new-arrivals-Db1GClwZ.js","names":[],"sources":["../../lib/routes/patagonia/new-arrivals.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { load } from 'cheerio';\r\nconst host = 'https://www.patagonia.com';\r\nconst categoryMap = {\r\n    mens: ['mens-new', 'mens-new-arrivals'],\r\n    womens: ['womens-new', 'womens-new-arrivals'],\r\n    kids: ['kids-new-arrivals', 'kids-baby-new-arrivals'],\r\n    luggage: ['luggage-new-arrivals', 'luggage-new-arrivals'],\r\n};\r\nfunction extractSfrmUrl(url) {\r\n    const urlObj = new URL(url);\r\n    const sfrmValue = urlObj.searchParams.get('sfrm');\r\n    urlObj.search = new URLSearchParams({ sfrm: sfrmValue }).toString();\r\n    return urlObj.toString();\r\n}\r\nexport const route: Route = {\r\n    path: '/new-arrivals/:category',\r\n    categories: ['shopping'],\r\n    example: '/patagonia/new-arrivals/mens',\r\n    parameters: { category: 'category, see below' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'New Arrivals',\r\n    maintainers: [],\r\n    handler,\r\n    description: `| Men's | Women's | Kids' & Baby | Packs & Gear |\r\n| ----- | ------- | ------------ | ------------ |\r\n| mens  | womens  | kids         | luggage      |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category');\r\n    const url = `${host}/on/demandware.store/Sites-patagonia-us-Site/en_US/Search-LazyGrid`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n        searchParams: {\r\n            cgid: categoryMap[category][0],\r\n            isLazyGrid: true,\r\n        },\r\n    });\r\n    const data = response.data;\r\n\r\n    const $ = load(data);\r\n    const list = $('.product')\r\n        .toArray()\r\n        .map((element) => {\r\n            const data = {};\r\n            data.title = $(element).find('.product-tile').data('tealium').product_name[0];\r\n            let imgUrl = new URL($(element).find('[itemprop=\"image\"]').attr('content'));\r\n            imgUrl = extractSfrmUrl(imgUrl);\r\n\r\n            const price = $(element).find('[itemprop=\"price\"]').eq(0).text();\r\n            data.link = host + '/' + $(element).find('[itemprop=\"url\"]').attr('href');\r\n            data.description =\r\n                price +\r\n                art(path.join(__dirname, 'templates/product-description.art'), {\r\n                    imgUrl,\r\n                });\r\n            data.category = $(element).find('[itemprop=\"category\"]').attr('content');\r\n            return data;\r\n        });\r\n    return {\r\n        title: `Patagonia - New Arrivals - ${category.toUpperCase()}`,\r\n        link: `${host}/shop/${categoryMap[category][1]}`,\r\n        description: `Patagonia - New Arrivals - ${category.toUpperCase()}`,\r\n        item: list,\r\n    };\r\n}\r\n"],"mappings":"+WAMA,MAAM,EAAO,4BACP,EAAc,CAChB,KAAM,CAAC,WAAY,qBACnB,OAAQ,CAAC,aAAc,uBACvB,KAAM,CAAC,oBAAqB,0BAC5B,QAAS,CAAC,uBAAwB,yBAEtC,SAAS,EAAe,EAAK,CACzB,IAAM,EAAS,IAAI,IAAI,GACjB,EAAY,EAAO,aAAa,IAAI,QAE1C,MADA,GAAO,OAAS,IAAI,gBAAgB,CAAE,KAAM,IAAa,WAClD,EAAO,WAElB,MAAa,EAAe,CACxB,KAAM,0BACN,WAAY,CAAC,YACb,QAAS,+BACT,WAAY,CAAE,SAAU,uBACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,eACN,YAAa,GACb,UACA,YAAa;;oDAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAM,GAAG,EAAK,oEACd,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,MACA,aAAc,CACV,KAAM,EAAY,GAAU,GAC5B,WAAY,MAGd,EAAO,EAAS,KAEhB,EAAI,EAAK,GACT,EAAO,EAAE,YACV,UACA,IAAK,GAAY,CACd,IAAM,EAAO,GACb,EAAK,MAAQ,EAAE,GAAS,KAAK,iBAAiB,KAAK,WAAW,aAAa,GAC3E,IAAI,EAAS,IAAI,IAAI,EAAE,GAAS,KAAK,sBAAsB,KAAK,YAChE,EAAS,EAAe,GAExB,IAAM,EAAQ,EAAE,GAAS,KAAK,sBAAsB,GAAG,GAAG,OAQ1D,MAPA,GAAK,KAAO,EAAO,IAAM,EAAE,GAAS,KAAK,oBAAoB,KAAK,QAClE,EAAK,YACD,EACA,EAAI,EAAA,KAAA,EAAA,8CAA2D,CAC3D,WAER,EAAK,SAAW,EAAE,GAAS,KAAK,yBAAyB,KAAK,WACvD,IAEf,MAAO,CACH,MAAO,8BAA8B,EAAS,gBAC9C,KAAM,GAAG,EAAK,QAAQ,EAAY,GAAU,KAC5C,YAAa,8BAA8B,EAAS,gBACpD,KAAM"}