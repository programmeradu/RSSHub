import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import"./cache-kimkMTWJ.js";import"./parse-date-Bgabdhlb.js";import"./md5-4BNsOP-F.js";import"./ofetch-Bzt0BXUH.js";import{got_default as t}from"./got-CdvI2yKX.js";import{config_not_found_default as n}from"./config-not-found-BVqhRP9D.js";import{finishArticleItem as r}from"./wechat-mp-BwNEdjlr.js";import{utils_default as i}from"./utils-2nBXn22a.js";import{load as a}from"cheerio";const o={path:`/wechat/:wxid`,categories:[`social-media`],example:`/newrank/wechat/chijiread`,parameters:{wxid:`微信号，若微信号与新榜信息不一致，以新榜为准`},features:{requireConfig:[{name:`NEWRANK_COOKIE`,description:``}],requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`微信公众号`,maintainers:[`lessmoe`,`pseudoyu`],handler:s};async function s(o){if(!e.newrank||!e.newrank.cookie)throw new n(`newrank RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let s=o.req.param(`wxid`),c=i.random_nonce(9),{data:l}=await t({method:`get`,url:`https://www.newrank.cn/new/readDetial?account=${s}`,headers:{Connection:`keep-alive`,Cookie:e.newrank.cookie}}),u=a(l),d=u(`script`).toArray().find(e=>(e.attribs.src||``).startsWith(`/new/static/js/main.`)).attribs.src,{data:f}=await t({method:`get`,url:`https://www.newrank.cn${d}`}),p=f.match(/"N-Token":"([^"]+)/);if(!p)throw Error(`Cannot find n-token`);let m=p[1],h=await t({method:`post`,url:`https://gw.newrank.cn/api/wechat/xdnphb/detail/v1/rank/article/lists`,headers:{Connection:`keep-alive`,Cookie:e.newrank.cookie,"n-token":m},form:{account:s,nonce:c,xyz:i.decrypt_wechat_detail_xyz(s,c)}}),g=h.data.value.user.name,_=i.flatten(h.data.value.realTimeArticles),v=i.flatten(h.data.value.articles),y=[..._,...v],b=y.map(e=>({id:e.id,title:e.title,description:``,link:e.url,pubDate:e.publicTime}));return await Promise.all(b.map(e=>r(e))),{title:g+` - 微信公众号`,link:`https://www.newrank.cn/new/readDetial?account=${s}`,item:b}}export{o as route};
//# sourceMappingURL=wechat-CP19q-OE.js.map