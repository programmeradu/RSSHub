import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{getSearchParams as o,rootUrl as s}from"./utils-vRWn3Cpl.js";import c from"node:path";import{load as l}from"cheerio";t();const u=async t=>{let{id:u=`1103`}=t.req.param(),d=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):20,f=new URL(`subject/${u}`,s).href,p=new URL(`api/subject/${u}/article`,s).href,{data:m}=await a(p,{searchParams:o({Subject_Id:u})}),h=m.data.slice(0,d).map(t=>{let n=t.article_title,a=r(c.join(e,`templates/description-b958bde9.art`),{intro:t.article_brief}),o=`cls-${t.article_id}`,l=t.article_img;return{title:n,description:a,pubDate:i(t.article_time,`X`),link:new URL(`detail/${t.article_id}`,s).href,category:t.subjects.map(e=>e.subject_name),author:t.article_author,guid:o,id:o,content:{html:a,text:t.article_brief},image:l,banner:l}});h=await Promise.all(h.map(t=>n.tryGet(t.link,async()=>{let{data:n}=await a(t.link),o=l(n),s=JSON.parse(o(`script#__NEXT_DATA__`).text())?.props?.initialState?.detail?.articleDetail??void 0;if(!s)return t;let u=s.title,d=r(c.join(e,`templates/description-b958bde9.art`),{images:s.images.map(e=>({src:e,alt:u})),intro:s.brief,description:s.content}),f=`cls-${s.id}`,p=s.images?.[0]??void 0;return t.title=u,t.description=d,t.pubDate=i(s.ctime,`X`),t.category=[...new Set(s.subject?.flatMap(e=>[e.name,...e.subjectCategory?.flatMap(e=>[e.columnName||[],e.name||[]])??[]])??[])].filter(Boolean),t.author=s.author?.name??t.author,t.guid=f,t.id=f,t.content={html:d,text:s.content},t.image=p,t.banner=p,t.enclosure_url=s.audioUrl,t.enclosure_type=t.enclosure_url?`audio/${t.enclosure_url.split(/\./).pop()}`:void 0,t.enclosure_title=u,t})));let{data:g}=await a(f),_=l(g),v=JSON.parse(_(`script#__NEXT_DATA__`).text())?.props?.initialProps?.pageProps?.subjectDetail??void 0,y=`财联社`,b=v?.img??void 0;return{title:`${y} - ${v?.name??_(`title`).text()}`,description:v?.description??void 0,link:f,item:h,allowEmpty:!0,image:b,author:y}},d={path:`/subject/:id?`,name:`话题`,url:`www.cls.cn`,maintainers:[`nczitzk`],handler:u,example:`/cls/subject/1103`,parameters:{category:`分类，默认为 1103，即A股盘面直播，可在对应话题页 URL 中找到`},description:"::: tip\n  若订阅 [有声早报](https://www.cls.cn/subject/1151)，网址为 `https://www.cls.cn/subject/1151`。截取 `https://www.cls.cn/subject/` 到末尾的部分 `1151` 作为参数填入，此时路由为 [`/cls/subject/1151`](https://rsshub.app/cls/subject/1151)。\n:::\n    ",categories:[`finance`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.cls.cn/subject/:id`],target:e=>{let t=e.id;return`/subject${t?`/${t}`:``}`}}]};export{u as handler,d as route};
//# sourceMappingURL=subject-D55z5W8n.js.map