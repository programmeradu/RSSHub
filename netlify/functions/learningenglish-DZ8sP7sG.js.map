{"version":3,"file":"learningenglish-DZ8sP7sG.js","names":["route: Route","ofetch","cache"],"sources":["../../lib/routes/bbc/learningenglish.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    name: 'Learning English',\r\n    maintainers: ['Blank0120'],\r\n    categories: ['study'],\r\n    handler,\r\n    path: '/learningenglish/:channel?',\r\n    example: '/bbc/learningenglish/take-away-english',\r\n    parameters: {\r\n        channel: 'channel, default to `take-away-english`',\r\n    },\r\n    description: `| 随身英语 | 地道英语 | 媒体英语 | 英语大破解 | 一分钟英语 |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| take-away-english | authentic-real-english | media-english | lingohack | english-in-a-minute |\r\n\r\n| 短语动词 | 今日短语 | 你问我答 | 白领英语 | 亲子英语故事 |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| phrasal-verbs | todays-phrase | q-and-a | english-at-work | storytellers |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    // set targetURL\r\n    const { channel = 'take-away-english' } = ctx.req.param();\r\n\r\n    const rootURL = 'https://www.bbc.co.uk';\r\n    const targerURL = `${rootURL}/learningenglish/chinese/features/${channel}`;\r\n\r\n    const response = await ofetch(targerURL, { parseResponse: (txt) => txt });\r\n    const $ = load(response);\r\n\r\n    // get top article links\r\n    const firstItem = {\r\n        title: $('[data-widget-index=4]').find('h2').text(),\r\n        link: `${rootURL}${$('[data-widget-index=4]').find('h2 a').attr('href')}`,\r\n        pubDate: parseDate($('[data-widget-index=4]').find('.details h3').text()),\r\n    };\r\n\r\n    // get rest ul article links\r\n    const restItems = $('.threecol li')\r\n        .toArray()\r\n        .slice(0, 10)\r\n        .map((article) => {\r\n            const $article = load(article);\r\n\r\n            return {\r\n                title: $article('h2').text(),\r\n                link: `${rootURL}${$article('h2 a').attr('href')}`,\r\n                pubDate: parseDate($article('.details h3').text()),\r\n            };\r\n        });\r\n\r\n    // try get article content detail\r\n    const items = await Promise.all(\r\n        [firstItem, ...restItems].map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await ofetch(item.link, { parseResponse: (txt) => txt });\r\n\r\n                const $content = load(detailResponse);\r\n\r\n                item.description = $content('.widget-richtext').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `Learningenglish-${channel}-BBC`,\r\n        link: targerURL,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mTAMA,MAAaA,EAAe,CACxB,KAAM,mBACN,YAAa,CAAC,aACd,WAAY,CAAC,SACb,UACA,KAAM,6BACN,QAAS,yCACT,WAAY,CACR,QAAS,2CAEb,YAAa;;;;;;+EASjB,eAAe,EAAQ,EAAK,CAExB,GAAM,CAAE,UAAU,qBAAwB,EAAI,IAAI,QAE5C,EAAU,wBACV,EAAY,GAAG,EAAQ,oCAAoC,IAE3D,EAAW,MAAMC,EAAO,EAAW,CAAE,cAAgB,GAAQ,IAC7D,EAAI,EAAK,GAGT,EAAY,CACd,MAAO,EAAE,yBAAyB,KAAK,MAAM,OAC7C,KAAM,GAAG,IAAU,EAAE,yBAAyB,KAAK,QAAQ,KAAK,UAChE,QAAS,EAAU,EAAE,yBAAyB,KAAK,eAAe,SAIhE,EAAY,EAAE,gBACf,UACA,MAAM,EAAG,IACT,IAAK,GAAY,CACd,IAAM,EAAW,EAAK,GAEtB,MAAO,CACH,MAAO,EAAS,MAAM,OACtB,KAAM,GAAG,IAAU,EAAS,QAAQ,KAAK,UACzC,QAAS,EAAU,EAAS,eAAe,WAKjD,EAAQ,MAAM,QAAQ,IACxB,CAAC,EAAW,GAAG,GAAW,IAAK,GAC3BC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAO,EAAK,KAAM,CAAE,cAAgB,GAAQ,IAEnE,EAAW,EAAK,GAGtB,MADA,GAAK,YAAc,EAAS,oBAAoB,OACzC,MAKnB,MAAO,CACH,MAAO,mBAAmB,EAAQ,MAClC,KAAM,EACN,KAAM"}