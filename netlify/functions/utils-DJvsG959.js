import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{art as n}from"./render-CxhTJIsl.js";import{parseDate as r}from"./parse-date-Bgabdhlb.js";import{got_default as i}from"./got-CdvI2yKX.js";import a from"node:path";import{load as o}from"cheerio";t();const s=async(e,t,n,r)=>{let{data:a}=await i(`https://${e}.news.yahoo.com/_td-news/api/resource/NCPListService;api=archive;ncpParams=${encodeURIComponent(JSON.stringify({query:{count:t,start:0,providerid:r,tag:n}}))}`);return a},c=async(e,t)=>{let{data:n}=await i(`https://${e}.news.yahoo.com/_td-news/api/resource/StreamService;category=LISTID%3A${t};useNCP=true`);return n},l=(e,t)=>t(`yahoo:${e}:categoryMap`,async()=>{let{PageStore:n}=await d(e,t),{Col1:r}=n.pagesConfigRaw.base.section.regions,{categoryMap:i}=r.find(e=>e.name===`ArchiveFilterBar`).props;for(let[e,t]of Object.entries(i))i[e]={name:t,yctMap:r.find(e=>e.name===`StreamContainerArchive`).props.yctMap[e]};return i}),u=(e,t)=>t(`yahoo:${e}:providerList`,async()=>{let{ProviderListStore:n}=await d(e,t);return n.providerList.flatMap(t=>t.providers.map(n=>({title:`${t.title} - ${n.title}`,key:n.key,link:new URL(n.url,`https://${e}.news.yahoo.com`).href})))}),d=(e,t)=>t(`yahoo:${e}:stores`,async()=>{let{data:t}=await i(`https://${e}.news.yahoo.com/archive`),n=o(t),r=JSON.parse(n(`script:contains("root.App.main")`).text().match(/root.App.main\s+=\s+({.+});/)?.[1]);return r.context.dispatcher.stores}),f=(e,t)=>t.map(t=>({title:t.title,link:t.url.startsWith(`http`)?t.url:new URL(t.url,`https://${e}.news.yahoo.com`).href,description:t.summary,pubDate:r(t.published_at,`X`)})),p=(t,s)=>s(t.link,async()=>{let{data:s}=await i(t.link),c=o(s),l=JSON.parse(c(`script[type="application/ld+json"]`).first().text()),u=`${c(`span.caas-author-byline-collapse`).text()} @${c(`span.caas-attr-provider`).text()}`,d=c(`.atoms`);return d.find(`noscript`).remove(),d.find(`.caas-figure-with-pb, .caas-img-container`).each((e,t)=>{let n=c(t);n.removeAttr(`style`)}),d.find(`img`).each((e,t)=>{let n=c(t),r=n.data(`src`);if(r){let e=r.match(/.*--\/.*--\/(.*)/);e?.[1]&&(r=e?.[1]),n.attr(`src`,r),n.removeAttr(`data-src`)}}),d.find(`.caas-iframe`).each((t,r)=>{let i=c(r);if(i.data(`type`)===`youtube`){let t=i.find(`blockquote`).data(`src`);i.replaceWith(n(a.join(e,`templates/youtube-40f870b0.art`),{id:t.split(`/`).pop()?.split(`?`)?.[0]}))}}),t.description=d.html(),t.author=u,t.category=l.keywords,t.pubDate=r(l.datePublished),t.updated=r(l.dateModified),t});export{s as getArchive,l as getCategories,c as getList,u as getProviderList,p as parseItem,f as parseList};
//# sourceMappingURL=utils-DJvsG959.js.map