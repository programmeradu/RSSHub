import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{invalid_parameter_default as o}from"./invalid-parameter-CUJdROXf.js";import{rss_parser_default as s}from"./rss-parser-1vyhErsD.js";import c from"node:path";import{load as l}from"cheerio";t();const u=new Set([`tw`,`hk`]),d={path:`/:region?`,categories:[`new-media`],example:`/eprice/tw`,parameters:{region:`地区，预设为 tw`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`最新消息`,maintainers:[`TonyRL`],handler:f,description:`地区：

| hk   | tw   |
| ---- | ---- |
| 香港 | 台湾 |`};async function f(t){let d=t.req.param(`region`)??`tw`;if(!u.has(d))throw new o(`Invalid region`);let f=await s.parseURL(`https://www.eprice.com.${d}/news/rss.xml`);for(let e of f.items)e.link=e.link.replace(/^http:\/\//i,`https://`);let p=await Promise.all(f.items.map(t=>n.tryGet(t.link,async()=>{let n=await a(t.link,{headers:{Referer:`https://www.eprice.com.${d}`}}),o=l(n.data);return o(`noscript`).remove(),o(`div[id^=dablewidget]`).remove(),o(`div[class^=parallax-ads]`).remove(),o(`.adsbygoogle, .join-eprice-fb, .teads`).remove(),o(`div.ad-336x280-g, div.ad-728x90-g`).remove(),o(`div.clear, div.news-vote, div.signature`).remove(),o(`ul.inner, ul.navigator, ul.infobar`).remove(),o(`iframe[src^="https://www.facebook.com/plugins/like.php"]`).remove(),t.category=t.categories,o(`a`).each((t,n)=>{n=o(n),n.attr(`href`)&&n.attr(`href`).endsWith(`.jpg`)&&(n.after(r(c.join(e,`templates/image-cc81ebfe.art`),{alt:n.attr(`title`),src:n.attr(`href`)})),n.remove())}),o(`img`).each((e,t)=>{t=o(t),t.attr(`data-original`)&&t.attr(`src`,t.attr(`data-original`))}),delete t.categories,delete t.content,delete t.contentSnippet,delete t.creator,delete t.enclosure,delete t.isoDate,t.description=o(`div.user-comment-block`).html()||o(`div.content`).html()||o(`li.inner`).html()||o(`div.section-content`).html()||o(`.article__content`).html(),t.pubDate=i(t.pubDate),t}))),m={title:f.title,link:f.link,description:f.description,item:p,image:f.image.url,language:f.language};return t.set(`json`,m),m}export{d as route};
//# sourceMappingURL=rss-CTW0BTD2.js.map