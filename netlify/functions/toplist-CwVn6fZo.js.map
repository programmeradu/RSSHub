{"version":3,"file":"toplist-CwVn6fZo.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/aisixiang/toplist.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { rootUrl, ossUrl, ProcessFeed } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: ['/ranking/:id?/:period?', '/toplist/:id?/:period?'],\r\n    name: 'Unknown',\r\n    maintainers: ['HenryQW', 'nczitzk'],\r\n    handler,\r\n    description: `| 文章点击排行 | 最近更新文章 | 文章推荐排行 |\r\n| ------------ | ------------ | ------------ |\r\n| 1            | 10           | 11           |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { id = '1', period = '1' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 30;\r\n\r\n    const currentUrl = new URL(`toplist${id ? `?id=${id}${id === '1' ? `&period=${period}` : ''}` : ''}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const title = `${$('a.hl').text() || ''}${$('title').text().split('_')[0]}`;\r\n\r\n    const items = $('div.tops_list')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('div.tips a');\r\n\r\n            return {\r\n                title: a.text(),\r\n                link: new URL(a.prop('href'), rootUrl).href,\r\n                author: item.find('div.name').text(),\r\n                pubDate: parseDate(item.find('div.times').text()),\r\n            };\r\n        });\r\n\r\n    return {\r\n        item: await ProcessFeed(limit, cache.tryGet, items),\r\n        title: `爱思想 - ${title}`,\r\n        link: currentUrl,\r\n        language: 'zh-cn',\r\n        image: new URL('images/logo_toplist.jpg', ossUrl).href,\r\n        subtitle: title,\r\n    };\r\n}\r\n"],"mappings":"kdAQA,MAAaA,EAAe,CACxB,KAAM,CAAC,yBAA0B,0BACjC,KAAM,UACN,YAAa,CAAC,UAAW,WACzB,UACA,YAAa;;iDAKjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,KAAK,IAAK,SAAS,KAAQ,EAAI,IAAI,QACrC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAa,IAAI,IAAI,UAAU,EAAK,OAAO,IAAK,IAAO,IAAM,WAAW,IAAW,KAAO,KAAM,GAAS,KAEzG,CAAE,KAAM,GAAa,MAAMC,EAAI,GAE/B,EAAI,EAAK,GAET,EAAQ,GAAG,EAAE,QAAQ,QAAU,KAAK,EAAE,SAAS,OAAO,MAAM,KAAK,KAEjE,EAAQ,EAAE,iBACX,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAI,EAAK,KAAK,cAEpB,MAAO,CACH,MAAO,EAAE,OACT,KAAM,IAAI,IAAI,EAAE,KAAK,QAAS,GAAS,KACvC,OAAQ,EAAK,KAAK,YAAY,OAC9B,QAAS,EAAU,EAAK,KAAK,aAAa,WAItD,MAAO,CACH,KAAM,MAAM,EAAY,EAAOC,EAAM,OAAQ,GAC7C,MAAO,SAAS,IAChB,KAAM,EACN,SAAU,QACV,MAAO,IAAI,IAAI,0BAA2B,GAAQ,KAClD,SAAU"}