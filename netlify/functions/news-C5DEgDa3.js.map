{"version":3,"file":"news-C5DEgDa3.js","names":["route: Route","got"],"sources":["../../lib/routes/ustb/tj/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst baseUrl = 'http://tj.ustb.edu.cn';\r\nconst maps = {\r\n    xyxw: '/Class/xyxw/index.htm',\r\n    xshhd: '/Class/xshhd/index.htm',\r\n    csjsxy: '/Class/csjsxy/index.htm',\r\n    xxgcxy: '/Class/xxgcxy/index.htm',\r\n    jjx: '/Class/jjx/index.htm',\r\n    glxy: '/Class/glxy/index.htm',\r\n    clx: '/Class/clx/index.htm',\r\n    jxgcx: '/Class/jxgcx/index.htm',\r\n    hlx: '/Class/hlx/index.htm',\r\n    flx: '/Class/flx/index.htm',\r\n    wyx: '/Class/wyx/index.htm',\r\n    ysx: '/Class/ysx/index.htm',\r\n};\r\n\r\nfunction getNews(data) {\r\n    const $ = load(data);\r\n    return $('div[class=\"classnews\"] ul li a')\r\n        .toArray()\r\n        .map((elem) => ({\r\n            link: baseUrl + elem.attribs.href,\r\n            title: elem.children[0].data,\r\n            pubDate: timezone(parseDate(elem.attribs.href.split('/')[3].split('.')[0].slice(0, 14), 'YYYYMMDDHHmmss'), 8),\r\n        }));\r\n}\r\n\r\nexport const route: Route = {\r\n    path: '/tj/news/:type?',\r\n    categories: ['university'],\r\n    example: '/ustb/tj/news/all',\r\n    parameters: { type: '默认为 `all`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '天津学院',\r\n    maintainers: ['henbf'],\r\n    handler,\r\n    description: `| 全部 | 学院新闻 | 学术活动 | 城市建设学院 | 信息工程学院 | 经济学院 | 管理学院 | 材料系 | 机械工程系 | 护理系 | 法律系 | 外语系 | 艺术系 |\r\n| ---- | -------- | -------- | ------------ | ------------ | -------- | -------- | ------ | ---------- | ------ | ------ | ------ | ------ |\r\n| all  | xyxw     | xshhd    | csjsxy       | xxgcxy       | jjx      | glxy     | clx    | jxgcx      | hlx    | flx    | wyx    | ysx    |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let type = ctx.req.param('type') || 'all';\r\n    if (!Object.keys(maps).includes(type)) {\r\n        type = 'all';\r\n    }\r\n\r\n    const responseData = {\r\n        title: '北京科技大学天津学院新闻动态',\r\n        link: baseUrl,\r\n        item: null,\r\n    };\r\n\r\n    if (type === 'all') {\r\n        const all = await Promise.all(\r\n            Object.values(maps).map(async (link) => {\r\n                const response = await got(baseUrl + link);\r\n                const news = getNews(response.data);\r\n                return news;\r\n            })\r\n        );\r\n        responseData.item = all.flat();\r\n    } else {\r\n        const response = await got(baseUrl + maps[type]);\r\n        const news = getNews(response.data);\r\n        responseData.item = news;\r\n    }\r\n\r\n    return responseData;\r\n}\r\n"],"mappings":"sWAMA,MAAM,EAAU,wBACV,EAAO,CACT,KAAM,wBACN,MAAO,yBACP,OAAQ,0BACR,OAAQ,0BACR,IAAK,uBACL,KAAM,wBACN,IAAK,uBACL,MAAO,yBACP,IAAK,uBACL,IAAK,uBACL,IAAK,uBACL,IAAK,wBAGT,SAAS,EAAQ,EAAM,CACnB,IAAM,EAAI,EAAK,GACf,OAAO,EAAE,kCACJ,UACA,IAAK,IAAU,CACZ,KAAM,EAAU,EAAK,QAAQ,KAC7B,MAAO,EAAK,SAAS,GAAG,KACxB,QAAS,EAAS,EAAU,EAAK,QAAQ,KAAK,MAAM,KAAK,GAAG,MAAM,KAAK,GAAG,MAAM,EAAG,IAAK,kBAAmB,MAIvH,MAAaA,EAAe,CACxB,KAAM,kBACN,WAAY,CAAC,cACb,QAAS,oBACT,WAAY,CAAE,KAAM,aACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,SACd,UACA,YAAa;;+IAKjB,eAAe,EAAQ,EAAK,CACxB,IAAI,EAAO,EAAI,IAAI,MAAM,SAAW,MAC/B,OAAO,KAAK,GAAM,SAAS,KAC5B,EAAO,OAGX,IAAM,EAAe,CACjB,MAAO,iBACP,KAAM,EACN,KAAM,MAGV,GAAI,IAAS,MAAO,CAChB,IAAM,EAAM,MAAM,QAAQ,IACtB,OAAO,OAAO,GAAM,IAAI,KAAO,IAAS,CACpC,IAAM,EAAW,MAAMC,EAAI,EAAU,GAC/B,EAAO,EAAQ,EAAS,MAC9B,OAAO,KAGf,EAAa,KAAO,EAAI,WACrB,CACH,IAAM,EAAW,MAAMA,EAAI,EAAU,EAAK,IACpC,EAAO,EAAQ,EAAS,MAC9B,EAAa,KAAO,EAGxB,OAAO"}