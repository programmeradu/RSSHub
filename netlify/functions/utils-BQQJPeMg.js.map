{"version":3,"file":"utils-BQQJPeMg.js","names":[],"sources":["../../lib/routes/utgd/utils.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport MarkdownIt from 'markdown-it';\r\nconst md = MarkdownIt({\r\n    html: true,\r\n});\r\n\r\nexport const rootUrl = 'https://utgd.net';\r\nexport const apiRootUrl = 'https://api.utgd.net';\r\n\r\nexport const parseResult = (results, limit) =>\r\n    results.slice(0, limit).map((item) => ({\r\n        id: item.id,\r\n        title: item.title,\r\n        link: `${rootUrl}/article/${item.id}`,\r\n        author: item.article_author_displayname,\r\n        pubDate: timezone(parseDate(item.article_published_time), +8),\r\n        category: item.article_category.map((c) => c.category_name),\r\n    }));\r\n\r\nexport const parseArticle = (item) =>\r\n    cache.tryGet(`untag-${item.id}`, async () => {\r\n        const data = await ofetch(`${apiRootUrl}/api/v2/article/${item.id}/`);\r\n\r\n        item.description = art(path.join(__dirname, 'templates/description.art'), {\r\n            membership: data.article_for_membership,\r\n            image: data.article_image,\r\n            description: md.render(data.article_content),\r\n        });\r\n\r\n        item.category = [...data.article_category.map((c) => c.category_name), ...data.article_tag.map((t) => t.tag_name)];\r\n\r\n        return item;\r\n    });\r\n"],"mappings":"4XAOA,MAAM,EAAK,EAAW,CAClB,KAAM,KAGG,EAAU,mBACV,EAAa,uBAEb,GAAe,EAAS,IACjC,EAAQ,MAAM,EAAG,GAAO,IAAK,IAAU,CACnC,GAAI,EAAK,GACT,MAAO,EAAK,MACZ,KAAM,GAAG,EAAQ,WAAW,EAAK,KACjC,OAAQ,EAAK,2BACb,QAAS,EAAS,EAAU,EAAK,wBAAyB,GAC1D,SAAU,EAAK,iBAAiB,IAAK,GAAM,EAAE,kBAGxC,EAAgB,GACzB,EAAM,OAAO,SAAS,EAAK,KAAM,SAAY,CACzC,IAAM,EAAO,MAAM,EAAO,GAAG,EAAW,kBAAkB,EAAK,GAAG,IAUlE,MARA,GAAK,YAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACtE,WAAY,EAAK,uBACjB,MAAO,EAAK,cACZ,YAAa,EAAG,OAAO,EAAK,mBAGhC,EAAK,SAAW,CAAC,GAAG,EAAK,iBAAiB,IAAK,GAAM,EAAE,eAAgB,GAAG,EAAK,YAAY,IAAK,GAAM,EAAE,WAEjG"}