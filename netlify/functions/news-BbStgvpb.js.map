{"version":3,"file":"news-BbStgvpb.js","names":["route: Route","InvalidParameterError","got","cache","response"],"sources":["../../lib/routes/gov/suzhou/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: '/suzhou/news/:uid',\r\n    categories: ['government'],\r\n    example: '/gov/suzhou/news/news',\r\n    parameters: { uid: '栏目名' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.suzhou.gov.cn/szsrmzf/:uid/nav_list.shtml'],\r\n        },\r\n    ],\r\n    name: '政府新闻',\r\n    maintainers: ['EsuRt', 'luyuhuang'],\r\n    handler,\r\n    description: `| 新闻栏目名 |       :uid       |\r\n| :--------: | :--------------: |\r\n|  苏州要闻  |   news 或 szyw   |\r\n|  区县快讯  | district 或 qxkx |\r\n|  部门动态  |       bmdt       |\r\n|  新闻视频  |       xwsp       |\r\n|  政务公告  |       zwgg       |\r\n|  便民公告  |       mszx       |\r\n|  民生资讯  |       bmzx       |\r\n\r\n| 热点专题栏目名 |  :uid  |\r\n| :------------: | :----: |\r\n|    热点专题    |  rdzt  |\r\n|   市本级专题   |  sbjzt |\r\n|  最新热点专题  | zxrdzt |\r\n|    往期专题    |  wqzt  |\r\n|    区县专题    |  qxzt  |\r\n\r\n::: tip\r\n  **热点专题**栏目包含**市本级专题**和**区县专题**\r\n\r\n  **市本级专题**栏目包含**最新热点专题**和**往期专题**\r\n\r\n  如需订阅完整的热点专题，仅需订阅 **热点专题**\\`rdzt\\` 一项即可。\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const rootUrl = 'https://www.suzhou.gov.cn';\r\n    const uid = ctx.req.param('uid');\r\n    let url = '';\r\n    let title = '';\r\n    let apiUrl = '';\r\n    let items = [];\r\n    switch (uid) {\r\n        case 'szyw':\r\n        case 'news':\r\n            apiUrl = `${rootUrl}/szinf/info/getInfoCommon/?pagesize=15&currpage=1&channelid=5057aeffb1a84a7e8aeded87728da48c`;\r\n            url = `${rootUrl}/szsrmzf/szyw/nav_list.shtml`;\r\n            title = '苏州市政府 - 苏州要闻';\r\n            break;\r\n        case 'qxkx':\r\n        case 'district':\r\n            apiUrl = `${rootUrl}/szinf/info/getInfoCommon/?pagesize=15&currpage=1&channelid=75c636ea0efb487ea7e479e3cc0ff3e5`;\r\n            url = `${rootUrl}/szsrmzf/qxkx/nav_list.shtml`;\r\n            title = '苏州市政府 - 区县快讯';\r\n            break;\r\n        case 'bmdt':\r\n            apiUrl = `${rootUrl}/szinf/info/getInfoCommon/?pagesize=15&currpage=1&channelid=b3d097e3eb79421f88439ea381ce33c3`;\r\n            url = `${rootUrl}/szsrmzf/bmdt/nav_list.shtml`;\r\n            title = '苏州市政府 - 部门动态';\r\n            break;\r\n        case 'xwsp':\r\n            apiUrl = `${rootUrl}/szinf/info/getInfoCommon/?pagesize=15&currpage=1&channelid=507980d214c943ebb0a70853ec94b12e`;\r\n            url = `${rootUrl}/szsrmzf/xwsp/nav_list.shtml`;\r\n            title = '苏州市政府 - 新闻视频';\r\n            break;\r\n        case 'rdzt':\r\n            url = `${rootUrl}/szsrmzf/rdzt/nav_list.shtml`;\r\n            title = '苏州市政府 - 热点专题';\r\n            break;\r\n        case 'sbjzt':\r\n            url = `${rootUrl}/szsrmzf/sbjzt/nav_list.shtml`;\r\n            title = '苏州市政府 - 市本级专题';\r\n            break;\r\n        case 'zxrdzt':\r\n            url = `${rootUrl}/szsrmzf/zxrdzt/nav_list.shtml`;\r\n            title = '苏州市政府 - 最新热点专题';\r\n            break;\r\n        case 'wqzt':\r\n            url = `${rootUrl}/szsrmzf/wqzt/nav_list.shtml`;\r\n            title = '苏州市政府 - 往期专题';\r\n            break;\r\n        case 'qxzt':\r\n            url = `${rootUrl}/szsrmzf/qxzt/nav_list.shtml`;\r\n            title = '苏州市政府 - 区县专题';\r\n            break;\r\n        case 'zwgg':\r\n            apiUrl = `${rootUrl}/szinf/info/getInfoCommon/?pagesize=15&currpage=1&channelid=260915178a1f4c4fac44c4bf6378c9b0`;\r\n            url = `${rootUrl}/szsrmzf/zwgg/nav_list.shtml`;\r\n            title = '苏州市政府 - 政务公告';\r\n            break;\r\n        case 'mszx':\r\n            apiUrl = `${rootUrl}/szinf/info/getInfoCommon/?pagesize=15&currpage=1&channelid=dc60acecb0be46b89d42272dcb8bd32b`;\r\n            url = `${rootUrl}/szsrmzf/mszx/nav_list.shtml`;\r\n            title = '苏州市政府 - 便民公告';\r\n            break;\r\n        case 'bmzx':\r\n            apiUrl = `${rootUrl}/szinf/info/getInfoCommon/?pagesize=15&currpage=1&channelid=b015bfa5e5514cc9a26cd9f956ef8e69`;\r\n            url = `${rootUrl}/szsrmzf/bmzx/bmzx_list.shtml`;\r\n            title = '苏州市政府 - 民生资讯';\r\n            break;\r\n        default:\r\n            throw new InvalidParameterError('pattern not matched');\r\n    }\r\n    if (apiUrl) {\r\n        const response = await got(apiUrl);\r\n        const infoList = response.data.infolist.map((item) => ({\r\n            title: item.title,\r\n            link: item.link.startsWith('http') ? item.link : new URL(item.link, rootUrl).href,\r\n            pubDate: timezone(parseDate(item.pubtime, 'YYYY-MM-DD HH:mm:ss'), 8),\r\n        }));\r\n\r\n        items = await Promise.all(\r\n            infoList.map((item) =>\r\n                // 获取全文\r\n                cache.tryGet(item.link, async () => {\r\n                    const response = await got(item.link);\r\n                    const $ = load(response.data);\r\n                    item.description = $('ucapcontent').html();\r\n\r\n                    return item;\r\n                })\r\n            )\r\n        );\r\n    } else {\r\n        const response = await got(url);\r\n\r\n        const $ = load(response.data);\r\n        items = $('ul.infolist li')\r\n            .toArray()\r\n            .map((item) => {\r\n                item = $(item);\r\n                const a = item.find('a');\r\n                return {\r\n                    title: a.attr('title'),\r\n                    link: new URL(a.attr('href'), rootUrl).href,\r\n                    pubDate: timezone(parseDate(item.find('.time').text(), 'YYYY-MM-DD'), 8),\r\n                };\r\n            });\r\n    }\r\n\r\n    return {\r\n        title,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"seAQA,MAAaA,EAAe,CACxB,KAAM,oBACN,WAAY,CAAC,cACb,QAAS,wBACT,WAAY,CAAE,IAAK,OACnB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,mDAGjB,KAAM,OACN,YAAa,CAAC,QAAS,aACvB,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;MA2BjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,4BACV,EAAM,EAAI,IAAI,MAAM,OACtB,EAAM,GACN,EAAQ,GACR,EAAS,GACT,EAAQ,GACZ,OAAQ,EAAR,CACI,IAAK,OACL,IAAK,OACD,EAAS,GAAG,EAAQ,8FACpB,EAAM,GAAG,EAAQ,8BACjB,EAAQ,eACR,MACJ,IAAK,OACL,IAAK,WACD,EAAS,GAAG,EAAQ,8FACpB,EAAM,GAAG,EAAQ,8BACjB,EAAQ,eACR,MACJ,IAAK,OACD,EAAS,GAAG,EAAQ,8FACpB,EAAM,GAAG,EAAQ,8BACjB,EAAQ,eACR,MACJ,IAAK,OACD,EAAS,GAAG,EAAQ,8FACpB,EAAM,GAAG,EAAQ,8BACjB,EAAQ,eACR,MACJ,IAAK,OACD,EAAM,GAAG,EAAQ,8BACjB,EAAQ,eACR,MACJ,IAAK,QACD,EAAM,GAAG,EAAQ,+BACjB,EAAQ,gBACR,MACJ,IAAK,SACD,EAAM,GAAG,EAAQ,gCACjB,EAAQ,iBACR,MACJ,IAAK,OACD,EAAM,GAAG,EAAQ,8BACjB,EAAQ,eACR,MACJ,IAAK,OACD,EAAM,GAAG,EAAQ,8BACjB,EAAQ,eACR,MACJ,IAAK,OACD,EAAS,GAAG,EAAQ,8FACpB,EAAM,GAAG,EAAQ,8BACjB,EAAQ,eACR,MACJ,IAAK,OACD,EAAS,GAAG,EAAQ,8FACpB,EAAM,GAAG,EAAQ,8BACjB,EAAQ,eACR,MACJ,IAAK,OACD,EAAS,GAAG,EAAQ,8FACpB,EAAM,GAAG,EAAQ,+BACjB,EAAQ,eACR,MACJ,QACI,MAAM,IAAIC,EAAsB,uBAExC,GAAI,EAAQ,CACR,IAAM,EAAW,MAAMC,EAAI,GACrB,EAAW,EAAS,KAAK,SAAS,IAAK,IAAU,CACnD,MAAO,EAAK,MACZ,KAAM,EAAK,KAAK,WAAW,QAAU,EAAK,KAAO,IAAI,IAAI,EAAK,KAAM,GAAS,KAC7E,QAAS,EAAS,EAAU,EAAK,QAAS,uBAAwB,MAGtE,EAAQ,MAAM,QAAQ,IAClB,EAAS,IAAK,GAEVC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAW,MAAMF,EAAI,EAAK,MAC1B,EAAI,EAAKE,EAAS,MAGxB,MAFA,GAAK,YAAc,EAAE,eAAe,OAE7B,UAIhB,CACH,IAAM,EAAW,MAAMF,EAAI,GAErB,EAAI,EAAK,EAAS,MACxB,EAAQ,EAAE,kBACL,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAI,EAAK,KAAK,KACpB,MAAO,CACH,MAAO,EAAE,KAAK,SACd,KAAM,IAAI,IAAI,EAAE,KAAK,QAAS,GAAS,KACvC,QAAS,EAAS,EAAU,EAAK,KAAK,SAAS,OAAQ,cAAe,MAKtF,MAAO,CACH,QACA,KAAM,EACN,KAAM"}