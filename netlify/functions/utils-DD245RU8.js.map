{"version":3,"file":"utils-DD245RU8.js","names":["ofetch"],"sources":["../../lib/routes/misskon/utils.ts"],"sourcesContent":["import ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst ENDPOINT = 'https://misskon.com/wp-json/wp/v2';\r\nconst getPosts = async (searchParams) => {\r\n    const url = new URL(`${ENDPOINT}/posts?${searchParams}`);\r\n    url.searchParams.append('_embed', 'wp:term');\r\n    const data = await ofetch(url.href);\r\n    return data.map((item) => {\r\n        const $ = load(item.content.rendered);\r\n        $('input').each(function () {\r\n            $(this).replaceWith($(this).attr('value') || '');\r\n        });\r\n        $('script').remove();\r\n        return {\r\n            title: item.title.rendered,\r\n            link: item.link,\r\n            description: $.html(),\r\n            pubDate: timezone(parseDate(item.date_gmt), 0),\r\n            category: item._embedded['wp:term']\r\n                .flat()\r\n                .filter((x) => x.taxonomy === 'post_tag')\r\n                .map((x) => x.name),\r\n        };\r\n    });\r\n};\r\nconst getTags = async (slug) => {\r\n    const data = await ofetch(`${ENDPOINT}/tags?slug=${slug}`);\r\n    if (data.length === 0) {\r\n        throw new Error(`Invalid tag slug: ${slug}`);\r\n    }\r\n    return {\r\n        id: data[0].id,\r\n        name: data[0].name,\r\n        link: data[0].link,\r\n        description: data[0].description,\r\n    };\r\n};\r\nexport { ENDPOINT, getPosts, getTags };\r\n"],"mappings":"4LAKA,MAAM,EAAW,oCACX,EAAW,KAAO,IAAiB,CACrC,IAAM,EAAM,IAAI,IAAI,GAAG,EAAS,SAAS,KACzC,EAAI,aAAa,OAAO,SAAU,WAClC,IAAM,EAAO,MAAMA,EAAO,EAAI,MAC9B,OAAO,EAAK,IAAK,GAAS,CACtB,IAAM,EAAI,EAAK,EAAK,QAAQ,UAK5B,OAJA,EAAE,SAAS,KAAK,UAAY,CACxB,EAAE,MAAM,YAAY,EAAE,MAAM,KAAK,UAAY,MAEjD,EAAE,UAAU,SACL,CACH,MAAO,EAAK,MAAM,SAClB,KAAM,EAAK,KACX,YAAa,EAAE,OACf,QAAS,EAAS,EAAU,EAAK,UAAW,GAC5C,SAAU,EAAK,UAAU,WACpB,OACA,OAAQ,GAAM,EAAE,WAAa,YAC7B,IAAK,GAAM,EAAE,UAIxB,EAAU,KAAO,IAAS,CAC5B,IAAM,EAAO,MAAMA,EAAO,GAAG,EAAS,aAAa,KACnD,GAAI,EAAK,SAAW,EAChB,MAAU,MAAM,qBAAqB,KAEzC,MAAO,CACH,GAAI,EAAK,GAAG,GACZ,KAAM,EAAK,GAAG,KACd,KAAM,EAAK,GAAG,KACd,YAAa,EAAK,GAAG"}