{"version":3,"file":"utils-C8Xh1HW4.js","names":["cache","got"],"sources":["../../lib/routes/line/utils.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport logger from '@/utils/logger';\r\nimport cache from '@/utils/cache';\r\nconst baseUrl = 'https://today.line.me';\r\n\r\nconst parseList = (items) =>\r\n    items.map((item) => ({\r\n        title: item.title,\r\n        link: item.url.url,\r\n        pubDate: parseDate(item.publishTimeUnix),\r\n        hash: item.url.hash,\r\n        category: item.categoryName,\r\n    }));\r\n\r\nconst parseItems = (list) =>\r\n    Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const edition = item.link.match(/today\\.line\\.me\\/(\\w+?)\\/v[23]\\/.*$/)[1];\r\n                let data;\r\n                try {\r\n                    const response = await got(`${baseUrl}/webapi/portal/page/setting/article`, {\r\n                        searchParams: {\r\n                            country: edition,\r\n                            hash: item.hash,\r\n                            group: 'NA',\r\n                        },\r\n                    });\r\n                    data = response.data;\r\n                } catch (error) {\r\n                    if ((error.name === 'HTTPError' || error.name === 'FetchError') && error.response.statusCode === 404) {\r\n                        logger.error(`Error parsing article ${item.link}: ${error.message}`);\r\n                        return item;\r\n                    }\r\n                    throw error;\r\n                }\r\n\r\n                const $ = load(data.data.content, null, false);\r\n\r\n                $('img').each((_, img) => {\r\n                    delete img.attribs['data-hashid'];\r\n                    img.attribs.src = img.attribs.src.replace(/\\/w\\d+$/, '');\r\n                });\r\n\r\n                item.description = $.html();\r\n                item.author = data.data.author;\r\n                item.category = [...new Set([item.category, ...data.data.exploreLinks.map((link) => link.name)])];\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\nexport { baseUrl, parseList, parseItems };\r\n"],"mappings":"8OAKA,MAAM,EAAU,wBAEV,EAAa,GACf,EAAM,IAAK,IAAU,CACjB,MAAO,EAAK,MACZ,KAAM,EAAK,IAAI,IACf,QAAS,EAAU,EAAK,iBACxB,KAAM,EAAK,IAAI,KACf,SAAU,EAAK,gBAGjB,EAAc,GAChB,QAAQ,IACJ,EAAK,IAAK,GACNA,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAU,EAAK,KAAK,MAAM,uCAAuC,GACnE,EACJ,GAAI,CACA,IAAM,EAAW,MAAMC,EAAI,GAAG,EAAQ,qCAAsC,CACxE,aAAc,CACV,QAAS,EACT,KAAM,EAAK,KACX,MAAO,QAGf,EAAO,EAAS,WACX,EAAO,CACZ,IAAK,EAAM,OAAS,aAAe,EAAM,OAAS,eAAiB,EAAM,SAAS,aAAe,IAE7F,OADA,EAAO,MAAM,yBAAyB,EAAK,KAAK,IAAI,EAAM,WACnD,EAEX,MAAM,EAGV,IAAM,EAAI,EAAK,EAAK,KAAK,QAAS,KAAM,IAWxC,OATA,EAAE,OAAO,MAAM,EAAG,IAAQ,CACtB,OAAO,EAAI,QAAQ,eACnB,EAAI,QAAQ,IAAM,EAAI,QAAQ,IAAI,QAAQ,UAAW,MAGzD,EAAK,YAAc,EAAE,OACrB,EAAK,OAAS,EAAK,KAAK,OACxB,EAAK,SAAW,CAAC,GAAG,IAAI,IAAI,CAAC,EAAK,SAAU,GAAG,EAAK,KAAK,aAAa,IAAK,GAAS,EAAK,SAElF"}