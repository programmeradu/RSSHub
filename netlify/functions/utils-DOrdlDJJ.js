import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i,parseRelativeDate as a}from"./parse-date-Bgabdhlb.js";import{got_default as o}from"./got-CdvI2yKX.js";import s from"node:path";import{load as c}from"cheerio";t();const l=e=>({title:e.name,link:e.link,description:e.name,pubDate:i(e.pubTimeLong),media:{content:{url:e.pic}}});var u={ProcessItem:(t,u)=>{let d=u.req.query(`old`)===`yes`;if(t.link)return l(t);let f=`https://m.thepaper.cn/${t.cornerLabelDesc&&t.cornerLabelDesc===`短剧`?`series`:`detail`}/${t.contId}`;return n.tryGet(`${f}${d?`:old`:``}`,async()=>{let n=await o(f),u=JSON.parse(c(n.data)(`#__NEXT_DATA__`).html()),p=u.props.pageProps.detailData,m=p.contentDetail||p.liveDetail||p.specialDetail?.specialInfo;if(!m)return l(t);let h=m.content||m.summary||m.desc||``;m.videos&&(h+=m.summary),d&&(m.videos&&(h=r(s.join(e,`templates/video_detail-ab6bcdcc.art`),{videos:m.videos})+h),m.images&&(h=r(s.join(e,`templates/image_detail-c25cfec8.art`),{images:m.images})+h));let g=i(t.pubTimeLong||m.publishTime);Number.isNaN(g)&&(g=a(m.pubTime));let _={title:m.name||m.shareName,link:f,description:h,category:[...m.tagList?.map(e=>e.tag)??[],m?.nodeInfo?.name??[]],pubDate:g,author:m.author||``,media:{content:{url:t.pic||m.videos?.coverUrl||m.bigPic},thumbnails:{url:t.sharePic||m.sharePic}}};return m.voiceInfo?.isHaveVoice&&(_.enclosure_type=`audio/mpeg`,_.enclosure_url=m.voiceInfo.voiceSrc,_.itunes_item_image=t.pic||m.videos?.coverUrl),_})},ChannelIdToName:(e,t)=>t.props.appProps.menu.channelList.find(t=>t.nodeId.toString()===e.toString()).name,ListIdToName:(e,t)=>t.props.appProps.menu.channelList.flatMap(e=>e.childNodeList||[]).find(t=>t.nodeId.toString()===e.toString())?.name,ExtractLogo:e=>`https://m.thepaper.cn`+c(e.data)(`img.imageCover`).attr(`src`)};export{u as utils_default};
//# sourceMappingURL=utils-DOrdlDJJ.js.map