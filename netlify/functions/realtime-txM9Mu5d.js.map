{"version":3,"file":"realtime-txM9Mu5d.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/ebc/realtime.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/realtime/:category?',\r\n    categories: ['traditional-media'],\r\n    example: '/ebc/realtime/politics',\r\n    parameters: {\r\n        category: 'Category from the last segment of the URL of the corresponding site',\r\n    },\r\n    features: {\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        requireConfig: false,\r\n    },\r\n    name: '即時新聞',\r\n    maintainers: ['quiniapiezoelectricity'],\r\n    handler,\r\n    description: '',\r\n    radar: [\r\n        {\r\n            source: ['news.ebc.net.tw/realtime/:category'],\r\n            target: '/:category',\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? '';\r\n    const response = await got('https://news.ebc.net.tw/list/load', {\r\n        method: 'POST',\r\n        headers: {\r\n            Accept: '*/*',\r\n            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n            'X-Requested-With': 'XMLHttpRequest',\r\n        },\r\n        body: new URLSearchParams({\r\n            list_type: 'realtime',\r\n            cate_code: category,\r\n            page: '1',\r\n        }).toString(),\r\n    });\r\n    const $ = load(response.data);\r\n    const feed = $('div.list > a')\r\n        .toArray()\r\n        .map((item) => new URL($(item).attr('href') ?? '', 'https://news.ebc.net.tw').href);\r\n    const items = await Promise.all(\r\n        feed.map((url) =>\r\n            cache.tryGet(url, async () => {\r\n                const response = await got(url);\r\n                const $ = load(response.data);\r\n                const metadata = $('[type=\"application/ld+json\"]')\r\n                    .toArray()\r\n                    .flatMap((item) => JSON.parse($(item).text()))\r\n                    .find((item) => item['@type'] === 'NewsArticle');\r\n                // handle image box\r\n                $('.img_box').each((_, elem) => {\r\n                    $(elem)\r\n                        .children('div.img_caption')\r\n                        .replaceWith($(`<figcaption>${$(elem).children('div.img_caption').text()}</figcaption>`));\r\n                    $(elem).children('div.img').children().unwrap();\r\n                    $(elem).wrapInner($('<figure></figure>'));\r\n                });\r\n                // handle small text\r\n                $('[style=\"font-size:16px;\"]').each((_, elem) => {\r\n                    $(elem).replaceWith(`<small>${$(elem).text()}</small>`);\r\n                });\r\n                const cover = $('div.article_cover');\r\n                const content = $('div.article_content');\r\n                content.find('.inline_text, .inline_box, .rss_box').remove();\r\n                return {\r\n                    title: metadata.headline,\r\n                    link: url,\r\n                    pubDate: parseDate(metadata.datePublished),\r\n                    author: metadata.author.name,\r\n                    description: cover.html() + content.html(),\r\n                    category: metadata.keywords ? [metadata.articleSection, ...metadata.keywords.split(',')] : [metadata.articleSection],\r\n                };\r\n            })\r\n        )\r\n    );\r\n    return {\r\n        title: '東森新聞|即時',\r\n        link: category ? `https://news.ebc.net.tw/realtime/${category}` : 'https://news.ebc.net.tw/realtime',\r\n        language: 'zh-TW',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,qBACb,QAAS,yBACT,WAAY,CACR,SAAU,uEAEd,SAAU,CACN,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,0BACd,UACA,YAAa,GACb,MAAO,CACH,CACI,OAAQ,CAAC,sCACT,OAAQ,gBAKpB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,GACxC,EAAW,MAAMC,EAAI,oCAAqC,CAC5D,OAAQ,OACR,QAAS,CACL,OAAQ,MACR,eAAgB,mDAChB,mBAAoB,kBAExB,KAAM,IAAI,gBAAgB,CACtB,UAAW,WACX,UAAW,EACX,KAAM,MACP,aAED,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,gBACV,UACA,IAAK,GAAS,IAAI,IAAI,EAAE,GAAM,KAAK,SAAW,GAAI,2BAA2B,MAC5E,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,SAAY,CAC1B,IAAMC,EAAW,MAAMF,EAAI,GACrBG,EAAI,EAAKD,EAAS,MAClB,EAAWC,EAAE,gCACd,UACA,QAAS,GAAS,KAAK,MAAMA,EAAE,GAAM,SACrC,KAAM,GAAS,EAAK,WAAa,eAEtC,EAAE,YAAY,MAAM,EAAG,IAAS,CAC5B,EAAE,GACG,SAAS,mBACT,YAAYA,EAAE,eAAeA,EAAE,GAAM,SAAS,mBAAmB,OAAO,iBAC7E,EAAE,GAAM,SAAS,WAAW,WAAW,SACvC,EAAE,GAAM,UAAUA,EAAE,wBAGxB,EAAE,6BAA6B,MAAM,EAAG,IAAS,CAC7C,EAAE,GAAM,YAAY,UAAUA,EAAE,GAAM,OAAO,aAEjD,IAAM,EAAQA,EAAE,qBACV,EAAUA,EAAE,uBAElB,OADA,EAAQ,KAAK,uCAAuC,SAC7C,CACH,MAAO,EAAS,SAChB,KAAM,EACN,QAAS,EAAU,EAAS,eAC5B,OAAQ,EAAS,OAAO,KACxB,YAAa,EAAM,OAAS,EAAQ,OACpC,SAAU,EAAS,SAAW,CAAC,EAAS,eAAgB,GAAG,EAAS,SAAS,MAAM,MAAQ,CAAC,EAAS,qBAKrH,MAAO,CACH,MAAO,UACP,KAAM,EAAW,oCAAoC,IAAa,mCAClE,SAAU,QACV,KAAM"}