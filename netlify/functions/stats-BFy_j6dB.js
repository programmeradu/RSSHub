import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import{getSubPath as a}from"./common-utils-CvkwbCD5.js";import{ofetch_default as o}from"./ofetch-Bzt0BXUH.js";import{timezone as s}from"./timezone-BrNu6iXe.js";import c from"node:path";import{load as l}from"cheerio";t();const u={path:`/stats/*`,name:`国家统计局 通用`,url:`www.stats.gov.cn`,categories:[`government`],maintainers:[`bigfei`,`nczitzk`,`reply2future`],example:`/gov/stats/sj/zxfb`,handler:d,radar:[{title:`国家统计局 通用`,source:[`www.stats.gov.cn/*path`],target:`/gov/stats/*path`}],description:"::: tip\n路径处填写对应页面 URL 中 `http://www.stats.gov.cn/` 后的字段。下面是一个例子。\n\n若订阅 [数据 > 数据解读](http://www.stats.gov.cn/sj/sjjd/)\n则将对应页面 URL `http://www.stats.gov.cn/sj/sjjd/` 中 `http://www.stats.gov.cn/` 后的字段 `sj/sjjd` 作为路径填入。\n此时路由为 [`/gov/stats/sj/sjjd`](https://rsshub.app/gov/stats/sj/sjjd)\n\n若订阅 [新闻 > 时政要闻 > 中央精神](http://www.stats.gov.cn/xw/szyw/zyjs/)\n则将对应页面 URL `http://www.stats.gov.cn/xw/szyw/zyjs/` 中 `http://www.stats.gov.cn/`\n后的字段 `xw/szyw/zyjs` 作为路径填入。此时路由为 [`/gov/stats/xw/szyw/zyjs`](https://rsshub.app/gov/stats/xw/szyw/zyjs)\n:::"};async function d(t){let u=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):15,d=`http://www.stats.gov.cn`,{headers:f}=await o.raw(d),p=f?.getSetCookie().find(e=>e.startsWith(`wzws_sessionid=`))?.split(`;`)[0],m=a(t)===`/stats`?`/sj/zxfb/`:a(t).replace(/^\/stats(.*)/,`$1`),h=`${d}${m.endsWith(`/`)?m:m+`/`}`,g=await o(h,{headers:{Cookie:p,Referer:h}}),_=l(g),v=_(_(`a.pchide`).length===0?`a[title]`:`.list-content a.pchide`).slice(0,u).toArray().map(e=>(e=_(e),{title:e.attr(`title`),link:new URL(e.attr(`href`),h).href}));return v=await Promise.all(v.map(t=>n.tryGet(t.link,async()=>{let n=await o(t.link,{headers:{Cookie:p,Referer:d}}),a=l(n);if(/(news\.cn|www\.gov\.cn)/.test(t.link)){if(a(`.year`).text())t.pubDate=s(i(`${a(`.year`).text()}/${a(`.day`).text()} ${a(`.time`).text()}`,`YYYY/MM/DD HH:mm:ss`),8),t.author=a(`.source`).text().replace(/来源：/,``).trim();else{a(`.pages_print`).remove();let e=a(`.info, .pages-date`).text().split(`来源：`);t.pubDate=s(i(e[0].trim()),8),t.author=e.pop()}return t.title=t.title||a(`h1`).first().text()||a(`h2`).first().text(),t.description=a(`#detail, .xlcontent, .pages_content`).html(),t}return t.author=n.match(/来源：(.*?)</)?.[1]?.trim(),a(`.pchide`).remove(),t.title=t.title||a(`div.detail-title h1`).text(),t.pubDate=s(i(a(`div.detail-title-des h2 p, .info`).first().text().trim()),8),t.description=r(c.join(e,`templates/description-243c875b.art`),{description:a(`.TRS_Editor`).html()||a(`.TRS_UEDITOR`).html(),attachments:a(`a[oldsrc]`).toArray().map(e=>(e=_(e),{link:new URL(e.attr(`href`),t.link).href,name:e.text().trim()}))}),t}))),{title:_(`title`).text(),link:h,item:v}}export{u as route};
//# sourceMappingURL=stats-BFy_j6dB.js.map