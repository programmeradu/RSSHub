{"version":3,"file":"essay-Sd1gj9od.js","names":["route: Route","got"],"sources":["../../lib/routes/kunchengblog/essay.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { SourceMapConsumer } from 'source-map';\r\n\r\nexport const route: Route = {\r\n    path: '/essay',\r\n    categories: ['blog'],\r\n    example: '/kunchengblog/essay',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['kunchengblog.com/essay'],\r\n        },\r\n    ],\r\n    name: 'Essay',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    url: 'kunchengblog.com/essay',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 100;\r\n\r\n    const rootUrl = 'https://www.kunchengblog.com';\r\n    const currentUrl = new URL('essay', rootUrl).href;\r\n\r\n    const { data: currentResponse } = await got(currentUrl);\r\n\r\n    const $ = load(currentResponse);\r\n\r\n    const title = $('title').text();\r\n\r\n    const mapUrl = new URL(`${$('script').first().prop('src')}.map`, rootUrl).href;\r\n\r\n    const { data: response } = await got(mapUrl);\r\n\r\n    const items = await SourceMapConsumer.with(response, null, (consumer) =>\r\n        consumer.sources\r\n            .filter((s) => /routes\\/essays/.test(s))\r\n            .toReversed()\r\n            .slice(0, limit)\r\n            .map((item) => {\r\n                const source = consumer.sourceContentFor(item).replaceAll(/\\s\\n/g, '');\r\n\r\n                const processedSource = source.replaceAll(/(\\w+)={+([^{}]+)}+/g, (match, key, value) => {\r\n                    const processedValue = value.slice(1, -1).replaceAll('\"', \"'\").trim();\r\n                    return `${key}=\"${processedValue}\"`;\r\n                });\r\n\r\n                const content = load(processedSource);\r\n\r\n                return {\r\n                    title: content('title').text(),\r\n                    pubDate: parseDate(content('p[className=\"App-essay-article\"]').last().find('b').first().text(), 'MMM YYYY'),\r\n                    link: new URL(`essay/${item.match(/\\/(\\w+)\\.js/)[1].toLowerCase()}`, currentUrl).href,\r\n                    description: content('p[className=\"App-essay-article\"]')\r\n                        .toArray()\r\n                        .map((p) => content(p).html())\r\n                        .join(''),\r\n                    author: title,\r\n                };\r\n            })\r\n    );\r\n\r\n    const description = $('meta[name=\"description\"]').prop('content');\r\n    const icon = new URL($('link[rel=\"icon\"]').prop('href'), rootUrl).href;\r\n\r\n    return {\r\n        item: items,\r\n        title: `${title} - Essay`,\r\n        link: currentUrl,\r\n        description,\r\n        language: $('html').prop('lang'),\r\n        image: icon,\r\n        icon,\r\n        logo: icon,\r\n        subtitle: description,\r\n        author: title,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"mWAMA,MAAaA,EAAe,CACxB,KAAM,SACN,WAAY,CAAC,QACb,QAAS,sBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,4BAGjB,KAAM,QACN,YAAa,CAAC,WACd,UACA,IAAK,0BAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,IAE/E,EAAU,+BACV,EAAa,IAAI,IAAI,QAAS,GAAS,KAEvC,CAAE,KAAM,GAAoB,MAAMC,EAAI,GAEtC,EAAI,EAAK,GAET,EAAQ,EAAE,SAAS,OAEnB,EAAS,IAAI,IAAI,GAAG,EAAE,UAAU,QAAQ,KAAK,OAAO,MAAO,GAAS,KAEpE,CAAE,KAAM,GAAa,MAAMA,EAAI,GAE/B,EAAQ,MAAM,EAAkB,KAAK,EAAU,KAAO,GACxD,EAAS,QACJ,OAAQ,GAAM,iBAAiB,KAAK,IACpC,aACA,MAAM,EAAG,GACT,IAAK,GAAS,CACX,IAAM,EAAS,EAAS,iBAAiB,GAAM,WAAW,QAAS,IAE7D,EAAkB,EAAO,WAAW,uBAAwB,EAAO,EAAK,IAAU,CACpF,IAAM,EAAiB,EAAM,MAAM,EAAG,IAAI,WAAW,IAAK,KAAK,OAC/D,MAAO,GAAG,EAAI,IAAI,EAAe,KAG/B,EAAU,EAAK,GAErB,MAAO,CACH,MAAO,EAAQ,SAAS,OACxB,QAAS,EAAU,EAAQ,oCAAoC,OAAO,KAAK,KAAK,QAAQ,OAAQ,YAChG,KAAM,IAAI,IAAI,SAAS,EAAK,MAAM,eAAe,GAAG,gBAAiB,GAAY,KACjF,YAAa,EAAQ,oCAChB,UACA,IAAK,GAAM,EAAQ,GAAG,QACtB,KAAK,IACV,OAAQ,MAKlB,EAAc,EAAE,4BAA4B,KAAK,WACjD,EAAO,IAAI,IAAI,EAAE,oBAAoB,KAAK,QAAS,GAAS,KAElE,MAAO,CACH,KAAM,EACN,MAAO,GAAG,EAAM,UAChB,KAAM,EACN,cACA,SAAU,EAAE,QAAQ,KAAK,QACzB,MAAO,EACP,OACA,KAAM,EACN,SAAU,EACV,OAAQ,EACR,WAAY"}