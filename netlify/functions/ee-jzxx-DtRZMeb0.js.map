{"version":3,"file":"ee-jzxx-DtRZMeb0.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/xjtu/ee-jzxx.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/ee/jzxx/:category?',\r\n    categories: ['university'],\r\n    example: '/xjtu/ee/jzxx/bks',\r\n    parameters: {\r\n        category: '类别：`bks`，默认为首页，详情在描述中',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['ee.xjtu.edu.cn/jzxx/:category?.htm'],\r\n        },\r\n    ],\r\n    name: '电气学院通知',\r\n    maintainers: ['riverflows2333'],\r\n    handler,\r\n    description: `栏目类型\r\n\r\n| 主页 | 本科生 | 研究生 | 科研学术 | 采购招标 | 招聘就业 | 行政办公\r\n| --- | ----- | ----- | ------ | ------- | ------ | ------\r\n|  -  |  bks  |  yjs  |  kyxs  |   cgzb  |  zpjy  | xzbg  `,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? ''; // 默认是首页\r\n    const baseUrl = 'https://ee.xjtu.edu.cn';\r\n\r\n    const rootUrl = ['bks', 'yjs', 'kyxs', 'cgzb', 'zpjy', 'xzbg'].includes(category) ? `${baseUrl}/jzxx/${category}.htm` : `${baseUrl}/jzxx.htm`;\r\n\r\n    const response = await got(rootUrl);\r\n    const $ = load(response.data);\r\n\r\n    const list = $('.list .wow.fadeInUp')\r\n        .toArray()\r\n        .map((element) => {\r\n            const item = $(element);\r\n            const a = item.find('a');\r\n            const title = a.text();\r\n            const href = a.attr('href');\r\n            if (!href) {\r\n                return null; // 过滤无效链接\r\n            }\r\n\r\n            return {\r\n                title,\r\n                link: new URL(href, baseUrl).href,\r\n            };\r\n        })\r\n        .filter((item): item is { title: string; link: string } => item !== null);\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const res = await got(item.link);\r\n                const content = load(res.data);\r\n\r\n                const infoDiv = content('div.art-tit.cont-tit');\r\n                const dateText = infoDiv.find('p span:nth-child(1)').text().replace('发布时间：', '');\r\n                const pubDate = timezone(parseDate(dateText), +8);\r\n\r\n                const description = content('div.art-body.wow.fadeInUp')\r\n                    .clone() // 创建副本防止修改原始内容\r\n                    .find('ul li') // 定位到附件列表项\r\n                    .each(function () {\r\n                        const $li = $(this);\r\n                        const newText = $li.html()?.replace(/已下载[\\s\\S]*?<\\/span>次/g, '') ?? '';\r\n                        $li.html(newText.replace(/<\\/a>\\s*$/, '</a>'));\r\n                    })\r\n                    .end()\r\n                    .html();\r\n\r\n                return {\r\n                    title: content('div.art-tit.cont-tit').find('h3').text(),\r\n                    pubDate,\r\n                    link: item.link,\r\n                    guid: item.link,\r\n                    description,\r\n                };\r\n            })\r\n        )\r\n    );\r\n    const categoryMap = {\r\n        bks: '本科生',\r\n        yjs: '研究生',\r\n        kyxs: '科研学术',\r\n        cgzb: '采购招标',\r\n        zpjy: '招聘就业',\r\n        xzbg: '行政办公',\r\n    };\r\n\r\n    return {\r\n        title: `西安交通大学电气学院通知 - ${categoryMap[category] || '通知首页'}`, // 使用对象查找配合默认值\r\n        link: rootUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAaA,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,cACb,QAAS,oBACT,WAAY,CACR,SAAU,yBAEd,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,wCAGjB,KAAM,SACN,YAAa,CAAC,kBACd,UACA,YAAa;;;;6DAOjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,GACxC,EAAU,yBAEV,EAAU,CAAC,MAAO,MAAO,OAAQ,OAAQ,OAAQ,QAAQ,SAAS,GAAY,GAAG,EAAQ,QAAQ,EAAS,MAAQ,GAAG,EAAQ,WAE7H,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,uBACV,UACA,IAAK,GAAY,CACd,IAAM,EAAO,EAAE,GACT,EAAI,EAAK,KAAK,KACd,EAAQ,EAAE,OACV,EAAO,EAAE,KAAK,QAKpB,OAJK,EAIE,CACH,QACA,KAAM,IAAI,IAAI,EAAM,GAAS,MALtB,OAQd,OAAQ,GAAkD,IAAS,MAElE,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAM,MAAMD,EAAI,EAAK,MACrB,EAAU,EAAK,EAAI,MAEnB,EAAU,EAAQ,wBAClB,EAAW,EAAQ,KAAK,uBAAuB,OAAO,QAAQ,QAAS,IACvE,EAAU,EAAS,EAAU,GAAW,GAExC,EAAc,EAAQ,6BACvB,QACA,KAAK,SACL,KAAK,UAAY,CACd,IAAM,EAAM,EAAE,MACR,EAAU,EAAI,QAAQ,QAAQ,wBAAyB,KAAO,GACpE,EAAI,KAAK,EAAQ,QAAQ,YAAa,WAEzC,MACA,OAEL,MAAO,CACH,MAAO,EAAQ,wBAAwB,KAAK,MAAM,OAClD,UACA,KAAM,EAAK,KACX,KAAM,EAAK,KACX,mBAKV,EAAc,CAChB,IAAK,MACL,IAAK,MACL,KAAM,OACN,KAAM,OACN,KAAM,OACN,KAAM,QAGV,MAAO,CACH,MAAO,kBAAkB,EAAY,IAAa,SAClD,KAAM,EACN,KAAM"}