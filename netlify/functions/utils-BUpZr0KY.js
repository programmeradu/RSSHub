import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{ofetch_default as n}from"./ofetch-Bzt0BXUH.js";import r from"node:crypto";import*as i from"cheerio";const a=e=>Uint8Array.from(Buffer.from(e,`base64`)),o=e=>Buffer.from(e,`base64`).toString(`hex`),s=(e,t)=>{let n=r.createHash(`sha256`);return n.update(e),n.update(t),n.digest(`hex`)},c=e=>{let t=JSON.parse(Buffer.from(e,`base64`).toString()),n=a(t.v.a),r=o(t.v.c);for(let e=0;e<1e6;e++){let i=s(n,e.toString());if(i===r){t.d=Buffer.from(e.toString()).toString(`base64`);break}}return Buffer.from(JSON.stringify(t)).toString(`base64`)},l=async e=>{let t=await n(e),r=i.load(t);if(r(`script`).text().includes(`_wafchallengeid`)){let a=r(`script:contains("_wafchallengeid")`).text().match(/cs="(.*?)",c/)?.[1],o=c(a);t=await n(e,{headers:{cookie:`_wafchallengeid=${o};`}}),r=i.load(t)}return r(`.article-viewer`).html()},u=e=>e.map(e=>{let n=!!e.article_info;return{title:n?e.article_info.title:e.content_info.title,description:(n?e.article_info.brief_content:e.content_info.brief)||`无描述`,pubDate:t(n?e.article_info.ctime:e.content_info.ctime,`X`),author:e.author_user_info.user_name,link:`https://juejin.cn${n?`/post/${e.article_id}`:`/news/${e.content_id}`}`,category:[...new Set([e.category.category_name,...e.tags.map(e=>e.tag_name)])]}}),d=t=>Promise.all(t.map(t=>e.tryGet(t.link,async()=>(t.description=await l(t.link)||t.description,t)))),f=()=>e.tryGet(`juejin:categoryBriefs`,async()=>{let e=await n(`https://api.juejin.cn/tag_api/v1/query_category_briefs`);return e.data}),p=t=>e.tryGet(`juejin:collectionId:${t}`,async()=>{let e=await n(`https://api.juejin.cn/interact_api/v1/collectionSet/get`,{query:{tag_id:t,cursor:0}});return e.data}),m=t=>e.tryGet(`juejin:tag:${t}`,async()=>{let e=await n(`https://api.juejin.cn/tag_api/v1/query_tag_detail`,{method:`POST`,body:{key_word:t}});return e.data});export{d as ProcessFeed,f as getCategoryBrief,p as getCollection,m as getTag,u as parseList};
//# sourceMappingURL=utils-BUpZr0KY.js.map