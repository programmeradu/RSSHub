{"version":3,"file":"download-DCJuTYoW.js","names":["route: Route","got"],"sources":["../../lib/routes/ifi-audio/download.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nconst host = 'https://ifi-audio.com';\r\n\r\nexport const route: Route = {\r\n    path: '/download/:val/:id',\r\n    categories: ['program-update'],\r\n    example: '/ifi-audio/download/1503007035/44472',\r\n    parameters: { val: 'product val', id: 'product id' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Download Hub',\r\n    maintainers: ['EthanWng97'],\r\n    handler,\r\n    description: `::: warning\r\n1.  Open [https://ifi-audio.com/download-hub](https://ifi-audio.com/download-hub) and the Network panel\r\n2.  Select the device and the corresponding serial number in the website and click Search\r\n3.  Find the last request named \\`https://ifi-audio.com/wp-admin/admin-ajax.php\\` in the Network panel, find out the val and id in the Payload panel, and fill in the url\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { val, id } = ctx.req.param();\r\n\r\n    const url = host + '/wp-admin/admin-ajax.php';\r\n    const response = await got({\r\n        method: 'post',\r\n        url,\r\n        headers: {\r\n            'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n        },\r\n        body: 'action=ifi-ff-get-firmware&val=' + val + '&id=' + id,\r\n    });\r\n    const markup = response.data.data.markup;\r\n    const $ = load(markup);\r\n    const latestTitle = $('li[data-category=firmware]:first h4').text();\r\n    const latestDownloadLink = $('li[data-category=firmware]:first a').attr('href');\r\n    return {\r\n        title: 'iFi audio Download Hub',\r\n        link: 'https://ifi-audio.com/download-hub/',\r\n        description: 'iFi audio Download Hub',\r\n        item: [\r\n            {\r\n                title: latestTitle,\r\n                description: markup,\r\n                link: latestDownloadLink,\r\n            },\r\n        ],\r\n    };\r\n}\r\n"],"mappings":"+PAIA,MAEaA,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,kBACb,QAAS,uCACT,WAAY,CAAE,IAAK,cAAe,GAAI,cACtC,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,eACN,YAAa,CAAC,cACd,UACA,YAAa;;;;MAOjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,MAAK,MAAO,EAAI,IAAI,QAGtB,EAAW,MAAMC,EAAI,CACvB,OAAQ,OACR,oDACA,QAAS,CACL,eAAgB,oDAEpB,KAAM,kCAAoC,EAAM,OAAS,IAEvD,EAAS,EAAS,KAAK,KAAK,OAC5B,EAAI,EAAK,GACT,EAAc,EAAE,uCAAuC,OACvD,EAAqB,EAAE,sCAAsC,KAAK,QACxE,MAAO,CACH,MAAO,yBACP,KAAM,sCACN,YAAa,yBACb,KAAM,CACF,CACI,MAAO,EACP,YAAa,EACb,KAAM"}