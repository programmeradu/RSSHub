{"version":3,"file":"report-D60BAI3W.js","names":["route: Route","industryMap: Record<number, string>","got"],"sources":["../../lib/routes/moodysmismicrosite/report.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport { parseRelativeDate } from '@/utils/parse-date';\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/report/:industry?',\r\n    categories: ['finance'],\r\n    view: ViewType.Articles,\r\n    example: '/moodysmismicrosite/report/企业&金融机构',\r\n    parameters: {\r\n        industry: {\r\n            description: '可选参数，默认为全部行业。行业选择，支持使用&连接多个。',\r\n            options: [\r\n                { value: '0', label: '企业' },\r\n                { value: '1', label: '金融机构' },\r\n                { value: '2', label: '主权' },\r\n                { value: '3', label: '地方政府及城投公司' },\r\n                { value: '4', label: '宏观经济' },\r\n                { value: '5', label: '结构融资' },\r\n                { value: '6', label: '基础设施及项目融资' },\r\n                { value: '7', label: 'ESG' },\r\n                { value: '8', label: '其他' },\r\n            ],\r\n            default: '全部',\r\n        },\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.moodysmismicrosite.com/report'],\r\n        },\r\n    ],\r\n    name: 'industry',\r\n    description: `\r\n| ID | Description |\r\n| ---   | ---   |\r\n| 0 | 企业 |\r\n| 1 | 金融机构 |\r\n| 2 | 主权 |\r\n| 3 | 地方政府及城投公司 |\r\n| 4 | 宏观经济 |\r\n| 5 | 结构融资 |\r\n| 6 | 基础设施项目融资 |\r\n| 7 | ESG |\r\n| 8 | 其他 |\r\n    `,\r\n    maintainers: ['Cedaric'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const industryMap: Record<number, string> = {\r\n        0: '企业',\r\n        1: '金融机构',\r\n        2: '主权',\r\n        3: '地方政府及城投公司',\r\n        4: '宏观经济',\r\n        5: '结构融资',\r\n        6: '基础设施项目融资',\r\n        7: 'ESG',\r\n        8: '其他',\r\n    };\r\n\r\n    const reversedIndustry = Object.fromEntries(Object.entries(industryMap).map(([k, v]) => [v, k]));\r\n\r\n    const industry = ctx.req.param('industry') || '行业';\r\n\r\n    const industryId = industry\r\n        .split('&')\r\n        .map((name) => reversedIndustry[name.trim()])\r\n        .filter((key) => key !== undefined)\r\n        .join(',');\r\n\r\n    const responseData = await got(`https://www.moodysmismicrosite.com/micro/v2/report/list?page_num=1&page_size=25&keyword=&industry_ids=${industryId}`);\r\n\r\n    const items = responseData?.data?.data?.list || [];\r\n\r\n    return {\r\n        title: `穆迪评级(${industry})`,\r\n        link: 'https://www.moodysmismicrosite.com/report',\r\n        allowEmpty: true,\r\n        item: items.map((x) => ({\r\n            title: x.title,\r\n            pubDate: parseRelativeDate(x.release_time),\r\n            link: `https://www.moodysmismicrosite.com/details/${x.id}`,\r\n            description: x.content_profile,\r\n            category: x.classification,\r\n            guid: x.id,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"4UAIA,MAAaA,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,WACb,KAAM,EAAS,SACf,QAAS,qCACT,WAAY,CACR,SAAU,CACN,YAAa,+BACb,QAAS,CACL,CAAE,MAAO,IAAK,MAAO,MACrB,CAAE,MAAO,IAAK,MAAO,QACrB,CAAE,MAAO,IAAK,MAAO,MACrB,CAAE,MAAO,IAAK,MAAO,aACrB,CAAE,MAAO,IAAK,MAAO,QACrB,CAAE,MAAO,IAAK,MAAO,QACrB,CAAE,MAAO,IAAK,MAAO,aACrB,CAAE,MAAO,IAAK,MAAO,OACrB,CAAE,MAAO,IAAK,MAAO,OAEzB,QAAS,OAGjB,MAAO,CACH,CACI,OAAQ,CAAC,uCAGjB,KAAM,WACN,YAAa;;;;;;;;;;;;MAab,YAAa,CAAC,WACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAMC,EAAsC,CACxC,EAAG,KACH,EAAG,OACH,EAAG,KACH,EAAG,YACH,EAAG,OACH,EAAG,OACH,EAAG,WACH,EAAG,MACH,EAAG,MAGD,EAAmB,OAAO,YAAY,OAAO,QAAQ,GAAa,KAAK,CAAC,EAAG,KAAO,CAAC,EAAG,KAEtF,EAAW,EAAI,IAAI,MAAM,aAAe,KAExC,EAAa,EACd,MAAM,KACN,IAAK,GAAS,EAAiB,EAAK,SACpC,OAAQ,GAAQ,IAAQ,IAAA,IACxB,KAAK,KAEJ,EAAe,MAAMC,EAAI,yGAAyG,KAElI,EAAQ,GAAc,MAAM,MAAM,MAAQ,GAEhD,MAAO,CACH,MAAO,QAAQ,EAAS,GACxB,KAAM,4CACN,WAAY,GACZ,KAAM,EAAM,IAAK,IAAO,CACpB,MAAO,EAAE,MACT,QAAS,EAAkB,EAAE,cAC7B,KAAM,8CAA8C,EAAE,KACtD,YAAa,EAAE,gBACf,SAAU,EAAE,eACZ,KAAM,EAAE"}