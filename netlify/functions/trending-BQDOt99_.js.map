{"version":3,"file":"trending-BQDOt99_.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/juejin/trending.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { getCategoryBrief, parseList, ProcessFeed } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/trending/:category/:type',\r\n    categories: ['programming'],\r\n    example: '/juejin/trending/ios/monthly',\r\n    parameters: {\r\n        category: {\r\n            description: '分类名',\r\n            options: [\r\n                {\r\n                    value: 'android',\r\n                    label: 'Android',\r\n                },\r\n                {\r\n                    value: 'frontend',\r\n                    label: '前端',\r\n                },\r\n                {\r\n                    value: 'ios',\r\n                    label: 'iOS',\r\n                },\r\n                {\r\n                    value: 'backend',\r\n                    label: '后端',\r\n                },\r\n                {\r\n                    value: 'design',\r\n                    label: '设计',\r\n                },\r\n                {\r\n                    value: 'product',\r\n                    label: '产品',\r\n                },\r\n                {\r\n                    value: 'freebie',\r\n                    label: '工具资源',\r\n                },\r\n                {\r\n                    value: 'article',\r\n                    label: '阅读',\r\n                },\r\n                {\r\n                    value: 'ai',\r\n                    label: '人工智能',\r\n                },\r\n                {\r\n                    value: 'devops',\r\n                    label: '运维',\r\n                },\r\n                {\r\n                    value: 'all',\r\n                    label: '全部',\r\n                },\r\n            ],\r\n            default: 'all',\r\n        },\r\n        type: {\r\n            description: '类型',\r\n            options: [\r\n                {\r\n                    value: 'weekly',\r\n                    label: '本周最热',\r\n                },\r\n                {\r\n                    value: 'monthly',\r\n                    label: '本月最热',\r\n                },\r\n                {\r\n                    value: 'historical',\r\n                    label: '历史最热',\r\n                },\r\n            ],\r\n            default: 'weekly',\r\n        },\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '热门',\r\n    maintainers: ['moaix'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category, type } = ctx.req.param();\r\n\r\n    let id = '';\r\n    let name = '';\r\n    let url = 'recommended';\r\n    const idResponse = await getCategoryBrief();\r\n    const cat = idResponse.find((item) => item.category_url === category);\r\n    if (cat) {\r\n        id = cat.category_id;\r\n        name = cat.category_name;\r\n        url = cat.category_url;\r\n    }\r\n\r\n    const params = {\r\n        monthly: {\r\n            period: 'month',\r\n            title: '本月',\r\n            link: 'monthly_hottest',\r\n            sort_type: 30,\r\n        },\r\n        weekly: {\r\n            period: 'week',\r\n            title: '本周',\r\n            link: 'weekly_hottest',\r\n            url: 'get_entry_by_period',\r\n            sort_type: 7,\r\n        },\r\n        historical: {\r\n            period: '',\r\n            title: '历史',\r\n            link: 'hottest',\r\n            sort_type: 0,\r\n        },\r\n    };\r\n\r\n    const p = params[type];\r\n\r\n    const title = `掘金${name}${p.title}最热`;\r\n    const link = `https://juejin.im/${url}?sort=${p.link}`;\r\n\r\n    let getUrl = 'https://api.juejin.cn/recommend_api/v1/article/recommend_all_feed';\r\n    const getJson = {\r\n        cursor: '0',\r\n        id_type: 2,\r\n        limit: 20,\r\n        sort_type: p.sort_type,\r\n    };\r\n\r\n    if (url !== 'recommended') {\r\n        getUrl = 'https://api.juejin.cn/recommend_api/v1/article/recommend_cate_feed';\r\n        getJson.cate_id = id;\r\n    }\r\n\r\n    const trendingResponse = await ofetch(getUrl, {\r\n        method: 'POST',\r\n        body: getJson,\r\n    });\r\n    let entrylist = trendingResponse.data;\r\n\r\n    if (category === 'all' || category === 'devops' || category === 'product' || category === 'design') {\r\n        entrylist = trendingResponse.data.filter((item) => item.item_type === 2).map((item) => item.item_info);\r\n    }\r\n    const list = parseList(entrylist);\r\n\r\n    const resultItems = await ProcessFeed(list);\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        item: resultItems,\r\n    };\r\n}\r\n"],"mappings":"+TAIA,MAAaA,EAAe,CACxB,KAAM,4BACN,WAAY,CAAC,eACb,QAAS,+BACT,WAAY,CACR,SAAU,CACN,YAAa,MACb,QAAS,CACL,CACI,MAAO,UACP,MAAO,WAEX,CACI,MAAO,WACP,MAAO,MAEX,CACI,MAAO,MACP,MAAO,OAEX,CACI,MAAO,UACP,MAAO,MAEX,CACI,MAAO,SACP,MAAO,MAEX,CACI,MAAO,UACP,MAAO,MAEX,CACI,MAAO,UACP,MAAO,QAEX,CACI,MAAO,UACP,MAAO,MAEX,CACI,MAAO,KACP,MAAO,QAEX,CACI,MAAO,SACP,MAAO,MAEX,CACI,MAAO,MACP,MAAO,OAGf,QAAS,OAEb,KAAM,CACF,YAAa,KACb,QAAS,CACL,CACI,MAAO,SACP,MAAO,QAEX,CACI,MAAO,UACP,MAAO,QAEX,CACI,MAAO,aACP,MAAO,SAGf,QAAS,WAGjB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,SACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAU,QAAS,EAAI,IAAI,QAE/B,EAAK,GACL,EAAO,GACP,EAAM,cACJ,EAAa,MAAM,IACnB,EAAM,EAAW,KAAM,GAAS,EAAK,eAAiB,GACxD,IACA,EAAK,EAAI,YACT,EAAO,EAAI,cACX,EAAM,EAAI,cAGd,IAAM,EAAS,CACX,QAAS,CACL,OAAQ,QACR,MAAO,KACP,KAAM,kBACN,UAAW,IAEf,OAAQ,CACJ,OAAQ,OACR,MAAO,KACP,KAAM,iBACN,IAAK,sBACL,UAAW,GAEf,WAAY,CACR,OAAQ,GACR,MAAO,KACP,KAAM,UACN,UAAW,IAIb,EAAI,EAAO,GAEX,EAAQ,KAAK,IAAO,EAAE,MAAM,IAC5B,EAAO,qBAAqB,EAAI,QAAQ,EAAE,OAE5C,EAAS,oEACP,EAAU,CACZ,OAAQ,IACR,QAAS,EACT,MAAO,GACP,UAAW,EAAE,WAGb,IAAQ,gBACR,EAAS,qEACT,EAAQ,QAAU,GAGtB,IAAM,EAAmB,MAAMC,EAAO,EAAQ,CAC1C,OAAQ,OACR,KAAM,IAEN,EAAY,EAAiB,MAE7B,IAAa,OAAS,IAAa,UAAY,IAAa,WAAa,IAAa,YACtF,EAAY,EAAiB,KAAK,OAAQ,GAAS,EAAK,YAAc,GAAG,IAAK,GAAS,EAAK,YAEhG,IAAM,EAAO,EAAU,GAEjB,EAAc,MAAM,EAAY,GAEtC,MAAO,CACH,QACA,OACA,KAAM"}