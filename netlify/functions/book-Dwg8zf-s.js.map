{"version":3,"file":"book-Dwg8zf-s.js","names":["route: Route","got"],"sources":["../../lib/routes/nytimes/book.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nconst categoryList = {\r\n    'combined-print-and-e-book-nonfiction': 'Combined Print & E-Book Nonfiction',\r\n    'hardcover-nonfiction': 'Hardcover Nonfiction',\r\n    'paperback-nonfiction': 'Paperback Nonfiction',\r\n    'advice-how-to-and-miscellaneous': 'Advice, How-To & Miscellaneous',\r\n    'combined-print-and-e-book-fiction': 'Combined Print & E-Book Fiction',\r\n    'hardcover-fiction': 'Hardcover Fiction',\r\n    'trade-fiction-paperback': 'Paperback Trade Fiction',\r\n    'childrens-middle-grade-hardcover': \"Children's Middle Grade Hardcover\",\r\n    'picture-books': 'Picture Books',\r\n    'series-books': 'Series Books',\r\n    'young-adult-hardcover': 'Young Adult Hardcover',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/book/:category?',\r\n    categories: ['traditional-media'],\r\n    view: ViewType.Notifications,\r\n    example: '/nytimes/book/combined-print-and-e-book-nonfiction',\r\n    parameters: {\r\n        category: {\r\n            description: 'Category, can be found on the [official page](https://www.nytimes.com/books/best-sellers/)',\r\n            options: Object.keys(categoryList).map((key) => ({\r\n                value: key,\r\n                label: categoryList[key],\r\n            })),\r\n            default: 'combined-print-and-e-book-nonfiction',\r\n        },\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['nytimes.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Best Seller Books',\r\n    maintainers: ['melvinto', 'pseudoyu'],\r\n    handler,\r\n    url: 'nytimes.com/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? 'combined-print-and-e-book-nonfiction';\r\n\r\n    const url = `https://www.nytimes.com/books/best-sellers/${category}`;\r\n\r\n    let items = [];\r\n    let dataTitle = '';\r\n    if (categoryList[category]) {\r\n        const response = await got({\r\n            method: 'get',\r\n            url,\r\n        });\r\n        const data = response.data;\r\n        const $ = load(data);\r\n        dataTitle = $('h1').eq(0).text();\r\n\r\n        items = $('article[itemprop=itemListElement]')\r\n            .toArray()\r\n            .map((elem, index) => {\r\n                const $item = $(elem);\r\n                const firstInfo = $item.find('p').eq(0).text();\r\n                const $name = $item.find('h3[itemprop=name]');\r\n                const author = $item.find('p[itemprop=author]').text();\r\n                const publisher = $item.find('p[itemprop=publisher]').text();\r\n                const description = $item.find('p[itemprop=description]').text();\r\n                const imageLink = $item.find('img[itemprop=image]').attr('src');\r\n                const $link = $item.find('ul[aria-label=\"Links to Book Retailers\"]');\r\n                const links = $link.find('a').toArray();\r\n\r\n                let primaryLink = links.length > 0 ? $(links[0]).attr('href') : '';\r\n\r\n                for (const link of links) {\r\n                    const l = $(link);\r\n                    if (l.text() === 'Amazon') {\r\n                        primaryLink = l.attr('href');\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                return {\r\n                    title: `${index + 1}: ${$name.text()}`,\r\n                    author,\r\n                    description: `<figure><img src=\"${imageLink}\" alt=\"test\"/><figcaption><span>${description}</span></figcaption></figure><br/>${firstInfo}<br/>Author: ${author}<br/>Publisher: ${publisher}`,\r\n                    link: primaryLink,\r\n                };\r\n            });\r\n    }\r\n\r\n    return {\r\n        title: `The New York Times Best Sellers - ${dataTitle}`,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"8SAIA,MAAM,EAAe,CACjB,uCAAwC,qCACxC,uBAAwB,uBACxB,uBAAwB,uBACxB,kCAAmC,iCACnC,oCAAqC,kCACrC,oBAAqB,oBACrB,0BAA2B,0BAC3B,mCAAoC,oCACpC,gBAAiB,gBACjB,eAAgB,eAChB,wBAAyB,yBAGhBA,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,qBACb,KAAM,EAAS,cACf,QAAS,qDACT,WAAY,CACR,SAAU,CACN,YAAa,6FACb,QAAS,OAAO,KAAK,GAAc,IAAK,IAAS,CAC7C,MAAO,EACP,MAAO,EAAa,MAExB,QAAS,yCAGjB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,gBACT,OAAQ,KAGhB,KAAM,oBACN,YAAa,CAAC,WAAY,YAC1B,UACA,IAAK,gBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,uCAExC,EAAM,8CAA8C,IAEtD,EAAQ,GACR,EAAY,GAChB,GAAI,EAAa,GAAW,CACxB,IAAM,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,QAEE,EAAO,EAAS,KAChB,EAAI,EAAK,GACf,EAAY,EAAE,MAAM,GAAG,GAAG,OAE1B,EAAQ,EAAE,qCACL,UACA,KAAK,EAAM,IAAU,CAClB,IAAM,EAAQ,EAAE,GACV,EAAY,EAAM,KAAK,KAAK,GAAG,GAAG,OAClC,EAAQ,EAAM,KAAK,qBACnB,EAAS,EAAM,KAAK,sBAAsB,OAC1C,EAAY,EAAM,KAAK,yBAAyB,OAChD,EAAc,EAAM,KAAK,2BAA2B,OACpD,EAAY,EAAM,KAAK,uBAAuB,KAAK,OACnD,EAAQ,EAAM,KAAK,4CACnB,EAAQ,EAAM,KAAK,KAAK,UAE1B,EAAc,EAAM,OAAS,EAAI,EAAE,EAAM,IAAI,KAAK,QAAU,GAEhE,IAAK,IAAM,KAAQ,EAAO,CACtB,IAAM,EAAI,EAAE,GACZ,GAAI,EAAE,SAAW,SAAU,CACvB,EAAc,EAAE,KAAK,QACrB,OAIR,MAAO,CACH,MAAO,GAAG,EAAQ,EAAE,IAAI,EAAM,SAC9B,SACA,YAAa,qBAAqB,EAAU,kCAAkC,EAAY,oCAAoC,EAAU,eAAe,EAAO,kBAAkB,IAChL,KAAM,KAKtB,MAAO,CACH,MAAO,qCAAqC,IAC5C,KAAM,EACN,KAAM"}