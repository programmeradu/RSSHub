{"version":3,"file":"releases-C8ThwUS4.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/tiddlywiki/releases.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/releases',\r\n    categories: ['program-update'],\r\n    example: '/tiddlywiki/releases',\r\n    url: 'tiddlywiki.com',\r\n    name: 'Releases',\r\n    maintainers: ['p3psi-boo'],\r\n    radar: [\r\n        {\r\n            source: ['github.com/TiddlyWiki/TiddlyWiki5'],\r\n            target: '/releases',\r\n        },\r\n        {\r\n            source: ['tiddlywiki.com'],\r\n            target: '/releases',\r\n        },\r\n    ],\r\n    handler,\r\n};\r\n\r\nasync function handler() {\r\n    const tagListUrl = 'https://github.com/TiddlyWiki/TiddlyWiki5/releases.atom';\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: tagListUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    const alist = $('entry');\r\n\r\n    const versionList = alist\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const text = item.find('title').text();\r\n            const date = item.find('updated').text();\r\n            // 使用正则提取 v5.3.6 格式\r\n            const version = text.match(/v\\d+\\.\\d+\\.\\d+/)?.[0];\r\n            return {\r\n                version,\r\n                pubDate: parseDate(date),\r\n            };\r\n        })\r\n        .filter((item) => item.version);\r\n\r\n    const items = await Promise.all(\r\n        versionList.map((item) => {\r\n            const _version = item.version.slice(1);\r\n            const url = `https://tiddlywiki.com/static/Release%2520${_version}.html`;\r\n            return cache.tryGet(url, async () => {\r\n                const response = await got({\r\n                    method: 'get',\r\n                    url,\r\n                });\r\n\r\n                const $ = load(response.data);\r\n\r\n                const description = $('.tc-tiddler-body').html();\r\n\r\n                return {\r\n                    title: item.version,\r\n                    link: url,\r\n                    pubDate: item.pubDate,\r\n                    description,\r\n                };\r\n            });\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: 'TiddlyWiki Releases',\r\n        link: 'https://tiddlywiki.com/static/Releases.html',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAOA,MAAaA,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,kBACb,QAAS,uBACT,IAAK,iBACL,KAAM,WACN,YAAa,CAAC,aACd,MAAO,CACH,CACI,OAAQ,CAAC,qCACT,OAAQ,aAEZ,CACI,OAAQ,CAAC,kBACT,OAAQ,cAGhB,WAGJ,eAAe,GAAU,CACrB,IAEM,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,4DAGH,EAAI,EAAK,EAAS,MAElB,EAAQ,EAAE,SAEV,EAAc,EACf,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAO,EAAK,KAAK,SAAS,OAC1B,EAAO,EAAK,KAAK,WAAW,OAE5B,EAAU,EAAK,MAAM,oBAAoB,GAC/C,MAAO,CACH,UACA,QAAS,EAAU,MAG1B,OAAQ,GAAS,EAAK,SAErB,EAAQ,MAAM,QAAQ,IACxB,EAAY,IAAK,GAAS,CACtB,IAAM,EAAW,EAAK,QAAQ,MAAM,GAC9B,EAAM,6CAA6C,EAAS,OAClE,OAAOC,EAAM,OAAO,EAAK,SAAY,CACjC,IAAMC,EAAW,MAAMF,EAAI,CACvB,OAAQ,MACR,QAGEG,EAAI,EAAKD,EAAS,MAElB,EAAcC,EAAE,oBAAoB,OAE1C,MAAO,CACH,MAAO,EAAK,QACZ,KAAM,EACN,QAAS,EAAK,QACd,oBAMhB,MAAO,CACH,MAAO,sBACP,KAAM,8CACN,KAAM"}