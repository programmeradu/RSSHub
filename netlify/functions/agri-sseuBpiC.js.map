{"version":3,"file":"agri-sseuBpiC.js","names":[],"sources":["../../lib/routes/agri/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = 'zx/zxfb/' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 10;\r\n\r\n    const rootUrl = 'http://www.agri.cn';\r\n    const currentUrl = new URL(category.endsWith('/') ? category : `${category}/`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('div.list_li_con, div.nxw_video_com')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('a').first();\r\n\r\n            const title = a.text();\r\n            const image = item.find('img').first().prop('src') ? new URL(item.find('img').first().prop('src'), rootUrl).href : undefined;\r\n            const description = art(path.join(__dirname, 'templates/description.art'), {\r\n                intro: item.find('p.con_text').text() || undefined,\r\n                images: image\r\n                    ? [\r\n                          {\r\n                              src: image,\r\n                              alt: title,\r\n                          },\r\n                      ]\r\n                    : undefined,\r\n            });\r\n\r\n            return {\r\n                title,\r\n                description,\r\n                pubDate: parseDate(item.find('span.con_date_span').text() || `${item.find('div.com_time_p2').text().trim()}${item.find('div.com_time_p1').text()}`, ['YYYY-MM-DD', 'YYYY.MM.DD']),\r\n                link: new URL(a.prop('href'), currentUrl).href,\r\n                content: {\r\n                    html: description,\r\n                    text: item.find('p.con_text').text() || undefined,\r\n                },\r\n                image,\r\n                banner: image,\r\n                language,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const title = $$('div.detailCon_info_tit').text().trim();\r\n                const description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    description: $$('div.content_body_box').html(),\r\n                });\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = timezone(parseDate($$('meta[name=\"publishdate\"]').prop('content')), +8);\r\n                item.author = $$('meta[name=\"author\"]').prop('content') || $$('meta[name=\"source\"]').prop('content');\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.content_body_box').text(),\r\n                };\r\n                item.language = language;\r\n\r\n                item.enclosure_url = $$('div.content_body_box video').prop('src') ?? undefined;\r\n                item.enclosure_type = item.enclosure_url ? 'video/mp4' : undefined;\r\n                item.enclosure_title = item.enclosure_url ? title : undefined;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('div.logo img').prop('src'), rootUrl).href;\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category{.+}?',\r\n    name: '分类',\r\n    url: 'www.agri.cn',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/agri/zx/zxfb',\r\n    parameters: { category: '分类，默认为 `zx/zxfb`，即最新发布，可在对应分类页 URL 中找到' },\r\n    description: `::: tip\r\n  若订阅 [最新发布](http://www.agri.cn/zx/zxfb/)，网址为 \\`http://www.agri.cn/zx/zxfb/\\`。截取 \\`https://www.agri.cn/\\` 到末尾的部分 \\`zx/zxfb\\` 作为参数填入，此时路由为 [\\`/agri/zx/zxfb\\`](https://rsshub.app/agri/zx/zxfb)。\r\n:::\r\n\r\n#### [机构](http://www.agri.cn/jg/)\r\n\r\n| 分类                                    | ID                                         |\r\n| --------------------------------------- | ------------------------------------------ |\r\n| [成果展示](http://www.agri.cn/jg/cgzs/) | [jg/cgzs](https://rsshub.app/agri/jg/cgzs) |\r\n\r\n#### [资讯](http://www.agri.cn/zx/)\r\n\r\n| 分类                                        | ID                                         |\r\n| ------------------------------------------- | ------------------------------------------ |\r\n| [最新发布](http://www.agri.cn/zx/zxfb/)     | [zx/zxfb](https://rsshub.app/agri/zx/zxfb) |\r\n| [农业要闻](http://www.agri.cn/zx/nyyw/)     | [zx/nyyw](https://rsshub.app/agri/zx/nyyw) |\r\n| [中心动态](http://www.agri.cn/zx/zxdt/)     | [zx/zxdt](https://rsshub.app/agri/zx/zxdt) |\r\n| [通知公告](http://www.agri.cn/zx/hxgg/)     | [zx/hxgg](https://rsshub.app/agri/zx/hxgg) |\r\n| [全国信息联播](http://www.agri.cn/zx/xxlb/) | [zx/xxlb](https://rsshub.app/agri/zx/xxlb) |\r\n\r\n#### [生产](http://www.agri.cn/sc/)\r\n\r\n| 分类                                    | ID                                         |\r\n| --------------------------------------- | ------------------------------------------ |\r\n| [生产动态](http://www.agri.cn/sc/scdt/) | [sc/scdt](https://rsshub.app/agri/sc/scdt) |\r\n| [农业品种](http://www.agri.cn/sc/nypz/) | [sc/nypz](https://rsshub.app/agri/sc/nypz) |\r\n| [农事指导](http://www.agri.cn/sc/nszd/) | [sc/nszd](https://rsshub.app/agri/sc/nszd) |\r\n| [农业气象](http://www.agri.cn/sc/nyqx/) | [sc/nyqx](https://rsshub.app/agri/sc/nyqx) |\r\n| [专项监测](http://www.agri.cn/sc/zxjc/) | [sc/zxjc](https://rsshub.app/agri/sc/zxjc) |\r\n\r\n#### [数据](http://www.agri.cn/sj/)\r\n\r\n| 分类                                    | ID                                         |\r\n| --------------------------------------- | ------------------------------------------ |\r\n| [市场动态](http://www.agri.cn/sj/scdt/) | [sj/scdt](https://rsshub.app/agri/sj/scdt) |\r\n| [供需形势](http://www.agri.cn/sj/gxxs/) | [sj/gxxs](https://rsshub.app/agri/sj/gxxs) |\r\n| [监测预警](http://www.agri.cn/sj/jcyj/) | [sj/jcyj](https://rsshub.app/agri/sj/jcyj) |\r\n\r\n#### [信息化](http://www.agri.cn/xxh/)\r\n\r\n| 分类                                           | ID                                               |\r\n| ---------------------------------------------- | ------------------------------------------------ |\r\n| [智慧农业](http://www.agri.cn/xxh/zhny/)       | [xxh/zhny](https://rsshub.app/agri/xxh/zhny)     |\r\n| [信息化标准](http://www.agri.cn/xxh/xxhbz/)    | [xxh/xxhbz](https://rsshub.app/agri/xxh/xxhbz)   |\r\n| [中国乡村资讯](http://www.agri.cn/xxh/zgxczx/) | [xxh/zgxczx](https://rsshub.app/agri/xxh/zgxczx) |\r\n\r\n#### [视频](http://www.agri.cn/video/)\r\n\r\n| 分类                                               | ID                                                               |\r\n| -------------------------------------------------- | ---------------------------------------------------------------- |\r\n| [新闻资讯](http://www.agri.cn/video/xwzx/nyxw/)    | [video/xwzx/nyxw](https://rsshub.app/agri/video/xwzx/nyxw)       |\r\n| [致富天地](http://www.agri.cn/video/zftd/)         | [video/zftd](https://rsshub.app/agri/video/zftd)                 |\r\n| [地方农业](http://www.agri.cn/video/dfny/beijing/) | [video/dfny/beijing](https://rsshub.app/agri/video/dfny/beijing) |\r\n| [气象农业](http://www.agri.cn/video/qxny/)         | [video/qxny](https://rsshub.app/agri/video/qxny)                 |\r\n| [讲座培训](http://www.agri.cn/video/jzpx/)         | [video/jzpx](https://rsshub.app/agri/video/jzpx)                 |\r\n| [文化生活](http://www.agri.cn/video/whsh/)         | [video/whsh](https://rsshub.app/agri/video/whsh)                 |\r\n  `,\r\n    categories: ['new-media'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.agri.cn/:category?'],\r\n            target: (params) => {\r\n                const category = params.category;\r\n\r\n                return category ? `/${category}` : '';\r\n            },\r\n        },\r\n        {\r\n            title: '机构 - 成果展示',\r\n            source: ['www.agri.cn/jg/cgzs/'],\r\n            target: '/jg/cgzs',\r\n        },\r\n        {\r\n            title: '资讯 - 最新发布',\r\n            source: ['www.agri.cn/zx/zxfb/'],\r\n            target: '/zx/zxfb',\r\n        },\r\n        {\r\n            title: '资讯 - 农业要闻',\r\n            source: ['www.agri.cn/zx/nyyw/'],\r\n            target: '/zx/nyyw',\r\n        },\r\n        {\r\n            title: '资讯 - 中心动态',\r\n            source: ['www.agri.cn/zx/zxdt/'],\r\n            target: '/zx/zxdt',\r\n        },\r\n        {\r\n            title: '资讯 - 通知公告',\r\n            source: ['www.agri.cn/zx/hxgg/'],\r\n            target: '/zx/hxgg',\r\n        },\r\n        {\r\n            title: '资讯 - 全国信息联播',\r\n            source: ['www.agri.cn/zx/xxlb/'],\r\n            target: '/zx/xxlb',\r\n        },\r\n        {\r\n            title: '生产 - 生产动态',\r\n            source: ['www.agri.cn/sc/scdt/'],\r\n            target: '/sc/scdt',\r\n        },\r\n        {\r\n            title: '生产 - 农业品种',\r\n            source: ['www.agri.cn/sc/nypz/'],\r\n            target: '/sc/nypz',\r\n        },\r\n        {\r\n            title: '生产 - 农事指导',\r\n            source: ['www.agri.cn/sc/nszd/'],\r\n            target: '/sc/nszd',\r\n        },\r\n        {\r\n            title: '生产 - 农业气象',\r\n            source: ['www.agri.cn/sc/nyqx/'],\r\n            target: '/sc/nyqx',\r\n        },\r\n        {\r\n            title: '生产 - 专项监测',\r\n            source: ['www.agri.cn/sc/zxjc/'],\r\n            target: '/sc/zxjc',\r\n        },\r\n        {\r\n            title: '数据 - 市场动态',\r\n            source: ['www.agri.cn/sj/scdt/'],\r\n            target: '/sj/scdt',\r\n        },\r\n        {\r\n            title: '数据 - 供需形势',\r\n            source: ['www.agri.cn/sj/gxxs/'],\r\n            target: '/sj/gxxs',\r\n        },\r\n        {\r\n            title: '数据 - 监测预警',\r\n            source: ['www.agri.cn/sj/jcyj/'],\r\n            target: '/sj/jcyj',\r\n        },\r\n        {\r\n            title: '信息化 - 智慧农业',\r\n            source: ['www.agri.cn/xxh/zhny/'],\r\n            target: '/xxh/zhny',\r\n        },\r\n        {\r\n            title: '信息化 - 信息化标准',\r\n            source: ['www.agri.cn/xxh/xxhbz/'],\r\n            target: '/xxh/xxhbz',\r\n        },\r\n        {\r\n            title: '信息化 - 中国乡村资讯',\r\n            source: ['www.agri.cn/xxh/zgxczx/'],\r\n            target: '/xxh/zgxczx',\r\n        },\r\n        {\r\n            title: '视频 - 新闻资讯',\r\n            source: ['www.agri.cn/video/xwzx/nyxw/'],\r\n            target: '/video/xwzx/nyxw',\r\n        },\r\n        {\r\n            title: '视频 - 致富天地',\r\n            source: ['www.agri.cn/video/zftd/'],\r\n            target: '/video/zftd',\r\n        },\r\n        {\r\n            title: '视频 - 地方农业',\r\n            source: ['www.agri.cn/video/dfny/beijing/'],\r\n            target: '/video/dfny/beijing',\r\n        },\r\n        {\r\n            title: '视频 - 气象农业',\r\n            source: ['www.agri.cn/video/qxny/'],\r\n            target: '/video/qxny',\r\n        },\r\n        {\r\n            title: '视频 - 讲座培训',\r\n            source: ['www.agri.cn/video/jzpx/'],\r\n            target: '/video/jzpx',\r\n        },\r\n        {\r\n            title: '视频 - 文化生活',\r\n            source: ['www.agri.cn/video/whsh/'],\r\n            target: '/video/whsh',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}