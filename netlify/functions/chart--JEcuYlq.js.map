{"version":3,"file":"chart--JEcuYlq.js","names":[],"sources":["../../lib/routes/openrice/chart.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nconst baseUrl = 'https://www.openrice.com';\r\n\r\nexport const route: Route = {\r\n    path: '/:lang/hongkong/explore/chart/:category',\r\n    maintainers: ['after9'],\r\n    handler,\r\n    categories: ['shopping'],\r\n    example: '/openrice/zh/hongkong/explore/chart/most-bookmarked',\r\n    parameters: { lang: '语言，缺省为 zh', category: '类别，缺省为 most-bookmarked' },\r\n    name: '香港餐廳排行榜',\r\n    description: `\r\n| 简体 | 繁體 | EN |\r\n| ----- | ------ | ----- |\r\n| zh-cn | zh | en |\r\n\r\n| 最多收藏 | 每周最高评分 | 最高浏览 | 最佳甜品餐厅 |\r\n| ----- | ------ | ----- | ----- |\r\n| most-bookmarked | best-rating | most-popular | best-dessert |\r\n  `,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const lang = ctx.req.param('lang') ?? 'zh';\r\n    const category = ctx.req.param('category') ?? 'most-bookmarked';\r\n\r\n    const urlPath: string = `/${lang}/hongkong/explore/chart/${category}`;\r\n    const response = await ofetch(baseUrl + urlPath);\r\n    const $ = load(response);\r\n\r\n    const title = $('title').text() ?? 'Hong Kong Restaurant Chart';\r\n    const description = $('title').text() ?? 'Hong Kong Restaurant Chart';\r\n\r\n    const data = $('.poi-chart-main-grid-item-desktop-wrapper');\r\n    const resultList = data.toArray().map((item) => {\r\n        const $item = $(item);\r\n        const rankClass = $item.find('.rank-icon').attr('class');\r\n        const rankNumber = rankClass?.match(/rank-(\\d+)/)?.[1] ?? '';\r\n        const desTags = $item.find('.pcmgidtr-left-section-poi-info-details .pcmgidtrls-poi-info-details-text');\r\n        const desTagsArray: string[] = desTags.toArray().map((tag) => $(tag).text());\r\n        const title = $item.find('.pcmgidtr-left-section-poi-info-name .link').text() ?? '';\r\n        const link = $item.find('.pcmgidtr-left-section-poi-info-name .link').attr('href') ?? '';\r\n        const coverImg = $item.find('.pcmgidtr-left-section-door-photo img').attr('src') ?? null;\r\n        const description = art(path.join(__dirname, 'templates/chart.art'), {\r\n            description: desTagsArray ?? [],\r\n            rankNumber,\r\n            image: coverImg,\r\n        });\r\n        return {\r\n            title,\r\n            description,\r\n            link,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title,\r\n        link: baseUrl + urlPath,\r\n        description,\r\n        item: resultList,\r\n    };\r\n}\r\n"],"mappings":"0TAKA,MAAM,EAAU,2BAEH,EAAe,CACxB,KAAM,0CACN,YAAa,CAAC,UACd,UACA,WAAY,CAAC,YACb,QAAS,sDACT,WAAY,CAAE,KAAM,YAAa,SAAU,0BAC3C,KAAM,UACN,YAAa;;;;;;;;KAWjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,KAChC,EAAW,EAAI,IAAI,MAAM,aAAe,kBAExC,EAAkB,IAAI,EAAK,0BAA0B,IACrD,EAAW,MAAM,EAAO,EAAU,GAClC,EAAI,EAAK,GAET,EAAQ,EAAE,SAAS,QAAU,6BAC7B,EAAc,EAAE,SAAS,QAAU,6BAEnC,EAAO,EAAE,6CACT,EAAa,EAAK,UAAU,IAAK,GAAS,CAC5C,IAAM,EAAQ,EAAE,GACV,EAAY,EAAM,KAAK,cAAc,KAAK,SAC1C,EAAa,GAAW,MAAM,gBAAgB,IAAM,GACpD,EAAU,EAAM,KAAK,6EACrB,EAAyB,EAAQ,UAAU,IAAK,GAAQ,EAAE,GAAK,QAC/D,EAAQ,EAAM,KAAK,8CAA8C,QAAU,GAC3E,EAAO,EAAM,KAAK,8CAA8C,KAAK,SAAW,GAChF,EAAW,EAAM,KAAK,yCAAyC,KAAK,QAAU,KAC9E,EAAc,EAAI,EAAA,KAAA,EAAA,gCAA6C,CACjE,YAAa,GAAgB,GAC7B,aACA,MAAO,IAEX,MAAO,CACH,MAAA,EACA,YAAA,EACA,UAIR,MAAO,CACH,QACA,KAAM,EAAU,EAChB,cACA,KAAM"}