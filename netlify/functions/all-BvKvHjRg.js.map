{"version":3,"file":"all-BvKvHjRg.js","names":["route: Route","got","cache","$"],"sources":["../../lib/routes/nwafu/utils.ts","../../lib/routes/nwafu/all.ts"],"sourcesContent":["const libValue = ['https://lib.nwafu.edu.cn/gg/', '.pageList ul li', 'li a', '.pageArticle', `西北农林科技大学图书馆通知公告`];\r\nconst youthValue = ['https://54youth.nwsuaf.edu.cn/twsy/tzgg//', 'section ul li', 'li a', 'article', `共青团西北农林科技大学委员会通知公告`];\r\nconst cieValue = ['https://cie.nwsuaf.edu.cn/dtytz/tzgg/', 'ul.list  li', 'li a', '.article', `西北农林科技大学信息工程学院通知公告`];\r\nconst gsValue = ['https://gs.nwsuaf.edu.cn/tzggB/', 'dl#sort ul.list  li', 'li a', '.content', `西北农林科技大学后勤管理处通知公告`];\r\nconst jccValue = ['https://jcc.nwsuaf.edu.cn/tzgg/', 'dl#sort ul.list  li', 'li a', '.content', `西北农林科技大学计划财务处通知公告`];\r\nconst jiaowuValue = ['https://jiaowu.nwsuaf.edu.cn/tzggB/', '.list-i ul li', 'li a', 'article', `西北农林科技大学教务通知公告`];\r\nconst newsValue = ['https://news.nwafu.edu.cn/yxxw/', 'ul.NWAFU-list01  li', 'li a', '.pageArticle', `西北农林科技大学新闻网聚焦院处`];\r\nconst nicValue = ['https://nic.nwsuaf.edu.cn/tzgg1/', 'dl#sort ul.list  li', 'li a', '.content', `西北农林科技大学信息化管理处通知公告`];\r\nconst yjshyValue = ['https://yjshy.nwafu.edu.cn/tzgg/', '.sort_rightcont ul  li', 'li a', '.cont', `西北农林科技大学研究生院通知公告`];\r\nconst nxyValue = ['https://nxy.nwafu.edu.cn/xytz/tzgg_xwzx/', 'div.sort_rightcont ul li', 'li a', 'div.sort_rightcont2', '西北农林科技大学农业科学院通知公告'];\r\nconst cmeeValue = ['https://cmee.nwafu.edu.cn/xwzx/xytz/', 'div.sort_rightcont ul li', 'li a', 'div.sort_rightcont2', '西北农林科技大学机械与电子工程学院通知公告'];\r\nconst xshdValue = ['https://www.nwafu.edu.cn/xshd/', 'ul.subArticleList li', 'li a', '.article', '西北农林科技大学学术活动'];\r\nconst smValue = ['https://sm.nwafu.edu.cn/tzgg/', 'ul.leading-12 li', 'li a', 'article', '西北农林科技大学生命科学学院通知公告'];\r\nconst forbiddenList = ['kjtg.nwafu.edu.cn', 'kjtg.nwsuaf.edu.cn', 'fwoa.nwafu.edu.cn', 'fwoa.nwsuaf.edu.cn', 'cg.nwafu.edu.cn', 'cg.nwsuaf.edu.cn'];\r\n\r\nconst nwafuMap = new Map([\r\n    ['lib', libValue],\r\n    ['youth', youthValue],\r\n    ['cie', cieValue],\r\n    ['gs', gsValue],\r\n    ['jcc', jccValue],\r\n    ['jiaowu', jiaowuValue],\r\n    ['news', newsValue],\r\n    ['nic', nicValue],\r\n    ['yjshy', yjshyValue],\r\n    ['nxy', nxyValue],\r\n    ['cmee', cmeeValue],\r\n    ['xshd', xshdValue],\r\n    ['sm', smValue],\r\n    ['forbiddenList', forbiddenList],\r\n]);\r\n\r\nexport { nwafuMap };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { nwafuMap } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/:type?',\r\n    categories: ['university'],\r\n    example: '/nwafu/lib',\r\n    parameters: { type: '默认为 `jiaowu`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '校园要闻',\r\n    maintainers: ['karinido'],\r\n    handler,\r\n    description: `通知类别\r\n\r\n| 图书馆 | 共青团团委 | 信工学院 | 后勤管理处 | 计划财务处 | 教务处 | 新闻网 | 信息化管理处 | 研究生院 | 农业科学院 | 机械与电子工程学院 | 学术活动 | 生命科学学院 |\r\n| ------ | ---------- | -------- | ---------- | ---------- | ------ | ------ | ------------ | -------- | ---------- | ------------------ | -------- | ------------ |\r\n| lib    | youth      | cie      | gs         | jcc        | jiaowu | news   | nic          | yjshy    | nxy        | cmee               | xshd     | sm           |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { type = 'jiaowu' } = ctx.req.param();\r\n    const response = await got.get(nwafuMap.get(type)[0]);\r\n    const $ = load(response.data);\r\n    const list = $(nwafuMap.get(type)[1])\r\n        .toArray()\r\n        .map((ele) => {\r\n            const itemTitle = $(ele).find(nwafuMap.get(type)[2]).text();\r\n            const itemPubDate = parseDate($(ele).find('span').text(), 'YYYY/MM/DD');\r\n            const itemLink = new URL($(ele).find(nwafuMap.get(type)[2]).attr('href'), nwafuMap.get(type)[0]).toString();\r\n            return {\r\n                title: itemTitle,\r\n                pubDate: itemPubDate,\r\n                link: itemLink,\r\n            };\r\n        });\r\n\r\n    const out = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                if (nwafuMap.get('forbiddenList').includes(new URL(item.link).hostname)) {\r\n                    return item;\r\n                }\r\n                const detailResponse = await got.get(item.link);\r\n                const $ = load(detailResponse.data);\r\n                item.description = $(nwafuMap.get(type)[3]).html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: nwafuMap.get(type)[4],\r\n        link: nwafuMap.get(type)[0],\r\n        description: nwafuMap.get(type)[4],\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"wWAAA,MAAM,EAAW,CAAC,+BAAgC,kBAAmB,OAAQ,eAAgB,mBACvF,EAAa,CAAC,4CAA6C,gBAAiB,OAAQ,UAAW,sBAC/F,EAAW,CAAC,wCAAyC,cAAe,OAAQ,WAAY,sBACxF,EAAU,CAAC,kCAAmC,sBAAuB,OAAQ,WAAY,qBACzF,EAAW,CAAC,kCAAmC,sBAAuB,OAAQ,WAAY,qBAC1F,EAAc,CAAC,sCAAuC,gBAAiB,OAAQ,UAAW,kBAC1F,EAAY,CAAC,kCAAmC,sBAAuB,OAAQ,eAAgB,mBAC/F,EAAW,CAAC,mCAAoC,sBAAuB,OAAQ,WAAY,sBAC3F,EAAa,CAAC,mCAAoC,yBAA0B,OAAQ,QAAS,oBAC7F,EAAW,CAAC,2CAA4C,2BAA4B,OAAQ,sBAAuB,qBACnH,EAAY,CAAC,uCAAwC,2BAA4B,OAAQ,sBAAuB,yBAChH,EAAY,CAAC,iCAAkC,uBAAwB,OAAQ,WAAY,gBAC3F,EAAU,CAAC,gCAAiC,mBAAoB,OAAQ,UAAW,sBACnF,EAAgB,CAAC,oBAAqB,qBAAsB,oBAAqB,qBAAsB,kBAAmB,oBAE1H,EAAW,IAAI,IAAI,CACrB,CAAC,MAAO,GACR,CAAC,QAAS,GACV,CAAC,MAAO,GACR,CAAC,KAAM,GACP,CAAC,MAAO,GACR,CAAC,SAAU,GACX,CAAC,OAAQ,GACT,CAAC,MAAO,GACR,CAAC,QAAS,GACV,CAAC,MAAO,GACR,CAAC,OAAQ,GACT,CAAC,OAAQ,GACT,CAAC,KAAM,GACP,CAAC,gBAAiB,KCtBTA,EAAe,CACxB,KAAM,UACN,WAAY,CAAC,cACb,QAAS,aACT,WAAY,CAAE,KAAM,gBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,YACd,UACA,YAAa;;;;uKAOjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAO,UAAa,EAAI,IAAI,QAC9B,EAAW,MAAMC,EAAI,IAAI,EAAS,IAAI,GAAM,IAC5C,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,EAAS,IAAI,GAAM,IAC7B,UACA,IAAK,GAAQ,CACV,IAAM,EAAY,EAAE,GAAK,KAAK,EAAS,IAAI,GAAM,IAAI,OAC/C,EAAc,EAAU,EAAE,GAAK,KAAK,QAAQ,OAAQ,cACpD,EAAW,IAAI,IAAI,EAAE,GAAK,KAAK,EAAS,IAAI,GAAM,IAAI,KAAK,QAAS,EAAS,IAAI,GAAM,IAAI,WACjG,MAAO,CACH,MAAO,EACP,QAAS,EACT,KAAM,KAIZ,EAAM,MAAM,QAAQ,IACtB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,EAAS,IAAI,iBAAiB,SAAS,IAAI,IAAI,EAAK,MAAM,UAC1D,OAAO,EAEX,IAAM,EAAiB,MAAMD,EAAI,IAAI,EAAK,MACpCE,EAAI,EAAK,EAAe,MAE9B,MADA,GAAK,YAAcA,EAAE,EAAS,IAAI,GAAM,IAAI,OACrC,MAKnB,MAAO,CACH,MAAO,EAAS,IAAI,GAAM,GAC1B,KAAM,EAAS,IAAI,GAAM,GACzB,YAAa,EAAS,IAAI,GAAM,GAChC,KAAM"}