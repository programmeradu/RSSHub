{"version":3,"file":"sputniknews-C13cSvhs.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/sputniknews/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst languages = {\r\n    english: 'https://sputniknews.com',\r\n    spanish: 'https://mundo.sputniknews.com',\r\n    german: 'https://snanews.de',\r\n    french: 'https://fr.sputniknews.com',\r\n    greek: 'https://sputniknews.gr',\r\n    italian: 'https://it.sputniknews.com',\r\n    czech: 'https://cz.sputniknews.com',\r\n    polish: 'https://pl.sputniknews.com',\r\n    serbian: 'https://rs.sputniknews.com',\r\n    latvian: 'https://sputniknewslv.com',\r\n    lithuanian: 'https://lt.sputniknews.com',\r\n    moldavian: 'https://md.sputniknews.com',\r\n    belarusian: 'https://bel.sputnik.by',\r\n    armenian: 'https://armeniasputnik.am',\r\n    abkhaz: 'https://sputnik-abkhazia.info',\r\n    ssetian: 'https://sputnik-ossetia.com',\r\n    georgian: 'https://sputnik-georgia.com',\r\n    azerbaijani: 'https://sputnik.az',\r\n    arabic: 'https://arabic.sputniknews.com',\r\n    turkish: 'https://tr.sputniknews.com',\r\n    persian: 'https://ir.sputniknews.com',\r\n    dari: 'https://af.sputniknews.com',\r\n    kazakh: 'https://sputniknews.kz',\r\n    kyrgyz: 'https://kg.sputniknews.com',\r\n    uzbek: 'https://oz.sputniknews-uz.com',\r\n    tajik: 'https://sputnik-tj.com',\r\n    vietnamese: 'https://vn.sputniknews.com',\r\n    japanese: 'https://jp.sputniknews.com',\r\n    chinese: 'http://sputniknews.cn',\r\n    portuguese: 'https://br.sputniknews.com',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category?/:language?',\r\n    categories: ['traditional-media'],\r\n    example: '/sputniknews',\r\n    parameters: { category: 'Category, can be found in URL, `news` by default', language: 'Language, see below, English by default' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Category',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `Categories for International site:\r\n\r\n| WORLD | COVID-19 | BUSINESS | SPORT | TECH | OPINION |\r\n| ----- | -------- | -------- | ----- | ---- | ------- |\r\n| world | covid-19 | business | sport | tech | opinion |\r\n\r\n  Categories for Chinese site:\r\n\r\n| 新闻 | 中国  | 俄罗斯 | 国际            | 俄中关系                 | 评论    |\r\n| ---- | ----- | ------ | --------------- | ------------------------ | ------- |\r\n| news | china | russia | category\\_guoji | russia\\_china\\_relations | opinion |\r\n\r\n  Language\r\n\r\n| Language    | Id          |\r\n| ----------- | ----------- |\r\n| English     | english     |\r\n| Spanish     | spanish     |\r\n| German      | german      |\r\n| French      | french      |\r\n| Greek       | greek       |\r\n| Italian     | italian     |\r\n| Czech       | czech       |\r\n| Polish      | polish      |\r\n| Serbian     | serbian     |\r\n| Latvian     | latvian     |\r\n| Lithuanian  | lithuanian  |\r\n| Moldavian   | moldavian   |\r\n| Belarusian  | belarusian  |\r\n| Armenian    | armenian    |\r\n| Abkhaz      | abkhaz      |\r\n| Ssetian     | ssetian     |\r\n| Georgian    | georgian    |\r\n| Azerbaijani | azerbaijani |\r\n| Arabic      | arabic      |\r\n| Turkish     | turkish     |\r\n| Persian     | persian     |\r\n| Dari        | dari        |\r\n| Kazakh      | kazakh      |\r\n| Kyrgyz      | kyrgyz      |\r\n| Uzbek       | uzbek       |\r\n| Tajik       | tajik       |\r\n| Vietnamese  | vietnamese  |\r\n| Japanese    | japanese    |\r\n| Chinese     | chinese     |\r\n| Portuguese  | portuguese  |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? 'news';\r\n    const language = ctx.req.param('language') ?? 'english';\r\n\r\n    const rootUrl = languages[language];\r\n    const currentUrl = `${rootUrl}/services/${category}/more.html`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    let items = $('.list__title')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.text(),\r\n                link: `${rootUrl}${item.attr('href')}`,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n\r\n                const content = load(detailResponse.data);\r\n\r\n                item.pubDate = parseDate(content('a[data-unixtime]').attr('data-unixtime') * 1000);\r\n\r\n                item.category = content('.tag__text')\r\n                    .toArray()\r\n                    .map((tag) => content(tag).text());\r\n\r\n                content('.article__meta, .article__title, .article__info, .article__quote-bg, .article__google-news, .article__footer, .m-buy, .photoview__ext-link').remove();\r\n                content('div[data-type=\"article\"]').remove();\r\n\r\n                item.description = content('.article').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${category} - Sputnik News`,\r\n        link: `${rootUrl}/${category}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAM,EAAY,CACd,QAAS,0BACT,QAAS,gCACT,OAAQ,qBACR,OAAQ,6BACR,MAAO,yBACP,QAAS,6BACT,MAAO,6BACP,OAAQ,6BACR,QAAS,6BACT,QAAS,4BACT,WAAY,6BACZ,UAAW,6BACX,WAAY,yBACZ,SAAU,4BACV,OAAQ,gCACR,QAAS,8BACT,SAAU,8BACV,YAAa,qBACb,OAAQ,iCACR,QAAS,6BACT,QAAS,6BACT,KAAM,6BACN,OAAQ,yBACR,OAAQ,6BACR,MAAO,gCACP,MAAO,yBACP,WAAY,6BACZ,SAAU,6BACV,QAAS,wBACT,WAAY,8BAGHA,EAAe,CACxB,KAAM,yBACN,WAAY,CAAC,qBACb,QAAS,eACT,WAAY,CAAE,SAAU,mDAAoD,SAAU,2CACtF,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,WACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gCAgDjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,OACxC,EAAW,EAAI,IAAI,MAAM,aAAe,UAExC,EAAU,EAAU,GACpB,EAAa,GAAG,EAAQ,YAAY,EAAS,YAE7C,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAEpB,EAAQ,EAAE,gBACT,UACA,IAAK,IACF,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,OACZ,KAAM,GAAG,IAAU,EAAK,KAAK,aA8BzC,MA1BA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGR,EAAU,EAAK,EAAe,MAapC,MAXA,GAAK,QAAU,EAAU,EAAQ,oBAAoB,KAAK,iBAAmB,KAE7E,EAAK,SAAW,EAAQ,cACnB,UACA,IAAK,GAAQ,EAAQ,GAAK,QAE/B,EAAQ,8IAA8I,SACtJ,EAAQ,4BAA4B,SAEpC,EAAK,YAAc,EAAQ,YAAY,OAEhC,MAKZ,CACH,MAAO,GAAG,EAAS,iBACnB,KAAM,GAAG,EAAQ,GAAG,IACpB,KAAM"}