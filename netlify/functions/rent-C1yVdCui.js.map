{"version":3,"file":"rent-C1yVdCui.js","names":[],"sources":["../../lib/routes/wellcee/rent.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport type { Context } from 'hono';\r\nimport { District, House } from './types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { baseUrl, getCitys, getDistricts } from './utils';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst render = (data) => art(path.join(__dirname, 'templates/house.art'), data);\r\n\r\nexport const route: Route = {\r\n    path: '/rent/:city/:district?',\r\n    example: '/wellcee/rent/北京',\r\n    parameters: {\r\n        city: '城市',\r\n        district: '地区',\r\n    },\r\n    name: '租房信息',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'www.wellcee.com',\r\n    description: '支持的城市可以通过 [/wellcee/support-city](https://rsshub.app/wellcee/support-city) 获取',\r\n};\r\n\r\nasync function handler(ctx: Context) {\r\n    const { city, district = '' } = ctx.req.param();\r\n    const citys = await getCitys();\r\n    const cityInfo = citys.find((item) => item.chCityName === city);\r\n    if (!cityInfo) {\r\n        throw new InvalidParameterError('Invalid city');\r\n    }\r\n\r\n    let districtInfo: District | undefined;\r\n    if (district) {\r\n        const districts = await getDistricts(cityInfo.id);\r\n        const d = districts.find((item) => item.name === district);\r\n        if (!d) {\r\n            throw new InvalidParameterError('Invalid district');\r\n        }\r\n        districtInfo = d;\r\n    }\r\n\r\n    const response = await ofetch(`${baseUrl}/api/house/filter`, {\r\n        method: 'POST',\r\n        body: {\r\n            districtIds: districtInfo?.id ? [districtInfo.id] : [],\r\n            subways: [],\r\n            rentTypeIds: [],\r\n            timeTypeIds: [],\r\n            price: [],\r\n            tagTypeIds: [],\r\n            cityId: cityInfo.id,\r\n            lang: 1,\r\n            pn: 1,\r\n        },\r\n    });\r\n\r\n    const items = (response.data.list as House[]).map((item) => ({\r\n        title: item.address,\r\n        link: `${baseUrl}/rent-apartment/${item.id}`,\r\n        description: render({ item }),\r\n        pubDate: parseDate(item.loginTime, 'X'),\r\n        author: item.userInfo.name,\r\n        category: [...item.tags, ...item.typeTags],\r\n    }));\r\n\r\n    return {\r\n        title: `${city}${districtInfo?.name ?? ''}租房信息 - Wellcee`,\r\n        description: `${cityInfo.statics.online_text} ${cityInfo.statics.total_text}`,\r\n        image: cityInfo.icon,\r\n        icon: cityInfo.icon,\r\n        logo: cityInfo.icon,\r\n        link: `${baseUrl}/rent-apartment/${cityInfo.cityName}/list?cityId=${cityInfo.id}&lang=zh${district ? `#districtIds=${districtInfo?.id}` : ''}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"sgBAWA,MAAM,EAAU,GAAS,EAAI,EAAA,KAAA,EAAA,gCAA6C,GAE7D,EAAe,CACxB,KAAM,yBACN,QAAS,mBACT,WAAY,CACR,KAAM,KACN,SAAU,MAEd,KAAM,OACN,YAAa,CAAC,UACd,UACA,IAAK,kBACL,YAAa,iFAGjB,eAAe,EAAQ,EAAc,CACjC,GAAM,CAAE,OAAM,WAAW,IAAO,EAAI,IAAI,QAClC,EAAQ,MAAM,IACd,EAAW,EAAM,KAAM,GAAS,EAAK,aAAe,GAC1D,GAAI,CAAC,EACD,MAAM,IAAI,EAAsB,gBAGpC,IAAI,EACJ,GAAI,EAAU,CACV,IAAM,EAAY,MAAM,EAAa,EAAS,IACxC,EAAI,EAAU,KAAM,GAAS,EAAK,OAAS,GACjD,GAAI,CAAC,EACD,MAAM,IAAI,EAAsB,oBAEpC,EAAe,EAGnB,IAAM,EAAW,MAAM,EAAO,GAAG,EAAQ,mBAAoB,CACzD,OAAQ,OACR,KAAM,CACF,YAAa,GAAc,GAAK,CAAC,EAAa,IAAM,GACpD,QAAS,GACT,YAAa,GACb,YAAa,GACb,MAAO,GACP,WAAY,GACZ,OAAQ,EAAS,GACjB,KAAM,EACN,GAAI,KAIN,EAAS,EAAS,KAAK,KAAiB,IAAK,IAAU,CACzD,MAAO,EAAK,QACZ,KAAM,GAAG,EAAQ,kBAAkB,EAAK,KACxC,YAAa,EAAO,CAAE,SACtB,QAAS,EAAU,EAAK,UAAW,KACnC,OAAQ,EAAK,SAAS,KACtB,SAAU,CAAC,GAAG,EAAK,KAAM,GAAG,EAAK,aAGrC,MAAO,CACH,MAAO,GAAG,IAAO,GAAc,MAAQ,GAAG,gBAC1C,YAAa,GAAG,EAAS,QAAQ,YAAY,GAAG,EAAS,QAAQ,aACjE,MAAO,EAAS,KAChB,KAAM,EAAS,KACf,KAAM,EAAS,KACf,KAAM,GAAG,EAAQ,kBAAkB,EAAS,SAAS,eAAe,EAAS,GAAG,UAAU,EAAW,gBAAgB,GAAc,KAAO,KAC1I,KAAM"}