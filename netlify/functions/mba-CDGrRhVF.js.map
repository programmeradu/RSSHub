{"version":3,"file":"mba-CDGrRhVF.js","names":["got","cache","image","route: Route"],"sources":["../../lib/routes/bnu/mba.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = 'xwdt' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n\r\n    const rootUrl = 'https://mba.bnu.edu.cn';\r\n    const currentUrl = new URL(`${category.replace(/\\/$/, '')}/`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('ul.concrcc li')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('a.listlj');\r\n            const title = a.text();\r\n\r\n            return {\r\n                title,\r\n                pubDate: parseDate(item.find('div.crq').text()),\r\n                link: new URL(a.prop('href'), currentUrl).href,\r\n                language,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const title = $$('div.connewst').text();\r\n                const description = $$('div.concrczw').html();\r\n                const image = $$('div.concrczw img').first().prop('src');\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = parseDate($$('div.connewstis-time').text().split(/：/).pop());\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.concrczw').text(),\r\n                };\r\n                item.image = image;\r\n                item.banner = image;\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const author = $('title').text();\r\n    const image = new URL('images/logo5.png', rootUrl).href;\r\n\r\n    return {\r\n        title: `${author} - ${$('div.concrchbt').text()}`,\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author,\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/mba/:category{.+}?',\r\n    name: '经济与工商管理学院MBA',\r\n    url: 'mba.bnu.edu.cn',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/bnu/mba/xwdt',\r\n    parameters: { category: '分类，默认为 xwdt，即新闻聚焦' },\r\n    description: `::: tip\r\n  若订阅 [新闻聚焦](https://mba.bnu.edu.cn/xwdt/index.html)，网址为 \\`https://mba.bnu.edu.cn/xwdt/index.html\\`。截取 \\`https://mba.bnu.edu.cn/\\` 到末尾 \\`/index.html\\` 的部分 \\`xwdt\\` 作为参数填入，此时路由为 [\\`/bnu/mba/xwdt\\`](https://rsshub.app/bnu/mba/xwdt)。\r\n:::\r\n\r\n#### [主页](https://mba.bnu.edu.cn)\r\n\r\n| [新闻聚焦](https://mba.bnu.edu.cn/xwdt/index.html) | [通知公告](https://mba.bnu.edu.cn/tzgg/index.html) | [MBA 系列讲座](https://mba.bnu.edu.cn/mbaxljz/index.html) |\r\n| -------------------------------------------------- | -------------------------------------------------- | --------------------------------------------------------- |\r\n| [xwdt](https://rsshub.app/bnu/mba/xwdt)            | [tzgg](https://rsshub.app/bnu/mba/tzgg)            | [mbaxljz](https://rsshub.app/bnu/mba/mbaxljz)             |\r\n\r\n#### [招生动态](https://mba.bnu.edu.cn/zsdt/zsjz/index.html)\r\n\r\n| [下载专区](https://mba.bnu.edu.cn/zsdt/cjwt/index.html) |\r\n| ------------------------------------------------------- |\r\n| [zsdt/cjwt](https://rsshub.app/bnu/mba/zsdt/cjwt)       |\r\n\r\n#### [国际视野](https://mba.bnu.edu.cn/gjhz/hwjd/index.html)\r\n\r\n| [海外基地](https://mba.bnu.edu.cn/gjhz/hwjd/index.html) | [学位合作](https://mba.bnu.edu.cn/gjhz/xwhz/index.html) | [长期交换](https://mba.bnu.edu.cn/gjhz/zqjh/index.html) | [短期项目](https://mba.bnu.edu.cn/gjhz/dqxm/index.html) |\r\n| ------------------------------------------------------- | ------------------------------------------------------- | ------------------------------------------------------- | ------------------------------------------------------- |\r\n| [gjhz/hwjd](https://rsshub.app/bnu/mba/gjhz/hwjd)       | [gjhz/xwhz](https://rsshub.app/bnu/mba/gjhz/xwhz)       | [gjhz/zqjh](https://rsshub.app/bnu/mba/gjhz/zqjh)       | [gjhz/dqxm](https://rsshub.app/bnu/mba/gjhz/dqxm)       |\r\n\r\n#### [校园生活](https://mba.bnu.edu.cn/xysh/xszz/index.html)\r\n\r\n| [学生组织](https://mba.bnu.edu.cn/xysh/xszz/index.html) |\r\n| ------------------------------------------------------- |\r\n| [xysh/xszz](https://rsshub.app/bnu/mba/xysh/xszz)       |\r\n\r\n#### [职业发展](https://mba.bnu.edu.cn/zyfz/xwds/index.html)\r\n\r\n| [校外导师](https://mba.bnu.edu.cn/zyfz/xwds/index.html) | [企业实践](https://mba.bnu.edu.cn/zyfz/zycp/index.html) | [就业创业](https://mba.bnu.edu.cn/zyfz/jycy/index.html) |\r\n| ------------------------------------------------------- | ------------------------------------------------------- | ------------------------------------------------------- |\r\n| [zyfz/xwds](https://rsshub.app/bnu/mba/zyfz/xwds)       | [zyfz/zycp](https://rsshub.app/bnu/mba/zyfz/zycp)       | [zyfz/jycy](https://rsshub.app/bnu/mba/zyfz/jycy)       |\r\n  `,\r\n    categories: ['university'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['mba.bnu.edu.cn/:category?'],\r\n            target: (params) => {\r\n                const category = params.category;\r\n\r\n                return category ? `/${category.replace(/\\/index\\.html$/, '')}` : '';\r\n            },\r\n        },\r\n        {\r\n            title: '新闻聚焦',\r\n            source: ['mba.bnu.edu.cn/xwdt/index.html'],\r\n            target: '/mba/xwdt',\r\n        },\r\n        {\r\n            title: '通知公告',\r\n            source: ['mba.bnu.edu.cn/tzgg/index.html'],\r\n            target: '/mba/tzgg',\r\n        },\r\n        {\r\n            title: 'MBA系列讲座',\r\n            source: ['mba.bnu.edu.cn/mbaxljz/index.html'],\r\n            target: '/mba/mbaxljz',\r\n        },\r\n        {\r\n            title: '招生动态 - 下载专区',\r\n            source: ['mba.bnu.edu.cn/zsdt/cjwt/index.html'],\r\n            target: '/mba/zsdt/cjwt',\r\n        },\r\n        {\r\n            title: '国际视野 - 海外基地',\r\n            source: ['mba.bnu.edu.cn/gjhz/hwjd/index.html'],\r\n            target: '/mba/gjhz/hwjd',\r\n        },\r\n        {\r\n            title: '国际视野 - 学位合作',\r\n            source: ['mba.bnu.edu.cn/gjhz/xwhz/index.html'],\r\n            target: '/mba/gjhz/xwhz',\r\n        },\r\n        {\r\n            title: '国际视野 - 长期交换',\r\n            source: ['mba.bnu.edu.cn/gjhz/zqjh/index.html'],\r\n            target: '/mba/gjhz/zqjh',\r\n        },\r\n        {\r\n            title: '国际视野 - 短期项目',\r\n            source: ['mba.bnu.edu.cn/gjhz/dqxm/index.html'],\r\n            target: '/mba/gjhz/dqxm',\r\n        },\r\n        {\r\n            title: '校园生活 - 学生组织',\r\n            source: ['mba.bnu.edu.cn/xysh/xszz/index.html'],\r\n            target: '/mba/xysh/xszz',\r\n        },\r\n        {\r\n            title: '职业发展 - 校外导师',\r\n            source: ['mba.bnu.edu.cn/zyfz/xwds/index.html'],\r\n            target: '/mba/zyfz/xwds',\r\n        },\r\n        {\r\n            title: '职业发展 - 企业实践',\r\n            source: ['mba.bnu.edu.cn/zyfz/zycp/index.html'],\r\n            target: '/mba/zyfz/zycp',\r\n        },\r\n        {\r\n            title: '职业发展 - 就业创业',\r\n            source: ['mba.bnu.edu.cn/zyfz/jycy/index.html'],\r\n            target: '/mba/zyfz/jycy',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"wWAOA,MAAa,EAAU,KAAO,IAAQ,CAClC,GAAM,CAAE,WAAW,QAAW,EAAI,IAAI,QAChC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,yBACV,EAAa,IAAI,IAAI,GAAG,EAAS,QAAQ,MAAO,IAAI,GAAI,GAAS,KAEjE,CAAE,KAAM,GAAa,MAAMA,EAAI,GAE/B,EAAI,EAAK,GAET,EAAW,EAAE,QAAQ,KAAK,QAE5B,EAAQ,EAAE,iBACT,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAI,EAAK,KAAK,YACd,EAAQ,EAAE,OAEhB,MAAO,CACH,QACA,QAAS,EAAU,EAAK,KAAK,WAAW,QACxC,KAAM,IAAI,IAAI,EAAE,KAAK,QAAS,GAAY,KAC1C,cAIZ,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAMD,EAAI,EAAK,MAE1C,EAAK,EAAK,GAEV,EAAQ,EAAG,gBAAgB,OAC3B,EAAc,EAAG,gBAAgB,OACjCE,EAAQ,EAAG,oBAAoB,QAAQ,KAAK,OAalD,MAXA,GAAK,MAAQ,EACb,EAAK,YAAc,EACnB,EAAK,QAAU,EAAU,EAAG,uBAAuB,OAAO,MAAM,KAAK,OACrE,EAAK,QAAU,CACX,KAAM,EACN,KAAM,EAAG,gBAAgB,QAE7B,EAAK,MAAQA,EACb,EAAK,OAASA,EACd,EAAK,SAAW,EAET,MAKnB,IAAM,EAAS,EAAE,SAAS,OACpB,EAAQ,IAAI,IAAI,mBAAoB,GAAS,KAEnD,MAAO,CACH,MAAO,GAAG,EAAO,KAAK,EAAE,iBAAiB,SACzC,KAAM,EACN,KAAM,EACN,WAAY,GACZ,QACA,SACA,aAIKC,EAAe,CACxB,KAAM,sBACN,KAAM,eACN,IAAK,iBACL,YAAa,CAAC,WACd,UACA,QAAS,gBACT,WAAY,CAAE,SAAU,qBACxB,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAkCb,WAAY,CAAC,cAEb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,6BACT,OAAS,GAAW,CAChB,IAAM,EAAW,EAAO,SAExB,OAAO,EAAW,IAAI,EAAS,QAAQ,iBAAkB,MAAQ,KAGzE,CACI,MAAO,OACP,OAAQ,CAAC,kCACT,OAAQ,aAEZ,CACI,MAAO,OACP,OAAQ,CAAC,kCACT,OAAQ,aAEZ,CACI,MAAO,UACP,OAAQ,CAAC,qCACT,OAAQ,gBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,kBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,kBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,kBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,kBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,kBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,kBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,kBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,kBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ"}