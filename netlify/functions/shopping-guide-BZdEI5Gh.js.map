{"version":3,"file":"shopping-guide-BZdEI5Gh.js","names":["route: Route","got","item","cache","response","$"],"sources":["../../lib/routes/consumer/shopping-guide.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/shopping-guide/:category?/:language?',\r\n    categories: ['new-media'],\r\n    example: '/consumer/shopping-guide',\r\n    parameters: { category: '分类，见下表，默认为 `trivia`', language: '语言，见上表，默认为 `tc`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '消費全攻略',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    description: `| 冷知識 | 懶人包 | 特集     | 銀髮一族           | 飲食煮意         | 科技達人   | 健康美容          | 規劃人生                    | 消閒娛樂                  | 家品家電        | 親子時光        | 綠色生活     |\r\n| ------ | ------ | -------- | ------------------ | ---------------- | ---------- | ----------------- | --------------------------- | ------------------------- | --------------- | --------------- | ------------ |\r\n| trivia | tips   | features | silver-hair-market | food-and-cooking | tech-savvy | health-and-beauty | life-and-financial-planning | leisure-and-entertainment | home-appliances | family-and-kids | green-living |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'trivia', language = 'tc' } = ctx.req.param();\r\n    const rootUrl = 'https://www.consumer.org.hk';\r\n    const currentUrl = `${rootUrl}/${language}/shopping-guide/${category}`;\r\n\r\n    const { data: response } = await got(currentUrl, {\r\n        headers: {\r\n            cookie: `consumer_pagination={${encodeURI('\"228c\"')}:24}`,\r\n        },\r\n    });\r\n\r\n    const $ = load(response);\r\n\r\n    const list = $('.shadow-long-blk')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const info = item\r\n                .find('.item-info li')\r\n                .toArray()\r\n                .map((item) => $(item).text().trim());\r\n            return {\r\n                title: item.find('h2').text().trim(),\r\n                description: item.find('p').text().trim(),\r\n                link: `${rootUrl}${item.attr('href')}`,\r\n                pubDate: parseDate(info.shift(), 'YYYY-MM-DD'),\r\n                category: info,\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n\r\n                const header = $('.article-img-blk');\r\n                header.find('img').each((_, ele) => {\r\n                    ele = $(ele);\r\n                    if (ele.attr('src') && ele.attr('srcset')) {\r\n                        ele.removeAttr('srcset');\r\n                        ele.attr('src', ele.attr('src').replace(/\\/\\d+c\\d+\\//, '/0p0/'));\r\n                    }\r\n                });\r\n\r\n                item.description = header.html() + $('article .ckec').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        link: currentUrl,\r\n        image: $('meta[property=\"og:image\"]').attr('content'),\r\n        logo: $('link[rel=\"apple-touch-icon\"]').attr('href'),\r\n        icon: $('link[rel=\"apple-touch-icon\"]').attr('href'),\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,wCACN,WAAY,CAAC,aACb,QAAS,2BACT,WAAY,CAAE,SAAU,sBAAuB,SAAU,mBACzD,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,QACN,YAAa,CAAC,UACd,UACA,YAAa;;uNAKjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,SAAU,WAAW,MAAS,EAAI,IAAI,QACnD,EAAU,8BACV,EAAa,GAAG,EAAQ,GAAG,EAAS,kBAAkB,IAEtD,CAAE,KAAM,GAAa,MAAMC,EAAI,EAAY,CAC7C,QAAS,CACL,OAAQ,yCAIV,EAAI,EAAK,GAET,EAAO,EAAE,oBACV,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAO,EACR,KAAK,iBACL,UACA,IAAK,GAAS,EAAEC,GAAM,OAAO,QAClC,MAAO,CACH,MAAO,EAAK,KAAK,MAAM,OAAO,OAC9B,YAAa,EAAK,KAAK,KAAK,OAAO,OACnC,KAAM,GAAG,IAAU,EAAK,KAAK,UAC7B,QAAS,EAAU,EAAK,QAAS,cACjC,SAAU,KAIhB,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMH,EAAI,EAAK,MACpCI,EAAI,EAAKD,GAET,EAASC,EAAE,oBAWjB,OAVA,EAAO,KAAK,OAAO,MAAM,EAAG,IAAQ,CAChC,EAAMA,EAAE,GACJ,EAAI,KAAK,QAAU,EAAI,KAAK,YAC5B,EAAI,WAAW,UACf,EAAI,KAAK,MAAO,EAAI,KAAK,OAAO,QAAQ,cAAe,aAI/D,EAAK,YAAc,EAAO,OAASA,EAAE,iBAAiB,OAE/C,MAKnB,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,KAAM,EACN,MAAO,EAAE,6BAA6B,KAAK,WAC3C,KAAM,EAAE,gCAAgC,KAAK,QAC7C,KAAM,EAAE,gCAAgC,KAAK,QAC7C,KAAM"}