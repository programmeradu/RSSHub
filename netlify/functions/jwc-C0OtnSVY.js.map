{"version":3,"file":"jwc-C0OtnSVY.js","names":["got","cache","response","$","route: Route"],"sources":["../../lib/routes/upc/jwc.ts"],"sourcesContent":["// 导入必要的模组\r\nimport { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport cache from '@/utils/cache';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst handler = async (ctx) => {\r\n    // 从 URL 参数中获取通知分类\r\n    const { type = 'tzgg' } = ctx.req.param();\r\n    const baseUrl = 'https://jwc.upc.edu.cn';\r\n    const { data: response } = await got(`${baseUrl}/${type}/list.htm`);\r\n    const $ = load(response);\r\n    const list = $('ul.news_list')\r\n        .find('li')\r\n        // 使用“toArray()”方法将选择的所有 DOM 元素以数组的形式返回。\r\n        .toArray()\r\n        // 使用“map()”方法遍历数组，并从每个元素中解析需要的数据。\r\n        .map((item) => {\r\n            item = $(item);\r\n            const a = item.find('a').first();\r\n            let linkStr = a.attr('href');\r\n            // 改为https访问并补全站内链接\r\n            linkStr = linkStr.replace('http://', 'https://');\r\n            if (!a.attr('href').startsWith('https://')) {\r\n                linkStr = `${baseUrl}${a.attr('href')}`;\r\n            }\r\n            return {\r\n                title: a.text(),\r\n                link: linkStr,\r\n                pubDate: timezone(parseDate(item.find('.news_meta').text()), +8), // 添加发布日期查询\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                try {\r\n                    const { data: response } = await got(item.link);\r\n                    const $ = load(response);\r\n\r\n                    if (item.link.includes('news.upc.edu.cn')) {\r\n                        item.description = $('.v_news_content').html();\r\n                        item.author = $('.nr-zz h2').html();\r\n                    } else if (item.link.includes('app.upc.edu.cn')) {\r\n                        const scriptContent = $('body script').first().html();\r\n                        let dataObj = null;\r\n                        if (scriptContent) {\r\n                            const match = scriptContent.match(/data\\s*:\\s*function\\s*\\(\\)\\s*{\\s*return\\s*{[^}]*data\\s*:\\s*({[\\s\\S]*?})/);\r\n                            if (match && match[1]) {\r\n                                const dataStr = match[1];\r\n                                dataObj = JSON.parse(dataStr);\r\n                            }\r\n                        }\r\n                        item.description = dataObj.content;\r\n                        item.author = dataObj.author;\r\n                    } else {\r\n                        // 选择类名为“comment-body”的第一个元素\r\n                        item.description = $('.read').first().html() || '无法获取正文内容，请手动访问';\r\n                        item.author = $('.arti_publisher').html();\r\n                    }\r\n                } catch {\r\n                    item.description = '正文内容获取失败';\r\n                }\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        // 源标题\r\n        title: `${$('title').text()}-教务处通知-中国石油大学（华东）`,\r\n        // 源链接\r\n        link: `${baseUrl}/${type}/list.htm`,\r\n        // 源文章\r\n        item: items,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/jwc/:type?',\r\n    categories: ['university'],\r\n    example: '/upc/jwc/tzgg',\r\n    parameters: { type: '分类，见下表，其值与对应网页url路径参数一致，默认为所有通知' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['jwc.upc.edu.cn', 'jwc.upc.edu.cn/:type/list.htm'],\r\n            target: '/jwc/:type?',\r\n        },\r\n    ],\r\n    name: '教务处',\r\n    maintainers: ['sddzhyc'],\r\n    description: `| 所有通知 | 教学·运行 | 学业·学籍 | 教学·研究 | 课程·教材 | 实践·教学 | 创新·创业 | 语言·文字 | 继续·教育 | 本科·招生 |\r\n| -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |\r\n| tzgg     | 18519    | 18520   | 18521    |    18522 |    18523 | 18524    |  yywwz   |  jxwjy   |   bkwzs  |`,\r\n    url: 'jwc.upc.edu.cn/tzgg/list.htm',\r\n    handler,\r\n};\r\n"],"mappings":"0ZAQA,MAAM,EAAU,KAAO,IAAQ,CAE3B,GAAM,CAAE,OAAO,QAAW,EAAI,IAAI,QAC5B,EAAU,yBACV,CAAE,KAAM,GAAa,MAAMA,EAAI,GAAG,EAAQ,GAAG,EAAK,YAClD,EAAI,EAAK,GACT,EAAO,EAAE,gBACV,KAAK,MAEL,UAEA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAI,EAAK,KAAK,KAAK,QACrB,EAAU,EAAE,KAAK,QAMrB,MAJA,GAAU,EAAQ,QAAQ,UAAW,YAChC,EAAE,KAAK,QAAQ,WAAW,cAC3B,EAAU,GAAG,IAAU,EAAE,KAAK,WAE3B,CACH,MAAO,EAAE,OACT,KAAM,EACN,QAAS,EAAS,EAAU,EAAK,KAAK,cAAc,QAAS,MAInE,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,CACA,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAEf,GAAI,EAAK,KAAK,SAAS,mBACnB,EAAK,YAAcC,EAAE,mBAAmB,OACxC,EAAK,OAASA,EAAE,aAAa,eACtB,EAAK,KAAK,SAAS,kBAAmB,CAC7C,IAAM,EAAgBA,EAAE,eAAe,QAAQ,OAC3C,EAAU,KACd,GAAI,EAAe,CACf,IAAM,EAAQ,EAAc,MAAM,2EAClC,GAAI,GAAS,EAAM,GAAI,CACnB,IAAM,EAAU,EAAM,GACtB,EAAU,KAAK,MAAM,IAG7B,EAAK,YAAc,EAAQ,QAC3B,EAAK,OAAS,EAAQ,YAGtB,EAAK,YAAcA,EAAE,SAAS,QAAQ,QAAU,iBAChD,EAAK,OAASA,EAAE,mBAAmB,YAEnC,CACJ,EAAK,YAAc,WAEvB,OAAO,MAKnB,MAAO,CAEH,MAAO,GAAG,EAAE,SAAS,OAAO,mBAE5B,KAAM,GAAG,EAAQ,GAAG,EAAK,WAEzB,KAAM,IAIDC,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,cACb,QAAS,gBACT,WAAY,CAAE,KAAM,mCACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,iBAAkB,iCAC3B,OAAQ,gBAGhB,KAAM,MACN,YAAa,CAAC,WACd,YAAa;;gHAGb,IAAK,+BACL"}