{"version":3,"file":"postgraduate-CxwVBzY2.js","names":["COLUMNS: Record<string, { title: string; description: string }>","handler: Route['handler']","NotFoundError","got","cache","route: Route"],"sources":["../../lib/routes/nwnu/routes/department/postgraduate.ts"],"sourcesContent":["import NotFoundError from '@/errors/types/not-found';\r\nimport { DataItem, Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\nimport { processEmbedPDF } from '../lib/embed-resource';\r\n\r\nconst WEBSITE_LOGO = 'https://www.nwnu.edu.cn/_upload/tpl/02/d9/729/template729/favicon.ico';\r\nconst BASE_URL = 'https://yjsy.nwnu.edu.cn/';\r\n\r\nconst COLUMNS: Record<string, { title: string; description: string }> = {\r\n    '2701': {\r\n        title: '招生工作（包括硕士、博士招生）',\r\n        description: '研究生院招生信息（包含硕士招生和博士招生两个栏目）',\r\n    },\r\n    '2738': {\r\n        title: '工作动态',\r\n        description: '研究生院工作动态',\r\n    },\r\n    '2712': {\r\n        title: '博士招生',\r\n        description: '研究生院博士研究生招生信息',\r\n    },\r\n    '2713': {\r\n        title: '硕士招生',\r\n        description: '研究生院硕士研究生招生信息',\r\n    },\r\n    '2702': {\r\n        title: '培养工作',\r\n        description: '培养工作栏目信息汇总',\r\n    },\r\n    '2703': {\r\n        title: '学科建设',\r\n        description: '研究生院学科建设信息汇总',\r\n    },\r\n    '2704': {\r\n        title: '学位工作',\r\n        description: '研究生院学位工作栏目信息汇总',\r\n    },\r\n};\r\n\r\nconst handler: Route['handler'] = async (ctx) => {\r\n    const columnParam = ctx.req.param('column');\r\n    if (COLUMNS[columnParam] === undefined) {\r\n        throw new NotFoundError(`The column ${columnParam} does not exist`);\r\n    }\r\n    const columnTitle = COLUMNS[columnParam].title;\r\n    const columnDescription = COLUMNS[columnParam].description;\r\n    const columnPageUrl = `https://yjsy.nwnu.edu.cn/${columnParam}/list.htm`;\r\n\r\n    // Fetch the list page\r\n    const { data: listResponse } = await got(columnPageUrl);\r\n    const $ = load(listResponse);\r\n\r\n    // Select all list items containing academic information\r\n    const ITEM_SELECTOR = '#AjaxList > ul > li.a-list';\r\n    const listItems = $(ITEM_SELECTOR);\r\n\r\n    // Map through each list item to extract details\r\n    const itemLinks = listItems.toArray().map((element) => {\r\n        const title = $(element).find('a:nth-child(2)').attr('title')!;\r\n        const date = parseDate($(element).find('span.pdate').text()!);\r\n        const relativeLink = $(element).find('a:nth-child(2)').attr('href')!;\r\n        const link = new URL(relativeLink, BASE_URL).href;\r\n        return {\r\n            title,\r\n            date,\r\n            link,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: columnTitle,\r\n        description: columnDescription,\r\n        link: columnPageUrl,\r\n        image: WEBSITE_LOGO,\r\n        item: (await Promise.all(\r\n            itemLinks.map((item) =>\r\n                cache.tryGet(item.link, async () => {\r\n                    const CONTENT_SELECTOR = 'div.content_div';\r\n                    const { data: contentResponse } = await got(item.link);\r\n                    const contentPage = load(contentResponse);\r\n                    const content = processEmbedPDF(BASE_URL, contentPage(CONTENT_SELECTOR).html() || '');\r\n                    return {\r\n                        title: item.title,\r\n                        pubDate: item.date,\r\n                        link: item.link,\r\n                        description: content,\r\n                        category: ['university'],\r\n                        guid: item.link,\r\n                        id: item.link,\r\n                        image: WEBSITE_LOGO,\r\n                        content,\r\n                        updated: item.date,\r\n                        language: 'zh-CN',\r\n                    };\r\n                })\r\n            )\r\n        )) as DataItem[],\r\n        allowEmpty: true,\r\n        language: 'zh-CN',\r\n        feedLink: `https://rsshub.app/nwnu/department/postgraduate/${columnParam}`,\r\n        id: `https://rsshub.app/nwnu/department/postgraduate/${columnParam}`,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/department/postgraduate/:column',\r\n    name: '研究生院',\r\n    maintainers: ['PrinOrange'],\r\n    handler,\r\n    categories: ['university'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportRadar: true,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    example: '/department/postgraduate/2701',\r\n    radar: [\r\n        {\r\n            source: ['yjsy.nwnu.edu.cn/:column/list.htm'],\r\n            target: '/department/postgraduate/:column',\r\n        },\r\n    ],\r\n    description: `\r\n| column | 标题                           | 描述                                               |\r\n| ------ | ------------------------------ | -------------------------------------------------- |\r\n| 2701   | 招生工作（包括硕士、博士招生） | 研究生院招生信息（包含硕士招生和博士招生两个栏目） |\r\n| 2712   | 博士招生                       | 研究生院博士研究生招生信息                         |\r\n| 2713   | 硕士招生                       | 研究生院硕士研究生招生信息                         |\r\n| 2702   | 培养工作                       | 培养工作栏目信息汇总                               |\r\n| 2703   | 学科建设                       | 研究生院学科建设信息汇总                           |\r\n| 2704   | 学位工作                       | 研究生院学位工作栏目信息汇总                       |`,\r\n};\r\n"],"mappings":"meAQA,MAAM,EAAe,wEACf,EAAW,4BAEXA,EAAkE,CACpE,KAAQ,CACJ,MAAO,kBACP,YAAa,6BAEjB,KAAQ,CACJ,MAAO,OACP,YAAa,YAEjB,KAAQ,CACJ,MAAO,OACP,YAAa,iBAEjB,KAAQ,CACJ,MAAO,OACP,YAAa,iBAEjB,KAAQ,CACJ,MAAO,OACP,YAAa,cAEjB,KAAQ,CACJ,MAAO,OACP,YAAa,gBAEjB,KAAQ,CACJ,MAAO,OACP,YAAa,mBAIfC,EAA4B,KAAO,IAAQ,CAC7C,IAAM,EAAc,EAAI,IAAI,MAAM,UAClC,GAAI,EAAQ,KAAiB,IAAA,GACzB,MAAM,IAAIC,EAAc,cAAc,EAAY,kBAEtD,IAAM,EAAc,EAAQ,GAAa,MACnC,EAAoB,EAAQ,GAAa,YACzC,EAAgB,4BAA4B,EAAY,WAGxD,CAAE,KAAM,GAAiB,MAAMC,EAAI,GACnC,EAAI,EAAK,GAIT,EAAY,EAAE,8BAGd,EAAY,EAAU,UAAU,IAAK,GAAY,CACnD,IAAM,EAAQ,EAAE,GAAS,KAAK,kBAAkB,KAAK,SAC/C,EAAO,EAAU,EAAE,GAAS,KAAK,cAAc,QAC/C,EAAe,EAAE,GAAS,KAAK,kBAAkB,KAAK,QACtD,EAAO,IAAI,IAAI,EAAc,GAAU,KAC7C,MAAO,CACH,QACA,OACA,UAIR,MAAO,CACH,MAAO,EACP,YAAa,EACb,KAAM,EACN,MAAO,EACP,KAAO,MAAM,QAAQ,IACjB,EAAU,IAAK,GACXC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GACM,CAAE,KAAM,GAAoB,MAAMD,EAAI,EAAK,MAC3C,EAAc,EAAK,GACnB,EAAU,EAAgB,EAAU,EAAY,mBAAkB,QAAU,IAClF,MAAO,CACH,MAAO,EAAK,MACZ,QAAS,EAAK,KACd,KAAM,EAAK,KACX,YAAa,EACb,SAAU,CAAC,cACX,KAAM,EAAK,KACX,GAAI,EAAK,KACT,MAAO,EACP,UACA,QAAS,EAAK,KACd,SAAU,aAK1B,WAAY,GACZ,SAAU,QACV,SAAU,mDAAmD,IAC7D,GAAI,mDAAmD,MAIlDE,EAAe,CACxB,KAAM,mCACN,KAAM,OACN,YAAa,CAAC,cACd,UACA,WAAY,CAAC,cACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,aAAc,GACd,eAAgB,GAChB,cAAe,IAEnB,QAAS,gCACT,MAAO,CACH,CACI,OAAQ,CAAC,qCACT,OAAQ,qCAGhB,YAAa"}