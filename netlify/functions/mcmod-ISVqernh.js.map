{"version":3,"file":"mcmod-ISVqernh.js","names":[],"sources":["../../lib/routes/mcmod/index.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport ofetch from '@/utils/ofetch';\r\nimport path from 'node:path';\r\nimport cache from '@/utils/cache';\r\nimport timezone from '@/utils/timezone';\r\nimport { art } from '@/utils/render';\r\n\r\nconst render = (mod) => art(path.join(__dirname, 'templates/mod.art'), { mod });\r\n\r\nexport const route: Route = {\r\n    path: '/:type',\r\n    categories: ['game'],\r\n    example: '/mcmod/new',\r\n    parameters: { type: '查询类型，详见下表' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '最新MOD',\r\n    maintainers: ['hualiong'],\r\n    description: `\\`:type\\` 类型可选如下\r\n\r\n| 随机显示MOD | 最新收录MOD | 最近编辑MOD |\r\n| ------ | --- | ---- |\r\n| random | new | edit |`,\r\n    handler: async (ctx) => {\r\n        const type = ctx.req.param('type');\r\n        const $get = ofetch.create({ baseURL: 'https://www.mcmod.cn' });\r\n        const response = await $get('/');\r\n\r\n        const $ = load(response);\r\n        const typeName = $(`div.left > ul > li[i='${type}']`).attr('title');\r\n        const list = $(`#indexNew_${type} > .block`)\r\n            .toArray()\r\n            .map((item): DataItem => {\r\n                const each = $(item);\r\n                const time = each.find('div .time');\r\n                return {\r\n                    title: each.find('div > .name > a').text(),\r\n                    image: each.find('img').attr('src')?.split('@')[0],\r\n                    link: each.children('a').attr('href'),\r\n                    pubDate: time.attr('title') && timezone(parseDate(time.attr('title')!.slice(6), 'YYYY-MM-DD HH:mm:ss'), +8),\r\n                };\r\n            });\r\n\r\n        const items = await Promise.all(\r\n            list.map((item) =>\r\n                cache.tryGet(item.link!, async () => {\r\n                    const response = await $get(item.link!);\r\n                    const $ = load(response);\r\n\r\n                    item.author = $('.author li')\r\n                        .toArray()\r\n                        .map((item) => {\r\n                            const each = $(item);\r\n                            const name = each.find('.name a');\r\n                            return {\r\n                                name: name.text(),\r\n                                url: 'https://www.mcmod.cn' + name.attr('href'),\r\n                                avatar: each.find('.avatar img').attr('src')?.split('?')[0],\r\n                            };\r\n                        });\r\n\r\n                    const html = $('.common-text[data-id=\"1\"]').html()!;\r\n                    const support = $('.mcver > ul > ul')\r\n                        .toArray()\r\n                        .map((e) => {\r\n                            const ul = $(e);\r\n                            const label = ul.children('li:first-child').text();\r\n                            const versions = ul\r\n                                .children('li:not(:first-child)')\r\n                                .toArray()\r\n                                .map((e) => $(e).text())\r\n                                .join('，');\r\n                            return { label, versions };\r\n                        });\r\n\r\n                    item.description =\r\n                        render({\r\n                            pic: 'https:' + item.image,\r\n                            label: $('.class-info  li.col-lg-4')\r\n                                .toArray()\r\n                                .map((e) => $(e).text()),\r\n                            support,\r\n                        }) + html.replaceAll(/\\ssrc=\".+?\"/g, '').replaceAll('data-src', 'src');\r\n                    return item;\r\n                })\r\n            )\r\n        );\r\n\r\n        return {\r\n            title: `${typeName} - MC百科`,\r\n            description: $('meta[name=\"description\"]').attr('content'),\r\n            link: 'https://www.mcmod.cn',\r\n            item: items as DataItem[],\r\n        };\r\n    },\r\n};\r\n"],"mappings":"qdASA,MAAM,EAAU,GAAQ,EAAI,EAAA,KAAA,EAAA,8BAA2C,CAAE,QAE5D,EAAe,CACxB,KAAM,SACN,WAAY,CAAC,QACb,QAAS,aACT,WAAY,CAAE,KAAM,aACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,QACN,YAAa,CAAC,YACd,YAAa;;;;yBAKb,QAAS,KAAO,IAAQ,CACpB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAO,EAAO,OAAO,CAAE,QAAS,yBAChC,EAAW,MAAM,EAAK,KAEtB,EAAI,EAAK,GACT,EAAW,EAAE,yBAAyB,EAAK,KAAK,KAAK,SACrD,EAAO,EAAE,aAAa,EAAK,YAC5B,UACA,IAAK,GAAmB,CACrB,IAAM,EAAO,EAAE,GACT,EAAO,EAAK,KAAK,aACvB,MAAO,CACH,MAAO,EAAK,KAAK,mBAAmB,OACpC,MAAO,EAAK,KAAK,OAAO,KAAK,QAAQ,MAAM,KAAK,GAChD,KAAM,EAAK,SAAS,KAAK,KAAK,QAC9B,QAAS,EAAK,KAAK,UAAY,EAAS,EAAU,EAAK,KAAK,SAAU,MAAM,GAAI,uBAAwB,MAI9G,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACN,EAAM,OAAO,EAAK,KAAO,SAAY,CACjC,IAAM,EAAW,MAAM,EAAK,EAAK,MAC3B,EAAI,EAAK,GAEf,EAAK,OAAS,EAAE,cACX,UACA,IAAK,GAAS,CACX,IAAM,EAAO,EAAE,GACT,EAAO,EAAK,KAAK,WACvB,MAAO,CACH,KAAM,EAAK,OACX,IAAK,uBAAyB,EAAK,KAAK,QACxC,OAAQ,EAAK,KAAK,eAAe,KAAK,QAAQ,MAAM,KAAK,MAIrE,IAAM,EAAO,EAAE,6BAA6B,OACtC,EAAU,EAAE,oBACb,UACA,IAAK,GAAM,CACR,IAAM,EAAK,EAAE,GACP,EAAQ,EAAG,SAAS,kBAAkB,OACtC,EAAW,EACZ,SAAS,wBACT,UACA,IAAK,GAAM,EAAE,GAAG,QAChB,KAAK,KACV,MAAO,CAAE,QAAO,cAWxB,MARA,GAAK,YACD,EAAO,CACH,IAAK,SAAW,EAAK,MACrB,MAAO,EAAE,4BACJ,UACA,IAAK,GAAM,EAAE,GAAG,QACrB,YACC,EAAK,WAAW,eAAgB,IAAI,WAAW,WAAY,OAC7D,MAKnB,MAAO,CACH,MAAO,GAAG,EAAS,SACnB,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,uBACN,KAAM"}