{"version":3,"file":"search-kcPaKq1u.js","names":["route: Route","got"],"sources":["../../lib/routes/steam/search.ts"],"sourcesContent":["import type { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/search/:params',\r\n    categories: ['game'],\r\n    example: '/steam/search/sort_by=Released_DESC&tags=492&category1=10&os=linux',\r\n    parameters: { params: 'Query parameters for a Steam Store search.' },\r\n    radar: [\r\n        {\r\n            source: ['store.steampowered.com', 'store.steampowered.com/search/:params'],\r\n        },\r\n    ],\r\n    name: 'Store Search',\r\n    maintainers: ['moppman'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const query = new URLSearchParams(ctx.req.param('params'));\r\n    const { data: html } = await got('https://store.steampowered.com/search/', {\r\n        searchParams: query,\r\n    });\r\n    const $ = load(html);\r\n    return {\r\n        title: 'Steam search result',\r\n        description: `Query: ${query.toString()}`,\r\n        link: /g_strUnfilteredURL\\s=\\s'(.*)'/.exec(html)[1],\r\n        item: $('#search_result_container a')\r\n            .toArray()\r\n            .map((a) => {\r\n                const $el = $(a);\r\n                const isBundle = !!$el.attr('data-ds-bundle-data');\r\n                const isDiscounted = $el.find('.discount_original_price').length > 0;\r\n                const hasReview = $el.find('.search_review_summary').length > 0;\r\n\r\n                let desc = '';\r\n                if (isBundle) {\r\n                    const bundle = JSON.parse($el.attr('data-ds-bundle-data'));\r\n                    desc += 'Bundle\\n';\r\n                    if (bundle.m_bRestrictGifting) {\r\n                        desc += 'Restrict gifting\\n';\r\n                    }\r\n                    desc += `Items count: ${bundle.m_rgItems.length}\\n`;\r\n                }\r\n                if (isDiscounted) {\r\n                    desc += `Discount: ${$el.find('.discount_pct').text().trim()}\\n`;\r\n                    desc += `Original price: ${$el.find('.discount_original_price').text().trim()}\\n`;\r\n                    desc += `Discounted price: ${$el.find('.discount_final_price').text().trim()}\\n`;\r\n                } else {\r\n                    desc += `Price: ${$el.find('.discount_final_price').text().trim()}\\n`;\r\n                }\r\n                if (hasReview) {\r\n                    desc += $el.find('.search_review_summary').attr('data-tooltip-html');\r\n                }\r\n                return {\r\n                    title: $el.find('span.title').text(),\r\n                    link: $el.attr('href'),\r\n                    description: desc.replaceAll('\\n', '<br>'),\r\n                    media: {\r\n                        thumbnail: {\r\n                            url: $el.find('.search_capsule img').attr('src'),\r\n                        },\r\n                    },\r\n                };\r\n            })\r\n            .filter((it) => it.title),\r\n    };\r\n}\r\n"],"mappings":"+PAIA,MAAaA,EAAe,CACxB,KAAM,kBACN,WAAY,CAAC,QACb,QAAS,qEACT,WAAY,CAAE,OAAQ,8CACtB,MAAO,CACH,CACI,OAAQ,CAAC,yBAA0B,2CAG3C,KAAM,eACN,YAAa,CAAC,WACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,IAAI,gBAAgB,EAAI,IAAI,MAAM,WAC1C,CAAE,KAAM,GAAS,MAAMC,EAAI,yCAA0C,CACvE,aAAc,IAEZ,EAAI,EAAK,GACf,MAAO,CACH,MAAO,sBACP,YAAa,UAAU,EAAM,aAC7B,KAAM,gCAAgC,KAAK,GAAM,GACjD,KAAM,EAAE,8BACH,UACA,IAAK,GAAM,CACR,IAAM,EAAM,EAAE,GACR,EAAW,CAAC,CAAC,EAAI,KAAK,uBACtB,EAAe,EAAI,KAAK,4BAA4B,OAAS,EAC7D,EAAY,EAAI,KAAK,0BAA0B,OAAS,EAE1D,EAAO,GACX,GAAI,EAAU,CACV,IAAM,EAAS,KAAK,MAAM,EAAI,KAAK,wBACnC,GAAQ;EACJ,EAAO,qBACP,GAAQ;GAEZ,GAAQ,gBAAgB,EAAO,UAAU,OAAO,IAYpD,OAVI,GACA,GAAQ,aAAa,EAAI,KAAK,iBAAiB,OAAO,OAAO,IAC7D,GAAQ,mBAAmB,EAAI,KAAK,4BAA4B,OAAO,OAAO,IAC9E,GAAQ,qBAAqB,EAAI,KAAK,yBAAyB,OAAO,OAAO,KAE7E,GAAQ,UAAU,EAAI,KAAK,yBAAyB,OAAO,OAAO,IAElE,IACA,GAAQ,EAAI,KAAK,0BAA0B,KAAK,sBAE7C,CACH,MAAO,EAAI,KAAK,cAAc,OAC9B,KAAM,EAAI,KAAK,QACf,YAAa,EAAK,WAAW;EAAM,QACnC,MAAO,CACH,UAAW,CACP,IAAK,EAAI,KAAK,uBAAuB,KAAK,YAKzD,OAAQ,GAAO,EAAG"}