{"version":3,"file":"report-CiP0t40x.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/cih-index/report.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/report/list/:report?',\r\n    categories: ['finance'],\r\n    example: '/cih-index/report/list/p1-oaddtime-ddesc',\r\n    parameters: { report: '报告 id，可在 URL 中找到，留空为 `p1-oaddtime-ddesc`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '报告',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'www.cih-index.com/report/list/p1-oaddtime-ddesc',\r\n    radar: [\r\n        {\r\n            source: ['www.cih-index.com/report/list/:report'],\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { report = 'p1-oaddtime-ddesc' } = ctx.req.param();\r\n\r\n    const baseUrl = 'https://www.cih-index.com';\r\n    const currentUrl = `${baseUrl}/report/list/${report}`;\r\n    const response = await ofetch(currentUrl);\r\n\r\n    const $ = load(response);\r\n    const initialState = JSON.parse(\r\n        $('script:contains(\"window.__INITIAL_STATE__\")')\r\n            .text()\r\n            .match(/window\\.__INITIAL_STATE__\\s*=\\s*({.*?});/)?.[1] || '{}'\r\n    );\r\n    const { dataResult, indNavLists, secondNameFilter, tagList, param } = initialState.data;\r\n\r\n    const items = dataResult.reportInfoDtoList.map((info) => {\r\n        const pageCount = info.isCharging === 1 ? 3 : info.pageCount;\r\n        let images = '';\r\n        for (let i = 1; i <= pageCount; i++) {\r\n            images += `<img src=\"${baseUrl}/report/bp-creis-report-detail/getImg?id=${info.reportId}&pageNum=${i}\"><br>`;\r\n        }\r\n        return {\r\n            title: info.reportTitle,\r\n            link: `${baseUrl}/report/detail/${info.reportId}.html`,\r\n            pubDate: timezone(parseDate(info.addTime), +8),\r\n            category: [...new Set([...info.reportClassTagDtoList.map((t) => t.tag), ...(info.keywordList || [])])],\r\n            description: `${info.context}<br>${images}`,\r\n            image: `${info.coverFigureUrl}/200`,\r\n        };\r\n    });\r\n\r\n    const category = param.firstId ? indNavLists.find((item) => item.classId === param.firstId)?.className + ' - ' : '';\r\n    const subCategory = param.secondId ? secondNameFilter.find((item) => item.classId === param.secondId)?.className + ' - ' : '';\r\n    const tag = param.tagId ? tagList.find((item) => item.tagId === Number.parseInt(param.tagId))?.tag + ' - ' : '';\r\n\r\n    return {\r\n        title: `${category}${subCategory}${tag}中指报告`,\r\n        description: $('meta[name=\"description\"]').attr('content'),\r\n        image: `${baseUrl}/favicon.ico`,\r\n        lang: 'zh-CN',\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"iTAMA,MAAaA,EAAe,CACxB,KAAM,wBACN,WAAY,CAAC,WACb,QAAS,2CACT,WAAY,CAAE,OAAQ,4CACtB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,UACd,UACA,IAAK,kDACL,MAAO,CACH,CACI,OAAQ,CAAC,4CAKrB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,SAAS,qBAAwB,EAAI,IAAI,QAE3C,EAAU,4BACV,EAAa,GAAG,EAAQ,eAAe,IACvC,EAAW,MAAMC,EAAO,GAExB,EAAI,EAAK,GACT,EAAe,KAAK,MACtB,EAAE,+CACG,OACA,MAAM,8CAA8C,IAAM,MAE7D,CAAE,aAAY,cAAa,mBAAkB,UAAS,SAAU,EAAa,KAE7E,EAAQ,EAAW,kBAAkB,IAAK,GAAS,CACrD,IAAM,EAAY,EAAK,aAAe,EAAI,EAAI,EAAK,UAC/C,EAAS,GACb,IAAK,IAAI,EAAI,EAAG,GAAK,EAAW,IAC5B,GAAU,aAAa,EAAQ,2CAA2C,EAAK,SAAS,WAAW,EAAE,QAEzG,MAAO,CACH,MAAO,EAAK,YACZ,KAAM,GAAG,EAAQ,iBAAiB,EAAK,SAAS,OAChD,QAAS,EAAS,EAAU,EAAK,SAAU,GAC3C,SAAU,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,EAAK,sBAAsB,IAAK,GAAM,EAAE,KAAM,GAAI,EAAK,aAAe,MAChG,YAAa,GAAG,EAAK,QAAQ,MAAM,IACnC,MAAO,GAAG,EAAK,eAAe,SAIhC,EAAW,EAAM,QAAU,EAAY,KAAM,GAAS,EAAK,UAAY,EAAM,UAAU,UAAY,MAAQ,GAC3G,EAAc,EAAM,SAAW,EAAiB,KAAM,GAAS,EAAK,UAAY,EAAM,WAAW,UAAY,MAAQ,GACrH,EAAM,EAAM,MAAQ,EAAQ,KAAM,GAAS,EAAK,QAAU,OAAO,SAAS,EAAM,SAAS,IAAM,MAAQ,GAE7G,MAAO,CACH,MAAO,GAAG,IAAW,IAAc,EAAI,MACvC,YAAa,EAAE,4BAA4B,KAAK,WAChD,MAAO,GAAG,EAAQ,cAClB,KAAM,QACN,KAAM,EACN,KAAM"}