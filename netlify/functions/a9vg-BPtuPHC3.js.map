{"version":3,"file":"a9vg-BPtuPHC3.js","names":[],"sources":["../../lib/routes/a9vg/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = 'news/All' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 15;\r\n\r\n    const rootUrl = 'http://www.a9vg.com';\r\n    const currentUrl = new URL(`list/${category}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('a.a9-rich-card-list_item')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const image = item.find('img.a9-rich-card-list_image');\r\n            const title = item.find('div.a9-rich-card-list_label').text();\r\n\r\n            return {\r\n                title,\r\n                link: new URL(item.prop('href'), rootUrl).href,\r\n                description: art(path.join(__dirname, 'templates/description.art'), {\r\n                    images: image\r\n                        ? [\r\n                              {\r\n                                  src: image.prop('src'),\r\n                                  alt: title,\r\n                              },\r\n                          ]\r\n                        : undefined,\r\n                }),\r\n                pubDate: timezone(parseDate(item.find('div.a9-rich-card-list_infos').text()), +8),\r\n                language,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                $$('ignore_js_op img, p img').each((_, el) => {\r\n                    el = $$(el);\r\n\r\n                    el.parent().replaceWith(\r\n                        art(path.join(__dirname, 'templates/description.art'), {\r\n                            images: el.prop('file')\r\n                                ? [\r\n                                      {\r\n                                          src: el.prop('file'),\r\n                                          alt: el.next().find('div.xs0 p').first().text(),\r\n                                      },\r\n                                  ]\r\n                                : undefined,\r\n                        })\r\n                    );\r\n                });\r\n\r\n                item.title = $$('h1.ts, div.c-article-main_content-title').first().text();\r\n                item.description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    description: $$('td.t_f, div.c-article-main_contentraw').first().html(),\r\n                });\r\n                item.author =\r\n                    $$('b a.blue').first().text() ||\r\n                    $$(\r\n                        $$('span.c-article-main_content-intro-item')\r\n                            .toArray()\r\n                            .findLast((i) => $$(i).text().startsWith('作者'))\r\n                    )\r\n                        .text()\r\n                        .split(/：/)\r\n                        .pop();\r\n                item.pubDate = timezone(\r\n                    parseDate(\r\n                        $$('div.authi em')\r\n                            .first()\r\n                            .text()\r\n                            .trim()\r\n                            .match(/发表于 (\\d+-\\d+-\\d+ \\d+:\\d+)/)?.[1] ?? $$('span.c-article-main_content-intro-item').first().text(),\r\n                        ['YYYY-M-D HH:mm', 'YYYY-MM-DD HH:mm']\r\n                    ),\r\n                    +8\r\n                );\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const title = $('title').text();\r\n    const image = new URL('images/logo.1cee7c0f.svg', rootUrl).href;\r\n\r\n    return {\r\n        title,\r\n        description: $('meta[name=\"description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: title.split(/-/).pop(),\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category{.+}?',\r\n    name: '新闻',\r\n    url: 'a9vg.com',\r\n    maintainers: ['monnerHenster', 'nczitzk'],\r\n    handler,\r\n    example: '/a9vg/news',\r\n    parameters: { category: '分类，默认为 ，可在对应分类页 URL 中找到, Category, by default' },\r\n    description: `::: tip\r\n  若订阅 [PS4](http://www.a9vg.com/list/news/PS4)，网址为 \\`http://www.a9vg.com/list/news/PS4\\`。截取 \\`http://www.a9vg.com/list\\` 到末尾的部分 \\`news/PS4\\` 作为参数填入，此时路由为 [\\`/a9vg/news/PS4\\`](https://rsshub.app/a9vg/news/PS4)。\r\n:::\r\n\r\n| 分类                                               | ID                                                     |\r\n| -------------------------------------------------- | ------------------------------------------------------ |\r\n| [All](https://www.a9vg.com/list/news/All)          | [news/All](https://rsshub.app/a9vg/news/All)           |\r\n| [PS4](https://www.a9vg.com/list/news/PS4)          | [news/PS4](https://rsshub.app/a9vg/news/PS4)           |\r\n| [PS5](https://www.a9vg.com/list/news/PS5)          | [news/PS5](https://rsshub.app/a9vg/news/PS5)           |\r\n| [Switch](https://www.a9vg.com/list/news/Switch)    | [news/Switch](https://rsshub.app/a9vg/news/Switch)     |\r\n| [Xbox One](https://www.a9vg.com/list/news/XboxOne) | [news/XboxOne](https://rsshub.app/a9vg/news/XboxOne)   |\r\n| [XSX](https://www.a9vg.com/list/news/XSX)          | [news/XSX](https://rsshub.app/a9vg/news/XSX)           |\r\n| [PC](https://www.a9vg.com/list/news/PC)            | [news/PC](https://rsshub.app/a9vg/news/PC)             |\r\n| [业界](https://www.a9vg.com/list/news/Industry)    | [news/Industry](https://rsshub.app/a9vg/news/Industry) |\r\n| [厂商](https://www.a9vg.com/list/news/Factory)     | [news/Factory](https://rsshub.app/a9vg/news/Factory)   |\r\n  `,\r\n    categories: ['game'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.a9vg.com/list/:category'],\r\n            target: (params) => {\r\n                const category = params.category;\r\n\r\n                return category ? `/${category}` : '';\r\n            },\r\n        },\r\n        {\r\n            title: 'All',\r\n            source: ['www.a9vg.com/list/news/All'],\r\n            target: '/news/All',\r\n        },\r\n        {\r\n            title: 'PS4',\r\n            source: ['www.a9vg.com/list/news/PS4'],\r\n            target: '/news/PS4',\r\n        },\r\n        {\r\n            title: 'PS5',\r\n            source: ['www.a9vg.com/list/news/PS5'],\r\n            target: '/news/PS5',\r\n        },\r\n        {\r\n            title: 'Switch',\r\n            source: ['www.a9vg.com/list/news/Switch'],\r\n            target: '/news/Switch',\r\n        },\r\n        {\r\n            title: 'Xbox One',\r\n            source: ['www.a9vg.com/list/news/XboxOne'],\r\n            target: '/news/XboxOne',\r\n        },\r\n        {\r\n            title: 'XSX',\r\n            source: ['www.a9vg.com/list/news/XSX'],\r\n            target: '/news/XSX',\r\n        },\r\n        {\r\n            title: 'PC',\r\n            source: ['www.a9vg.com/list/news/PC'],\r\n            target: '/news/PC',\r\n        },\r\n        {\r\n            title: '业界',\r\n            source: ['www.a9vg.com/list/news/Industry'],\r\n            target: '/news/Industry',\r\n        },\r\n        {\r\n            title: '厂商',\r\n            source: ['www.a9vg.com/list/news/Factory'],\r\n            target: '/news/Factory',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}