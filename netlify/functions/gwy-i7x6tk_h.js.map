{"version":3,"file":"gwy-i7x6tk_h.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/gov/zhejiang/gwy.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/zhejiang/gwy/:category?/:column?',\r\n    categories: ['government'],\r\n    example: '/gov/zhejiang/gwy/1',\r\n    parameters: { category: '分类，见下表，默认为全部', column: '地市专栏，见下表，默认为全部' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['zjks.gov.cn/zjgwy/website/init.htm', 'zjks.gov.cn/zjgwy/website/queryDetail.htm', 'zjks.gov.cn/zjgwy/website/queryMore.htm'],\r\n            target: '/zhejiang/gwy',\r\n        },\r\n    ],\r\n    name: '通知',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    url: 'zjks.gov.cn/zjgwy/website/init.htm',\r\n    description: `| 分类         | id |\r\n| ------------ | -- |\r\n| 重要通知     | 1  |\r\n| 招考公告     | 2  |\r\n| 招考政策     | 3  |\r\n| 面试体检考察 | 4  |\r\n| 录用公示专栏 | 5  |\r\n\r\n| 地市         | id    |\r\n| ------------ | ----- |\r\n| 浙江省       | 133   |\r\n| 浙江省杭州市 | 13301 |\r\n| 浙江省宁波市 | 13302 |\r\n| 浙江省温州市 | 13303 |\r\n| 浙江省嘉兴市 | 13304 |\r\n| 浙江省湖州市 | 13305 |\r\n| 浙江省绍兴市 | 13306 |\r\n| 浙江省金华市 | 13307 |\r\n| 浙江省衢州市 | 13308 |\r\n| 浙江省舟山市 | 13309 |\r\n| 浙江省台州市 | 13310 |\r\n| 浙江省丽水市 | 13311 |\r\n| 省级单位     | 13317 |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category, column } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 50;\r\n\r\n    const rootUrl = 'http://gwy.zjks.gov.cn';\r\n    const currentUrl = new URL(`zjgwy/website/${category ? 'queryMore' : 'init'}.htm`, rootUrl).href;\r\n    const detailUrl = new URL('zjgwy/website/queryDetail.htm', rootUrl).href;\r\n\r\n    const { data: response } = await got.post(currentUrl, {\r\n        form: {\r\n            dsdm: column,\r\n            mkxh: category,\r\n            oldornew: 'new',\r\n        },\r\n    });\r\n\r\n    const $ = load(response);\r\n\r\n    let items = $('a[onclick^=\"queryDetail\"]')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const matches = item.prop('onclick').match(/queryDetail\\('?(\\d+)'?, '?(\\d+)'?\\);/);\r\n\r\n            return {\r\n                title: item.text(),\r\n                link: detailUrl,\r\n                category: matches[1],\r\n                guid: `zjks-${matches[1]}-${matches[2]}`,\r\n                pubDate: parseDate(item.parent().next().text()),\r\n                tzid: matches[2],\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.guid, async () => {\r\n                const { data: detailResponse } = await got.post(detailUrl, {\r\n                    form: {\r\n                        mkxh: item.category,\r\n                        oldornew: 'new',\r\n                        dsdm: column,\r\n                        tzid: item.tzid,\r\n                    },\r\n                });\r\n\r\n                const content = load(detailResponse);\r\n\r\n                item.description = content('div.ibox-content').last().html();\r\n                item.category = [content('div.ibox-title').last().find('h5').first().text()];\r\n\r\n                const files = content('a.ke-insertfile');\r\n\r\n                if (files.length > 0) {\r\n                    const file = files.first();\r\n                    item.enclosure_url = file.prop('href');\r\n                }\r\n\r\n                delete item.tzid;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const columnName = $('button.btn-success').last().text();\r\n    const categoryName = $('table').parent().prev().find('h5').text();\r\n\r\n    return {\r\n        item: items,\r\n        title: `${$('title').text()} - ${columnName}${categoryName}`,\r\n        link: currentUrl,\r\n        description: $('div.title-font2').text(),\r\n        subtitle: `${columnName}${categoryName}`,\r\n        author: $('div.title-font').text(),\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,oCACN,WAAY,CAAC,cACb,QAAS,sBACT,WAAY,CAAE,SAAU,eAAgB,OAAQ,kBAChD,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,qCAAsC,4CAA6C,2CAC5F,OAAQ,kBAGhB,KAAM,KACN,YAAa,CAAC,WACd,UACA,IAAK,qCACL,YAAa;;;;;;;;;;;;;;;;;;;;;;uBAyBjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAU,UAAW,EAAI,IAAI,QAC/B,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,yBACV,EAAa,IAAI,IAAI,iBAAiB,EAAW,YAAc,OAAO,MAAO,GAAS,KACtF,EAAY,IAAI,IAAI,gCAAiC,GAAS,KAE9D,CAAE,KAAM,GAAa,MAAMC,EAAI,KAAK,EAAY,CAClD,KAAM,CACF,KAAM,EACN,KAAM,EACN,SAAU,SAIZ,EAAI,EAAK,GAEX,EAAQ,EAAE,6BACT,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAU,EAAK,KAAK,WAAW,MAAM,wCAE3C,MAAO,CACH,MAAO,EAAK,OACZ,KAAM,EACN,SAAU,EAAQ,GAClB,KAAM,QAAQ,EAAQ,GAAG,GAAG,EAAQ,KACpC,QAAS,EAAU,EAAK,SAAS,OAAO,QACxC,KAAM,EAAQ,MAI1B,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAMD,EAAI,KAAK,EAAW,CACvD,KAAM,CACF,KAAM,EAAK,SACX,SAAU,MACV,KAAM,EACN,KAAM,EAAK,QAIb,EAAU,EAAK,GAErB,EAAK,YAAc,EAAQ,oBAAoB,OAAO,OACtD,EAAK,SAAW,CAAC,EAAQ,kBAAkB,OAAO,KAAK,MAAM,QAAQ,QAErE,IAAM,EAAQ,EAAQ,mBAEtB,GAAI,EAAM,OAAS,EAAG,CAClB,IAAM,EAAO,EAAM,QACnB,EAAK,cAAgB,EAAK,KAAK,QAKnC,OAFA,OAAO,EAAK,KAEL,MAKnB,IAAM,EAAa,EAAE,sBAAsB,OAAO,OAC5C,EAAe,EAAE,SAAS,SAAS,OAAO,KAAK,MAAM,OAE3D,MAAO,CACH,KAAM,EACN,MAAO,GAAG,EAAE,SAAS,OAAO,KAAK,IAAa,IAC9C,KAAM,EACN,YAAa,EAAE,mBAAmB,OAClC,SAAU,GAAG,IAAa,IAC1B,OAAQ,EAAE,kBAAkB,OAC5B,WAAY"}