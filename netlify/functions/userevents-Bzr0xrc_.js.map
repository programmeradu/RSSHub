{"version":3,"file":"userevents-Bzr0xrc_.js","names":[],"sources":["../../lib/routes/163/music/userevents.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport path from 'node:path';\r\nimport got from '@/utils/got';\r\nimport { art } from '@/utils/render';\r\nconst renderDescription = (info) => art(path.join(__dirname, '../templates/music/userevents.art'), info);\r\n\r\nexport const route: Route = {\r\n    path: '/music/user/events/:id',\r\n    categories: ['multimedia'],\r\n    name: '用户动态',\r\n    maintainers: ['Master-Hash'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n\r\n    const response = await got(`https://music.163.com/api/event/get/${id}`, {\r\n        headers: {\r\n            Referer: 'https://music.163.com/',\r\n        },\r\n    });\r\n\r\n    const { data } = response;\r\n    const { nickname, signature, avatarUrl } = data.events[0].user;\r\n\r\n    return {\r\n        title: `${nickname}的云村动态`,\r\n        link: `https://music.163.com/#/user/event?id=${id}`,\r\n        description: `网易云音乐用户动态 - ${signature}`,\r\n        icon: avatarUrl,\r\n        image: avatarUrl,\r\n        item: data.events.map((item) => {\r\n            const title = item.info.commentThread.resourceTitle;\r\n            const userId = item.user.userId;\r\n            const description = JSON.parse(item.json).msg;\r\n            const pics = item.pics.map(({ originUrl }) => originUrl);\r\n            const eventId = item.id;\r\n\r\n            /**\r\n             * @todo 根据 `item.info.commentThread.resourceInfo.eventType` 生成 Media\r\n             * 17 分享节目\r\n             * 18 分享单曲\r\n             * 19 分享专辑\r\n             * 35 空\r\n             * 因为我不需要，我就不写了。\r\n             * 因为 api 并没有 mp3 URL，生成 `media` 字段会有困难。\r\n             */\r\n            return {\r\n                title,\r\n                description: renderDescription({ description, pics }),\r\n                link: `https://music.163.com/#/event?id=${eventId}&uid=${userId}`,\r\n                pubDate: new Date(item.eventTime),\r\n                published: new Date(item.eventTime),\r\n                author: nickname,\r\n                upvotes: item.info.likedCount,\r\n                comments: item.info.commentCount,\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"gVAKA,MAAM,EAAqB,GAAS,EAAI,EAAA,KAAA,EAAA,qCAA2D,GAEtF,EAAe,CACxB,KAAM,yBACN,WAAY,CAAC,cACb,KAAM,OACN,YAAa,CAAC,eACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MAEnB,EAAW,MAAM,EAAI,uCAAuC,IAAM,CACpE,QAAS,CACL,QAAS,4BAIX,CAAE,QAAS,EACX,CAAE,WAAU,YAAW,aAAc,EAAK,OAAO,GAAG,KAE1D,MAAO,CACH,MAAO,GAAG,EAAS,OACnB,KAAM,yCAAyC,IAC/C,YAAa,eAAe,IAC5B,KAAM,EACN,MAAO,EACP,KAAM,EAAK,OAAO,IAAK,GAAS,CAC5B,IAAM,EAAQ,EAAK,KAAK,cAAc,cAChC,EAAS,EAAK,KAAK,OACnB,EAAc,KAAK,MAAM,EAAK,MAAM,IACpC,EAAO,EAAK,KAAK,KAAK,CAAE,eAAgB,GACxC,EAAU,EAAK,GAWrB,MAAO,CACH,QACA,YAAa,EAAkB,CAAE,cAAa,SAC9C,KAAM,oCAAoC,EAAQ,OAAO,IACzD,QAAS,IAAI,KAAK,EAAK,WACvB,UAAW,IAAI,KAAK,EAAK,WACzB,OAAQ,EACR,QAAS,EAAK,KAAK,WACnB,SAAU,EAAK,KAAK"}