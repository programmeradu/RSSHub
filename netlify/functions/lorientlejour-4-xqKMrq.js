import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{config as n}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as r}from"./cache-kimkMTWJ.js";import{art as i}from"./render-CxhTJIsl.js";import{parseDate as a}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as o}from"./got-CdvI2yKX.js";import{timezone as s}from"./timezone-BrNu6iXe.js";import c from"node:path";import{FetchError as l}from"ofetch";import{load as u}from"cheerio";t();const d=`3d5_f6A(S$G_FD=2S(Dr6%7BW_h37@rE`,f={path:`/:category?`,categories:[`traditional-media`],example:`/lorientlejour/977-lebanon`,parameters:{category:`Category from the last segment of the URL of the corresponding site, see below for more information, /977-Lebanon by default`},features:{requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1,requireConfig:[{name:`LORIENTLEJOUR_USERNAME`,optional:!0,description:`L'Orient-Le Jour/L'Orient Today Email or Username`},{name:`LORIENTLEJOUR_PASSWORD`,optional:!0,description:`L'Orient-Le Jour/L'Orient Today Password`},{name:`LORIENTLEJOUR_TOKEN`,optional:!0,description:`To obtain a token, log into L'Orient-Le Jour/L'Orient Today App and inspect the connection request to find the token parameter from the request URL`}]},name:`Category`,maintainers:[`quiniapiezoelectricity`],handler:m,description:`  ::: tip
For example, the path for the sites https://today.lorientlejour.com/section/977-lebanon and https://www.lorientlejour.com/rubrique/1-liban would be /lorientlejour/977-lebanon and /lorientlejour/1-liban respectively.
Multiple categories seperated by '|' is also supported, e.g. /lorientlejour/977-lebanon|1-liban.
:::`,radar:[{source:[`www.lorientlejour.com/*/:category`],target:`/:category`},{source:[`www.lorientlejour.com`],target:`/1-Liban`},{source:[`today.lorientlejour.com/*/:category`],target:`/:category`},{source:[`today.lorientlejour.com`],target:`/977-Lebanon`}]};async function p(e){let t=`https://www.lorientlejour.com/cmsapi/categories.php?key=${d}&action=view&categoryId=${e}`,i=await r.tryGet(t,async()=>await o({method:`get`,url:t}),n.cache.routeExpire,!1);return i.data.data[0]}async function m(t){let f=(t.req.param(`category`)??`977-Lebanon`).split(`|`).map(e=>e.match(/^(\d+)/i)[0]??e),m=t.req.query(`limit`)??25,h,g=await r.get(`lorientlejour:token`);if(g)h=g;else if(n.lorientlejour.token)h=n.lorientlejour.token,r.set(`lorientlejour:token`,h);else if(n.lorientlejour.username&&n.lorientlejour.password){let e=`https://www.lorientlejour.com/cmsapi/visitors.php?key=${d}&action=login&loginName=${n.lorientlejour.username}&password=${n.lorientlejour.password}`,t=await o(e);h=t.data.data.token,r.set(`lorientlejour:token`,h)}if(h)try{await o(`https://www.lorientlejour.com/cmsapi/visitors.php?key=${d}&action=login_token&token=${h}`)}catch(e){throw e instanceof l&&e.statusCode===403&&await r.set(`lorientlejour:token`,``),e}let _=`L'Orient Le Jour/L'Orient Today`,v=``,y=`https://www.lorientlejour.com`,b=``;if(f.length===1){let e=await p(f[0]);b=e.typeId.locale?e.typeId.locale:e.typeId.name===`English`?`en-US`:`fr-FR`,_=b===`en-US`?`L'Orient Today - ${e.name}`:`L'Orient Le Jour - ${e.name}`,v=e.description,y=e.url}let x=await Promise.all(f.map(async e=>{let t=await p(e);return t.children.map(e=>e.id)})),S=[...new Set([...f,...x.flat()])],C=`https://www.lorientlejour.com/cmsapi/content.php?text=clean&key=${d}&action=search&category=${encodeURIComponent(JSON.stringify(S))}&limit=${m}&text=false&page=1`;h&&(C+=`&token=${h}`);let w=await o(C),T=w.data.data.map(t=>{t.link=t.url,t.author=t.authors.map(e=>e.name).join(`, `),t.pubDate=s(a(t.firstPublished),3),t.updated=s(a(t.lastUpdate),3),t.category=t.categories.map(e=>e.name);let n=t.contents,r=u(n),o=r(`html`);return o.find(`.inline-embeded-article`).remove(),o.find(`.relatedArticles`).remove(),t.inline_attachments&&o.find(`.inlineImage`).each(function(){let e=r(this).attr(`src`),n=t.inline_attachments.find(t=>t.url===e);n&&n.description&&(r(this).wrap(`<figure></figure>`),r(this).after(`<figcaption>${n.description}</figcaption>`))}),t.description=i(c.join(e,`templates/description-1c937562.art`),{summary:t.summary,attachments:t.attachments,article:o.html()}),t});return{title:_,description:v,language:b,link:y,item:T}}export{f as route};
//# sourceMappingURL=lorientlejour-4-xqKMrq.js.map