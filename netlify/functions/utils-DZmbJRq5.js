import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import{got_default as a}from"./got-CdvI2yKX.js";import o from"node:path";t();const s=[`misskey.io`,`madost.one`,`mk.nixnet.social`],c=(t,n,a=!1)=>t.map(t=>{let c=t.renote&&Object.keys(t.renote).length>0,l=t.reply&&Object.keys(t.reply).length>0,u=c?t.renote:t,d=u.user.host??n,f=a?String(u.user.name):`${u.user.name} (${u.user.username}@${d})`,p=r(o.join(e,`templates/note-b6540f0d.art`),{text:u.text,files:u.files,reply:t.reply,site:n}),m=``;if(l&&t.reply){let e=t.reply.user.host??n,r=a?t.reply.user.name:`${t.reply.user.name} (${t.reply.user.username}@${e})`;m=`Reply to ${r}: "${u.text??``}"`}else m=c?`Renote: ${f}: "${u.text??``}"`:`${f}: "${u.text??``}"`;let h=u.id;if(c){let e=t.user.host??n,r=u.user.host??n;(e!==r||!s.includes(r))&&(h=t.id)}let g=`https://${d}/notes/${h}`,_=i(u.createdAt);return{title:m,description:p,pubDate:_,link:g,author:f}});async function l(e,t,{withRenotes:r=!1,mediaOnly:i=!1}){let o=`https://${t}/api/users/search-by-username-and-host`,s=`misskey_username/${t}/${e}`,c=await n.tryGet(s,async()=>{let n=await a({method:`post`,url:o,json:{username:e,host:t,detail:!0,limit:1}}),r=n.data.find(t=>t.username===e);if(!r)throw Error(`username ${e} not found`);return r}),l=c.id,u=c.avatarUrl,d=`https://${t}/api/users/notes`,f=await a({method:`post`,url:d,json:{userId:l,withChannelNotes:!0,withRenotes:r,withReplies:!i,withFiles:i,limit:10,offset:0}}),p=f.data;return{site:t,accountId:l,accountData:p,avatarUrl:u}}var u={parseNotes:c,getUserTimelineByUsername:l,allowSiteList:s};export{u as utils_default};
//# sourceMappingURL=utils-DZmbJRq5.js.map