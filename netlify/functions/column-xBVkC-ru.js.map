{"version":3,"file":"column-xBVkC-ru.js","names":[],"sources":["../../lib/routes/nmtv/column.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/column/:id?',\r\n    categories: ['traditional-media'],\r\n    example: '/nmtv/column/877',\r\n    parameters: { id: '栏目 id，可在对应栏目 URL 中找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '点播',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `::: tip\r\n  如 [蒙古语卫视新闻联播](http://www.nmtv.cn/folder292/folder663/folder301/folder830/folder877) 的 URL 为 \\`http://www.nmtv.cn/folder292/folder663/folder301/folder830/folder877\\`，其栏目 id 为末尾数字编号，即 \\`877\\`。可以得到其对应路由为 [\\`/nmtv/column/877\\`](https://rsshub.app/nmtv/column/877)\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id') ?? '877';\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 100;\r\n\r\n    const hostUrl = 'https://vod.m2oplus.nmtv.cn';\r\n    const apiRootUrl = 'https://mapi.m2oplus.nmtv.cn';\r\n    const apiUrl = `${apiRootUrl}/api/v1/contents.php?offset=0&count=${limit}&column_id=${id}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: apiUrl,\r\n    });\r\n\r\n    const data = response.data;\r\n\r\n    const items = data.map((item) => {\r\n        const enclosure_url = `${hostUrl}/${item.target_path}${item.target_filename}`;\r\n        const enclosure_type = `${item.type}/${enclosure_url.match(/\\.(\\w+)$/)[1]}`;\r\n\r\n        return {\r\n            title: item.title,\r\n            link: item.content_url,\r\n            author: item.column_name,\r\n            pubDate: timezone(parseDate(item.publish_time), +8),\r\n            description: art(path.join(__dirname, 'templates/description.art'), {\r\n                type: item.type,\r\n                image: item.index_pic,\r\n                file: enclosure_url,\r\n            }),\r\n            enclosure_url,\r\n            enclosure_type,\r\n            itunes_duration: item.video.duration,\r\n            itunes_item_image: item.index_pic,\r\n        };\r\n    });\r\n\r\n    const author = data[0].column_name;\r\n    const imageUrl = data[0].column_info.indexpic;\r\n\r\n    return {\r\n        title: `内蒙古广播电视台 - ${author}`,\r\n        link: items[0].link.split(/\\/\\d{4}-\\d{2}-\\d{2}\\//)[0],\r\n        item: items,\r\n        image: `${imageUrl.host}${imageUrl.filepath}${imageUrl.filename}`,\r\n        itunes_author: author,\r\n    };\r\n}\r\n"],"mappings":"ubAQA,MAAa,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,qBACb,QAAS,mBACT,WAAY,CAAE,GAAI,wBAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa,iRAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,OAAS,MAC5B,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAI3E,EAAS,mEAAoD,EAAM,aAAa,IAEhF,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAO,EAAS,KAEhB,EAAQ,EAAK,IAAK,GAAS,CAC7B,IAAM,EAAgB,+BAAc,EAAK,cAAc,EAAK,kBACtD,EAAiB,GAAG,EAAK,KAAK,GAAG,EAAc,MAAM,YAAY,KAEvE,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EAAK,YACX,OAAQ,EAAK,YACb,QAAS,EAAS,EAAU,EAAK,cAAe,GAChD,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,KAAM,EAAK,KACX,MAAO,EAAK,UACZ,KAAM,IAEV,gBACA,iBACA,gBAAiB,EAAK,MAAM,SAC5B,kBAAmB,EAAK,aAI1B,EAAS,EAAK,GAAG,YACjB,EAAW,EAAK,GAAG,YAAY,SAErC,MAAO,CACH,MAAO,cAAc,IACrB,KAAM,EAAM,GAAG,KAAK,MAAM,yBAAyB,GACnD,KAAM,EACN,MAAO,GAAG,EAAS,OAAO,EAAS,WAAW,EAAS,WACvD,cAAe"}