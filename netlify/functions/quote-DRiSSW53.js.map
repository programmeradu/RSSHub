{"version":3,"file":"quote-DRiSSW53.js","names":["route: Route","got"],"sources":["../../lib/routes/finviz/quote.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:ticker',\r\n    categories: ['finance'],\r\n    example: '/finviz/news/AAPL',\r\n    parameters: { ticker: 'The stock ticker' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'US Stock News',\r\n    maintainers: ['HenryQW'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const link = `https://finviz.com/quote.ashx?t=${ctx.req.param('ticker')}`;\r\n    const response = await got(link);\r\n\r\n    const $ = load(response.body);\r\n    const data = $('table.fullview-news-outer tr');\r\n\r\n    let dateRow = '';\r\n    const item = await Promise.all(\r\n        data.toArray().map((e) => {\r\n            let date = $(e).find('td').first().text().trim();\r\n            if (date.includes('-')) {\r\n                dateRow = date.split(' ')[0];\r\n            } else {\r\n                date = `${dateRow} ${date}`;\r\n            }\r\n            return {\r\n                title: $(e).find('a').text(),\r\n                pubDate: parseDate(date, 'MMM-DD-YY HH:mmA'),\r\n                author: $(e).find('span').text(),\r\n                link: $(e).find('a').attr('href'),\r\n            };\r\n        })\r\n    );\r\n\r\n    const name = $('.fullview-title b').text();\r\n\r\n    return {\r\n        title: `${ctx.req.param('ticker')} ${name} News by Finviz`,\r\n        link,\r\n        description: `A collection of ${name} news aggregated by Finviz.`,\r\n        item,\r\n    };\r\n}\r\n"],"mappings":"oTAKA,MAAaA,EAAe,CACxB,KAAM,gBACN,WAAY,CAAC,WACb,QAAS,oBACT,WAAY,CAAE,OAAQ,oBACtB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,gBACN,YAAa,CAAC,WACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,mCAAmC,EAAI,IAAI,MAAM,YACxD,EAAW,MAAMC,EAAI,GAErB,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,gCAEX,EAAU,GACR,EAAO,MAAM,QAAQ,IACvB,EAAK,UAAU,IAAK,GAAM,CACtB,IAAI,EAAO,EAAE,GAAG,KAAK,MAAM,QAAQ,OAAO,OAM1C,OALI,EAAK,SAAS,KACd,EAAU,EAAK,MAAM,KAAK,GAE1B,EAAO,GAAG,EAAQ,GAAG,IAElB,CACH,MAAO,EAAE,GAAG,KAAK,KAAK,OACtB,QAAS,EAAU,EAAM,oBACzB,OAAQ,EAAE,GAAG,KAAK,QAAQ,OAC1B,KAAM,EAAE,GAAG,KAAK,KAAK,KAAK,YAKhC,EAAO,EAAE,qBAAqB,OAEpC,MAAO,CACH,MAAO,GAAG,EAAI,IAAI,MAAM,UAAU,GAAG,EAAK,iBAC1C,OACA,YAAa,mBAAmB,EAAK,6BACrC"}