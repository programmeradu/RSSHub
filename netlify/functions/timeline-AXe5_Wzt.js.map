{"version":3,"file":"timeline-AXe5_Wzt.js","names":[],"sources":["../../lib/routes/cara/timeline.ts"],"sourcesContent":["import type { Data, DataItem, Route } from '@/types';\r\nimport type { PostsResponse } from './types';\r\nimport { customFetch, parseUserData } from './utils';\r\nimport { API_HOST, CDN_HOST, HOST } from './constant';\r\nimport { art } from '@/utils/render';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: ['/timeline/:user'],\r\n    categories: ['social-media'],\r\n    example: '/cara/timeline/fengz',\r\n    parameters: { user: 'username' },\r\n    name: 'Timeline',\r\n    maintainers: ['KarasuShin'],\r\n    handler,\r\n    radar: [\r\n        {\r\n            source: ['cara.app/:user', 'cara.app/:user/*'],\r\n            target: '/timeline/:user',\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler(ctx): Promise<Data> {\r\n    const user = ctx.req.param('user');\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 15;\r\n    const userInfo = await parseUserData(user);\r\n\r\n    const api = `${API_HOST}/posts/getAllByUser?slug=${userInfo.slug}&take=${limit}`;\r\n\r\n    const timelineResponse = await customFetch<PostsResponse>(api);\r\n\r\n    const items = timelineResponse.data.map((item) => {\r\n        const description = art(path.join(__dirname, 'templates/post.art'), {\r\n            content: item.content,\r\n            images: item.images.filter((i) => !i.isCoverImg).map((i) => ({ ...i, src: `${CDN_HOST}/${i.src}` })),\r\n        });\r\n        return {\r\n            title: item.title || item.content,\r\n            pubDate: parseDate(item.createdAt),\r\n            link: `${HOST}/post/${item.id}`,\r\n            description,\r\n        } as DataItem;\r\n    });\r\n\r\n    return {\r\n        title: `Timeline - ${userInfo.name}`,\r\n        link: `${HOST}/${user}/all`,\r\n        image: `${CDN_HOST}/${userInfo.photo}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"8bAQA,MAAa,EAAe,CACxB,KAAM,CAAC,mBACP,WAAY,CAAC,gBACb,QAAS,uBACT,WAAY,CAAE,KAAM,YACpB,KAAM,WACN,YAAa,CAAC,cACd,UACA,MAAO,CACH,CACI,OAAQ,CAAC,iBAAkB,oBAC3B,OAAQ,qBAKpB,eAAe,EAAQ,EAAoB,CACvC,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAC/E,EAAW,MAAM,EAAc,GAE/B,EAAM,GAAG,EAAS,2BAA2B,EAAS,KAAK,QAAQ,IAEnE,EAAmB,MAAM,EAA2B,GAEpD,EAAQ,EAAiB,KAAK,IAAK,GAAS,CAC9C,IAAM,EAAc,EAAI,EAAA,KAAA,EAAA,+BAA4C,CAChE,QAAS,EAAK,QACd,OAAQ,EAAK,OAAO,OAAQ,GAAM,CAAC,EAAE,YAAY,IAAK,IAAO,CAAE,GAAG,EAAG,IAAK,GAAG,EAAS,GAAG,EAAE,WAE/F,MAAO,CACH,MAAO,EAAK,OAAS,EAAK,QAC1B,QAAS,EAAU,EAAK,WACxB,KAAM,GAAG,EAAK,QAAQ,EAAK,KAC3B,iBAIR,MAAO,CACH,MAAO,cAAc,EAAS,OAC9B,KAAM,GAAG,EAAK,GAAG,EAAK,MACtB,MAAO,GAAG,EAAS,GAAG,EAAS,QAC/B,KAAM"}