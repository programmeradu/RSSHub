{"version":3,"file":"firmware-C6h5LalJ.js","names":["route: Route","got"],"sources":["../../lib/routes/miui/firmware/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport queryString from 'query-string';\r\n\r\nexport const route: Route = {\r\n    path: '/firmware/:device/:type?/:region?',\r\n    categories: ['program-update'],\r\n    example: '/miui/firmware/aries',\r\n    parameters: { device: 'the device `codename` eg. `aries` for Mi 2S', type: 'type', region: 'Region, default to `cn`' },\r\n    name: 'New firmware',\r\n    maintainers: ['Indexyz'],\r\n    description: `  | stable  | development |\r\n| ------- | ----------- |\r\n| release | dev         |\r\n\r\n| region | region |\r\n| ------ | ------ |\r\n| China  | cn     |\r\n| Global | global |`,\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { type = 'release', device, region = 'cn' } = ctx.req.param();\r\n    const releaseType = type === 'release' ? 'F' : 'X';\r\n    const localeTypeName = type === 'release' ? '稳定版' : '开发版';\r\n    const regionName = region === 'global' ? 'global' : 'cn';\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: 'http://update.miui.com/updates/miota-fullrom.php',\r\n        searchParams: queryString.stringify({\r\n            d: device,\r\n            b: releaseType,\r\n            r: regionName,\r\n            l: 'zh_CN',\r\n            n: '',\r\n        }),\r\n    });\r\n\r\n    const responseData = response.data;\r\n\r\n    return {\r\n        title: `MIUI 更新 - ${device} - ${type === 'release' ? '稳定版' : '开发版'}`,\r\n        link: 'http://www.miui.com/download.html',\r\n        item: [\r\n            {\r\n                title: `${device} 有新的 ${localeTypeName}本: ${responseData.LatestFullRom.version}`,\r\n                guid: responseData.LatestFullRom.md5,\r\n                description: responseData.LatestFullRom.filename,\r\n                link: responseData.LatestFullRom.descriptionUrl,\r\n            },\r\n        ],\r\n    };\r\n}\r\n"],"mappings":"4PAIA,MAAaA,EAAe,CACxB,KAAM,oCACN,WAAY,CAAC,kBACb,QAAS,uBACT,WAAY,CAAE,OAAQ,8CAA+C,KAAM,OAAQ,OAAQ,2BAC3F,KAAM,eACN,YAAa,CAAC,WACd,YAAa;;;;;;;qBAQb,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAO,UAAW,SAAQ,SAAS,MAAS,EAAI,IAAI,QACtD,EAAc,IAAS,UAAY,IAAM,IACzC,EAAiB,IAAS,UAAY,MAAQ,MAC9C,EAAa,IAAW,SAAW,SAAW,KAE9C,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,mDACL,aAAc,EAAY,UAAU,CAChC,EAAG,EACH,EAAG,EACH,EAAG,EACH,EAAG,QACH,EAAG,OAIL,EAAe,EAAS,KAE9B,MAAO,CACH,MAAO,aAAa,EAAO,KAAK,IAAS,UAAY,MAAQ,QAC7D,KAAM,oCACN,KAAM,CACF,CACI,MAAO,GAAG,EAAO,OAAO,EAAe,KAAK,EAAa,cAAc,UACvE,KAAM,EAAa,cAAc,IACjC,YAAa,EAAa,cAAc,SACxC,KAAM,EAAa,cAAc"}