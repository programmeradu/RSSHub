{"version":3,"file":"main-4U3QzzRe.js","names":["route: Route"],"sources":["../../lib/routes/nyaa/main.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { config } from '@/config';\r\nimport Parser from 'rss-parser';\r\n\r\nexport const route: Route = {\r\n    path: ['/search/:query?', '/user/:username?', '/user/:username/search/:query?', '/sukebei/search/:query?', '/sukebei/user/:username?', '/sukebei/user/:username/search/:query?'],\r\n    categories: ['multimedia'],\r\n    example: '/nyaa/search/psycho-pass',\r\n    parameters: { query: 'Search keyword' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: true,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Search Result',\r\n    maintainers: ['Lava-Swimmer', 'noname1776', 'camera-2018'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const parser = new Parser({\r\n        customFields: {\r\n            item: ['magnet', ['nyaa:infoHash', 'infoHash']],\r\n        },\r\n        headers: {\r\n            'User-Agent': config.ua,\r\n        },\r\n    });\r\n\r\n    const { query, username } = ctx.req.param();\r\n\r\n    const rootURL = ctx.req.path.split('/')[2] === 'sukebei' ? 'https://sukebei.nyaa.si' : 'https://nyaa.si';\r\n\r\n    let currentRSSURL = `${rootURL}/?page=rss`;\r\n    let currentLink = `${rootURL}/`;\r\n    if (username !== undefined) {\r\n        currentRSSURL = `${currentRSSURL}&u=${encodeURI(username)}`;\r\n        currentLink = `${currentLink}user/${encodeURI(username)}`;\r\n    }\r\n    if (query !== undefined) {\r\n        currentRSSURL = `${currentRSSURL}&q=${encodeURI(query)}`;\r\n        currentLink = `${currentLink}?q=${encodeURI(query)}`;\r\n    }\r\n\r\n    const feed = await parser.parseURL(currentRSSURL);\r\n\r\n    feed.items.map((item) => {\r\n        item.description = item.content;\r\n        item.enclosure_url = `magnet:?xt=urn:btih:${item.infoHash}`;\r\n        item.enclosure_type = 'application/x-bittorrent';\r\n        return item;\r\n    });\r\n\r\n    return {\r\n        title: feed.title,\r\n        link: currentLink,\r\n        description: feed.description,\r\n        item: feed.items,\r\n    };\r\n}\r\n"],"mappings":"wEAIA,MAAaA,EAAe,CACxB,KAAM,CAAC,kBAAmB,mBAAoB,iCAAkC,0BAA2B,2BAA4B,0CACvI,WAAY,CAAC,cACb,QAAS,2BACT,WAAY,CAAE,MAAO,kBACrB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,gBACN,YAAa,CAAC,eAAgB,aAAc,eAC5C,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,IAAI,EAAO,CACtB,aAAc,CACV,KAAM,CAAC,SAAU,CAAC,gBAAiB,cAEvC,QAAS,CACL,aAAc,EAAO,MAIvB,CAAE,QAAO,YAAa,EAAI,IAAI,QAE9B,EAAU,EAAI,IAAI,KAAK,MAAM,KAAK,KAAO,UAAY,0BAA4B,kBAEnF,EAAgB,GAAG,EAAQ,YAC3B,EAAc,GAAG,EAAQ,GACzB,IAAa,IAAA,KACb,EAAgB,GAAG,EAAc,KAAK,UAAU,KAChD,EAAc,GAAG,EAAY,OAAO,UAAU,MAE9C,IAAU,IAAA,KACV,EAAgB,GAAG,EAAc,KAAK,UAAU,KAChD,EAAc,GAAG,EAAY,KAAK,UAAU,MAGhD,IAAM,EAAO,MAAM,EAAO,SAAS,GASnC,OAPA,EAAK,MAAM,IAAK,IACZ,EAAK,YAAc,EAAK,QACxB,EAAK,cAAgB,uBAAuB,EAAK,WACjD,EAAK,eAAiB,2BACf,IAGJ,CACH,MAAO,EAAK,MACZ,KAAM,EACN,YAAa,EAAK,YAClB,KAAM,EAAK"}