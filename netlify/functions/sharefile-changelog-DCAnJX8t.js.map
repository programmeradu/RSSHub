{"version":3,"file":"sharefile-changelog-DCAnJX8t.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/steam/sharefile-changelog.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/sharefile-changelog/:sharefileID/:routeParams?',\r\n    categories: ['game'],\r\n    example: '/steam/sharefile-changelog/2851063440/l=schinese',\r\n    parameters: {\r\n        sharefileID: 'Steam community sharefile id. Usually refers to a workshop item.',\r\n        routeParams: 'Route parameters.',\r\n    },\r\n    radar: [\r\n        {\r\n            title: 'Sharefile Changelog',\r\n            source: ['steamcommunity.com/sharedfiles/filedetails/changelog/:sharefileID'],\r\n            target: '/sharefile-changelog/:sharefileID',\r\n        },\r\n    ],\r\n    description: `Steam Community Sharefile's Changelog. Primary used for a workshop item.\r\nHelpful route parameters:\r\n- \\`l=\\` language parameter, change the language of description.\r\n- \\`p=\\` page parameter, change the results page. p=1 by default.\r\n`,\r\n    name: 'Sharefile Changelog',\r\n    maintainers: ['NyaaaDoge'],\r\n\r\n    handler: async (ctx) => {\r\n        const { sharefileID, routeParams } = ctx.req.param();\r\n\r\n        const url = `https://steamcommunity.com/sharedfiles/filedetails/changelog/${sharefileID}${routeParams ? `?${routeParams}` : ''}`;\r\n        const response = await ofetch(url);\r\n        const $ = load(response);\r\n\r\n        const appName = $('div.apphub_AppName').first().text();\r\n        const appIcon = $('div.apphub_AppIcon').children('img').attr('src');\r\n        const itemTitle = $('div.workshopItemTitle').first().text();\r\n\r\n        const items = $('div.clearfix .changeLogCtn')\r\n            .toArray()\r\n            .map((item) => {\r\n                item = $(item);\r\n                // changelogHeadline is local time\r\n                const changelogHeadline = item.find('.headline').first().text();\r\n                const changelogTimestamp = item.find('p').first().attr('id');\r\n                const changeDetail = item.find('p').first().html();\r\n\r\n                return {\r\n                    title: changelogHeadline,\r\n                    link: `https://steamcommunity.com/sharedfiles/filedetails/changelog/${sharefileID}`,\r\n                    description: changeDetail,\r\n                    pubDate: parseDate(changelogTimestamp, 'X'),\r\n                };\r\n            });\r\n\r\n        return {\r\n            title: itemTitle,\r\n            link: `https://steamcommunity.com/sharedfiles/filedetails/changelog/${sharefileID}`,\r\n            description: `${appName} steam community sharefile changelog`,\r\n            item: items,\r\n            icon: appIcon,\r\n        };\r\n    },\r\n};\r\n"],"mappings":"+PAKA,MAAaA,EAAe,CACxB,KAAM,kDACN,WAAY,CAAC,QACb,QAAS,mDACT,WAAY,CACR,YAAa,mEACb,YAAa,qBAEjB,MAAO,CACH,CACI,MAAO,sBACP,OAAQ,CAAC,qEACT,OAAQ,sCAGhB,YAAa;;;;EAKb,KAAM,sBACN,YAAa,CAAC,aAEd,QAAS,KAAO,IAAQ,CACpB,GAAM,CAAE,cAAa,eAAgB,EAAI,IAAI,QAEvC,EAAM,gEAAgE,IAAc,EAAc,IAAI,IAAgB,KACtH,EAAW,MAAMC,EAAO,GACxB,EAAI,EAAK,GAET,EAAU,EAAE,sBAAsB,QAAQ,OAC1C,EAAU,EAAE,sBAAsB,SAAS,OAAO,KAAK,OACvD,EAAY,EAAE,yBAAyB,QAAQ,OAE/C,EAAQ,EAAE,8BACX,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAoB,EAAK,KAAK,aAAa,QAAQ,OACnD,EAAqB,EAAK,KAAK,KAAK,QAAQ,KAAK,MACjD,EAAe,EAAK,KAAK,KAAK,QAAQ,OAE5C,MAAO,CACH,MAAO,EACP,KAAM,gEAAgE,IACtE,YAAa,EACb,QAAS,EAAU,EAAoB,QAInD,MAAO,CACH,MAAO,EACP,KAAM,gEAAgE,IACtE,YAAa,GAAG,EAAQ,sCACxB,KAAM,EACN,KAAM"}