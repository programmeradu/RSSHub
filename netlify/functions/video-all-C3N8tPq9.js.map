{"version":3,"file":"video-all-C3N8tPq9.js","names":["route: Route","cache","utils","got","cookie","params"],"sources":["../../lib/routes/bilibili/video-all.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport cache from './cache';\r\nimport utils from './utils';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/user/video-all/:uid/:embed?',\r\n    name: '用户所有视频',\r\n    maintainers: [],\r\n    handler,\r\n    example: '/bilibili/user/video-all/2267573',\r\n    parameters: {\r\n        uid: '用户 id, 可在 UP 主主页中找到',\r\n        embed: '默认为开启内嵌视频, 任意值为关闭',\r\n    },\r\n    categories: ['social-media'],\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const uid = ctx.req.param('uid');\r\n    const embed = !ctx.req.param('embed');\r\n    const cookie = await cache.getCookie();\r\n    const wbiVerifyString = await cache.getWbiVerifyString();\r\n    const dmImgList = utils.getDmImgList();\r\n    const [name, face] = await cache.getUsernameAndFaceFromUID(uid);\r\n\r\n    await got(`https://space.bilibili.com/${uid}/video?tid=0&page=1&keyword=&order=pubdate`, {\r\n        headers: {\r\n            Referer: `https://space.bilibili.com/${uid}/`,\r\n            Cookie: cookie,\r\n        },\r\n    });\r\n    const params = utils.addWbiVerifyInfo(utils.addDmVerifyInfo(`mid=${uid}&ps=30&tid=0&pn=1&keyword=&order=pubdate&platform=web&web_location=1550101&order_avoided=true`, dmImgList), wbiVerifyString);\r\n    const response = await got(`https://api.bilibili.com/x/space/wbi/arc/search?${params}`, {\r\n        headers: {\r\n            Referer: `https://space.bilibili.com/${uid}/video?tid=0&page=1&keyword=&order=pubdate`,\r\n            Cookie: cookie,\r\n        },\r\n    });\r\n\r\n    const vlist = [...response.data.data.list.vlist];\r\n    const pageTotal = Math.ceil(response.data.data.page.count / response.data.data.page.ps);\r\n\r\n    const getPage = async (pageId) => {\r\n        const cookie = await cache.getCookie();\r\n        await got(`https://space.bilibili.com/${uid}/video?tid=0&page=${pageId}&keyword=&order=pubdate`, {\r\n            headers: {\r\n                Referer: `https://space.bilibili.com/${uid}/`,\r\n                Cookie: cookie,\r\n            },\r\n        });\r\n        const params = utils.addWbiVerifyInfo(utils.addDmVerifyInfo(`mid=${uid}&ps=30&tid=0&pn=${pageId}&keyword=&order=pubdate&platform=web&web_location=1550101&order_avoided=true`, dmImgList), wbiVerifyString);\r\n        return got(`https://api.bilibili.com/x/space/wbi/arc/search?${params}`, {\r\n            headers: {\r\n                Referer: `https://space.bilibili.com/${uid}/video?tid=0&page=${pageId}&keyword=&order=pubdate`,\r\n                Cookie: cookie,\r\n            },\r\n        });\r\n    };\r\n\r\n    const promises = [];\r\n\r\n    if (pageTotal > 1) {\r\n        for (let i = 2; i <= pageTotal; i++) {\r\n            promises.push(getPage(i));\r\n        }\r\n        const rets = await Promise.all(promises);\r\n        for (const ret of rets) {\r\n            vlist.push(...ret.data.data.list.vlist);\r\n        }\r\n    }\r\n\r\n    return {\r\n        title: name,\r\n        link: `https://space.bilibili.com/${uid}/video`,\r\n        description: `${name} 的 bilibili 所有视频`,\r\n        logo: face,\r\n        icon: face,\r\n        item: vlist.map((item) => ({\r\n            title: item.title,\r\n            description: utils.renderUGCDescription(embed, item.pic, item.description, item.aid, undefined, item.bvid),\r\n            pubDate: parseDate(item.created, 'X'),\r\n            link: item.created > utils.bvidTime && item.bvid ? `https://www.bilibili.com/video/${item.bvid}` : `https://www.bilibili.com/video/av${item.aid}`,\r\n            author: name,\r\n            comments: item.comment,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"4gBAMA,MAAaA,EAAe,CACxB,KAAM,+BACN,KAAM,SACN,YAAa,GACb,UACA,QAAS,mCACT,WAAY,CACR,IAAK,sBACL,MAAO,qBAEX,WAAY,CAAC,iBAGjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,EAAI,IAAI,MAAM,OACpB,EAAQ,CAAC,EAAI,IAAI,MAAM,SACvB,EAAS,MAAMC,EAAM,YACrB,EAAkB,MAAMA,EAAM,qBAC9B,EAAYC,EAAM,eAClB,CAAC,EAAM,GAAQ,MAAMD,EAAM,0BAA0B,GAE3D,MAAME,EAAI,8BAA8B,EAAI,4CAA6C,CACrF,QAAS,CACL,QAAS,8BAA8B,EAAI,GAC3C,OAAQ,KAGhB,IAAM,EAASD,EAAM,iBAAiBA,EAAM,gBAAgB,OAAO,EAAI,+FAAgG,GAAY,GAC7K,EAAW,MAAMC,EAAI,mDAAmD,IAAU,CACpF,QAAS,CACL,QAAS,8BAA8B,EAAI,4CAC3C,OAAQ,KAIV,EAAQ,CAAC,GAAG,EAAS,KAAK,KAAK,KAAK,OACpC,EAAY,KAAK,KAAK,EAAS,KAAK,KAAK,KAAK,MAAQ,EAAS,KAAK,KAAK,KAAK,IAE9E,EAAU,KAAO,IAAW,CAC9B,IAAMC,EAAS,MAAMH,EAAM,YAC3B,MAAME,EAAI,8BAA8B,EAAI,oBAAoB,EAAO,yBAA0B,CAC7F,QAAS,CACL,QAAS,8BAA8B,EAAI,GAC3C,OAAQC,KAGhB,IAAMC,EAASH,EAAM,iBAAiBA,EAAM,gBAAgB,OAAO,EAAI,kBAAkB,EAAO,8EAA+E,GAAY,GAC3L,OAAOC,EAAI,mDAAmDE,IAAU,CACpE,QAAS,CACL,QAAS,8BAA8B,EAAI,oBAAoB,EAAO,yBACtE,OAAQD,MAKd,EAAW,GAEjB,GAAI,EAAY,EAAG,CACf,IAAK,IAAI,EAAI,EAAG,GAAK,EAAW,IAC5B,EAAS,KAAK,EAAQ,IAE1B,IAAM,EAAO,MAAM,QAAQ,IAAI,GAC/B,IAAK,IAAM,KAAO,EACd,EAAM,KAAK,GAAG,EAAI,KAAK,KAAK,KAAK,OAIzC,MAAO,CACH,MAAO,EACP,KAAM,8BAA8B,EAAI,QACxC,YAAa,GAAG,EAAK,kBACrB,KAAM,EACN,KAAM,EACN,KAAM,EAAM,IAAK,IAAU,CACvB,MAAO,EAAK,MACZ,YAAaF,EAAM,qBAAqB,EAAO,EAAK,IAAK,EAAK,YAAa,EAAK,IAAK,IAAA,GAAW,EAAK,MACrG,QAAS,EAAU,EAAK,QAAS,KACjC,KAAM,EAAK,QAAUA,EAAM,UAAY,EAAK,KAAO,kCAAkC,EAAK,OAAS,oCAAoC,EAAK,MAC5I,OAAQ,EACR,SAAU,EAAK"}