{"version":3,"file":"ff14-global-D9tPzt2Q.js","names":[],"sources":["../../lib/routes/ff14/ff14-global.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { isValidHost } from '@/utils/valid-host';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: ['/global/:lang/:type?', '/ff14_global/:lang/:type?'],\r\n    categories: ['game'],\r\n    example: '/ff14/global/na/all',\r\n    parameters: { lang: 'Region', type: 'Category, `all` by default' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'FINAL FANTASY XIV (The Lodestone)',\r\n    maintainers: ['kmod-midori'],\r\n    handler,\r\n    description: `Region\r\n\r\n| North Ameria | Europe | France | Germany | Japan |\r\n| ------------ | ------ | ------ | ------- | ----- |\r\n| na           | eu     | fr     | de      | jp    |\r\n\r\n  Category\r\n\r\n| all | topics | notices | maintenance | updates | status | developers |\r\n| --- | ------ | ------- | ----------- | ------- | ------ | ---------- |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const lang = ctx.req.param('lang');\r\n    const type = ctx.req.param('type') ?? 'all';\r\n\r\n    if (!isValidHost(lang)) {\r\n        throw new InvalidParameterError('Invalid lang');\r\n    }\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `https://lodestonenews.com/news/${type}?locale=${lang}`,\r\n    });\r\n\r\n    let data;\r\n    if (type === 'all') {\r\n        data = [];\r\n        for (const arr of Object.values(response.data)) {\r\n            data = [...data, ...arr];\r\n        }\r\n    } else {\r\n        data = response.data;\r\n    }\r\n\r\n    return {\r\n        title: `FFXIV Lodestone updates (${type})`,\r\n        link: `https://${lang}.finalfantasyxiv.com/lodestone/news/`,\r\n        item: data.map(({ id, url, title, time, description, image }) => ({\r\n            title,\r\n            link: url,\r\n            description: art(path.join(__dirname, 'templates/description.art'), {\r\n                image,\r\n                description,\r\n            }),\r\n            pubDate: parseDate(time),\r\n            guid: id,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"wgBASA,MAAa,EAAe,CACxB,KAAM,CAAC,uBAAwB,6BAC/B,WAAY,CAAC,QACb,QAAS,sBACT,WAAY,CAAE,KAAM,SAAU,KAAM,8BACpC,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,oCACN,YAAa,CAAC,eACd,UACA,YAAa;;;;;;;;;2EAYjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAO,EAAI,IAAI,MAAM,SAAW,MAEtC,GAAI,CAAC,EAAY,GACb,MAAM,IAAI,EAAsB,gBAGpC,IAAM,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,kCAAkC,EAAK,UAAU,MAGtD,EACJ,GAAI,IAAS,MAAO,CAChB,EAAO,GACP,IAAK,IAAM,KAAO,OAAO,OAAO,EAAS,MACrC,EAAO,CAAC,GAAG,EAAM,GAAG,QAGxB,EAAO,EAAS,KAGpB,MAAO,CACH,MAAO,4BAA4B,EAAK,GACxC,KAAM,WAAW,EAAK,sCACtB,KAAM,EAAK,KAAK,CAAE,KAAI,MAAK,QAAO,OAAM,cAAa,YAAa,CAC9D,QACA,KAAM,EACN,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,QACA,gBAEJ,QAAS,EAAU,GACnB,KAAM"}