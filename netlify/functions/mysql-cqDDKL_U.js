import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{ofetch_default as n}from"./ofetch-Bzt0BXUH.js";import{ViewType as r}from"./types-A5bA50Mg.js";import{load as i}from"cheerio";const a=async r=>{let a=Number.parseInt(r.req.query(`limit`)??`30`,10),o=`http://mysql.taobao.org`,s=new URL(`monthly/`,o).href,c=await n(s),l=i(c),u=l(`html`).attr(`lang`)??`zh`,d=[],f=0;d=await Promise.all(l(`h3 a.main`).toArray().map(async e=>{let r=l(e),s=r.attr(`href`)?new URL(r.attr(`href`),o).href:void 0;if(!s)return;let c=await n(s),d=i(c);return d(`h3 a.main`).toArray().map(e=>{if(f<a){let n=d(e),r=n.text(),i=n.attr(`href`),a=i?.split(/monthly\//).pop(),s=a,c={title:r,pubDate:a?t(a):void 0,link:i?new URL(i,o).href:void 0,updated:s?t(s):void 0,language:u};return f++,c}}).filter(Boolean)})),d=await Promise.all(d.filter(Boolean).flat().slice(0,a).map(r=>r.link?e.tryGet(r.link,async()=>{let e=await n(r.link),a=i(e),o=a(`h2`).first().text()?.trim()||r.title,s=a(`div.content`).html()??void 0,c=r.link.split(/monthly\//).pop(),l=a(`div.block p`).toArray(),d=l.map(e=>{let t=a(e);return{name:t.text().split(/:/).pop()?.trim()??``,url:void 0,avatar:void 0}}),f=c,p={title:o,description:s,pubDate:c?t(c):r.pubDate,author:d,content:{html:s,text:s},updated:f?t(f):r.updated,language:u};return{...r,...p}}):r));let p=l(`title`).text();return{title:p,description:l(`meta[name="description"]`).attr(`content`),link:s,item:d,allowEmpty:!0,author:p,language:u,id:s}},o={path:`/mysql/monthly`,name:`数据库内核月报`,url:`mysql.taobao.org`,maintainers:[`nczitzk`],handler:a,example:`/taobao/mysql/monthly`,parameters:void 0,description:void 0,categories:[`programming`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`mysql.taobao.org/monthly/`],target:`/mysql/monthly`}],view:r.Articles};export{a as handler,o as route};
//# sourceMappingURL=mysql-cqDDKL_U.js.map