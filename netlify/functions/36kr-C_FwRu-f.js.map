{"version":3,"file":"36kr-C_FwRu-f.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/36kr/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { getSubPath } from '@/utils/common-utils';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { rootUrl, ProcessItem } from './utils';\r\n\r\nconst shortcuts = {\r\n    '/information': '/information/web_news',\r\n    '/information/latest': '/information/web_news',\r\n    '/information/recommend': '/information/web_recommend',\r\n    '/information/life': '/information/happy_life',\r\n    '/information/estate': '/information/real_estate',\r\n    '/information/workplace': '/information/web_zhichang',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category/:subCategory?/:keyword?',\r\n    categories: ['new-media'],\r\n    example: '/36kr/newsflashes',\r\n    parameters: {\r\n        category: '分类，必填项',\r\n        subCategory: '子分类，选填项，目的是为了兼容老逻辑',\r\n        keyword: '关键词，选填项，仅搜索文章/快讯时有效',\r\n    },\r\n    name: '资讯, 快讯, 用户文章, 主题文章, 专题文章, 搜索文章, 搜索快讯',\r\n    maintainers: ['nczitzk', 'fashioncj'],\r\n    description: `| 最新资讯频道 | 快讯 | 推荐资讯 | 生活 | 房产 | 职场 | 搜索文章 | 搜索快讯 |\r\n| ------- | -------- | -------- | -------- | -------- | --------| -------- | -------- |\r\n| news | newsflashes | recommend | life | estate | workplace | search/articles/关键词 | search/articles/关键词 |`,\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const path = getSubPath(ctx)\r\n        .replace(/^\\/news(?!flashes)/, '/information')\r\n        .replace(/\\/search\\/article/, '/search/articles');\r\n\r\n    const currentUrl = `${rootUrl}${Object.hasOwn(shortcuts, path) ? shortcuts[path] : path}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    const data = JSON.parse(response.data.match(/\"itemList\":(\\[.*?])/)[1]);\r\n\r\n    let items = data\r\n        .slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 30)\r\n        .filter((item) => item.itemType !== 0)\r\n        .map((item) => {\r\n            item = item.templateMaterial ?? item;\r\n            return {\r\n                title: item.widgetTitle.replaceAll(/<\\/?em>/g, ''),\r\n                author: item.author,\r\n                pubDate: parseDate(item.publishTime),\r\n                link: `${rootUrl}/${path === '/newsflashes' ? 'newsflashes' : 'p'}/${item.itemId}`,\r\n                description: item.widgetContent ?? item.content,\r\n            };\r\n        });\r\n\r\n    if (!/^\\/(search|newsflashes)/.test(path)) {\r\n        items = await Promise.all(items.map((item) => ProcessItem(item, cache.tryGet)));\r\n    }\r\n\r\n    return {\r\n        title: `36氪 - ${$('title').text().split('_')[0]}`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"+dASA,MAAM,EAAY,CACd,eAAgB,wBAChB,sBAAuB,wBACvB,yBAA0B,6BAC1B,oBAAqB,0BACrB,sBAAuB,2BACvB,yBAA0B,6BAGjBA,EAAe,CACxB,KAAM,qCACN,WAAY,CAAC,aACb,QAAS,oBACT,WAAY,CACR,SAAU,SACV,YAAa,qBACb,QAAS,uBAEb,KAAM,uCACN,YAAa,CAAC,UAAW,aACzB,YAAa;;4GAGb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAW,GACnB,QAAQ,qBAAsB,gBAC9B,QAAQ,oBAAqB,oBAE5B,EAAa,GAAG,IAAU,OAAO,OAAO,EAAW,GAAQ,EAAU,GAAQ,IAE7E,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAElB,EAAO,KAAK,MAAM,EAAS,KAAK,MAAM,uBAAuB,IAE/D,EAAQ,EACP,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAC5E,OAAQ,GAAS,EAAK,WAAa,GACnC,IAAK,IACF,EAAO,EAAK,kBAAoB,EACzB,CACH,MAAO,EAAK,YAAY,WAAW,WAAY,IAC/C,OAAQ,EAAK,OACb,QAAS,EAAU,EAAK,aACxB,KAAM,GAAG,EAAQ,GAAG,IAAS,eAAiB,cAAgB,IAAI,GAAG,EAAK,SAC1E,YAAa,EAAK,eAAiB,EAAK,WAQpD,MAJK,0BAA0B,KAAK,KAChC,EAAQ,MAAM,QAAQ,IAAI,EAAM,IAAK,GAAS,EAAY,EAAMC,EAAM,WAGnE,CACH,MAAO,SAAS,EAAE,SAAS,OAAO,MAAM,KAAK,KAC7C,KAAM,EACN,KAAM"}