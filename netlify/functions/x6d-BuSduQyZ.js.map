{"version":3,"file":"x6d-BuSduQyZ.js","names":["route: Route","got","cache","image"],"sources":["../../lib/routes/x6d/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/:id?',\r\n    name: '分类',\r\n    url: 'xd.x6d.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/x6d/34',\r\n    parameters: { id: '分类 id，可在对应分类页面的 URL 中找到，默认为首页最近更新' },\r\n    description: `| 技巧分享 | QQ 技巧 | 微信技巧 | 其他教程 | 其他分享 |\r\n| -------- | ------- | -------- | -------- | -------- |\r\n| 31       | 55      | 112      | 33       | 88       |\r\n\r\n| 宅家自学 | 健身养生 | 摄影剪辑 | 长点知识 | 自我提升 | 两性相关 | 编程办公 | 职场关系 | 新媒体运营 | 其他教程 |\r\n| -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | ---------- | -------- |\r\n| 18       | 98       | 94       | 93       | 99       | 100      | 21       | 22       | 19         | 44       |\r\n\r\n| 活动线报 | 流量话费 | 免费会员 | 实物活动 | 游戏活动 | 红包活动 | 空间域名 | 其他活动 |\r\n| -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |\r\n| 34       | 35       | 91       | 92       | 39       | 38       | 37       | 36       |\r\n\r\n| 值得一看 | 找点乐子 | 热门事件 | 节目推荐 |\r\n| -------- | -------- | -------- | -------- |\r\n| 65       | 50       | 77       | 101      |\r\n\r\n| 值得一听 | 每日一听 | 歌单推荐 |\r\n| -------- | -------- | -------- |\r\n| 71       | 87       | 79       |\r\n\r\n| 资源宝库 | 书籍资料 | 设计资源 | 剪辑资源 | 办公资源 | 壁纸资源 | 编程资源 |\r\n| -------- | -------- | -------- | -------- | -------- | -------- | -------- |\r\n| 106      | 107      | 108      | 109      | 110      | 111      | 113      |`,\r\n    categories: ['new-media'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n};\r\n\r\nexport async function handler(ctx) {\r\n    const { id = 'latest' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 22;\r\n\r\n    const rootUrl = 'https://xd.x6d.com';\r\n\r\n    let currentUrl = new URL(id === 'latest' ? '' : `html/${id}.html`, rootUrl).href;\r\n\r\n    const { data: firstResponse } = await got(currentUrl);\r\n\r\n    let $;\r\n\r\n    if (/<meta\\s/.test(firstResponse)) {\r\n        $ = load(firstResponse);\r\n    } else {\r\n        currentUrl = new URL(\r\n            id === 'latest'\r\n                ? ''\r\n                : firstResponse\r\n                      .match(/'([\\w./=?]+)'/g)\r\n                      .toReversed()\r\n                      .join('')\r\n                      .replaceAll(\"'\", ''),\r\n            rootUrl\r\n        ).href;\r\n\r\n        const { data: response } = await got(currentUrl);\r\n\r\n        $ = load(response);\r\n    }\r\n\r\n    $('i.rj').remove();\r\n\r\n    const language = 'zh';\r\n\r\n    const query = id === 'latest' ? $('#newslist ul').first().find('li').not('li.addd').find('a').slice(0, limit) : $('a.soft-title').slice(0, limit);\r\n\r\n    let items = query.toArray().map((item) => {\r\n        item = $(item);\r\n\r\n        return {\r\n            title: item.prop('title') ?? item.text(),\r\n            link: new URL(item.prop('href'), rootUrl).href,\r\n            language,\r\n        };\r\n    });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const title = $$('h1.article-title').text();\r\n                const description = $$('div.article-content').html();\r\n                const image = new URL($$('div.article-content img').first().prop('src'), rootUrl).href;\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = timezone(parseDate($$('time').text()), +8);\r\n                item.category = $$('b.bq-wg')\r\n                    .toArray()\r\n                    .map((c) => $$(c).text());\r\n                item.author = $$('span.bq-zz').text();\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.article-content').text(),\r\n                };\r\n                item.image = image;\r\n                item.banner = image;\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('div.header-logo img').prop('src'), rootUrl).href;\r\n\r\n    return {\r\n        title: $('title').text().split(/\\s-/)[0],\r\n        description: $('meta[name=\"description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        language,\r\n    };\r\n}\r\n"],"mappings":"0ZAQA,MAAaA,EAAe,CACxB,KAAM,QACN,KAAM,KACN,IAAK,aACL,YAAa,CAAC,WACd,UACA,QAAS,UACT,WAAY,CAAE,GAAI,qCAClB,YAAa;;;;;;;;;;;;;;;;;;;;;;gFAuBb,WAAY,CAAC,aAEb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,KAIvB,eAAsB,EAAQ,EAAK,CAC/B,GAAM,CAAE,KAAK,UAAa,EAAI,IAAI,QAC5B,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,qBAEZ,EAAa,IAAI,IAAI,IAAO,SAAW,GAAK,QAAQ,EAAG,OAAQ,GAAS,KAEtE,CAAE,KAAM,GAAkB,MAAMC,EAAI,GAEtC,EAEJ,GAAI,UAAU,KAAK,GACf,EAAI,EAAK,OACN,CACH,EAAa,IAAI,IACb,IAAO,SACD,GACA,EACK,MAAM,kBACN,aACA,KAAK,IACL,WAAW,IAAK,IAC3B,GACF,KAEF,GAAM,CAAE,KAAM,GAAa,MAAMA,EAAI,GAErC,EAAI,EAAK,GAGb,EAAE,QAAQ,SAEV,IAEM,EAAQ,IAAO,SAAW,EAAE,gBAAgB,QAAQ,KAAK,MAAM,IAAI,WAAW,KAAK,KAAK,MAAM,EAAG,GAAS,EAAE,gBAAgB,MAAM,EAAG,GAEvI,EAAQ,EAAM,UAAU,IAAK,IAC7B,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,KAAK,UAAY,EAAK,OAClC,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAS,KAC1C,iBAIR,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAMD,EAAI,EAAK,MAE1C,EAAK,EAAK,GAEV,EAAQ,EAAG,oBAAoB,OAC/B,EAAc,EAAG,uBAAuB,OACxCE,EAAQ,IAAI,IAAI,EAAG,2BAA2B,QAAQ,KAAK,OAAQ,GAAS,KAiBlF,MAfA,GAAK,MAAQ,EACb,EAAK,YAAc,EACnB,EAAK,QAAU,EAAS,EAAU,EAAG,QAAQ,QAAS,GACtD,EAAK,SAAW,EAAG,WACd,UACA,IAAK,GAAM,EAAG,GAAG,QACtB,EAAK,OAAS,EAAG,cAAc,OAC/B,EAAK,QAAU,CACX,KAAM,EACN,KAAM,EAAG,uBAAuB,QAEpC,EAAK,MAAQA,EACb,EAAK,OAASA,EACd,EAAK,SAAW,KAET,MAKnB,IAAM,EAAQ,IAAI,IAAI,EAAE,uBAAuB,KAAK,OAAQ,GAAS,KAErE,MAAO,CACH,MAAO,EAAE,SAAS,OAAO,MAAM,OAAO,GACtC,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,EACN,KAAM,EACN,WAAY,GACZ,QACA"}