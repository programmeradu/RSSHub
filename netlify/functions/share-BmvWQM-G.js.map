{"version":3,"file":"share-BmvWQM-G.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/dingshao/share.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport type { Context } from 'hono';\r\nimport { Value } from './types';\r\n\r\nexport const route: Route = {\r\n    path: '/share/:shortId',\r\n    categories: ['other'],\r\n    example: '/dingshao/share/FzFypN',\r\n    parameters: {\r\n        shortId: '频道 ID',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.dingshao.cn/share/:shortId'],\r\n        },\r\n    ],\r\n    name: '频道',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nconst baseUrl = 'https://www.dingshao.cn';\r\n\r\nasync function handler(ctx: Context) {\r\n    const { shortId } = ctx.req.param();\r\n\r\n    const response = await ofetch<Value>(`${baseUrl}/api/v2/channel/get-channel-and-recent-messages-by-short-id`, {\r\n        method: 'POST',\r\n        body: {\r\n            shortId,\r\n        },\r\n    });\r\n\r\n    const items = response.value.bundle.channelMessages.map((message) => ({\r\n        title: message.excerpt.split('\\n')[0],\r\n        description: message.content,\r\n        pubDate: parseDate(message.publishedAt),\r\n        category: message.tags,\r\n        link: `${baseUrl}/channel/${response.value.channel}/${message.id}`,\r\n    }));\r\n\r\n    const channelProfile = response.value.bundle.channels.find((channel) => channel.id === response.value.channel)?.profile;\r\n\r\n    return {\r\n        title: channelProfile?.name,\r\n        description: channelProfile?.description,\r\n        link: `${baseUrl}/share/${shortId}`,\r\n        image: channelProfile?.image,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"gOAMA,MAAaA,EAAe,CACxB,KAAM,kBACN,WAAY,CAAC,SACb,QAAS,yBACT,WAAY,CACR,QAAS,SAEb,MAAO,CACH,CACI,OAAQ,CAAC,oCAGjB,KAAM,KACN,YAAa,CAAC,UACd,WAGE,EAAU,0BAEhB,eAAe,EAAQ,EAAc,CACjC,GAAM,CAAE,WAAY,EAAI,IAAI,QAEtB,EAAW,MAAMC,EAAc,GAAG,EAAQ,6DAA8D,CAC1G,OAAQ,OACR,KAAM,CACF,aAIF,EAAQ,EAAS,MAAM,OAAO,gBAAgB,IAAK,IAAa,CAClE,MAAO,EAAQ,QAAQ,MAAM;GAAM,GACnC,YAAa,EAAQ,QACrB,QAAS,EAAU,EAAQ,aAC3B,SAAU,EAAQ,KAClB,KAAM,GAAG,EAAQ,WAAW,EAAS,MAAM,QAAQ,GAAG,EAAQ,QAG5D,EAAiB,EAAS,MAAM,OAAO,SAAS,KAAM,GAAY,EAAQ,KAAO,EAAS,MAAM,UAAU,QAEhH,MAAO,CACH,MAAO,GAAgB,KACvB,YAAa,GAAgB,YAC7B,KAAM,GAAG,EAAQ,SAAS,IAC1B,MAAO,GAAgB,MACvB,KAAM"}