import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{config as n}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as r}from"./cache-kimkMTWJ.js";import{art as i}from"./render-CxhTJIsl.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import o from"node:path";t();const s=e=>{let t=[`https://api.bgm.tv/calendar`,`https://cdn.jsdelivr.net/npm/bangumi-data/dist/data.json`];return Promise.all(t.map((t,r)=>e(t,async()=>{let{data:e}=await a(t);if(r===1){let t=[];for(let n of e.items){let e=n.sites.find(e=>e.site===`bangumi`);e&&(n.bgmId=e.id,t.push(n))}e.items=t}return e},n.cache.contentExpire,!1)))};var c=s;const l={path:`/calendar/today`,categories:[`anime`],example:`/bangumi.tv/calendar/today`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`bgm.tv/calendar`]}],name:`放送列表`,maintainers:[`magic-akari`],handler:u,url:`bgm.tv/calendar`};async function u(){let[t,n]=await c(r.tryGet),a=n.siteMeta,s=new Date(Date.now());s.setUTCHours(s.getUTCHours()+9);let l=s.getUTCDay(),u=t.find(e=>e.weekday.id%7===l),d=new Set(u.items.map(e=>e.id.toString())),f={};for(let e of u.items)f[e.id]=(e.images||{}).large;let p=n.items.filter(e=>d.has(e.bgmId));for(let e of p)e.image=f[e.bgmId];return{title:`bangumi 每日放送`,link:`https://bgm.tv/calendar`,item:p.map(t=>{let n=new Date(Date.now());n.setSeconds(0);let r=new Date(t.begin||n);n.setHours(r.getHours()),n.setMinutes(r.getMinutes()),n.setSeconds(r.getSeconds());let s=`https://bangumi.tv/subject/${t.bgmId}`,c=`${s}#${new Intl.DateTimeFormat(`zh-CN`).format(n)}`,l=i(o.join(e,`templates/today-2747936a.art`),{bgm:t,siteMeta:a});return{id:c,guid:c,title:[t.title,Object.values(t.titleTranslate).map(e=>e.join(`｜`)).join(`｜`)].filter(Boolean).join(`｜`),updated:n.toISOString(),pubDate:n.toUTCString(),link:s,description:l,content:{html:l}}})}}export{l as route};
//# sourceMappingURL=today-BhEI6vRs.js.map