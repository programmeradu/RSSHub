{"version":3,"file":"news-CeAci0hl.js","names":["categories: Record<\r\n    string,\r\n    {\r\n        label: string;\r\n        scene: number;\r\n        view: number;\r\n    }\r\n>","route: Route","InvalidParameterError","ofetch"],"sources":["../../lib/routes/cybersecurityventures/news.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport type { Context } from 'hono';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\nimport type { RawRecord } from './types';\r\n\r\nconst categories: Record<\r\n    string,\r\n    {\r\n        label: string;\r\n        scene: number;\r\n        view: number;\r\n    }\r\n> = {\r\n    today: {\r\n        label: \"Today's News\",\r\n        scene: 12,\r\n        view: 14,\r\n    },\r\n    'intrusion-daily-cyber-threat-alert': {\r\n        label: 'Cyberattacks',\r\n        scene: 13,\r\n        view: 15,\r\n    },\r\n    'ransomware-minute': {\r\n        label: 'Ransomware',\r\n        scene: 16,\r\n        view: 18,\r\n    },\r\n    cryptocrime: {\r\n        label: 'Cryptocrime',\r\n        scene: 18,\r\n        view: 20,\r\n    },\r\n    'hack-blotter': {\r\n        label: 'Hack Blotter',\r\n        scene: 19,\r\n        view: 21,\r\n    },\r\n    'cybersecurity-venture-capital-vc-deals': {\r\n        label: 'VC Deal Flow',\r\n        scene: 3,\r\n        view: 3,\r\n    },\r\n    'mergers-and-acquisitions-report': {\r\n        label: 'M&A Tracker',\r\n        scene: 11,\r\n        view: 13,\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    name: 'News',\r\n    categories: ['programming'],\r\n    path: '/news/:category?',\r\n    example: '/cybersecurityventures/news',\r\n    radar: Object.keys(categories).map((key) => ({\r\n        source: [`cybersecurityventures.com/${key}`],\r\n        target: `/news/${key}`,\r\n        title: categories[key].label,\r\n    })),\r\n    parameters: {\r\n        category: {\r\n            description: 'news category',\r\n            default: 'today',\r\n            options: Object.keys(categories).map((key) => ({\r\n                value: key,\r\n                label: categories[key].label,\r\n            })),\r\n        },\r\n    },\r\n    handler,\r\n    maintainers: ['KarasuShin'],\r\n    features: {\r\n        supportRadar: true,\r\n    },\r\n    view: ViewType.Articles,\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const rootUrl = 'https://cybersecurityventures.com/';\r\n    const apiUrl = 'https://us-east-1-renderer-read.knack.com/v1';\r\n    const category = ctx.req.param('category') ?? 'today';\r\n    const limit = ctx.req.query('limit') ?? 20;\r\n\r\n    if (!(category in categories)) {\r\n        throw new InvalidParameterError('Invalid category');\r\n    }\r\n\r\n    const { scene, view, label } = categories[category];\r\n\r\n    const data = await ofetch<{\r\n        records: RawRecord[];\r\n    }>(`${apiUrl}/scenes/scene_${scene}/views/view_${view}/records?format=raw&page=1&rows_per_page=${limit}&sort_field=field_2&sort_order=desc`, {\r\n        headers: {\r\n            'X-Knack-Application-Id': '6013171b60be8f001cb27363',\r\n            'X-Knack-Rest-Api-Key': 'renderer',\r\n        },\r\n    });\r\n\r\n    return {\r\n        title: `${label} - Cybercrime Magazine`,\r\n        link: `${rootUrl}/${category}`,\r\n        item: data.records.map((item) => {\r\n            const $ = load(item.field_3, null, false);\r\n            const link = $('a').attr('href');\r\n            const source = item.field_4;\r\n            const description = `<p>${source}</p><br>${$.html()}`;\r\n\r\n            return {\r\n                title: item.field_5,\r\n                description,\r\n                pubDate: parseDate(item.field_2.iso_timestamp),\r\n                link,\r\n                guid: `cybersecurityventures:${item.id}`,\r\n            } as DataItem;\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"0XAQA,MAAMA,EAOF,CACA,MAAO,CACH,MAAO,eACP,MAAO,GACP,KAAM,IAEV,qCAAsC,CAClC,MAAO,eACP,MAAO,GACP,KAAM,IAEV,oBAAqB,CACjB,MAAO,aACP,MAAO,GACP,KAAM,IAEV,YAAa,CACT,MAAO,cACP,MAAO,GACP,KAAM,IAEV,eAAgB,CACZ,MAAO,eACP,MAAO,GACP,KAAM,IAEV,yCAA0C,CACtC,MAAO,eACP,MAAO,EACP,KAAM,GAEV,kCAAmC,CAC/B,MAAO,cACP,MAAO,GACP,KAAM,KAIDC,EAAe,CACxB,KAAM,OACN,WAAY,CAAC,eACb,KAAM,mBACN,QAAS,8BACT,MAAO,OAAO,KAAK,GAAY,IAAK,IAAS,CACzC,OAAQ,CAAC,6BAA6B,KACtC,OAAQ,SAAS,IACjB,MAAO,EAAW,GAAK,SAE3B,WAAY,CACR,SAAU,CACN,YAAa,gBACb,QAAS,QACT,QAAS,OAAO,KAAK,GAAY,IAAK,IAAS,CAC3C,MAAO,EACP,MAAO,EAAW,GAAK,WAInC,UACA,YAAa,CAAC,cACd,SAAU,CACN,aAAc,IAElB,KAAM,EAAS,UAGnB,eAAe,EAAQ,EAA6B,CAChD,IAEM,EAAW,EAAI,IAAI,MAAM,aAAe,QACxC,EAAQ,EAAI,IAAI,MAAM,UAAY,GAExC,GAAI,EAAE,KAAY,GACd,MAAM,IAAIC,EAAsB,oBAGpC,GAAM,CAAE,QAAO,OAAM,SAAU,EAAW,GAEpC,EAAO,MAAMC,EAEhB,6DAA0B,EAAM,cAAc,EAAK,2CAA2C,EAAM,qCAAsC,CACzI,QAAS,CACL,yBAA0B,2BAC1B,uBAAwB,cAIhC,MAAO,CACH,MAAO,GAAG,EAAM,wBAChB,KAAM,sCAAc,IACpB,KAAM,EAAK,QAAQ,IAAK,GAAS,CAC7B,IAAM,EAAI,EAAK,EAAK,QAAS,KAAM,IAC7B,EAAO,EAAE,KAAK,KAAK,QACnB,EAAS,EAAK,QACd,EAAc,MAAM,EAAO,UAAU,EAAE,SAE7C,MAAO,CACH,MAAO,EAAK,QACZ,cACA,QAAS,EAAU,EAAK,QAAQ,eAChC,OACA,KAAM,yBAAyB,EAAK"}