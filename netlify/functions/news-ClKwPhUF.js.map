{"version":3,"file":"news-ClKwPhUF.js","names":["route: Route","ofetch","cache","r","$"],"sources":["../../lib/routes/shisu/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst url = 'https://news.shisu.edu.cn';\r\nconst banner = 'https://news.shisu.edu.cn/news/index/39adf3d9ae414bc39c6d3b9316ae531f.png';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:section',\r\n    categories: ['university'],\r\n    example: '/shisu/news/news',\r\n    parameters: { section: '主站的新闻类别' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['news.shisu.edu.cn/:section/index.html'],\r\n            target: '/news/:section',\r\n        },\r\n    ],\r\n    name: '上外新闻',\r\n    maintainers: ['Duuckjing'],\r\n    handler,\r\n    description: `| 首页 | 特稿    | 学术      | 教学       | 国际          | 校园   | 人物   | 视讯       | 公告   |\r\n| ---- | ------- | --------- | ---------- | ------------- | ------ | ------ | ---------- | ------ |\r\n| news | gazette | research- | academics- | international | campus | people | multimedia | notice |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { section = 'news' } = ctx.req.param();\r\n    const r = await ofetch(`${url}/${section}/index.html`);\r\n    const $ = load(r);\r\n    let itemsoup;\r\n    switch (section) {\r\n        case 'news':\r\n            itemsoup = $('#gallery-wrapper > article')\r\n                .toArray()\r\n                .map((i0) => {\r\n                    const i = $(i0);\r\n                    const img = i.find('img').attr('src');\r\n                    return {\r\n                        title: i.find('a').text().trim(),\r\n                        link: `${url}${i.find('a').attr('href')}`,\r\n                        category: i.find('.in-con02 > span:nth-child(1)').text(),\r\n                        itunes_item_image: `${url}${img}`,\r\n                    };\r\n                });\r\n            break;\r\n        default:\r\n            itemsoup = $('li.clear')\r\n                .toArray()\r\n                .map((i0) => {\r\n                    const i = $(i0);\r\n                    return {\r\n                        title: i.find('h3>a').attr('title')?.trim(),\r\n                        link: `${url}${i.find('h3>a').attr('href')}`,\r\n                        category: i.find('p>span:nth-child(1)').text(),\r\n                    };\r\n                });\r\n    }\r\n    const items = await Promise.all(\r\n        itemsoup.map((j) =>\r\n            cache.tryGet(j.link, async () => {\r\n                const r = await ofetch(j.link);\r\n                const $ = load(r);\r\n                const img = $('.tempWrap > ul > li:nth-child(1)> img').attr('src');\r\n                j.description = $('.ot_main_r .content').html();\r\n                j.author = $('.math_time_l > span:nth-child(3)').text().trim();\r\n                j.pubDate = parseDate($('.math_time_l > span:nth-child(2)').text(), 'YYYY-MM-DD');\r\n                if (!j.itunes_item_image) {\r\n                    j.itunes_item_image = img ? `${url}${img}` : banner;\r\n                }\r\n                return j;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `上外新闻|SISU TODAY - ${section.charAt(0).toUpperCase() + section.slice(1)}`,\r\n        image: 'https://upload.wikimedia.org/wikipedia/zh/thumb/0/06/Shanghai_International_Studies_University_logo.svg/300px-Shanghai_International_Studies_University_logo.svg.png',\r\n        link: `${url}/${section}/index.html`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mTAMA,MAAM,EAAM,4BAGCA,EAAe,CACxB,KAAM,iBACN,WAAY,CAAC,cACb,QAAS,mBACT,WAAY,CAAE,QAAS,WACvB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,yCACT,OAAQ,mBAGhB,KAAM,OACN,YAAa,CAAC,aACd,UACA,YAAa;;sGAKjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,UAAU,QAAW,EAAI,IAAI,QAC/B,EAAI,MAAMC,EAAO,GAAG,EAAI,GAAG,EAAQ,cACnC,EAAI,EAAK,GACX,EACJ,OAAQ,EAAR,CACI,IAAK,OACD,EAAW,EAAE,8BACR,UACA,IAAK,GAAO,CACT,IAAM,EAAI,EAAE,GACN,EAAM,EAAE,KAAK,OAAO,KAAK,OAC/B,MAAO,CACH,MAAO,EAAE,KAAK,KAAK,OAAO,OAC1B,KAAM,GAAG,IAAM,EAAE,KAAK,KAAK,KAAK,UAChC,SAAU,EAAE,KAAK,iCAAiC,OAClD,kBAAmB,GAAG,IAAM,OAGxC,MACJ,QACI,EAAW,EAAE,YACR,UACA,IAAK,GAAO,CACT,IAAM,EAAI,EAAE,GACZ,MAAO,CACH,MAAO,EAAE,KAAK,QAAQ,KAAK,UAAU,OACrC,KAAM,GAAG,IAAM,EAAE,KAAK,QAAQ,KAAK,UACnC,SAAU,EAAE,KAAK,uBAAuB,UAI5D,IAAM,EAAQ,MAAM,QAAQ,IACxB,EAAS,IAAK,GACVC,EAAM,OAAO,EAAE,KAAM,SAAY,CAC7B,IAAMC,EAAI,MAAMF,EAAO,EAAE,MACnBG,EAAI,EAAKD,GACT,EAAMC,EAAE,yCAAyC,KAAK,OAO5D,MANA,GAAE,YAAcA,EAAE,uBAAuB,OACzC,EAAE,OAASA,EAAE,oCAAoC,OAAO,OACxD,EAAE,QAAU,EAAUA,EAAE,oCAAoC,OAAQ,cAC/D,EAAE,oBACH,EAAE,kBAAoB,EAAM,GAAG,IAAM,IAAQ,6EAE1C,MAKnB,MAAO,CACH,MAAO,qBAAqB,EAAQ,OAAO,GAAG,cAAgB,EAAQ,MAAM,KAC5E,MAAO,uKACP,KAAM,GAAG,EAAI,GAAG,EAAQ,aACxB,KAAM"}