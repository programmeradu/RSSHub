{"version":3,"file":"curator-C0g2qX1g.js","names":[],"sources":["../../lib/routes/steam/curator.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\n\r\nexport const route: Route = {\r\n    path: '/curator/:id/:routeParams?',\r\n    categories: ['game'],\r\n    example: '/steam/curator/34646096-80-Days',\r\n    parameters: {\r\n        id: \"Steam curator id. It usually consists of a series of numbers and the curator's name.\",\r\n        routeParams: {\r\n            description: `Extra parameters to filter the reviews. The following parameters are supported:\r\n| Key             | Description                                                                                   | Accepts                                    | Defaults to |\r\n| --------------- | --------------------------------------------------------------------------------------------- | ------------------------------------------ | ----------- |\r\n| \\`curations\\`   | Review type to filter by. \\`0\\`: Recommended, \\`1\\`: Not Recommended, \\`2\\`: Informational    | \\`0\\`/\\`1\\`/\\`2\\`/\\`0,1\\`/\\`0,2\\`/\\`1,2\\`  |             |\r\n| \\`tagids\\`      | Tag to filter by. Details are provided below.                                                 | use comma to separate multiple tagid       |             |\r\n\r\nNote: There is a [‘Popular Tags’](https://store.steampowered.com/tag/browse) page where you can find many but not all of the tags. The tag’s ID is in the \\`data-tagid\\` attribute of the element.Steam does not currently provide a page that comprehensively lists all tags, and you may need to explore alternative ways to find them.\r\n\r\nExamples:\r\n* \\`/steam/curator/34646096-80-Days/curations=&tagids=\\`\r\n* \\`/steam/curator/34646096-80-Days/curations=0&tagids=19\\`\r\n* \\`/steam/curator/34646096-80-Days/curations=0,2&tagids=19,21\\`\r\n`,\r\n        },\r\n    },\r\n    radar: [\r\n        {\r\n            title: 'Latest Curator Reviews',\r\n            source: ['store.steampowered.com/curator/:id'],\r\n            target: '/curator/:id',\r\n        },\r\n    ],\r\n    description: 'The Latest reviews from a Steam Curator.',\r\n    name: 'Latest Curator Reviews',\r\n    maintainers: ['naremloa', 'fenxer'],\r\n    handler: async (ctx) => {\r\n        const { id, routeParams } = ctx.req.param();\r\n        const params = new URLSearchParams(routeParams);\r\n\r\n        const url = new URL(`https://store.steampowered.com/curator/${id}/ajaxgetfilteredrecommendations/?query&start=0&count=10&dynamic_data=&sort=recent&app_types=&reset=false&curations=&tagids=`);\r\n        for (const [key, value] of params) {\r\n            if (['curations', 'tagids'].includes(key)) {\r\n                url.searchParams.set(key, value || '');\r\n            }\r\n        }\r\n\r\n        const response = await ofetch(url.toString());\r\n        const $ = load(response.results_html ?? '');\r\n\r\n        const items = $('.recommendation')\r\n            .toArray()\r\n            .map((item) => {\r\n                const el = $(item);\r\n                const appImageEl = el.find('a.store_capsule img');\r\n                const appTitle = appImageEl.attr('alt')!;\r\n                const appImage = appImageEl.attr('src') ?? '';\r\n                const appLink = el.find('.recommendation_link').first().attr('href');\r\n                const reviewContent = el.find('.recommendation_desc').text().trim();\r\n                const reviewDateText = el.find('.curator_review_date').text().trim();\r\n\r\n                const notCurrentYearPattern = /,\\s\\b\\d{4}\\b$/;\r\n                const reviewPubDate = notCurrentYearPattern.test(reviewDateText) ? parseDate(reviewDateText) : parseDate(`${reviewDateText}, ${new Date().getFullYear()}`);\r\n\r\n                const description = art(path.join(__dirname, 'templates/curator-description.art'), { image: appImage, description: reviewContent });\r\n\r\n                return {\r\n                    title: appTitle,\r\n                    link: appLink,\r\n                    description,\r\n                    pubDate: reviewPubDate,\r\n                    media: {\r\n                        content: {\r\n                            url: appImage,\r\n                            medium: 'image',\r\n                        },\r\n                    },\r\n                };\r\n            });\r\n\r\n        return {\r\n            title: `Steam Curator ${id} Reviews`,\r\n            link: url.toString(),\r\n            item: items,\r\n        };\r\n    },\r\n};\r\n"],"mappings":"+WAOA,MAAa,EAAe,CACxB,KAAM,6BACN,WAAY,CAAC,QACb,QAAS,kCACT,WAAY,CACR,GAAI,uFACJ,YAAa,CACT,YAAa,2wCAerB,MAAO,CACH,CACI,MAAO,yBACP,OAAQ,CAAC,sCACT,OAAQ,iBAGhB,YAAa,2CACb,KAAM,yBACN,YAAa,CAAC,WAAY,UAC1B,QAAS,KAAO,IAAQ,CACpB,GAAM,CAAE,KAAI,eAAgB,EAAI,IAAI,QAC9B,EAAS,IAAI,gBAAgB,GAE7B,EAAM,IAAI,IAAI,0CAA0C,EAAG,8HACjE,IAAK,GAAM,CAAC,EAAK,KAAU,EACnB,CAAC,YAAa,UAAU,SAAS,IACjC,EAAI,aAAa,IAAI,EAAK,GAAS,IAI3C,IAAM,EAAW,MAAM,EAAO,EAAI,YAC5B,EAAI,EAAK,EAAS,cAAgB,IAElC,EAAQ,EAAE,mBACX,UACA,IAAK,GAAS,CACX,IAAM,EAAK,EAAE,GACP,EAAa,EAAG,KAAK,uBACrB,EAAW,EAAW,KAAK,OAC3B,EAAW,EAAW,KAAK,QAAU,GACrC,EAAU,EAAG,KAAK,wBAAwB,QAAQ,KAAK,QACvD,EAAgB,EAAG,KAAK,wBAAwB,OAAO,OACvD,EAAiB,EAAG,KAAK,wBAAwB,OAAO,OAExD,EAAwB,gBACxB,EAAgB,EAAsB,KAAK,GAAkB,EAAU,GAAkB,EAAU,GAAG,EAAe,IAAI,IAAI,OAAO,iBAEpI,EAAc,EAAI,EAAA,KAAA,EAAA,8CAA2D,CAAE,MAAO,EAAU,YAAa,IAEnH,MAAO,CACH,MAAO,EACP,KAAM,EACN,cACA,QAAS,EACT,MAAO,CACH,QAAS,CACL,IAAK,EACL,OAAQ,aAM5B,MAAO,CACH,MAAO,iBAAiB,EAAG,UAC3B,KAAM,EAAI,WACV,KAAM"}