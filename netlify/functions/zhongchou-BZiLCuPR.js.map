{"version":3,"file":"zhongchou-BZiLCuPR.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/modian/zhongchou.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/zhongchou/:category?/:sort?/:status?',\r\n    categories: ['shopping'],\r\n    example: '/modian/zhongchou',\r\n    parameters: { category: '分类，见下表，默认为全部', sort: '排序，见下表，默认为最新上线', status: '状态，见下表，默认为全部' },\r\n    name: '众筹',\r\n    maintainers: ['nczitzk'],\r\n    description: `分类\r\n\r\n| 全部 | 游戏  | 动漫   | 出版       | 桌游       |\r\n| ---- | ----- | ------ | ---------- | ---------- |\r\n| all  | games | comics | publishing | tablegames |\r\n\r\n| 卡牌  | 潮玩模型 | 影视       | 音乐  | 活动       |\r\n| ----- | -------- | ---------- | ----- | ---------- |\r\n| cards | toys     | film-video | music | activities |\r\n\r\n| 设计   | 科技       | 食品 | 爱心通道 | 动物救助 |\r\n| ------ | ---------- | ---- | -------- | -------- |\r\n| design | technology | food | charity  | animals  |\r\n\r\n| 个人愿望 | 其他   |\r\n| -------- | ------ |\r\n| wishes   | others |\r\n\r\n  排序\r\n\r\n| 最新上线  | 金额最高   | 评论最多     |\r\n| --------- | ---------- | ------------ |\r\n| top\\_time | top\\_money | top\\_comment |\r\n\r\n  状态\r\n\r\n| 全部 | 创意 | 预热    | 众筹中 | 众筹成功 |\r\n| ---- | ---- | ------- | ------ | -------- |\r\n| all  | idea | preheat | going  | success  |`,\r\n    handler,\r\n    radar: [\r\n        {\r\n            source: ['zhongchou.modian.com/:category/:sort/:status'],\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'all', sort = 'top_time', status = 'all' } = ctx.req.param();\r\n\r\n    const rootUrl = 'https://zhongchou.modian.com';\r\n    const currentUrl = `${rootUrl}/${category}/${sort}/${status}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    const list = $('.pro_title')\r\n        .slice(0, 12)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item).parent();\r\n\r\n            return {\r\n                title: item.text(),\r\n                link: item.attr('href'),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n                const content = load(detailResponse.data);\r\n\r\n                const startTime = detailResponse.data.match(/realtime_sync\\.pro_time\\('(\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2})', '\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}'\\);/);\r\n\r\n                item.pubDate = startTime === null ? Date.parse(content('.start-time h3').text() || content('h3[start_time]').attr('start_time')) : Date.parse(startTime[1]);\r\n\r\n                item.author = content('span[data-nickname]').text();\r\n                item.description = `<img src=\"${content('#big_logo').attr('src')}\"><br>` + content('.center-top').html() + content('#my_back_info').html() + content('#cont_match_htmlstr').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${$('.category div span').text()} - ${$('.status div span').text()} - ${$('.sort div span').text()} - 摩点众筹`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mTAKA,MAAaA,EAAe,CACxB,KAAM,wCACN,WAAY,CAAC,YACb,QAAS,oBACT,WAAY,CAAE,SAAU,eAAgB,KAAM,iBAAkB,OAAQ,gBACxE,KAAM,KACN,YAAa,CAAC,WACd,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;+CA6Bb,UACA,MAAO,CACH,CACI,OAAQ,CAAC,mDAKrB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,MAAO,OAAO,WAAY,SAAS,OAAU,EAAI,IAAI,QAGlE,EAAa,gCAAc,EAAS,GAAG,EAAK,GAAG,IAE/C,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,cACV,MAAM,EAAG,IACT,UACA,IAAK,IACF,EAAO,EAAE,GAAM,SAER,CACH,MAAO,EAAK,OACZ,KAAM,EAAK,KAAK,WAItB,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAER,EAAU,EAAK,EAAe,MAE9B,EAAY,EAAe,KAAK,MAAM,8GAO5C,MALA,GAAK,QAAU,IAAc,KAAO,KAAK,MAAM,EAAQ,kBAAkB,QAAU,EAAQ,kBAAkB,KAAK,eAAiB,KAAK,MAAM,EAAU,IAExJ,EAAK,OAAS,EAAQ,uBAAuB,OAC7C,EAAK,YAAc,aAAa,EAAQ,aAAa,KAAK,OAAO,QAAU,EAAQ,eAAe,OAAS,EAAQ,iBAAiB,OAAS,EAAQ,uBAAuB,OAErK,MAKnB,MAAO,CACH,MAAO,GAAG,EAAE,sBAAsB,OAAO,KAAK,EAAE,oBAAoB,OAAO,KAAK,EAAE,kBAAkB,OAAO,SAC3G,KAAM,EACN,KAAM"}