{"version":3,"file":"wjdt-DSW6sMK_.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/gov/mfa/wjdt.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst categories = {\r\n    gjldrhd: 'gjldrhd_674881',\r\n    wsrc: 'wsrc_674883',\r\n    wjbxw: 'wjbxw_674885',\r\n    sjxw: 'sjxw_674887',\r\n    fyrbt: 'fyrbt_674889',\r\n    cfhsl: 'cfhsl_674891',\r\n    dsrm: 'dsrm_674893',\r\n    zwbd: 'zwbd_674895',\r\n    zcjd: 'zcjd',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: ['/fmprc/:category?', '/mfa/wjdt/:category?'],\r\n    name: 'Unknown',\r\n    maintainers: ['nicolaszf', 'nczitzk'],\r\n    handler,\r\n    description: `| 分类       | category |\r\n| ---------- | -------- |\r\n| 领导人活动 | gjldrhd  |\r\n| 外事日程   | wsrc     |\r\n| 部领导活动 | wjbxw    |\r\n| 业务动态   | sjxw     |\r\n| 发言人表态 | fyrbt    |\r\n| 吹风会     | cfhsl    |\r\n| 大使任免   | dsrm     |\r\n| 驻外报道   | zwbd     |\r\n| 政策解读   | zcjd     |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? 'gjldrhd';\r\n\r\n    const rootUrl = 'https://www.mfa.gov.cn';\r\n    const currentUrl = `${rootUrl}/web/wjdt_674879/${categories[category]}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    let items = $('ul.list1 li a')\r\n        .slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 35)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.text(),\r\n                link: item.attr('href').replace(/^\\./, currentUrl),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n\r\n                const content = load(detailResponse.data);\r\n\r\n                item.description = content('#News_Body_Txt_A').html();\r\n                item.pubDate = timezone(parseDate(content('.time span').last().text()), +8);\r\n                item.category = content('meta[name=\"Keywords\"]').attr('content')?.split(';') ?? [];\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAM,EAAa,CACf,QAAS,iBACT,KAAM,cACN,MAAO,eACP,KAAM,cACN,MAAO,eACP,MAAO,eACP,KAAM,cACN,KAAM,cACN,KAAM,QAGGA,EAAe,CACxB,KAAM,CAAC,oBAAqB,wBAC5B,KAAM,UACN,YAAa,CAAC,YAAa,WAC3B,UACA,YAAa;;;;;;;;;;wBAajB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,UAGxC,EAAa,0CAA8B,EAAW,KAEtD,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAEpB,EAAQ,EAAE,iBACT,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAC5E,UACA,IAAK,IACF,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,OACZ,KAAM,EAAK,KAAK,QAAQ,QAAQ,MAAO,MAuBnD,MAnBA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGR,EAAU,EAAK,EAAe,MAMpC,MAJA,GAAK,YAAc,EAAQ,oBAAoB,OAC/C,EAAK,QAAU,EAAS,EAAU,EAAQ,cAAc,OAAO,QAAS,GACxE,EAAK,SAAW,EAAQ,yBAAyB,KAAK,YAAY,MAAM,MAAQ,GAEzE,MAKZ,CACH,MAAO,EAAE,SAAS,OAClB,KAAM,EACN,KAAM"}