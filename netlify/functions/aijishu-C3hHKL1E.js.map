{"version":3,"file":"aijishu-C3hHKL1E.js","names":["cache","got","route: Route","got","utils"],"sources":["../../lib/routes/aijishu/utils.ts","../../lib/routes/aijishu/index.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseRelativeDate, parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\n\r\nconst parseArticle = (item) => {\r\n    const articleUrl = `https://aijishu.com${item.url || item.object.url}`;\r\n    return cache.tryGet(articleUrl, async () => {\r\n        const d1 = parseDate(item.createdDate, ['YYYY-MM-DD', 'M-DD']);\r\n        const d2 = parseRelativeDate(item.createdDate);\r\n\r\n        let resp, desc;\r\n        try {\r\n            resp = await got(articleUrl);\r\n            const $ = load(resp.data);\r\n            desc = $('article.fmt').html();\r\n        } catch (error) {\r\n            if (error.response.status === 403) {\r\n                // skip it\r\n            } else {\r\n                throw error;\r\n            }\r\n        }\r\n\r\n        const article_item = {\r\n            title: item.title || item.object.title,\r\n            link: articleUrl,\r\n            description: desc,\r\n            pubDate: d1.toString() === 'Invalid Date' ? d2 : d1,\r\n        };\r\n        return article_item;\r\n    });\r\n};\r\n\r\nexport default { parseArticle };\r\n","import { Route } from '@/types';\r\nimport utils from './utils';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/:type/:name?',\r\n    categories: ['programming'],\r\n    example: '/aijishu/channel/ai',\r\n    parameters: { type: '文章类型，可以取值如下', name: '名字，取自URL' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '频道、专栏、用户',\r\n    maintainers: [],\r\n    handler,\r\n    description: `| type    | 说明 |\r\n| ------- | ---- |\r\n| channel | 频道 |\r\n| blog    | 专栏 |\r\n| u       | 用户 |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { type, name = 'newest' } = ctx.req.param();\r\n    const u = name === 'newest' ? `https://aijishu.com/` : `https://aijishu.com/${type}/${name}`;\r\n    const html = await got(u);\r\n\r\n    const $ = load(html.data);\r\n    const title = $('title').text();\r\n    const api_path = $('li[data-js-stream-load-more]').attr('data-api-url');\r\n\r\n    const channel_url = `https://aijishu.com${api_path}?page=1`;\r\n    const channel_url_resp = await got(channel_url);\r\n    const resp = channel_url_resp.data;\r\n    const list = resp.data.rows;\r\n\r\n    const items = await Promise.all(list.filter((item) => item?.url?.startsWith('/a/') || item?.object?.url.startsWith('/a/')).map((item) => utils.parseArticle(item)));\r\n\r\n    return {\r\n        title: title.split(' - ').slice(0, 2).join(' - '),\r\n        link: u,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"+XAKA,MAAM,EAAgB,GAAS,CAC3B,IAAM,EAAa,sBAAsB,EAAK,KAAO,EAAK,OAAO,MACjE,OAAOA,EAAM,OAAO,EAAY,SAAY,CACxC,IAAM,EAAK,EAAU,EAAK,YAAa,CAAC,aAAc,SAChD,EAAK,EAAkB,EAAK,aAE9B,EAAM,EACV,GAAI,CACA,EAAO,MAAMG,EAAI,GACjB,IAAM,EAAI,EAAK,EAAK,MACpB,EAAO,EAAE,eAAe,aACnB,EAAO,CACZ,GAAI,EAAM,SAAS,SAAW,IAG1B,MAAM,EAId,IAAM,EAAe,CACjB,MAAO,EAAK,OAAS,EAAK,OAAO,MACjC,KAAM,EACN,YAAa,EACb,QAAS,EAAG,aAAe,eAAiB,EAAK,GAErD,OAAO,KAIf,IAAA,EAAe,CAAE,gBC7BjB,MAAaD,EAAe,CACxB,KAAM,gBACN,WAAY,CAAC,eACb,QAAS,sBACT,WAAY,CAAE,KAAM,cAAe,KAAM,YACzC,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,WACN,YAAa,GACb,UACA,YAAa;;;;mBAOjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAM,OAAO,UAAa,EAAI,IAAI,QACpC,EAAI,IAAS,SAAW,uBAAyB,uBAAuB,EAAK,GAAG,IAChF,EAAO,MAAMC,EAAI,GAEjB,EAAI,EAAK,EAAK,MACd,EAAQ,EAAE,SAAS,OACnB,EAAW,EAAE,gCAAgC,KAAK,gBAElD,EAAc,sBAAsB,EAAS,SAC7C,EAAmB,MAAMA,EAAI,GAC7B,EAAO,EAAiB,KACxB,EAAO,EAAK,KAAK,KAEjB,EAAQ,MAAM,QAAQ,IAAI,EAAK,OAAQ,GAAS,GAAM,KAAK,WAAW,QAAU,GAAM,QAAQ,IAAI,WAAW,QAAQ,IAAK,GAASC,EAAM,aAAa,KAE5J,MAAO,CACH,MAAO,EAAM,MAAM,OAAO,MAAM,EAAG,GAAG,KAAK,OAC3C,KAAM,EACN,KAAM"}