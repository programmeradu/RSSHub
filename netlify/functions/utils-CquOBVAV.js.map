{"version":3,"file":"utils-CquOBVAV.js","names":["got"],"sources":["../../lib/routes/hpoi/utils.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nconst host = 'https://www.hpoi.net';\r\n\r\nconst MAPs = {\r\n    character: {\r\n        url: `${host}/hobby/all?order={order}&r18=-1&charactar={id}`,\r\n        title: '角色周边',\r\n    },\r\n    work: {\r\n        url: `${host}/hobby/all?order={order}&r18=-1&works={id}`,\r\n        title: '作品周边',\r\n    },\r\n    overview: {\r\n        url: `${host}/works/{id}`,\r\n        title: '周边总览',\r\n    },\r\n    all: {\r\n        url: `${host}/hobby/all?order={order}&r18=-1`,\r\n        title: '全部周边',\r\n    },\r\n};\r\n\r\nconst ProcessFeed = async (type, id, order) => {\r\n    let link = MAPs[type].url.replace(/{id}/, id).replace(/{order}/, order || 'add');\r\n    let response = await got({\r\n        method: 'get',\r\n        url: link,\r\n        headers: {\r\n            Referer: host,\r\n        },\r\n    });\r\n    let $ = load(response.data);\r\n\r\n    if (type === 'work') {\r\n        const overviewLink = MAPs.overview.url.replace(/{id}/, id);\r\n        const overviewResponse = await got({\r\n            method: 'get',\r\n            url: overviewLink,\r\n            headers: {\r\n                Referer: host,\r\n            },\r\n        });\r\n        const $overview = load(overviewResponse.data);\r\n\r\n        const moreLink = $overview('.company-ibox a.hpoi-btn-border.hpoi-btn-more').attr('href');\r\n        if (moreLink) {\r\n            const worksId = moreLink.match(/modal\\/taobao\\/more\\/(\\d+)/)?.[1];\r\n            if (worksId) {\r\n                link = `${host}/hobby/all?order=${order || 'add'}&r18=-1&works=${worksId}`;\r\n                response = await got({\r\n                    method: 'get',\r\n                    url: link,\r\n                    headers: {\r\n                        Referer: host,\r\n                    },\r\n                });\r\n                $ = load(response.data);\r\n            }\r\n        }\r\n    }\r\n\r\n    return {\r\n        title: `Hpoi 手办维基 - ${MAPs[type].title}${id ? ` ${id}` : ''}`,\r\n        link,\r\n        item: $('.hpoi-glyphicons-list li')\r\n            .toArray()\r\n            .map((_item) => {\r\n                _item = $(_item);\r\n                return {\r\n                    title: _item.find('.hpoi-detail-grid-title a').text(),\r\n                    link: host + '/' + _item.find('a').attr('href'),\r\n                    description: `<img src=\"${_item.find('img').attr('src').replace('/s/', '/n/')}\">${_item.find('.hpoi-detail-grid-info').html().replaceAll('span>', 'p>')}`,\r\n                };\r\n            }),\r\n    };\r\n};\r\n\r\nexport { ProcessFeed };\r\n"],"mappings":"+EAGA,MAAM,EAAO,uBAEP,EAAO,CACT,UAAW,CACP,IAAK,GAAG,EAAK,gDACb,MAAO,QAEX,KAAM,CACF,IAAK,GAAG,EAAK,4CACb,MAAO,QAEX,SAAU,CACN,IAAK,GAAG,EAAK,aACb,MAAO,QAEX,IAAK,CACD,IAAK,GAAG,EAAK,iCACb,MAAO,SAIT,EAAc,MAAO,EAAM,EAAI,IAAU,CAC3C,IAAI,EAAO,EAAK,GAAM,IAAI,QAAQ,OAAQ,GAAI,QAAQ,UAAW,GAAS,OACtE,EAAW,MAAMA,EAAI,CACrB,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,KAGb,EAAI,EAAK,EAAS,MAEtB,GAAI,IAAS,OAAQ,CACjB,IAAM,EAAe,EAAK,SAAS,IAAI,QAAQ,OAAQ,GACjD,EAAmB,MAAMA,EAAI,CAC/B,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,KAGX,EAAY,EAAK,EAAiB,MAElC,EAAW,EAAU,iDAAiD,KAAK,QACjF,GAAI,EAAU,CACV,IAAM,EAAU,EAAS,MAAM,gCAAgC,GAC3D,IACA,EAAO,GAAG,EAAK,mBAAmB,GAAS,MAAM,gBAAgB,IACjE,EAAW,MAAMA,EAAI,CACjB,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,KAGjB,EAAI,EAAK,EAAS,QAK9B,MAAO,CACH,MAAO,eAAe,EAAK,GAAM,QAAQ,EAAK,IAAI,IAAO,KACzD,OACA,KAAM,EAAE,4BACH,UACA,IAAK,IACF,EAAQ,EAAE,GACH,CACH,MAAO,EAAM,KAAK,6BAA6B,OAC/C,KAAM,EAAO,IAAM,EAAM,KAAK,KAAK,KAAK,QACxC,YAAa,aAAa,EAAM,KAAK,OAAO,KAAK,OAAO,QAAQ,MAAO,OAAO,IAAI,EAAM,KAAK,0BAA0B,OAAO,WAAW,QAAS"}