import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{config as n}from"./config-Dl8a1sIg.js";import{art as r}from"./render-CxhTJIsl.js";import{md5 as i}from"./md5-4BNsOP-F.js";import{ofetch_default as a}from"./ofetch-Bzt0BXUH.js";import o from"node:path";import s from"crypto-js";t();function c(e){let t=``;for(let n=0;n<e;n++)t+=l(16*Math.random());return u(t,e)}function l(e){return Math.ceil(e).toString(16).toUpperCase()}function u(e,t){let n=``;if(e.length<t)for(let r=0;r<t-e.length;r++)n+=`0`;return n+e}function d(){let e=Date.now().toString(16).toUpperCase(),t=c(8)+`_`+e;return t}function f(){let e=c(8),t=c(4),n=c(4),r=c(4),i=c(12),a=Date.now();return e+`-`+t+`-`+n+`-`+r+`-`+i+u((a%1e5).toString(),5)+`infoc`}function p(e){let t=``;for(let n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)-1);return t}function m(e){let t=s.HmacSHA256(`ts${e}`,p(`YhxToH[2q`)),n=s.enc.Hex.stringify(t);return n}function h(e,t){return`${e}&w_webid=${encodeURIComponent(t)}`}function g(e,t){let n=new URLSearchParams(e);n.sort();let r=n.toString(),a=Math.round(Date.now()/1e3),o=i(`${r}&wts=${a}${t}`);return`${e}&w_rid=${o}&wts=${a}`}function _(e,t){let n=Math.PI*2,r=Math.random(),i=Math.random(),a=Math.sqrt(-2*Math.log(r))*Math.cos(n*i);return Math.round(a*t+e)}function v(){if(n.bilibili.dmImgList!==void 0){let e=JSON.parse(n.bilibili.dmImgList);return JSON.stringify([e[Math.floor(Math.random()*e.length)]])}let e=Math.max(_(1245,5),0),t=Math.max(_(1285,5),0),r=[{x:3*e+2*t,y:4*e-5*t,z:0,timestamp:Math.max(_(30,5),0),type:0}];return JSON.stringify(r)}function y(){if(n.bilibili.dmImgInter!==void 0){let e=JSON.parse(n.bilibili.dmImgInter);return JSON.stringify([e[Math.floor(Math.random()*e.length)]])}let e=C(274,601),t=S(134,30),r=C(332,64),i=S(1101,338),a=S(0,0),o=C(1245,1285),s=[{t:b(`div`),c:x(`clearfix g-search search-container`),p:[e[0],e[2],e[1]],s:[t[2],t[0],t[1]]},{t:b(`div`),c:x(`wrapper`),p:[r[0],r[2],r[1]],s:[i[2],i[0],i[1]]}];return JSON.stringify({ds:s,wh:o,of:a})}function b(e){return{a:4,article:29,button:7,div:2,em:27,form:17,h1:11,h2:12,h3:13,h4:14,h5:15,h6:16,img:5,input:6,label:25,li:10,ol:9,option:20,p:3,section:28,select:19,span:1,strong:26,table:21,td:23,textarea:18,th:24,tr:22,ul:8}[e]}function x(e){return Buffer.from(e).toString(`base64`).slice(0,-2)}function S(e,t){let n=Math.floor(514*Math.random());return[3*e+2*t+n,4*e-4*t+2*n,n]}function C(e,t){let n=Math.floor(114*Math.random());return[2*e+2*t+3*n,4*e-t+n,n]}function w(e,t){let n=Buffer.from(`no webgl`).toString(`base64`).slice(0,-2),r=Buffer.from(`no webgl`).toString(`base64`).slice(0,-2);return`${e}&dm_img_list=${t}&dm_img_str=${n}&dm_cover_img_str=${r}`}function T(e,t,n){return`${w(e,t)}&dm_img_inter=${n}`}const E=(e,t)=>t.tryGet(`bilibili:getBangumi:${e}`,async()=>{let t=await a(`https://api.bilibili.com/pgc/view/web/media`,{query:{media_id:e}});return t.result.share_url===void 0&&(t.result.share_url=`https://www.bilibili.com/bangumi/media/md${t.result.media_id}`),t.result},n.cache.routeExpire,!1),D=(e,t)=>t.tryGet(`bilibili:getBangumiItems:${e}`,async()=>{let t=await a(`https://api.bilibili.com/pgc/web/season/section`,{query:{season_id:e}});return t.result},n.cache.routeExpire,!1),O=(t,n,i,a,s,c)=>{let l=r(o.join(e,`templates/description-c1e557ef.art`),{embed:t,ugc:!0,aid:a,cid:s,bvid:c,img:n.replace(`http://`,`https://`),description:i});return l},k=(t,n,i,a,s)=>{let c=r(o.join(e,`templates/description-c1e557ef.art`),{embed:t,ogv:!0,seasonId:a,episodeId:s,img:n.replace(`http://`,`https://`),description:i});return c};function A(e){return e?`https://www.bilibili.com/blackboard/newplayer.html?isOutside=true&autoplay=true&danmaku=true&muted=false&highQuality=true&bvid=${e}`:void 0}const j=e=>e?`https://www.bilibili.com/blackboard/live/live-activity-player.html?cid=${e}`:void 0;var M={lsid:d,_uuid:f,hexsign:m,addWbiVerifyInfo:g,getDmImgList:v,getDmImgInter:y,addDmVerifyInfo:w,addDmVerifyInfoWithInter:T,bvidTime:1589990400,addRenderData:h,getBangumi:E,getBangumiItems:D,renderUGCDescription:O,renderOGVDescription:k,getVideoUrl:A};export{j as getLiveUrl,A as getVideoUrl,M as utils_default};
//# sourceMappingURL=utils-BY2D8TfT.js.map