{"version":3,"file":"beijingprice-BYtSkZq9.js","names":["got","cache","route: Route"],"sources":["../../lib/routes/beijingprice/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = 'jgzx/xwzx' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 15;\r\n\r\n    const rootUrl = 'https://www.beijingprice.cn';\r\n    const currentUrl = new URL(category.endsWith('/') ? category : `${category}/`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('div.jgzx.rightcontent ul li')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('a');\r\n            const link = a.prop('href');\r\n            const msg = a.prop('msg');\r\n\r\n            const title = a.text()?.trim() ?? a.prop('title');\r\n\r\n            let enclosureUrl;\r\n            let enclosureType;\r\n\r\n            if (msg) {\r\n                const parsedMsg = JSON.parse(msg);\r\n                enclosureUrl = new URL(`${parsedMsg.path}${parsedMsg.fileName}`, rootUrl).href;\r\n                enclosureType = `application/${parsedMsg.suffix}`;\r\n            }\r\n\r\n            return {\r\n                title,\r\n                pubDate: parseDate(item.contents().last().text()),\r\n                link: enclosureUrl ?? (link.startsWith('http') ? link : new URL(link, rootUrl).href),\r\n                language,\r\n                enclosure_url: enclosureUrl,\r\n                enclosure_type: enclosureType,\r\n                enclosure_title: enclosureUrl ? title : undefined,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                if (!item.link.includes('www.beijingprice.cn') || item.link.endsWith('.pdf')) {\r\n                    return item;\r\n                }\r\n\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const title = $$('p.title').text().trim();\r\n                const description = $$('div.news-content').html();\r\n                const fromSplits = $$('p.from')\r\n                    .text()\r\n                    .split(/发布时间：/);\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = fromSplits?.length === 0 ? item.pubDate : parseDate(fromSplits?.pop() ?? '', 'YYYY年MM月DD日');\r\n                item.category = $$('div.map a')\r\n                    .toArray()\r\n                    .map((c) => $$(c).text())\r\n                    .slice(1);\r\n                item.author = fromSplits?.[0]?.replace(/来源：/, '') ?? undefined;\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.news-content').text(),\r\n                };\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('a.header-logo img').prop('src'), rootUrl).href;\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        description: $('meta[name=\"description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: $('meta[name=\"keywords\"]').prop('content'),\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category{.+}?',\r\n    name: '资讯',\r\n    url: 'beijingprice.cn',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/beijingprice/jgzx/xwzx',\r\n    parameters: { category: '分类，默认为 `jgzx/xwzx` 即新闻资讯，可在对应分类页 URL 中找到' },\r\n    description: `::: tip\r\n  若订阅 [新闻资讯](https://www.beijingprice.cn/jgzx/xwzx/)，网址为 \\`https://www.beijingprice.cn/jgzx/xwzx/\\`。截取 \\`https://beijingprice.cn/\\` 到末尾 \\`/\\` 的部分 \\`jgzx/xwzx\\` 作为参数填入，此时路由为 [\\`/beijingprice/jgzx/xwzx\\`](https://rsshub.app/beijingprice/jgzx/xwzx)。\r\n:::\r\n\r\n#### [价格资讯](https://www.beijingprice.cn/jgzx/xwzx/)\r\n\r\n| [新闻资讯](https://www.beijingprice.cn/jgzx/xwzx/)     | [工作动态](https://www.beijingprice.cn/jgzx/gzdt/)     | [各区动态](https://www.beijingprice.cn/jgzx/gqdt/)     | [通知公告](https://www.beijingprice.cn/jgzx/tzgg/)     | [价格早报](https://www.beijingprice.cn/jgzx/jgzb/)     |\r\n| ------------------------------------------------------ | ------------------------------------------------------ | ------------------------------------------------------ | ------------------------------------------------------ | ------------------------------------------------------ |\r\n| [jgzx/xwzx](https://rsshub.app/beijingprice/jgzx/xwzx) | [jgzx/gzdt](https://rsshub.app/beijingprice/jgzx/gzdt) | [jgzx/gqdt](https://rsshub.app/beijingprice/jgzx/gqdt) | [jgzx/tzgg](https://rsshub.app/beijingprice/jgzx/tzgg) | [jgzx/jgzb](https://rsshub.app/beijingprice/jgzx/jgzb) |\r\n\r\n#### [综合信息](https://www.beijingprice.cn/zhxx/cbjs/)\r\n\r\n| [价格听证](https://www.beijingprice.cn/zhxx/jgtz/)     | [价格监测定点单位名单](https://www.beijingprice.cn/zhxx/jgjcdddwmd/) | [部门预算决算](https://www.beijingprice.cn/bmys/) |\r\n| ------------------------------------------------------ | -------------------------------------------------------------------- | ------------------------------------------------- |\r\n| [zhxx/jgtz](https://rsshub.app/beijingprice/zhxx/jgtz) | [zhxx/jgjcdddwmd](https://rsshub.app/beijingprice/zhxx/jgjcdddwmd)   | [bmys](https://rsshub.app/beijingprice/bmys)      |\r\n    `,\r\n    categories: ['government'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['beijingprice.cn/:category?'],\r\n            target: (params) => {\r\n                const category = params.category;\r\n\r\n                return `/beijingprice${category ? `/${category}` : ''}`;\r\n            },\r\n        },\r\n        {\r\n            title: '价格资讯 - 新闻资讯',\r\n            source: ['beijingprice.cn/jgzx/xwzx/'],\r\n            target: '/jgzx/xwzx',\r\n        },\r\n        {\r\n            title: '价格资讯 - 工作动态',\r\n            source: ['beijingprice.cn/jgzx/gzdt/'],\r\n            target: '/jgzx/gzdt',\r\n        },\r\n        {\r\n            title: '价格资讯 - 各区动态',\r\n            source: ['beijingprice.cn/jgzx/gqdt/'],\r\n            target: '/jgzx/gqdt',\r\n        },\r\n        {\r\n            title: '价格资讯 - 通知公告',\r\n            source: ['beijingprice.cn/jgzx/tzgg/'],\r\n            target: '/jgzx/tzgg',\r\n        },\r\n        {\r\n            title: '价格资讯 - 价格早报',\r\n            source: ['beijingprice.cn/jgzx/jgzb/'],\r\n            target: '/jgzx/jgzb',\r\n        },\r\n        {\r\n            title: '综合信息 - 价格听证',\r\n            source: ['beijingprice.cn/zhxx/jgtz/'],\r\n            target: '/zhxx/jgtz',\r\n        },\r\n        {\r\n            title: '综合信息 - 价格监测定点单位名单',\r\n            source: ['beijingprice.cn/zhxx/jgjcdddwmd/'],\r\n            target: '/zhxx/jgjcdddwmd',\r\n        },\r\n        {\r\n            title: '综合信息 - 部门预算决算',\r\n            source: ['beijingprice.cn/bmys/'],\r\n            target: '/bmys',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}