{"version":3,"file":"blog-DqdsHGxw.js","names":[],"sources":["../../lib/routes/surfshark/blog.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/blog/:category{.+}?',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category');\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 15;\r\n\r\n    const rootUrl = 'https://surfshark.com';\r\n    const currentUrl = new URL(`blog${category ? `/${category}` : ''}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    let items = $('div.article-info')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('a');\r\n\r\n            return {\r\n                title: a.prop('title'),\r\n                link: a.prop('href'),\r\n                author: item.find('div.author, div.name').text().split('in')[0].trim(),\r\n                category: item\r\n                    .find('div.author, div.name')\r\n                    .find('a')\r\n                    .toArray()\r\n                    .map((c) => $(c).text()),\r\n                pubDate: parseDate(item.find('div.date, div.time').text().split('Â·')[0].trim(), 'YYYY, MMMM D'),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const content = load(detailResponse);\r\n\r\n                content('div.post-main-img').each(function () {\r\n                    const image = content(this).find('img');\r\n\r\n                    content(this).replaceWith(\r\n                        art(path.join(__dirname, 'templates/description.art'), {\r\n                            image: {\r\n                                src: image\r\n                                    .prop('srcset')\r\n                                    .match(/(https?:.*?\\.\\w+\\s)/g)\r\n                                    .pop()\r\n                                    .trim(),\r\n                                alt: image.prop('alt'),\r\n                            },\r\n                        })\r\n                    );\r\n                });\r\n\r\n                item.title = content('div.blog-post-title').text();\r\n                item.description = content('div.post-content').html();\r\n                item.author = content('meta[name=\"author\"]').prop('content');\r\n                item.category = content('div.name')\r\n                    .find('a')\r\n                    .toArray()\r\n                    .map((c) => content(c).text());\r\n                item.pubDate = parseDate(content('meta[property=\"article:published_time\"]').prop('content'));\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const icon = new URL($('link[rel=\"apple-touch-icon\"]').prop('href'), rootUrl).href;\r\n\r\n    return {\r\n        item: items,\r\n        title: $('title').text(),\r\n        link: currentUrl,\r\n        description: $('meta[property=\"og:description\"]').prop('content'),\r\n        language: $('html').prop('lang'),\r\n        image: $('meta[property=\"og:image\"]').prop('content'),\r\n        icon,\r\n        logo: icon,\r\n        subtitle: $('meta[property=\"og:title\"]').prop('content'),\r\n        author: $('meta[property=\"og:site_name\"]').prop('content'),\r\n    };\r\n}\r\n"],"mappings":"wdASA,MAAa,EAAe,CACxB,KAAM,uBACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,wBACV,EAAa,IAAI,IAAI,OAAO,EAAW,IAAI,IAAa,KAAM,GAAS,KAEvE,CAAE,KAAM,GAAa,MAAM,EAAI,GAE/B,EAAI,EAAK,GAEX,EAAQ,EAAE,oBACT,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAI,EAAK,KAAK,KAEpB,MAAO,CACH,MAAO,EAAE,KAAK,SACd,KAAM,EAAE,KAAK,QACb,OAAQ,EAAK,KAAK,wBAAwB,OAAO,MAAM,MAAM,GAAG,OAChE,SAAU,EACL,KAAK,wBACL,KAAK,KACL,UACA,IAAK,GAAM,EAAE,GAAG,QACrB,QAAS,EAAU,EAAK,KAAK,sBAAsB,OAAO,MAAM,KAAK,GAAG,OAAQ,mBAI5F,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACP,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAM,EAAI,EAAK,MAE1C,EAAU,EAAK,GA4BrB,OA1BA,EAAQ,qBAAqB,KAAK,UAAY,CAC1C,IAAM,EAAQ,EAAQ,MAAM,KAAK,OAEjC,EAAQ,MAAM,YACV,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACnD,MAAO,CACH,IAAK,EACA,KAAK,UACL,MAAM,wBACN,MACA,OACL,IAAK,EAAM,KAAK,aAMhC,EAAK,MAAQ,EAAQ,uBAAuB,OAC5C,EAAK,YAAc,EAAQ,oBAAoB,OAC/C,EAAK,OAAS,EAAQ,uBAAuB,KAAK,WAClD,EAAK,SAAW,EAAQ,YACnB,KAAK,KACL,UACA,IAAK,GAAM,EAAQ,GAAG,QAC3B,EAAK,QAAU,EAAU,EAAQ,2CAA2C,KAAK,YAE1E,MAKnB,IAAM,EAAO,IAAI,IAAI,EAAE,gCAAgC,KAAK,QAAS,GAAS,KAE9E,MAAO,CACH,KAAM,EACN,MAAO,EAAE,SAAS,OAClB,KAAM,EACN,YAAa,EAAE,mCAAmC,KAAK,WACvD,SAAU,EAAE,QAAQ,KAAK,QACzB,MAAO,EAAE,6BAA6B,KAAK,WAC3C,OACA,KAAM,EACN,SAAU,EAAE,6BAA6B,KAAK,WAC9C,OAAQ,EAAE,iCAAiC,KAAK"}