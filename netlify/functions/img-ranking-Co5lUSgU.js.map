{"version":3,"file":"img-ranking-Co5lUSgU.js","names":["route: Route","got"],"sources":["../../lib/routes/mihoyo/bbs/static-data.ts","../../lib/routes/mihoyo/bbs/img-ranking.ts"],"sourcesContent":["// 排行榜基本数据\r\nconst DATA_MAP = {\r\n    bh2: {\r\n        title: '崩坏学园2',\r\n        gids: 3,\r\n        default_forum: 'tongren',\r\n        default_ranking_type: 'weekly',\r\n        forums: {\r\n            tongren: {\r\n                title: '同人',\r\n                forum_id: 40,\r\n            },\r\n        },\r\n    },\r\n    bh3: {\r\n        title: '崩坏3',\r\n        gids: 1,\r\n        default_forum: 'tongren',\r\n        forums: {\r\n            tongren: {\r\n                title: '同人',\r\n                forum_id: 4,\r\n                default_cate: 'illustration',\r\n                cates: {\r\n                    comic: {\r\n                        title: '漫画',\r\n                        cate_id: 3,\r\n                    },\r\n                    illustration: {\r\n                        title: '插画',\r\n                        cate_id: 4,\r\n                    },\r\n                    cos: {\r\n                        title: 'COS',\r\n                        cate_id: 17,\r\n                    },\r\n                },\r\n            },\r\n        },\r\n    },\r\n    ys: {\r\n        title: '原神',\r\n        gids: 2,\r\n        default_forum: 'tongren',\r\n        forums: {\r\n            tongren: {\r\n                title: '同人',\r\n                forum_id: 29,\r\n                default_cate: 'illustration',\r\n                cates: {\r\n                    manual: {\r\n                        title: '手工',\r\n                        cate_id: 1,\r\n                    },\r\n                    qute: {\r\n                        title: 'Q版',\r\n                        cate_id: 2,\r\n                    },\r\n                    comic: {\r\n                        title: '漫画',\r\n                        cate_id: 3,\r\n                    },\r\n                    illustration: {\r\n                        title: '插画',\r\n                        cate_id: 4,\r\n                    },\r\n                },\r\n            },\r\n            cos: {\r\n                title: 'COS',\r\n                forum_id: 49,\r\n            },\r\n        },\r\n    },\r\n    wd: {\r\n        title: '未定事件簿',\r\n        gids: 4,\r\n        default_forum: 'tongren',\r\n        forums: {\r\n            tongren: {\r\n                title: '同人',\r\n                forum_id: 38,\r\n            },\r\n        },\r\n    },\r\n    sr: {\r\n        title: '崩坏：星穹铁道',\r\n        gids: 6,\r\n        default_forum: 'tongren',\r\n        forums: {\r\n            tongren: {\r\n                title: '同人',\r\n                forum_id: 56,\r\n            },\r\n        },\r\n    },\r\n    zzz: {\r\n        title: '绝区零',\r\n        gids: 8,\r\n        default_forum: 'tongren',\r\n        forums: {\r\n            tongren: {\r\n                title: '同人',\r\n                forum_id: 59,\r\n            },\r\n        },\r\n    },\r\n    dby: {\r\n        title: '大别野',\r\n        gids: 5,\r\n        default_forum: 'tongren',\r\n        forums: {\r\n            tongren: {\r\n                title: '同人',\r\n                forum_id: 39,\r\n            },\r\n            cos: {\r\n                title: 'COS',\r\n                forum_id: 47,\r\n            },\r\n        },\r\n    },\r\n};\r\n\r\n// 排行榜分类\r\nconst RANKING_TYPE_MAP = {\r\n    daily: {\r\n        id: 1,\r\n        title: '日榜',\r\n    },\r\n    weekly: {\r\n        id: 2,\r\n        title: '周榜',\r\n    },\r\n    monthly: {\r\n        id: 3,\r\n        title: '月榜',\r\n    },\r\n};\r\n\r\nexport { DATA_MAP, RANKING_TYPE_MAP };\r\n","import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { DATA_MAP, RANKING_TYPE_MAP } from './static-data';\r\nimport { post2item } from './utils';\r\n\r\nconst getGameInfo = (game) => ({\r\n    gids: DATA_MAP[game]?.gids,\r\n    title: DATA_MAP[game]?.title,\r\n});\r\nconst getForumInfo = (game, forum_type) => {\r\n    forum_type = forum_type || DATA_MAP[game]?.default_forum || 'tongren';\r\n    const forum = DATA_MAP[game]?.forums?.[forum_type];\r\n    return {\r\n        forum_id: forum?.forum_id,\r\n        title: `${forum?.title}榜`,\r\n    };\r\n};\r\nconst getCateInfo = (game, forum_type, cate_type) => {\r\n    forum_type = forum_type || DATA_MAP[game]?.default_forum || 'tongren';\r\n    const forum = DATA_MAP[game]?.forums?.[forum_type];\r\n    const default_cate = forum?.default_cate;\r\n    if (!default_cate) {\r\n        return {\r\n            title: '',\r\n            cate_id: '0',\r\n        };\r\n    }\r\n    cate_type = cate_type || default_cate;\r\n    return {\r\n        title: `${forum?.cates?.[cate_type]?.title}榜`,\r\n        cate_id: forum?.cates?.[cate_type]?.cate_id,\r\n    };\r\n};\r\nconst getRankingTypeInfo = (game, ranking_type) => {\r\n    ranking_type = ranking_type || DATA_MAP[game]?.default_ranking_type || 'daily';\r\n    return {\r\n        id: RANKING_TYPE_MAP[ranking_type]?.id,\r\n        title: RANKING_TYPE_MAP[ranking_type]?.title,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/bbs/img-ranking/:game/:routeParams?',\r\n    categories: ['game'],\r\n    example: '/mihoyo/bbs/img-ranking/ys/forumType=tongren&cateType=illustration&rankingType=daily',\r\n    parameters: { game: '游戏缩写', routeParams: '额外参数；请参阅以下说明和表格' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['miyoushe.com/:game/imgRanking/:forum_id/:ranking_id/:cate_id'],\r\n            target: '/bbs/img-ranking/:game',\r\n        },\r\n    ],\r\n    name: '米游社 - 同人榜',\r\n    maintainers: ['CaoMeiYouRen'],\r\n    handler,\r\n    description: `| 键          | 含义                                  | 接受的值                                                             | 默认值       |\r\n| ----------- | ------------------------------------- | -------------------------------------------------------------------- | ------------ |\r\n| forumType   | 主榜类型（仅原神、大别野有 cos 主榜） | tongren/cos                                                          | tongren      |\r\n| cateType    | 子榜类型（仅崩坏三、原神有子榜）      | 崩坏三：illustration/comic/cos；原神：illustration/comic/qute/manual | illustration |\r\n| rankingType | 排行榜类型（崩坏二没有日榜）          | daily/weekly/monthly                                                 | daily        |\r\n| lastId      | 当前页 id（用于分页）                 | 数字                                                                 | 1            |\r\n\r\n  游戏缩写\r\n\r\n| 崩坏三 | 原神 | 崩坏二 | 未定事件簿 | 星穹铁道 | 大别野 | 绝区零 |\r\n| ------ | ---- | ------ | ---------- | -------- | ------ | ------ |\r\n| bh3    | ys   | bh2    | wd         | sr       | dby    | zzz    |\r\n\r\n  主榜类型\r\n\r\n| 同人榜  | COS 榜 |\r\n| ------- | ------ |\r\n| tongren | cos    |\r\n\r\n  子榜类型\r\n\r\n  崩坏三 子榜\r\n\r\n| 插画         | 漫画  | COS |\r\n| ------------ | ----- | --- |\r\n| illustration | comic | cos |\r\n\r\n  原神 子榜\r\n\r\n| 插画         | 漫画  | Q 版 | 手工   |\r\n| ------------ | ----- | ---- | ------ |\r\n| illustration | comic | qute | manual |\r\n\r\n  排行榜类型\r\n\r\n| 日榜  | 周榜   | 月榜    |\r\n| ----- | ------ | ------- |\r\n| daily | weekly | monthly |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const game = ctx.req.param('game');\r\n    const routeParams = Object.fromEntries(new URLSearchParams(ctx.req.param('routeParams')));\r\n    const { forumType: forum_type = 'tongren', cateType: cate_type, rankingType: ranking_type, lastId: last_id = '' } = routeParams;\r\n    const page_size = ctx.req.query('limit') || '20';\r\n    const { gids, title: game_title } = getGameInfo(game);\r\n    if (!gids) {\r\n        throw new Error('未知的游戏！');\r\n    }\r\n    const { forum_id, title: forum_title } = getForumInfo(game, forum_type);\r\n    if (!forum_id) {\r\n        throw new Error(`${game_title} 的排行榜不存在！`);\r\n    }\r\n    const { cate_id, title: cate_title } = getCateInfo(game, forum_type, cate_type);\r\n    const { id: type, title: type_title } = getRankingTypeInfo(game, ranking_type);\r\n    const query = new URLSearchParams({\r\n        gids,\r\n        forum_id,\r\n        cate_id,\r\n        type,\r\n        page_size,\r\n        last_id,\r\n    }).toString();\r\n    const url = `https://bbs-api.miyoushe.com/post/wapi/getImagePostList?${query}`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n    });\r\n    const list = response?.data?.data?.list;\r\n    if (!list) {\r\n        throw new Error('未获取到数据！');\r\n    }\r\n    const title = `米游社-${game_title}-${forum_title}${cate_title ? `-${cate_title}` : ''}-${type_title}`;\r\n    const items = list.map((e) => post2item(e));\r\n    const data = {\r\n        title,\r\n        link: url,\r\n        item: items,\r\n    };\r\n    return data;\r\n}\r\n"],"mappings":"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"}