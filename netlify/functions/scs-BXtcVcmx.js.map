{"version":3,"file":"scs-BXtcVcmx.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/nuist/scs.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nconst baseTitle = 'NUIST CS（南信大计软院）';\r\nconst baseUrl = 'https://scs.nuist.edu.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/scs/:category?',\r\n    categories: ['university'],\r\n    example: '/nuist/scs/xwkx',\r\n    parameters: { category: '默认为新闻快讯' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['scs.nuist.edu.cn/:category/list.htm'],\r\n            target: '/scs/:category',\r\n        },\r\n    ],\r\n    name: 'NUIST CS（南信大计软院）',\r\n    maintainers: ['gylidian'],\r\n    handler,\r\n    description: `| 新闻快讯 | 通知公告 | 教务信息 | 科研动态 | 学子风采 |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| xwkx     | tzgg     | jwxx     | kydt     | xzfc     |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'xwkx' } = ctx.req.param();\r\n    const link = `${baseUrl}/${category}/list.htm`;\r\n\r\n    const response = await got(link);\r\n    const $ = load(response.data);\r\n\r\n    const list = $('.newsList ul')\r\n        .eq(0)\r\n        .find('li')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item.find('a').attr('title'),\r\n                link: new URL(item.find('a').attr('href'), baseUrl).href,\r\n                pubDate: parseDate(item.find('.newsDate').text()),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await got(item.link);\r\n                const $ = load(response.data);\r\n\r\n                const authorMatch = $('.newsTitleAddDate')\r\n                    .text()\r\n                    .match(/发布者：(.*)发布时间/);\r\n                item.author = authorMatch ? authorMatch[1].trim() : null;\r\n                item.description = $('.newsContent').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: baseTitle + '：' + $('head title').text(),\r\n        description: $('meta[name=description]').attr('content'),\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAKA,MACM,EAAU,2BAEHA,EAAe,CACxB,KAAM,kBACN,WAAY,CAAC,cACb,QAAS,kBACT,WAAY,CAAE,SAAU,WACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,uCACT,OAAQ,mBAGhB,KAAM,mBACN,YAAa,CAAC,YACd,UACA,YAAa;;2DAKjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,QAAW,EAAI,IAAI,QAChC,EAAO,GAAG,EAAQ,GAAG,EAAS,WAE9B,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,gBACV,GAAG,GACH,KAAK,MACL,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,KAAK,KAAK,SAC3B,KAAM,IAAI,IAAI,EAAK,KAAK,KAAK,KAAK,QAAS,GAAS,KACpD,QAAS,EAAU,EAAK,KAAK,aAAa,WAIhD,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAW,MAAMF,EAAI,EAAK,MAC1BG,EAAI,EAAKD,EAAS,MAElB,EAAcC,EAAE,qBACjB,OACA,MAAM,gBAGX,MAFA,GAAK,OAAS,EAAc,EAAY,GAAG,OAAS,KACpD,EAAK,YAAcA,EAAE,gBAAgB,OAC9B,MAKnB,MAAO,CACH,MAAO,oBAAkB,EAAE,cAAc,OACzC,YAAa,EAAE,0BAA0B,KAAK,WAC9C,OACA,KAAM"}