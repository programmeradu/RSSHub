{"version":3,"file":"gamer520-BCbyD0TP.js","names":["route: Route","cache","got","items: DataItem[]"],"sources":["../../lib/routes/gamer520/index.ts"],"sourcesContent":["import { Data, DataItem, Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { Context } from 'hono';\r\n\r\nexport const route: Route = {\r\n    path: '/:category?/:order?',\r\n    categories: ['game'],\r\n    example: '/gamer520/switchyouxi',\r\n    parameters: {\r\n        category: '分类，见下表',\r\n        order: '排序，发布日期: date; 修改日期: modified',\r\n    },\r\n    features: {\r\n        antiCrawler: true,\r\n    },\r\n    name: '文章',\r\n    maintainers: ['xzzpig'],\r\n    handler,\r\n    url: 'www.gamer520.com/',\r\n    description: `分类\r\n\r\n| 所有 | Switch 游戏下载 | 金手指     | 3A 巨作 | switch 主题 | PC 游戏 |\r\n| ---- | --------------- | ---------- | ------- | ----------- | ------- |\r\n| all  | switchyouxi     | jinshouzhi | 3ajuzuo | zhuti       | pcgame  |`,\r\n};\r\n\r\ninterface Post {\r\n    id: number;\r\n    guid: { rendered: string };\r\n    title: { rendered: string };\r\n    date_gmt: string;\r\n    modified_gmt: string;\r\n    categories?: number[];\r\n    content: { rendered: string };\r\n}\r\n\r\ninterface Category {\r\n    id: number;\r\n    name: string;\r\n    link: string;\r\n    slug: string;\r\n}\r\n\r\nasync function getCategories(baseUrl: string): Promise<Category[]> {\r\n    return (await cache.tryGet('gamer520:categories', async () => {\r\n        const { data } = await got(`${baseUrl}/wp-json/wp/v2/categories`);\r\n        return data.map((category) => ({ slug: category.slug, id: category.id, name: category.name, link: category.link }));\r\n    })) as Category[];\r\n}\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const baseUrl = 'https://www.gamer520.com';\r\n    const categories = await getCategories(baseUrl);\r\n\r\n    const category = ctx.req.param('category') ?? 'all';\r\n    const order = ctx.req.param('order');\r\n    const categoryId = categories.find((c) => c.slug === category)?.id;\r\n\r\n    const { data } = (await got(`${baseUrl}/wp-json/wp/v2/posts`, {\r\n        searchParams: {\r\n            categories: categoryId,\r\n            orderby: order,\r\n            per_page: ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit') as string) : undefined,\r\n        },\r\n    })) as unknown as { data: Post[] };\r\n\r\n    const items: DataItem[] = data.map((item) => ({\r\n        guid: `gamer520:${item.id}`,\r\n        title: item.title.rendered,\r\n        link: item.guid.rendered,\r\n        pubDate: parseDate(item.date_gmt),\r\n        updated: parseDate(item.modified_gmt),\r\n        category: item.categories?.map((c) => categories.find((ca) => ca.id === c)?.name ?? '').filter((c) => c !== '') ?? [],\r\n\r\n        description: item.content.rendered,\r\n    }));\r\n\r\n    return {\r\n        title: '全球游戏交流中心-' + (categories.find((c) => c.slug === category)?.name ?? '所有'),\r\n        link: categories.find((c) => c.slug === category)?.link ?? baseUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"yUAMA,MAAaA,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,QACb,QAAS,wBACT,WAAY,CACR,SAAU,SACV,MAAO,iCAEX,SAAU,CACN,YAAa,IAEjB,KAAM,KACN,YAAa,CAAC,UACd,UACA,IAAK,oBACL,YAAa;;;;4EAwBjB,eAAe,EAAc,EAAsC,CAC/D,OAAQ,MAAMC,EAAM,OAAO,sBAAuB,SAAY,CAC1D,GAAM,CAAE,QAAS,MAAMC,EAAI,GAAG,EAAQ,4BACtC,OAAO,EAAK,IAAK,IAAc,CAAE,KAAM,EAAS,KAAM,GAAI,EAAS,GAAI,KAAM,EAAS,KAAM,KAAM,EAAS,UAInH,eAAe,EAAQ,EAA6B,CAChD,IAAM,EAAU,2BACV,EAAa,MAAM,EAAc,GAEjC,EAAW,EAAI,IAAI,MAAM,aAAe,MACxC,EAAQ,EAAI,IAAI,MAAM,SACtB,EAAa,EAAW,KAAM,GAAM,EAAE,OAAS,IAAW,GAE1D,CAAE,QAAU,MAAMA,EAAI,GAAG,EAAQ,sBAAuB,CAC1D,aAAc,CACV,WAAY,EACZ,QAAS,EACT,SAAU,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAsB,IAAA,MAIzFC,EAAoB,EAAK,IAAK,IAAU,CAC1C,KAAM,YAAY,EAAK,KACvB,MAAO,EAAK,MAAM,SAClB,KAAM,EAAK,KAAK,SAChB,QAAS,EAAU,EAAK,UACxB,QAAS,EAAU,EAAK,cACxB,SAAU,EAAK,YAAY,IAAK,GAAM,EAAW,KAAM,GAAO,EAAG,KAAO,IAAI,MAAQ,IAAI,OAAQ,GAAM,IAAM,KAAO,GAEnH,YAAa,EAAK,QAAQ,YAG9B,MAAO,CACH,MAAO,aAAe,EAAW,KAAM,GAAM,EAAE,OAAS,IAAW,MAAQ,MAC3E,KAAM,EAAW,KAAM,GAAM,EAAE,OAAS,IAAW,MAAQ,EAC3D,KAAM"}