{"version":3,"file":"user-BmB9X7xf.js","names":["route: Route","got"],"sources":["../../lib/routes/hpoi/user.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nconst root_url = 'https://www.hpoi.net';\r\n\r\nconst titleMap = {\r\n    want: '想买',\r\n    preorder: '预定',\r\n    buy: '已入',\r\n    care: '关注',\r\n    resell: '有过',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/user/:user_id/:caty',\r\n    categories: ['anime'],\r\n    example: '/hpoi/user/116297/buy',\r\n    parameters: {\r\n        user_id: {\r\n            description: '用户ID',\r\n        },\r\n        caty: {\r\n            description: '类别',\r\n            options: [\r\n                { value: 'want', label: '想买' },\r\n                { value: 'preorder', label: '预定' },\r\n                { value: 'buy', label: '已入' },\r\n                { value: 'care', label: '关注' },\r\n                { value: 'resell', label: '有过' },\r\n            ],\r\n            default: 'buy',\r\n        },\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '用户动态',\r\n    maintainers: ['DIYgod', 'luyuhuang'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { user_id, caty } = ctx.req.param();\r\n\r\n    const url = `${root_url}/user/${user_id}/hobby?order=actionDate&view=2&favState=${caty}`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n    const list = $('.collect-hobby-list-small')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: titleMap[caty] + ': ' + item.find('.name').text(),\r\n                link: 'https://www.hpoi.net/' + item.find('.name').attr('href'),\r\n                description: `<img src=\"${item.find('img').attr('src').replace('/s/', '/n/')}\"><br>${item.find('.pay').text()}<br>${item.find('.score').text()}`,\r\n            };\r\n        });\r\n\r\n    const title = $('.hpoi-collect-head .info p').eq(0).text() + '的手办 - ' + titleMap[caty];\r\n\r\n    return {\r\n        title,\r\n        link: url,\r\n        item: list,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"+PAIA,MAEM,EAAW,CACb,KAAM,KACN,SAAU,KACV,IAAK,KACL,KAAM,KACN,OAAQ,MAGCA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,SACb,QAAS,wBACT,WAAY,CACR,QAAS,CACL,YAAa,QAEjB,KAAM,CACF,YAAa,KACb,QAAS,CACL,CAAE,MAAO,OAAQ,MAAO,MACxB,CAAE,MAAO,WAAY,MAAO,MAC5B,CAAE,MAAO,MAAO,MAAO,MACvB,CAAE,MAAO,OAAQ,MAAO,MACxB,CAAE,MAAO,SAAU,MAAO,OAE9B,QAAS,QAGjB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,SAAU,aACxB,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,UAAS,QAAS,EAAI,IAAI,QAE5B,EAAM,6BAAoB,EAAQ,0CAA0C,IAC5E,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,QAGE,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,6BACV,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAS,GAAQ,KAAO,EAAK,KAAK,SAAS,OAClD,KAAM,wBAA0B,EAAK,KAAK,SAAS,KAAK,QACxD,YAAa,aAAa,EAAK,KAAK,OAAO,KAAK,OAAO,QAAQ,MAAO,OAAO,QAAQ,EAAK,KAAK,QAAQ,OAAO,MAAM,EAAK,KAAK,UAAU,YAI9I,EAAQ,EAAE,8BAA8B,GAAG,GAAG,OAAS,SAAW,EAAS,GAEjF,MAAO,CACH,QACA,KAAM,EACN,KAAM,EACN,WAAY"}