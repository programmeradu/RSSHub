import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{parseDate as e}from"./parse-date-Bgabdhlb.js";import{ofetch_default as t}from"./ofetch-Bzt0BXUH.js";import{timezone as n}from"./timezone-BrNu6iXe.js";import{ViewType as r}from"./types-A5bA50Mg.js";import{invalid_parameter_default as i}from"./invalid-parameter-CUJdROXf.js";import{isValidHost as a}from"./valid-host-DEPw8oAS.js";import{load as o}from"cheerio";import s from"markdown-it";const c=s({html:!0}),l={path:`/posts/:site`,categories:[`blog`],example:`/posts/walnut`,parameters:{site:"站点名，原则上只要是 `{site}.hedwig.pub` 都可以匹配"},features:{supportRadar:!1},name:`Posts`,url:`hedwig.pub`,maintainers:[`zwithz`,`GetToSet`],view:r.Articles,handler:async r=>{let{site:s}=r.req.param();if(!a(s))throw new i(`Invalid site`);let l=`https://${s}.hedwig.pub`,u=await t(l),d=o(u),f=d(`script#__NEXT_DATA__`).text(),p=JSON.parse(f),m=p.props.pageProps,h=m.issuesByNewsletter.map(t=>{let r=t.blocks.reduce((e,t)=>e+c.render(t.markdown.text),``);return{title:t.subject,description:r,pubDate:n(e(t.publishAt,`YYYY-MM-DDTHH:mm:ss.SSS[Z]`),0),link:`${l}/i/${t.urlFriendlyName}`}});return{title:m.newsletter.name,description:m.newsletter.about,link:l,item:h}}};export{l as route};
//# sourceMappingURL=posts-b5_GwLdk.js.map