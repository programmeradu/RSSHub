{"version":3,"file":"utils-BOusfAye.js","names":["MarkdownIt","got","cache"],"sources":["../../lib/routes/studygolang/utils.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport MarkdownIt from 'markdown-it';\r\nconst md = MarkdownIt({\r\n    html: true,\r\n    linkify: true,\r\n});\r\n\r\nconst FetchGoItems = async (ctx, rewriteId) => {\r\n    const id = rewriteId || (ctx.req.param('id') ?? 'weekly');\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 50;\r\n\r\n    const rootUrl = 'https://studygolang.com';\r\n    const currentUrl = `${rootUrl}/go/${id}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    let items = $('.right-info .title')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('a');\r\n\r\n            return {\r\n                title: a.text(),\r\n                link: `${rootUrl}${a.attr('href')}`,\r\n                author: item.next().find('.author').text(),\r\n                category: item\r\n                    .next()\r\n                    .find('.node')\r\n                    .toArray()\r\n                    .map((n) => $(n).text()),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n\r\n                const content = load(detailResponse.data);\r\n\r\n                item.pubDate = timezone(parseDate(content('.timeago').first().attr('title')), +8);\r\n\r\n                try {\r\n                    item.description = md.render(content('.content').html());\r\n                } catch {\r\n                    // no-empty\r\n                }\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `Go语言中文网 - ${$('.title h2').text()}`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n};\r\n\r\nexport { FetchGoItems };\r\n"],"mappings":"qQAMA,MAAM,EAAKA,EAAW,CAClB,KAAM,GACN,QAAS,KAGP,EAAe,MAAO,EAAK,IAAc,CAC3C,IAAM,EAAK,IAAc,EAAI,IAAI,MAAM,OAAS,UAC1C,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GAE3E,EAAU,0BACV,EAAa,GAAG,EAAQ,MAAM,IAE9B,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAEpB,EAAQ,EAAE,sBACT,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAI,EAAK,KAAK,KAEpB,MAAO,CACH,MAAO,EAAE,OACT,KAAM,GAAG,IAAU,EAAE,KAAK,UAC1B,OAAQ,EAAK,OAAO,KAAK,WAAW,OACpC,SAAU,EACL,OACA,KAAK,SACL,UACA,IAAK,GAAM,EAAE,GAAG,WA2BjC,MAvBA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGR,EAAU,EAAK,EAAe,MAEpC,EAAK,QAAU,EAAS,EAAU,EAAQ,YAAY,QAAQ,KAAK,UAAW,GAE9E,GAAI,CACA,EAAK,YAAc,EAAG,OAAO,EAAQ,YAAY,aAC7C,EAIR,OAAO,MAKZ,CACH,MAAO,aAAa,EAAE,aAAa,SACnC,KAAM,EACN,KAAM"}