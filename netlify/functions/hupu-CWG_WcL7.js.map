{"version":3,"file":"hupu-CWG_WcL7.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/hupu/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst categories = {\r\n    nba: {\r\n        title: 'NBA',\r\n        data: 'newsData',\r\n    },\r\n    cba: {\r\n        title: 'CBA',\r\n        data: 'newsData',\r\n    },\r\n    soccer: {\r\n        title: '足球',\r\n        data: 'news',\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: ['/dept/:category?', '/:category?'],\r\n    radar: [\r\n        {\r\n            source: ['m.hupu.com/:category', 'm.hupu.com/'],\r\n            target: '/:category',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `| NBA | CBA | 足球   |\r\n| --- | --- | ------ |\r\n| nba | cba | soccer |\r\n\r\n::: tip\r\n  电竞分类参见 [游戏热帖](https://bbs.hupu.com/all-gg) 的对应路由 [\\`/hupu/all/all-gg\\`](https://rsshub.app/hupu/all/all-gg)。\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? 'soccer';\r\n\r\n    const rootUrl = 'https://m.hupu.com';\r\n    const currentUrl = `${rootUrl}/${category}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const data = JSON.parse(response.data.match(/\"props\":(.*),\"page\":\"\\//)[1]);\r\n\r\n    let items = data.pageProps[categories[category].data].map((item) => ({\r\n        title: item.title,\r\n        pubDate: timezone(parseDate(item.publishTime), +8),\r\n        link: item.link.replace(/bbs\\.hupu.com/, 'm.hupu.com/bbs'),\r\n    }));\r\n\r\n    items = await Promise.all(\r\n        items\r\n            .filter((item) => !/subject/.test(item.link))\r\n            .map((item) =>\r\n                cache.tryGet(item.link, async () => {\r\n                    try {\r\n                        const detailResponse = await got({\r\n                            method: 'get',\r\n                            url: item.link,\r\n                        });\r\n\r\n                        const content = load(detailResponse.data);\r\n\r\n                        item.author = content('.bbs-user-info-name, .bbs-user-wrapper-content-name-span').text();\r\n                        item.category = content('.basketballTobbs_tag > a, .tag-player-team')\r\n                            .toArray()\r\n                            .map((c) => content(c).text());\r\n\r\n                        content('.basketballTobbs_tag').remove();\r\n                        content('.hupu-img').each(function () {\r\n                            content(this)\r\n                                .parent()\r\n                                .html(`<img src=\"${content(this).attr('data-origin')}\">`);\r\n                        });\r\n\r\n                        item.description = content('#bbs-thread-content, .bbs-content-font').html();\r\n                    } catch {\r\n                        // no-empty\r\n                    }\r\n\r\n                    return item;\r\n                })\r\n            )\r\n    );\r\n\r\n    return {\r\n        title: `虎扑 - ${categories[category].title}`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAM,EAAa,CACf,IAAK,CACD,MAAO,MACP,KAAM,YAEV,IAAK,CACD,MAAO,MACP,KAAM,YAEV,OAAQ,CACJ,MAAO,KACP,KAAM,SAIDA,EAAe,CACxB,KAAM,CAAC,mBAAoB,eAC3B,MAAO,CACH,CACI,OAAQ,CAAC,uBAAwB,eACjC,OAAQ,eAGhB,KAAM,UACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;MASjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,SAGxC,EAAa,sBAAc,IAE3B,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAO,KAAK,MAAM,EAAS,KAAK,MAAM,2BAA2B,IAEnE,EAAQ,EAAK,UAAU,EAAW,GAAU,MAAM,IAAK,IAAU,CACjE,MAAO,EAAK,MACZ,QAAS,EAAS,EAAU,EAAK,aAAc,GAC/C,KAAM,EAAK,KAAK,QAAQ,gBAAiB,qBAsC7C,MAnCA,GAAQ,MAAM,QAAQ,IAClB,EACK,OAAQ,GAAS,CAAC,UAAU,KAAK,EAAK,OACtC,IAAK,GACFC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,CACA,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGR,EAAU,EAAK,EAAe,MAEpC,EAAK,OAAS,EAAQ,4DAA4D,OAClF,EAAK,SAAW,EAAQ,8CACnB,UACA,IAAK,GAAM,EAAQ,GAAG,QAE3B,EAAQ,wBAAwB,SAChC,EAAQ,aAAa,KAAK,UAAY,CAClC,EAAQ,MACH,SACA,KAAK,aAAa,EAAQ,MAAM,KAAK,eAAe,OAG7D,EAAK,YAAc,EAAQ,0CAA0C,YACjE,EAIR,OAAO,MAKhB,CACH,MAAO,QAAQ,EAAW,GAAU,QACpC,KAAM,EACN,KAAM"}