{"version":3,"file":"utils-BBpL0jtY.js","names":[],"sources":["../../lib/routes/penguin-random-house/utils.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst parseBookInList = (element) => {\r\n    const $ = load(element);\r\n    const title = $('h2').first().text();\r\n    const author = $('h2.author').first().text();\r\n    const description = $('.desc').first().text();\r\n    let imageSrc = $('img.cover__backcover').attr('src');\r\n    let imageAlt = $('img.cover__backcover').attr('alt');\r\n    if (!imageSrc) {\r\n        imageSrc = $('img.img-responsive').attr('data-src');\r\n        imageAlt = $('img.img-responsive').attr('alt');\r\n    }\r\n\r\n    return art(path.join(__dirname, 'templates/book.art'), {\r\n        title,\r\n        author,\r\n        description,\r\n        imageSrc,\r\n        imageAlt,\r\n    });\r\n};\r\n\r\nconst parsePubDate = (data) => {\r\n    const dateString = data('script')\r\n        .toArray()\r\n        .find((element) => {\r\n            const fullString = element.children[0];\r\n            if (!fullString || !fullString.data) {\r\n                return false;\r\n            }\r\n            return fullString.data.includes('post_date');\r\n        });\r\n    if (dateString.length === 0) {\r\n        return;\r\n    }\r\n\r\n    const dateMatch = dateString.children[0].data.match(/(?<=\"post_date\":\").*?(?=\")/);\r\n    if (!dateMatch) {\r\n        return;\r\n    }\r\n\r\n    return parseDate(dateMatch[0]);\r\n};\r\n\r\nconst parseBooks = (element) => {\r\n    const $ = load(element);\r\n    const description = $('h2.read-down-text').first().html();\r\n    let mainBlock = '';\r\n\r\n    $('.awesome-list>li').map((i, element) => {\r\n        const appending = parseBookInList(element);\r\n        mainBlock += appending;\r\n        return appending;\r\n    });\r\n\r\n    return {\r\n        description,\r\n        content: mainBlock,\r\n        pubDate: parsePubDate($),\r\n    };\r\n};\r\n\r\nconst parseArticle = (element) => {\r\n    const $ = load(element);\r\n    const description = $('h2.hdr-smalltxt').first().html();\r\n    const imageSrc = $('div.img-block>img').first().attr('src');\r\n    const imageAlt = $('div.img-block>img').first().attr('alt');\r\n    let mainBlock = '';\r\n\r\n    const descriptionBlock = art(path.join(__dirname, 'templates/articleHeader.art'), {\r\n        description,\r\n        imageSrc,\r\n        imageAlt,\r\n    });\r\n\r\n    $('div.main-content>p,div.main-content>ul').map((i, element) => {\r\n        const appending = load(element);\r\n        mainBlock += appending.html();\r\n        return appending;\r\n    });\r\n\r\n    return {\r\n        description: descriptionBlock,\r\n        content: mainBlock,\r\n        pubDate: parsePubDate($),\r\n    };\r\n};\r\n\r\nconst parseList = (items, ctx, contentParser) =>\r\n    Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.url, async () => {\r\n                const itemRes = await got(item.url);\r\n\r\n                const itemPage = itemRes.data;\r\n                const itemParsed = contentParser(itemPage);\r\n\r\n                const result = {\r\n                    title: item.title,\r\n                    description: itemParsed.description + '<br>' + itemParsed.content,\r\n                    pubDate: itemParsed.pubDate,\r\n                    link: item.url,\r\n                };\r\n\r\n                return result;\r\n            })\r\n        )\r\n    );\r\n\r\nexport default { parseList, parseBooks, parseArticle };\r\n"],"mappings":"wUAOA,MAAM,EAAmB,GAAY,CACjC,IAAM,EAAI,EAAK,GACT,EAAQ,EAAE,MAAM,QAAQ,OACxB,EAAS,EAAE,aAAa,QAAQ,OAChC,EAAc,EAAE,SAAS,QAAQ,OACnC,EAAW,EAAE,wBAAwB,KAAK,OAC1C,EAAW,EAAE,wBAAwB,KAAK,OAM9C,OALK,IACD,EAAW,EAAE,sBAAsB,KAAK,YACxC,EAAW,EAAE,sBAAsB,KAAK,QAGrC,EAAI,EAAA,KAAA,EAAA,+BAA4C,CACnD,QACA,SACA,cACA,WACA,cAIF,EAAgB,GAAS,CAC3B,IAAM,EAAa,EAAK,UACnB,UACA,KAAM,GAAY,CACf,IAAM,EAAa,EAAQ,SAAS,GAIpC,MAHI,CAAC,GAAc,CAAC,EAAW,KACpB,GAEJ,EAAW,KAAK,SAAS,eAExC,GAAI,EAAW,SAAW,EACtB,OAGJ,IAAM,EAAY,EAAW,SAAS,GAAG,KAAK,MAAM,8BAC/C,KAIL,OAAO,EAAU,EAAU,KAGzB,EAAc,GAAY,CAC5B,IAAM,EAAI,EAAK,GACT,EAAc,EAAE,qBAAqB,QAAQ,OAC/C,EAAY,GAQhB,OANA,EAAE,oBAAoB,KAAK,EAAG,IAAY,CACtC,IAAM,EAAY,EAAgB,GAElC,MADA,IAAa,EACN,IAGJ,CACH,cACA,QAAS,EACT,QAAS,EAAa,KAIxB,EAAgB,GAAY,CAC9B,IAAM,EAAI,EAAK,GACT,EAAc,EAAE,mBAAmB,QAAQ,OAC3C,EAAW,EAAE,qBAAqB,QAAQ,KAAK,OAC/C,EAAW,EAAE,qBAAqB,QAAQ,KAAK,OACjD,EAAY,GAEV,EAAmB,EAAI,EAAA,KAAA,EAAA,wCAAqD,CAC9E,cACA,WACA,aASJ,OANA,EAAE,0CAA0C,KAAK,EAAG,IAAY,CAC5D,IAAM,EAAY,EAAK,GAEvB,MADA,IAAa,EAAU,OAChB,IAGJ,CACH,YAAa,EACb,QAAS,EACT,QAAS,EAAa,KAIxB,GAAa,EAAO,EAAK,IAC3B,QAAQ,IACJ,EAAM,IAAK,GACP,EAAM,OAAO,EAAK,IAAK,SAAY,CAC/B,IAAM,EAAU,MAAM,EAAI,EAAK,KAEzB,EAAW,EAAQ,KACnB,EAAa,EAAc,GAE3B,EAAS,CACX,MAAO,EAAK,MACZ,YAAa,EAAW,YAAc,OAAS,EAAW,QAC1D,QAAS,EAAW,QACpB,KAAM,EAAK,KAGf,OAAO,MAKvB,IAAA,EAAe,CAAE,YAAW,aAAY"}