import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{config as n}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as r}from"./cache-kimkMTWJ.js";import{art as i}from"./render-CxhTJIsl.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import o from"node:path";import{load as s}from"cheerio";t();const c=`https://app.theinitium.com/`,l={path:`/app/:category?`,categories:[`new-media`],example:`/theinitium/app`,parameters:{category:`Category, see below, latest_sc by default`},features:{requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`App`,maintainers:[`quiniapiezoelectricity`],radar:[{source:[`app.theinitium.com/t/latest/:category`],target:`/app/:category`}],handler:m,description:`抓取[The Initium App](https://app.theinitium.com/)的文章列表

::: warning
此路由暂不支持登陆认证
:::

Category 栏目：

| ----- | 简体中文     | 繁體中文      |
| ----- | ----------------- | ---------------- |
| 最新   | latest_sc | latest_tc |
| 日报   | daily_brief_sc | daily_brief_tc |
| 速递   | whats_new_sc | whats_new_tc |
| 专题   | report_sc | report_tc |
| 评论   | opinion_sc | opinion_tc |
| 国际   | international_sc | international_tc |
| 大陆   | mainland_sc | mainland_tc |
| 香港   | hongkong_sc | hongkong_tc |
| 台湾   | taiwan_sc | taiwan_tc |
| 播客   | article_audio_sc | article_audio_tc |`},u=(e,t,n,r)=>{let i=e(t);if(r)try{let e=i.attr(n);e&&i.attr(n,new URL(e,r).href)}catch{}};async function d(e){return await a({method:`get`,url:e,headers:{"User-Agent":`PugpigBolt v4.1.8 (iPhone, iOS 18.2.1) on phone (model iPhone15,2)`}})}async function f(t){let n=await d(t.href),r=s(n.data);r(`a, area`).each((e,t)=>{u(r,t,`href`,c)}),r(`img, video, audio, source, iframe, embed, track`).each((e,t)=>{u(r,t,`src`,c),r(t).removeAttr(`srcset`)}),r(`video[poster]`).each((e,t)=>{u(r,t,`poster`,c)});let a=r(`.pp-article__body`);return a.find(`.block-related-articles`).remove(),a.find(`.copyright`).wrapInner(`<small></small>`).wrapInner(`<figure></figure>`),a.find(`figure.wp-block-pullquote`).children().unwrap(),a.find(`div.block-explanation-note`).wrapInner(`<blockquote></blockquote>`),a.find(`div.wp-block-tcc-author-note`).wrapInner(`<em></em>`).after(`<hr>`),a.find(`p.has-small-font-size`).wrapInner(`<small></small>`),i(o.join(e,`templates/description-b7ee8c6a.art`),{standfirst:r(`.pp-header-group__standfirst`).html(),coverImage:r(`.pp-media__image`).attr(`src`),coverCaption:r(`.pp-media__caption`).html(),article:a.html()})}async function p(t){let n=await a(t.href),r=s(n.data),c=r(`.entry-content`);return c.find(`.block-related-articles`).remove(),c.find(`.cta-subscription`).remove(),c.find(`.entry-copyright`).wrapInner(`<small></small>`).wrapInner(`<figure></figure>`),c.find(`figure.wp-block-pullquote`).children().unwrap(),c.find(`div.block-explanation-note`).wrapInner(`<blockquote></blockquote>`),c.find(`div.wp-block-tcc-author-note`).wrapInner(`<em></em>`).after(`<hr>`),c.find(`p.has-small-font-size`).wrapInner(`<small></small>`),i(o.join(e,`templates/description-b7ee8c6a.art`),{standfirst:r(`span.caption1`).html(),coverImage:r(`.wp-post-image`).attr(`src`),coverCaption:r(`.image-caption`).html(),article:c.html()})}async function m(e){let t=e.req.param(`category`)??`latest_sc`,i=await r.tryGet(new URL(`timelines.json`,c).href,async()=>await d(new URL(`timelines.json`,c).href),n.cache.routeExpire,!1),a=i.data.timelines.find(e=>e.id===t),o=await d(new URL(a.feed,c).href),s=o.data.stories.filter(e=>e.type===`article`),l=await Promise.all(s.map(e=>r.tryGet(e.shareurl,async()=>{let t=new URL(e.shareurl);switch(e.link=t.href,e.description=e.summary,e.pubDate=e.published,e.category=[],e.section&&(e.category=[...e.category,e.section]),e.taxonomy&&(e.taxonomy.collection_tag&&(e.category=[...e.category,...e.taxonomy.collection_tag]),e.taxonomy.sections&&(e.category=[...e.category,...e.taxonomy.sections])),e.category=[...new Set(e.category)],t.hostname){case`app.theinitium.com`:e.description=await f(t);break;case`theinitium.com`:e.description=await p(t);break;default:break}return e}))),u=`zh-hans`,m=`端传媒`;return a.timeline_sets[0]===`chinese-traditional`&&(u=`zh-hant`,m=`端傳媒`),{title:`${m} - ${a.title}`,link:`https://app.theinitium.com/t/latest/${t}/`,language:u,item:l}}export{l as route};
//# sourceMappingURL=app-RI_GIngP.js.map