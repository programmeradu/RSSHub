{"version":3,"file":"list-CnVeTrYb.js","names":[],"sources":["../../lib/routes/tophub/list.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { config } from '@/config';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\n\r\nexport const route: Route = {\r\n    path: '/list/:id',\r\n    categories: ['new-media'],\r\n    example: '/tophub/list/Om4ejxvxEN',\r\n    parameters: { id: '榜单id，可在 URL 中找到' },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'TOPHUB_COOKIE',\r\n                optional: true,\r\n                description: '',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['tophub.today/n/:id'],\r\n        },\r\n    ],\r\n    name: '榜单列表',\r\n    maintainers: ['akynazh'],\r\n    handler,\r\n    description: `::: tip\r\n将榜单条目集合到一个列表中，可避免推送大量条目，更符合阅读习惯且有热度排序，推荐使用。\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const link = `https://tophub.today/n/${id}`;\r\n    const response = await got.get(link, {\r\n        headers: {\r\n            Referer: 'https://tophub.today',\r\n            Cookie: config.tophub.cookie,\r\n        },\r\n    });\r\n    const $ = load(response.data);\r\n    const title = $('div.Xc-ec-L.b-L').text().trim();\r\n    const items = $('div.Zd-p-Sc > div:nth-child(1) tr')\r\n        .toArray()\r\n        .map((e) => ({\r\n            title: $(e).find('td.al a').text().trim(),\r\n            link: $(e).find('td.al a').attr('href'),\r\n            heatRate: $(e).find('td:nth-child(3)').text().trim(),\r\n        }));\r\n    const combinedTitles = items.map((item) => item.title).join('');\r\n    const renderRank = art(path.join(__dirname, 'templates/rank.art'), { items });\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        item: [\r\n            {\r\n                title,\r\n                link,\r\n                description: renderRank,\r\n                guid: combinedTitles,\r\n            },\r\n        ],\r\n    };\r\n}\r\n"],"mappings":"gYAQA,MAAa,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,aACb,QAAS,0BACT,WAAY,CAAE,GAAI,mBAClB,SAAU,CACN,cAAe,CACX,CACI,KAAM,gBACN,SAAU,GACV,YAAa,KAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,wBAGjB,KAAM,OACN,YAAa,CAAC,WACd,UACA,YAAa;;MAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAO,0BAA0B,IACjC,EAAW,MAAM,EAAI,IAAI,EAAM,CACjC,QAAS,CACL,QAAS,uBACT,OAAQ,EAAO,OAAO,UAGxB,EAAI,EAAK,EAAS,MAClB,EAAQ,EAAE,mBAAmB,OAAO,OACpC,EAAQ,EAAE,qCACX,UACA,IAAK,IAAO,CACT,MAAO,EAAE,GAAG,KAAK,WAAW,OAAO,OACnC,KAAM,EAAE,GAAG,KAAK,WAAW,KAAK,QAChC,SAAU,EAAE,GAAG,KAAK,mBAAmB,OAAO,UAEhD,EAAiB,EAAM,IAAK,GAAS,EAAK,OAAO,KAAK,IACtD,EAAa,EAAI,EAAA,KAAA,EAAA,+BAA4C,CAAE,UAErE,MAAO,CACH,QACA,OACA,KAAM,CACF,CACI,QACA,OACA,YAAa,EACb,KAAM"}