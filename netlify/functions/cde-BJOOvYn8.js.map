{"version":3,"file":"cde-BJOOvYn8.js","names":["route: Route","utils","got","cache"],"sources":["../../lib/routes/cde/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport utils from './utils';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst channelLinkMap = {\r\n    news: 'https://www.cde.org.cn/main/news/listpage/545cf855a50574699b46b26bcb165f32',\r\n    policy: 'https://www.cde.org.cn/main/policy/listpage/9f9c74c73e0f8f56a8bfbc646055026d',\r\n};\r\n\r\nconst cateUrlMap = {\r\n    news: {\r\n        zwxw: 'getList',\r\n        ywdd: 'getHotNewsList',\r\n        tpxw: 'getPictureNewsList',\r\n        gzdt: 'getWorkList',\r\n    },\r\n    policy: {\r\n        flfg: 'getPolicyList',\r\n        zxgz: 'getRuleList',\r\n    },\r\n};\r\n\r\nconst cateTitleMap = {\r\n    news: {\r\n        zwxw: '政务新闻',\r\n        ywdd: '要闻导读',\r\n        tpxw: '图片新闻',\r\n        gzdt: '工作动态',\r\n    },\r\n    policy: {\r\n        flfg: '法律法规',\r\n        zxgz: '政策规章',\r\n    },\r\n};\r\n\r\nconst requestData = {\r\n    news: {\r\n        zwxw: {\r\n            pageSize: 25,\r\n            pageNum: 1,\r\n            classId: '545cf855a50574699b46b26bcb165f32',\r\n        },\r\n        ywdd: {\r\n            pageSize: 25,\r\n            pageNum: 1,\r\n            ishot: 1,\r\n        },\r\n        tpxw: {\r\n            pageSize: 25,\r\n            pageNum: 1,\r\n        },\r\n        gzdt: {\r\n            pageSize: 25,\r\n            pageNum: 1,\r\n            classId: '8dc6aac86eb083759b1e01615617a347',\r\n        },\r\n    },\r\n    policy: {\r\n        flfg: {\r\n            pageNum: 1,\r\n            pageSize: 25,\r\n            fclass: 0,\r\n            keyName: 'TITLE',\r\n            logicC: 'bh',\r\n        },\r\n        zxgz: {\r\n            pageNum: 1,\r\n            pageSize: 25,\r\n            fclass: 0,\r\n            keyName: 'TITLE',\r\n            logicC: 'bh',\r\n        },\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:channel/:category',\r\n    categories: ['government'],\r\n    example: '/cde/news/gzdt',\r\n    parameters: { channel: '频道', category: '类别' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '首页',\r\n    maintainers: ['Fatpandac'],\r\n    handler,\r\n    description: `-   频道\r\n\r\n| 新闻中心 | 政策法规 |\r\n| :------: | :------: |\r\n|   news   |  policy  |\r\n\r\n  -   类别\r\n\r\n| 新闻中心 | 政务新闻 | 要闻导读 | 图片新闻 | 工作动态 |\r\n| :------: | :------: | :------: | :------: | :------: |\r\n|          |   zwxw   |   ywdd   |   tpxw   |   gzdt   |\r\n\r\n| 政策法规 | 法律法规 | 中心规章 |\r\n| :------: | :------: | :------: |\r\n|          |   flfg   |   zxgz   |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const channel = ctx.req.param('channel');\r\n    const cate = ctx.req.param('category');\r\n    requestData[channel][cate].pageSize = ctx.req.param('limit') ?? 25;\r\n\r\n    const url = `${utils.rootUrl}/main/${channel}/${cateUrlMap[channel][cate]}`;\r\n    const response = await got({\r\n        method: 'post',\r\n        url,\r\n        headers: {\r\n            cookie: await utils.getCookie(ctx),\r\n        },\r\n        form: requestData[channel][cate],\r\n    });\r\n    const data = response.data.data;\r\n    const list = data.records.map((item) => {\r\n        const linkMap = {\r\n            news: `${utils.rootUrl}/main/${item.isPic ? 'newspic/view/' : 'news/viewInfoCommon/'}${item.newsIdCode}`,\r\n            policy: `${utils.rootUrl}/main/${item.regulatIdCODE ? `policy/regulatview/${item.regulatIdCODE}` : `policy/view/${item.policyIdCODE}`}`,\r\n        };\r\n\r\n        return {\r\n            title: item.title,\r\n            link: linkMap[channel],\r\n        };\r\n    });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got(item.link, {\r\n                    headers: {\r\n                        cookie: await utils.getCookie(ctx),\r\n                    },\r\n                });\r\n                const $ = load(detailResponse.data);\r\n\r\n                item.pubDate = parseDate($('div.news_detail_date').text(), 'YYYYMMDD');\r\n\r\n                const desc = $('div.news_detail_box');\r\n                const removeTitle = desc.find('div.news_detail_title').remove().end();\r\n                const removeDate = removeTitle.find('div.news_detail_date').remove().end();\r\n                const removeImage = removeDate.find('img').remove().end();\r\n                item.description = removeImage.html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${utils.title} - ${cateTitleMap[channel][cate]}`,\r\n        link: channelLinkMap[channel],\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"4ZAOA,MAAM,EAAiB,CACnB,KAAM,6EACN,OAAQ,gFAGN,EAAa,CACf,KAAM,CACF,KAAM,UACN,KAAM,iBACN,KAAM,qBACN,KAAM,eAEV,OAAQ,CACJ,KAAM,gBACN,KAAM,gBAIR,EAAe,CACjB,KAAM,CACF,KAAM,OACN,KAAM,OACN,KAAM,OACN,KAAM,QAEV,OAAQ,CACJ,KAAM,OACN,KAAM,SAIR,EAAc,CAChB,KAAM,CACF,KAAM,CACF,SAAU,GACV,QAAS,EACT,QAAS,oCAEb,KAAM,CACF,SAAU,GACV,QAAS,EACT,MAAO,GAEX,KAAM,CACF,SAAU,GACV,QAAS,GAEb,KAAM,CACF,SAAU,GACV,QAAS,EACT,QAAS,qCAGjB,OAAQ,CACJ,KAAM,CACF,QAAS,EACT,SAAU,GACV,OAAQ,EACR,QAAS,QACT,OAAQ,MAEZ,KAAM,CACF,QAAS,EACT,SAAU,GACV,OAAQ,EACR,QAAS,QACT,OAAQ,QAKPA,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,cACb,QAAS,iBACT,WAAY,CAAE,QAAS,KAAM,SAAU,MACvC,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,aACd,UACA,YAAa;;;;;;;;;;;;;;qCAiBjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,EAAI,IAAI,MAAM,WACxB,EAAO,EAAI,IAAI,MAAM,YAC3B,EAAY,GAAS,GAAM,SAAW,EAAI,IAAI,MAAM,UAAY,GAEhE,IAAM,EAAM,GAAGC,EAAM,QAAQ,QAAQ,EAAQ,GAAG,EAAW,GAAS,KAC9D,EAAW,MAAMC,EAAI,CACvB,OAAQ,OACR,MACA,QAAS,CACL,OAAQ,MAAMD,EAAM,UAAU,IAElC,KAAM,EAAY,GAAS,KAEzB,EAAO,EAAS,KAAK,KACrB,EAAO,EAAK,QAAQ,IAAK,GAAS,CACpC,IAAM,EAAU,CACZ,KAAM,GAAGA,EAAM,QAAQ,QAAQ,EAAK,MAAQ,gBAAkB,yBAAyB,EAAK,aAC5F,OAAQ,GAAGA,EAAM,QAAQ,QAAQ,EAAK,cAAgB,sBAAsB,EAAK,gBAAkB,eAAe,EAAK,kBAG3H,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EAAQ,MAIhB,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNE,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,EAAK,KAAM,CACxC,QAAS,CACL,OAAQ,MAAMD,EAAM,UAAU,MAGhC,EAAI,EAAK,EAAe,MAE9B,EAAK,QAAU,EAAU,EAAE,wBAAwB,OAAQ,YAE3D,IAAM,EAAO,EAAE,uBACT,EAAc,EAAK,KAAK,yBAAyB,SAAS,MAC1D,EAAa,EAAY,KAAK,wBAAwB,SAAS,MAC/D,EAAc,EAAW,KAAK,OAAO,SAAS,MAGpD,MAFA,GAAK,YAAc,EAAY,OAExB,MAKnB,MAAO,CACH,MAAO,GAAGA,EAAM,MAAM,KAAK,EAAa,GAAS,KACjD,KAAM,EAAe,GACrB,KAAM"}