{"version":3,"file":"bulletin-KxBpmabH.js","names":["got","route: Route","cache","title"],"sources":["../../lib/routes/tokeninsight/bulletin.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nconst baseURL = 'https://www.tokeninsight.com/';\r\nconst title = 'TokenInsight';\r\nconst link = 'https://www.tokeninsight.com/';\r\nconst get_articles = async () => {\r\n    const url = `${baseURL}api/bulletin/selectBulletinList`;\r\n    const response = (await got.get(url)).data;\r\n    const { data } = response;\r\n    return data;\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/bulletin/:lang?',\r\n    categories: ['finance'],\r\n    example: '/tokeninsight/bulletin/en',\r\n    parameters: { lang: 'Language, see below, Chinese by default' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['tokeninsight.com/:lang/latest'],\r\n            target: '/bulletin/:lang',\r\n        },\r\n    ],\r\n    name: 'Latest',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const lang = ctx.req.param('lang') ?? 'zh';\r\n\r\n    const get_article_info = async (article) => {\r\n        const { updateDate, titleEn, id, title } = article;\r\n        const articleUrl = `${baseURL}${lang}/latest/${id}`;\r\n        const description = await cache.tryGet(articleUrl, async () => {\r\n            const res = await got(articleUrl);\r\n            const $ = load(res.data);\r\n            return $('.detail_html_box').html();\r\n        });\r\n        return {\r\n            // 文章标题\r\n            title: lang === 'zh' ? title : titleEn,\r\n            // 文章正文\r\n            description,\r\n            // 文章发布时间\r\n            pubDate: parseDate(updateDate),\r\n            // 文章链接\r\n            link: articleUrl,\r\n        };\r\n    };\r\n\r\n    const articles = await get_articles();\r\n    const list = await Promise.all(articles.map((element) => get_article_info(element)));\r\n    return {\r\n        title: `${lang === 'zh' ? '快讯' : 'Latest'} | ${title}`,\r\n        link: `${link}${lang}/latest`,\r\n        item: list,\r\n    };\r\n}\r\n"],"mappings":"wWAKA,MAAM,EAAU,gCAGV,EAAe,SAAY,CAC7B,IAAM,EAAM,GAAG,EAAQ,iCACjB,GAAY,MAAMA,EAAI,IAAI,IAAM,KAChC,CAAE,QAAS,EACjB,OAAO,GAGEC,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,WACb,QAAS,4BACT,WAAY,CAAE,KAAM,2CACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,iCACT,OAAQ,oBAGhB,KAAM,SACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,KAEhC,EAAmB,KAAO,IAAY,CACxC,GAAM,CAAE,aAAY,UAAS,KAAI,MAAA,GAAU,EACrC,EAAa,GAAG,IAAU,EAAK,UAAU,IACzC,EAAc,MAAMC,EAAM,OAAO,EAAY,SAAY,CAC3D,IAAM,EAAM,MAAMF,EAAI,GAChB,EAAI,EAAK,EAAI,MACnB,OAAO,EAAE,oBAAoB,SAEjC,MAAO,CAEH,MAAO,IAAS,KAAOG,EAAQ,EAE/B,cAEA,QAAS,EAAU,GAEnB,KAAM,IAIR,EAAW,MAAM,IACjB,EAAO,MAAM,QAAQ,IAAI,EAAS,IAAK,GAAY,EAAiB,KAC1E,MAAO,CACH,MAAO,GAAG,IAAS,KAAO,KAAO,SAAS,iBAC1C,KAAM,gCAAU,EAAK,SACrB,KAAM"}