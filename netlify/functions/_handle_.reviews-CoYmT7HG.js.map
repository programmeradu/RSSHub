{"version":3,"file":"_handle_.reviews-CoYmT7HG.js","names":["route: Route","got","result: DataItem"],"sources":["../../lib/routes/shopify/apps/[handle].reviews.ts"],"sourcesContent":["import { Data, DataItem, Route } from '@/types';\r\nimport { Context } from 'hono';\r\nimport { baseURL } from './const';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/apps/:handle/reviews/:page?',\r\n    example: '/shopify/apps/flow/reviews',\r\n    parameters: { handle: '例如一个 App 的链接 https://apps.shopify.com/flow，其中 flow 就是指的是 handle' },\r\n    name: 'App reviews',\r\n    maintainers: ['PrintNow'],\r\n    handler,\r\n    radar: [\r\n        {\r\n            source: ['apps.shopify.com/:handle'],\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const { handle = '', page = '1' } = ctx.req.param();\r\n    const response = await got.get(`${baseURL}/${handle}/reviews`, {\r\n        searchParams: {\r\n            sort_by: 'newest',\r\n            page,\r\n        },\r\n        headers: {\r\n            accept: 'text/html, application/xhtml+xml',\r\n            'accept-language': 'en-US;q=0.9',\r\n            referer: baseURL,\r\n            dnt: '1',\r\n        },\r\n    });\r\n\r\n    const htmlContent = response.data;\r\n    const $ = load(htmlContent);\r\n\r\n    const items = $('div[data-merchant-review]')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n\r\n            const reviewID = $item.attr('data-review-content-id');\r\n\r\n            const $review1 = $item.find('div:nth-child(1)');\r\n            const $review2 = $item.find('div:nth-child(2)');\r\n\r\n            const description = $item.find('div[data-truncate-review] div[data-truncate-content-copy] p').html() || '';\r\n            const author = $review2.find('div.tw-text-fg-primary').text().trim();\r\n\r\n            const result: DataItem = {\r\n                guid: reviewID,\r\n                title: description,\r\n                author,\r\n                pubDate: new Date($review1.find('div[aria-label] + div').text().trim()),\r\n\r\n                // 评论内容\r\n                description,\r\n\r\n                _extra: {\r\n                    ratting_value: Number($review1.find('div[role=\"img\"]').attr('aria-label')?.slice(0, 1)),\r\n                    location: $review2.find('div.tw-text-fg-primary + div').text().trim(),\r\n                    author,\r\n                },\r\n            };\r\n\r\n            return result;\r\n        });\r\n\r\n    return {\r\n        title: `Reviews handle:${handle} page:${page} – Shopify App Store`,\r\n        link: `${baseURL}/${handle}/reviews`,\r\n        allowEmpty: true,\r\n        language: 'en-us',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"6SAMA,MAAaA,EAAe,CACxB,KAAM,+BACN,QAAS,6BACT,WAAY,CAAE,OAAQ,mEACtB,KAAM,cACN,YAAa,CAAC,YACd,UACA,MAAO,CACH,CACI,OAAQ,CAAC,+BAKrB,eAAe,EAAQ,EAA6B,CAChD,GAAM,CAAE,SAAS,GAAI,OAAO,KAAQ,EAAI,IAAI,QACtC,EAAW,MAAMC,EAAI,IAAI,GAAG,EAAQ,GAAG,EAAO,UAAW,CAC3D,aAAc,CACV,QAAS,SACT,QAEJ,QAAS,CACL,OAAQ,mCACR,kBAAmB,cACnB,QAAS,EACT,IAAK,OAIP,EAAc,EAAS,KACvB,EAAI,EAAK,GAET,EAAQ,EAAE,6BACX,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GAEV,EAAW,EAAM,KAAK,0BAEtB,EAAW,EAAM,KAAK,oBACtB,EAAW,EAAM,KAAK,oBAEtB,EAAc,EAAM,KAAK,+DAA+D,QAAU,GAClG,EAAS,EAAS,KAAK,0BAA0B,OAAO,OAExDC,EAAmB,CACrB,KAAM,EACN,MAAO,EACP,SACA,QAAS,IAAI,KAAK,EAAS,KAAK,yBAAyB,OAAO,QAGhE,cAEA,OAAQ,CACJ,cAAe,OAAO,EAAS,KAAK,mBAAmB,KAAK,eAAe,MAAM,EAAG,IACpF,SAAU,EAAS,KAAK,gCAAgC,OAAO,OAC/D,WAIR,OAAO,IAGf,MAAO,CACH,MAAO,kBAAkB,EAAO,QAAQ,EAAK,sBAC7C,KAAM,GAAG,EAAQ,GAAG,EAAO,UAC3B,WAAY,GACZ,SAAU,QACV,KAAM"}