{"version":3,"file":"yjzj-B1_Tsd3N.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/gov/miit/yjzj.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst rootUrl = 'https://www.miit.gov.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/miit/yjzj',\r\n    categories: ['government'],\r\n    example: '/gov/miit/yjzj',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['miit.gov.cn/gzcy/yjzj/index.html'],\r\n        },\r\n    ],\r\n    name: '意见征集',\r\n    maintainers: ['Fatpandac'],\r\n    handler,\r\n    url: 'miit.gov.cn/gzcy/yjzj/index.html',\r\n};\r\n\r\nasync function handler() {\r\n    const url = `${rootUrl}/gzcy/yjzj/index.html`;\r\n\r\n    const cookieResponse = await got(url);\r\n    const cookie = cookieResponse.headers['set-cookie'][0].split(';')[0];\r\n    const indexContent = load(cookieResponse.data);\r\n    const dataRequestUrl = indexContent('div.clist_con > script:nth-child(2)')\r\n        .toArray()\r\n        .map((item) => ({\r\n            url: `${rootUrl}${indexContent(item).attr('url')}`,\r\n            queryData: JSON.parse(indexContent(item).attr('querydata').replaceAll('\"', '|').replaceAll(\"'\", '\"').replaceAll('|', '\"')),\r\n        }))[0];\r\n\r\n    const dataUrl = `${dataRequestUrl.url}?${Object.keys(dataRequestUrl.queryData)\r\n        .map((key) => `${key}=${dataRequestUrl.queryData[key]}`)\r\n        .join('&')}`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url: dataUrl,\r\n        headers: {\r\n            Cookie: cookie,\r\n        },\r\n    });\r\n    const $ = load(response.data.data.html);\r\n    const list = $('ul > li')\r\n        .toArray()\r\n        .map((item) => ({\r\n            title: $(item).find('a').text(),\r\n            link: new URL($(item).find('a').attr('href'), rootUrl).href,\r\n            pubDate: parseDate($(item).find('span').text(), 'YYYY-MM-DD'),\r\n        }));\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got(item.link);\r\n                const content = load(detailResponse.data);\r\n\r\n                item.description = content('#con_con')\r\n                    .html()\r\n                    .replaceAll(/(<iframe.*?src=\")(.*?)(\".*?>)/g, '$1' + rootUrl + '$2' + '$3');\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `工业和信息化部 - 意见征集`,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAM,EAAU,0BAEHA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,cACb,QAAS,iBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,sCAGjB,KAAM,OACN,YAAa,CAAC,aACd,UACA,IAAK,oCAGT,eAAe,GAAU,CACrB,IAAM,EAAM,GAAG,EAAQ,uBAEjB,EAAiB,MAAMC,EAAI,GAC3B,EAAS,EAAe,QAAQ,cAAc,GAAG,MAAM,KAAK,GAC5D,EAAe,EAAK,EAAe,MACnC,EAAiB,EAAa,uCAC/B,UACA,IAAK,IAAU,CACZ,IAAK,GAAG,IAAU,EAAa,GAAM,KAAK,SAC1C,UAAW,KAAK,MAAM,EAAa,GAAM,KAAK,aAAa,WAAW,IAAK,KAAK,WAAW,IAAK,KAAK,WAAW,IAAK,SACrH,GAEF,EAAU,GAAG,EAAe,IAAI,GAAG,OAAO,KAAK,EAAe,WAC/D,IAAK,GAAQ,GAAG,EAAI,GAAG,EAAe,UAAU,MAChD,KAAK,OACJ,EAAW,MAAMA,EAAI,CACvB,OAAQ,MACR,IAAK,EACL,QAAS,CACL,OAAQ,KAGV,EAAI,EAAK,EAAS,KAAK,KAAK,MAC5B,EAAO,EAAE,WACV,UACA,IAAK,IAAU,CACZ,MAAO,EAAE,GAAM,KAAK,KAAK,OACzB,KAAM,IAAI,IAAI,EAAE,GAAM,KAAK,KAAK,KAAK,QAAS,GAAS,KACvD,QAAS,EAAU,EAAE,GAAM,KAAK,QAAQ,OAAQ,iBAGlD,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,EAAK,MAChC,EAAU,EAAK,EAAe,MAMpC,MAJA,GAAK,YAAc,EAAQ,YACtB,OACA,WAAW,iCAAkC,KAAO,EAAU,QAE5D,MAKnB,MAAO,CACH,MAAO,iBACP,KAAM,EACN,KAAM"}