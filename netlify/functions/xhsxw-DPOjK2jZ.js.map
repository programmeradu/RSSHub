{"version":3,"file":"xhsxw-DPOjK2jZ.js","names":[],"sources":["../../lib/routes/news/xhsxw.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: ['/xhsxw', '/whxw'],\r\n    categories: ['new-media'],\r\n    example: '/news/xhsxw',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['news.cn/xhsxw.htm'],\r\n        },\r\n    ],\r\n    name: '新华社新闻',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    url: 'news.cn/xhsxw.htm',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 100;\r\n\r\n    const rootUrl = 'http://www.news.cn';\r\n    const currentUrl = new URL('xhsxw.htm', rootUrl).href;\r\n\r\n    const { data: currentResponse } = await got(currentUrl);\r\n\r\n    const $ = load(currentResponse);\r\n\r\n    const id = $('ul.wz-list')\r\n        .prop('data')\r\n        .replace(/datasource:/, '');\r\n\r\n    const apiUrl = new URL(`ds_${id}.json`, rootUrl).href;\r\n\r\n    const {\r\n        data: { datasource: response },\r\n    } = await got(apiUrl);\r\n\r\n    let items = response.slice(0, limit).map((item) => ({\r\n        title: item.title,\r\n        link: new URL(item.publishUrl, rootUrl).href,\r\n        description: art(path.join(__dirname, 'templates/description.art'), {\r\n            images:\r\n                item.shareImages?.map((i) => ({\r\n                    src: i.imageUrl,\r\n                    alt: item.title,\r\n                })) ?? undefined,\r\n            intro: item.summary,\r\n        }),\r\n        author: item.author,\r\n        category: item.keywords.split(/-|,/),\r\n        guid: `news-${item.contentId}`,\r\n        pubDate: timezone(parseDate(item.publishTime), +8),\r\n    }));\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                try {\r\n                    const { data: detailResponse } = await got(item.link);\r\n\r\n                    const content = load(detailResponse);\r\n\r\n                    item.description += art(path.join(__dirname, 'templates/description.art'), {\r\n                        description: content('#detailContent').html(),\r\n                    });\r\n                } catch {\r\n                    // no-empty\r\n                }\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const title = $('title').text();\r\n    const image = new URL('20141223_xhsxw_logo_v1.png', rootUrl).href;\r\n    const icon = new URL('favicon.ico', rootUrl).href;\r\n\r\n    return {\r\n        item: items,\r\n        title,\r\n        link: currentUrl,\r\n        description: title.split(/_/)[0],\r\n        language: 'zh',\r\n        image,\r\n        icon,\r\n        logo: icon,\r\n        author: title.split(/_/).pop(),\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"0gBAUA,MAAa,EAAe,CACxB,KAAM,CAAC,SAAU,SACjB,WAAY,CAAC,aACb,QAAS,cACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,uBAGjB,KAAM,QACN,YAAa,CAAC,WACd,UACA,IAAK,qBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,IAE/E,EAAU,qBACV,EAAa,IAAI,IAAI,YAAa,GAAS,KAE3C,CAAE,KAAM,GAAoB,MAAM,EAAI,GAEtC,EAAI,EAAK,GAET,EAAK,EAAE,cACR,KAAK,QACL,QAAQ,cAAe,IAEtB,EAAS,IAAI,IAAI,MAAM,EAAG,OAAQ,GAAS,KAE3C,CACF,KAAM,CAAE,WAAY,IACpB,MAAM,EAAI,GAEV,EAAQ,EAAS,MAAM,EAAG,GAAO,IAAK,IAAU,CAChD,MAAO,EAAK,MACZ,KAAM,IAAI,IAAI,EAAK,WAAY,GAAS,KACxC,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,OACI,EAAK,aAAa,IAAK,IAAO,CAC1B,IAAK,EAAE,SACP,IAAK,EAAK,UACP,IAAA,GACX,MAAO,EAAK,UAEhB,OAAQ,EAAK,OACb,SAAU,EAAK,SAAS,MAAM,OAC9B,KAAM,QAAQ,EAAK,YACnB,QAAS,EAAS,EAAU,EAAK,aAAc,MAGnD,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACP,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,CACA,GAAM,CAAE,KAAM,GAAmB,MAAM,EAAI,EAAK,MAE1C,EAAU,EAAK,GAErB,EAAK,aAAe,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACvE,YAAa,EAAQ,kBAAkB,cAEvC,EAIR,OAAO,MAKnB,IAAM,EAAQ,EAAE,SAAS,OACnB,EAAQ,IAAI,IAAI,6BAA8B,GAAS,KACvD,EAAO,IAAI,IAAI,cAAe,GAAS,KAE7C,MAAO,CACH,KAAM,EACN,QACA,KAAM,EACN,YAAa,EAAM,MAAM,KAAK,GAC9B,SAAU,KACV,QACA,OACA,KAAM,EACN,OAAQ,EAAM,MAAM,KAAK,MACzB,WAAY"}