{"version":3,"file":"calendar-DSDEbulG.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/wallstreetcn/calendar.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/calendar/:section?',\r\n    categories: ['finance'],\r\n    example: '/wallstreetcn/calendar',\r\n    parameters: { section: '`macrodatas` 或 `report`，默认为 `macrodatas`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['wallstreetcn.com/calendar'],\r\n        },\r\n    ],\r\n    name: '财经日历',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'wallstreetcn.com/calendar',\r\n};\r\n\r\nconst rootUrl = 'https://wallstreetcn.com';\r\n\r\nconst MacrodataSuffix = {\r\n    CA: 'CA10YR.OTC',\r\n    CN: 'USDCNH.OTC',\r\n    DE: 'DE30.OTC',\r\n    FR: 'FR40.OTC',\r\n    // HK: '',\r\n    IT: 'EURUSD.OTC',\r\n    JP: 'USDJPY.OTC',\r\n    UK: 'UK100.OTC',\r\n    US: 'DXY.OTC',\r\n};\r\n\r\nconst getMacrodataUrl = (countryId, wscnTicker) => `${rootUrl}/data-analyse/${wscnTicker}/${MacrodataSuffix[countryId]}`;\r\n\r\nasync function handler(ctx) {\r\n    const { section = 'macrodatas' } = ctx.req.param();\r\n\r\n    const link = `${rootUrl}/calendar`;\r\n    const apiRootUrl = section === 'macrodatas' ? 'https://api-one-wscn.awtmt.com' : 'https://api-ddc-wscn.awtmt.com';\r\n    const apiUrl = section === 'macrodatas' ? `${apiRootUrl}/apiv1/finance/macrodatas` : `${apiRootUrl}/finance/report/list`;\r\n\r\n    const response = await ofetch(apiUrl, {\r\n        query:\r\n            section === 'macrodatas'\r\n                ? {\r\n                      start: new Date().setHours(0, 0, 0, 0) / 1000,\r\n                      end: Math.trunc(new Date().setHours(23, 59, 59, 999) / 1000),\r\n                  }\r\n                : undefined,\r\n    });\r\n\r\n    const items =\r\n        section === 'macrodatas'\r\n            ? response.data.items.map((item) => ({\r\n                  title: `${item.country}${item.title}`,\r\n                  description: `${item.country}${item.title} 重要性: ${'★'.repeat(item.importance)} 今值: ${item.actual || '-'}${item.actual && item.unit} 预期: ${item.forecast || '-'}${item.forecast && item.unit} 前值: ${item.revised || item.previous || '-'}${(item.revised || item.previous) && item.unit}`,\r\n                  link: item.uri && MacrodataSuffix[item.country_id] && getMacrodataUrl(item.country_id, item.wscn_ticker),\r\n                  guid: item.id,\r\n                  pubDate: parseDate(item.public_date, 'X'),\r\n                  category: item.country,\r\n              }))\r\n            : // report\r\n              response.data.items\r\n                  .map((item) => Object.fromEntries(response.data.fields.map((field, index) => [field, item[index]])))\r\n                  .map((item) => ({\r\n                      title: `${item.company_name} ${item.observation_date}`,\r\n                      description: `${item.code} ${item.company_name} ${item.observation_date} 预期EPS: ${item.eps_estimate === 0 ? '-' : item.eps_estimate} 实际EPS: ${item.reported_eps === 0 ? '-' : item.reported_eps} 差异度: ${item.surprise === 0 || item.surprise === -1 ? '-' : (item.surprise * 100).toFixed(2) + '%'}`,\r\n                      link,\r\n                      guid: item.id,\r\n                      pubDate: parseDate(item.public_date, 'X'),\r\n                  }));\r\n\r\n    return {\r\n        title: '财经日历 - 华尔街见闻',\r\n        link,\r\n        item: items,\r\n        itunes_author: '华尔街见闻',\r\n        image: 'https://static.wscn.net/wscn/_static/favicon.png',\r\n    };\r\n}\r\n"],"mappings":"gOAIA,MAAaA,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,WACb,QAAS,yBACT,WAAY,CAAE,QAAS,4CACvB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,+BAGjB,KAAM,OACN,YAAa,CAAC,UACd,UACA,IAAK,6BAGH,EAAU,2BAEV,EAAkB,CACpB,GAAI,aACJ,GAAI,aACJ,GAAI,WACJ,GAAI,WAEJ,GAAI,aACJ,GAAI,aACJ,GAAI,YACJ,GAAI,WAGF,GAAmB,EAAW,IAAe,GAAG,EAAQ,gBAAgB,EAAW,GAAG,EAAgB,KAE5G,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,UAAU,cAAiB,EAAI,IAAI,QAErC,EAAO,GAAG,EAAQ,WAClB,EAAa,IAAY,aAAe,iCAAmC,iCAC3E,EAAS,IAAY,aAAe,GAAG,EAAW,2BAA6B,GAAG,EAAW,sBAE7F,EAAW,MAAMC,EAAO,EAAQ,CAClC,MACI,IAAY,aACN,CACI,MAAO,IAAI,OAAO,SAAS,EAAG,EAAG,EAAG,GAAK,IACzC,IAAK,KAAK,MAAM,IAAI,OAAO,SAAS,GAAI,GAAI,GAAI,KAAO,MAE3D,IAAA,KAGR,EACF,IAAY,aACN,EAAS,KAAK,MAAM,IAAK,IAAU,CAC/B,MAAO,GAAG,EAAK,UAAU,EAAK,QAC9B,YAAa,GAAG,EAAK,UAAU,EAAK,MAAM,QAAQ,IAAI,OAAO,EAAK,YAAY,OAAO,EAAK,QAAU,MAAM,EAAK,QAAU,EAAK,KAAK,OAAO,EAAK,UAAY,MAAM,EAAK,UAAY,EAAK,KAAK,OAAO,EAAK,SAAW,EAAK,UAAY,OAAO,EAAK,SAAW,EAAK,WAAa,EAAK,OAClR,KAAM,EAAK,KAAO,EAAgB,EAAK,aAAe,EAAgB,EAAK,WAAY,EAAK,aAC5F,KAAM,EAAK,GACX,QAAS,EAAU,EAAK,YAAa,KACrC,SAAU,EAAK,WAGnB,EAAS,KAAK,MACT,IAAK,GAAS,OAAO,YAAY,EAAS,KAAK,OAAO,KAAK,EAAO,IAAU,CAAC,EAAO,EAAK,OACzF,IAAK,IAAU,CACZ,MAAO,GAAG,EAAK,aAAa,GAAG,EAAK,mBACpC,YAAa,GAAG,EAAK,KAAK,GAAG,EAAK,aAAa,GAAG,EAAK,iBAAiB,UAAU,EAAK,eAAiB,EAAI,IAAM,EAAK,aAAa,UAAU,EAAK,eAAiB,EAAI,IAAM,EAAK,aAAa,QAAQ,EAAK,WAAa,GAAK,EAAK,WAAa,GAAK,KAAO,EAAK,SAAW,KAAK,QAAQ,GAAK,MAC/R,OACA,KAAM,EAAK,GACX,QAAS,EAAU,EAAK,YAAa,QAGvD,MAAO,CACH,MAAO,eACP,OACA,KAAM,EACN,cAAe,QACf,MAAO"}