{"version":3,"file":"latest-DF5K35_Z.js","names":["route: Route","got"],"sources":["../../lib/routes/douban/commercialpress/latest.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/commercialpress/latest',\r\n    categories: ['social-media'],\r\n    example: '/douban/commercialpress/latest',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '商务印书馆新书速递',\r\n    maintainers: ['xyqfer'],\r\n    handler,\r\n};\r\n\r\nasync function handler() {\r\n    const link = 'https://site.douban.com/commercialpress/room/827243/';\r\n    const { data: roomResponse } = await got({\r\n        method: 'get',\r\n        url: link,\r\n        headers: {\r\n            Referer: 'https://site.douban.com/commercialpress/',\r\n        },\r\n    });\r\n    let $ = load(roomResponse);\r\n    const $mod = $('.mod').eq(0);\r\n    const title = $mod.find('.hd > h2 span').eq(0).text();\r\n    const newBookUrl = $mod.find('.pl a').attr('href');\r\n\r\n    const newBookLandingPage = await got({\r\n        method: 'get',\r\n        url: newBookUrl,\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n\r\n    // 这个有个重定向，需要获取到真实地址后添加排序参数后再请求一次\r\n    const realUrl = `${newBookLandingPage.request.options.url.href}?sort=time&sub_type=`;\r\n    const newBookPage = await got({\r\n        method: 'get',\r\n        url: realUrl,\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n\r\n    $ = load(newBookPage.data);\r\n    const resultItem = $('.doulist-item')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n\r\n            return {\r\n                title: $item.find('.title > a').text(),\r\n                link: $item.find('.title > a').attr('href'),\r\n                description: `<img src=\"${$item.find('.post img').attr('src')}\" /><br>${$item.find('.abstract').html()}`,\r\n                pubDate: new Date($item.find('.time > span').attr('title')).toUTCString(),\r\n            };\r\n        });\r\n\r\n    return {\r\n        title: `商务印书馆-${title}`,\r\n        link,\r\n        item: resultItem,\r\n    };\r\n}\r\n"],"mappings":"+PAIA,MAAaA,EAAe,CACxB,KAAM,0BACN,WAAY,CAAC,gBACb,QAAS,iCACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,YACN,YAAa,CAAC,UACd,WAGJ,eAAe,GAAU,CACrB,IAAM,EAAO,uDACP,CAAE,KAAM,GAAiB,MAAMC,EAAI,CACrC,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,8CAGb,EAAI,EAAK,GACP,EAAO,EAAE,QAAQ,GAAG,GACpB,EAAQ,EAAK,KAAK,iBAAiB,GAAG,GAAG,OACzC,EAAa,EAAK,KAAK,SAAS,KAAK,QAErC,EAAqB,MAAMA,EAAI,CACjC,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,KAKX,EAAU,GAAG,EAAmB,QAAQ,QAAQ,IAAI,KAAK,sBACzD,EAAc,MAAMA,EAAI,CAC1B,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,KAIjB,EAAI,EAAK,EAAY,MACrB,IAAM,EAAa,EAAE,iBAChB,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GAEhB,MAAO,CACH,MAAO,EAAM,KAAK,cAAc,OAChC,KAAM,EAAM,KAAK,cAAc,KAAK,QACpC,YAAa,aAAa,EAAM,KAAK,aAAa,KAAK,OAAO,UAAU,EAAM,KAAK,aAAa,SAChG,QAAS,IAAI,KAAK,EAAM,KAAK,gBAAgB,KAAK,UAAU,iBAIxE,MAAO,CACH,MAAO,SAAS,IAChB,OACA,KAAM"}