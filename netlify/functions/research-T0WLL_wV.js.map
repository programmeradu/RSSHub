{"version":3,"file":"research-T0WLL_wV.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/nifd/research.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst rootUrl = 'http://www.nifd.cn';\r\n\r\nconst titleMap = {\r\n    '7a6a826d-b525-42aa-b550-4236e524227f': '周报',\r\n    '128d602c-7041-4546-beff-83e605f8a370': '双周报',\r\n    '0712e220-fa3b-44d4-9226-bc3d57944e19': '月报',\r\n    'b66aa691-87ee-4bfe-ac6b-2460386166ee': '季报',\r\n    'c714853a-f09e-4510-8835-30a448fff7e3': '年报',\r\n    '17d0b29b-7912-498a-b9c3-d30508220158': '课题报告',\r\n    'e6a6d3a5-4bda-4739-9765-e4e41c900bcc': '学术报告',\r\n    '3d23ba0e-4f46-44c2-9d21-6b38df4cdd70': '工作论文',\r\n    '3333d2af-91d6-429b-be83-28b92f31b6d7': '研究评价',\r\n    '6363bdc7-3e1b-4771-a904-6162cd3a3143': '其他报告',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/research/:categoryGuid?',\r\n    categories: ['finance'],\r\n    example: '/nifd/research/3333d2af-91d6-429b-be83-28b92f31b6d7',\r\n    parameters: { categoryGuid: '资讯类型，默认为周报' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '研究',\r\n    maintainers: ['Fatpandac'],\r\n    handler,\r\n    description: `资讯类型可以从网址中获取，如：\r\n\r\n  \\`http://www.nifd.cn/Research?categoryGuid=7a6a826d-b525-42aa-b550-4236e524227f\\` 对应 \\`/nifd/research/7a6a826d-b525-42aa-b550-4236e524227f\\``,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const categoryGuid = ctx.req.param('categoryGuid') ?? '7a6a826d-b525-42aa-b550-4236e524227f';\r\n    const url = `${rootUrl}/Research?categoryGuid=${categoryGuid}`;\r\n\r\n    const response = await got.get(url);\r\n    const $ = load(response.data);\r\n    const list = $('div.qr-main-item')\r\n        .toArray()\r\n        .map((item) => ({\r\n            title: $(item).find('h2').text(),\r\n            link: rootUrl + $(item).find('a').attr('href'),\r\n            author: $(item).find('p > span:nth-child(2)').text(),\r\n            pubDate: parseDate($(item).find('p > span:nth-child(1)').text(), 'YYYY-MM-DD'),\r\n        }));\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got.get(item.link);\r\n                const content = load(detailResponse.data);\r\n                item.description = content('div.qrd-content').html();\r\n\r\n                const $enclosureEl = content('div.report-bottom a').first();\r\n                const enclosureUrl = $enclosureEl.attr('href');\r\n\r\n                if (enclosureUrl) {\r\n                    const enclosureItem = {\r\n                        enclosure_url: new URL(enclosureUrl, rootUrl).href,\r\n                        enclosure_type: `application/${enclosureUrl.split(/\\./).pop() ?? 'pdf'}`,\r\n                        enclosure_title: $enclosureEl.prev().text(),\r\n                    };\r\n\r\n                    item = {\r\n                        ...item,\r\n                        ...enclosureItem,\r\n                    };\r\n                }\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `国家金融与发展实验室 - ${titleMap[categoryGuid]}`,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAM,EAAU,qBAEV,EAAW,CACb,uCAAwC,KACxC,uCAAwC,MACxC,uCAAwC,KACxC,uCAAwC,KACxC,uCAAwC,KACxC,uCAAwC,OACxC,uCAAwC,OACxC,uCAAwC,OACxC,uCAAwC,OACxC,uCAAwC,QAG/BA,EAAe,CACxB,KAAM,2BACN,WAAY,CAAC,WACb,QAAS,sDACT,WAAY,CAAE,aAAc,cAC5B,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,aACd,UACA,YAAa,iKAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAe,EAAI,IAAI,MAAM,iBAAmB,uCAChD,EAAM,GAAG,EAAQ,yBAAyB,IAE1C,EAAW,MAAMC,EAAI,IAAI,GACzB,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,oBACV,UACA,IAAK,IAAU,CACZ,MAAO,EAAE,GAAM,KAAK,MAAM,OAC1B,KAAM,EAAU,EAAE,GAAM,KAAK,KAAK,KAAK,QACvC,OAAQ,EAAE,GAAM,KAAK,yBAAyB,OAC9C,QAAS,EAAU,EAAE,GAAM,KAAK,yBAAyB,OAAQ,iBAGnE,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,IAAI,EAAK,MACpC,EAAU,EAAK,EAAe,MACpC,EAAK,YAAc,EAAQ,mBAAmB,OAE9C,IAAM,EAAe,EAAQ,uBAAuB,QAC9C,EAAe,EAAa,KAAK,QAEvC,GAAI,EAAc,CACd,IAAM,EAAgB,CAClB,cAAe,IAAI,IAAI,EAAc,GAAS,KAC9C,eAAgB,eAAe,EAAa,MAAM,MAAM,OAAS,QACjE,gBAAiB,EAAa,OAAO,QAGzC,EAAO,CACH,GAAG,EACH,GAAG,GAIX,OAAO,MAKnB,MAAO,CACH,MAAO,gBAAgB,EAAS,KAChC,KAAM,EACN,KAAM"}