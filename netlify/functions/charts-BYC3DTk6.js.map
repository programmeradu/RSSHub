{"version":3,"file":"charts-BYC3DTk6.js","names":["route: Route","cache","ofetch"],"sources":["../../lib/routes/youtube/charts.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { renderDescription } from './utils';\r\nimport { config } from '@/config';\r\n\r\nexport const route: Route = {\r\n    path: '/charts/:category?/:country?/:embed?',\r\n    categories: ['social-media'],\r\n    example: '/youtube/charts',\r\n    parameters: { category: 'Chart, see table below, default to `TopVideos`', country: 'Country Code, see table below, default to global', embed: 'Default to embed the video, set to any value to disable embedding' },\r\n    name: 'Music Charts',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    description: `Chart\r\n\r\n| Top artists | Top songs | Top music videos | Trending       |\r\n| ----------- | --------- | ---------------- | -------------- |\r\n| TopArtists  | TopSongs  | TopVideos        | TrendingVideos |\r\n\r\n  Country Code\r\n\r\n| Argentina | Australia | Austria | Belgium | Bolivia | Brazil | Canada |\r\n| --------- | --------- | ------- | ------- | ------- | ------ | ------ |\r\n| ar        | au        | at      | be      | bo      | br     | ca     |\r\n\r\n| Chile | Colombia | Costa Rica | Czechia | Denmark | Dominican Republic | Ecuador |\r\n| ----- | -------- | ---------- | ------- | ------- | ------------------ | ------- |\r\n| cl    | co       | cr         | cz      | dk      | do                 | ec      |\r\n\r\n| Egypt | El Salvador | Estonia | Finland | France | Germany | Guatemala |\r\n| ----- | ----------- | ------- | ------- | ------ | ------- | --------- |\r\n| eg    | sv          | ee      | fi      | fr     | de      | gt        |\r\n\r\n| Honduras | Hungary | Iceland | India | Indonesia | Ireland | Israel | Italy |\r\n| -------- | ------- | ------- | ----- | --------- | ------- | ------ | ----- |\r\n| hn       | hu      | is      | in    | id        | ie      | il     | it    |\r\n\r\n| Japan | Kenya | Luxembourg | Mexico | Netherlands | New Zealand | Nicaragua |\r\n| ----- | ----- | ---------- | ------ | ----------- | ----------- | --------- |\r\n| jp    | ke    | lu         | mx     | nl          | nz          | ni        |\r\n\r\n| Nigeria | Norway | Panama | Paraguay | Peru | Poland | Portugal | Romania |\r\n| ------- | ------ | ------ | -------- | ---- | ------ | -------- | ------- |\r\n| ng      | no     | pa     | py       | pe   | pl     | pt       | ro      |\r\n\r\n| Russia | Saudi Arabia | Serbia | South Africa | South Korea | Spain | Sweden | Switzerland |\r\n| ------ | ------------ | ------ | ------------ | ----------- | ----- | ------ | ----------- |\r\n| ru     | sa           | rs     | za           | kr          | es    | se     | ch          |\r\n\r\n| Tanzania | Turkey | Uganda | Ukraine | United Arab Emirates | United Kingdom | United States |\r\n| -------- | ------ | ------ | ------- | -------------------- | -------------- | ------------- |\r\n| tz       | tr     | ug     | ua      | ae                   | gb             | us            |\r\n\r\n| Uruguay | Zimbabwe |\r\n| ------- | -------- |\r\n| uy      | zw       |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const contentMap = {\r\n        TopArtists: {\r\n            contentKey: 'artists',\r\n            viewKey: 'artistViews',\r\n            title: 'Top artists',\r\n        },\r\n        TopSongs: {\r\n            contentKey: 'trackTypes',\r\n            viewKey: 'trackViews',\r\n            title: 'Top songs',\r\n        },\r\n        TopVideos: {\r\n            contentKey: 'videos',\r\n            viewKey: 'videoViews',\r\n            title: 'Top music videos',\r\n        },\r\n        TrendingVideos: {\r\n            contentKey: 'videos',\r\n            viewKey: 'videoViews',\r\n            title: 'Trending',\r\n        },\r\n    };\r\n\r\n    const { category = 'TopVideos', country } = ctx.req.param();\r\n    const embed = !ctx.req.param('embed');\r\n\r\n    const { content } = await cache.tryGet(\r\n        `youtube:charts:${country ?? 'global'}`,\r\n        async () => {\r\n            const data = await ofetch('https://charts.youtube.com/youtubei/v1/browse', {\r\n                method: 'POST',\r\n                query: {\r\n                    alt: 'json',\r\n                    key: 'AIzaSyCzEW7JUJdSql0-2V4tHUb6laYm4iAE_dM',\r\n                },\r\n                body: {\r\n                    browseId: 'FEmusic_analytics_charts_home',\r\n                    context: {\r\n                        capabilities: {},\r\n                        client: {\r\n                            clientName: 'WEB_MUSIC_ANALYTICS',\r\n                            clientVersion: '0.2',\r\n                            experimentIds: [],\r\n                            experimentsToken: '',\r\n                            gl: 'US',\r\n                            hl: 'en',\r\n                            theme: 'MUSIC',\r\n                        },\r\n                        request: {\r\n                            internalExperimentFlags: [],\r\n                        },\r\n                    },\r\n                    query: `chart_params_type=WEEK&perspective=CHART&flags=viral_video_chart&selected_chart=TRACKS&chart_params_id=weekly:0:0${country ? `:${country}` : ''}`,\r\n                },\r\n            });\r\n            return data.contents.sectionListRenderer.contents[0].musicAnalyticsSectionRenderer;\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    );\r\n\r\n    const { entityId } = content.perspectiveMetadata;\r\n\r\n    const items =\r\n        category === 'TopArtists'\r\n            ? content[contentMap[category].contentKey][0][contentMap[category].viewKey].map((item) => ({\r\n                  title: item.name,\r\n                  link: `https://charts.youtube.com/artist/${encodeURIComponent(item.id)}`,\r\n                  guid: `youtube:charts:${category}:${entityId}:${item.id}`,\r\n              }))\r\n            : content[contentMap[category].contentKey][category === 'TrendingVideos' ? 1 : 0][contentMap[category].viewKey].map((item) => {\r\n                  const videoId = category === 'TopSongs' ? item.encryptedVideoId : item.id;\r\n                  const author = item.artists\r\n                      .filter((a) => a.name)\r\n                      .map((artist) => artist.name)\r\n                      .join(', ');\r\n                  return {\r\n                      title: `${item.title ?? item.name} - ${author}`,\r\n                      description: renderDescription(embed, videoId, item.thumbnail?.thumbnails.pop().url, ''),\r\n                      link: `https://www.youtube.com/watch?v=${videoId}`,\r\n                      guid: `youtube:charts:${category}:${entityId}:${item.id}`,\r\n                      author,\r\n                  };\r\n              });\r\n\r\n    return {\r\n        title: `YouTube Music Charts - ${contentMap[category].title}`,\r\n        link: `https://charts.youtube.com/charts/${category}/${country ?? 'global'}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"sYAMA,MAAaA,EAAe,CACxB,KAAM,uCACN,WAAY,CAAC,gBACb,QAAS,kBACT,WAAY,CAAE,SAAU,iDAAkD,QAAS,mDAAoD,MAAO,qEAC9I,KAAM,eACN,YAAa,CAAC,UACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;yBA6CjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAa,CACf,WAAY,CACR,WAAY,UACZ,QAAS,cACT,MAAO,eAEX,SAAU,CACN,WAAY,aACZ,QAAS,aACT,MAAO,aAEX,UAAW,CACP,WAAY,SACZ,QAAS,aACT,MAAO,oBAEX,eAAgB,CACZ,WAAY,SACZ,QAAS,aACT,MAAO,aAIT,CAAE,WAAW,YAAa,WAAY,EAAI,IAAI,QAC9C,EAAQ,CAAC,EAAI,IAAI,MAAM,SAEvB,CAAE,WAAY,MAAMC,EAAM,OAC5B,kBAAkB,GAAW,WAC7B,SAAY,CACR,IAAM,EAAO,MAAMC,EAAO,gDAAiD,CACvE,OAAQ,OACR,MAAO,CACH,IAAK,OACL,IAAK,2CAET,KAAM,CACF,SAAU,gCACV,QAAS,CACL,aAAc,GACd,OAAQ,CACJ,WAAY,sBACZ,cAAe,MACf,cAAe,GACf,iBAAkB,GAClB,GAAI,KACJ,GAAI,KACJ,MAAO,SAEX,QAAS,CACL,wBAAyB,KAGjC,MAAO,oHAAoH,EAAU,IAAI,IAAY,QAG7J,OAAO,EAAK,SAAS,oBAAoB,SAAS,GAAG,+BAEzD,EAAO,MAAM,YACb,IAGE,CAAE,YAAa,EAAQ,oBAEvB,EACF,IAAa,aACP,EAAQ,EAAW,GAAU,YAAY,GAAG,EAAW,GAAU,SAAS,IAAK,IAAU,CACrF,MAAO,EAAK,KACZ,KAAM,qCAAqC,mBAAmB,EAAK,MACnE,KAAM,kBAAkB,EAAS,GAAG,EAAS,GAAG,EAAK,QAEzD,EAAQ,EAAW,GAAU,YAAY,IAAa,iBAAmB,EAAI,GAAG,EAAW,GAAU,SAAS,IAAK,GAAS,CACxH,IAAM,EAAU,IAAa,WAAa,EAAK,iBAAmB,EAAK,GACjE,EAAS,EAAK,QACf,OAAQ,GAAM,EAAE,MAChB,IAAK,GAAW,EAAO,MACvB,KAAK,MACV,MAAO,CACH,MAAO,GAAG,EAAK,OAAS,EAAK,KAAK,KAAK,IACvC,YAAa,EAAkB,EAAO,EAAS,EAAK,WAAW,WAAW,MAAM,IAAK,IACrF,KAAM,mCAAmC,IACzC,KAAM,kBAAkB,EAAS,GAAG,EAAS,GAAG,EAAK,KACrD,YAIlB,MAAO,CACH,MAAO,0BAA0B,EAAW,GAAU,QACtD,KAAM,qCAAqC,EAAS,GAAG,GAAW,WAClE,KAAM"}