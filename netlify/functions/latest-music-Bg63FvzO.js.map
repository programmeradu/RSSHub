{"version":3,"file":"latest-music-Bg63FvzO.js","names":["route: Route","got","title"],"sources":["../../lib/routes/douban/other/latest-music.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/music/latest/:area?',\r\n    categories: ['social-media'],\r\n    example: '/douban/music/latest/chinese',\r\n    parameters: { area: '区域类型，默认全部' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '最新增加的音乐',\r\n    maintainers: ['fengkx', 'xyqfer'],\r\n    handler,\r\n    description: `| 华语    | 欧美    | 日韩        |\r\n| ------- | ------- | ----------- |\r\n| chinese | western | japankorean |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { area = '' } = ctx.req.param();\r\n    const title = '豆瓣最新增加的音乐';\r\n    let data;\r\n\r\n    if (area === '') {\r\n        const url = 'https://music.douban.com/latest';\r\n        const res = await got.get(url);\r\n        const $ = load(res.data);\r\n        const list = $('.dlist').toArray();\r\n\r\n        data = {\r\n            title,\r\n            link: url,\r\n            item: list.map((item) => ({\r\n                title: $(item).find('.pl2').text(),\r\n                link: $(item).find('.pl2').attr('href'),\r\n                description: $(item).html(),\r\n            })),\r\n        };\r\n    } else {\r\n        const referer = 'https://m.douban.com/music/';\r\n        const mapper = {\r\n            chinese: {\r\n                name: '华语新碟榜',\r\n                path: 'chinese',\r\n            },\r\n\r\n            western: {\r\n                name: '欧美新碟榜',\r\n                path: 'occident',\r\n            },\r\n\r\n            japankorean: {\r\n                name: '日韩新碟榜',\r\n                path: 'japan_korea',\r\n            },\r\n        };\r\n        const res = await got({\r\n            method: 'get',\r\n            url: `https://m.douban.com/rexxar/api/v2/subject_collection/music_${mapper[area].path}/items?os=ios&callback=&start=0&count=20&loc_id=0&_=0`,\r\n            headers: {\r\n                Referer: referer,\r\n            },\r\n        });\r\n\r\n        data = {\r\n            title: `${title}-${mapper[area].name}`,\r\n            link: `${referer}new${area}`,\r\n            item: res.data.subject_collection_items.map((item) => {\r\n                const title = `${item.title}-${item.info}`;\r\n                const link = `https://music.douban.com/subject/${item.id}/`;\r\n                const description = `\r\n                    <img src=\"${item.cover.url}\" /><br>\r\n                    ${item.recommend_comment}<br>\r\n                    <strong>评分:</strong> ${item.rating.value.toFixed(1)}\r\n                `;\r\n                const pubDate = new Date(item.pubdate[0]).toUTCString();\r\n\r\n                return {\r\n                    title,\r\n                    link,\r\n                    description,\r\n                    pubDate,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    return data;\r\n}\r\n"],"mappings":"+PAIA,MAAaA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,gBACb,QAAS,+BACT,WAAY,CAAE,KAAM,aACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,UACN,YAAa,CAAC,SAAU,UACxB,UACA,YAAa;;sCAKjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAO,IAAO,EAAI,IAAI,QACxB,EAAQ,YACV,EAEJ,GAAI,IAAS,GAAI,CACb,IAAM,EAAM,kCACN,EAAM,MAAMC,EAAI,IAAI,GACpB,EAAI,EAAK,EAAI,MACb,EAAO,EAAE,UAAU,UAEzB,EAAO,CACH,QACA,KAAM,EACN,KAAM,EAAK,IAAK,IAAU,CACtB,MAAO,EAAE,GAAM,KAAK,QAAQ,OAC5B,KAAM,EAAE,GAAM,KAAK,QAAQ,KAAK,QAChC,YAAa,EAAE,GAAM,eAG1B,CACH,IAAM,EAAU,8BACV,EAAS,CACX,QAAS,CACL,KAAM,QACN,KAAM,WAGV,QAAS,CACL,KAAM,QACN,KAAM,YAGV,YAAa,CACT,KAAM,QACN,KAAM,gBAGR,EAAM,MAAMA,EAAI,CAClB,OAAQ,MACR,IAAK,+DAA+D,EAAO,GAAM,KAAK,uDACtF,QAAS,CACL,QAAS,KAIjB,EAAO,CACH,MAAO,GAAG,EAAM,GAAG,EAAO,GAAM,OAChC,KAAM,GAAG,EAAQ,KAAK,IACtB,KAAM,EAAI,KAAK,yBAAyB,IAAK,GAAS,CAClD,IAAMC,EAAQ,GAAG,EAAK,MAAM,GAAG,EAAK,OAC9B,EAAO,oCAAoC,EAAK,GAAG,GACnD,EAAc;gCACJ,EAAK,MAAM,IAAI;sBACzB,EAAK,kBAAkB;2CACF,EAAK,OAAO,MAAM,QAAQ,GAAG;kBAElD,EAAU,IAAI,KAAK,EAAK,QAAQ,IAAI,cAE1C,MAAO,CACH,MAAA,EACA,OACA,cACA,cAMhB,OAAO"}