{"version":3,"file":"daily-BFzslzE_.js","names":["route: Route","got","cache","$"],"sources":["../../lib/routes/mrdx/utils.ts","../../lib/routes/mrdx/daily.ts"],"sourcesContent":["function getElementChildrenInnerText(element) {\r\n    let text = '';\r\n    for (const child of element.children) {\r\n        if (child.type === 'text') {\r\n            text += child.data.trim();\r\n        }\r\n        if (child.children !== undefined) {\r\n            text += getElementChildrenInnerText(child);\r\n        }\r\n    }\r\n\r\n    return text;\r\n}\r\n\r\nexport { getElementChildrenInnerText };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { getElementChildrenInnerText } from './utils';\r\nimport dayjs from 'dayjs';\r\nimport utc from 'dayjs/plugin/utc.js';\r\ndayjs.extend(utc);\r\n\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/today',\r\n    categories: ['traditional-media'],\r\n    example: '/mrdx/today',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['mrdx.cn*'],\r\n        },\r\n    ],\r\n    name: '今日',\r\n    maintainers: ['Dustin-Jiang'],\r\n    handler,\r\n    url: 'mrdx.cn*',\r\n};\r\n\r\nasync function handler() {\r\n    const dateFormatted = dayjs().utcOffset(8).format('YYYYMMDD');\r\n\r\n    const baseUrl = `http://mrdx.cn/content/${dateFormatted}`;\r\n    const link = `${baseUrl}/Page01DK.htm`;\r\n\r\n    const indexPageResponse = await got({\r\n        url: link,\r\n        method: 'get',\r\n    });\r\n    const $ = load(indexPageResponse.data);\r\n\r\n    // 当日所有文章Url在<a>的`daoxiang` attribute中\r\n    // 其站点使用**非标准**的HTML语法\r\n    // eg: `<a class=\"foo\" daoxiang=\"foo-bar.htm\">Lorem ipsum</a>`\r\n    const passagesList = $('.listdaohang > ul > li a')\r\n        .toArray()\r\n        .map((item) => ({\r\n            link: new URL(`${baseUrl}/${item.attribs.daoxiang}`).href,\r\n        }));\r\n\r\n    const passages = await Promise.all(\r\n        passagesList.map((passage) =>\r\n            cache.tryGet(passage.link, async () => {\r\n                const response = await got({\r\n                    url: passage.link,\r\n                    method: 'get',\r\n                });\r\n\r\n                const $ = load(response.data);\r\n\r\n                // 标题在`h2`,`h3`,`h4`,`h5`中，有多余空格和换行符\r\n                // 但是Middleware会处理\r\n                const title =\r\n                    getElementChildrenInnerText($('.bggray > .margin15 > h2')[0]) +\r\n                    getElementChildrenInnerText($('.bggray > .margin15 > h3')[0]) +\r\n                    getElementChildrenInnerText($('.bggray > .margin15 > h4')[0]) +\r\n                    getElementChildrenInnerText($('.bggray > .margin15 > h5')[0]);\r\n\r\n                // 作者和发布时间\r\n                // 中间用超多空格分隔\r\n                // 头尾均有多余空格\r\n                // eg: 新华每日电讯     2022年12月21日\r\n                const [author, pubDate] = getElementChildrenInnerText($('.shijian')[0])\r\n                    .split(' ')\r\n                    .filter((item) => item !== '')\r\n                    .map((item) => item.trim());\r\n\r\n                const content = $('.contenttext').html();\r\n\r\n                return {\r\n                    title,\r\n                    author,\r\n                    pubDate: parseDate(pubDate, 'YYYY年MM月DD日'),\r\n                    guid: passage.link,\r\n                    link: passage.link,\r\n                    description: content,\r\n                };\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '新华每日电讯',\r\n        link,\r\n        item: passages,\r\n        description:\r\n            '中国报纸发行前三强。位列《人民日报》，《参考消息》之后。《新华每日电讯》是新华社出版的一份新闻电讯报，1993年创办，具有很高的权威性和准确性，有“一报在手，便知天下”之美誉。《新华每日电讯》为对开八版日报，集中刊登[新华社]每天向国内播发的电讯稿及图片稿。打开《新华每日电讯》，中国和全世界每天发生的重大事件便将一目了然。在人类生活节奏日益加快的当今世界，《新华每日电讯》以最便捷、最醒目的方式为公众提供最重要的新闻报道，受到公众的喜爱和拥护。',\r\n    };\r\n}\r\n"],"mappings":"gaAAA,SAAS,EAA4B,EAAS,CAC1C,IAAI,EAAO,GACX,IAAK,IAAM,KAAS,EAAQ,SACpB,EAAM,OAAS,SACf,GAAQ,EAAM,KAAK,QAEnB,EAAM,WAAa,IAAA,KACnB,GAAQ,EAA4B,IAI5C,OAAO,ECJX,EAAM,OAAO,GAIb,MAAaA,EAAe,CACxB,KAAM,SACN,WAAY,CAAC,qBACb,QAAS,cACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,cAGjB,KAAM,KACN,YAAa,CAAC,gBACd,UACA,IAAK,YAGT,eAAe,GAAU,CACrB,IAAM,EAAgB,IAAQ,UAAU,GAAG,OAAO,YAE5C,EAAU,0BAA0B,IACpC,EAAO,GAAG,EAAQ,eAElB,EAAoB,MAAMC,EAAI,CAChC,IAAK,EACL,OAAQ,QAEN,EAAI,EAAK,EAAkB,MAK3B,EAAe,EAAE,4BAClB,UACA,IAAK,IAAU,CACZ,KAAM,IAAI,IAAI,GAAG,EAAQ,GAAG,EAAK,QAAQ,YAAY,QAGvD,EAAW,MAAM,QAAQ,IAC3B,EAAa,IAAK,GACdC,EAAM,OAAO,EAAQ,KAAM,SAAY,CACnC,IAAM,EAAW,MAAMD,EAAI,CACvB,IAAK,EAAQ,KACb,OAAQ,QAGNE,EAAI,EAAK,EAAS,MAIlB,EACF,EAA4BA,EAAE,4BAA4B,IAC1D,EAA4BA,EAAE,4BAA4B,IAC1D,EAA4BA,EAAE,4BAA4B,IAC1D,EAA4BA,EAAE,4BAA4B,IAMxD,CAAC,EAAQ,GAAW,EAA4BA,EAAE,YAAY,IAC/D,MAAM,KACN,OAAQ,GAAS,IAAS,IAC1B,IAAK,GAAS,EAAK,QAElB,EAAUA,EAAE,gBAAgB,OAElC,MAAO,CACH,QACA,SACA,QAAS,EAAU,EAAS,eAC5B,KAAM,EAAQ,KACd,KAAM,EAAQ,KACd,YAAa,OAM7B,MAAO,CACH,MAAO,SACP,OACA,KAAM,EACN,YACI"}