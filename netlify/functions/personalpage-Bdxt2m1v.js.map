{"version":3,"file":"personalpage-Bdxt2m1v.js","names":["route: Route","got"],"sources":["../../lib/routes/guancha/personalpage.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/personalpage/:uid',\r\n    categories: ['new-media'],\r\n    example: '/guancha/personalpage/243983',\r\n    parameters: { uid: '用户id， 可在URL中找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '个人主页文章',\r\n    maintainers: ['Jeason0228'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const uid = ctx.req.param('uid');\r\n    const host = 'https://user.guancha.cn';\r\n    const link = `https://app.guancha.cn/user/get-published-list?page_size=20&page_no=1&uid=${uid}`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url: link,\r\n        headers: {\r\n            Referer: host,\r\n        },\r\n    });\r\n    const list = response.data.data.items;\r\n    const user_nick = list[0].user_nick;\r\n\r\n    /** Get time from relative time in HTML */\r\n    function getpass_at(e) {\r\n        const minuteRelativeTime = /(\\d+)\\s*分钟前/;\r\n        const hourRelativeTime = /(\\d+)\\s*小时前/;\r\n        const yesterdayRelativeTime = /昨天\\s*(\\d+):(\\d+)/;\r\n        const shortDate = /(\\d+)-(\\d+)\\s*(\\d+):(\\d+)/;\r\n\r\n        // offset to ADD for transforming China time to UTC\r\n        const chinaToUtcOffset = -8 * 3600 * 1000;\r\n        // offset to ADD for transforming local time to UTC\r\n        const localToUtcOffset = new Date().getTimezoneOffset() * 60 * 1000;\r\n        // offset to ADD for transforming local time to china time\r\n        const localToChinaOffset = localToUtcOffset - chinaToUtcOffset;\r\n\r\n        let time;\r\n        if (e === '刚刚') {\r\n            time = new Date();\r\n        } else if (minuteRelativeTime.test(e)) {\r\n            const rel = minuteRelativeTime.exec(e);\r\n            time = new Date(Date.now() - Number.parseInt(rel[1]) * 60 * 1000);\r\n        } else if (hourRelativeTime.test(e)) {\r\n            const rel = hourRelativeTime.exec(e);\r\n            time = new Date(Date.now() - Number.parseInt(rel[1]) * 60 * 60 * 1000);\r\n        } else if (yesterdayRelativeTime.test(e)) {\r\n            const rel = yesterdayRelativeTime.exec(e);\r\n            // this time is China time data in local timezone\r\n            time = new Date(Date.now() - 86400 * 1000 + localToChinaOffset);\r\n            time.setHours(Number.parseInt(rel[1]), Number.parseInt(rel[2]), 0, 0);\r\n            // transform back to china timezone\r\n            time = new Date(time.getTime() - localToChinaOffset);\r\n        } else if (shortDate.test(e)) {\r\n            const rel = shortDate.exec(e);\r\n            const now = new Date(Date.now() + localToChinaOffset);\r\n            const year = now.getFullYear();\r\n            // this time is China time data in local timezone\r\n            time = new Date(year, Number.parseInt(rel[1]) - 1, Number.parseInt(rel[2]), Number.parseInt(rel[3]), Number.parseInt(rel[4]));\r\n            // transform back to china timezone\r\n            time = new Date(time.getTime() - localToChinaOffset);\r\n        } else {\r\n            time = new Date(e);\r\n        }\r\n        return time;\r\n    }\r\n    return {\r\n        title: `${user_nick}-观察者-风闻社区`,\r\n        link,\r\n        description: `${user_nick} 的个人主页`,\r\n        item: list.map((item) => ({\r\n            title: item.title,\r\n            description: item.summary,\r\n            pubDate: getpass_at(item.pass_at),\r\n            link: `https://user.guancha.cn/main/content?id=${item.id}`,\r\n            author: item.user_nick,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"gOAGA,MAAaA,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,aACb,QAAS,+BACT,WAAY,CAAE,IAAK,kBACnB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,cACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,EAAI,IAAI,MAAM,OAEpB,EAAO,6EAA6E,IACpF,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,6BAGX,EAAO,EAAS,KAAK,KAAK,MAC1B,EAAY,EAAK,GAAG,UAG1B,SAAS,EAAW,EAAG,CACnB,IAAM,EAAqB,cACrB,EAAmB,cACnB,EAAwB,mBACxB,EAAY,4BAKZ,EAAmB,IAAI,OAAO,oBAAsB,GAAK,IAEzD,EAAqB,EAAmB,QAE1C,EACJ,GAAI,IAAM,KACN,EAAO,IAAI,aACJ,EAAmB,KAAK,GAAI,CACnC,IAAM,EAAM,EAAmB,KAAK,GACpC,EAAO,IAAI,KAAK,KAAK,MAAQ,OAAO,SAAS,EAAI,IAAM,GAAK,aACrD,EAAiB,KAAK,GAAI,CACjC,IAAM,EAAM,EAAiB,KAAK,GAClC,EAAO,IAAI,KAAK,KAAK,MAAQ,OAAO,SAAS,EAAI,IAAM,GAAK,GAAK,aAC1D,EAAsB,KAAK,GAAI,CACtC,IAAM,EAAM,EAAsB,KAAK,GAEvC,EAAO,IAAI,KAAK,KAAK,MAAQ,MAAQ,IAAO,GAC5C,EAAK,SAAS,OAAO,SAAS,EAAI,IAAK,OAAO,SAAS,EAAI,IAAK,EAAG,GAEnE,EAAO,IAAI,KAAK,EAAK,UAAY,WAC1B,EAAU,KAAK,GAAI,CAC1B,IAAM,EAAM,EAAU,KAAK,GACrB,EAAM,IAAI,KAAK,KAAK,MAAQ,GAC5B,EAAO,EAAI,cAEjB,EAAO,IAAI,KAAK,EAAM,OAAO,SAAS,EAAI,IAAM,EAAG,OAAO,SAAS,EAAI,IAAK,OAAO,SAAS,EAAI,IAAK,OAAO,SAAS,EAAI,KAEzH,EAAO,IAAI,KAAK,EAAK,UAAY,QAEjC,EAAO,IAAI,KAAK,GAEpB,OAAO,EAEX,MAAO,CACH,MAAO,GAAG,EAAU,WACpB,OACA,YAAa,GAAG,EAAU,QAC1B,KAAM,EAAK,IAAK,IAAU,CACtB,MAAO,EAAK,MACZ,YAAa,EAAK,QAClB,QAAS,EAAW,EAAK,SACzB,KAAM,2CAA2C,EAAK,KACtD,OAAQ,EAAK"}