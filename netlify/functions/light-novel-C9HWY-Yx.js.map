{"version":3,"file":"light-novel-C9HWY-Yx.js","names":["route: Route","got","cache","response"],"sources":["../../lib/routes/lightnovel/light-novel.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { config } from '@/config';\r\n\r\nexport const route: Route = {\r\n    path: '/:keywords/:security_key?',\r\n    radar: [\r\n        {\r\n            source: ['lightNovel.us/'],\r\n            target: '/:keywords/:security_key',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['nightmare-mio'],\r\n    handler,\r\n    url: 'lightNovel.us/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://www.lightnovel.us';\r\n    const { type, keywords, security_key = config.lightnovel.cookie } = ctx.req.param();\r\n    const { data: response } = await got({\r\n        method: 'POST',\r\n        url: `${baseUrl}/proxy/api/search/search-result`,\r\n        headers: {\r\n            // 此处是为什么\r\n            'User-Agent': config.trueUA,\r\n        },\r\n        json: {\r\n            is_encrypted: 0,\r\n            platform: 'pc',\r\n            client: 'web',\r\n            sign: '',\r\n            gz: 0,\r\n            d: {\r\n                q: keywords,\r\n                type: 0,\r\n                page: 1,\r\n                security_key,\r\n            },\r\n        },\r\n    });\r\n    const list = response.data.articles\r\n        .map((item) => ({\r\n            title: item.title,\r\n            link: `${baseUrl}/cn/detail/${item.aid}`,\r\n            pubDate: parseDate(item.time),\r\n            author: item.author,\r\n        }))\r\n        .slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 5);\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got({\r\n                    method: 'GET',\r\n                    url: item.link,\r\n                    headers: {\r\n                        'User-Agent': config.trueUA,\r\n                    },\r\n                });\r\n\r\n                const $ = load(response);\r\n                item.description = $('#article-main-contents').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `轻之国度-追踪${keywords}更新-${type} `,\r\n        link: baseUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"yXAOA,MAAaA,EAAe,CACxB,KAAM,4BACN,MAAO,CACH,CACI,OAAQ,CAAC,kBACT,OAAQ,6BAGhB,KAAM,UACN,YAAa,CAAC,iBACd,UACA,IAAK,kBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,4BACV,CAAE,OAAM,WAAU,eAAe,EAAO,WAAW,QAAW,EAAI,IAAI,QACtE,CAAE,KAAM,GAAa,MAAMC,EAAI,CACjC,OAAQ,OACR,IAAK,GAAG,EAAQ,iCAChB,QAAS,CAEL,aAAc,EAAO,QAEzB,KAAM,CACF,aAAc,EACd,SAAU,KACV,OAAQ,MACR,KAAM,GACN,GAAI,EACJ,EAAG,CACC,EAAG,EACH,KAAM,EACN,KAAM,EACN,mBAIN,EAAO,EAAS,KAAK,SACtB,IAAK,IAAU,CACZ,MAAO,EAAK,MACZ,KAAM,GAAG,EAAQ,aAAa,EAAK,MACnC,QAAS,EAAU,EAAK,MACxB,OAAQ,EAAK,UAEhB,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GAE3E,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,CACjC,OAAQ,MACR,IAAK,EAAK,KACV,QAAS,CACL,aAAc,EAAO,UAIvB,EAAI,EAAKE,GAEf,MADA,GAAK,YAAc,EAAE,0BAA0B,OACxC,MAKnB,MAAO,CACH,MAAO,UAAU,EAAS,KAAK,EAAK,GACpC,KAAM,EACN,KAAM"}