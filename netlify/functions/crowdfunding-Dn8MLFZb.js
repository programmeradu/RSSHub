import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{ofetch_default as i}from"./ofetch-Bzt0BXUH.js";import{ViewType as a}from"./types-A5bA50Mg.js";import o from"node:path";import s from"dayjs";import c from"dayjs/plugin/localizedFormat.js";import"dayjs/locale/zh-cn.js";import l from"dayjs/plugin/utc.js";import u from"dayjs/plugin/timezone.js";t(),s.extend(c),s.extend(u),s.extend(l);const d=async()=>{let e=await i(`https://m.mi.com/v1/crowd/crowd_home`,{headers:{referrer:`https://m.mi.com/`},method:`POST`});return e.data.list},f=e=>n.tryGet(`mi:crowdfunding:${e.project_id}`,async()=>{let t=await i(`https://m.mi.com/v1/crowd/crowd_detail`,{headers:{referrer:`https://m.mi.com/crowdfunding/home`},method:`POST`,query:{project_id:e.project_id}});return t.data.crowd_funding_info.product_market_price===void 0&&(t.data.crowd_funding_info.product_market_price=e.product_market_price),t.data.crowd_funding_info.start_time_desc===void 0&&(t.data.crowd_funding_info.start_time_desc=m(t.data.crowd_funding_info.start_time)),t.data.crowd_funding_info.end_time_desc===void 0&&(t.data.crowd_funding_info.end_time_desc=m(t.data.crowd_funding_info.end_time)),t.data.crowd_funding_info}),p=t=>r(o.join(e,`templates/crowdfunding-9cdbe8e7.art`),t),m=e=>s.unix(e).tz(`Asia/Shanghai`).locale(`zh-cn`).format(`lll`);var h={getCrowdfundingList:d,getCrowdfundingItem:f,renderCrowdfunding:p};const g={path:`/crowdfunding`,categories:[`shopping`],example:`/mi/crowdfunding`,name:`小米众筹`,maintainers:[`DIYgod`,`nuomi1`],handler:y,features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`m.mi.com/crowdfunding/home`],target:`/crowdfunding`}],view:a.Notifications},_=async e=>{let t=e.flatMap(e=>e.items.map(e=>h.getCrowdfundingItem(e)));return await Promise.all(t)},v=e=>({title:e.project_name,description:h.renderCrowdfunding(e),link:`https://m.mi.com/crowdfunding/proddetail/${e.project_id}`,image:e.big_image,language:`zh-cn`});async function y(){let e=await h.getCrowdfundingList(),t=await _(e),n=t.map(e=>v(e));return{title:`小米众筹`,link:`https://m.mi.com/crowdfunding/home`,item:n,allowEmpty:!0,image:`https://m.mi.com/static/img/icons/apple-touch-icon-152x152.png`,language:`zh-cn`}}export{g as route};
//# sourceMappingURL=crowdfunding-Dn8MLFZb.js.map