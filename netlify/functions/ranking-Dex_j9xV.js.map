{"version":3,"file":"ranking-Dex_j9xV.js","names":["route: Route","ConfigNotFoundError","got"],"sources":["../../lib/routes/smzdm/ranking.ts"],"sourcesContent":["import { config } from '@/config';\r\nimport { Route, ViewType } from '@/types';\r\nimport got from '@/utils/got';\r\nimport timezone from '@/utils/timezone';\r\nimport { getHeaders } from './utils';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nconst getTrueHour = (rank_type, rank_id, hour) => {\r\n    const rank_two_hour = ['11', '17', '28', '29'];\r\n    const rank_four_hour = ['12', '13', '14', '15', '17', '74', '75', '71', '25'];\r\n    const flag = ['pinlei', 'dianshang'].includes(rank_type) && [...rank_two_hour, ...rank_four_hour].includes(rank_id) && hour === '3';\r\n    if (flag) {\r\n        return rank_two_hour.includes(rank_id) ? '2' : '4';\r\n    } else {\r\n        return hour;\r\n    }\r\n};\r\n\r\nconst typeOptions = [\r\n    {\r\n        value: 'pinlei',\r\n        label: '好价品类榜',\r\n    },\r\n    {\r\n        value: 'dianshang',\r\n        label: '好价电商榜',\r\n    },\r\n    {\r\n        value: 'haitao',\r\n        label: '海淘 TOP 榜',\r\n    },\r\n    {\r\n        value: 'haowen',\r\n        label: '好文排行榜',\r\n    },\r\n    {\r\n        value: 'haowu',\r\n        label: '好物排行榜',\r\n    },\r\n];\r\nconst idOptions = [\r\n    {\r\n        label: '好价品类榜-全部',\r\n        value: '11',\r\n    },\r\n    {\r\n        label: '好价品类榜-食品生鲜',\r\n        value: '12',\r\n    },\r\n    {\r\n        label: '好价品类榜-电脑数码',\r\n        value: '13',\r\n    },\r\n    {\r\n        label: '好价品类榜-运动户外',\r\n        value: '14',\r\n    },\r\n    {\r\n        label: '好价品类榜-家用电器',\r\n        value: '15',\r\n    },\r\n    {\r\n        label: '好价品类榜-白菜',\r\n        value: '17',\r\n    },\r\n    {\r\n        label: '好价品类榜-服饰鞋包',\r\n        value: '74',\r\n    },\r\n    {\r\n        label: '好价品类榜-日用百货',\r\n        value: '75',\r\n    },\r\n    {\r\n        label: '好价电商榜-券活动',\r\n        value: '24',\r\n    },\r\n    {\r\n        label: '好价电商榜-京东',\r\n        value: '23',\r\n    },\r\n    {\r\n        label: '好价电商榜-天猫',\r\n        value: '25',\r\n    },\r\n    {\r\n        label: '好价电商榜-亚马逊中国',\r\n        value: '26',\r\n    },\r\n    {\r\n        label: '好价电商榜-国美在线',\r\n        value: '27',\r\n    },\r\n    {\r\n        label: '好价电商榜-苏宁易购',\r\n        value: '28',\r\n    },\r\n    {\r\n        label: '好价电商榜-网易',\r\n        value: '29',\r\n    },\r\n    {\r\n        label: '好价电商榜-西集网',\r\n        value: '30',\r\n    },\r\n    {\r\n        label: '好价电商榜-美国亚马逊',\r\n        value: '31',\r\n    },\r\n    {\r\n        label: '好价电商榜-日本亚马逊',\r\n        value: '32',\r\n    },\r\n    {\r\n        label: '好价电商榜-ebay',\r\n        value: '33',\r\n    },\r\n    {\r\n        label: '海淘 TOP 榜-全部',\r\n        value: '39',\r\n    },\r\n    {\r\n        label: '海淘 TOP 榜-海外直邮',\r\n        value: '34',\r\n    },\r\n    {\r\n        label: '海淘 TOP 榜-美国榜',\r\n        value: '35',\r\n    },\r\n    {\r\n        label: '海淘 TOP 榜-欧洲榜',\r\n        value: '36',\r\n    },\r\n    {\r\n        label: '海淘 TOP 榜-澳新榜',\r\n        value: '37',\r\n    },\r\n    {\r\n        label: '海淘 TOP 榜-亚洲榜',\r\n        value: '38',\r\n    },\r\n    {\r\n        label: '海淘 TOP 榜-晒物榜',\r\n        value: 'hsw',\r\n    },\r\n    {\r\n        label: '好文排行榜-原创',\r\n        value: 'yc',\r\n    },\r\n    {\r\n        label: '好文排行榜-资讯',\r\n        value: 'zx',\r\n    },\r\n    {\r\n        label: '好物排行榜-新晋榜',\r\n        value: 'hwall',\r\n    },\r\n    {\r\n        label: '好物排行榜-消费众测',\r\n        value: 'zc',\r\n    },\r\n    {\r\n        label: '好物排行榜-新锐品牌',\r\n        value: 'nb',\r\n    },\r\n    {\r\n        label: '好物排行榜-好物榜单',\r\n        value: 'hw',\r\n    },\r\n];\r\n\r\nexport const route: Route = {\r\n    path: '/ranking/:rank_type/:rank_id/:hour',\r\n    categories: ['shopping'],\r\n    view: ViewType.Notifications,\r\n    example: '/smzdm/ranking/pinlei/11/3',\r\n    parameters: {\r\n        rank_type: {\r\n            description: '榜单类型',\r\n            options: typeOptions,\r\n        },\r\n        rank_id: {\r\n            description: '榜单ID',\r\n            options: idOptions,\r\n        },\r\n        hour: {\r\n            description: '时间跨度',\r\n            options: [\r\n                {\r\n                    value: '3',\r\n                    label: '3 小时',\r\n                },\r\n                {\r\n                    value: '12',\r\n                    label: '12 小时',\r\n                },\r\n                {\r\n                    value: '24',\r\n                    label: '24 小时',\r\n                },\r\n            ],\r\n        },\r\n    },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'SMZDM_COOKIE',\r\n                description: '什么值得买登录后的 Cookie 值',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '排行榜',\r\n    maintainers: ['DIYgod'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    if (!config.smzdm.cookie) {\r\n        throw new ConfigNotFoundError('什么值得买排行榜 is disabled due to the lack of SMZDM_COOKIE');\r\n    }\r\n\r\n    const { rank_type, rank_id, hour } = ctx.req.param();\r\n\r\n    // When the hour is 3, some special rank_id require a special hour num\r\n    const true_hour = getTrueHour(rank_type, rank_id, hour);\r\n\r\n    const response = await got(`https://www.smzdm.com/top/json_more`, {\r\n        headers: {\r\n            Referer: 'https://www.smzdm.com/top',\r\n            ...getHeaders(),\r\n        },\r\n        searchParams: {\r\n            rank_type,\r\n            rank_id,\r\n            hour: true_hour,\r\n        },\r\n    });\r\n\r\n    const data = response.data.data.list;\r\n    const list1 = [];\r\n    const list2 = [];\r\n    for (let i = 0; i < Math.min(6, data.length); i++) {\r\n        if (data[i][0].length !== 0) {\r\n            list1.push(data[i][0]);\r\n        }\r\n        if (data[i][1].length !== 0) {\r\n            list2.push(data[i][1]);\r\n        }\r\n    }\r\n    const list = [...list1, ...list2];\r\n\r\n    return {\r\n        title: `什么值得买${typeOptions.find((item) => item.value === rank_type)?.label}-${idOptions.find((item) => item.value === rank_id)?.label}-${hour}小时`,\r\n        link: 'https://www.smzdm.com/top/',\r\n        allowEmpty: true,\r\n        item: list.map((item) => ({\r\n            title: `${item.article_title} - ${item.article_price}`,\r\n            description: `${item.article_title} - ${item.article_price}<br><img src=\"${item.article_pic}\">`,\r\n            pubDate: timezone(item.article_pubdate, +8),\r\n            link: item.article_url,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"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"}