{"version":3,"file":"data-NBd5yex-.js","names":[],"sources":["../../lib/routes/tencent/news/coronavirus/data.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport { getData } from './utils';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: '/news/coronavirus/data/:province?/:city?',\r\n    name: 'Unknown',\r\n    maintainers: ['CaoMeiYouRen'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const province = ctx.req.param('province') || '';\r\n    const city = ctx.req.param('city') || '';\r\n\r\n    const link = 'https://news.qq.com/zt2020/page/feiyan.htm#/';\r\n    const item = [];\r\n\r\n    const diseaseh5Shelf = (await getData(['diseaseh5Shelf']))?.data?.diseaseh5Shelf || {};\r\n    const { lastUpdateTime, areaTree } = diseaseh5Shelf;\r\n    const nationalData = areaTree?.[0];\r\n    const provinceList = nationalData?.children;\r\n\r\n    let todayConfirm = 0;\r\n    let totalNowConfirm = 0;\r\n    let totalConfirm = 0;\r\n    let totalDead = 0;\r\n    let coronavirusData = {};\r\n    let placeName = '';\r\n\r\n    if (!province || province === '中国' || province === '全国') {\r\n        // 没有传参则取全国\r\n        coronavirusData = nationalData;\r\n        placeName = '中国';\r\n    } else {\r\n        // 分省份获取\r\n        coronavirusData = provinceList?.find((e) => e.name === province);\r\n        placeName = province;\r\n        if (city) {\r\n            // 继续获取 区县 数据\r\n            coronavirusData = coronavirusData?.children?.find((e) => e.name === city);\r\n            if (coronavirusData) {\r\n                placeName = `${province}-${city}`;\r\n            }\r\n        }\r\n    }\r\n    if (!coronavirusData) {\r\n        throw new InvalidParameterError(`未找到 ${placeName} 的疫情数据，请检查输入的省市名称是否正确`);\r\n    }\r\n    todayConfirm = coronavirusData.today?.confirm;\r\n    totalNowConfirm = coronavirusData.total?.nowConfirm;\r\n    totalConfirm = coronavirusData.total?.confirm;\r\n    totalDead = coronavirusData.total?.dead;\r\n    const pubDate = parseDate(coronavirusData.total?.mtime || lastUpdateTime);\r\n\r\n    const title = `${placeName} - 腾讯新闻 - 新型冠状病毒肺炎疫情实时追踪`;\r\n\r\n    const info = {\r\n        title: `${placeName} - 疫情数据`,\r\n        description: art(path.join(__dirname, '../../templates/coronavirus/data.art'), {\r\n            todayConfirm,\r\n            totalNowConfirm,\r\n            totalConfirm,\r\n            totalDead,\r\n        }),\r\n        pubDate,\r\n        guid: `${link}${placeName}?pubDate=${pubDate.toISOString()}`,\r\n    };\r\n\r\n    item.push(info);\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        item,\r\n    };\r\n}\r\n"],"mappings":"yeAQA,MAAa,EAAe,CACxB,KAAM,2CACN,KAAM,UACN,YAAa,CAAC,gBACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,GACxC,EAAO,EAAI,IAAI,MAAM,SAAW,GAEhC,EAAO,+CACP,EAAO,GAEP,GAAkB,MAAM,EAAQ,CAAC,qBAAqB,MAAM,gBAAkB,GAC9E,CAAE,iBAAgB,YAAa,EAC/B,EAAe,IAAW,GAC1B,EAAe,GAAc,SAE/B,EAAe,EACf,EAAkB,EAClB,EAAe,EACf,EAAY,EACZ,EAAkB,GAClB,EAAY,GAkBhB,GAhBI,CAAC,GAAY,IAAa,MAAQ,IAAa,MAE/C,EAAkB,EAClB,EAAY,OAGZ,EAAkB,GAAc,KAAM,GAAM,EAAE,OAAS,GACvD,EAAY,EACR,IAEA,EAAkB,GAAiB,UAAU,KAAM,GAAM,EAAE,OAAS,GAChE,IACA,EAAY,GAAG,EAAS,GAAG,OAInC,CAAC,EACD,MAAM,IAAI,EAAsB,OAAO,EAAU,wBAErD,EAAe,EAAgB,OAAO,QACtC,EAAkB,EAAgB,OAAO,WACzC,EAAe,EAAgB,OAAO,QACtC,EAAY,EAAgB,OAAO,KACnC,IAAM,EAAU,EAAU,EAAgB,OAAO,OAAS,GAEpD,EAAQ,GAAG,EAAU,0BAErB,EAAO,CACT,MAAO,GAAG,EAAU,SACpB,YAAa,EAAI,EAAA,KAAA,EAAA,+BAA8D,CAC3E,eACA,kBACA,eACA,cAEJ,UACA,KAAM,GAAG,IAAO,EAAU,WAAW,EAAQ,iBAKjD,OAFA,EAAK,KAAK,GAEH,CACH,QACA,OACA"}