import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import{logger_default as e}from"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import{ofetch_default as r}from"./ofetch-Bzt0BXUH.js";import*as i from"cheerio";const a={path:`/mobile`,categories:[`new-media`],example:`/sohu/mobile`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`m.sohu.com/limit`],target:`/mobile`}],name:`首页新闻`,maintainers:[`asqwe1`],handler:o,description:`订阅手机搜狐网的首页新闻`};async function o(){let n=await r(`https://m.sohu.com/limit`),a=i.load(n),o=a(`script:contains("WapHomeRenderData")`).text(),u=o?.match(/window\.WapHomeRenderData\s*=\s*({.*})/s);if(!u?.[1])throw Error(`WapHomeRenderData 数据未找到`);let d=JSON.parse(u[1]),f=s(d).filter(e=>e.id&&e.url?.startsWith(`//`)).map(e=>({title:e.title,link:new URL(e.url.split(`?`)[0],`https://m.sohu.com`).href})),p=await Promise.all(f.map(n=>t.tryGet(n.link,async()=>{try{let e=await r(n.link),t=i.load(e),a=``,o=``;if(n.link.includes(`/xtopic/`)){let e=t(`.tpl-top-text-item-content`).prop(`href`)?.split(`?`)[0]?.replace(`www.sohu.com/`,`m.sohu.com/`),n=await r(`https:${e}`),s=i.load(n);a=l(s),o=c(s)}return{...n,description:a||l(t)||n.title,pubDate:o||c(t)}}catch(t){return e.error(`获取详情失败: ${n.link}`,t),n}})));return{title:`手机搜狐新闻`,link:`https://m.sohu.com/limit`,item:p.filter(Boolean)}}function s(e){let t=[];for(let n of Object.keys(e))if(n.startsWith(`PlateBlock`)){let r=e[n];r?.param?.newsData?.list&&t.push(...r.param.newsData.list),r?.param?.focusData?.list&&t.push(...r.param.focusData.list),r?.param?.feedData0?.list&&t.push(...r.param.feedData0.list),r?.param?.feedData1?.list&&t.push(...r.param.feedData1.list)}return t}function c(e){let t=[`.time`,`#videoPublicTime`],r;for(let i of t){let t=e(i).first().text().trim();if(!t)continue;if(r=n(t),r)return r}let i=e(`meta[name="share_img"]`).toArray().map(t=>e(t).attr(`src`)).find(e=>e.includes(`images01`));if(r=i?n(i?.match(/images01\/(\d{8})\//i)?.[1]):``,r)return r}function l(e){let t=e(`#articleContent`);if(t.length)return t.first().html()?.trim();let n=e(`#videoPlayer div`);if(n.length)return`<video controls preload="auto" poster="${n.attr(`data-thumbnail`)}"><source src="${n.attr(`data-url`)}" /></video>`;let r=e(`script:contains("imageList")`).text();if(r){let e=JSON.parse(r.match(/(\[.*\])/s)?.[1].replaceAll(/("description": ".*"),/g,`$1`)||`[]`);return e.map(e=>`<img src="${e.url}" alt="${e.description||``}" />`).join(``)}return``}export{a as route};
//# sourceMappingURL=mobile-C5p4-8FU.js.map