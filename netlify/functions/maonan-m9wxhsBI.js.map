{"version":3,"file":"maonan-m9wxhsBI.js","names":["route: Route","got","cache","res"],"sources":["../../lib/routes/gov/maonan/maonan.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst host = 'http://www.maonan.gov.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/maonan/:category',\r\n    categories: ['government'],\r\n    example: '/gov/maonan/zwgk',\r\n    parameters: { category: '分类名' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '茂名市茂南区人民政府',\r\n    maintainers: ['ShuiHuo'],\r\n    handler,\r\n    description: `| 政务公开 | 政务新闻 | 茂南动态 | 重大会议 | 公告公示 | 招录信息 | 政策解读 |\r\n| :------: | :------: | :------: | :------: | :------: | :------: | :------: |\r\n|   zwgk   |   zwxw   |   mndt   |   zdhy   |   tzgg   |   zlxx   |   zcjd   |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let id = '';\r\n    let name = '';\r\n\r\n    switch (ctx.req.param('category')) {\r\n        case 'zwgk':\r\n            id = 'zwgk';\r\n            name = '政务公开';\r\n            break;\r\n        case 'zwxw':\r\n            id = 'zwxw';\r\n            name = '政务新闻';\r\n            break;\r\n        case 'mndt':\r\n            id = 'zwxw/mndt';\r\n            name = '茂南动态';\r\n            break;\r\n        case 'zdhy':\r\n            id = 'zwxw/zdhy';\r\n            name = '重大会议';\r\n            break;\r\n        case 'tzgg':\r\n            id = 'zwgk/tzgg';\r\n            name = '公告公示';\r\n            break;\r\n        case 'zlxx':\r\n            id = 'zwgk/zlxx';\r\n            name = '招录信息';\r\n            break;\r\n        case 'zcjd':\r\n            id = 'zwgk/zcjd';\r\n            name = '政策解读';\r\n            break;\r\n    }\r\n\r\n    const res = await got(`${host}/${id}/`);\r\n    const dataArray = res.data;\r\n    const $ = load(dataArray);\r\n    const list = $('li.clearfix a[href*=\"www.maonan.gov.cn\"], li.clearfix a[href*=\"mp.weixin.qq.com\"]');\r\n\r\n    const items = await Promise.all(\r\n        list.map((i, item) => {\r\n            item = $(item);\r\n\r\n            const url = new URL(item.attr('href'));\r\n            const link = url.href;\r\n\r\n            const pubDate = timezone(parseDate($('a[href=\"' + link + '\"] ~ .time').text()), +8);\r\n\r\n            return cache.tryGet(link, async () => {\r\n                // 获取网页\r\n                const { data: res } = await got(link);\r\n                const content = load(res);\r\n\r\n                switch (url.host) {\r\n                    case 'mp.weixin.qq.com':\r\n                        return {\r\n                            title: item.text(),\r\n                            description: content('#js_content').html(),\r\n                            pubDate,\r\n                            link,\r\n                            author: content('#js_name').text(),\r\n                        };\r\n                    case 'www.maonan.gov.cn':\r\n                        switch (url.pathname) {\r\n                            case '/zcjdpt':\r\n                                return {\r\n                                    title: content('meta[name=\"ArticleTitle\"]').attr('content'),\r\n                                    description: content('.wrap').html(),\r\n                                    pubDate,\r\n                                    link,\r\n                                    author: content('meta[name=\"ContentSource\"]').attr('content') === '本网' ? '茂名市茂南区人民政府网' : content('meta[name=\"ContentSource\"]').attr('content'),\r\n                                };\r\n                            default:\r\n                                return {\r\n                                    title: content('.newsContainer_title').text(),\r\n                                    description: content('.newsContainer_text').html(),\r\n                                    pubDate,\r\n                                    link,\r\n                                    author: content('.author').text().trim() === '本网' ? '茂名市茂南区人民政府网' : content('.author').text().trim(),\r\n                                };\r\n                        }\r\n                }\r\n            });\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: `茂名市茂南区人民政府 - ${name}`,\r\n        link: `${host}/${id}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAM,EAAO,2BAEAA,EAAe,CACxB,KAAM,oBACN,WAAY,CAAC,cACb,QAAS,mBACT,WAAY,CAAE,SAAU,OACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,aACN,YAAa,CAAC,WACd,UACA,YAAa;;iFAKjB,eAAe,EAAQ,EAAK,CACxB,IAAI,EAAK,GACL,EAAO,GAEX,OAAQ,EAAI,IAAI,MAAM,YAAtB,CACI,IAAK,OACD,EAAK,OACL,EAAO,OACP,MACJ,IAAK,OACD,EAAK,OACL,EAAO,OACP,MACJ,IAAK,OACD,EAAK,YACL,EAAO,OACP,MACJ,IAAK,OACD,EAAK,YACL,EAAO,OACP,MACJ,IAAK,OACD,EAAK,YACL,EAAO,OACP,MACJ,IAAK,OACD,EAAK,YACL,EAAO,OACP,MACJ,IAAK,OACD,EAAK,YACL,EAAO,OACP,MAGR,IAAM,EAAM,MAAMC,EAAI,GAAG,EAAK,GAAG,EAAG,IAC9B,EAAY,EAAI,KAChB,EAAI,EAAK,GACT,EAAO,EAAE,qFAET,EAAQ,MAAM,QAAQ,IACxB,EAAK,KAAK,EAAG,IAAS,CAClB,EAAO,EAAE,GAET,IAAM,EAAM,IAAI,IAAI,EAAK,KAAK,SACxB,EAAO,EAAI,KAEX,EAAU,EAAS,EAAU,EAAE,WAAa,EAAO,cAAc,QAAS,GAEhF,OAAOC,EAAM,OAAO,EAAM,SAAY,CAElC,GAAM,CAAE,KAAMC,GAAQ,MAAMF,EAAI,GAC1B,EAAU,EAAKE,GAErB,OAAQ,EAAI,KAAZ,CACI,IAAK,mBACD,MAAO,CACH,MAAO,EAAK,OACZ,YAAa,EAAQ,eAAe,OACpC,UACA,OACA,OAAQ,EAAQ,YAAY,QAEpC,IAAK,oBACD,OAAQ,EAAI,SAAZ,CACI,IAAK,UACD,MAAO,CACH,MAAO,EAAQ,6BAA6B,KAAK,WACjD,YAAa,EAAQ,SAAS,OAC9B,UACA,OACA,OAAQ,EAAQ,8BAA8B,KAAK,aAAe,KAAO,cAAgB,EAAQ,8BAA8B,KAAK,YAE5I,QACI,MAAO,CACH,MAAO,EAAQ,wBAAwB,OACvC,YAAa,EAAQ,uBAAuB,OAC5C,UACA,OACA,OAAQ,EAAQ,WAAW,OAAO,SAAW,KAAO,cAAgB,EAAQ,WAAW,OAAO,eAQ9H,MAAO,CACH,MAAO,gBAAgB,IACvB,KAAM,GAAG,EAAK,GAAG,IACjB,KAAM"}