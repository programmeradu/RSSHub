{"version":3,"file":"okx-BfYsy8bZ.js","names":["route: Route","ofetch","itemsTemp: { title: string; link: string; pubDate: Date }[]","cache","got","$"],"sources":["../../lib/routes/okx/index.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { Context } from 'hono';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/:section?',\r\n    categories: ['finance'],\r\n    example: '/okx/new-listings',\r\n    parameters: {\r\n        section: {\r\n            description: '公告版块',\r\n            default: 'latest-announcements',\r\n            options: [\r\n                {\r\n                    value: 'latest-announcements',\r\n                    label: '最新公告',\r\n                },\r\n                {\r\n                    value: 'new-listings',\r\n                    label: '新币种上线',\r\n                },\r\n                {\r\n                    value: 'delistings',\r\n                    label: '币对下线',\r\n                },\r\n                {\r\n                    value: 'trading-updates',\r\n                    label: '交易规则更新',\r\n                },\r\n                {\r\n                    value: 'deposit-withdrawal-suspension-resumption',\r\n                    label: '充提暂停/恢复公告',\r\n                },\r\n                {\r\n                    value: 'p2p-trading',\r\n                    label: 'C2C 公告',\r\n                },\r\n                {\r\n                    value: 'web3',\r\n                    label: 'Web3',\r\n                },\r\n                {\r\n                    value: 'earn',\r\n                    label: '赚币',\r\n                },\r\n                {\r\n                    value: 'jumpstart',\r\n                    label: 'Jumpstart',\r\n                },\r\n                {\r\n                    value: 'api',\r\n                    label: 'API公告',\r\n                },\r\n                {\r\n                    value: 'okb-buy-back-burn',\r\n                    label: 'OKB销毁',\r\n                },\r\n                {\r\n                    value: 'others',\r\n                    label: '其他',\r\n                },\r\n            ],\r\n        },\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.okx.com/zh-hans/help/section/:section'],\r\n            target: '/:section',\r\n        },\r\n    ],\r\n    name: '公告',\r\n    maintainers: ['lxl66566'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx: Context) {\r\n    const baseUrl = 'https://www.okx.com';\r\n    let { section = 'latest-announcements' } = ctx.req.param();\r\n    section = section.replace(/^announcements-/, '');\r\n\r\n    const data = await ofetch(`${baseUrl}/zh-hans/help/section/announcements-${section}`);\r\n    const $ = load(data);\r\n\r\n    const ssrData = JSON.parse($('script[data-id=\"__app_data_for_ssr__\"]').text());\r\n    const itemsTemp: { title: string; link: string; pubDate: Date }[] =\r\n        ssrData?.appContext?.initialProps?.sectionData?.articleList?.items?.map((item: { title: string; slug: string; publishTime: string }) => ({\r\n            title: item.title,\r\n            link: `${baseUrl}/zh-hans/help/${item.slug}`,\r\n            pubDate: new Date(item.publishTime),\r\n        })) || [];\r\n\r\n    const items = await Promise.all(\r\n        itemsTemp.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const content = await got(item.link).then((response) => {\r\n                    const $ = load(response.data);\r\n                    return $('div[class^=\"index_richTextContent\"]').html();\r\n                });\r\n\r\n                return {\r\n                    ...item,\r\n                    description: content || '内容获取失败',\r\n                };\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: ssrData?.appContext?.serverSideProps?.sectionOutline?.title || 'Unknown',\r\n        link: `${baseUrl}/zh-hans/help/section/announcements-${section}`,\r\n        item: items as DataItem[],\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"4UAOA,MAAaA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,WACb,QAAS,oBACT,WAAY,CACR,QAAS,CACL,YAAa,OACb,QAAS,uBACT,QAAS,CACL,CACI,MAAO,uBACP,MAAO,QAEX,CACI,MAAO,eACP,MAAO,SAEX,CACI,MAAO,aACP,MAAO,QAEX,CACI,MAAO,kBACP,MAAO,UAEX,CACI,MAAO,2CACP,MAAO,aAEX,CACI,MAAO,cACP,MAAO,UAEX,CACI,MAAO,OACP,MAAO,QAEX,CACI,MAAO,OACP,MAAO,MAEX,CACI,MAAO,YACP,MAAO,aAEX,CACI,MAAO,MACP,MAAO,SAEX,CACI,MAAO,oBACP,MAAO,SAEX,CACI,MAAO,SACP,MAAO,SAKvB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,6CACT,OAAQ,cAGhB,KAAM,KACN,YAAa,CAAC,YACd,WAGJ,eAAe,EAAQ,EAAc,CACjC,IAAM,EAAU,sBACZ,CAAE,UAAU,wBAA2B,EAAI,IAAI,QACnD,EAAU,EAAQ,QAAQ,kBAAmB,IAE7C,IAAM,EAAO,MAAMC,EAAO,GAAG,EAAQ,sCAAsC,KACrE,EAAI,EAAK,GAET,EAAU,KAAK,MAAM,EAAE,0CAA0C,QACjEC,EACF,GAAS,YAAY,cAAc,aAAa,aAAa,OAAO,IAAK,IAAgE,CACrI,MAAO,EAAK,MACZ,KAAM,GAAG,EAAQ,gBAAgB,EAAK,OACtC,QAAS,IAAI,KAAK,EAAK,iBACpB,GAEL,EAAQ,MAAM,QAAQ,IACxB,EAAU,IAAK,GACXC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAU,MAAMC,EAAI,EAAK,MAAM,KAAM,GAAa,CACpD,IAAMC,EAAI,EAAK,EAAS,MACxB,OAAOA,EAAE,uCAAuC,SAGpD,MAAO,CACH,GAAG,EACH,YAAa,GAAW,cAMxC,MAAO,CACH,MAAO,GAAS,YAAY,iBAAiB,gBAAgB,OAAS,UACtE,KAAM,GAAG,EAAQ,sCAAsC,IACvD,KAAM,EACN,WAAY"}