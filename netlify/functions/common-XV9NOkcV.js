import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import{got_default as a}from"./got-CdvI2yKX.js";import{invalid_parameter_default as o}from"./invalid-parameter-CUJdROXf.js";import s from"node:path";import{load as c}from"cheerio";t();const l={1:`同人誌 漢化`,2:`同人誌 CG畫集`,3:`同人誌 Cosplay`,5:`同人誌`,6:`單行本`,7:`雜誌&短篇`,9:`單行本 漢化`,10:`雜誌&短篇 漢化`,12:`同人誌 日語`,13:`單行本 日語`,14:`雜誌&短篇 日語`,16:`同人誌 English`,17:`單行本 English`,18:`雜誌&短篇 English`,19:`韓漫`,20:`韓漫 漢化`,21:`韓漫 生肉`,22:`同人誌 3D漫畫`},u=`https://www.wnacg.com`;async function d(t){let{cid:d,tag:f}=t.req.param();if(d&&!Object.keys(l).includes(d))throw new o(`此分类不存在`);let p=`${u}/albums${d?`-index-cate-${d}`:``}${f?`-index-tag-${f}`:``}.html`,{data:m}=await a(p),h=c(m),g=h(`.gallary_item`).toArray().map(e=>{e=h(e);let t=e.find(`a`).attr(`href`),n=t.match(/^\/photos-index-aid-(\d+)\.html$/)[1];return{title:e.find(`a`).attr(`title`),link:`${u}${t}`,pubDate:i(e.find(`.info_col`).text().replace(/\d+張照片，\n創建於/,``),`YYYY-MM-DD`),aid:n}}),_=await Promise.all(g.map(t=>n.tryGet(t.link,async()=>{let{data:n}=await a(t.link,{headers:{referer:encodeURI(p)}}),i=c(n),o=i(`.uwuinfo p`).first().text(),l=i(`.tagshow`).toArray().map(e=>i(e).text());i(`.addtags`).remove();let d=i(`.uwconn`).html(),{data:f}=await a(`${u}/photos-gallery-aid-${t.aid}.html`,{headers:{referer:`${u}/photos-slide-aid-${t.aid}.html`}});i=c(f);let m=i(`script`).text().match(/var imglist = (\[.*]);"\);/)[1],h=JSON.parse(m.replaceAll(`url:`,`"url":`).replaceAll(`caption:`,`"caption":`).replaceAll(`fast_img_host+\\`,``).replaceAll(`\\`,``));return t.author=o,t.category=l,t.description=r(s.join(e,`templates/manga-1739957c.art`),{description:d,imgList:h}),t})));return{title:h(`head title`).text(),link:p,item:_}}export{d as handler};
//# sourceMappingURL=common-XV9NOkcV.js.map