{"version":3,"file":"live-search-GKvzYMwn.js","names":["route: Route","cache","utils","got"],"sources":["../../lib/routes/bilibili/live-search.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport utils from './utils';\r\nimport cache from './cache';\r\n\r\nexport const route: Route = {\r\n    path: '/live/search/:key/:order',\r\n    categories: ['live'],\r\n    example: '/bilibili/live/search/dota/online',\r\n    parameters: { key: '搜索关键字', order: '排序方式, live_time 开播时间, online 人气' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '直播搜索',\r\n    maintainers: ['Qixingchen'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const key = ctx.req.param('key');\r\n    const order = ctx.req.param('order');\r\n\r\n    const urlEncodedKey = encodeURIComponent(key);\r\n    let orderTitle = '';\r\n\r\n    switch (order) {\r\n        case 'live_time':\r\n            orderTitle = '最新开播';\r\n            break;\r\n        case 'online':\r\n            orderTitle = '人气直播';\r\n            break;\r\n    }\r\n    const wbiVerifyString = await cache.getWbiVerifyString();\r\n    let params = `__refresh__=true&_extra=&context=&page=1&page_size=42&order=${order}&duration=&from_source=&from_spmid=333.337&platform=pc&highlight=1&single_column=0&keyword=${urlEncodedKey}&ad_resource=&source_tag=3&gaia_vtoken=&category_id=&search_type=live&dynamic_offset=0&web_location=1430654`;\r\n    params = utils.addWbiVerifyInfo(params, wbiVerifyString);\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `https://api.bilibili.com/x/web-interface/wbi/search/type?${params}`,\r\n        headers: {\r\n            Referer: `https://search.bilibili.com/live?keyword=${urlEncodedKey}&from_source=webtop_search&spm_id_from=444.7&search_source=3&search_type=live_room`,\r\n            Cookie: await cache.getCookie(),\r\n        },\r\n    });\r\n    const data = response.data.data.result.live_room;\r\n\r\n    return {\r\n        title: `哔哩哔哩直播-${key}-${orderTitle}`,\r\n        link: `https://search.bilibili.com/live?keyword=${urlEncodedKey}&order=${order}&coverType=user_cover&page=1&search_type=live`,\r\n        description: `哔哩哔哩直播-${key}-${orderTitle}`,\r\n        item:\r\n            data &&\r\n            data.map((item) => ({\r\n                title: `${item.uname} ${item.title} (${item.cate_name}-${item.live_time})`,\r\n                description: `${item.uname} ${item.title} (${item.cate_name}-${item.live_time})`,\r\n                pubDate: new Date(item.live_time.replace(' ', 'T') + '+08:00').toUTCString(),\r\n                guid: `https://live.bilibili.com/${item.roomid} ${item.live_time}`,\r\n                link: `https://live.bilibili.com/${item.roomid}`,\r\n            })),\r\n    };\r\n}\r\n"],"mappings":"udAKA,MAAaA,EAAe,CACxB,KAAM,2BACN,WAAY,CAAC,QACb,QAAS,oCACT,WAAY,CAAE,IAAK,QAAS,MAAO,mCACnC,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,cACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,EAAI,IAAI,MAAM,OACpB,EAAQ,EAAI,IAAI,MAAM,SAEtB,EAAgB,mBAAmB,GACrC,EAAa,GAEjB,OAAQ,EAAR,CACI,IAAK,YACD,EAAa,OACb,MACJ,IAAK,SACD,EAAa,OACb,MAER,IAAM,EAAkB,MAAMC,EAAM,qBAChC,EAAS,+DAA+D,EAAM,6FAA6F,EAAc,6GAC7L,EAASC,EAAM,iBAAiB,EAAQ,GAExC,IAAM,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,4DAA4D,IACjE,QAAS,CACL,QAAS,4CAA4C,EAAc,oFACnE,OAAQ,MAAMF,EAAM,eAGtB,EAAO,EAAS,KAAK,KAAK,OAAO,UAEvC,MAAO,CACH,MAAO,UAAU,EAAI,GAAG,IACxB,KAAM,4CAA4C,EAAc,SAAS,EAAM,+CAC/E,YAAa,UAAU,EAAI,GAAG,IAC9B,KACI,GACA,EAAK,IAAK,IAAU,CAChB,MAAO,GAAG,EAAK,MAAM,GAAG,EAAK,MAAM,IAAI,EAAK,UAAU,GAAG,EAAK,UAAU,GACxE,YAAa,GAAG,EAAK,MAAM,GAAG,EAAK,MAAM,IAAI,EAAK,UAAU,GAAG,EAAK,UAAU,GAC9E,QAAS,IAAI,KAAK,EAAK,UAAU,QAAQ,IAAK,KAAO,UAAU,cAC/D,KAAM,6BAA6B,EAAK,OAAO,GAAG,EAAK,YACvD,KAAM,6BAA6B,EAAK"}