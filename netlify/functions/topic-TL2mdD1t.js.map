{"version":3,"file":"topic-TL2mdD1t.js","names":["route: Route","got"],"sources":["../../lib/routes/douban/channel/topic.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/channel/:id/:nav?',\r\n    categories: ['social-media'],\r\n    example: '/douban/channel/30168934/hot',\r\n    parameters: { id: '频道id', nav: '专题分类，可选，默认为 default' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '频道专题',\r\n    maintainers: ['umm233'],\r\n    handler,\r\n    description: `| 默认    | 热门 | 最新 |\r\n| ------- | ---- | ---- |\r\n| default | hot  | new  |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const nav = ctx.req.param('nav') || 'default';\r\n    const link = `https://www.douban.com/channel/${id}`;\r\n\r\n    const channel_info_response = await got({\r\n        method: 'get',\r\n        url: `https://m.douban.com/rexxar/api/v2/elessar/channel/${id}`,\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `https://m.douban.com/rexxar/api/v2/lembas/channel/${id}/feed?ck=null&for_mobile=1&start=0&count=20&nav=${nav}`,\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n\r\n    const channel_name = channel_info_response.data.title;\r\n    const data = response.data.items;\r\n    let nav_name = '';\r\n\r\n    switch (nav) {\r\n        case 'hot':\r\n            nav_name = '热门';\r\n            break;\r\n        case 'new':\r\n            nav_name = '最新';\r\n            break;\r\n        default:\r\n            nav_name = '默认';\r\n            break;\r\n    }\r\n\r\n    return {\r\n        title: `豆瓣${channel_name}频道-${nav_name}动态`,\r\n        link,\r\n        description: `豆瓣${channel_name}频道专题下的${nav_name}动态`,\r\n\r\n        item: data\r\n            .map((item) => {\r\n                if (item.external_payload.items === undefined) {\r\n                    const description = `作者：${item.author.name} | ${item.create_time} <br><br> ${item.abstract}\">`;\r\n\r\n                    return {\r\n                        title: item.title,\r\n                        description,\r\n                        pubDate: new Date(item.create_time),\r\n                        link: item.url,\r\n                    };\r\n                } else {\r\n                    return null;\r\n                }\r\n            })\r\n            .filter(Boolean),\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"gOAGA,MAAaA,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,gBACb,QAAS,+BACT,WAAY,CAAE,GAAI,OAAQ,IAAK,uBAC/B,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,UACd,UACA,YAAa;;4BAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAM,EAAI,IAAI,MAAM,QAAU,UAC9B,EAAO,kCAAkC,IAEzC,EAAwB,MAAMC,EAAI,CACpC,OAAQ,MACR,IAAK,sDAAsD,IAC3D,QAAS,CACL,QAAS,KAIX,EAAW,MAAMA,EAAI,CACvB,OAAQ,MACR,IAAK,qDAAqD,EAAG,kDAAkD,IAC/G,QAAS,CACL,QAAS,KAIX,EAAe,EAAsB,KAAK,MAC1C,EAAO,EAAS,KAAK,MACvB,EAAW,GAEf,OAAQ,EAAR,CACI,IAAK,MACD,EAAW,KACX,MACJ,IAAK,MACD,EAAW,KACX,MACJ,QACI,EAAW,KACX,MAGR,MAAO,CACH,MAAO,KAAK,EAAa,KAAK,EAAS,IACvC,OACA,YAAa,KAAK,EAAa,QAAQ,EAAS,IAEhD,KAAM,EACD,IAAK,GAAS,CACX,GAAI,EAAK,iBAAiB,QAAU,IAAA,GAAW,CAC3C,IAAM,EAAc,MAAM,EAAK,OAAO,KAAK,KAAK,EAAK,YAAY,YAAY,EAAK,SAAS,IAE3F,MAAO,CACH,MAAO,EAAK,MACZ,cACA,QAAS,IAAI,KAAK,EAAK,aACvB,KAAM,EAAK,UAGf,OAAO,OAGd,OAAO,SACZ,WAAY"}