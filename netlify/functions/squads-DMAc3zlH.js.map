{"version":3,"file":"squads-DMAc3zlH.js","names":["route: Route"],"sources":["../../lib/routes/daily/squads.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport { baseUrl, getData, getList, variables } from './utils.js';\r\n\r\nconst sourceQuery = `\r\nquery Source($handle: ID!) {\r\n    source(id: $handle) {\r\n      ...SquadBaseInfo\r\n      moderationPostCount\r\n    }\r\n  }\r\n  fragment SquadBaseInfo on Source {\r\n    ...SourceBaseInfo\r\n    referralUrl\r\n    createdAt\r\n    flags {\r\n      featured\r\n      totalPosts\r\n      totalViews\r\n      totalUpvotes\r\n    }\r\n    category {\r\n      id\r\n      title\r\n      slug\r\n    }\r\n    ...PrivilegedMembers\r\n  }\r\n  fragment SourceBaseInfo on Source {\r\n    id\r\n    active\r\n    handle\r\n    name\r\n    permalink\r\n    public\r\n    type\r\n    description\r\n    image\r\n    membersCount\r\n    currentMember {\r\n      ...CurrentMember\r\n    }\r\n    memberPostingRole\r\n    memberInviteRole\r\n    moderationRequired\r\n  }\r\n  fragment CurrentMember on SourceMember {\r\n    user {\r\n      id\r\n    }\r\n    permissions\r\n    role\r\n    referralToken\r\n    flags {\r\n      hideFeedPosts\r\n      collapsePinnedPosts\r\n    }\r\n  }\r\n  fragment PrivilegedMembers on Source {\r\n    privilegedMembers {\r\n      user {\r\n        id\r\n        name\r\n        image\r\n        permalink\r\n        username\r\n        bio\r\n        reputation\r\n        companies {\r\n          name\r\n          image\r\n        }\r\n        contentPreference {\r\n          status\r\n        }\r\n      }\r\n      role\r\n    }\r\n  }\r\n\r\n`;\r\n\r\nconst query = `\r\n  query SourceFeed(\r\n    $source: ID!\r\n    $loggedIn: Boolean! = false\r\n    $first: Int\r\n    $after: String\r\n    $ranking: Ranking\r\n    $supportedTypes: [String!]\r\n  ) {\r\n    page: sourceFeed(\r\n      source: $source\r\n      first: $first\r\n      after: $after\r\n      ranking: $ranking\r\n      supportedTypes: $supportedTypes\r\n    ) {\r\n      ...FeedPostConnection\r\n    }\r\n  }\r\n  \r\n  fragment FeedPostConnection on PostConnection {\r\n    pageInfo {\r\n      hasNextPage\r\n      endCursor\r\n    }\r\n    edges {\r\n      node {\r\n        ...FeedPost\r\n        pinnedAt contentHtml\r\n        ...UserPost @include(if: $loggedIn)\r\n      }\r\n    }\r\n  }\r\n  \r\n  fragment FeedPost on Post {\r\n    ...FeedPostInfo\r\n    sharedPost {\r\n      id\r\n      title\r\n      image\r\n      readTime\r\n      permalink\r\n      commentsPermalink\r\n      createdAt\r\n      type\r\n      tags\r\n      source {\r\n        id\r\n        handle\r\n        permalink\r\n        image\r\n      }\r\n      slug\r\n      clickbaitTitleDetected\r\n    }\r\n    trending\r\n    feedMeta\r\n    collectionSources {\r\n      handle\r\n      image\r\n    }\r\n    numCollectionSources\r\n    updatedAt\r\n    slug\r\n  }\r\n  \r\n  fragment FeedPostInfo on Post {\r\n    id\r\n    title\r\n    image\r\n    readTime\r\n    permalink\r\n    commentsPermalink\r\n    createdAt\r\n    commented\r\n    bookmarked\r\n    views\r\n    numUpvotes\r\n    numComments\r\n    summary\r\n    bookmark {\r\n      remindAt\r\n    }\r\n    author {\r\n      id\r\n      name\r\n      image\r\n      username\r\n      permalink\r\n    }\r\n    type\r\n    tags\r\n    source {\r\n      id\r\n      handle\r\n      name\r\n      permalink\r\n      image\r\n      type\r\n    }\r\n    userState {\r\n      vote\r\n      flags {\r\n        feedbackDismiss\r\n      }\r\n    }\r\n    slug\r\n    clickbaitTitleDetected\r\n  }\r\n\r\n\r\n  \r\n  fragment UserPost on Post {\r\n    read\r\n    upvoted\r\n    commented\r\n    bookmarked\r\n    downvoted\r\n  }\r\n`;\r\n\r\nexport const route: Route = {\r\n    path: '/squads/:squads/:innerSharedContent?',\r\n    example: '/daily/squads/watercooler',\r\n    view: ViewType.Articles,\r\n    parameters: {\r\n        innerSharedContent: {\r\n            description: 'Where to Fetch inner Shared Posts instead of original',\r\n            default: 'false',\r\n            options: [\r\n                { value: 'false', label: 'False' },\r\n                { value: 'true', label: 'True' },\r\n            ],\r\n        },\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['app.daily.dev/squads/:squads'],\r\n        },\r\n    ],\r\n    name: 'Squads',\r\n    maintainers: ['Rjnishant530'],\r\n    handler,\r\n    url: 'app.daily.dev/squads/discover',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n    const innerSharedContent = ctx.req.param('innerSharedContent') ? JSON.parse(ctx.req.param('innerSharedContent')) : false;\r\n    const squads = ctx.req.param('squads');\r\n\r\n    const link = `${baseUrl}/squads/${squads}`;\r\n\r\n    const { id, description, name } = await getData(\r\n        {\r\n            query: sourceQuery,\r\n            variables: {\r\n                handle: squads,\r\n            },\r\n        },\r\n        true\r\n    );\r\n\r\n    const data = await getData({\r\n        query,\r\n        variables: {\r\n            ...variables,\r\n            source: id,\r\n            ranking: 'TIME',\r\n            supportedTypes: ['article', 'share', 'freeform', 'video:youtube', 'collection', 'welcome'],\r\n            first: limit,\r\n        },\r\n    });\r\n    const items = getList(data, innerSharedContent, true);\r\n\r\n    return {\r\n        title: `${name} - daily.dev`,\r\n        link,\r\n        item: items,\r\n        description,\r\n        logo: `${baseUrl}/favicon-32x32.png`,\r\n        icon: `${baseUrl}/favicon-32x32.png`,\r\n        language: 'en-us',\r\n    };\r\n}\r\n"],"mappings":"kXAGA,MAuMaA,EAAe,CACxB,KAAM,uCACN,QAAS,4BACT,KAAM,EAAS,SACf,WAAY,CACR,mBAAoB,CAChB,YAAa,wDACb,QAAS,QACT,QAAS,CACL,CAAE,MAAO,QAAS,MAAO,SACzB,CAAE,MAAO,OAAQ,MAAO,WAIpC,MAAO,CACH,CACI,OAAQ,CAAC,kCAGjB,KAAM,SACN,YAAa,CAAC,gBACd,UACA,IAAK,iCAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAC/E,EAAqB,EAAI,IAAI,MAAM,sBAAwB,KAAK,MAAM,EAAI,IAAI,MAAM,uBAAyB,GAC7G,EAAS,EAAI,IAAI,MAAM,UAEvB,EAAO,GAAG,EAAQ,UAAU,IAE5B,CAAE,KAAI,cAAa,QAAS,MAAM,EACpC,CACI,MAAO;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EACP,UAAW,CACP,OAAQ,IAGhB,IAGE,EAAO,MAAM,EAAQ,CACvB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EACA,UAAW,CACP,GAAG,EACH,OAAQ,EACR,QAAS,OACT,eAAgB,CAAC,UAAW,QAAS,WAAY,gBAAiB,aAAc,WAChF,MAAO,KAGT,EAAQ,EAAQ,EAAM,EAAoB,IAEhD,MAAO,CACH,MAAO,GAAG,EAAK,cACf,OACA,KAAM,EACN,cACA,KAAM,GAAG,EAAQ,oBACjB,KAAM,GAAG,EAAQ,oBACjB,SAAU"}