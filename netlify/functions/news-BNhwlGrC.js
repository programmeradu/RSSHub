import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import"./timezone-BrNu6iXe.js";import{domain as o,getMeta as s,processItems as c,processMeta as l}from"./util-BjzbIVC4.js";import u from"node:path";import{load as d}from"cheerio";t();const f={path:`/news/:category{.+}?`,categories:[`university`],example:`/whu/news`,parameters:{category:`新闻栏目，可选`},name:`新闻网`,maintainers:[],handler:m,description:"\ncategory 参数可选，范围如下:\n\n| 新闻栏目 | 武大资讯 | 学术动态 | 珞珈影像 | 武大视频 |\n| -------- | -------- | -------- | -------- | -------- |\n| 参数     |  0 或 `wdzx/wdyw`  | 1 或 `kydt` | 2 或 `stkj/ljyx` | 3 或 `stkj/wdsp` |\n\n此外 route 后可以加上 `?limit=n` 的查询参数，表示只获取前 n 条新闻；如果不指定默认为 10。\n"},p=e=>{let t=[`wdzx/wdyw`,`kydt`,`stkj/ljyx`,`stkj/wdsp`];return[`0`,`1`,`2`,`3`].includes(e)?t[e]:t.includes(e)?e:`wdzx/wdyw`};async function m(t){let{category:f}=t.req.param(),m=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):10;f=p(f);let h=`https://news.${o}`,g=new URL(`${f}.htm`,h).href,{data:_}=await a(g),v=d(_),y=v(`ul.wdzxList li a[title], ul.xsdtList li a, div.topPic a[title], ul.nypicList li a[title], div.topVid a[title], ul.nyvidList li a[title]`).slice(0,m).toArray().map(t=>{t=v(t);let n=t.find(`div.img img`);return{title:t.prop(`title`)??t.find(`h4.eclips`).text(),link:new URL(t.prop(`href`),h).href,pubDate:i(t.find(`time`).text(),[`YYYY.MM.DD`,`DDYYYY.MM`]),description:r(u.join(e,`templates/description-47111791.art`),{description:t.find(`div.txt p`).html(),image:n.prop(`src`)?{src:new URL(n.prop(`src`),h).href,alt:n.prop(`alt`)}:void 0})}});y=await c(y,n.tryGet,h);let b=l(_),x=s(b,`SiteName`),S=s(b,`ColumnName`),C=new URL(v(`link[rel="shortcut icon"]`).prop(`href`),h).href;return{item:y,title:`${x} - ${S}`,link:g,description:s(b,`description`),language:v(`html`).prop(`lang`),image:new URL(v(`div.logo img`).prop(`src`),h).href,icon:C,logo:C,subtitle:S,author:x,allowEmpty:!0}}export{f as route};
//# sourceMappingURL=news-BNhwlGrC.js.map