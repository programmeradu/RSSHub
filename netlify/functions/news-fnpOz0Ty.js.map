{"version":3,"file":"news-fnpOz0Ty.js","names":["route: Route","ofetch","InvalidParameterError"],"sources":["../../lib/routes/m-78/news.ts"],"sourcesContent":["import { type Data, type Route, ViewType } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport type { Context } from 'hono';\r\nimport type { Post } from './types';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    name: 'ニュース',\r\n    categories: ['anime'],\r\n    path: '/news/:category?',\r\n    example: '/m-78/news',\r\n    radar: [\r\n        {\r\n            source: ['m-78.jp/news'],\r\n            target: '/news',\r\n        },\r\n        {\r\n            source: ['m-78.jp/news/category/:category'],\r\n            target: '/news/:category',\r\n        },\r\n    ],\r\n    parameters: {\r\n        category: {\r\n            description: 'news category',\r\n            default: 'news',\r\n            options: [\r\n                {\r\n                    value: 'news',\r\n                    label: 'ニュース',\r\n                },\r\n                {\r\n                    value: 'streaming',\r\n                    label: '動画配信',\r\n                },\r\n                {\r\n                    value: 'event',\r\n                    label: 'イベント',\r\n                },\r\n                {\r\n                    value: 'onair',\r\n                    label: '放送',\r\n                },\r\n                {\r\n                    value: 'broadcast',\r\n                    label: '放送/配信',\r\n                },\r\n                {\r\n                    value: 'goods',\r\n                    label: 'グッズ',\r\n                },\r\n                {\r\n                    value: 'ultraman-cardgame',\r\n                    label: 'ウルトラマン カードゲーム',\r\n                },\r\n                {\r\n                    value: 'shop',\r\n                    label: 'ショップ',\r\n                },\r\n                {\r\n                    value: 'blu-ray_dvd',\r\n                    label: 'Blu-ray・DVD',\r\n                },\r\n                {\r\n                    value: 'digital',\r\n                    label: 'デジタル',\r\n                },\r\n            ],\r\n        },\r\n    },\r\n    handler,\r\n    maintainers: ['KarasuShin'],\r\n    features: {\r\n        supportRadar: true,\r\n    },\r\n    view: ViewType.Articles,\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const rootUrl = 'https://m-78.jp';\r\n    const cateAPIUrl = `${rootUrl}/wp-json/wp/v2/categories`;\r\n    const postsAPIUrl = `${rootUrl}/wp-json/wp/v2/posts`;\r\n    const category = ctx.req.param('category') ?? 'news';\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')!, 10) : 20;\r\n\r\n    const categories = await ofetch(`${cateAPIUrl}?slug=${category}`);\r\n    if (categories.length === 0) {\r\n        throw new InvalidParameterError('Category not found');\r\n    }\r\n\r\n    const { id: categoryId, link: categoryLink, name: categoryName } = categories[0];\r\n\r\n    const posts = await ofetch<Post[]>(`${postsAPIUrl}?categories=${categoryId}&per_page=${limit}`);\r\n    return {\r\n        title: `${categoryName} | ニュース`,\r\n        link: categoryLink,\r\n        item: posts.map((post) => {\r\n            const $ = load(post.content.rendered, null, false);\r\n            $('#ez-toc-container').remove();\r\n            $('img').each((_, img) => {\r\n                if (/wp-content\\/uploads/.test(img.attribs.src)) {\r\n                    img.attribs.src = img.attribs.src.replace(/(-\\d+x\\d+)/, '');\r\n                }\r\n            });\r\n            return {\r\n                title: post.title.rendered,\r\n                link: post.link,\r\n                description: $.html(),\r\n                pubDate: parseDate(post.date_gmt),\r\n                updated: parseDate(post.modified_gmt),\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"0XAQA,MAAaA,EAAe,CACxB,KAAM,OACN,WAAY,CAAC,SACb,KAAM,mBACN,QAAS,aACT,MAAO,CACH,CACI,OAAQ,CAAC,gBACT,OAAQ,SAEZ,CACI,OAAQ,CAAC,mCACT,OAAQ,oBAGhB,WAAY,CACR,SAAU,CACN,YAAa,gBACb,QAAS,OACT,QAAS,CACL,CACI,MAAO,OACP,MAAO,QAEX,CACI,MAAO,YACP,MAAO,QAEX,CACI,MAAO,QACP,MAAO,QAEX,CACI,MAAO,QACP,MAAO,MAEX,CACI,MAAO,YACP,MAAO,SAEX,CACI,MAAO,QACP,MAAO,OAEX,CACI,MAAO,oBACP,MAAO,iBAEX,CACI,MAAO,OACP,MAAO,QAEX,CACI,MAAO,cACP,MAAO,eAEX,CACI,MAAO,UACP,MAAO,WAKvB,UACA,YAAa,CAAC,cACd,SAAU,CACN,aAAc,IAElB,KAAM,EAAS,UAGnB,eAAe,EAAQ,EAA6B,CAChD,IAAM,EAAU,kBACV,EAAa,GAAG,EAAQ,2BACxB,EAAc,GAAG,EAAQ,sBACzB,EAAW,EAAI,IAAI,MAAM,aAAe,OACxC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAW,IAAM,GAEhF,EAAa,MAAMC,EAAO,GAAG,EAAW,QAAQ,KACtD,GAAI,EAAW,SAAW,EACtB,MAAM,IAAIC,EAAsB,sBAGpC,GAAM,CAAE,GAAI,EAAY,KAAM,EAAc,KAAM,GAAiB,EAAW,GAExE,EAAQ,MAAMD,EAAe,GAAG,EAAY,cAAc,EAAW,YAAY,KACvF,MAAO,CACH,MAAO,GAAG,EAAa,SACvB,KAAM,EACN,KAAM,EAAM,IAAK,GAAS,CACtB,IAAM,EAAI,EAAK,EAAK,QAAQ,SAAU,KAAM,IAO5C,OANA,EAAE,qBAAqB,SACvB,EAAE,OAAO,MAAM,EAAG,IAAQ,CAClB,sBAAsB,KAAK,EAAI,QAAQ,OACvC,EAAI,QAAQ,IAAM,EAAI,QAAQ,IAAI,QAAQ,aAAc,OAGzD,CACH,MAAO,EAAK,MAAM,SAClB,KAAM,EAAK,KACX,YAAa,EAAE,OACf,QAAS,EAAU,EAAK,UACxB,QAAS,EAAU,EAAK"}