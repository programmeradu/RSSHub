{"version":3,"file":"common-C1jtplR_.js","names":["got","newsContent","categoryTitle","indexPage","got","title","cache","newsContent"],"sources":["../../lib/routes/hunau/utils/category-title.ts","../../lib/routes/hunau/utils/news-content.ts","../../lib/routes/hunau/utils/index-page.ts","../../lib/routes/hunau/utils/common.ts"],"sourcesContent":["const categoryTitle = (type) => {\r\n    let title;\r\n    type = type.slice(0, 4).toLowerCase();\r\n\r\n    switch (type) {\r\n        case 'tzgg':\r\n            title = '通知公告';\r\n            break;\r\n        case 'ggtz':\r\n            title = '公告通知';\r\n            break;\r\n        case 'jwdt':\r\n            title = '教务动态';\r\n            break;\r\n        case 'xyxw':\r\n            title = '学院新闻';\r\n            break;\r\n        case 'jzxx':\r\n            title = '讲座信息';\r\n            break;\r\n        case 'xzzq':\r\n            title = '下载专区';\r\n            break;\r\n        default:\r\n            title = '';\r\n    }\r\n\r\n    return title;\r\n};\r\n\r\nexport default categoryTitle;\r\n","import got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { load } from 'cheerio';\r\n\r\nasync function newsContent(link, department = '') {\r\n    try {\r\n        // 异步请求文章\r\n        const { data: response } = await got(link, {\r\n            https: {\r\n                rejectUnauthorized: false,\r\n            },\r\n        });\r\n        // 加载文章内容\r\n        const $ = load(response);\r\n        let reg = /\\d{4}(?:\\/\\d{2}){2}/;\r\n        let element = '.newscontent';\r\n\r\n        // 处理特定部门\r\n        if (department === 'xky') {\r\n            reg = /\\d{4}-\\d{2}-\\d{2}/;\r\n            element = '.content .edit';\r\n        }\r\n\r\n        // 解析日期\r\n        const extractDate = ($('.info').first().html()?.match(reg) || [])[0];\r\n        const pubDate = timezone(parseDate(extractDate, 'YYYY-MM-DD', 'zh-cn'), +8);\r\n        // 解析文章\r\n        const newsContent = $(element).first();\r\n        newsContent.find('table').remove();\r\n        let description = newsContent.text().replaceAll(/\\s+/g, '');\r\n\r\n        // 处理特定部门\r\n        if (department === 'gfxy') {\r\n            description = description.replace('点击下载文件:', '');\r\n        }\r\n\r\n        // 返回解析的结果\r\n        return { description, pubDate };\r\n    } catch {\r\n        // Handle the error (e.g., log it and return some default values)\r\n        // console.error(`There was an error fetching the link ${link}: ${error.message}`);\r\n        return { description: '', pubDate: null };\r\n    }\r\n}\r\n\r\nexport default newsContent;\r\n","const indexPage = (page) => {\r\n    const fileName = 'index';\r\n    const fileType = 'html';\r\n\r\n    const filePage = page === '1' ? '' : `_${Number.parseInt(page) - 1}`;\r\n\r\n    return `${fileName}${filePage}.${fileType}`;\r\n};\r\n\r\nexport default indexPage;\r\n","import cache from '@/utils/cache';\r\n// common.js\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport categoryTitle from './category-title';\r\nimport newsContent from './news-content';\r\nimport indexPage from './index-page';\r\n\r\nasync function getContent(ctx, { baseHost, baseCategory, baseType, baseTitle, baseDescription = '', baseDeparment = '', baseClass = 'div.article_list ul li:has(a)' }) {\r\n    const { category = baseCategory, type = baseType, page = '1' } = ctx.req.param();\r\n\r\n    const title = `${baseTitle} - ${categoryTitle(category)}`;\r\n    const description = baseDescription ? `${baseDescription} - ${categoryTitle(category)}` : title;\r\n\r\n    const typeURL = type ? `/${type}` : '';\r\n    const baseURl = `${baseHost}${typeURL}/${category}`;\r\n    const url = `${baseURl}/${indexPage(page)}`;\r\n\r\n    const { data: response } = await got(url);\r\n    const $ = load(response);\r\n\r\n    const list = $(baseClass)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('a');\r\n            const href = a.attr('href');\r\n            const title = a.text();\r\n            const link = href.startsWith('./') && !href.endsWith('.pdf') ? `${baseURl}${href.replace('./', '/')}` : href;\r\n\r\n            return {\r\n                title,\r\n                link,\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const content = await newsContent(item.link, baseDeparment);\r\n\r\n                item.pubDate = content.pubDate;\r\n                item.description = content.description;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        // 源标题\r\n        title,\r\n        description,\r\n        // 源链接\r\n        link: url,\r\n        // 源文章\r\n        item: items,\r\n    };\r\n}\r\n\r\nexport default getContent;\r\n"],"mappings":"0OAAA,MAAM,EAAiB,GAAS,CAC5B,IAAI,EAGJ,OAFA,EAAO,EAAK,MAAM,EAAG,GAAG,cAEhB,EAAR,CACI,IAAK,OACD,EAAQ,OACR,MACJ,IAAK,OACD,EAAQ,OACR,MACJ,IAAK,OACD,EAAQ,OACR,MACJ,IAAK,OACD,EAAQ,OACR,MACJ,IAAK,OACD,EAAQ,OACR,MACJ,IAAK,OACD,EAAQ,OACR,MACJ,QACI,EAAQ,GAGhB,OAAO,GAGX,IAAA,EAAe,ECzBf,eAAe,EAAY,EAAM,EAAa,GAAI,CAC9C,GAAI,CAEA,GAAM,CAAE,KAAM,GAAa,MAAMI,EAAI,EAAM,CACvC,MAAO,CACH,mBAAoB,MAItB,EAAI,EAAK,GACX,EAAM,sBACN,EAAU,eAGV,IAAe,QACf,EAAM,oBACN,EAAU,kBAId,IAAM,GAAe,EAAE,SAAS,QAAQ,QAAQ,MAAM,IAAQ,IAAI,GAC5D,EAAU,EAAS,EAAU,EAAa,aAAc,SAAU,GAElEG,EAAc,EAAE,GAAS,QAC/B,EAAY,KAAK,SAAS,SAC1B,IAAI,EAAcA,EAAY,OAAO,WAAW,OAAQ,IAQxD,OALI,IAAe,SACf,EAAc,EAAY,QAAQ,UAAW,KAI1C,CAAE,cAAa,gBAClB,CAGJ,MAAO,CAAE,YAAa,GAAI,QAAS,OAI3C,IAAA,EAAe,EC9Cf,MAAM,EAAa,GAAS,CACxB,IAGM,EAAW,IAAS,IAAM,GAAK,IAAI,OAAO,SAAS,GAAQ,IAEjE,MAAO,QAAc,EAAS,QAGlC,IAAA,EAAe,ECDf,eAAe,EAAW,EAAK,CAAE,WAAU,eAAc,WAAU,YAAW,kBAAkB,GAAI,gBAAgB,GAAI,YAAY,iCAAmC,CACnK,GAAM,CAAE,WAAW,EAAc,OAAO,EAAU,OAAO,KAAQ,EAAI,IAAI,QAEnE,EAAQ,GAAG,EAAU,KAAKL,EAAc,KACxC,EAAc,EAAkB,GAAG,EAAgB,KAAKA,EAAc,KAAc,EAEpF,EAAU,EAAO,IAAI,IAAS,GAC9B,EAAU,GAAG,IAAW,EAAQ,GAAG,IACnC,EAAM,GAAG,EAAQ,GAAGC,EAAU,KAE9B,CAAE,KAAM,GAAa,MAAMC,EAAI,GAC/B,EAAI,EAAK,GAET,EAAO,EAAE,GACV,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAI,EAAK,KAAK,KACd,EAAO,EAAE,KAAK,QACdC,EAAQ,EAAE,OACV,EAAO,EAAK,WAAW,OAAS,CAAC,EAAK,SAAS,QAAU,GAAG,IAAU,EAAK,QAAQ,KAAM,OAAS,EAExG,MAAO,CACH,MAAA,EACA,UAIN,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAU,MAAMC,EAAY,EAAK,KAAM,GAK7C,MAHA,GAAK,QAAU,EAAQ,QACvB,EAAK,YAAc,EAAQ,YAEpB,MAKnB,MAAO,CAEH,QACA,cAEA,KAAM,EAEN,KAAM,GAId,IAAA,EAAe"}