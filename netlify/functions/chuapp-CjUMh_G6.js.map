{"version":3,"file":"chuapp-CjUMh_G6.js","names":["route: Route","pathLut: Record<string, { title: string; suffix: string }>","ofetch","articles: RawArticle[]","processedItems: Promise<DataItem>[]","cache","item: DataItem"],"sources":["../../lib/routes/chuapp/chuapp.ts"],"sourcesContent":["import { Context } from 'hono';\r\nimport { load } from 'cheerio';\r\nimport { Data, Route, DataItem } from '@/types';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    categories: ['game'],\r\n    example: '/chuapp/daily',\r\n    parameters: {\r\n        category: '栏目分类，见下表',\r\n    },\r\n    description: `\r\n  | \\`category\\` | 栏目分类 |\r\n  | ------------ | ------- |\r\n  | \\`daily\\`    | 每日聚焦 |\r\n  | \\`pcz\\`      | 最好玩   |\r\n  | \\`night\\`    | 触乐夜话 |\r\n  | \\`news\\`     | 动态资讯 |\r\n    `,\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '分类',\r\n    maintainers: ['dousha'],\r\n    radar: [\r\n        {\r\n            source: ['chuapp.com/category/:category'],\r\n            target: '/:category',\r\n        },\r\n        {\r\n            source: ['chuapp.com/tag/index/id/20369.html'],\r\n            target: '/night',\r\n        },\r\n    ],\r\n    handler,\r\n};\r\n\r\nconst baseUrl = 'https://www.chuapp.com';\r\nconst pathLut: Record<string, { title: string; suffix: string }> = {\r\n    daily: {\r\n        title: '每日聚焦',\r\n        suffix: '/category/daily',\r\n    },\r\n    pcz: {\r\n        title: '最好玩',\r\n        suffix: '/category/pcz',\r\n    },\r\n    night: {\r\n        title: '触乐夜话',\r\n        suffix: '/tag/index/id/20369.html',\r\n    },\r\n    news: {\r\n        // route from the old implementation\r\n        title: '动态资讯',\r\n        suffix: '/category/zsyx',\r\n    },\r\n    zsyx: {\r\n        // route for radar\r\n        title: '动态资讯',\r\n        suffix: '/category/zsyx',\r\n    },\r\n};\r\n\r\ntype InvalidArticle = {\r\n    title?: string;\r\n    link?: string;\r\n};\r\n\r\ntype ValidArticle = {\r\n    title: string;\r\n    link: string;\r\n};\r\n\r\ntype RawArticle = InvalidArticle | ValidArticle;\r\n\r\nfunction isValidArticle(article: RawArticle): article is ValidArticle {\r\n    return 'title' in article && 'link' in article && article.title !== null && article.link !== null;\r\n}\r\n\r\nfunction toJavaScriptTimestamp(x: string | number | null | undefined): number {\r\n    return x ? Number(x) * 1000 : 0;\r\n}\r\n\r\nasync function handler(ctx: Context): Promise<Data | null> {\r\n    const { category = 'night' } = ctx.req.param();\r\n    const subpath = pathLut[category];\r\n    if (!subpath) {\r\n        return null;\r\n    }\r\n\r\n    const targetUrl = `${baseUrl}${subpath.suffix}`;\r\n    const response = await ofetch(targetUrl);\r\n    const $ = load(response);\r\n\r\n    const articles: RawArticle[] = $('a.fn-clear')\r\n        .toArray()\r\n        .map((element) => ({\r\n            title: $(element).attr('title'),\r\n            link: $(element).attr('href'),\r\n        }));\r\n\r\n    const processedItems: Promise<DataItem>[] = articles\r\n        .filter((article: RawArticle): article is ValidArticle => isValidArticle(article))\r\n        .map((article: ValidArticle) => {\r\n            if (article.link.startsWith('/')) {\r\n                return article;\r\n            }\r\n\r\n            return {\r\n                title: article.title,\r\n                link: `/${article.link}`,\r\n            };\r\n        })\r\n        .map((article: ValidArticle) => {\r\n            const fullArticleUrl = `${baseUrl}${article.link}`;\r\n            return cache.tryGet(fullArticleUrl, async () => {\r\n                const res = await ofetch(fullArticleUrl);\r\n                const s = load(res);\r\n\r\n                const item: DataItem = {\r\n                    title: article.title,\r\n                    link: article.link,\r\n                    description: s('.content .the-content').html() || '',\r\n                    pubDate: parseDate(toJavaScriptTimestamp(s('.friendly_time').attr('data-time'))),\r\n                    author: s('.author-time .fn-left').text() || '',\r\n                };\r\n\r\n                return item;\r\n            }) as Promise<DataItem>;\r\n        });\r\n\r\n    const items = await Promise.all(processedItems);\r\n\r\n    return {\r\n        title: `触乐 - ${subpath.title}`,\r\n        link: targetUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mTAOA,MAAaA,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,QACb,QAAS,gBACT,WAAY,CACR,SAAU,YAEd,YAAa,qKAQb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,UACd,MAAO,CACH,CACI,OAAQ,CAAC,iCACT,OAAQ,cAEZ,CACI,OAAQ,CAAC,sCACT,OAAQ,WAGhB,WAGE,EAAU,yBACVC,EAA6D,CAC/D,MAAO,CACH,MAAO,OACP,OAAQ,mBAEZ,IAAK,CACD,MAAO,MACP,OAAQ,iBAEZ,MAAO,CACH,MAAO,OACP,OAAQ,4BAEZ,KAAM,CAEF,MAAO,OACP,OAAQ,kBAEZ,KAAM,CAEF,MAAO,OACP,OAAQ,mBAgBhB,SAAS,EAAe,EAA8C,CAClE,MAAO,UAAW,GAAW,SAAU,GAAW,EAAQ,QAAU,MAAQ,EAAQ,OAAS,KAGjG,SAAS,EAAsB,EAA+C,CAC1E,OAAO,EAAI,OAAO,GAAK,IAAO,EAGlC,eAAe,EAAQ,EAAoC,CACvD,GAAM,CAAE,WAAW,SAAY,EAAI,IAAI,QACjC,EAAU,EAAQ,GACxB,GAAI,CAAC,EACD,OAAO,KAGX,IAAM,EAAY,GAAG,IAAU,EAAQ,SACjC,EAAW,MAAMC,EAAO,GACxB,EAAI,EAAK,GAETC,EAAyB,EAAE,cAC5B,UACA,IAAK,IAAa,CACf,MAAO,EAAE,GAAS,KAAK,SACvB,KAAM,EAAE,GAAS,KAAK,WAGxBC,EAAsC,EACvC,OAAQ,GAAiD,EAAe,IACxE,IAAK,GACE,EAAQ,KAAK,WAAW,KACjB,EAGJ,CACH,MAAO,EAAQ,MACf,KAAM,IAAI,EAAQ,SAGzB,IAAK,GAA0B,CAC5B,IAAM,EAAiB,GAAG,IAAU,EAAQ,OAC5C,OAAOC,EAAM,OAAO,EAAgB,SAAY,CAC5C,IAAM,EAAM,MAAMH,EAAO,GACnB,EAAI,EAAK,GAETI,EAAiB,CACnB,MAAO,EAAQ,MACf,KAAM,EAAQ,KACd,YAAa,EAAE,yBAAyB,QAAU,GAClD,QAAS,EAAU,EAAsB,EAAE,kBAAkB,KAAK,eAClE,OAAQ,EAAE,yBAAyB,QAAU,IAGjD,OAAO,MAIb,EAAQ,MAAM,QAAQ,IAAI,GAEhC,MAAO,CACH,MAAO,QAAQ,EAAQ,QACvB,KAAM,EACN,KAAM"}