{"version":3,"file":"issue-Bo6i_mH8.js","names":["MarkdownIt","route: Route","got"],"sources":["../../lib/routes/github/issue.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { config } from '@/config';\r\nimport MarkdownIt from 'markdown-it';\r\nconst md = MarkdownIt({\r\n    html: true,\r\n    linkify: true,\r\n});\r\nimport queryString from 'query-string';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/issue/:user/:repo/:state?/:labels?',\r\n    categories: ['programming'],\r\n    view: ViewType.Notifications,\r\n    example: '/github/issue/DIYgod/RSSHub/open',\r\n    parameters: {\r\n        user: 'GitHub username',\r\n        repo: 'GitHub repo name',\r\n        state: {\r\n            description: 'the state of the issues.',\r\n            default: 'open',\r\n            options: [\r\n                {\r\n                    label: 'Open',\r\n                    value: 'open',\r\n                },\r\n                {\r\n                    label: 'Closed',\r\n                    value: 'closed',\r\n                },\r\n                {\r\n                    label: 'All',\r\n                    value: 'all',\r\n                },\r\n            ],\r\n        },\r\n        labels: 'a list of comma separated label names',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['github.com/:user/:repo/issues', 'github.com/:user/:repo/issues/:id', 'github.com/:user/:repo'],\r\n            target: '/issue/:user/:repo',\r\n        },\r\n    ],\r\n    name: 'Repo Issues',\r\n    maintainers: ['HenryQW', 'AndreyMZ'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const user = ctx.req.param('user');\r\n    const repo = ctx.req.param('repo');\r\n    const state = ctx.req.param('state');\r\n    const labels = ctx.req.param('labels');\r\n    const limit = ctx.req.query('limit') ? Math.min(Number.parseInt(ctx.req.query('limit')), 100) : 100;\r\n\r\n    const host = `https://github.com/${user}/${repo}/issues`;\r\n    const url = `https://api.github.com/repos/${user}/${repo}/issues`;\r\n\r\n    const headers = { Accept: 'application/vnd.github.v3+json' };\r\n    if (config.github && config.github.access_token) {\r\n        headers.Authorization = `token ${config.github.access_token}`;\r\n    }\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n        searchParams: queryString.stringify({\r\n            state,\r\n            labels,\r\n            sort: 'created',\r\n            direction: 'desc',\r\n            per_page: limit,\r\n        }),\r\n        headers,\r\n    });\r\n    const data = response.data;\r\n\r\n    return {\r\n        allowEmpty: true,\r\n        title: `${user}/${repo}${state ? ' ' + state.replace(/^\\S/, (s) => s.toUpperCase()) : ''} Issues${labels ? ' - ' + labels : ''}`,\r\n        link: host,\r\n        item: data\r\n            .filter((item) => item.pull_request === undefined)\r\n            .map((item) => ({\r\n                title: item.title,\r\n                description: item.body ? md.render(item.body) : 'No description',\r\n                pubDate: parseDate(item.created_at),\r\n                author: item.user.login,\r\n                link: `${host}/${item.number}`,\r\n            })),\r\n    };\r\n}\r\n"],"mappings":"4YAIA,MAAM,EAAKA,EAAW,CAClB,KAAM,GACN,QAAS,KAKAC,EAAe,CACxB,KAAM,sCACN,WAAY,CAAC,eACb,KAAM,EAAS,cACf,QAAS,mCACT,WAAY,CACR,KAAM,kBACN,KAAM,mBACN,MAAO,CACH,YAAa,2BACb,QAAS,OACT,QAAS,CACL,CACI,MAAO,OACP,MAAO,QAEX,CACI,MAAO,SACP,MAAO,UAEX,CACI,MAAO,MACP,MAAO,SAInB,OAAQ,yCAEZ,MAAO,CACH,CACI,OAAQ,CAAC,gCAAiC,oCAAqC,0BAC/E,OAAQ,uBAGhB,KAAM,cACN,YAAa,CAAC,UAAW,YACzB,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAO,EAAI,IAAI,MAAM,QACrB,EAAQ,EAAI,IAAI,MAAM,SACtB,EAAS,EAAI,IAAI,MAAM,UACvB,EAAQ,EAAI,IAAI,MAAM,SAAW,KAAK,IAAI,OAAO,SAAS,EAAI,IAAI,MAAM,UAAW,KAAO,IAE1F,EAAO,sBAAsB,EAAK,GAAG,EAAK,SAC1C,EAAM,gCAAgC,EAAK,GAAG,EAAK,SAEnD,EAAU,CAAE,OAAQ,kCACtB,EAAO,QAAU,EAAO,OAAO,eAC/B,EAAQ,cAAgB,SAAS,EAAO,OAAO,gBAEnD,IAAM,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,MACA,aAAc,EAAY,UAAU,CAChC,QACA,SACA,KAAM,UACN,UAAW,OACX,SAAU,IAEd,YAEE,EAAO,EAAS,KAEtB,MAAO,CACH,WAAY,GACZ,MAAO,GAAG,EAAK,GAAG,IAAO,EAAQ,IAAM,EAAM,QAAQ,MAAQ,GAAM,EAAE,eAAiB,GAAG,SAAS,EAAS,MAAQ,EAAS,KAC5H,KAAM,EACN,KAAM,EACD,OAAQ,GAAS,EAAK,eAAiB,IAAA,IACvC,IAAK,IAAU,CACZ,MAAO,EAAK,MACZ,YAAa,EAAK,KAAO,EAAG,OAAO,EAAK,MAAQ,iBAChD,QAAS,EAAU,EAAK,YACxB,OAAQ,EAAK,KAAK,MAClB,KAAM,GAAG,EAAK,GAAG,EAAK"}