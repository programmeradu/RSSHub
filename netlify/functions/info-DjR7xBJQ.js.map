{"version":3,"file":"info-DjR7xBJQ.js","names":[],"sources":["../../lib/routes/10000link/info.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\n\r\nimport { art } from '@/utils/render';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate, parseRelativeDate } from '@/utils/parse-date';\r\n\r\nimport { type CheerioAPI, type Cheerio, load } from 'cheerio';\r\nimport type { Element } from 'domhandler';\r\nimport { type Context } from 'hono';\r\nimport path from 'node:path';\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const { category = 'newslists', id } = ctx.req.param();\r\n    const limit: number = Number.parseInt(ctx.req.query('limit') ?? '30', 10);\r\n\r\n    const baseUrl: string = 'https://info.10000link.com';\r\n    const targetUrl: string = new URL(`${category}.aspx${id ? `?chid=${id}` : ''}`, baseUrl).href;\r\n\r\n    const response = await ofetch(targetUrl);\r\n    const $: CheerioAPI = load(response);\r\n    const language = $('html').attr('lang') ?? 'zh';\r\n\r\n    let items: DataItem[] = [];\r\n\r\n    items = $('ul.l_newshot li dl.lhotnew2')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((el): Element => {\r\n            const $el: Cheerio<Element> = $(el);\r\n            const $aEl: Cheerio<Element> = $el.find('dd h1 a');\r\n\r\n            const title: string = $aEl.attr('title') ?? $aEl.text();\r\n            const description: string | undefined = art(path.join(__dirname, 'templates/description.art'), {\r\n                intro: $el.find('dd.title_l').text(),\r\n            });\r\n            const pubDateStr: string | undefined = $el.find('span.ymd_w').text();\r\n            const linkUrl: string | undefined = $aEl.attr('href');\r\n            const categoryEls: Element[] = $el.find('dd.day-lx span a').toArray();\r\n            const categories: string[] = [...new Set(categoryEls.map((el) => $(el).text()).filter(Boolean))];\r\n            const authors: DataItem['author'] = $el.find('dd.day-lx span').first().text();\r\n            const image: string | undefined = $el.find('dt.img220 a img').attr('src');\r\n            const upDatedStr: string | undefined = pubDateStr;\r\n\r\n            const processedItem: DataItem = {\r\n                title,\r\n                description,\r\n                pubDate: pubDateStr ? parseRelativeDate(pubDateStr) : undefined,\r\n                link: linkUrl ? new URL(linkUrl, baseUrl).href : undefined,\r\n                category: categories,\r\n                author: authors,\r\n                content: {\r\n                    html: description,\r\n                    text: description,\r\n                },\r\n                image,\r\n                banner: image,\r\n                updated: upDatedStr ? parseRelativeDate(upDatedStr) : undefined,\r\n                language,\r\n            };\r\n\r\n            return processedItem;\r\n        });\r\n\r\n    items = (\r\n        await Promise.all(\r\n            items.map((item) => {\r\n                if (!item.link) {\r\n                    return item;\r\n                }\r\n\r\n                return cache.tryGet(item.link, async (): Promise<DataItem> => {\r\n                    const detailResponse = await ofetch(item.link);\r\n                    const $$: CheerioAPI = load(detailResponse);\r\n\r\n                    const title: string = $$('div.entity_title h1 a').text();\r\n                    const image: string | undefined = $$('div.entity_thumb img.img-responsive').attr('src');\r\n\r\n                    const description: string | undefined = art(path.join(__dirname, 'templates/description.art'), {\r\n                        images: image\r\n                            ? [\r\n                                  {\r\n                                      src: image,\r\n                                      alt: title,\r\n                                  },\r\n                              ]\r\n                            : undefined,\r\n                        description: $$('div.entity_content').html(),\r\n                    });\r\n                    const pubDateStr: string | undefined = detailResponse.match(/var\\stime\\s=\\s\"(.*?)\";/)?.[1];\r\n                    const categoryEls: Element[] = $$('div.entity_tag span a').toArray();\r\n                    const categories: string[] = [...new Set([...categoryEls.map((el) => $$(el).text()), ...(item.category ?? [])].filter(Boolean))];\r\n                    const upDatedStr: string | undefined = pubDateStr;\r\n\r\n                    const processedItem: DataItem = {\r\n                        title,\r\n                        description,\r\n                        pubDate: pubDateStr ? parseDate(pubDateStr) : item.pubDate,\r\n                        category: categories,\r\n                        content: {\r\n                            html: description,\r\n                            text: description,\r\n                        },\r\n                        image,\r\n                        banner: image,\r\n                        updated: upDatedStr ? parseDate(upDatedStr) : item.updated,\r\n                        language,\r\n                    };\r\n\r\n                    return {\r\n                        ...item,\r\n                        ...processedItem,\r\n                    };\r\n                });\r\n            })\r\n        )\r\n    ).filter((_): _ is DataItem => true);\r\n\r\n    const author: string = '10000万联网';\r\n    const title: string = $('h1').contents().first().text();\r\n\r\n    return {\r\n        title: `${author} - ${title}`,\r\n        description: title,\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: $('a.navbar-brand img').attr('src') ? new URL($('a.navbar-brand img').attr('src') as string, baseUrl).href : undefined,\r\n        author,\r\n        language,\r\n        id: $('meta[property=\"og:url\"]').attr('content'),\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/info/:category?/:id?',\r\n    name: '新闻',\r\n    url: 'info.10000link.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/10000link/info/newslists/My01',\r\n    parameters: {\r\n        category: {\r\n            description: '分类，默认为 `newslists`，可在对应分类页 URL 中找到',\r\n            options: [\r\n                {\r\n                    label: '新闻',\r\n                    value: 'newslists',\r\n                },\r\n                {\r\n                    label: '物流',\r\n                    value: 'newslogistics',\r\n                },\r\n                {\r\n                    label: '供应链金融风控',\r\n                    value: 'newsRisk',\r\n                },\r\n                {\r\n                    label: '区块链',\r\n                    value: 'newsBlockChain',\r\n                },\r\n                {\r\n                    label: 'B2B',\r\n                    value: 'newsBTwoB',\r\n                },\r\n                {\r\n                    label: '跨境电商',\r\n                    value: 'newsCrossborder',\r\n                },\r\n                {\r\n                    label: '投融资',\r\n                    value: 'newsInvestment',\r\n                },\r\n                {\r\n                    label: '供应链管理',\r\n                    value: 'newsManagement',\r\n                },\r\n                {\r\n                    label: '供应链创新',\r\n                    value: 'newsInnovation',\r\n                },\r\n                {\r\n                    label: '数据',\r\n                    value: 'newslists/A02',\r\n                },\r\n                {\r\n                    label: '政策',\r\n                    value: 'newslists/A03',\r\n                },\r\n                {\r\n                    label: '规划',\r\n                    value: 'newslists/A04',\r\n                },\r\n                {\r\n                    label: '案例',\r\n                    value: 'newslists/GL03',\r\n                },\r\n                {\r\n                    label: '职场',\r\n                    value: 'newslists/ZC',\r\n                },\r\n                {\r\n                    label: '供应链票据',\r\n                    value: 'newsBill',\r\n                },\r\n            ],\r\n        },\r\n        id: {\r\n            description: 'ID，默认为空，可在对应分类页 URL 中找到',\r\n        },\r\n    },\r\n    description: `:::tip\r\n若订阅 [天下大势](https://info.10000link.com/newslists.aspx?chid=My01)，网址为 \\`https://info.10000link.com/newslists.aspx?chid=My01\\`，请截取 \\`https://info.10000link.com/\\` 到末尾 \\`.aspx\\` 的部分 \\`newslists\\` 作为 \\`category\\` 参数填入，而 \\`My01\\` 作为 \\`id\\` 参数填入，此时目标路由为 [\\`/10000link/info/newslists/My01\\`](https://rsshub.app/10000link/info/newslists/My01)。\r\n:::\r\n\r\n| 金融科技      | 物流          | 供应链金融风控 | 区块链         | B2B       |\r\n| ------------- | ------------- | -------------- | -------------- | --------- |\r\n| newsFinancial | newslogistics | newsRisk       | newsBlockChain | newsBTwoB |\r\n\r\n| 跨境电商        | 投融资         | 供应链管理     | 供应链创新     | 数据          |\r\n| --------------- | -------------- | -------------- | -------------- | ------------- |\r\n| newsCrossborder | newsInvestment | newsManagement | newsInnovation | newslists/A02 |\r\n\r\n| 政策          | 规划          | 案例           | 职场         | 供应链票据 |\r\n| ------------- | ------------- | -------------- | ------------ | ---------- |\r\n| newslists/A03 | newslists/A04 | newslists/GL03 | newslists/ZC | newsBill   |\r\n`,\r\n    categories: ['new-media'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['info.10000link.com/:category'],\r\n            target: (params, url) => {\r\n                const urlObj: URL = new URL(url);\r\n                const id: string | undefined = urlObj.searchParams.get('chid') ?? undefined;\r\n                const category: string = params.category;\r\n\r\n                return `/10000link/info${category ? `/${category}${id ? `/${id}` : ''}` : ''}`;\r\n            },\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n};\r\n"],"mappings":"yeAYA,MAAa,EAAU,KAAO,IAAgC,CAC1D,GAAM,CAAE,WAAW,YAAa,MAAO,EAAI,IAAI,QACzC,EAAgB,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IAEhE,EAAkB,6BAClB,EAAoB,IAAI,IAAI,GAAG,EAAS,OAAO,EAAK,SAAS,IAAO,KAAM,GAAS,KAEnF,EAAW,MAAM,EAAO,GACxB,EAAgB,EAAK,GACrB,EAAW,EAAE,QAAQ,KAAK,SAAW,KAEvC,EAAoB,GAExB,EAAQ,EAAE,+BACL,MAAM,EAAG,GACT,UACA,IAAK,GAAgB,CAClB,IAAM,EAAwB,EAAE,GAC1B,EAAyB,EAAI,KAAK,WAElC,EAAgB,EAAK,KAAK,UAAY,EAAK,OAC3C,EAAkC,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAC3F,MAAO,EAAI,KAAK,cAAc,SAE5B,EAAiC,EAAI,KAAK,cAAc,OACxD,EAA8B,EAAK,KAAK,QACxC,EAAyB,EAAI,KAAK,oBAAoB,UACtD,EAAuB,CAAC,GAAG,IAAI,IAAI,EAAY,IAAK,GAAO,EAAE,GAAI,QAAQ,OAAO,WAChF,EAA8B,EAAI,KAAK,kBAAkB,QAAQ,OACjE,EAA4B,EAAI,KAAK,mBAAmB,KAAK,OAC7D,EAAiC,EAEjC,EAA0B,CAC5B,MAAA,EACA,cACA,QAAS,EAAa,EAAkB,GAAc,IAAA,GACtD,KAAM,EAAU,IAAI,IAAI,EAAS,GAAS,KAAO,IAAA,GACjD,SAAU,EACV,OAAQ,EACR,QAAS,CACL,KAAM,EACN,KAAM,GAEV,QACA,OAAQ,EACR,QAAS,EAAa,EAAkB,GAAc,IAAA,GACtD,YAGJ,OAAO,IAGf,GACI,MAAM,QAAQ,IACV,EAAM,IAAK,GACF,EAAK,KAIH,EAAM,OAAO,EAAK,KAAM,SAA+B,CAC1D,IAAM,EAAiB,MAAM,EAAO,EAAK,MACnC,EAAiB,EAAK,GAEtB,EAAgB,EAAG,yBAAyB,OAC5C,EAA4B,EAAG,uCAAuC,KAAK,OAE3E,EAAkC,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAC3F,OAAQ,EACF,CACI,CACI,IAAK,EACL,IAAK,IAGb,IAAA,GACN,YAAa,EAAG,sBAAsB,SAEpC,EAAiC,EAAe,MAAM,4BAA4B,GAClF,EAAyB,EAAG,yBAAyB,UACrD,EAAuB,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,EAAY,IAAK,GAAO,EAAG,GAAI,QAAS,GAAI,EAAK,UAAY,IAAK,OAAO,WAChH,EAAiC,EAEjC,EAA0B,CAC5B,MAAA,EACA,cACA,QAAS,EAAa,EAAU,GAAc,EAAK,QACnD,SAAU,EACV,QAAS,CACL,KAAM,EACN,KAAM,GAEV,QACA,OAAQ,EACR,QAAS,EAAa,EAAU,GAAc,EAAK,QACnD,YAGJ,MAAO,CACH,GAAG,EACH,GAAG,KA3CA,KAgDrB,OAAQ,GAAqB,IAE/B,IAAM,EAAiB,WACjB,EAAgB,EAAE,MAAM,WAAW,QAAQ,OAEjD,MAAO,CACH,MAAO,GAAG,EAAO,KAAK,IACtB,YAAa,EACb,KAAM,EACN,KAAM,EACN,WAAY,GACZ,MAAO,EAAE,sBAAsB,KAAK,OAAS,IAAI,IAAI,EAAE,sBAAsB,KAAK,OAAkB,GAAS,KAAO,IAAA,GACpH,SACA,WACA,GAAI,EAAE,2BAA2B,KAAK,aAIjC,EAAe,CACxB,KAAM,wBACN,KAAM,KACN,IAAK,qBACL,YAAa,CAAC,WACd,UACA,QAAS,iCACT,WAAY,CACR,SAAU,CACN,YAAa,qCACb,QAAS,CACL,CACI,MAAO,KACP,MAAO,aAEX,CACI,MAAO,KACP,MAAO,iBAEX,CACI,MAAO,UACP,MAAO,YAEX,CACI,MAAO,MACP,MAAO,kBAEX,CACI,MAAO,MACP,MAAO,aAEX,CACI,MAAO,OACP,MAAO,mBAEX,CACI,MAAO,MACP,MAAO,kBAEX,CACI,MAAO,QACP,MAAO,kBAEX,CACI,MAAO,QACP,MAAO,kBAEX,CACI,MAAO,KACP,MAAO,iBAEX,CACI,MAAO,KACP,MAAO,iBAEX,CACI,MAAO,KACP,MAAO,iBAEX,CACI,MAAO,KACP,MAAO,kBAEX,CACI,MAAO,KACP,MAAO,gBAEX,CACI,MAAO,QACP,MAAO,cAInB,GAAI,CACA,YAAa,4BAGrB,YAAa,ihCAgBb,WAAY,CAAC,aACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,gCACT,QAAS,EAAQ,IAAQ,CACrB,IAAM,EAAc,IAAI,IAAI,GACtB,EAAyB,EAAO,aAAa,IAAI,SAAW,IAAA,GAC5D,EAAmB,EAAO,SAEhC,MAAO,kBAAkB,EAAW,IAAI,IAAW,EAAK,IAAI,IAAO,KAAO,QAItF,KAAM,EAAS"}