import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import"./ofetch-Bzt0BXUH.js";import{got_default as t}from"./got-CdvI2yKX.js";const n={path:`/topic/:id/:sort?`,categories:[`social-media`],example:`/douban/topic/48823`,parameters:{id:`话题id`,sort:`排序方式，hot或new，默认为new`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`话题`,maintainers:[`LogicJake`,`pseudoyu`,`haowenwu`],handler:r};async function r(n){let r=n.req.param(`id`),i=n.req.param(`sort`)||`new`,a=`https://www.douban.com/gallery/topic/${r}/?sort=${i}`,o=`https://m.douban.com/rexxar/api/v2/gallery/topic/${r}/items?sort=${i}&start=0&count=10&status_full_text=1`,s=await t({method:`GET`,url:o,headers:{Referer:a}}),c=s.data.items,l=r,u=``;c[0].topic!==null&&(l=c[0].topic.name,u=c[0].topic.introduction);let d=await Promise.all(c.map(async n=>{let r=n.target.type,i,a,o,s,c;if(r===`status`){s=n.target.status.sharing_url.split(`&`)[0],i=n.target.status.author.name,c=i+`的广播`,a=n.target.status.create_time,o=n.target.status.text;let e=n.target.status.images;if(e){let t;for(t in e)o+=`<br><img src="${e[t].normal.url}" />`}}else if(r===`topic`){s=n.target.sharing_url,i=n.target.author.name,c=n.target.title,a=n.target.create_time,o=n.target.abstract;let e=n.target.photos;if(e){let t;for(t in e)o+=`<br><img src="${e[t].src}" />`}}else{s=n.target.sharing_url,i=n.target.author.name,c=i+`的日记`,a=n.target.create_time;let r=n.target.id,l=`https://www.douban.com/j/note/${r}/full`,u=await e.get(s);if(u)return JSON.parse(u);let d=await t.get(l);o=d.data.html}let l={title:c,link:s,author:i,pubDate:new Date(a).toUTCString(),description:o};return r!==`status`&&e.set(s,JSON.stringify(l)),l}));return{title:`${l}-豆瓣话题`,description:u,link:a,item:d}}export{n as route};
//# sourceMappingURL=topic-BDrPKoOj.js.map