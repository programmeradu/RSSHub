{"version":3,"file":"iguoguo-XkJpjZi8.js","names":["cache","ofetch","route: Route"],"sources":["../../lib/routes/iguoguo/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { config } from '@/config';\r\nimport type { Context } from 'hono';\r\nconst rootUrl = 'https://www.iguoguo.net';\r\n\r\nconst getCategoryIdFromSlug = (slug) =>\r\n    cache.tryGet(`iguoguo:category:${slug}`, async () => {\r\n        const response = await ofetch(`${rootUrl}/wp-json/wp/v2/categories`, {\r\n            query: {\r\n                slug,\r\n            },\r\n        });\r\n        return response[0].id;\r\n    });\r\n\r\nconst getPostsByCategory = (categoryId, limit) =>\r\n    cache.tryGet(\r\n        `iguoguo:posts:${categoryId}`,\r\n        async () => {\r\n            const response = await ofetch(`${rootUrl}/wp-json/wp/v2/posts`, {\r\n                query: {\r\n                    categories: categoryId,\r\n                    per_page: limit,\r\n                },\r\n            });\r\n            return response;\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    );\r\n\r\nexport const route: Route = {\r\n    path: '/html5',\r\n    categories: ['design'],\r\n    example: '/iguoguo/html5',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '最新 H5',\r\n    maintainers: ['yuxinliu-alex'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx: Context) {\r\n    const limit = Number.parseInt(ctx.req.query('limit') ?? '10');\r\n    const currentUrl = `${rootUrl}/html5`;\r\n    const categorySlug = 'h5';\r\n\r\n    const categoryId = await getCategoryIdFromSlug(categorySlug);\r\n    const posts = await getPostsByCategory(categoryId, limit);\r\n\r\n    const mime = {\r\n        jpg: 'jpeg',\r\n        png: 'png',\r\n    };\r\n\r\n    const items = posts.map((item) => {\r\n        const $ = load(item.content.rendered);\r\n        const cover = $('p > img').first().attr('src');\r\n        $('p > img').first().remove();\r\n        $('h4').each((_, el) => {\r\n            if ($(el).text().includes('扫码欣赏')) {\r\n                $(el).remove();\r\n            }\r\n        });\r\n        return {\r\n            title: item.title.rendered,\r\n            description: $.html(),\r\n            link: item.link,\r\n            cover,\r\n            pubDate: parseDate(item.date_gmt),\r\n            media: cover && {\r\n                content: {\r\n                    url: cover,\r\n                    type: `image/${mime[cover.split('.').pop()]}`,\r\n                },\r\n            },\r\n        };\r\n    });\r\n    return {\r\n        title: '爱果果',\r\n        link: currentUrl,\r\n        description: '爱果果iguoguo是一个优秀酷站、h5、UI素材资源的发布分享平台，是设计师的灵感聚合地和素材下载源。',\r\n        language: 'zh-cn',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"oUAOA,MAAM,EAAU,0BAEV,EAAyB,GAC3BA,EAAM,OAAO,oBAAoB,IAAQ,SAAY,CACjD,IAAM,EAAW,MAAMC,EAAO,GAAG,EAAQ,2BAA4B,CACjE,MAAO,CACH,UAGR,OAAO,EAAS,GAAG,KAGrB,GAAsB,EAAY,IACpCD,EAAM,OACF,iBAAiB,IACjB,SAAY,CACR,IAAM,EAAW,MAAMC,EAAO,GAAG,EAAQ,sBAAuB,CAC5D,MAAO,CACH,WAAY,EACZ,SAAU,KAGlB,OAAO,GAEX,EAAO,MAAM,YACb,IAGKC,EAAe,CACxB,KAAM,SACN,WAAY,CAAC,UACb,QAAS,iBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,QACN,YAAa,CAAC,iBACd,WAGJ,eAAe,EAAQ,EAAc,CACjC,IAAM,EAAQ,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,MAClD,EAAa,GAAG,EAAQ,QAGxB,EAAa,MAAM,EAAsB,MACzC,EAAQ,MAAM,EAAmB,EAAY,GAE7C,EAAO,CACT,IAAK,OACL,IAAK,OAGH,EAAQ,EAAM,IAAK,GAAS,CAC9B,IAAM,EAAI,EAAK,EAAK,QAAQ,UACtB,EAAQ,EAAE,WAAW,QAAQ,KAAK,OAOxC,OANA,EAAE,WAAW,QAAQ,SACrB,EAAE,MAAM,MAAM,EAAG,IAAO,CAChB,EAAE,GAAI,OAAO,SAAS,SACtB,EAAE,GAAI,WAGP,CACH,MAAO,EAAK,MAAM,SAClB,YAAa,EAAE,OACf,KAAM,EAAK,KACX,QACA,QAAS,EAAU,EAAK,UACxB,MAAO,GAAS,CACZ,QAAS,CACL,IAAK,EACL,KAAM,SAAS,EAAK,EAAM,MAAM,KAAK,cAKrD,MAAO,CACH,MAAO,MACP,KAAM,EACN,YAAa,uDACb,SAAU,QACV,KAAM"}