{"version":3,"file":"zhibo-DrXatnGU.js","names":[],"sources":["../../lib/routes/radio/zhibo.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport CryptoJS from 'crypto-js';\r\n\r\nconst audio_types = {\r\n    m3u8: 'x-mpegURL',\r\n    mp3: 'mpeg',\r\n    mp4: 'mp4',\r\n    m4a: 'mp4',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/zhibo/:id',\r\n    categories: ['multimedia'],\r\n    example: '/radio/zhibo/1395528',\r\n    parameters: { id: '直播 id，可在对应点播页面的 URL 中找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: true,\r\n        supportScihub: false,\r\n    },\r\n    name: '直播',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `如果订阅 [新闻和报纸摘要](http://www.radio.cn/pc-portal/sanji/zhibo_2.html?name=1395528)，其 URL 为 \\`http://www.radio.cn/pc-portal/sanji/zhibo_2.html?name=1395528\\`，可以得到 \\`name\\` 为 \\`1395528\\`\r\n\r\n  所以对应路由为 [\\`/radio/zhibo/1395528\\`](https://rsshub.app/radio/zhibo/1395528)\r\n\r\n::: tip\r\n  查看更多电台直播节目，可前往 [电台直播](http://www.radio.cn/pc-portal/erji/radioStation.html)\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const KEY = 'f0fc4c668392f9f9a447e48584c214ee';\r\n\r\n    const id = ctx.req.param('id');\r\n    const size = ctx.req.query('limit') ?? '100';\r\n\r\n    const params = `columnId=${id}&pageNo=0&pageSize=${size}`;\r\n\r\n    const rootUrl = 'https://www.radio.cn';\r\n    const apiRootUrl = 'https://ytmsout.radio.cn';\r\n\r\n    const iconUrl = `${rootUrl}/pc-portal/image/icon_32.jpg`;\r\n    const currentUrl = `${rootUrl}/pc-portal/sanji/zhibo_2.html?name=${id}`;\r\n    const apiUrl = `${apiRootUrl}/web/appProgram/pageByColumn?${params}`;\r\n\r\n    const timestamp = Date.now();\r\n    const sign = CryptoJS.MD5(`${params}&timestamp=${timestamp}&key=${KEY}`).toString().toUpperCase();\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: apiUrl,\r\n        headers: {\r\n            sign,\r\n            timestamp,\r\n            'Content-Type': 'application/json',\r\n            equipmentId: '0000',\r\n            platformCode: 'WEB',\r\n        },\r\n    });\r\n\r\n    const data = response.data.data.data;\r\n\r\n    const items = data.map((item) => {\r\n        let enclosure_url = item.playUrlHigh ?? item.playUrlLow;\r\n        enclosure_url = /\\.m3u8$/.test(enclosure_url) ? item.downloadUrl : enclosure_url;\r\n        const file_ext = new URL(enclosure_url).pathname.split('.').pop();\r\n        const enclosure_type = file_ext ? `audio/${audio_types[file_ext]}` : '';\r\n\r\n        const date = new Date(item.startTime);\r\n        const dateString = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;\r\n\r\n        return {\r\n            guid: item.id,\r\n            title: `${dateString} ${item.name}`,\r\n            link: enclosure_url,\r\n            description: art(path.join(__dirname, 'templates/description.art'), {\r\n                description: item.des,\r\n                enclosure_url,\r\n                enclosure_type,\r\n            }),\r\n            pubDate: parseDate(item.startTime),\r\n            enclosure_url,\r\n            enclosure_type,\r\n            itunes_duration: item.durationStr,\r\n            itunes_item_image: iconUrl,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: `云听 - ${data[0].name}`,\r\n        link: currentUrl,\r\n        item: items,\r\n        image: iconUrl,\r\n        itunes_author: 'radio.cn',\r\n        description: data[0].des,\r\n    };\r\n}\r\n"],"mappings":"8ZAQA,MAAM,EAAc,CAChB,KAAM,YACN,IAAK,OACL,IAAK,MACL,IAAK,OAGI,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,cACb,QAAS,uBACT,WAAY,CAAE,GAAI,2BAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa,8VASjB,eAAe,EAAQ,EAAK,CACxB,IAEM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAO,EAAI,IAAI,MAAM,UAAY,MAEjC,EAAS,YAAY,EAAG,qBAAqB,IAE7C,EAAU,uBAGV,EAAU,GAAG,EAAQ,8BACrB,EAAa,GAAG,EAAQ,qCAAqC,IAC7D,EAAS,wDAA6C,IAEtD,EAAY,KAAK,MACjB,EAAO,EAAS,IAAI,GAAG,EAAO,aAAa,EAAU,wCAAc,WAAW,cAE9E,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,EACL,QAAS,CACL,OACA,YACA,eAAgB,mBAChB,YAAa,OACb,aAAc,SAIhB,EAAO,EAAS,KAAK,KAAK,KAE1B,EAAQ,EAAK,IAAK,GAAS,CAC7B,IAAI,EAAgB,EAAK,aAAe,EAAK,WAC7C,EAAgB,UAAU,KAAK,GAAiB,EAAK,YAAc,EACnE,IAAM,EAAW,IAAI,IAAI,GAAe,SAAS,MAAM,KAAK,MACtD,EAAiB,EAAW,SAAS,EAAY,KAAc,GAE/D,EAAO,IAAI,KAAK,EAAK,WACrB,EAAa,GAAG,EAAK,cAAc,GAAG,EAAK,WAAa,EAAE,GAAG,EAAK,YAExE,MAAO,CACH,KAAM,EAAK,GACX,MAAO,GAAG,EAAW,GAAG,EAAK,OAC7B,KAAM,EACN,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,YAAa,EAAK,IAClB,gBACA,mBAEJ,QAAS,EAAU,EAAK,WACxB,gBACA,iBACA,gBAAiB,EAAK,YACtB,kBAAmB,KAI3B,MAAO,CACH,MAAO,QAAQ,EAAK,GAAG,OACvB,KAAM,EACN,KAAM,EACN,MAAO,EACP,cAAe,WACf,YAAa,EAAK,GAAG"}