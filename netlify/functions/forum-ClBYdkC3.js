import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import s from"node:path";import{load as c}from"cheerio";import l from"iconv-lite";t();const u=`https://www.flyert.com.cn`,d=(t,n)=>t(`div.comiis_wzli`).slice(0,n).toArray().map(n=>{n=t(n);let a=n.find(`div.wzbt`).text().trim(),o=n.find(`div.wzpic img`).prop(`src`),c=r(s.join(e,`templates/description-b958bde9.art`),{images:o?[{src:o,alt:a}]:void 0,description:n.find(`div.wznr`).html()}),l=n.find(`div.subcat span.y`).contents()?.eq(2)?.text().trim()??void 0,d=new URL(n.find(`div.wzbt a`).prop(`href`),u).href;return{title:a,description:c,pubDate:l?i(l):void 0,link:d,author:n.find(`div.subcat span.y a`).first().text(),content:{html:c,text:n.find(`div.wznr`).text()},image:o,banner:o}}),f=(e,t)=>e(`div.comiis_postlist`).toArray().filter(t=>(t=e(t),t.find(`span.comiis_common a[data-track]`).toArray().some(t=>{t=e(t);let n=t.attr(`data-track`)||``;return n.endsWith(`文章`)}))).slice(0,t).map(t=>{t=e(t);let n=e(t.find(`span.comiis_common a[data-track]`).toArray().find(t=>{t=e(t);let n=t.attr(`data-track`)||``;return n.endsWith(`文章`)})),r=t.find(`span.author_b span`).prop(`title`)||void 0;return{title:n.text().trim(),pubDate:r?i(r):void 0,link:new URL(n.prop(`href`),u).href,author:t.find(`a.author_t`).text().trim()}}),p=(t,n)=>{let a=t(`h1.ph`).text().trim(),c=r(s.join(e,`templates/description-b958bde9.art`),{intro:t(`div.s`).text()||void 0,description:t(`div#artMain`).html()}),l=t(`p.xg1`).contents().first().text().trim()?.match(/(\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2})/)?.[1]??void 0,u=`flyert-${n.link.split(/=/).pop()}`;return n.title=a,n.description=c,n.pubDate=l?o(i(l),8):n.pubDate,n.author=t(`p.xg1 a`).first().text(),n.guid=u,n.id=u,n.content={html:c,text:t(`div#artMain`).text()},n},m=(t,n)=>{t(`img.zoom`).each((n,i)=>{i=t(i),i.replaceWith(r(s.join(e,`templates/description-b958bde9.art`),{images:i.prop(`zoomfile`)||i.prop(`file`)?[{src:i.prop(`zoomfile`)||i.prop(`file`),alt:i.prop(`alt`)||i.prop(`title`)}]:void 0}))}),t(`i.pstatus`).remove(),t(`div.tip`).remove();let a=t(`span#thread_subject`).text().trim(),c=t(`div.post_message`).first().html(),l=t(`span[title]`).first().prop(`title`),u=n.link.match(/tid=(\d+)/)?.[1]??void 0,d=u?`flyert-${u}`:void 0;return n.title=a,n.description=c,n.pubDate=l?o(i(l),8):n.pubDate,n.author=t(`a.kmxi2`).first().text(),n.guid=d,n.id=d,n.content={html:c,text:t(`div.post_message`).first().text()},n},h=async e=>{let{params:t}=e.req.param(),r=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):5,i=t?decodeURIComponent(t).split(/&/).filter(e=>e.split(/=/).length===2).join(`&`):void 0,o=new URL(`forum.php${i?`?${i}`:``}`,u).href,{data:s}=await a(o,{responseType:`buffer`}),h=c(l.decode(s,`gbk`)),g=h(`meta[http-equiv="Content-Language"]`).prop(`content`),_=h(`table#threadlisttableid`).length===0?d(h,r):f(h,r);_=await Promise.all(_.map(e=>n.tryGet(e.link,async()=>{let{data:t}=await a(e.link,{responseType:`buffer`}),n=c(l.decode(t,`gbk`).replaceAll(/<\/?ignore_js_op>/g,``));return e=n(`div.firstpost`).length===0?p(n,e):m(n,e),e.language=g,e})));let v=`https:${h(`div.wp h2 a img`).prop(`src`)}`;return{title:`飞客 - ${h(`a.forum_name, li.a, li.cur, li.xw1, div.z > a.xw1`).toArray().map(e=>h(e).text()).join(` - `)}`,description:h(`meta[name="description"]`).prop(`content`),link:o,item:_,allowEmpty:!0,image:v,author:h(`meta[name="application-name"]`).prop(`content`)}},g={path:`/forum/:params{.+}?`,name:`会员说`,url:`www.flyert.com.cn`,maintainers:[`nczitzk`],handler:h,example:`/flyert/forum`,parameters:{params:`参数，默认为空，可在对应分类页 URL 中找到`},description:"::: tip\n  若订阅 [酒店集团优惠](https://www.flyert.com.cn/forum.php?mod=forumdisplay&sum=all&fid=all&catid=322&filter=sortid&sortid=144&searchsort=1&youhui_type=19)，网址为 `https://www.flyert.com.cn/forum.php?mod=forumdisplay&sum=all&fid=all&catid=322&filter=sortid&sortid=144&searchsort=1&youhui_type=19`。截取 `https://www.flyert.com.cn/forum.php?` 到末尾的部分 `mod=forumdisplay&sum=all&fid=all&catid=322&filter=sortid&sortid=144&searchsort=1&youhui_type=19` **进行 UrlEncode 编码** 后作为参数填入，此时路由为 [`/flyert/forum/mod%3Dforumdisplay%26sum%3Dall%26fid%3Dall%26catid%3D322%26filter%3Dsortid%26sortid%3D144%26searchsort%3D1%26youhui_type%3D226`](https://rsshub.app/flyert/forum/mod%3Dforumdisplay%26sum%3Dall%26fid%3Dall%26catid%3D322%26filter%3Dsortid%26sortid%3D144%26searchsort%3D1%26youhui_type%3D226)。\n:::\n    ",categories:[`bbs`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.flyert.com.cn/forum.php`],target:(e,t)=>{let n=[...t.searchParams.entries()].map(([e,t])=>e+`=`+t).join(`&`);return`/forum${n?`/${encodeURIComponent(n)}`:``}`}}]};export{h as handler,g as route};
//# sourceMappingURL=forum-ClBYdkC3.js.map