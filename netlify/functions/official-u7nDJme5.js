import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import{logger_default as n}from"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as r}from"./cache-kimkMTWJ.js";import{art as i}from"./render-CxhTJIsl.js";import{parseDate as a}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as o}from"./got-CdvI2yKX.js";import s from"node:path";t();const c={1:`崩坏三`,2:`原神`,3:`崩坏二`,4:`未定事件簿`,6:`崩坏：星穹铁道`,8:`绝区零`},l={1:`公告`,2:`活动`,3:`资讯`},u={1:`bh3`,2:`ys`,3:`bh2`,4:`wd`,6:`sr`,8:`zzz`},d={1:`6`,2:`28`,3:`31`,4:`33`,6:`53`,8:`58`};var f=class extends Error{constructor(e){super(e),this.name=`MiHoYoOfficialError`}};const p=async({gids:e,type:t,page_size:n,last_id:r})=>{let i=new URLSearchParams({client_type:`4`,gids:e,type:t,page_size:n,last_id:r}).toString(),a=`https://bbs-api-static.miyoushe.com/painter/wapi/getNewsList?${i}`,s=await o({method:`get`,url:a}),c=s?.data?.data?.list;return c},m=async(t,n=`2`)=>{let c=t.post,l=c.post_id,d=new URLSearchParams({post_id:l}).toString(),p=`https://bbs-api.miyoushe.com/post/wapi/getPostFull?${d}`;return await r.tryGet(p,async()=>{let r=await o(p),d=r?.data?.data?.post;if(!d)throw new f(`mihoyo/bbs/official: getPostContent failed: ${p} - ${JSON.stringify(r)}`);let m=d?.post?.game_id||n,h=d?.user?.nickname||``,g=d?.post?.content||``,_=d?.topics?.map(e=>e.name)||[],v=i(s.join(e,`templates/official-05e914ac.art`),{hasCover:c.has_cover,coverList:t.cover_list,content:g});return{title:c.subject,link:`https://www.miyoushe.com/${u[m]}/article/${l}`,description:v,pubDate:a(c.created_at*1e3),category:_,author:h}})},h=(e,t=`2`)=>Promise.all(e.map(e=>m(e,t).catch(e=>{if(e instanceof f)return n.error(e.message),null;throw e}))).then(e=>e.filter(Boolean)),g={path:`/bbs/official/:gids/:type?/:page_size?/:last_id?`,categories:[`game`],example:`/mihoyo/bbs/official/2/3/20/`,parameters:{gids:`游戏id`,type:`公告类型，默认为 2(即 活动)`,page_size:`分页大小，默认为 20 `,last_id:`跳过的公告数，例如指定为 40 就是从第 40 条公告开始，可用于分页`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`米游社 - 官方公告`,maintainers:[`CaoMeiYouRen`],handler:_,description:`游戏 id

| 崩坏三 | 原神 | 崩坏二 | 未定事件簿 | 星穹铁道 | 绝区零 |
| ------ | ---- | ------ | ---------- | -------- | ------ |
| 1      | 2    | 3      | 4          | 6        | 8      |

  公告类型

| 公告 | 活动 | 资讯 |
| ---- | ---- | ---- |
| 1    | 2    | 3    |`};async function _(e){let{gids:t,type:n=`2`,page_size:r=`20`,last_id:i=``}=e.req.param(),a=await p({gids:t,type:n,page_size:r,last_id:i}),o=await h(a,t),s=`米游社 - ${c[t]||``} - ${l[n]||``}`,f=`https://www.miyoushe.com/${u[t]}/home/${d[t]}?type=${n}`,m={title:s,link:f,item:o};return m}export{g as route};
//# sourceMappingURL=official-u7nDJme5.js.map