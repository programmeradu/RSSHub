{"version":3,"file":"yz-bxri95GJ.js","names":["resultItem: DataItem","cache","got","$","route: Route"],"sources":["../../lib/routes/neu/yz.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst BASE_URL = 'http://yz.neu.edu.cn';\r\nconst DOWNLOAD_ID = 5792;\r\nconst MASTER1_ID = 5932;\r\nconst MASTER2_ID = 5933;\r\nconst PhD1_ID = 5945;\r\nconst PhD2_ID = 5946;\r\nconst DOWNLOAD_AUTHOR = '研招办';\r\n\r\nconst idMp = {\r\n    download: DOWNLOAD_ID,\r\n    master1: MASTER1_ID,\r\n    master2: MASTER2_ID,\r\n    phd1: PhD1_ID,\r\n    phd2: PhD2_ID,\r\n};\r\n\r\nconst parsePage = async (items, type) => {\r\n    const results = await Promise.all(\r\n        items.map(async (item) => {\r\n            const $ = load(item);\r\n            const aTag = $('span.Article_Title > a');\r\n            const title = aTag.attr('title') ?? '';\r\n            const url = BASE_URL + aTag.attr('href');\r\n            const resultItem: DataItem = {\r\n                title,\r\n                link: url,\r\n                description: '',\r\n                pubDate: (() => {\r\n                    const sTag = $('span.Article_PublishDate');\r\n                    const pubDate = sTag.text() ? timezone(parseDate(sTag.text()), +8) : undefined;\r\n                    return pubDate;\r\n                })(),\r\n                author: type === DOWNLOAD_ID ? DOWNLOAD_AUTHOR : '',\r\n            };\r\n            if (type === DOWNLOAD_ID && /\\.(pdf|docx?|xlsx?|zip|rar|7z)$/i.test(url)) {\r\n                resultItem.description = `\r\n                        <p>${title}</p><br/>\r\n                        <a href=\"${url}\">点击进入下载地址传送门～</a>\r\n                    `;\r\n                return resultItem;\r\n            } else {\r\n                return await cache.tryGet(url, async () => {\r\n                    const result = await got(url);\r\n                    const $ = load(result.data);\r\n                    const description = cleanEntryContent($);\r\n                    resultItem.description = description;\r\n                    if (type !== DOWNLOAD_ID) {\r\n                        const dateText = $('.arti_update')\r\n                            .text()\r\n                            .match(/(\\d{4}-\\d{2}-\\d{2})/);\r\n                        const date = dateText ? dateText[1] : '';\r\n                        const authorText = $('.arti_publisher')\r\n                            .text()\r\n                            .match(/[:：]?\\s*(.+)/);\r\n                        const author = authorText ? authorText[1].trim() : '';\r\n                        resultItem.pubDate = timezone(parseDate(date), +8);\r\n                        resultItem.author = author;\r\n                    }\r\n                    return resultItem;\r\n                });\r\n            }\r\n        })\r\n    );\r\n    return results;\r\n};\r\n\r\nconst handler = async (ctx) => {\r\n    let type = ctx.req.param('type');\r\n    if (idMp[type]) {\r\n        type = idMp[type];\r\n    }\r\n    const newsUrl = `${BASE_URL}/${type}/list.htm`;\r\n    const response = await got(newsUrl);\r\n    const data = response.data;\r\n    const $ = load(data);\r\n    const title = $('title').text();\r\n    const items = $('div.col_news_list ul.wp_article_list li').toArray();\r\n    const results = await parsePage(items, type);\r\n    return {\r\n        title: `${title}-东北大学研究生招生信息网`,\r\n        description: title,\r\n        link: BASE_URL,\r\n        item: results,\r\n    };\r\n};\r\n\r\nconst cleanEntryContent = ($) => {\r\n    const entry = $('.entry');\r\n    if (!entry || entry.length === 0) {\r\n        return '';\r\n    }\r\n    entry.find('span').removeAttr('style').removeAttr('class');\r\n    entry.find('div').each((_, el) => {\r\n        const html = $(el).html();\r\n        $(el).replaceWith(html);\r\n    });\r\n    entry.find('p').removeAttr('style').removeAttr('class');\r\n    entry.find('a').removeAttr('style').removeAttr('class');\r\n    entry.find('td').removeAttr('bgcolor');\r\n    entry.find('img').each((_, el) => {\r\n        const src = $(el).attr('src');\r\n        const alt = $(el).attr('alt') || '';\r\n        $(el).replaceWith(`<img src=\"${src}\" alt=\"${alt}\" />`);\r\n    });\r\n    entry.find('.wp_pdf_player').each((_, el) => {\r\n        const url = BASE_URL + $(el).attr('pdfsrc');\r\n        $(el).replaceWith(\r\n            `\r\n            <p>点击进入文件传送门～：<a href=\"${url}\">查看文件</a></p>\r\n            `\r\n        );\r\n    });\r\n    entry.find('.wp_video_player').each((_, el) => {\r\n        const div = $(el);\r\n        const src = div.attr('sudy-wp-src');\r\n        if (src) {\r\n            const videoUrl = BASE_URL + src;\r\n            const widthMatch = div.attr('style')?.match(/width:\\s*(\\d+)px/);\r\n            const width = widthMatch && widthMatch[1] ? widthMatch[1] : '600';\r\n            const heightMatch = div.attr('style')?.match(/height:\\s*(\\d+)px/);\r\n            const height = heightMatch && heightMatch[1] ? heightMatch[1] : '400';\r\n            const videoTag = `\r\n                <video controls width=\"${width}\" height=\"${height}\" style=\"max-width: 100%;margin-left: auto;margin-right: auto;\">\r\n                    <source src=\"${videoUrl}\" type=\"video/mp4\">\r\n                    您的浏览器不支持 video 标签。\r\n                </video>\r\n            `;\r\n            div.replaceWith(videoTag);\r\n        }\r\n    });\r\n    return entry.html();\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/yz/:type',\r\n    categories: ['university'],\r\n    example: '/neu/yz/master1',\r\n    parameters: { type: '分类id,见下表' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['yz.neu.edu.cn/:type/list.htm'],\r\n            target: '/yz/:type',\r\n        },\r\n    ],\r\n    name: '研究生招生信息网',\r\n    url: 'yz.neu.edu.cn',\r\n    maintainers: ['paintstar'],\r\n    handler,\r\n    description: `\r\n| 分类名                     | 分类id      |\r\n| ------------------------- | ---------- |\r\n| 硕士公告                   | master1     |\r\n| 硕士简章                   | master2     |\r\n| 博士公告                   | phd1        |\r\n| 博士简章                   | phd2        |\r\n| 下载中心                   | download    |`,\r\n};\r\n"],"mappings":"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"}