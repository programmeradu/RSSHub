{"version":3,"file":"scripts-BovlmKaY.js","names":["route: Route","got"],"sources":["../../lib/routes/greasyfork/scripts.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: ['/:language/:domain?', '/scripts/sort/:sort/:language?'],\r\n    categories: ['program-update'],\r\n    example: '/greasyfork/en/google.com',\r\n    parameters: { language: \"language, located on the top right corner of Greasy Fork's search page, set to `all` for including all languages\", domain: \"the script's target domain\" },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['greasyfork.org/:language', 'greasyfork.org/:language/scripts/by-site/:domain?'],\r\n        },\r\n    ],\r\n    name: 'Script Update',\r\n    maintainers: ['imlonghao', 'miles170'],\r\n    handler,\r\n    description: `| Sort            | Description    |\r\n| --------------- | -------------- |\r\n| today           | Daily installs |\r\n| total\\_installs | Total installs |\r\n| ratings         | Ratings        |\r\n| created         | Created date   |\r\n| updated         | Updated date   |\r\n| name            | Name           |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const language = ctx.req.param('language') === 'all' ? 'zh-CN' : ctx.req.param('language') || 'zh-CN';\r\n    const domain = ctx.req.param('domain');\r\n    const filter_locale = ctx.req.param('language') === 'all' ? 0 : 1;\r\n    const sort = ctx.req.param('sort') ?? 'updated';\r\n    const url = domain ? `/by-site/${domain}` : '';\r\n    const currentUrl = `https://greasyfork.org/${language}/scripts${url}`;\r\n    const res = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n        searchParams: {\r\n            filter_locale,\r\n            sort,\r\n        },\r\n    });\r\n    const $ = load(res.data);\r\n    const list = $('.script-list').find('article');\r\n\r\n    return {\r\n        title: $('title').first().text(),\r\n        link: currentUrl,\r\n        description: $('meta[name=description]').attr('content'),\r\n        item: list?.toArray().map((item) => {\r\n            item = $(item);\r\n            const h2 = item.find('h2');\r\n            return {\r\n                title: h2.find('a').text(),\r\n                description: h2.find('.description').text(),\r\n                link: new URL(h2.find('a').attr('href'), 'https://greasyfork.org').href,\r\n                pubDate: parseDate(item.find('.script-list-created-date relative-time').attr('datetime')),\r\n                updated: parseDate(item.find('.script-list-updated-date relative-time').attr('datetime')),\r\n                author: item\r\n                    .find('.script-list-author a')\r\n                    .toArray()\r\n                    .map((a) => $(a).text())\r\n                    .join(', '),\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"oTAKA,MAAaA,EAAe,CACxB,KAAM,CAAC,sBAAuB,kCAC9B,WAAY,CAAC,kBACb,QAAS,4BACT,WAAY,CAAE,SAAU,mHAAoH,OAAQ,8BACpJ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,2BAA4B,uDAG7C,KAAM,gBACN,YAAa,CAAC,YAAa,YAC3B,UACA,YAAa;;;;;;;uCAUjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,cAAgB,MAAQ,QAAU,EAAI,IAAI,MAAM,aAAe,QACxF,EAAS,EAAI,IAAI,MAAM,UACvB,EAAgB,EAAI,IAAI,MAAM,cAAgB,MAAQ,EAAI,EAC1D,EAAO,EAAI,IAAI,MAAM,SAAW,UAChC,EAAM,EAAS,YAAY,IAAW,GACtC,EAAa,0BAA0B,EAAS,UAAU,IAC1D,EAAM,MAAMC,EAAI,CAClB,OAAQ,MACR,IAAK,EACL,aAAc,CACV,gBACA,UAGF,EAAI,EAAK,EAAI,MACb,EAAO,EAAE,gBAAgB,KAAK,WAEpC,MAAO,CACH,MAAO,EAAE,SAAS,QAAQ,OAC1B,KAAM,EACN,YAAa,EAAE,0BAA0B,KAAK,WAC9C,KAAM,GAAM,UAAU,IAAK,GAAS,CAChC,EAAO,EAAE,GACT,IAAM,EAAK,EAAK,KAAK,MACrB,MAAO,CACH,MAAO,EAAG,KAAK,KAAK,OACpB,YAAa,EAAG,KAAK,gBAAgB,OACrC,KAAM,IAAI,IAAI,EAAG,KAAK,KAAK,KAAK,QAAS,0BAA0B,KACnE,QAAS,EAAU,EAAK,KAAK,2CAA2C,KAAK,aAC7E,QAAS,EAAU,EAAK,KAAK,2CAA2C,KAAK,aAC7E,OAAQ,EACH,KAAK,yBACL,UACA,IAAK,GAAM,EAAE,GAAG,QAChB,KAAK"}