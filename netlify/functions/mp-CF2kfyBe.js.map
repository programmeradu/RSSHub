{"version":3,"file":"mp-CF2kfyBe.js","names":["route: Route","got"],"sources":["../../lib/routes/wechat/mp.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport dayjs from 'dayjs';\r\nimport { finishArticleItem } from '@/utils/wechat-mp';\r\n\r\nexport const route: Route = {\r\n    path: '/mp/homepage/:biz/:hid/:cid?',\r\n    categories: ['new-media'],\r\n    example: '/wechat/mp/homepage/MzA3MDM3NjE5NQ==/16',\r\n    parameters: { biz: '公众号id', hid: '分页id', cid: '页内栏目' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '公众号栏目 (非推送 & 历史消息)',\r\n    maintainers: ['MisteryMonster'],\r\n    handler,\r\n    description: `只适用拥有首页模板 (分享链接带有 homepage) 的公众号。例如从公众号分享出来的链接为 \\`https://mp.weixin.qq.com/mp/homepage?__biz=MzA3MDM3NjE5NQ==&hid=4\\`，\\`biz\\` 为 \\`MzA3MDM3NjE5NQ==\\`，\\`hid\\` 为 \\`4\\`。\r\n\r\n  有些页面里会有分栏， \\`cid\\` 可以通过元素选择器选中栏目查看\\`data-index\\`。如[链接](https://mp.weixin.qq.com/mp/homepage?__biz=MzA3MDM3NjE5NQ==\\&hid=4)里的 \\`京都职人\\` 栏目的 \\`cid\\` 为 \\`0\\`，\\`文艺时光\\` 栏目的 \\`cid\\` 为 \\`2\\`。如果不清楚的话最左边的栏目为\\`0\\`，其右方栏目依次递增 \\`1\\`。`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { biz, hid, cid } = ctx.req.param();\r\n    let cidurl = '';\r\n    if (cid) {\r\n        cidurl = `&cid=${cid}`;\r\n    }\r\n    let hidurl = '';\r\n    if (hid) {\r\n        hidurl = `&hid=${hid}`;\r\n    }\r\n    const JSONresponse = await got({\r\n        method: 'post',\r\n        url: `https://mp.weixin.qq.com/mp/homepage?__biz=${biz}${hidurl}${cidurl}&begin=0&count=5&action=appmsg_list`,\r\n    });\r\n    // 主页Html，获取 RSS 标题用\r\n    const HTMLresponse = await got({\r\n        method: 'get',\r\n        url: `https://mp.weixin.qq.com/mp/homepage?__biz=${biz}${hidurl}${cidurl}`,\r\n    });\r\n    const list = JSONresponse.data.appmsg_list;\r\n    const $ = load(HTMLresponse.data);\r\n    // 标题，另外差一个菜单标题！求助\r\n    const mptitle = $('div.articles_header').find('a').text() + `|` + $('div.articles_header > h2.rich_media_title').text();\r\n    const articledata = await Promise.all(\r\n        list.map((item) => {\r\n            const single = {\r\n                link: item.link,\r\n                guid: item.link,\r\n            };\r\n            return finishArticleItem(single);\r\n        })\r\n    );\r\n    return {\r\n        // 源标题，差一个cid相关的标题！\r\n        title: mptitle,\r\n        link: `https://mp.weixin.qq.com/mp/homepage?__biz=${biz}${hidurl}${cidurl}`,\r\n        item: list.map((item, index) => ({\r\n            title: item.title,\r\n            description: `\r\n                ${item.digest}<br>\r\n                <img\r\n                    style=\"max-width: 650px; height: auto; object-fit: contain; width: 100%;\"\r\n                    src=\"${item.cover}\"\r\n                ><br>\r\n                <br>\r\n                ${articledata[index].description}\r\n            `,\r\n            link: articledata[index].link,\r\n            guid: articledata[index].guid,\r\n            author: articledata[index].author,\r\n            pubDate: dayjs.unix(item.sendtime).format(),\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"6YAMA,MAAaA,EAAe,CACxB,KAAM,+BACN,WAAY,CAAC,aACb,QAAS,0CACT,WAAY,CAAE,IAAK,QAAS,IAAK,OAAQ,IAAK,QAC9C,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,qBACN,YAAa,CAAC,kBACd,UACA,YAAa,2WAKjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,MAAK,MAAK,OAAQ,EAAI,IAAI,QAC9B,EAAS,GACT,IACA,EAAS,QAAQ,KAErB,IAAI,EAAS,GACT,IACA,EAAS,QAAQ,KAErB,IAAM,EAAe,MAAMC,EAAI,CAC3B,OAAQ,OACR,IAAK,8CAA8C,IAAM,IAAS,EAAO,uCAGvE,EAAe,MAAMA,EAAI,CAC3B,OAAQ,MACR,IAAK,8CAA8C,IAAM,IAAS,MAEhE,EAAO,EAAa,KAAK,YACzB,EAAI,EAAK,EAAa,MAEtB,EAAU,EAAE,uBAAuB,KAAK,KAAK,OAAS,IAAM,EAAE,6CAA6C,OAC3G,EAAc,MAAM,QAAQ,IAC9B,EAAK,IAAK,GAAS,CACf,IAAM,EAAS,CACX,KAAM,EAAK,KACX,KAAM,EAAK,MAEf,OAAO,EAAkB,MAGjC,MAAO,CAEH,MAAO,EACP,KAAM,8CAA8C,IAAM,IAAS,IACnE,KAAM,EAAK,KAAK,EAAM,KAAW,CAC7B,MAAO,EAAK,MACZ,YAAa;kBACP,EAAK,OAAO;;;2BAGH,EAAK,MAAM;;;kBAGpB,EAAY,GAAO,YAAY;cAErC,KAAM,EAAY,GAAO,KACzB,KAAM,EAAY,GAAO,KACzB,OAAQ,EAAY,GAAO,OAC3B,QAAS,EAAM,KAAK,EAAK,UAAU"}