{"version":3,"file":"community-CCpZK_mY.js","names":[],"sources":["../../lib/routes/jiuyangongshe/community.ts"],"sourcesContent":["import { Data, Route, ViewType } from '@/types';\r\nimport type { Context } from 'hono';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport md5 from '@/utils/md5';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\n\r\ninterface User {\r\n    follow_type: number;\r\n    investment_style_id: null | string;\r\n    user_id: string;\r\n    nickname: string;\r\n    follow_status: number;\r\n    faction_id: string;\r\n    avatar: string;\r\n    medal_count: number;\r\n    style_str: null | string;\r\n}\r\n\r\ninterface Stock {\r\n    stock_id: string;\r\n    name: string;\r\n    code: string;\r\n}\r\n\r\ninterface ResultItem {\r\n    article_id: string;\r\n    is_top: number;\r\n    user_id: string;\r\n    is_like: number;\r\n    categoryIdSet: string[];\r\n    source_id: null | string;\r\n    title: string;\r\n    subtitle: string;\r\n    image: null | string;\r\n    cover: null | string;\r\n    url: null | string;\r\n    type: number;\r\n    read_limit: null | number;\r\n    comment_count: number;\r\n    collect_count: number;\r\n    like_count: number;\r\n    step_count: number;\r\n    forward_count: number;\r\n    integral: number;\r\n    is_user_top: number;\r\n    read_integral: number;\r\n    read_limit_time: null | string;\r\n    fans_limit: number;\r\n    copy_limit: number;\r\n    old_type: number;\r\n    hide: number;\r\n    create_time: string;\r\n    is_make_word_cloud: number;\r\n    sync_time: string;\r\n    is_flatter: number;\r\n    feature_img: null | string;\r\n    interest_disclosure: number;\r\n    new_interaction_time: string;\r\n    sensitive_words: null | string;\r\n    content: string;\r\n    user: User;\r\n    stock_list: Stock[];\r\n}\r\n\r\ninterface CommunityData {\r\n    pageNo: number;\r\n    pageSize: number;\r\n    orderBy: null | string;\r\n    order: null | string;\r\n    autoCount: boolean;\r\n    map: Record<string, unknown>;\r\n    params: string;\r\n    result: ResultItem[];\r\n    totalCount: number;\r\n    first: number;\r\n    totalPages: number;\r\n    hasNext: boolean;\r\n    nextPage: number;\r\n    hasPre: boolean;\r\n    prePage: number;\r\n}\r\n\r\ninterface Community {\r\n    msg: string;\r\n    data: CommunityData;\r\n    errCode: string;\r\n    serverTime: number;\r\n}\r\n\r\nconst render = (data) => art(path.join(__dirname, 'templates/community-description.art'), data);\r\n\r\nexport const route: Route = {\r\n    path: '/community',\r\n    categories: ['finance'],\r\n    view: ViewType.Articles,\r\n    example: '/jiuyangongshe/community',\r\n    maintainers: ['TonyRL'],\r\n    name: '社群',\r\n    handler,\r\n    radar: [\r\n        {\r\n            source: ['www.jiuyangongshe.com'],\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const link = `https://www.jiuyangongshe.com`;\r\n\r\n    const time = String(Date.now());\r\n    const response = await ofetch<Community>('https://app.jiuyangongshe.com/jystock-app/api/v2/article/community', {\r\n        method: 'POST',\r\n        headers: {\r\n            platform: '3',\r\n            timestamp: time,\r\n            token: md5(`Uu0KfOB8iUP69d3c:${time}`),\r\n        },\r\n        body: {\r\n            category_id: '',\r\n            limit: ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit') as string, 10) : 30,\r\n            order: 0,\r\n            start: 1,\r\n            type: 0,\r\n            back_garden: 0,\r\n        },\r\n    });\r\n\r\n    const items = response.data.result.map((item) => ({\r\n        title: item.title,\r\n        description: render({ cover: item.cover, content: item.content }),\r\n        link: `${link}/a/${item.article_id}`,\r\n        pubDate: timezone(parseDate(item.create_time, 'YYYY-MM-DD HH:mm:ss'), 8),\r\n        author: item.user.nickname,\r\n        category: item.stock_list.map((stock) => stock.name),\r\n    }));\r\n\r\n    return {\r\n        title: '社群 - 韭研公社-研究共享，茁壮成长（原韭菜公社）',\r\n        link,\r\n        language: 'zh-CN',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"ydA4FA,MAAM,EAAU,GAAS,EAAI,EAAA,KAAA,EAAA,gDAA6D,GAE7E,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,WACb,KAAM,EAAS,SACf,QAAS,2BACT,YAAa,CAAC,UACd,KAAM,KACN,UACA,MAAO,CACH,CACI,OAAQ,CAAC,4BAKrB,eAAe,EAAQ,EAA6B,CAChD,IAAM,EAAO,gCAEP,EAAO,OAAO,KAAK,OACnB,EAAW,MAAM,EAAkB,qEAAsE,CAC3G,OAAQ,OACR,QAAS,CACL,SAAU,IACV,UAAW,EACX,MAAO,EAAI,oBAAoB,MAEnC,KAAM,CACF,YAAa,GACb,MAAO,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAoB,IAAM,GACxF,MAAO,EACP,MAAO,EACP,KAAM,EACN,YAAa,KAIf,EAAQ,EAAS,KAAK,OAAO,IAAK,IAAU,CAC9C,MAAO,EAAK,MACZ,YAAa,EAAO,CAAE,MAAO,EAAK,MAAO,QAAS,EAAK,UACvD,KAAM,GAAG,EAAK,KAAK,EAAK,aACxB,QAAS,EAAS,EAAU,EAAK,YAAa,uBAAwB,GACtE,OAAQ,EAAK,KAAK,SAClB,SAAU,EAAK,WAAW,IAAK,GAAU,EAAM,SAGnD,MAAO,CACH,MAAO,6BACP,OACA,SAAU,QACV,KAAM"}