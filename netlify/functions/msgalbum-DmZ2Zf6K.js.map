{"version":3,"file":"msgalbum-DmZ2Zf6K.js","names":["route: Route","got"],"sources":["../../lib/routes/wechat/msgalbum.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport dayjs from 'dayjs';\r\nimport { finishArticleItem } from '@/utils/wechat-mp';\r\n\r\nexport const route: Route = {\r\n    path: '/mp/msgalbum/:biz/:aid',\r\n    categories: ['new-media'],\r\n    example: '/wechat/mp/msgalbum/MzA3MDM3NjE5NQ==/1375870284640911361',\r\n    parameters: { biz: '公众号id', aid: 'Tag id' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '公众号文章话题 Tag',\r\n    maintainers: ['MisteryMonster'],\r\n    handler,\r\n    description: `一些公众号（如看理想）会在微信文章里添加 Tag ，点入 Tag 的链接如 \\`https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA3MDM3NjE5NQ==&action=getalbum&album_id=1375870284640911361\\`，其中\\`biz\\` 为 \\`MzA3MDM3NjE5NQ==\\`，\\`aid\\` 为 \\`1375870284640911361\\`。`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { biz, aid } = ctx.req.param();\r\n    const aidurl = `&album_id=${aid}`;\r\n\r\n    const HTMLresponse = await got({\r\n        method: 'get',\r\n        url: `https://mp.weixin.qq.com/mp/appmsgalbum?__biz=${biz}&action=getalbum${aidurl}`,\r\n    });\r\n    const $ = load(HTMLresponse.data);\r\n    const list = $('li').toArray();\r\n    const mptitle = $('.album__author-name').text() + `|` + $('.album__label-title').text();\r\n    const articledata = await Promise.all(\r\n        list.map((item) => {\r\n            const link = $(item).attr('data-link').replace('http://', 'https://');\r\n            const title = $(item).attr('data-title');\r\n            const single = {\r\n                title,\r\n                link,\r\n                guid: link,\r\n            };\r\n            return finishArticleItem(single);\r\n        })\r\n    );\r\n    return {\r\n        title: mptitle,\r\n        link: `https://mp.weixin.qq.com/mp/appmsgalbum?__biz=${biz}&action=getalbum${aidurl}`,\r\n        item: list.map((item, index) => ({\r\n            title: articledata[index].title,\r\n            description: $(item).find('.album__item-img').html() + `<br><br>${articledata[index].description}`,\r\n            link: articledata[index].link,\r\n            guid: articledata[index].guid,\r\n            author: articledata[index].author,\r\n            pubDate: dayjs.unix($(item).find('.js_article_create_time').text()).format(),\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"6YAMA,MAAaA,EAAe,CACxB,KAAM,yBACN,WAAY,CAAC,aACb,QAAS,2DACT,WAAY,CAAE,IAAK,QAAS,IAAK,UACjC,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,cACN,YAAa,CAAC,kBACd,UACA,YAAa,mNAGjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,MAAK,OAAQ,EAAI,IAAI,QACvB,EAAS,aAAa,IAEtB,EAAe,MAAMC,EAAI,CAC3B,OAAQ,MACR,IAAK,iDAAiD,EAAI,kBAAkB,MAE1E,EAAI,EAAK,EAAa,MACtB,EAAO,EAAE,MAAM,UACf,EAAU,EAAE,uBAAuB,OAAS,IAAM,EAAE,uBAAuB,OAC3E,EAAc,MAAM,QAAQ,IAC9B,EAAK,IAAK,GAAS,CACf,IAAM,EAAO,EAAE,GAAM,KAAK,aAAa,QAAQ,UAAW,YACpD,EAAQ,EAAE,GAAM,KAAK,cACrB,EAAS,CACX,QACA,OACA,KAAM,GAEV,OAAO,EAAkB,MAGjC,MAAO,CACH,MAAO,EACP,KAAM,iDAAiD,EAAI,kBAAkB,IAC7E,KAAM,EAAK,KAAK,EAAM,KAAW,CAC7B,MAAO,EAAY,GAAO,MAC1B,YAAa,EAAE,GAAM,KAAK,oBAAoB,OAAS,WAAW,EAAY,GAAO,cACrF,KAAM,EAAY,GAAO,KACzB,KAAM,EAAY,GAAO,KACzB,OAAQ,EAAY,GAAO,OAC3B,QAAS,EAAM,KAAK,EAAE,GAAM,KAAK,2BAA2B,QAAQ"}