import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import s from"node:path";import{load as c}from"cheerio";t();const l={path:`/journal/:id/:category?`,categories:[`journal`],example:`/rsc/journal/ta`,parameters:{id:`Journal id, can be found in URL`,category:`Category, see below, All Recent Articles by default`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Journal`,maintainers:[`nczitzk`],handler:u,description:`::: tip
  All journals at [Current journals](https://pubs.rsc.org/en/journals)
:::

| All Recent Articles | Advance Articles |
| ------------------- | ---------------- |
| allrecentarticles   | advancearticles  |`};async function u(t){let{id:l,category:u=`allrecentarticles`}=t.req.param(),d=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):50,f=`https://pubs.rsc.org`,p=new URL(`en/journals/journalissues/${l}#!recentarticles`,f).href,m=new URL(`en/journals/getrecentarticles`,f).href,{data:h}=await a.post(m,{form:{name:l,pageno:1,iscontentavailable:!0,category:u}}),g=c(h);g(`div.capsule__article-image`).each(function(){g(this).replaceWith(r(s.join(e,`templates/image-0bcaa0e1.art`),{image:g(this).find(`img`).prop(`data-original`)}))});let _=g(`div.capsule--article`).slice(0,d).toArray().map(e=>{e=g(e);let t=e.find(`div.article__authors`).text().trim(),n=e.find(`div.text--small span a`).text().split(/org\//).pop(),r=!!e.find(`span.capsule__context img.ver-t`).prop(`alt`),a=!!e.find(`span.capsule__context span`).text(),s=new URL(e.find(`div.capsule__action--buttons a`).prop(`href`).split(`?`).pop(),f).href;return{title:e.find(`h3.capsule__title`).text(),link:new URL(e.find(`a.capsule__action`).prop(`href`),f).href,description:e.find(`div.capsule__column-wrapper`).html(),author:t,category:[e.find(`span.capsule__context`).text().trim(),...t.split(/,\s|and\s/),r||a],guid:`rsc-${n}`,pubDate:o(i(e.find(`div.text--small span.block`).text().split(/on\s/).pop(),`DD MMM YYYY`),1),enclosure_url:s,enclosure_type:s?`application/pdf`:void 0,doi:n}});_=await Promise.all(_.map(e=>n.tryGet(e.guid,async()=>{if(e.category.pop()){let{data:t}=await a(e.link.replace(/\/articlelanding\//,`/articlehtml/`)),n=c(t);n(`#pnlArticleAccess, #pnlArticleContent`).remove(),n(`div.abstract, div.article-abstract__heading`).prevAll().remove(),e.title=n(`meta[name="DC.title"]`).prop(`content`),e.description=n(`#wrapper, article.article-control`).html(),e.pubDate=o(i(n(`meta[name="citation_online_date"]`).prop(`content`),`YYYY/MM/DD`),1),e.enclosure_url=n(`meta[name="citation_pdf_url"]`).prop(`content`),e.enclosure_type=e.enclosure_url?`application/pdf`:void 0,e.doi=n(`meta[name="DC.Identifier"]`).prop(`content`)}return e})));let{data:v}=await a(p);g=c(v);let y=new URL(g(`link[rel="apple-touch-icon"]`).prop(`href`),f).href;return{item:_,title:g(`meta[name="citation_title"]`).prop(`content`),link:p,description:g(`meta[property="og:description"]`).prop(`content`),language:`en`,image:new URL(g(`div.page-head__cell--image span img`).prop(`src`),f).href,icon:y,logo:y,subtitle:g(`title`).text(),author:g(`meta[name="citation_journal_abbrev"]`).prop(`content`),allowEmpty:!0}}export{l as route};
//# sourceMappingURL=journal-CnknMV_7.js.map