{"version":3,"file":"search-BUqDEnVu.js","names":[],"sources":["../../lib/routes/notefolio/search.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\n\r\n// 导入所需模组\r\nimport got from '@/utils/got'; // 自订的 got\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport dayjs from 'dayjs';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\n\r\n// 分类\r\nconst categoryMap = [\r\n    {\r\n        keywords: 'video-motiongraphic',\r\n        category: 'portfolio.category.trevorbenitez',\r\n    },\r\n    {\r\n        keywords: 'graphic-design',\r\n        category: 'portfolio.category.lynnrogers',\r\n    },\r\n    {\r\n        keywords: 'branding-editorial',\r\n        category: 'portfolio.category.katiethompson',\r\n    },\r\n    {\r\n        keywords: 'UI-UX',\r\n        category: 'portfolio.category.brittneyhall',\r\n    },\r\n    {\r\n        keywords: 'illustration',\r\n        category: 'portfolio.category.margaretbullock',\r\n    },\r\n    {\r\n        keywords: 'digital-art',\r\n        category: 'portfolio.category.amandahoward',\r\n    },\r\n    {\r\n        keywords: 'character-design',\r\n        category: 'portfolio.category.rachelsharp',\r\n    },\r\n    {\r\n        keywords: 'product-package-design',\r\n        category: 'portfolio.category.vanessacohen',\r\n    },\r\n    {\r\n        keywords: 'photography',\r\n        category: 'portfolio.category.johnmurray',\r\n    },\r\n    {\r\n        keywords: 'typography',\r\n        category: 'portfolio.category.timothysmith',\r\n    },\r\n    {\r\n        keywords: 'crafts',\r\n        category: 'portfolio.category.jessicaking',\r\n    },\r\n    {\r\n        keywords: 'fine-art',\r\n        category: 'portfolio.category.johnmedina',\r\n    },\r\n];\r\n\r\n/**\r\n * @param category 分类\r\n * @param order 排序 [like, pick, published]\r\n * @param time 时间范围 ['one-day', 'week', 'month', 'three-month']\r\n * @param query 搜索词\r\n * @query limit 分页，默认20\r\n */\r\nexport const route: Route = {\r\n    path: '/search/:category?/:order?/:time?/:query?',\r\n    categories: ['design'],\r\n    view: ViewType.Pictures,\r\n    example: '/notefolio/search/1/pick/all/life',\r\n    parameters: {\r\n        category: {\r\n            description: 'Category, see below',\r\n            options: [\r\n                { value: 'all', label: 'All (전체)' },\r\n                { value: '1', label: 'Video / Motion Graphics (영상/모션그래픽)' },\r\n                { value: '2', label: 'Graphic Design (그래픽 디자인)' },\r\n                { value: '3', label: 'Branding / Editing (브랜딩/편집)' },\r\n                { value: '4', label: 'UI/UX (UI/UX)' },\r\n                { value: '5', label: 'Illustration (일러스트레이션)' },\r\n                { value: '6', label: 'Digital Art (디지털 아트)' },\r\n                { value: '7', label: 'Character Design (캐릭터 디자인)' },\r\n                { value: '8', label: 'Product Package Design (제품/패키지 디자인)' },\r\n                { value: '9', label: 'Photography (포토그래피)' },\r\n                { value: '10', label: 'Typography (타이포그래피)' },\r\n                { value: '11', label: 'Crafts (공예)' },\r\n                { value: '12', label: 'Fine Art (파인아트)' },\r\n            ],\r\n            default: 'all',\r\n        },\r\n        order: {\r\n            description: 'Order, `pick` as Notefolio Pick, `published` as Newest, `like` as like, `pick` by default',\r\n            options: [\r\n                { value: 'pick', label: 'Notefolio Pick' },\r\n                { value: 'published', label: 'Newest' },\r\n                { value: 'like', label: 'Like' },\r\n            ],\r\n            default: 'pick',\r\n        },\r\n        time: {\r\n            description: 'Time',\r\n            options: [\r\n                { value: 'all', label: 'All the time' },\r\n                { value: 'one-day', label: 'Latest 24 hours' },\r\n                { value: 'week', label: 'Latest week' },\r\n                { value: 'month', label: 'Latest month' },\r\n                { value: 'three-month', label: 'Latest 3 months' },\r\n            ],\r\n            default: 'all',\r\n        },\r\n        query: 'Keyword, empty by default',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['notefolio.net/search'],\r\n        },\r\n    ],\r\n    name: 'Works',\r\n    maintainers: ['BianTan'],\r\n    handler,\r\n    url: 'notefolio.net/search',\r\n    description: `| Category | Name in Korean     | Name in English         |\r\n| -------- | ------------------ | ----------------------- |\r\n| all      | 전체               | All                     |\r\n| 1        | 영상/모션그래픽    | Video / Motion Graphics |\r\n| 2        | 그래픽 디자인      | Graphic Design          |\r\n| 3        | 브랜딩/편집        | Branding / Editing      |\r\n| 4        | UI/UX              | UI/UX                   |\r\n| 5        | 일러스트레이션     | Illustration            |\r\n| 6        | 디지털 아트        | Digital Art             |\r\n| 7        | 캐릭터 디자인      | Character Design        |\r\n| 8        | 제품/패키지 디자인 | Product Package Design  |\r\n| 9        | 포토그래피         | Photography             |\r\n| 10       | 타이포그래피       | Typography              |\r\n| 11       | 공예               | Crafts                  |\r\n| 12       | 파인아트           | Fine Art                |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    // 分类、排序、时间范围、搜索词\r\n    const { category = 'all', order = 'pick', time = 'all', query = '' } = ctx.req.param();\r\n    //  分页\r\n    const { limit } = ctx.req.query();\r\n\r\n    // 请求链接\r\n    let searchUrl = `https://api.stunning.kr/api/v1/dantats/portfolio?state=Public&limit=${limit ? Number.parseInt(limit, 10) : 20}&search=${query}&orderBy=${order}`;\r\n    // 分类\r\n    const index = (Number(category) || 0) - 1;\r\n    if (index >= 0 && categoryMap[index]) {\r\n        searchUrl += `&category=${categoryMap[index].category}`;\r\n    }\r\n    // 时间范围\r\n    if (time !== 'all' && ['one-day', 'week', 'month', 'three-month'].includes(time)) {\r\n        let startTime = '';\r\n        const endTime = dayjs().endOf('d').format('YYYY-MM-DDTHH:mm:ss.SSS');\r\n\r\n        // 过去24小时-day 最近一周-week 最近一个月-month 最近三个月three-month\r\n        switch (time) {\r\n            case 'one-day':\r\n                startTime = dayjs().subtract(1, 'd').format('YYYY-MM-DDTHH:mm:ss.SSS');\r\n                break;\r\n\r\n            case 'week':\r\n                startTime = dayjs().subtract(7, 'd').startOf('d').format('YYYY-MM-DDTHH:mm:ss.SSS');\r\n                break;\r\n\r\n            case 'month':\r\n                startTime = dayjs().subtract(30, 'd').startOf('d').format('YYYY-MM-DDTHH:mm:ss.SSS');\r\n                break;\r\n\r\n            case 'three-month':\r\n                startTime = dayjs().subtract(90, 'd').startOf('d').format('YYYY-MM-DDTHH:mm:ss.SSS');\r\n                break;\r\n        }\r\n        searchUrl += `&publishedAt=${startTime}Z&publishedAt=${endTime}Z`;\r\n    }\r\n\r\n    // 发送 HTTP GET 请求到 API 并解构返回的数据对象\r\n    const { data } = await got(searchUrl, {\r\n        headers: {\r\n            Origin: 'https://notefolio.net',\r\n        },\r\n    });\r\n\r\n    // 从 API 响应中提取相关数据\r\n    const items =\r\n        data?.resultData.map((item) => {\r\n            const { id, title, user, createdAt, categories = [], contents = [] } = item;\r\n\r\n            const description = contents.map((item) => art(path.join(__dirname, './templates/search.art'), { item })).join(' ');\r\n\r\n            return {\r\n                // 文章标题\r\n                title,\r\n                // 文章链接\r\n                link: `https://notefolio.net/${user.url}/${id}`,\r\n                // 文章正文\r\n                description,\r\n                // 文章发布日期\r\n                pubDate: parseDate(createdAt),\r\n                // 如果有的话，文章作者\r\n                author: user.nick,\r\n                // 如果有的话，文章分类\r\n                category: categories.map((label) => label.replace('portfolio.category.', '')),\r\n            };\r\n        }) || [];\r\n\r\n    return {\r\n        // 源标题\r\n        title: `${category}/${order}/${time}/${query} search`,\r\n        // 源链接\r\n        // link: '',\r\n        // 源文章\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"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"}