{"version":3,"file":"daily-wallpaper-DHbe0xPz.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/bing/daily-wallpaper.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/:routeParams?',\r\n    parameters: {\r\n        routeParams: '额外参数type,story和lang:请参阅以下说明和表格',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.bing.com/'],\r\n            target: '',\r\n        },\r\n        {\r\n            source: ['cn.bing.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: '每日壁纸',\r\n    maintainers: ['FHYunCai', 'LLLLLFish'],\r\n    handler,\r\n    url: 'www.bing.com/',\r\n    example: '/bing/type=UHD&story=1&lang=zh-CN',\r\n    description: `| 参数    | 含义                 | 接受的值                                                      | 默认值       | 备注                                                     |\r\n|-------|--------------------|-----------------------------------------------------------|-----------|--------------------------------------------------------|\r\n| type  | 输出壁纸的像素类型          | UHD/1920x1080/1920x1200/768x1366/1080x1920/1080x1920_logo | 1920x1080 | 1920x1200与1080x1920_logo带有水印,输入的值不在接受范围内都会输出成1920x1080 |\r\n| story | 是否输出壁纸的故事          | 1/0                                                       | 0         | 输入的值不为1都不会输出故事                                         |\r\n| lang  | 输出壁纸图文的地区(中文或者是英文) | zh/en                                               | zh     | zh/en输出的壁纸图文不一定是一样的;如果en不生效,试着部署到其他地方               |\r\n`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const routeParams = new URLSearchParams(ctx.req.param('routeParams'));\r\n    let type = routeParams.get('type') || '1920x1080';\r\n    let lang = routeParams.get('lang');\r\n    let apiUrl = '';\r\n    const allowedTypes = ['UHD', '1920x1080', '1920x1200', '768x1366', '1080x1920', '1080x1920_logo'];\r\n    if (lang !== 'zh' && lang !== 'en') {\r\n        lang = 'zh';\r\n    }\r\n    if (lang === 'zh') {\r\n        lang = 'zh-CN';\r\n        apiUrl = 'https://cn.bing.com';\r\n    } else {\r\n        lang = 'en-US';\r\n        apiUrl = 'https://www.bing.com';\r\n    }\r\n    if (!allowedTypes.includes(type)) {\r\n        type = '1920x1080';\r\n    }\r\n    const story = routeParams.get('story') === '1';\r\n    const resp = await ofetch('/hp/api/model', {\r\n        baseURL: apiUrl,\r\n        method: 'GET',\r\n        query: {\r\n            mtk: lang,\r\n        },\r\n    });\r\n    const items = resp.MediaContents.map((item) => {\r\n        const ssd = item.Ssd;\r\n        const link = `${apiUrl}${item.ImageContent.Image.Url.match(/\\/th\\?id=[^_]+_[^_]+/)[0].replace(/(_\\d+x\\d+\\.webp)$/i, '')}_${type}.jpg`;\r\n        let description = `<img width=\"1920\" height=\"1080\" src=\"${link}\" alt=\"Article Cover Image\" style=\"display: block; margin: 0 auto;\"><br>`;\r\n        if (story) {\r\n            description += `<b>${item.ImageContent.Headline}</b>`;\r\n            description += `<i>${item.ImageContent.QuickFact.MainText}</i><br>`;\r\n            description += `<p>${item.ImageContent.Description}<p>`;\r\n        }\r\n        return {\r\n            title: item.ImageContent.Title,\r\n            description,\r\n            link: `${apiUrl}${item.ImageContent.BackstageUrl}`,\r\n            author: item.ImageContent.Copyright,\r\n            pubDate: timezone(parseDate(ssd, 'YYYYMMDD_HHmm'), 0),\r\n        };\r\n    });\r\n    return {\r\n        title: 'Bing每日壁纸',\r\n        link: apiUrl,\r\n        description: 'Bing每日壁纸',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"kRAKA,MAAaA,EAAe,CACxB,KAAM,iBACN,WAAY,CACR,YAAa,kCAEjB,MAAO,CACH,CACI,OAAQ,CAAC,iBACT,OAAQ,IAEZ,CACI,OAAQ,CAAC,gBACT,OAAQ,KAGhB,KAAM,OACN,YAAa,CAAC,WAAY,aAC1B,UACA,IAAK,gBACL,QAAS,oCACT,YAAa;;;;;GAQjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAc,IAAI,gBAAgB,EAAI,IAAI,MAAM,gBAClD,EAAO,EAAY,IAAI,SAAW,YAClC,EAAO,EAAY,IAAI,QACvB,EAAS,GACP,EAAe,CAAC,MAAO,YAAa,YAAa,WAAY,YAAa,kBAC5E,IAAS,MAAQ,IAAS,OAC1B,EAAO,MAEP,IAAS,MACT,EAAO,QACP,EAAS,wBAET,EAAO,QACP,EAAS,wBAER,EAAa,SAAS,KACvB,EAAO,aAEX,IAAM,EAAQ,EAAY,IAAI,WAAa,IACrC,EAAO,MAAMC,EAAO,gBAAiB,CACvC,QAAS,EACT,OAAQ,MACR,MAAO,CACH,IAAK,KAGP,EAAQ,EAAK,cAAc,IAAK,GAAS,CAC3C,IAAM,EAAM,EAAK,IACX,EAAO,GAAG,IAAS,EAAK,aAAa,MAAM,IAAI,MAAM,wBAAwB,GAAG,QAAQ,qBAAsB,IAAI,GAAG,EAAK,MAC5H,EAAc,wCAAwC,EAAK,0EAM/D,OALI,IACA,GAAe,MAAM,EAAK,aAAa,SAAS,MAChD,GAAe,MAAM,EAAK,aAAa,UAAU,SAAS,UAC1D,GAAe,MAAM,EAAK,aAAa,YAAY,MAEhD,CACH,MAAO,EAAK,aAAa,MACzB,cACA,KAAM,GAAG,IAAS,EAAK,aAAa,eACpC,OAAQ,EAAK,aAAa,UAC1B,QAAS,EAAS,EAAU,EAAK,iBAAkB,MAG3D,MAAO,CACH,MAAO,WACP,KAAM,EACN,YAAa,WACb,KAAM"}