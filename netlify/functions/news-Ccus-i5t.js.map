{"version":3,"file":"news-Ccus-i5t.js","names":[],"sources":["../../lib/routes/i-cable/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\nimport { config } from '@/config';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:category?',\r\n    categories: ['traditional-media'],\r\n    example: '/i-cable/news',\r\n    parameters: { category: '分類，默認為新聞資訊' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.i-cable.com'],\r\n            target: '/news',\r\n        },\r\n        {\r\n            source: ['www.i-cable.com/category/:category'],\r\n            target: '/news/:category',\r\n        },\r\n    ],\r\n    name: '新聞',\r\n    maintainers: ['quiniapiezoelectricity'],\r\n    handler,\r\n    url: 'www.i-cable.com/',\r\n    description: `\r\n::: tip\r\n分類只可用分類名稱，如：新聞資訊/港聞\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? '新聞資訊';\r\n    const limit = ctx.req.query('limit') ?? 20;\r\n    const root = 'https://www.i-cable.com/wp-json/wp/v2';\r\n\r\n    const response = await cache.tryGet(`${root}/categories?slug=${category}`, async () => await got(`${root}/categories?slug=${category}`), config.cache.routeExpire, false);\r\n    if (response.data.length < 1) {\r\n        throw new InvalidParameterError(`Invalid Category: ${category}`);\r\n    }\r\n    const metadata = response.data[0];\r\n\r\n    const list = await got(`${root}/posts?_embed=1&categories=${metadata.id}&per_page=${limit}`);\r\n    const items = list.data.map((item) => {\r\n        const description = art(path.join(__dirname, 'templates/description.art'), {\r\n            media: item._embedded['wp:featuredmedia'] ?? [],\r\n            content: item.content.rendered,\r\n        });\r\n        return {\r\n            title: item.title.rendered,\r\n            link: item.link,\r\n            pubDate: item.date_gmt,\r\n            description,\r\n            category: item._embedded['wp:term'][0].map((term) => term.name) ?? [],\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: `有線新聞 - ${metadata.name}`,\r\n        description: metadata.description,\r\n        link: metadata.link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"ieAQA,MAAa,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,qBACb,QAAS,gBACT,WAAY,CAAE,SAAU,cACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,mBACT,OAAQ,SAEZ,CACI,OAAQ,CAAC,sCACT,OAAQ,oBAGhB,KAAM,KACN,YAAa,CAAC,0BACd,UACA,IAAK,mBACL,YAAa;;;MAMjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,OACxC,EAAQ,EAAI,IAAI,MAAM,UAAY,GAClC,EAAO,wCAEP,EAAW,MAAM,EAAM,OAAO,GAAG,EAAK,mBAAmB,IAAY,SAAY,MAAM,EAAI,GAAG,EAAK,mBAAmB,KAAa,EAAO,MAAM,YAAa,IACnK,GAAI,EAAS,KAAK,OAAS,EACvB,MAAM,IAAI,EAAsB,qBAAqB,KAEzD,IAAM,EAAW,EAAS,KAAK,GAEzB,EAAO,MAAM,EAAI,GAAG,EAAK,6BAA6B,EAAS,GAAG,YAAY,KAC9E,EAAQ,EAAK,KAAK,IAAK,GAAS,CAClC,IAAM,EAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACvE,MAAO,EAAK,UAAU,qBAAuB,GAC7C,QAAS,EAAK,QAAQ,WAE1B,MAAO,CACH,MAAO,EAAK,MAAM,SAClB,KAAM,EAAK,KACX,QAAS,EAAK,SACd,cACA,SAAU,EAAK,UAAU,WAAW,GAAG,IAAK,GAAS,EAAK,OAAS,MAI3E,MAAO,CACH,MAAO,UAAU,EAAS,OAC1B,YAAa,EAAS,YACtB,KAAM,EAAS,KACf,KAAM"}