import{parseDate as e}from"./parse-date-Bgabdhlb.js";import{ofetch_default as t}from"./ofetch-Bzt0BXUH.js";import{X_UA as n,appDetail as r,getRootUrl as i}from"./utils-DGqNB3hk.js";const a=(e,t)=>e?t===`helpful`||t===`recent`?`type=${t}`:`type=helpful`:t===`new`||t===`hot`?`sort=${t}`:`sort=hot`,o=async r=>{let o=r.id,s=r.order??`hot`,c=r.lang??`zh_CN`,l=`${i(!1)}/webapiv2/review/v2/list-by-app?app_id=${o}&limit=10`;l+=`&${a(!1,s)}`,l+=`&${n(c)}`;let u=await t(l);return u.data.list.map(t=>{let n=t.moment.author.user.name,r=t.moment.review.score;return{title:`${n} - ${r}星`,author:n,description:t.moment.review.contents.text+(t.moment.review.contents.images?t.moment.review.contents.images.map(e=>`<img src="${e.original_url}">`).join(``):``),link:`${i(!1)}/review/${t.moment.review.id}`,pubDate:e(t.moment.publish_time,`X`)}})},s=async r=>{let o=r.id,s=r.order??`helpful`,c=r.lang??`en_US`,l=`${i(!0)}/webapiv2/feeds/v3/by-app?app_id=${o}&limit=10`;l+=`&${a(!0,s)}`,l+=`&${n(c)}`;let u=await t(l);return u.data.list.map(t=>{let n=t.post.user.name,r=t.post.list_fields.app_ratings[o].score;return{title:`${n} - ${`★`.repeat(r)}`,author:n,description:t.post.list_fields.summary||t.post.list_fields.title,link:`${i(!0)}/post/${t.post.id_str}`,pubDate:e(t.post.published_time,`X`)}})};async function c(e){let t=e.req.path.replace(`/taptap`,``),n=t.startsWith(`/intl/`),c=e.req.param(`id`),l=e.req.param(`order`)??`default`,u=e.req.param(`lang`)??(n?`en_US`:`zh_CN`),d=await r(c,u,n),f=d.app.icon.original_url,p=d.app.title,m=n?await s({id:c,order:l,lang:u}):await o({id:c,order:l,lang:u});return{title:`TapTap 评价 ${p}`,link:`${i(n)}/app/${c}/review?${a(n,l)}`,image:f,item:m}}export{c as handler};
//# sourceMappingURL=review-DiSwGKVN.js.map