{"version":3,"file":"research-Cjt5qKUE.js","names":["limit: number","baseUrl: string","targetUrl: string","ofetch","$: CheerioAPI","items: DataItem[]","$el: Cheerio<Element>","$aEl: Cheerio<Element>","title: string","pubDateStr: string | undefined","linkUrl: string | undefined","categoryEls: Element[]","categories: string[]","el","image: string | undefined","upDatedStr: string | undefined","processedItem: DataItem","enclosureUrl: string | undefined","author: string","route: Route","urlObj: URL","type: string | undefined"],"sources":["../../lib/routes/lhratings/research.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { type CheerioAPI, type Cheerio, load } from 'cheerio';\r\nimport type { Element } from 'domhandler';\r\nimport { type Context } from 'hono';\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const { type = '1' } = ctx.req.param();\r\n    const limit: number = Number.parseInt(ctx.req.query('limit') ?? '20', 10);\r\n\r\n    const baseUrl: string = 'https://www.lhratings.com';\r\n    const targetUrl: string = new URL(`research.html?type=${type}`, baseUrl).href;\r\n\r\n    const response = await ofetch(targetUrl);\r\n    const $: CheerioAPI = load(response);\r\n    const language = $('html').attr('lang') ?? 'zh-CN';\r\n\r\n    const items: DataItem[] = $('table.list-table tbody tr')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((el): Element => {\r\n            const $el: Cheerio<Element> = $(el);\r\n            const $aEl: Cheerio<Element> = $el.find('a').first();\r\n\r\n            const title: string = $aEl.text();\r\n            const pubDateStr: string | undefined = $aEl.parent().next().next().text();\r\n            const linkUrl: string | undefined = $aEl.attr('href');\r\n            const categoryEls: Element[] = [$aEl.parent().next()].filter(Boolean);\r\n            const categories: string[] = [...new Set(categoryEls.map((el) => $(el).text()).filter(Boolean))];\r\n            const image: string | undefined = $el.find('img').attr('src');\r\n            const upDatedStr: string | undefined = pubDateStr;\r\n\r\n            let processedItem: DataItem = {\r\n                title,\r\n                pubDate: pubDateStr ? parseDate(pubDateStr) : undefined,\r\n                link: linkUrl,\r\n                category: categories,\r\n                image,\r\n                banner: image,\r\n                updated: upDatedStr ? parseDate(upDatedStr) : undefined,\r\n                language,\r\n            };\r\n\r\n            const enclosureUrl: string | undefined = linkUrl;\r\n\r\n            if (enclosureUrl) {\r\n                processedItem = {\r\n                    ...processedItem,\r\n                    enclosure_url: enclosureUrl,\r\n                    enclosure_type: `application/${enclosureUrl.split(/\\./).pop()}`,\r\n                    enclosure_title: title,\r\n                };\r\n            }\r\n\r\n            return processedItem;\r\n        });\r\n\r\n    const author: string = $('title').text();\r\n\r\n    return {\r\n        title: `${author} - ${$('li.active').text()}`,\r\n        description: $('li.active').text(),\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: $('a#logo img').attr('src'),\r\n        author,\r\n        language,\r\n        id: targetUrl,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/research/:type?',\r\n    name: '研究报告',\r\n    url: 'www.lhratings.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/lhratings/research/1',\r\n    parameters: {\r\n        type: '分类，默认为 `1`，即宏观经济，可在对应分类页 URL 中找到',\r\n    },\r\n    description: `:::tip\r\n若订阅 [宏观经济](https://www.lhratings.com/research.html?type=1)，网址为 \\`https://www.lhratings.com/research.html?type=1\\`，请截取 \\`https://www.lhratings.com/research.html?type=\\` 到末尾的部分 \\`1\\` 作为 \\`type\\` 参数填入，此时目标路由为 [\\`/lhratings/research/1\\`](https://rsshub.app/lhratings/research/1)。\r\n:::\r\n\r\n| 宏观经济 | 债券市场 | 行业研究 | 评级理论与方法 | 国际债券市场与评级 | 评级表现 |\r\n| -------- | -------- | -------- | -------------- | ------------------ | -------- |\r\n| 1        | 2        | 3        | 4              | 5                  | 6        |\r\n`,\r\n    categories: ['finance'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.lhratings.com/research.html'],\r\n            target: (_, url) => {\r\n                const urlObj: URL = new URL(url);\r\n                const type: string | undefined = urlObj.searchParams.get('type') ?? undefined;\r\n\r\n                return `/lhratings/research/${type ? `/${type}` : ''}`;\r\n            },\r\n        },\r\n        {\r\n            title: '宏观经济',\r\n            source: ['www.lhratings.com/research.html?type=1'],\r\n            target: '/research/1',\r\n        },\r\n        {\r\n            title: '债券市场',\r\n            source: ['www.lhratings.com/research.html?type=2'],\r\n            target: '/research/2',\r\n        },\r\n        {\r\n            title: '行业研究',\r\n            source: ['www.lhratings.com/research.html?type=3'],\r\n            target: '/research/3',\r\n        },\r\n        {\r\n            title: '评级理论与方法',\r\n            source: ['www.lhratings.com/research.html?type=4'],\r\n            target: '/research/4',\r\n        },\r\n        {\r\n            title: '国际债券市场与评级',\r\n            source: ['www.lhratings.com/research.html?type=5'],\r\n            target: '/research/5',\r\n        },\r\n        {\r\n            title: '评级表现',\r\n            source: ['www.lhratings.com/research.html?type=6'],\r\n            target: '/research/6',\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n};\r\n"],"mappings":"8SASA,MAAa,EAAU,KAAO,IAAgC,CAC1D,GAAM,CAAE,OAAO,KAAQ,EAAI,IAAI,QACzBA,EAAgB,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IAGhEE,EAAoB,IAAI,IAAI,sBAAsB,IAAQ,6BAAS,KAEnE,EAAW,MAAMC,EAAO,GACxBC,EAAgB,EAAK,GACrB,EAAW,EAAE,QAAQ,KAAK,SAAW,QAErCC,EAAoB,EAAE,6BACvB,MAAM,EAAG,GACT,UACA,IAAK,GAAgB,CAClB,IAAMC,EAAwB,EAAE,GAC1BC,EAAyB,EAAI,KAAK,KAAK,QAEvCC,EAAgB,EAAK,OACrBC,EAAiC,EAAK,SAAS,OAAO,OAAO,OAC7DC,EAA8B,EAAK,KAAK,QACxCC,EAAyB,CAAC,EAAK,SAAS,QAAQ,OAAO,SACvDC,EAAuB,CAAC,GAAG,IAAI,IAAI,EAAY,IAAK,GAAO,EAAEC,GAAI,QAAQ,OAAO,WAChFC,EAA4B,EAAI,KAAK,OAAO,KAAK,OACjDC,EAAiC,EAEnCC,EAA0B,CAC1B,QACA,QAAS,EAAa,EAAU,GAAc,IAAA,GAC9C,KAAM,EACN,SAAU,EACV,QACA,OAAQ,EACR,QAAS,EAAa,EAAU,GAAc,IAAA,GAC9C,YAGEC,EAAmC,EAWzC,OATI,IACA,EAAgB,CACZ,GAAG,EACH,cAAe,EACf,eAAgB,eAAe,EAAa,MAAM,MAAM,QACxD,gBAAiB,IAIlB,IAGTC,EAAiB,EAAE,SAAS,OAElC,MAAO,CACH,MAAO,GAAG,EAAO,KAAK,EAAE,aAAa,SACrC,YAAa,EAAE,aAAa,OAC5B,KAAM,EACN,KAAM,EACN,WAAY,GACZ,MAAO,EAAE,cAAc,KAAK,OAC5B,SACA,WACA,GAAI,IAICC,EAAe,CACxB,KAAM,mBACN,KAAM,OACN,IAAK,oBACL,YAAa,CAAC,WACd,UACA,QAAS,wBACT,WAAY,CACR,KAAM,oCAEV,YAAa,4fAQb,WAAY,CAAC,WACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,mCACT,QAAS,EAAG,IAAQ,CAChB,IAAMC,EAAc,IAAI,IAAI,GACtBC,EAA2B,EAAO,aAAa,IAAI,SAAW,IAAA,GAEpE,MAAO,uBAAuB,EAAO,IAAI,IAAS,OAG1D,CACI,MAAO,OACP,OAAQ,CAAC,0CACT,OAAQ,eAEZ,CACI,MAAO,OACP,OAAQ,CAAC,0CACT,OAAQ,eAEZ,CACI,MAAO,OACP,OAAQ,CAAC,0CACT,OAAQ,eAEZ,CACI,MAAO,UACP,OAAQ,CAAC,0CACT,OAAQ,eAEZ,CACI,MAAO,YACP,OAAQ,CAAC,0CACT,OAAQ,eAEZ,CACI,MAAO,OACP,OAAQ,CAAC,0CACT,OAAQ,gBAGhB,KAAM,EAAS"}