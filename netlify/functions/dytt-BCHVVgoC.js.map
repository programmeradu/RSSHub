{"version":3,"file":"dytt-BCHVVgoC.js","names":["domain: string","baseUrl: string","limit: number","targetUrl: string","ofetch","$: CheerioAPI","items: DataItem[]","$el: Cheerio<Element>","$aEl: Cheerio<Element>","title: string","description: string","pubDateStr: string | undefined","linkUrl: string | undefined","upDatedStr: string | undefined","processedItem: DataItem","cache","$$: CheerioAPI","$descriptionEl: Cheerio<Element>","image: string | undefined","$enclosureEl: Cheerio<Element>","enclosureUrl: string | undefined","enclosureType: string","enclosureTitle: string","title","route: Route","category: string"],"sources":["../../lib/routes/dytt/index.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport iconv from 'iconv-lite';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nimport { type CheerioAPI, type Cheerio, load } from 'cheerio';\r\nimport type { Element } from 'domhandler';\r\nimport { type Context } from 'hono';\r\n\r\nconst domain: string = 'www.dydytt.net';\r\nconst baseUrl: string = `https://${domain}`;\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const { category = 'gndy/dyzz' } = ctx.req.param();\r\n    const limit: number = Number.parseInt(ctx.req.query('limit') ?? '25', 10);\r\n\r\n    const targetUrl: string = new URL(`html/${category.replace(/^html\\//, '')}`, baseUrl).href;\r\n\r\n    const response = await ofetch(targetUrl, {\r\n        responseType: 'arrayBuffer',\r\n    });\r\n    const $: CheerioAPI = load(iconv.decode(Buffer.from(response), 'gb2312'));\r\n    const language = $('html').attr('lang') ?? 'zh-CN';\r\n\r\n    let items: DataItem[] = [];\r\n\r\n    items = $('div.co_content8 ul table')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((el): Element => {\r\n            const $el: Cheerio<Element> = $(el);\r\n\r\n            const $aEl: Cheerio<Element> = $el.find('a.ulink');\r\n\r\n            const title: string = $aEl.text();\r\n            const description: string = $el.find('td').last().text();\r\n            const pubDateStr: string | undefined = $el.find('font').last().text().split(/：/).pop();\r\n            const linkUrl: string | undefined = $aEl.attr('href');\r\n            const upDatedStr: string | undefined = pubDateStr;\r\n\r\n            const processedItem: DataItem = {\r\n                title,\r\n                description,\r\n                pubDate: pubDateStr ? timezone(parseDate(pubDateStr), +8) : undefined,\r\n                link: linkUrl ? new URL(linkUrl, baseUrl).href : undefined,\r\n                doi: $el.find('meta[name=\"citation_doi\"]').attr('content'),\r\n                content: {\r\n                    html: description,\r\n                    text: description,\r\n                },\r\n                updated: upDatedStr ? timezone(parseDate(upDatedStr), +8) : undefined,\r\n                language,\r\n            };\r\n\r\n            return processedItem;\r\n        });\r\n\r\n    items = (\r\n        await Promise.all(\r\n            items.map((item) => {\r\n                if (!item.link) {\r\n                    return item;\r\n                }\r\n\r\n                return cache.tryGet(item.link, async (): Promise<DataItem> => {\r\n                    const detailResponse = await ofetch(item.link, {\r\n                        responseType: 'arrayBuffer',\r\n                    });\r\n                    const $$: CheerioAPI = load(iconv.decode(Buffer.from(detailResponse), 'gb2312'));\r\n\r\n                    const title: string = $$('div.title_all h1 font').text();\r\n\r\n                    const $descriptionEl: Cheerio<Element> = $$('div#Zoom span').first();\r\n                    const childEls = $descriptionEl.contents().toArray();\r\n                    const centerIdx = childEls.findIndex((node) => node.type === 'tag' && node.name === 'center');\r\n                    const description: string = (centerIdx === -1 ? childEls : childEls.slice(0, centerIdx)).map((node) => $.html(node)).join('');\r\n\r\n                    const pubDateStr: string | undefined = item.pubDate ? undefined : $descriptionEl.prev().text().split(/：/).pop();\r\n                    const image: string | undefined = $descriptionEl.find('img').first().attr('src');\r\n                    const upDatedStr: string | undefined = pubDateStr;\r\n\r\n                    let processedItem: DataItem = {\r\n                        title,\r\n                        description,\r\n                        pubDate: pubDateStr ? parseDate(pubDateStr) : item.pubDate,\r\n                        content: {\r\n                            html: description,\r\n                            text: description,\r\n                        },\r\n                        image,\r\n                        banner: image,\r\n                        updated: upDatedStr ? parseDate(upDatedStr) : item.updated,\r\n                        language,\r\n                    };\r\n\r\n                    const $enclosureEl: Cheerio<Element> = $descriptionEl.find('a[href^=\"magnet:\"]').last();\r\n                    const enclosureUrl: string | undefined = $enclosureEl.attr('href');\r\n\r\n                    if (enclosureUrl) {\r\n                        const enclosureType: string = 'application/x-bittorrent';\r\n                        const enclosureTitle: string = $enclosureEl.text();\r\n\r\n                        processedItem = {\r\n                            ...processedItem,\r\n                            enclosure_url: enclosureUrl,\r\n                            enclosure_type: enclosureType,\r\n                            enclosure_title: enclosureTitle || title,\r\n                            enclosure_length: undefined,\r\n                            itunes_duration: undefined,\r\n                            itunes_item_image: image,\r\n                        };\r\n                    }\r\n\r\n                    return {\r\n                        ...item,\r\n                        ...processedItem,\r\n                    };\r\n                });\r\n            })\r\n        )\r\n    ).filter((_): _ is DataItem => true);\r\n\r\n    const title: string = $('title').text();\r\n\r\n    return {\r\n        title,\r\n        description: $('META[name=description]').attr('content'),\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: new URL('images/logo.gif', baseUrl).href,\r\n        author: title.split(/_/).pop(),\r\n        language,\r\n        id: targetUrl,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category{.+}?',\r\n    name: '分类',\r\n    url: domain,\r\n    maintainers: ['junfengP', 'nczitzk'],\r\n    handler,\r\n    example: '/dytt/gndy/dyzz',\r\n    parameters: {\r\n        category: {\r\n            description: '分类，默认为 `gndy/dyzz`，即最新影片，可在对应分类页 URL 中找到',\r\n            options: [\r\n                {\r\n                    label: '最新影片',\r\n                    value: 'gndy/dyzz',\r\n                },\r\n                {\r\n                    label: '经典影片',\r\n                    value: 'gndy',\r\n                },\r\n                {\r\n                    label: '国内电影',\r\n                    value: 'gndy/china',\r\n                },\r\n                {\r\n                    label: '欧美电影',\r\n                    value: 'gndy/oumei',\r\n                },\r\n                {\r\n                    label: '其它电影',\r\n                    value: 'gndy/rihan',\r\n                },\r\n                {\r\n                    label: '华语电视',\r\n                    value: 'tv/hytv',\r\n                },\r\n                {\r\n                    label: '欧美电视',\r\n                    value: 'tv/oumeitv',\r\n                },\r\n                {\r\n                    label: '最新综艺',\r\n                    value: 'zongyi2013',\r\n                },\r\n                {\r\n                    label: '旧版综艺',\r\n                    value: '2009zongyi',\r\n                },\r\n                {\r\n                    label: '动漫资源',\r\n                    value: 'dongman',\r\n                },\r\n                {\r\n                    label: '旧版游戏',\r\n                    value: 'game',\r\n                },\r\n                {\r\n                    label: '游戏下载',\r\n                    value: 'newgame',\r\n                },\r\n                {\r\n                    label: '日韩剧集专区',\r\n                    value: 'tv/rihantv',\r\n                },\r\n            ],\r\n        },\r\n    },\r\n    description: `:::tip\r\n若订阅 [最新影片](${baseUrl}/html/gndy/dyzz)，网址为 \\`${baseUrl}/html/gndy/dyzz\\`，请截取 \\`${baseUrl}/html/\\` 到末尾的部分 \\`gndy/dyzz\\` 作为 \\`category\\` 参数填入，此时目标路由为 [\\`/dytt/gndy/dyzz\\`](https://rsshub.app/dytt/gndy/dyzz)。\r\n\r\n:::\r\n\r\n<details>\r\n<summary>更多分类</summary>\r\n\r\n| 分类                                                  | ID                                               |\r\n| ----------------------------------------------------- | ------------------------------------------------ |\r\n| [最新影片](${baseUrl}/html/gndy/dyzz/index.html)      | [gndy/dyzz](https://rsshub.app/dytt/gndy/dyzz)   |\r\n| [经典影片](${baseUrl}/html/gndy/index.html)           | [gndy](https://rsshub.app/dytt/gndy)             |\r\n| [国内电影](${baseUrl}/html/gndy/china/index.html)     | [gndy/china](https://rsshub.app/dytt/gndy/china) |\r\n| [欧美电影](${baseUrl}/html/gndy/oumei/index.html)     | [gndy/oumei](https://rsshub.app/dytt/gndy/oumei) |\r\n| [其它电影](${baseUrl}/html/gndy/rihan/index.html)     | [gndy/rihan](https://rsshub.app/dytt/gndy/rihan) |\r\n| [华语电视](${baseUrl}/html/tv/hytv/index.html)        | [tv/hytv](https://rsshub.app/dytt/tv/hytv)       |\r\n| [欧美电视](${baseUrl}/html/tv/oumeitv/index.html)     | [tv/oumeitv](https://rsshub.app/dytt/tv/oumeitv) |\r\n| [最新综艺](${baseUrl}/html/zongyi2013/index.html)     | [zongyi2013](https://rsshub.app/dytt/zongyi2013) |\r\n| [旧版综艺](${baseUrl}/html/2009zongyi/index.html)     | [2009zongyi](https://rsshub.app/dytt/2009zongyi) |\r\n| [动漫资源](${baseUrl}/html/dongman/index.html)        | [dongman](https://rsshub.app/dytt/dongman)       |\r\n| [旧版游戏](${baseUrl}/html/game/index.html)           | [game](https://rsshub.app/dytt/game)             |\r\n| [游戏下载](${baseUrl}/html/newgame/index.html)        | [newgame](https://rsshub.app/dytt/newgame)       |\r\n| [日韩剧集专区](${baseUrl}/html/tv/rihantv/index.html) | [tv/rihantv](https://rsshub.app/dytt/tv/rihantv) |\r\n\r\n</details>\r\n`,\r\n    categories: ['multimedia'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: true,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['${domain}/index.htm', `${domain}/html/:category`],\r\n            target: (params) => {\r\n                const category: string = params.category;\r\n\r\n                return `/dytt/html${category ? `/${category}` : ''}`;\r\n            },\r\n        },\r\n        {\r\n            title: '最新影片',\r\n            source: [`${baseUrl}/html/gndy/dyzz/index.html`],\r\n            target: '/gndy/dyzz',\r\n        },\r\n        {\r\n            title: '经典影片',\r\n            source: [`${baseUrl}/html/gndy/index.html`],\r\n            target: '/gndy',\r\n        },\r\n        {\r\n            title: '国内电影',\r\n            source: [`${baseUrl}/html/gndy/china/index.html`],\r\n            target: '/gndy/china',\r\n        },\r\n        {\r\n            title: '欧美电影',\r\n            source: [`${baseUrl}/html/gndy/oumei/index.html`],\r\n            target: '/gndy/oumei',\r\n        },\r\n        {\r\n            title: '其它电影',\r\n            source: [`${baseUrl}/html/gndy/rihan/index.html`],\r\n            target: '/gndy/rihan',\r\n        },\r\n        {\r\n            title: '华语电视',\r\n            source: [`${baseUrl}/html/tv/hytv/index.html`],\r\n            target: '/tv/hytv',\r\n        },\r\n        {\r\n            title: '欧美电视',\r\n            source: [`${baseUrl}/html/tv/oumeitv/index.html`],\r\n            target: '/tv/oumeitv',\r\n        },\r\n        {\r\n            title: '最新综艺',\r\n            source: [`${baseUrl}/html/zongyi2013/index.html`],\r\n            target: '/zongyi2013',\r\n        },\r\n        {\r\n            title: '旧版综艺',\r\n            source: [`${baseUrl}/html/2009zongyi/index.html`],\r\n            target: '/2009zongyi',\r\n        },\r\n        {\r\n            title: '动漫资源',\r\n            source: [`${baseUrl}/html/dongman/index.html`],\r\n            target: '/dongman',\r\n        },\r\n        {\r\n            title: '旧版游戏',\r\n            source: [`${baseUrl}/html/game/index.html`],\r\n            target: '/game',\r\n        },\r\n        {\r\n            title: '游戏下载',\r\n            source: [`${baseUrl}/html/newgame/index.html`],\r\n            target: '/newgame',\r\n        },\r\n        {\r\n            title: '日韩剧集专区',\r\n            source: [`${baseUrl}/html/tv/rihantv/index.html`],\r\n            target: '/tv/rihantv',\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n};\r\n"],"mappings":"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"}