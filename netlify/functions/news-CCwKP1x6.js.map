{"version":3,"file":"news-CCwKP1x6.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/hrbeu/ugs/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst baseUrl = 'http://ugs.hrbeu.edu.cn';\r\n\r\nconst authorMap = {\r\n    gztz: {\r\n        all: '/2821',\r\n    },\r\n    jwc: {\r\n        all: '/jwc',\r\n        jxap: '/2847',\r\n        ksgl: '/2895',\r\n        xjgl: '/2902',\r\n        wytk: '/2897',\r\n        cjgl: '/2901',\r\n    },\r\n    sjjxyjlc: {\r\n        all: '/3206',\r\n        syjx: '/2847',\r\n        sysjs: '/sysjs',\r\n        xwsx: '/2909',\r\n        xwlw: '/2910',\r\n        kcsj: '/2911',\r\n        cxcy: '/2913',\r\n        xjjl: '/xjjl',\r\n    },\r\n    jypgc: {\r\n        all: '/3207',\r\n        jxyjyjxcg: '/2916',\r\n        zljk: '/2917',\r\n    },\r\n    zyjsc: {\r\n        all: '/3208',\r\n        zyyjcjs: '/2914',\r\n        cgsyb: '/2925',\r\n        jxmsyyxzjjs: '/2918',\r\n        ktjs: '/2919',\r\n        syjx: '/2920',\r\n    },\r\n    gjdxswhszjd: {\r\n        all: '/3209',\r\n    },\r\n    jsjxfzzx: {\r\n        all: '/3210',\r\n        jspx: '/2915',\r\n    },\r\n    zhbgs: {\r\n        all: '/3211',\r\n        lxkc: '/lxkc',\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/ugs/news/:author?/:category?',\r\n    categories: ['university'],\r\n    example: '/hrbeu/ugs/news/jwc/jxap',\r\n    parameters: { author: '发布部门，默认为 `gztz`', category: '分类，默认为 `all`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['ugs.hrbeu.edu.cn/:author/list.htm'],\r\n            target: '/ugs/news/:author',\r\n        },\r\n    ],\r\n    name: '本科生院工作通知',\r\n    maintainers: ['XYenon'],\r\n    handler,\r\n    description: `author 列表：\r\n\r\n| 教务处 | 实践教学与交流处 | 教育评估处 | 专业建设处 | 国家大学生文化素质基地 | 教师教学发展中心 | 综合办公室 | 工作通知 |\r\n| ------ | ---------------- | ---------- | ---------- | ---------------------- | ---------------- | ---------- | -------- |\r\n| jwc    | sjjxyjlzx        | jypgc      | zyjsc      | gjdxswhszjd            | jsjxfzzx         | zhbgs      | gztz     |\r\n\r\n  category 列表：\r\n\r\n  \\`all\\` 为全部\r\n\r\n  教务处：\r\n\r\n| 教学安排 | 考试管理 | 学籍管理 | 外语统考 | 成绩管理 |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| jxap     | ksgl     | xjgl     | wytk     | cjgl     |\r\n\r\n  实践教学与交流处：\r\n\r\n| 实验教学 | 实验室建设 | 校外实习 | 学位论文 | 课程设计 | 创新创业 | 校际交流 |\r\n| -------- | ---------- | -------- | -------- | -------- | -------- | -------- |\r\n| syjx     | sysjs      | xwsx     | xwlw     | kcsj     | cxcy     | xjjl     |\r\n\r\n  教育评估处：\r\n\r\n| 教学研究与教学成果 | 质量监控 |\r\n| ------------------ | -------- |\r\n| jxyjyjxcg          | zljk     |\r\n\r\n  专业建设处：\r\n\r\n| 专业与教材建设 | 陈赓实验班 | 教学名师与优秀主讲教师 | 课程建设 | 双语教学 |\r\n| -------------- | ---------- | ---------------------- | -------- | -------- |\r\n| zyyjcjs        | cgsyb      | jxmsyyxzjjs            | kcjs     | syjx     |\r\n\r\n  国家大学生文化素质基地：无\r\n\r\n  教师教学发展中心：\r\n\r\n| 教师培训 |\r\n| -------- |\r\n| jspx     |\r\n\r\n  综合办公室：\r\n\r\n| 联系课程 |\r\n| -------- |\r\n| lxkc     |\r\n\r\n  工作通知：无`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const author = ctx.req.param('author') || 'gztz';\r\n    const category = ctx.req.param('category') || 'all';\r\n    const link = baseUrl + authorMap[author][category] + '/list.htm';\r\n    const response = await got(link, {\r\n        headers: {\r\n            Referer: baseUrl,\r\n        },\r\n    });\r\n    const $ = load(response.data);\r\n\r\n    const list = $('.wp_article_list_table .border9')\r\n        .toArray()\r\n        .map((e) => {\r\n            e = $(e);\r\n            return {\r\n                title: e.find('a').attr('title'),\r\n                link: new URL(e.find('a').attr('href'), baseUrl).href,\r\n                pubDate: parseDate(e.find('.date').text()),\r\n            };\r\n        });\r\n\r\n    const out = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                if (item.link.includes('.htm')) {\r\n                    const response = await got(item.link);\r\n                    const $ = load(response.data);\r\n\r\n                    item.description = $('.wp_articlecontent').html().trim();\r\n                } else {\r\n                    item.description = '此链接为文件，请点击下载';\r\n                }\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '哈尔滨工程大学本科生院工作通知',\r\n        link,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAM,EAAU,0BAEV,EAAY,CACd,KAAM,CACF,IAAK,SAET,IAAK,CACD,IAAK,OACL,KAAM,QACN,KAAM,QACN,KAAM,QACN,KAAM,QACN,KAAM,SAEV,SAAU,CACN,IAAK,QACL,KAAM,QACN,MAAO,SACP,KAAM,QACN,KAAM,QACN,KAAM,QACN,KAAM,QACN,KAAM,SAEV,MAAO,CACH,IAAK,QACL,UAAW,QACX,KAAM,SAEV,MAAO,CACH,IAAK,QACL,QAAS,QACT,MAAO,QACP,YAAa,QACb,KAAM,QACN,KAAM,SAEV,YAAa,CACT,IAAK,SAET,SAAU,CACN,IAAK,QACL,KAAM,SAEV,MAAO,CACH,IAAK,QACL,KAAM,UAIDA,EAAe,CACxB,KAAM,gCACN,WAAY,CAAC,cACb,QAAS,2BACT,WAAY,CAAE,OAAQ,kBAAmB,SAAU,gBACnD,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,qCACT,OAAQ,sBAGhB,KAAM,WACN,YAAa,CAAC,UACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;WAmDjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,EAAI,IAAI,MAAM,WAAa,OACpC,EAAW,EAAI,IAAI,MAAM,aAAe,MACxC,EAAO,EAAU,EAAU,GAAQ,GAAY,YAC/C,EAAW,MAAMC,EAAI,EAAM,CAC7B,QAAS,CACL,QAAS,KAGX,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,mCACV,UACA,IAAK,IACF,EAAI,EAAE,GACC,CACH,MAAO,EAAE,KAAK,KAAK,KAAK,SACxB,KAAM,IAAI,IAAI,EAAE,KAAK,KAAK,KAAK,QAAS,GAAS,KACjD,QAAS,EAAU,EAAE,KAAK,SAAS,WAIzC,EAAM,MAAM,QAAQ,IACtB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,EAAK,KAAK,SAAS,QAAS,CAC5B,IAAMC,EAAW,MAAMF,EAAI,EAAK,MAC1BG,EAAI,EAAKD,EAAS,MAExB,EAAK,YAAcC,EAAE,sBAAsB,OAAO,YAElD,EAAK,YAAc,eAEvB,OAAO,MAKnB,MAAO,CACH,MAAO,kBACP,OACA,KAAM"}