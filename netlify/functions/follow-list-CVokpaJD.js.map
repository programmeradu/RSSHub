{"version":3,"file":"follow-list-CVokpaJD.js","names":[],"sources":["../../lib/routes/mihoyo/bbs/follow-list.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport cache from './cache';\r\n\r\nconst renderDescription = (description, images) => art(path.join(__dirname, '../templates/description.art'), { description, images });\r\n\r\nexport const route: Route = {\r\n    path: '/bbs/follow-list/:uid',\r\n    categories: ['game'],\r\n    example: '/mihoyo/bbs/follow-list/77005350',\r\n    parameters: { uid: '用户uid' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '米游社 - 用户关注',\r\n    maintainers: ['CaoMeiYouRen'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const uid = ctx.req.param('uid');\r\n    const page_size = ctx.req.query('limit') || '20';\r\n    const searchParams = {\r\n        gids: 2,\r\n        uid,\r\n        page_size,\r\n    };\r\n    const link = `https://www.miyoushe.com/ys/accountCenter/followList?id=${uid}`;\r\n    const url = `https://bbs-api.miyoushe.com/user/wapi/following`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n        searchParams,\r\n        headers: {\r\n            Origin: 'https://www.miyoushe.com',\r\n            Referer: link,\r\n        },\r\n    });\r\n    const list = response?.data?.data?.result;\r\n    if (!list) {\r\n        throw new Error('未获取到数据！');\r\n    }\r\n    const { nickname: username } = await cache.getUserFullInfo(ctx, uid);\r\n    const title = `米游社 - ${username} 的关注`;\r\n    const items = list.map((e) => {\r\n        const title = e.user.nickname;\r\n        const link = `https://www.miyoushe.com/ys/accountCenter/postList?id=${e.user.uid}`;\r\n        const description = renderDescription(`${e.user.certification.label || ''}\\n${e.user.introduce || ''}`.trim(), [e.user.avatar_url]);\r\n        return {\r\n            title,\r\n            link,\r\n            description,\r\n        };\r\n    });\r\n\r\n    const data = {\r\n        title,\r\n        link,\r\n        item: items,\r\n    };\r\n    return data;\r\n}\r\n"],"mappings":"ucAOA,MAAM,GAAqB,EAAa,IAAW,EAAI,EAAA,KAAA,EAAA,sCAAsD,CAAE,cAAa,WAE/G,EAAe,CACxB,KAAM,wBACN,WAAY,CAAC,QACb,QAAS,mCACT,WAAY,CAAE,IAAK,SACnB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,aACN,YAAa,CAAC,gBACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,EAAI,IAAI,MAAM,OACpB,EAAY,EAAI,IAAI,MAAM,UAAY,KACtC,EAAe,CACjB,KAAM,EACN,MACA,aAEE,EAAO,2DAA2D,IAElE,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,uDACA,eACA,QAAS,CACL,OAAQ,2BACR,QAAS,KAGX,EAAO,GAAU,MAAM,MAAM,OACnC,GAAI,CAAC,EACD,MAAU,MAAM,WAEpB,GAAM,CAAE,SAAU,GAAa,MAAM,EAAM,gBAAgB,EAAK,GAC1D,EAAQ,SAAS,EAAS,MAC1B,EAAQ,EAAK,IAAK,GAAM,CAC1B,IAAM,EAAQ,EAAE,KAAK,SACf,EAAO,yDAAyD,EAAE,KAAK,MACvE,EAAc,EAAkB,GAAG,EAAE,KAAK,cAAc,OAAS,GAAG,IAAI,EAAE,KAAK,WAAa,KAAK,OAAQ,CAAC,EAAE,KAAK,aACvH,MAAO,CACH,MAAA,EACA,KAAA,EACA,iBAIF,EAAO,CACT,QACA,OACA,KAAM,GAEV,OAAO"}