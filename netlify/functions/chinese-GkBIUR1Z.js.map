{"version":3,"file":"chinese-GkBIUR1Z.js","names":[],"sources":["../../lib/routes/joins/chinese.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = '' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n\r\n    const rootUrl = 'https://chinese.joins.com';\r\n    const currentUrl = new URL(`news/articleList.html?view_type=s${category ? `&sc_section_code=${category}` : ''}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('section.article-list-content div.table-row')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.find('strong').text(),\r\n                pubDate: timezone(parseDate(item.find('div.list-dated').text().split(/\\|/).pop()), +8),\r\n                link: new URL(item.find('a.links').prop('href'), rootUrl).href,\r\n                author: item.find('div.list-dated').text().split(/\\|/)[0],\r\n                language,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                $$('a.articles').remove();\r\n                $$('div.view-copyright, div.ad-template, div.view-editors, div.tag-group').remove();\r\n\r\n                const title = $$('div.article-head-title, div.viewer-titles').text();\r\n                const description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    images:\r\n                        $$('div.photo-box').length === 0\r\n                            ? undefined\r\n                            : $$('div.photo-box')\r\n                                  .toArray()\r\n                                  .map((i) => {\r\n                                      const image = $$(i).find('img');\r\n\r\n                                      return image.prop('src')\r\n                                          ? {\r\n                                                src: image.prop('src'),\r\n                                            }\r\n                                          : undefined;\r\n                                  }),\r\n                    description: $$('div#article-view-content-div').html(),\r\n                });\r\n                const image = $$('meta[property=\"og:image\"]').prop('content');\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = parseDate($$('meta[property=\"article:published_time\"]').prop('content'));\r\n                item.category = $$('meta[name=\"keywords\"]').prop('content')?.split(/,/) ?? $$('meta[name=\"news_keywords\"]').prop('content')?.split(/,/) ?? [];\r\n                item.author = $$('meta[property=\"og:article:author\"]').prop('content');\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div#article-view-content-div').text(),\r\n                };\r\n                item.image = image;\r\n                item.banner = image;\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('div.user-logo img').prop('src'), rootUrl).href;\r\n\r\n    return {\r\n        title: `${$(`a[data-code=\"${category}\"]`)?.text() || $('ul#user-menu a').first().text()} - ${$('title').text()}`,\r\n        description: $('meta[property=\"og:description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: $('meta[property=\"og:site_name\"]').prop('content'),\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/chinese/:category?',\r\n    name: '中央日报中文版',\r\n    url: 'chinese.joins.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/chinese',\r\n    parameters: { category: '分类，默认为空，可在对应分类页 URL 中找到 `sc_section_code`' },\r\n    description: `::: tip\r\n  若订阅 [财经](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N1)，网址为 \\`https://chinese.joins.com/news/articleList.html?sc_section_code=S1N1\\`。截取 \\`sc_section_code\\` 的值作为参数填入，此时路由为 [\\`/joins/chinese/S1N1\\`](https://rsshub.app/joins/chinese/S1N1)。\r\n:::\r\n\r\n| 分类                                                                                       | \\`sc_section_code\\`                             |\r\n| ------------------------------------------------------------------------------------------ | ----------------------------------------------- |\r\n| [财经](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N1)               | [S1N1](https://rsshub.app/joins/chinese/S1N1)   |\r\n| [国际](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N2)               | [S1N2](https://rsshub.app/joins/chinese/S1N2)   |\r\n| [北韩](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N3)               | [S1N3](https://rsshub.app/joins/chinese/S1N3)   |\r\n| [政治·社会](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N4)          | [S1N4](https://rsshub.app/joins/chinese/S1N4)   |\r\n| [中国观察](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N5)           | [S1N5](https://rsshub.app/joins/chinese/S1N5)   |\r\n| [社论](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N26)              | [S1N26](https://rsshub.app/joins/chinese/S1N26) |\r\n| [专栏·观点](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N11)         | [S1N11](https://rsshub.app/joins/chinese/S1N11) |\r\n| [军事·科技](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N6)          | [S1N6](https://rsshub.app/joins/chinese/S1N6)   |\r\n| [娱乐体育](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N7)           | [S1N7](https://rsshub.app/joins/chinese/S1N7)   |\r\n| [教育](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N8)               | [S1N8](https://rsshub.app/joins/chinese/S1N8)   |\r\n| [旅游美食](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N9)           | [S1N9](https://rsshub.app/joins/chinese/S1N9)   |\r\n| [时尚](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N10)              | [S1N10](https://rsshub.app/joins/chinese/S1N10) |\r\n| [图集](https://chinese.joins.com/news/articleList.html?sc_section_code=S1N12&view_type=tm) | [S1N12](https://rsshub.app/joins/chinese/S1N12) |\r\n\r\n  `,\r\n    categories: ['traditional-media'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: (url) => {\r\n                const category = url.searchParams.get('sc_section_code');\r\n\r\n                return `/joins/chinese${category ? `/${category}` : ''}`;\r\n            },\r\n        },\r\n        {\r\n            title: '财经',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N1',\r\n        },\r\n        {\r\n            title: '国际',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N2',\r\n        },\r\n        {\r\n            title: '北韩',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N3',\r\n        },\r\n        {\r\n            title: '政治·社会',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N4',\r\n        },\r\n        {\r\n            title: '中国观察',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N5',\r\n        },\r\n        {\r\n            title: '社论',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N26',\r\n        },\r\n        {\r\n            title: '专栏·观点',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N11',\r\n        },\r\n        {\r\n            title: '军事·科技',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N6',\r\n        },\r\n        {\r\n            title: '娱乐体育',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N7',\r\n        },\r\n        {\r\n            title: '教育',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N8',\r\n        },\r\n        {\r\n            title: '旅游美食',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N9',\r\n        },\r\n        {\r\n            title: '时尚',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N10',\r\n        },\r\n        {\r\n            title: '图集',\r\n            source: ['chinese.joins.com/news/articleList.html'],\r\n            target: '/chinese/S1N12',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}