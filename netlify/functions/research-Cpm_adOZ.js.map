{"version":3,"file":"research-Cpm_adOZ.js","names":["route: Route","ofetch","textList: string[]","cache","response","$"],"sources":["../../lib/routes/anthropic/research.ts"],"sourcesContent":["import ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport { Route } from '@/types';\r\nimport pMap from 'p-map';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/research',\r\n    categories: ['programming'],\r\n    example: '/anthropic/research',\r\n    parameters: {},\r\n    radar: [\r\n        {\r\n            source: ['www.anthropic.com/research', 'www.anthropic.com'],\r\n        },\r\n    ],\r\n    name: 'Research',\r\n    maintainers: ['ttttmr'],\r\n    handler,\r\n    url: 'www.anthropic.com/research',\r\n};\r\n\r\nasync function handler() {\r\n    const link = 'https://www.anthropic.com/research';\r\n    const response = await ofetch(link);\r\n    const $ = load(response);\r\n\r\n    // self.__next_f.push\r\n    const regexp = /self\\.__next_f\\.push\\((.+)\\)/;\r\n    const textList: string[] = [];\r\n    for (const e of $('script').toArray()) {\r\n        const $e = $(e);\r\n        const text = $e.text();\r\n        const match = regexp.exec(text);\r\n        if (match) {\r\n            let data;\r\n            try {\r\n                data = JSON.parse(match[1]);\r\n                if (Array.isArray(data) && data.length === 2 && data[0] === 1) {\r\n                    textList.push(data[1]);\r\n                }\r\n            } catch {\r\n                // ignore\r\n            }\r\n        }\r\n    }\r\n\r\n    const partRegex = /^([0-9a-zA-Z]+):([0-9a-zA-Z]+)?(\\[.*)$/;\r\n    const fd = textList\r\n        .join('')\r\n        .split('\\n')\r\n        .map((d) => {\r\n            const matchPart = partRegex.exec(d);\r\n            if (matchPart) {\r\n                return {\r\n                    id: matchPart[1],\r\n                    tag: matchPart[2],\r\n                    data: JSON.parse(matchPart[3]),\r\n                };\r\n            }\r\n            return {\r\n                id: '',\r\n                tag: '',\r\n                data: d,\r\n            };\r\n        });\r\n\r\n    const sections = fd.flatMap((d) => (Array.isArray(d.data) ? d.data : [])).flatMap((item) => item?.page?.sections ?? []);\r\n    const tabPages = sections.flatMap((section) => section?.tabPages ?? []).filter((tabPage) => tabPage?.label === 'Overview');\r\n    const publicationSections = tabPages.flatMap((tabPage) => tabPage.sections).filter((section) => section?.title === 'Publications');\r\n    const posts = publicationSections\r\n        .flatMap((section) => section?.posts ?? [])\r\n        .map((post) => ({\r\n            title: post.title,\r\n            link: `https://www.anthropic.com/research/${post.slug.current}`,\r\n            pubDate: parseDate(post.publishedOn),\r\n        }));\r\n\r\n    const items = await pMap(\r\n        posts,\r\n        (item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await ofetch(item.link);\r\n                const $ = load(response);\r\n\r\n                const content = $('div[class*=\"PostDetail_post-detail__\"]');\r\n                content.find('img').each((_, e) => {\r\n                    const $e = $(e);\r\n                    $e.removeAttr('style srcset');\r\n                    const src = $e.attr('src');\r\n                    const params = new URLSearchParams(src);\r\n                    const newSrc = params.get('/_next/image?url');\r\n                    if (newSrc) {\r\n                        $e.attr('src', newSrc);\r\n                    }\r\n                });\r\n\r\n                item.description = content.html();\r\n\r\n                return item;\r\n            }),\r\n        { concurrency: 5 }\r\n    );\r\n\r\n    return {\r\n        title: 'Anthropic Research',\r\n        link,\r\n        description: 'Latest research from Anthropic',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wUAOA,MAAaA,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,eACb,QAAS,sBACT,WAAY,GACZ,MAAO,CACH,CACI,OAAQ,CAAC,6BAA8B,uBAG/C,KAAM,WACN,YAAa,CAAC,UACd,UACA,IAAK,8BAGT,eAAe,GAAU,CACrB,IAAM,EAAO,qCACP,EAAW,MAAMC,EAAO,GACxB,EAAI,EAAK,GAGT,EAAS,+BACTC,EAAqB,GAC3B,IAAK,IAAM,KAAK,EAAE,UAAU,UAAW,CACnC,IAAM,EAAK,EAAE,GACP,EAAO,EAAG,OACV,EAAQ,EAAO,KAAK,GAC1B,GAAI,EAAO,CACP,IAAI,EACJ,GAAI,CACA,EAAO,KAAK,MAAM,EAAM,IACpB,MAAM,QAAQ,IAAS,EAAK,SAAW,GAAK,EAAK,KAAO,GACxD,EAAS,KAAK,EAAK,SAEnB,IAMhB,IAAM,EAAY,yCACZ,EAAK,EACN,KAAK,IACL,MAAM;GACN,IAAK,GAAM,CACR,IAAM,EAAY,EAAU,KAAK,GAQjC,OAPI,EACO,CACH,GAAI,EAAU,GACd,IAAK,EAAU,GACf,KAAM,KAAK,MAAM,EAAU,KAG5B,CACH,GAAI,GACJ,IAAK,GACL,KAAM,KAIZ,EAAW,EAAG,QAAS,GAAO,MAAM,QAAQ,EAAE,MAAQ,EAAE,KAAO,IAAK,QAAS,GAAS,GAAM,MAAM,UAAY,IAC9G,EAAW,EAAS,QAAS,GAAY,GAAS,UAAY,IAAI,OAAQ,GAAY,GAAS,QAAU,YACzG,EAAsB,EAAS,QAAS,GAAY,EAAQ,UAAU,OAAQ,GAAY,GAAS,QAAU,gBAC7G,EAAQ,EACT,QAAS,GAAY,GAAS,OAAS,IACvC,IAAK,IAAU,CACZ,MAAO,EAAK,MACZ,KAAM,sCAAsC,EAAK,KAAK,UACtD,QAAS,EAAU,EAAK,gBAG1B,EAAQ,MAAM,EAChB,EACC,GACGC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAW,MAAMH,EAAO,EAAK,MAC7BI,EAAI,EAAKD,GAET,EAAUC,EAAE,0CAclB,OAbA,EAAQ,KAAK,OAAO,MAAM,EAAG,IAAM,CAC/B,IAAM,EAAKA,EAAE,GACb,EAAG,WAAW,gBACd,IAAM,EAAM,EAAG,KAAK,OACd,EAAS,IAAI,gBAAgB,GAC7B,EAAS,EAAO,IAAI,oBACtB,GACA,EAAG,KAAK,MAAO,KAIvB,EAAK,YAAc,EAAQ,OAEpB,IAEf,CAAE,YAAa,IAGnB,MAAO,CACH,MAAO,qBACP,OACA,YAAa,iCACb,KAAM"}