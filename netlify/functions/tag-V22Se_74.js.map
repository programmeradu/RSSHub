{"version":3,"file":"tag-V22Se_74.js","names":[],"sources":["../../lib/routes/esquirehk/tag.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport * as cheerio from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { destr } from 'destr';\r\n\r\nconst topics = new Set(['style', 'watches', 'lifestyle', 'health', 'money-investment', 'gear', 'people', 'watch', 'mens-talk']);\r\n\r\nconst handler = async (ctx) => {\r\n    let { id = 'Fashion' } = ctx.req.param();\r\n\r\n    id = id.toLowerCase();\r\n\r\n    const rootUrl = 'https://www.esquirehk.com';\r\n\r\n    let currentUrl = `${rootUrl}/tag/${id}`;\r\n    if (topics.has(id)) {\r\n        currentUrl = `${rootUrl}/${id}`;\r\n    }\r\n\r\n    const response = await ofetch(currentUrl);\r\n\r\n    const $ = cheerio.load(response);\r\n    const list = [\r\n        ...$('div[class^=\"max-w-[100%]\"] > div > div:nth-child(2) > a')\r\n            .toArray()\r\n            .map((item) => {\r\n                item = $(item);\r\n                return {\r\n                    title: item.text().trim(),\r\n                    link: new URL(item.attr('href'), currentUrl).href,\r\n                };\r\n            }),\r\n        ...$('div.list-item > div > div:nth-child(2) > a')\r\n            .toArray()\r\n            .map((item) => {\r\n                item = $(item);\r\n                return {\r\n                    title: item.text().trim(),\r\n                    link: new URL(item.attr('href'), currentUrl).href,\r\n                };\r\n            }),\r\n    ]\r\n        .map((item) => ({\r\n            ...item,\r\n            slug: item.link.replace(rootUrl, ''),\r\n        }))\r\n        .filter((item) => !item.slug.startsWith('/campaign'));\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const resp = await ofetch(`https://api.esquirehk.com${item.slug}`);\r\n                const response = destr(resp) as any;\r\n                if (response.status === '404') {\r\n                    return item;\r\n                }\r\n\r\n                item.description =\r\n                    response.intro.raw +\r\n                    art(path.join(__dirname, 'templates/subpages.art'), {\r\n                        subpages: response.subpages,\r\n                    });\r\n                item.pubDate = parseDate(response.date.published, 'X');\r\n                item.updated = parseDate(response.date.lastModified, 'X');\r\n                item.author = response.author.name;\r\n                item.category = [...response.tags.topic.map((tag) => tag.name), ...response.tags.normal.map((tag) => tag.name)];\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${$('head title').text()} - Esquirehk`,\r\n        description: $('head meta[name=\"description\"]').attr('content'),\r\n        image: $('head meta[property=\"og:image\"]').attr('content'),\r\n        logo: $('head meta[property=\"og:image\"]').attr('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/tag/:id?',\r\n    categories: ['new-media'],\r\n    example: '/esquirehk/tag/Fashion',\r\n    parameters: { id: '标签，可在对应标签页 URL 中找到' },\r\n    name: 'Tag',\r\n    maintainers: ['nczitzk'],\r\n    radar: [\r\n        {\r\n            source: ['www.esquirehk.com/tag/:id', 'www.esquirehk.com/:id'],\r\n        },\r\n    ],\r\n    handler,\r\n};\r\n"],"mappings":"4bAUA,MAAM,EAAS,IAAI,IAAI,CAAC,QAAS,UAAW,YAAa,SAAU,mBAAoB,OAAQ,SAAU,QAAS,cAE5G,EAAU,KAAO,IAAQ,CAC3B,GAAI,CAAE,KAAK,WAAc,EAAI,IAAI,QAEjC,EAAK,EAAG,cAER,IAAM,EAAU,4BAEZ,EAAa,GAAG,EAAQ,OAAO,IAC/B,EAAO,IAAI,KACX,EAAa,GAAG,EAAQ,GAAG,KAG/B,IAAM,EAAW,MAAM,EAAO,GAExB,EAAI,EAAQ,KAAK,GACjB,EAAO,CACT,GAAG,EAAE,2DACA,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,OAAO,OACnB,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAY,QAGzD,GAAG,EAAE,8CACA,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,OAAO,OACnB,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAY,SAIxD,IAAK,IAAU,CACZ,GAAG,EACH,KAAM,EAAK,KAAK,QAAQ,EAAS,OAEpC,OAAQ,GAAS,CAAC,EAAK,KAAK,WAAW,cAEtC,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACN,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAO,MAAM,EAAO,4BAA4B,EAAK,QACrD,EAAW,EAAM,GAevB,OAdI,EAAS,SAAW,MACb,GAGX,EAAK,YACD,EAAS,MAAM,IACf,EAAI,EAAA,KAAA,EAAA,mCAAgD,CAChD,SAAU,EAAS,WAE3B,EAAK,QAAU,EAAU,EAAS,KAAK,UAAW,KAClD,EAAK,QAAU,EAAU,EAAS,KAAK,aAAc,KACrD,EAAK,OAAS,EAAS,OAAO,KAC9B,EAAK,SAAW,CAAC,GAAG,EAAS,KAAK,MAAM,IAAK,GAAQ,EAAI,MAAO,GAAG,EAAS,KAAK,OAAO,IAAK,GAAQ,EAAI,OAElG,OAKnB,MAAO,CACH,MAAO,GAAG,EAAE,cAAc,OAAO,cACjC,YAAa,EAAE,iCAAiC,KAAK,WACrD,MAAO,EAAE,kCAAkC,KAAK,WAChD,KAAM,EAAE,kCAAkC,KAAK,WAC/C,KAAM,EACN,KAAM,IAID,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,aACb,QAAS,yBACT,WAAY,CAAE,GAAI,sBAClB,KAAM,MACN,YAAa,CAAC,WACd,MAAO,CACH,CACI,OAAQ,CAAC,4BAA6B,2BAG9C"}