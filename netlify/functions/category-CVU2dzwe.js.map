{"version":3,"file":"category-CVU2dzwe.js","names":["route: Route","assembledItem: DataItem","ofetch","info: ArticleEntry"],"sources":["../../lib/routes/yystv/category.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { fetchDataItemCached } from './fetcher';\r\nimport { load } from 'cheerio';\r\nimport { parseDate, parseRelativeDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/category/:category',\r\n    categories: ['game'],\r\n    example: '/yystv/category/recommend',\r\n    parameters: { category: '专栏类型' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '游研社 - 分类文章',\r\n    maintainers: ['betta-cyber', 'dousha'],\r\n    handler,\r\n    description: `| 推游      | 游戏史  | 大事件 | 文化    | 趣闻 | 经典回顾 | 业界     |\r\n| --------- | ------- | ------ | ------- | ---- | -------- | -------- |\r\n| recommend | history | big    | culture | news | retro    | industry |`,\r\n};\r\n\r\ntype ArticleEntry = DataItem & { link: string };\r\n\r\nfunction getDescription(items: ArticleEntry[]): Promise<DataItem[]> {\r\n    return Promise.all(\r\n        items.map((item) =>\r\n            fetchDataItemCached(item.link, (pageContent) => {\r\n                const $ = load(pageContent);\r\n                const articleContent = $('.doc-content.rel').html() || '';\r\n\r\n                const assembledItem: DataItem = { ...item, description: articleContent };\r\n                return assembledItem;\r\n            })\r\n        )\r\n    );\r\n}\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category');\r\n    const url = `https://www.yystv.cn/b/${category}`;\r\n    const response = await ofetch(url);\r\n    const $ = load(response);\r\n\r\n    const firstPart = $('.b-list-main-item')\r\n        .toArray()\r\n        .map((element) => {\r\n            const s = $(element);\r\n            const info: ArticleEntry = {\r\n                title: s.find('.b-main-info-title').text(),\r\n                link: 'https://www.yystv.cn' + s.find('.b-main-info-title a').attr('href'),\r\n                pubDate: parseRelativeDate(s.find('.b-main-createtime').text()),\r\n                author: s.find('.b-author').text(),\r\n            };\r\n            return info;\r\n        });\r\n\r\n    const secondPart = $('.list-container li')\r\n        .toArray()\r\n        .map((element) => {\r\n            const s = $(element);\r\n            const articleDate = s.find('.c-999').text();\r\n            const info: ArticleEntry = {\r\n                title: s.find('.list-article-title').text(),\r\n                link: 'https://www.yystv.cn' + s.find('a').attr('href'),\r\n                pubDate: articleDate.includes('-') ? parseDate(articleDate) : parseRelativeDate(articleDate),\r\n                author: s.find('.handler-author-link').text(),\r\n            };\r\n            return info;\r\n        });\r\n\r\n    const entries = [...firstPart, ...secondPart];\r\n\r\n    return await getDescription(entries).then((items) => ({\r\n        title: '游研社-' + $('title').text(),\r\n        link: `https://www.yystv.cn/b/${category}`,\r\n        item: items,\r\n    }));\r\n}\r\n"],"mappings":"8WAMA,MAAaA,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,QACb,QAAS,4BACT,WAAY,CAAE,SAAU,QACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,aACN,YAAa,CAAC,cAAe,UAC7B,UACA,YAAa;;0EAOjB,SAAS,EAAe,EAA4C,CAChE,OAAO,QAAQ,IACX,EAAM,IAAK,GACP,EAAoB,EAAK,KAAO,GAAgB,CAC5C,IAAM,EAAI,EAAK,GACT,EAAiB,EAAE,oBAAoB,QAAU,GAEjDC,EAA0B,CAAE,GAAG,EAAM,YAAa,GACxD,OAAO,MAMvB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAM,0BAA0B,IAChC,EAAW,MAAMC,EAAO,GACxB,EAAI,EAAK,GAET,EAAY,EAAE,qBACf,UACA,IAAK,GAAY,CACd,IAAM,EAAI,EAAE,GACNC,EAAqB,CACvB,MAAO,EAAE,KAAK,sBAAsB,OACpC,KAAM,uBAAyB,EAAE,KAAK,wBAAwB,KAAK,QACnE,QAAS,EAAkB,EAAE,KAAK,sBAAsB,QACxD,OAAQ,EAAE,KAAK,aAAa,QAEhC,OAAO,IAGT,EAAa,EAAE,sBAChB,UACA,IAAK,GAAY,CACd,IAAM,EAAI,EAAE,GACN,EAAc,EAAE,KAAK,UAAU,OAC/BA,EAAqB,CACvB,MAAO,EAAE,KAAK,uBAAuB,OACrC,KAAM,uBAAyB,EAAE,KAAK,KAAK,KAAK,QAChD,QAAS,EAAY,SAAS,KAAO,EAAU,GAAe,EAAkB,GAChF,OAAQ,EAAE,KAAK,wBAAwB,QAE3C,OAAO,IAGT,EAAU,CAAC,GAAG,EAAW,GAAG,GAElC,OAAO,MAAM,EAAe,GAAS,KAAM,IAAW,CAClD,MAAO,OAAS,EAAE,SAAS,OAC3B,KAAM,0BAA0B,IAChC,KAAM"}