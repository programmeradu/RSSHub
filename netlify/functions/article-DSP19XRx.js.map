{"version":3,"file":"article-DSP19XRx.js","names":["route: Route","ofetch","cache"],"sources":["../../lib/routes/51read/article.ts"],"sourcesContent":["import { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport type { Route, DataItem } from '@/types';\r\n\r\nexport const route: Route = {\r\n    path: '/article/:id',\r\n    name: '章节',\r\n    url: 'm.51read.org',\r\n    maintainers: ['lazwa34'],\r\n    example: '/51read/article/152685',\r\n    parameters: { id: '小说 id, 可在对应小说页 URL 中找到' },\r\n    categories: ['reading'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['m.51read.org/xiaoshuo/:id'],\r\n            target: '/article/:id',\r\n        },\r\n        {\r\n            source: ['51read.org/xiaoshuo/:id'],\r\n            target: '/article/:id',\r\n        },\r\n    ],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { id } = ctx.req.param();\r\n    const link = `https://m.51read.org/xiaoshuo/${id}`;\r\n    const $book = load(await ofetch(link));\r\n\r\n    const chapter = `https://m.51read.org/zhangjiemulu/${id}`;\r\n    const $chapter = load(await ofetch(chapter));\r\n\r\n    const pageLength = $chapter('.ml-page select')\r\n        .find('option')\r\n        .toArray()\r\n        .map((option) => option.attribs.value).length;\r\n\r\n    const item = await createItem(chapter, pageLength);\r\n\r\n    return {\r\n        title: $book('h1').text(),\r\n        description: $book('.bi-cot p').text(),\r\n        link,\r\n        item,\r\n        image: $book('.bi-img img').attr('src'),\r\n        author: $book('.bi-wt a').text(),\r\n        language: 'zh-cn',\r\n    };\r\n}\r\n\r\nconst createItem = async (baseUrl: string, page: number) => {\r\n    const url = `${baseUrl}/${page}`;\r\n    const $latest = load(await ofetch(url));\r\n    const item = await Promise.all(\r\n        $latest('.kb-jp li>a')\r\n            .toArray()\r\n            .map((chapter) => buildItem(chapter.attribs.href))\r\n            .toReversed()\r\n    );\r\n    return item;\r\n};\r\n\r\nconst buildItem = (url: string) =>\r\n    cache.tryGet(url, async () => {\r\n        const $ = load(await ofetch(url));\r\n\r\n        return {\r\n            title: $('h1').text(),\r\n            description: $('.kb-cot').html() || '',\r\n            link: url,\r\n        };\r\n    }) as Promise<DataItem>;\r\n"],"mappings":"8PAKA,MAAaA,EAAe,CACxB,KAAM,eACN,KAAM,KACN,IAAK,eACL,YAAa,CAAC,WACd,QAAS,yBACT,WAAY,CAAE,GAAI,0BAClB,WAAY,CAAC,WACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,6BACT,OAAQ,gBAEZ,CACI,OAAQ,CAAC,2BACT,OAAQ,iBAGhB,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,MAAO,EAAI,IAAI,QACjB,EAAO,iCAAiC,IACxC,EAAQ,EAAK,MAAMC,EAAO,IAE1B,EAAU,qCAAqC,IAC/C,EAAW,EAAK,MAAMA,EAAO,IAE7B,EAAa,EAAS,mBACvB,KAAK,UACL,UACA,IAAK,GAAW,EAAO,QAAQ,OAAO,OAErC,EAAO,MAAM,EAAW,EAAS,GAEvC,MAAO,CACH,MAAO,EAAM,MAAM,OACnB,YAAa,EAAM,aAAa,OAChC,OACA,OACA,MAAO,EAAM,eAAe,KAAK,OACjC,OAAQ,EAAM,YAAY,OAC1B,SAAU,SAIlB,MAAM,EAAa,MAAO,EAAiB,IAAiB,CACxD,IAAM,EAAM,GAAG,EAAQ,GAAG,IACpB,EAAU,EAAK,MAAMA,EAAO,IAC5B,EAAO,MAAM,QAAQ,IACvB,EAAQ,eACH,UACA,IAAK,GAAY,EAAU,EAAQ,QAAQ,OAC3C,cAET,OAAO,GAGL,EAAa,GACfC,EAAM,OAAO,EAAK,SAAY,CAC1B,IAAM,EAAI,EAAK,MAAMD,EAAO,IAE5B,MAAO,CACH,MAAO,EAAE,MAAM,OACf,YAAa,EAAE,WAAW,QAAU,GACpC,KAAM"}