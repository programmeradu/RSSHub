{"version":3,"file":"sydwgkzp-CIKB08WC.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/gov/chongqing/sydwgkzp.ts"],"sourcesContent":["import { Route, Data } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport type { Context } from 'hono';\r\n\r\nexport const route: Route = {\r\n    path: '/chongqing/sydwgkzp/:year?',\r\n    url: 'rlsbj.cq.gov.cn/',\r\n    categories: ['government'],\r\n    example: '/gov/chongqing/sydwgkzp',\r\n    parameters: {\r\n        year: '需要订阅的年份，格式为`YYYY`，必须小于等于当前年份，默认为当前年份',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['rlsbj.cq.gov.cn/'],\r\n        },\r\n    ],\r\n    name: '重庆市人民政府 人力社保局 - 事业单位公开招聘',\r\n    maintainers: ['MajexH'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const current = currentYear();\r\n\r\n    // 获取用户输入的 year\r\n    const { year: tempYear } = ctx.req.param();\r\n    const year = /^\\d{4}$/.test(tempYear) ? +tempYear : current;\r\n\r\n    // 替换 url, 如果是今年的话因为 url 格式不一样，所以我们先默认跳去首页获取 meta 信息里的跳转地址\r\n    const yearPart = year === current ? '' : `sydwgkzp${year}/`;\r\n    let sydwgkzpUrl = `https://rlsbj.cq.gov.cn/zwxx_182/sydw/${yearPart}`;\r\n\r\n    const { data: response } = await got(sydwgkzpUrl);\r\n\r\n    let $ = load(response);\r\n\r\n    // 检查是否存在 <meta http-equiv=\"Refresh\"> 跳转\r\n    const metaRefresh = $('meta[http-equiv=\"Refresh\"]').attr('content');\r\n\r\n    // 如果存在的话就使用 meta 提供的链接, 然后重新获取一次页面的内容\r\n    if (metaRefresh) {\r\n        const redirectPath = metaRefresh.split('URL=')[1];\r\n        sydwgkzpUrl = new URL(redirectPath, sydwgkzpUrl).href;\r\n\r\n        const { data: newResponse } = await got(sydwgkzpUrl);\r\n        $ = load(newResponse);\r\n    }\r\n\r\n    // 获取所有的标题\r\n    const list = $('ul[class=\"rsj-list1\"] > li')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const title = item.find('a').first();\r\n            return {\r\n                // 文章标题\r\n                title: title.text(),\r\n                // 文章链接\r\n                link: new URL(title.attr('href'), sydwgkzpUrl).href,\r\n                // 文章发布日期\r\n                pubDate: parseDate(item.find('span').text()),\r\n            };\r\n        });\r\n\r\n    // 获取每个通知的具体信息\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n                // 主题正文\r\n                item.description = $('.trs_editor_view').first().html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `重庆市事业单位${year}年公开招聘`,\r\n        link: sydwgkzpUrl,\r\n        item: items,\r\n    };\r\n}\r\n\r\nfunction currentYear(): number {\r\n    return new Date().getFullYear();\r\n}\r\n"],"mappings":"wWAOA,MAAaA,EAAe,CACxB,KAAM,6BACN,IAAK,mBACL,WAAY,CAAC,cACb,QAAS,0BACT,WAAY,CACR,KAAM,wCAEV,MAAO,CACH,CACI,OAAQ,CAAC,sBAGjB,KAAM,2BACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAA6B,CAChD,IAAM,EAAU,IAGV,CAAE,KAAM,GAAa,EAAI,IAAI,QAC7B,EAAO,UAAU,KAAK,GAAY,CAAC,EAAW,EAG9C,EAAW,IAAS,EAAU,GAAK,WAAW,EAAK,GACrD,EAAc,yCAAyC,IAErD,CAAE,KAAM,GAAa,MAAMC,EAAI,GAEjC,EAAI,EAAK,GAGP,EAAc,EAAE,8BAA8B,KAAK,WAGzD,GAAI,EAAa,CACb,IAAM,EAAe,EAAY,MAAM,QAAQ,GAC/C,EAAc,IAAI,IAAI,EAAc,GAAa,KAEjD,GAAM,CAAE,KAAM,GAAgB,MAAMA,EAAI,GACxC,EAAI,EAAK,GAIb,IAAM,EAAO,EAAE,8BACV,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAQ,EAAK,KAAK,KAAK,QAC7B,MAAO,CAEH,MAAO,EAAM,OAEb,KAAM,IAAI,IAAI,EAAM,KAAK,QAAS,GAAa,KAE/C,QAAS,EAAU,EAAK,KAAK,QAAQ,WAK3C,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAGf,MADA,GAAK,YAAcC,EAAE,oBAAoB,QAAQ,OAC1C,MAKnB,MAAO,CACH,MAAO,UAAU,EAAK,OACtB,KAAM,EACN,KAAM,GAId,SAAS,GAAsB,CAC3B,OAAO,IAAI,OAAO"}