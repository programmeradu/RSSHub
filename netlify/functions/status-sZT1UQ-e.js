import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import"./ofetch-Bzt0BXUH.js";import{got_default as n}from"./got-CdvI2yKX.js";import{ViewType as r}from"./types-A5bA50Mg.js";import{fallback as i,queryToBoolean as a,queryToInteger as o}from"./readable-social-D7TWDGpz.js";import s from"node:querystring";const c={path:`/people/:userid/status/:routeParams?`,categories:[`social-media`],view:r.SocialMedia,example:`/douban/people/75118396/status`,parameters:{userid:`整数型用户 id`,routeParams:`额外参数；见下`},name:`用户广播`,maintainers:[`alfredcai`],handler:p,description:`
::: tip
-   **目前只支持整数型 id**
-   字母型的 id，可以通过头像图片链接来找到其整数型 id，图片命名规则\`ul[userid]-*.jpg\`或\`u[userid]-*.jpg\`，即取文件名中间的数字
-   例如：用户 id: \`MovieL\`他的头像图片链接：\`https://img1.doubanio.com/icon/ul1128221-98.jpg\`他的整数型 id: \`1128221\`
:::

对于豆瓣用户广播内容，在 \`routeParams\` 参数中以 query string 格式设置如下选项可以控制输出的样式

| 键                         | 含义                                                           | 接受的值       | 默认值 |
| -------------------------- | -------------------------------------------------------------- | -------------- | ------ |
| readable                   | 是否开启细节排版可读性优化                                     | 0/1/true/false | false  |
| authorNameBold             | 是否加粗作者名字                                               | 0/1/true/false | false  |
| showAuthorInTitle          | 是否在标题处显示作者                                           | 0/1/true/false | true   |
| showAuthorInDesc           | 是否在正文处显示作者                                           | 0/1/true/false | false  |
| showAuthorAvatarInDesc     | 是否在正文处显示作者头像（若阅读器会提取正文图片，不建议开启） | 0/1/true/false | false  |
| showEmojiForRetweet        | 显示 “🔁” 取代 “Fw”（转发）                                    | 0/1/true/false | false  |
| showRetweetTextInTitle     | 在标题出显示转发评论（置为 false 则在标题只显示被转发的广播）  | 0/1/true/false | false  |
| addLinkForPics             | 为图片添加可点击的链接                                         | 0/1/true/false | false  |
| showTimestampInDescription | 在正文处显示广播的时间戳                                       | 0/1/true/false | false  |
| showComments               | 在正文处显示评论                                               | 0/1/true/false | false  |
| widthOfPics                | 广播配图宽（生效取决于阅读器）                                 | 不指定 / 数字  | 不指定 |
| heightOfPics               | 广播配图高（生效取决于阅读器）                                 | 不指定 / 数字  | 不指定 |
| sizeOfAuthorAvatar         | 作者头像大小                                                   | 数字           | 48     |

  指定更多与默认值不同的参数选项可以改善 RSS 的可读性，如

  [https://rsshub.app/douban/people/113894409/status/readable=1&authorNameBold=1&showAuthorInTitle=1&showAuthorInDesc=1&showAuthorAvatarInDesc=1&showEmojiForRetweet=1&showRetweetTextInTitle=1&addLinkForPics=1&showTimestampInDescription=1&showComments=1&widthOfPics=100](https://rsshub.app/douban/people/113894409/status/readable=1&authorNameBold=1&showAuthorInTitle=1&showAuthorInDesc=1&showAuthorAvatarInDesc=1&showEmojiForRetweet=1&showRetweetTextInTitle=1&addLinkForPics=1&showTimestampInDescription=1&showComments=1&widthOfPics=100)

  的效果为

  <img loading="lazy" src="/img/readable-douban.png" alt="豆瓣读书的可读豆瓣广播 RSS" />`},l={Referer:`https://m.douban.com/`};function u(e){let t={isFixSuccess:!0,why:``},n=new Date;return e?e.deleted?t={isFixSuccess:!1,why:e.msg??`[ 内容已被删除 ]`}:e.hidden?t={isFixSuccess:!1,why:e.msg??`[ 内容已被设为不可见 ]`}:e.text===void 0||e.text===null||!e.uri?t={isFixSuccess:!1,why:e.msg??`[ 内容已不可访问 ]`}:(e.author||(e.author={}),e.author.url||(e.author.url=`https://www.douban.com/people/1/`),e.author.name||(e.author.name=`[作者不可见]`),e.author.avatar||(e.author.avatar=`https://img1.doubanio.com/icon/user_normal.jpg`),e.create_time||(e.create_time=n.toLocaleString()),e.entities||(e.entities=[])):(t={isFixSuccess:!1,why:`[ 无内容 ]`},e={}),e.sharing_url&&(e.sharing_url=e.sharing_url.split(`&`)[0]),t.isFixSuccess||(e.sharing_url=`https://www.douban.com?rsshub_failed=`+n.getTime().toString(),e.create_time||(e.create_time=n.toLocaleString())),t}function d(e,t,n={},r=[]){let c=s.parse(e.req.param(`routeParams`)),l={readable:i(n.readable,a(c.readable),!1),authorNameBold:i(n.authorNameBold,a(c.authorNameBold),!1),showAuthorInTitle:i(n.showAuthorInTitle,a(c.showAuthorInTitle),!0),showAuthorInDesc:i(n.showAuthorInDesc,a(c.showAuthorInDesc),!1),showAuthorAvatarInDesc:i(n.showAuthorAvatarInDesc,a(c.showAuthorAvatarInDesc),!1),showEmojiForRetweet:i(n.showEmojiForRetweet,a(c.showEmojiForRetweet),!1),showRetweetTextInTitle:i(n.showRetweetTextInTitle,a(c.showRetweetTextInTitle),!1),addLinkForPics:i(n.addLinkForPics,a(c.addLinkForPics),!1),showTimestampInDescription:i(n.showTimestampInDescription,a(c.showTimestampInDescription),!1),showComments:i(n.showComments,a(c.showComments),!1),showColonInDesc:i(n.showColonInDesc,null,!1),widthOfPics:i(n.widthOfPics,o(c.widthOfPics),-1),heightOfPics:i(n.heightOfPics,o(c.heightOfPics),-1),sizeOfAuthorAvatar:i(n.sizeOfAuthorAvatar,o(c.sizeOfAuthorAvatar),48)};n=l;let{readable:f,authorNameBold:p,showAuthorInTitle:m,showAuthorInDesc:h,showAuthorAvatarInDesc:g,showEmojiForRetweet:_,showRetweetTextInTitle:v,addLinkForPics:y,showTimestampInDescription:b,showComments:x,showColonInDesc:S,widthOfPics:C,heightOfPics:w,sizeOfAuthorAvatar:T}=n,{status:E,comments:D}=t,{isFixSuccess:O,why:k}=u(E);if(!O)return{title:k,description:k};let A=``,j=``,M,N,{isFixSuccess:P,why:F}=u(E.reshared_status);if(E.activity===`转发`?P?(M=`转发 `,f&&(M+=`<a href="${E.reshared_status.author.url}" target="_blank" rel="noopener noreferrer">`),p&&(M+=`<strong>`),M+=E.reshared_status.author.name,p&&(M+=`</strong>`),f&&(M+=`</a>`),M+=` 的广播`,N=`转发 ${E.reshared_status.author.name} 的广播`):(M=`转发广播`,N=`转发广播`):(M=E.activity,N=E.activity),h){let e=``;f&&(e+=`<a href="${E.author.url}" target="_blank" rel="noopener noreferrer">`),g&&(e+=`<img width="${T}" height="${T}" src="${E.author.avatar}" ${f?`hspace="8" vspace="8" align="left"`:``} />`),p&&(e+=`<strong>`),e+=E.author.name,p&&(e+=`</strong>`),f&&(e+=`</a>`),e+=`&ensp;`,A+=e+M+(S?`: `:``)}m&&(j+=`${E.author.name} `),j+=`${N}: `,b&&(A+=`<br><small>${E.create_time}</small><br>`);let I=E.text,L=0,R=[];for(let e of E.entities)R.push(I.slice(L,e.start),`<a href="${e.uri.replace(`douban://douban.com`,`https://www.douban.com/doubanapp/dispatch?uri=`)}" target="_blank" rel="noopener noreferrer">${e.title}</a>`),L=e.end;if(R.push(I.slice(L)),I=R.join(``),A+=I,E.card&&(j+=E.card.rating?`《${E.card.title}》`:`「${E.card.title}」`),(E.activity!==`转发`||v)&&(j+=E.text.replace(`
`,``)),E.images&&E.images.length){A+=f?`<br clear="both" /><div style="clear: both"></div>`:`<br>`;let e=``;for(let t of E.images){if(!(t.large&&t.large.url))continue;e+=`<img width="0" height="0" hidden="true" src="${t.large.url}">`}r.push(e);for(let e of E.images){if(!(e.large&&e.large.url)){A+=`[无法显示的图片]`;continue}y&&(A+=`<a href="`+e.large.url+`" target="_blank" rel="noopener noreferrer">`),f||(A+=`<br>`);let t=``;A+=`<img `,C>=0&&(A+=` width="${C}"`,t+=`width: ${C}px;`),w>=0&&(A+=`height="${w}" `,t+=`height: ${w}px;`),A+=` style="${t}" `+(f?`vspace="8" hspace="4" `:``)+` src="`+e.large.url+`">`,y&&(A+=`</a>`)}}if(E.video_info){A+=f?`<br clear="both" /><div style="clear: both"></div>`:`<br>`;let e=E.video_info.cover_url,t=E.video_info.video_url;t&&(A=`
                ${A}
                <video
                    src="${t}"
                    ${e?`poster="${e}"`:``}
                >
                </video>
            `)}if(E.parent_status){A+=_?` 🔁 `:` Fw: `,v&&(j+=_?` 🔁 `:` Fw: `);let{isFixSuccess:e,why:t}=u(E.parent_status);if(e){let e=``;f&&(e+=`<a href="${E.parent_status.author.url}">`),p&&(e+=`<strong>`),e+=E.parent_status.author.name,p&&(e+=`</strong>`),f&&(e+=`</a>`),e+=`:&ensp;`,A+=e+E.parent_status.text,v&&(j+=E.parent_status.author.name+`: `+E.parent_status.text)}else A+=t,v&&(j+=t)}if(E.card){let e;E.card.image&&(E.card.image.large||E.card.image.normal)&&(e=E.card.image.large||E.card.image.normal),A+=f?`<br clear="both" /><div style="clear: both"></div><blockquote style="background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;">`:`<br>`,e&&(A+=`<img src="${e.url}" ${f?`vspace="0" hspace="12" align="left" height="75" style="height: 75px;"`:``} />`),E.card.title||(E.card.title=`[空]`),E.card.subtitle||(E.card.subtitle=`[空]`),E.card.url||(E.card.url=`https://www.douban.com`),A+=`<a href="${E.card.url}" target="_blank" rel="noopener noreferrer"><strong>${E.card.title}</strong><br><small>${E.card.subtitle}</small>`,E.card.rating&&(A+=`<br><small>评分：${E.card.rating.value}</small>`),A+=`</a>`,f&&(A+=`<br clear="both" /><div style="clear: both"></div></blockquote>`)}if(E.video_card){A+=f?`<br clear="both" /><div style="clear: both"></div><blockquote style="background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;">`:`<br>`;let e=E.video_card.video_info&&E.video_card.video_info.cover_url,t=E.video_card.video_info&&E.video_card.video_info.video_url;E.video_card.url||(E.video_card.url=`https://www.douban.com`),A+=`${t?`<video src="${t}" ${e?`poster="${e}"`:``}></video>`:``}<br>${E.video_card.title?`<a href="${E.video_card.url}">${E.video_card.title}</a>`:``}`,f&&(A+=`</blockquote>`)}if(E.reshared_status)if(A+=f?`<br clear="both" /><div style="clear: both"></div><blockquote style="background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;">`:`<br>`,v&&(j+=` | `),P){A+=d(e,{status:E.reshared_status,comments:[]},{showAuthorInDesc:!0,showAuthorAvatarInDesc:!1,showComments:!1,showColonInDesc:!0},r).description,j+=E.reshared_status.text;let t=E.reshared_status.uri.replace(`douban://douban.com`,`https://www.douban.com/doubanapp/dispatch?uri=`);f&&(A+=`<br><small>原动态：<a href="${t}" target="_blank" rel="noopener noreferrer">${t}</a></small><br clear="both" /><div style="clear: both"></div></blockquote>`)}else A+=F,j+=F;if(x){D.length>0&&(A+=`<hr>`);for(let e of D)A+=`<br>${e.text} - <a href="${e.author.url}" target="_blank" rel="noopener noreferrer">${e.author.name}</a>`}return h&&g&&(A=r.join(``)+A),A=A.trim().replaceAll(`
`,`<br>`),{title:j,description:A}}async function f(e){let r=`https://m.douban.com/rexxar/api/v2/status/`;await Promise.all(e.map(async e=>{let i=r+e.status.id,a=await t.get(i);if(a)e.status.text=a;else{let{data:{text:r}}=await n({url:i,headers:l});t.set(i,r),e.status.text=r}if(e.status.reshared_status){if(i=r+e.status.reshared_status.id,a=await t.get(i),a)e.status.reshared_status.text=a;else if(u(e.status.reshared_status).isFixSuccess)try{let{data:{text:r}}=await n({url:i,headers:l});t.set(i,r),e.status.reshared_status.text=r}catch{e.status.reshared_status.text+=`
[获取原动态失败]`}}}))}async function p(r){let i=r.req.param(`userid`),a=`https://m.douban.com/rexxar/api/v2/status/user_timeline/${i}`,o=await t.tryGet(a,async()=>{let e=await n({url:a,headers:l});return e.data.items},e.cache.routeExpire,!1);return o&&await f(o),{title:`豆瓣广播 - ${o?o[0].status.author.name:i}`,link:`https://m.douban.com/people/${i}/statuses`,item:o&&o.filter(e=>!e.deleted).map(e=>{let t=d(r,e);return{title:t.title,link:e.status.sharing_url.replace(/\?_i=(.*)/,``),pubDate:new Date(Date.parse(e.status.create_time+` GMT+0800`)).toUTCString(),description:t.description}})}}export{c as route};
//# sourceMappingURL=status-sZT1UQ-e.js.map