{"version":3,"file":"community-D1xhHcRU.js","names":["route: Route","got"],"sources":["../../lib/routes/pikabu/community.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { baseUrl, fixImage, fixVideo } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/:type/:name',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { type, name, sort = 'new' } = ctx.req.param();\r\n    const sortString = sort === 'default' || type === 'tag' ? '' : `/${sort}`;\r\n    const { data: response } = await got(`${baseUrl}/ajax/${type}/${name}${sortString}`);\r\n\r\n    const items = response.data.stories.map((story) => {\r\n        const $ = load(story.html, null, false);\r\n        const data = JSON.parse($('script[type=\"application/ld+json\"]').text());\r\n\r\n        const content = $('.story__main');\r\n\r\n        fixImage(content);\r\n        content.find('.player').each((_, elem) => {\r\n            elem = $(elem);\r\n            fixVideo(elem);\r\n        });\r\n        return {\r\n            title: data.name,\r\n            description: content.find('.story__content-inner').html(),\r\n            pubDate: parseDate(data.dateCreated),\r\n            author: data.author.name,\r\n            link: data.url,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: response.data.title,\r\n        link: `${baseUrl}/${type}/${name}`,\r\n        language: 'ru-RU',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"2ZAMA,MAAaA,EAAe,CACxB,KAAM,eACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAM,OAAM,OAAO,OAAU,EAAI,IAAI,QACvC,EAAa,IAAS,WAAa,IAAS,MAAQ,GAAK,IAAI,IAC7D,CAAE,KAAM,GAAa,MAAMC,EAAI,GAAG,EAAQ,QAAQ,EAAK,GAAG,IAAO,KAEjE,EAAQ,EAAS,KAAK,QAAQ,IAAK,GAAU,CAC/C,IAAM,EAAI,EAAK,EAAM,KAAM,KAAM,IAC3B,EAAO,KAAK,MAAM,EAAE,sCAAsC,QAE1D,EAAU,EAAE,gBAOlB,OALA,EAAS,GACT,EAAQ,KAAK,WAAW,MAAM,EAAG,IAAS,CACtC,EAAO,EAAE,GACT,EAAS,KAEN,CACH,MAAO,EAAK,KACZ,YAAa,EAAQ,KAAK,yBAAyB,OACnD,QAAS,EAAU,EAAK,aACxB,OAAQ,EAAK,OAAO,KACpB,KAAM,EAAK,OAInB,MAAO,CACH,MAAO,EAAS,KAAK,MACrB,KAAM,GAAG,EAAQ,GAAG,EAAK,GAAG,IAC5B,SAAU,QACV,KAAM"}