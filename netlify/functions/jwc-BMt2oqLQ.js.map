{"version":3,"file":"jwc-BMt2oqLQ.js","names":["got","route: Route","got","util","cache"],"sources":["../../lib/routes/bit/jwc/utils.ts","../../lib/routes/bit/jwc/jwc.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\n// 专门定义一个function用于加载文章内容\r\nasync function loadContent(item) {\r\n    // 异步请求文章\r\n    const response = await got(item.link);\r\n    // 加载文章内容\r\n    const $ = load(response.data);\r\n\r\n    // 提取内容\r\n    item.description = $('.gp-article').html();\r\n\r\n    // 返回解析的结果\r\n    return item;\r\n}\r\n\r\nconst ProcessFeed = (list, caches) => {\r\n    const host = 'https://jwc.bit.edu.cn/tzgg/';\r\n\r\n    return Promise.all(\r\n        // 遍历每一篇文章\r\n        list.map((item) => {\r\n            const $ = load(item);\r\n\r\n            const $title = $('a');\r\n            // 还原相对链接为绝对链接\r\n            const itemUrl = new URL($title.attr('href'), host).href;\r\n\r\n            // 列表上提取到的信息\r\n            const single = {\r\n                title: $title.text(),\r\n                link: itemUrl,\r\n                author: '教务部',\r\n                pubDate: timezone(parseDate($('span').text()), 8),\r\n            };\r\n\r\n            // 使用tryGet方法从缓存获取内容。\r\n            // 当缓存中无法获取到链接内容的时候，则使用load方法加载文章内容。\r\n            return caches.tryGet(single.link, () => loadContent(single));\r\n        })\r\n    );\r\n};\r\n\r\nexport default { ProcessFeed };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport util from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/jwc',\r\n    categories: ['university'],\r\n    example: '/bit/jwc',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['jwc.bit.edu.cn/tzgg', 'jwc.bit.edu.cn/'],\r\n        },\r\n    ],\r\n    name: '教务处通知',\r\n    maintainers: ['sinofp'],\r\n    handler,\r\n    url: 'jwc.bit.edu.cn/tzgg',\r\n};\r\n\r\nasync function handler() {\r\n    const link = 'https://jwc.bit.edu.cn/tzgg/';\r\n    const response = await got({\r\n        method: 'get',\r\n        url: link,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    const list = $('li.gpTextArea').toArray();\r\n\r\n    const result = await util.ProcessFeed(list, cache);\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link,\r\n        description: '北京理工大学教务部',\r\n        item: result,\r\n    };\r\n}\r\n"],"mappings":"0ZAMA,eAAe,EAAY,EAAM,CAE7B,IAAM,EAAW,MAAME,EAAI,EAAK,MAE1B,EAAI,EAAK,EAAS,MAMxB,MAHA,GAAK,YAAc,EAAE,eAAe,OAG7B,EAGX,MAAM,GAAe,EAAM,IAGhB,QAAQ,IAEX,EAAK,IAAK,GAAS,CACf,IAAM,EAAI,EAAK,GAET,EAAS,EAAE,KAEX,EAAU,IAAI,IAAI,EAAO,KAAK,QAAS,gCAAM,KAG7C,EAAS,CACX,MAAO,EAAO,OACd,KAAM,EACN,OAAQ,MACR,QAAS,EAAS,EAAU,EAAE,QAAQ,QAAS,IAKnD,OAAO,EAAO,OAAO,EAAO,SAAY,EAAY,OAKhE,IAAA,EAAe,CAAE,eCxCjB,MAAaD,EAAe,CACxB,KAAM,OACN,WAAY,CAAC,cACb,QAAS,WACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,sBAAuB,qBAGxC,KAAM,QACN,YAAa,CAAC,UACd,UACA,IAAK,uBAGT,eAAe,GAAU,CACrB,IAAM,EAAO,+BACP,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,iBAAiB,UAE1B,EAAS,MAAMC,EAAK,YAAY,EAAMC,GAE5C,MAAO,CACH,MAAO,EAAE,SAAS,OAClB,OACA,YAAa,YACb,KAAM"}