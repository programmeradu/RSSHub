{"version":3,"file":"album-BWVcb56D.js","names":["route: Route","got"],"sources":["../../lib/routes/google/album.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/album/:id',\r\n    categories: ['picture'],\r\n    example: '/google/album/msFFnAzKmQmWj76EA',\r\n    parameters: { id: 'album ID, can be found in URL, for example, `https://photos.app.goo.gl/msFFnAzKmQmWj76EA` to `msFFnAzKmQmWj76EA`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Public Albums',\r\n    maintainers: ['hoilc'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n\r\n    const url = `https://photos.app.goo.gl/${id}?_imcp=1`;\r\n\r\n    const response = await got.get(url);\r\n\r\n    const real_url = response.request.options.url.href;\r\n\r\n    const info = JSON.parse(response.data.match(/AF_initDataCallback.*?data:(\\[[\\S\\s]*])\\s/m)[1]) || [];\r\n\r\n    const album_name = info[3][1];\r\n    const owner_name = info[3][5][2];\r\n\r\n    const list = info[1];\r\n\r\n    return {\r\n        title: `${owner_name} 创建的 Google 相册 - ${album_name}`,\r\n        link: url,\r\n        item: list.slice(0, 50).map((item) => {\r\n            const time = new Date(item[2] * 1);\r\n            const isVideo = Object.keys(item[15]).length > 2; // uncertain\r\n            const description = isVideo ? `<video src=\"${item[1][0]}=m18\" controls controlslist=\"nodownload\" loop style=\"max-width: 100%;\">` : `<img src=\"${item[1][0]}=w${item[1][1]}-h${item[1][2]}-no\" style=\"max-width: 100%;\">`;\r\n            return {\r\n                title: time.toLocaleString(),\r\n                author: album_name,\r\n                description,\r\n                pubDate: time,\r\n                link: real_url.replace('?', `/photo/${item[0]}?`),\r\n                guid: item[0],\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"gOAGA,MAAaA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,WACb,QAAS,kCACT,WAAY,CAAE,GAAI,oHAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,gBACN,YAAa,CAAC,SACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MAEnB,EAAM,6BAA6B,EAAG,UAEtC,EAAW,MAAMC,EAAI,IAAI,GAEzB,EAAW,EAAS,QAAQ,QAAQ,IAAI,KAExC,EAAO,KAAK,MAAM,EAAS,KAAK,MAAM,8CAA8C,KAAO,GAE3F,EAAa,EAAK,GAAG,GACrB,EAAa,EAAK,GAAG,GAAG,GAExB,EAAO,EAAK,GAElB,MAAO,CACH,MAAO,GAAG,EAAW,mBAAmB,IACxC,KAAM,EACN,KAAM,EAAK,MAAM,EAAG,IAAI,IAAK,GAAS,CAClC,IAAM,EAAO,IAAI,KAAK,EAAK,GAAK,GAC1B,EAAU,OAAO,KAAK,EAAK,KAAK,OAAS,EACzC,EAAc,EAAU,eAAe,EAAK,GAAG,GAAG,yEAA2E,aAAa,EAAK,GAAG,GAAG,IAAI,EAAK,GAAG,GAAG,IAAI,EAAK,GAAG,GAAG,gCACzL,MAAO,CACH,MAAO,EAAK,iBACZ,OAAQ,EACR,cACA,QAAS,EACT,KAAM,EAAS,QAAQ,IAAK,UAAU,EAAK,GAAG,IAC9C,KAAM,EAAK"}