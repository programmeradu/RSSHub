{"version":3,"file":"user-stock-6OAjr5BJ.js","names":["route: Route","ConfigNotFoundError","ofetch"],"sources":["../../lib/routes/xueqiu/user-stock.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { config } from '@/config';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/user_stock/:id',\r\n    categories: ['finance'],\r\n    example: '/xueqiu/user_stock/1247347556',\r\n    parameters: { id: '用户 id, 可在用户主页 URL 中找到' },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'XUEQIU_COOKIES',\r\n                description: '',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['xueqiu.com/u/:id'],\r\n        },\r\n    ],\r\n    name: '用户自选动态',\r\n    maintainers: ['hillerliao'],\r\n    handler,\r\n    description: `::: warning\r\n  用户自选动态需要登录后的 Cookie 值，所以只能自建，详情见部署页面的配置模块。\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const cookie = config.xueqiu.cookies;\r\n    if (cookie === undefined) {\r\n        throw new ConfigNotFoundError('缺少雪球用户登录后的 Cookie 值');\r\n    }\r\n\r\n    const id = ctx.req.param('id');\r\n\r\n    const {\r\n        data: { stocks: data },\r\n    } = await ofetch(`https://stock.xueqiu.com/v5/stock/portfolio/stock/list.json?category=1&size=1000&uid=${id}`, {\r\n        headers: {\r\n            Cookie: cookie,\r\n            Referer: `https://xueqiu.com/u/${id}`,\r\n        },\r\n    });\r\n\r\n    const {\r\n        user: { screen_name },\r\n    } = await ofetch('https://xueqiu.com/statuses/original/show.json', {\r\n        query: {\r\n            user_id: id,\r\n        },\r\n        headers: {\r\n            Cookie: cookie,\r\n            Referer: `https://xueqiu.com/u/${id}`,\r\n        },\r\n    });\r\n\r\n    return {\r\n        title: `${screen_name} 的雪球自选动态`,\r\n        link: `https://xueqiu.com/u/${id}`,\r\n        description: `@${screen_name} 的雪球自选动态`,\r\n        item: data.map((item) => ({\r\n            title: `@${screen_name} 关注了股票 ${item.name}`,\r\n            description: `@${screen_name} 在${parseDate(item.created).toLocaleString()} 关注了 ${item.marketplace} ${item.name}(${item.exchange}:${item.symbol})。`,\r\n            pubDate: parseDate(item.created),\r\n            link: `https://xueqiu.com/s/${item.symbol}`,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"2TAMA,MAAaA,EAAe,CACxB,KAAM,kBACN,WAAY,CAAC,WACb,QAAS,gCACT,WAAY,CAAE,GAAI,yBAClB,SAAU,CACN,cAAe,CACX,CACI,KAAM,iBACN,YAAa,KAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,sBAGjB,KAAM,SACN,YAAa,CAAC,cACd,UACA,YAAa;;MAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,EAAO,OAAO,QAC7B,GAAI,IAAW,IAAA,GACX,MAAM,IAAIC,EAAoB,uBAGlC,IAAM,EAAK,EAAI,IAAI,MAAM,MAEnB,CACF,KAAM,CAAE,OAAQ,IAChB,MAAMC,EAAO,wFAAwF,IAAM,CAC3G,QAAS,CACL,OAAQ,EACR,QAAS,wBAAwB,OAInC,CACF,KAAM,CAAE,gBACR,MAAMA,EAAO,iDAAkD,CAC/D,MAAO,CACH,QAAS,GAEb,QAAS,CACL,OAAQ,EACR,QAAS,wBAAwB,OAIzC,MAAO,CACH,MAAO,GAAG,EAAY,UACtB,KAAM,wBAAwB,IAC9B,YAAa,IAAI,EAAY,UAC7B,KAAM,EAAK,IAAK,IAAU,CACtB,MAAO,IAAI,EAAY,SAAS,EAAK,OACrC,YAAa,IAAI,EAAY,IAAI,EAAU,EAAK,SAAS,iBAAiB,OAAO,EAAK,YAAY,GAAG,EAAK,KAAK,GAAG,EAAK,SAAS,GAAG,EAAK,OAAO,IAC/I,QAAS,EAAU,EAAK,SACxB,KAAM,wBAAwB,EAAK"}