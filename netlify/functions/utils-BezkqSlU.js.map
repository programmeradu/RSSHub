{"version":3,"file":"utils-BezkqSlU.js","names":[],"sources":["../../lib/routes/javlibrary/utils.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst rootUrl = 'https://www.javlibrary.com';\r\nconst defaultMode = '1';\r\nconst defaultGenre = 'amjq';\r\nconst defaultMaker = 'arlq';\r\nconst defaultLanguage = 'ja';\r\nconst ProcessItems = async (language, currentUrl, tryGet) => {\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    $('.toolbar, .info, .videoinfo').remove();\r\n\r\n    let items = $('.videotextlist, #video_comments')\r\n        .find('a')\r\n        .toArray()\r\n        .filter((i) => $(i).parent().hasClass('video') || $(i).parent().get(0).tagName === 'strong')\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const table = item.parentsUntil('table');\r\n            const link = `${rootUrl}/${language}/${item.attr('href').replace(/^\\.\\//, '')}`;\r\n\r\n            return {\r\n                link, // url to target content.\r\n                url: link.replace(/video.*\\.php/, ''), // url to the video page.\r\n\r\n                title: item.text(),\r\n                description: table.find('textarea').text(),\r\n                pubDate: parseDate(table.find('.date').text()),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            tryGet(item.url, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.url,\r\n                });\r\n\r\n                const content = load(detailResponse.data);\r\n\r\n                content('.icn_edit, .btn_videoplayer, a[rel=\"bookmark\"]').remove();\r\n                content('span').each(function () {\r\n                    if (content(this).attr('class')?.startsWith('icn_')) {\r\n                        content(this).remove();\r\n                    }\r\n                });\r\n\r\n                item.author = content('.star')\r\n                    .toArray()\r\n                    .map((star) => content(star).text())\r\n                    .filter((star) => star !== '')\r\n                    .join(',');\r\n                item.category = content('a[rel]')\r\n                    .toArray()\r\n                    .map((tag) => content(tag).text())\r\n                    .filter((tag) => tag !== '');\r\n                item.description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    cover: content('#video_jacket_img').attr('src'),\r\n                    info: content('#video_info').html().replaceAll('span><span', 'span>,&nbsp;<span'),\r\n                    comment: item.description?.replace(/\\[img]/g, '<img src=\"')?.replace(/\\[\\/img]/g, '\"/>'),\r\n                    thumbs: content('.previewthumbs img')\r\n                        .toArray()\r\n                        .map((img) => content(img).attr('src').replaceAll('-', 'jp-')),\r\n                    videos: [...new Set(detailResponse.data.match(/(http[^\"[\\]]+\\.mp4)/g))],\r\n                });\r\n                item.pubDate = item.pubDate.toString() === 'Invalid Date' ? parseDate(content('#video_date').find('.text').text()) : item.pubDate;\r\n\r\n                delete item.url;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n    };\r\n};\r\n\r\nexport { rootUrl, defaultMode, defaultGenre, defaultMaker, defaultLanguage, ProcessItems };\r\n"],"mappings":"oRAMA,MAAM,EAAU,6BACV,EAAc,IACd,EAAe,OACf,EAAe,OACf,EAAkB,KAClB,EAAe,MAAO,EAAU,EAAY,IAAW,CACzD,IAAM,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAExB,EAAE,+BAA+B,SAEjC,IAAI,EAAQ,EAAE,mCACT,KAAK,KACL,UACA,OAAQ,GAAM,EAAE,GAAG,SAAS,SAAS,UAAY,EAAE,GAAG,SAAS,IAAI,GAAG,UAAY,UAClF,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAQ,EAAK,aAAa,SAC1B,EAAO,GAAG,EAAQ,GAAG,EAAS,GAAG,EAAK,KAAK,QAAQ,QAAQ,QAAS,MAE1E,MAAO,CACH,OACA,IAAK,EAAK,QAAQ,eAAgB,IAElC,MAAO,EAAK,OACZ,YAAa,EAAM,KAAK,YAAY,OACpC,QAAS,EAAU,EAAM,KAAK,SAAS,WAgDnD,MA5CA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACP,EAAO,EAAK,IAAK,SAAY,CACzB,IAAM,EAAiB,MAAM,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,MAGR,EAAU,EAAK,EAAe,MA+BpC,OA7BA,EAAQ,kDAAkD,SAC1D,EAAQ,QAAQ,KAAK,UAAY,CACzB,EAAQ,MAAM,KAAK,UAAU,WAAW,SACxC,EAAQ,MAAM,WAItB,EAAK,OAAS,EAAQ,SACjB,UACA,IAAK,GAAS,EAAQ,GAAM,QAC5B,OAAQ,GAAS,IAAS,IAC1B,KAAK,KACV,EAAK,SAAW,EAAQ,UACnB,UACA,IAAK,GAAQ,EAAQ,GAAK,QAC1B,OAAQ,GAAQ,IAAQ,IAC7B,EAAK,YAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACtE,MAAO,EAAQ,qBAAqB,KAAK,OACzC,KAAM,EAAQ,eAAe,OAAO,WAAW,aAAc,qBAC7D,QAAS,EAAK,aAAa,QAAQ,UAAW,eAAe,QAAQ,YAAa,OAClF,OAAQ,EAAQ,sBACX,UACA,IAAK,GAAQ,EAAQ,GAAK,KAAK,OAAO,WAAW,IAAK,QAC3D,OAAQ,CAAC,GAAG,IAAI,IAAI,EAAe,KAAK,MAAM,4BAElD,EAAK,QAAU,EAAK,QAAQ,aAAe,eAAiB,EAAU,EAAQ,eAAe,KAAK,SAAS,QAAU,EAAK,QAE1H,OAAO,EAAK,IAEL,MAKZ,CACH,MAAO,EAAE,SAAS,OAClB,KAAM,EACN,KAAM,EACN,WAAY"}