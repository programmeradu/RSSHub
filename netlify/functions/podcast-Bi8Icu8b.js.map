{"version":3,"file":"podcast-Bi8Icu8b.js","names":["route: Route","got"],"sources":["../../lib/routes/apple/podcast.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/podcast/:id/:region?',\r\n    categories: ['multimedia'],\r\n    example: '/apple/podcast/id1559695855/cn',\r\n    parameters: {\r\n        id: '播客id，可以在 Apple 播客app 内分享的播客的 URL 中找到',\r\n        region: '地區代碼，例如 cn、us、jp，預設為 cn',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['podcasts.apple.com/:region/podcast/:id'],\r\n        },\r\n    ],\r\n    name: '播客',\r\n    maintainers: ['Acring'],\r\n    handler,\r\n    url: 'www.apple.com/apple-podcasts/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { id, region } = ctx.req.param();\r\n    const link = `https://podcasts.apple.com/${region || `cn`}/podcast/${id}`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url: link,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    const schemaShow = JSON.parse($(String.raw`#schema\\:show`).text());\r\n    const serializedServerData = JSON.parse($('#serialized-server-data').text());\r\n\r\n    const seoEpisodes = schemaShow.workExample;\r\n    const originEpisodes = serializedServerData[0].data.shelves.find((item) => item.contentType === 'episode').items;\r\n    const header = serializedServerData[0].data.shelves.find((item) => item.contentType === 'showHeaderRegular').items[0];\r\n\r\n    const episodes = originEpisodes.map((item) => {\r\n        // Try to keep line breaks in the description\r\n        const matchedSeoEpisode = seoEpisodes.find((seoEpisode) => seoEpisode.name === item.title) || null;\r\n        const episodeDescription = (matchedSeoEpisode ? matchedSeoEpisode.description : item.summary).replaceAll('\\n', '<br>');\r\n\r\n        return {\r\n            title: item.title,\r\n            enclosure_url: item.playAction.episodeOffer.streamUrl,\r\n            enclosure_type: 'audio/mp4',\r\n            itunes_duration: item.duration,\r\n            link: item.playAction.episodeOffer.storeUrl,\r\n            pubDate: parseDate(item.releaseDate),\r\n            description: episodeDescription,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: header.title,\r\n        link: header.contextAction.podcastOffer.storeUrl,\r\n        itunes_author: header.contextAction.podcastOffer.author,\r\n        item: episodes,\r\n        description: header.description.replaceAll('\\n', ' '),\r\n    };\r\n}\r\n"],"mappings":"oTAKA,MAAaA,EAAe,CACxB,KAAM,wBACN,WAAY,CAAC,cACb,QAAS,iCACT,WAAY,CACR,GAAI,uCACJ,OAAQ,2BAEZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,4CAGjB,KAAM,KACN,YAAa,CAAC,UACd,UACA,IAAK,iCAGT,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,KAAI,UAAW,EAAI,IAAI,QACzB,EAAO,8BAA8B,GAAU,KAAK,WAAW,IAC/D,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAElB,EAAa,KAAK,MAAM,EAAE,OAAO,GAAG,iBAAiB,QACrD,EAAuB,KAAK,MAAM,EAAE,2BAA2B,QAE/D,EAAc,EAAW,YACzB,EAAiB,EAAqB,GAAG,KAAK,QAAQ,KAAM,GAAS,EAAK,cAAgB,WAAW,MACrG,EAAS,EAAqB,GAAG,KAAK,QAAQ,KAAM,GAAS,EAAK,cAAgB,qBAAqB,MAAM,GAE7G,EAAW,EAAe,IAAK,GAAS,CAE1C,IAAM,EAAoB,EAAY,KAAM,GAAe,EAAW,OAAS,EAAK,QAAU,KACxF,GAAsB,EAAoB,EAAkB,YAAc,EAAK,SAAS,WAAW;EAAM,QAE/G,MAAO,CACH,MAAO,EAAK,MACZ,cAAe,EAAK,WAAW,aAAa,UAC5C,eAAgB,YAChB,gBAAiB,EAAK,SACtB,KAAM,EAAK,WAAW,aAAa,SACnC,QAAS,EAAU,EAAK,aACxB,YAAa,KAIrB,MAAO,CACH,MAAO,EAAO,MACd,KAAM,EAAO,cAAc,aAAa,SACxC,cAAe,EAAO,cAAc,aAAa,OACjD,KAAM,EACN,YAAa,EAAO,YAAY,WAAW;EAAM"}