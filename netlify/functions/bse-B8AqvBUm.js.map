{"version":3,"file":"bse-B8AqvBUm.js","names":["route: Route","got"],"sources":["../../lib/routes/bse/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst nodes = {\r\n    important_news: {\r\n        id: 1289,\r\n        title: '本所要闻',\r\n        url: '/news/important_news.html',\r\n        type: '/info/listse',\r\n    },\r\n    recruit: {\r\n        id: 1380,\r\n        title: '人才招聘',\r\n        url: '/company/recruit.html',\r\n        type: '/info/listse',\r\n    },\r\n    purchase: {\r\n        id: 1381,\r\n        title: '采购信息',\r\n        url: '/purchase/list.html',\r\n        type: '/info/listse',\r\n    },\r\n    news_list: {\r\n        id: 2676,\r\n        title: '业务通知',\r\n        url: '/news/news_list.html',\r\n        type: '/info/listse',\r\n    },\r\n    law_list: {\r\n        id: 1322,\r\n        title: '法律法规',\r\n        url: '/rule/law_list.html',\r\n        type: '/info/listse',\r\n    },\r\n    public_opinion: {\r\n        id: 1307,\r\n        title: '公开征求意见',\r\n        url: '/rule/public_opinion.html',\r\n        type: '/info/listse',\r\n    },\r\n    regulation_list: {\r\n        id: 1300,\r\n        title: '部门规章',\r\n        url: '/rule/regulation_list.html',\r\n        type: '/info/listse',\r\n    },\r\n    fxrz_list: {\r\n        id: 1302,\r\n        title: '发行融资',\r\n        url: '/business/fxrz_list.html',\r\n        type: '/info/listse',\r\n    },\r\n    cxjg_list: {\r\n        id: 1303,\r\n        title: '持续监管',\r\n        url: '/business/cxjg_list.html',\r\n        type: '/info/listse',\r\n    },\r\n    jygl_list: {\r\n        id: 1304,\r\n        title: '交易管理',\r\n        url: '/business/jygl_list.html',\r\n        type: '/info/listse',\r\n    },\r\n    scgl_list: {\r\n        id: 1306,\r\n        title: '市场管理',\r\n        url: '/business/scgl_list.html',\r\n        type: '/info/listse',\r\n    },\r\n    meeting_notice: {\r\n        id: '9531-1001',\r\n        title: '上市委会议公告',\r\n        url: '/notice/meeting_notice.html',\r\n        type: '/disclosureInfoController/zoneInfoResult',\r\n    },\r\n    meeting_result: {\r\n        id: '9531-1002',\r\n        title: '上市委会议结果公告',\r\n        url: '/notice/meeting_result.html',\r\n        type: '/disclosureInfoController/zoneInfoResult',\r\n    },\r\n    meeting_change: {\r\n        id: '9531-1003',\r\n        title: '上市委会议变更公告',\r\n        url: '/notice/meeting_notice.html',\r\n        type: '/disclosureInfoController/zoneInfoResult',\r\n    },\r\n    bgcz_notice: {\r\n        id: '9536-1001',\r\n        title: '并购重组委会议公告',\r\n        url: '/notice/bgcz_notice.html',\r\n        type: '/disclosureInfoController/zoneInfoResult',\r\n    },\r\n    bgcz_result: {\r\n        id: '9536-1002',\r\n        title: '并购重组委会议结果公告',\r\n        url: '/notice/bgcz_result.html',\r\n        type: '/disclosureInfoController/zoneInfoResult',\r\n    },\r\n    bgcz_change: {\r\n        id: '9536-1003',\r\n        title: '并购重组委会议变更公告',\r\n        url: '/notice/bgcz_notice.html',\r\n        type: '/disclosureInfoController/zoneInfoResult',\r\n    },\r\n    termination_audit: {\r\n        id: '9530-3001',\r\n        title: '终止审核',\r\n        url: '/notice/termination_audit.html',\r\n        type: '/disclosureInfoController/zoneInfoResult',\r\n    },\r\n    audit_result: {\r\n        id: '9532-1001',\r\n        title: '注册结果',\r\n        url: '/notice/audit_result.html',\r\n        type: '/disclosureInfoController/zoneInfoResult',\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category?/:keyword?',\r\n    categories: ['finance'],\r\n    example: '/bse',\r\n    parameters: { category: '分类，见下表，默认为本所要闻', keyword: '关键字，默认为空' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['bse.cn/'],\r\n        },\r\n    ],\r\n    name: '栏目',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    url: 'bse.cn/',\r\n    description: `| 本所要闻        | 人才招聘 | 采购信息 | 业务通知   |\r\n| --------------- | -------- | -------- | ---------- |\r\n| important\\_news | recruit  | purchase | news\\_list |\r\n\r\n| 法律法规  | 公开征求意见    | 部门规章         | 发行融资   |\r\n| --------- | --------------- | ---------------- | ---------- |\r\n| law\\_list | public\\_opinion | regulation\\_list | fxrz\\_list |\r\n\r\n| 持续监管   | 交易管理   | 市场管理   | 上市委会议公告  |\r\n| ---------- | ---------- | ---------- | --------------- |\r\n| cxjg\\_list | jygl\\_list | scgl\\_list | meeting\\_notice |\r\n\r\n| 上市委会议结果公告 | 上市委会议变更公告 | 并购重组委会议公告 |\r\n| ------------------ | ------------------ | ------------------ |\r\n| meeting\\_result    | meeting\\_change    | bgcz\\_notice       |\r\n\r\n| 并购重组委会议结果公告 | 并购重组委会议变更公告 | 终止审核           | 注册结果      |\r\n| ---------------------- | ---------------------- | ------------------ | ------------- |\r\n| bgcz\\_result           | bgcz\\_change           | termination\\_audit | audit\\_result |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? 'important_news';\r\n    const keyword = ctx.req.param('keyword') ?? '';\r\n\r\n    const type = nodes[category].type;\r\n    const rootUrl = 'http://www.bse.cn';\r\n    const currentUrl = `${rootUrl}${type}.do`;\r\n\r\n    const response = await got({\r\n        method: 'post',\r\n        url: currentUrl,\r\n        form: {\r\n            page: 0,\r\n            pageSize: ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 50,\r\n            keywords: keyword,\r\n            'nodeIds[]': type === '/info/listse' ? nodes[category].id : undefined,\r\n            disclosureSubtype: type === '/info/listse' ? undefined : nodes[category].id,\r\n        },\r\n    });\r\n\r\n    const data = JSON.parse(response.data.match(/null\\(\\[({.*})]\\)/)[1]);\r\n\r\n    let items = [];\r\n\r\n    switch (nodes[category].type) {\r\n        case '/info/listse':\r\n            items = data.data.content.map((item) => ({\r\n                title: item.title,\r\n                category: item.tags,\r\n                description: item.text,\r\n                link: `${rootUrl}${item.htmlUrl}`,\r\n                pubDate: timezone(parseDate(item.publishDate), +8),\r\n            }));\r\n            break;\r\n\r\n        case '/disclosureInfoController/zoneInfoResult':\r\n            items = data.listInfo.content.map((item) => ({\r\n                title: item.disclosureTitle,\r\n                link: `${rootUrl}${item.destFilePath}`,\r\n                pubDate: parseDate(item.pubDate.time),\r\n            }));\r\n            break;\r\n    }\r\n\r\n    return {\r\n        title: `${nodes[category].title} - 北京证券交易所`,\r\n        link: `${rootUrl}${nodes[category].url}`,\r\n        item: items,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"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"}