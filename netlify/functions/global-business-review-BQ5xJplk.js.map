{"version":3,"file":"global-business-review-BQ5xJplk.js","names":["cache","got","route: Route"],"sources":["../../lib/routes/economist/global-business-review.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\n\r\nconst ALLOW_LANGUAGE = {\r\n    en: 'en_GB',\r\n    cn: 'zh_CN',\r\n    tw: 'zh_TW',\r\n};\r\n\r\nconst TITLE = {\r\n    en: 'The Economist Global Business Review',\r\n    cn: '经济学人 · 商论',\r\n    tw: '經濟學人 · 商論',\r\n};\r\n\r\nconst DESCRIPTION = {\r\n    en: 'The Economist Global Business Review is a new bilingual digital app from the editors of The Economist Group.',\r\n    cn: '《经济学人·商论》是《经济学人》2015年5月推出的旗下中英双语APP，萃取《经济学人》在商业、金融、科技等领域的精华文章，为中国读者呈现全球视角的深度分析，并鼓励中国的读者批判性地思考中国和全球重大议题。',\r\n    tw: '《經濟學人·商論》是經濟學人集團官方中英雙語電子APP，萃取《經濟學人》在商業、金融、科技等領域的精華文章，為中國讀者呈現全球視角的深度分析，並鼓勵中國的讀者批判性地思考中國和全球的重大議題。',\r\n};\r\n\r\nconst parseContent = function (item, article_id, language) {\r\n    switch (item.type) {\r\n        case 'paragraph':\r\n            return parseParagraph(item.data, language);\r\n\r\n        case 'image':\r\n            return parseImage(item.data, article_id, language);\r\n\r\n        case 'subtitle':\r\n            return parseParagraph(item.data, language, 'h3');\r\n\r\n        default:\r\n            throw new Error(`Unknown type: ${item.type}`);\r\n    }\r\n};\r\n\r\nconst parseTitle = function (data, language) {\r\n    const content = Object.assign({}, ...data.map((x) => ({ [x.lang]: x.text })));\r\n    return language.map((item) => content[ALLOW_LANGUAGE[item]]).join('');\r\n};\r\n\r\nconst parseParagraph = function (data, language, type = 'p') {\r\n    const content = Object.assign({}, ...data.map((x) => ({ [x.lang]: x.text })));\r\n    return `<div>${language.map((item) => `<${type}>${content[ALLOW_LANGUAGE[item]]}</${type}>`).join('')}</div>`;\r\n};\r\n\r\nconst parseImage = function (data, article_id, language) {\r\n    const content = Object.assign({}, ...data.map((x) => ({ [x.lang]: x.image_path })));\r\n    return `<div><img src=\"https://businessreviewglobal-cdn.com/article_images/${article_id}/${encodeURIComponent(content[ALLOW_LANGUAGE[language[0]]])}\"/></div>`;\r\n};\r\n\r\nconst getArticleDetail = (article_id, language) => {\r\n    const link = `https://api.hummingbird.businessreview.global/api/article/index?id=${article_id}`;\r\n    return cache.tryGet(`${link}:${language.join('-')}`, async () => {\r\n        const response = await got({\r\n            method: 'get',\r\n            url: link,\r\n        });\r\n        const data = response.data.body;\r\n        let content = '';\r\n        content += parseParagraph(data.rubric, language);\r\n        content += data.content.map((item) => parseContent(item, article_id, language)).join('');\r\n        return content;\r\n    });\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/global-business-review/:language?',\r\n    categories: ['traditional-media'],\r\n    example: '/economist/global-business-review/cn-en',\r\n    parameters: { language: 'Language, `en`, `cn`, `tw` are supported, support multiple options, default to cn-en' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['businessreview.global/'],\r\n            target: '/global-business-review',\r\n        },\r\n    ],\r\n    name: 'Global Business Review',\r\n    maintainers: ['prnake'],\r\n    handler,\r\n    url: 'businessreview.global/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const language = (ctx.req.param('language') &&\r\n        ctx.req\r\n            .param('language')\r\n            .split('-')\r\n            .filter((item, index, arr) => ALLOW_LANGUAGE[item] && arr.indexOf(item, 0) === index)) || ['cn', 'en'];\r\n    const main_language = language[0];\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: 'https://api.hummingbird.businessreview.global/api/toc/get_articles',\r\n    });\r\n\r\n    const items = await Promise.all(\r\n        response.data.articles.new.slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 10).map(async (item) => ({\r\n            title: parseTitle(item.body.title, [main_language]),\r\n            description: await getArticleDetail(item.article_id, language),\r\n            category: parseTitle(item.body.fly_title, [main_language]),\r\n            link: `https://www.businessreview.global/latest/${item.article_id}`,\r\n            pubDate: item.publication_date,\r\n        }))\r\n    );\r\n\r\n    return {\r\n        title: TITLE[main_language],\r\n        link: 'https://www.businessreview.global',\r\n        description: DESCRIPTION[main_language],\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"oRAIA,MAAM,EAAiB,CACnB,GAAI,QACJ,GAAI,QACJ,GAAI,SAGF,EAAQ,CACV,GAAI,uCACJ,GAAI,YACJ,GAAI,aAGF,EAAc,CAChB,GAAI,+GACJ,GAAI,0GACJ,GAAI,oGAGF,EAAe,SAAU,EAAM,EAAY,EAAU,CACvD,OAAQ,EAAK,KAAb,CACI,IAAK,YACD,OAAO,EAAe,EAAK,KAAM,GAErC,IAAK,QACD,OAAO,EAAW,EAAK,KAAM,EAAY,GAE7C,IAAK,WACD,OAAO,EAAe,EAAK,KAAM,EAAU,MAE/C,QACI,MAAU,MAAM,iBAAiB,EAAK,UAI5C,EAAa,SAAU,EAAM,EAAU,CACzC,IAAM,EAAU,OAAO,OAAO,GAAI,GAAG,EAAK,IAAK,IAAO,EAAG,EAAE,MAAO,EAAE,SACpE,OAAO,EAAS,IAAK,GAAS,EAAQ,EAAe,KAAQ,KAAK,KAGhE,EAAiB,SAAU,EAAM,EAAU,EAAO,IAAK,CACzD,IAAM,EAAU,OAAO,OAAO,GAAI,GAAG,EAAK,IAAK,IAAO,EAAG,EAAE,MAAO,EAAE,SACpE,MAAO,QAAQ,EAAS,IAAK,GAAS,IAAI,EAAK,GAAG,EAAQ,EAAe,IAAO,IAAI,EAAK,IAAI,KAAK,IAAI,SAGpG,EAAa,SAAU,EAAM,EAAY,EAAU,CACrD,IAAM,EAAU,OAAO,OAAO,GAAI,GAAG,EAAK,IAAK,IAAO,EAAG,EAAE,MAAO,EAAE,eACpE,MAAO,sEAAsE,EAAW,GAAG,mBAAmB,EAAQ,EAAe,EAAS,MAAM,YAGlJ,GAAoB,EAAY,IAAa,CAC/C,IAAM,EAAO,sEAAsE,IACnF,OAAOA,EAAM,OAAO,GAAG,EAAK,GAAG,EAAS,KAAK,OAAQ,SAAY,CAC7D,IAAM,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAEH,EAAO,EAAS,KAAK,KACvB,EAAU,GAGd,MAFA,IAAW,EAAe,EAAK,OAAQ,GACvC,GAAW,EAAK,QAAQ,IAAK,GAAS,EAAa,EAAM,EAAY,IAAW,KAAK,IAC9E,KAIFC,EAAe,CACxB,KAAM,qCACN,WAAY,CAAC,qBACb,QAAS,0CACT,WAAY,CAAE,SAAU,wFACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,0BACT,OAAQ,4BAGhB,KAAM,yBACN,YAAa,CAAC,UACd,UACA,IAAK,0BAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAY,EAAI,IAAI,MAAM,aAC5B,EAAI,IACC,MAAM,YACN,MAAM,KACN,QAAQ,EAAM,EAAO,IAAQ,EAAe,IAAS,EAAI,QAAQ,EAAM,KAAO,IAAW,CAAC,KAAM,MACnG,EAAgB,EAAS,GAEzB,EAAW,MAAMD,EAAI,CACvB,OAAQ,MACR,IAAK,uEAGH,EAAQ,MAAM,QAAQ,IACxB,EAAS,KAAK,SAAS,IAAI,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAAI,IAAI,KAAO,KAAU,CAC5H,MAAO,EAAW,EAAK,KAAK,MAAO,CAAC,IACpC,YAAa,MAAM,EAAiB,EAAK,WAAY,GACrD,SAAU,EAAW,EAAK,KAAK,UAAW,CAAC,IAC3C,KAAM,4CAA4C,EAAK,aACvD,QAAS,EAAK,qBAItB,MAAO,CACH,MAAO,EAAM,GACb,KAAM,oCACN,YAAa,EAAY,GACzB,KAAM"}