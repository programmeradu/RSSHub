{"version":3,"file":"utils-DryydLHN.js","names":[],"sources":["../../lib/routes/visionias/utils.ts"],"sourcesContent":["import { DataItem } from '@/types';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\n\r\nexport const baseUrl = 'https://visionias.in';\r\n\r\nexport async function extractNews(item, selector) {\r\n    if (item.link === '') {\r\n        return item;\r\n    }\r\n    return await cache.tryGet(item.link, async () => {\r\n        const response = await ofetch(item.link || '');\r\n        const $$ = load(response);\r\n        const postedDate = String($$('meta[property=\"article:published_time\"]').attr('content'));\r\n        const updatedDate = String($$('meta[property=\"article:modified_time\"]').attr('content'));\r\n        const tags = $$('meta[property=\"article:tag\"]')\r\n            .toArray()\r\n            .map((tag) => $$(tag).attr('content'));\r\n        const content = $$(selector);\r\n        const heading = content.find('div.space-y-4 > h1').text();\r\n        const mainGroup = content.find('div.flex > div.w-full');\r\n\r\n        const shortArticles = mainGroup.find('[x-data^=\"{isShortArticleOpen\"]');\r\n        const sections = mainGroup.find('[x-data^=\"{isSectionOpen\"]');\r\n        if (shortArticles.length !== 0) {\r\n            const items = shortArticles.toArray().map((element) => {\r\n                const mainDiv = $$(element);\r\n                const title = mainDiv.find('a > div > h2').text().trim();\r\n                const id = mainDiv.find('a').attr('href');\r\n                const htmlContent = extractArticle(mainDiv.html());\r\n                const innerTags = mainDiv\r\n                    .find('ul > li:contains(\"Tags :\")')\r\n                    ?.nextAll('li')\r\n                    .toArray()\r\n                    .map((tag) => $$(tag).text());\r\n                const description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    heading: title,\r\n                    articleContent: htmlContent,\r\n                });\r\n                return {\r\n                    title: `${title} | ${heading}`,\r\n                    pubDate: parseDate(postedDate),\r\n                    category: innerTags,\r\n                    description,\r\n                    link: `${item.link}${id}`,\r\n                    author: 'Vision IAS',\r\n                } as DataItem;\r\n            });\r\n            return items;\r\n        } else if (sections.length === 0) {\r\n            const htmlContent = extractArticle(mainGroup.html());\r\n            const description = art(path.join(__dirname, 'templates/description.art'), {\r\n                heading,\r\n                articleContent: htmlContent,\r\n            });\r\n            return {\r\n                title: item.title,\r\n                pubDate: parseDate(postedDate),\r\n                category: tags,\r\n                description,\r\n                link: item.link,\r\n                updated: updatedDate ? parseDate(updatedDate) : null,\r\n                author: 'Vision IAS',\r\n            } as DataItem;\r\n        } else {\r\n            const items = sections.toArray().map((element) => {\r\n                const mainDiv = $$(element);\r\n                const title = mainDiv.find('a > div > h2').text().trim();\r\n                const htmlContent = extractArticle(mainDiv.html(), 'div.ck-content');\r\n                const description = art(path.join(__dirname, 'templates/description-sub.art'), {\r\n                    heading: title,\r\n                    articleContent: htmlContent,\r\n                });\r\n                return { description };\r\n            });\r\n            const description = art(path.join(__dirname, 'templates/description.art'), {\r\n                heading,\r\n                subItems: items,\r\n            });\r\n            return {\r\n                title: heading,\r\n                pubDate: parseDate(postedDate),\r\n                category: tags,\r\n                description,\r\n                link: item.link,\r\n                updated: updatedDate ? parseDate(updatedDate) : null,\r\n                author: 'Vision IAS',\r\n            } as DataItem;\r\n        }\r\n    });\r\n}\r\n\r\nfunction extractArticle(articleDiv, selectorString: string = 'div.ck-content') {\r\n    const $ = load(articleDiv, null, false);\r\n    const articleDiv$ = $(articleDiv);\r\n    const articleContent = articleDiv$.find(String(selectorString));\r\n    articleContent.find('figure').each((_, element) => {\r\n        $(element).css('width', '');\r\n    });\r\n    const htmlContent = articleContent.html();\r\n    return htmlContent;\r\n}\r\n"],"mappings":"8UAQA,MAAa,EAAU,uBAEvB,eAAsB,EAAY,EAAM,EAAU,CAI9C,OAHI,EAAK,OAAS,GACP,EAEJ,MAAM,EAAM,OAAO,EAAK,KAAM,SAAY,CAC7C,IAAM,EAAW,MAAM,EAAO,EAAK,MAAQ,IACrC,EAAK,EAAK,GACV,EAAa,OAAO,EAAG,2CAA2C,KAAK,YACvE,EAAc,OAAO,EAAG,0CAA0C,KAAK,YACvE,EAAO,EAAG,gCACX,UACA,IAAK,GAAQ,EAAG,GAAK,KAAK,YACzB,EAAU,EAAG,GACb,EAAU,EAAQ,KAAK,sBAAsB,OAC7C,EAAY,EAAQ,KAAK,yBAEzB,EAAgB,EAAU,KAAK,mCAC/B,EAAW,EAAU,KAAK,8BAChC,GAAI,EAAc,SAAW,EAAG,CAC5B,IAAM,EAAQ,EAAc,UAAU,IAAK,GAAY,CACnD,IAAM,EAAU,EAAG,GACb,EAAQ,EAAQ,KAAK,gBAAgB,OAAO,OAC5C,EAAK,EAAQ,KAAK,KAAK,KAAK,QAC5B,EAAc,EAAe,EAAQ,QACrC,EAAY,EACb,KAAK,+BACJ,QAAQ,MACT,UACA,IAAK,GAAQ,EAAG,GAAK,QACpB,EAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACvE,QAAS,EACT,eAAgB,IAEpB,MAAO,CACH,MAAO,GAAG,EAAM,KAAK,IACrB,QAAS,EAAU,GACnB,SAAU,EACV,cACA,KAAM,GAAG,EAAK,OAAO,IACrB,OAAQ,gBAGhB,OAAO,UACA,EAAS,SAAW,EAAG,CAC9B,IAAM,EAAc,EAAe,EAAU,QACvC,EAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACvE,UACA,eAAgB,IAEpB,MAAO,CACH,MAAO,EAAK,MACZ,QAAS,EAAU,GACnB,SAAU,EACV,cACA,KAAM,EAAK,KACX,QAAS,EAAc,EAAU,GAAe,KAChD,OAAQ,kBAET,CACH,IAAM,EAAQ,EAAS,UAAU,IAAK,GAAY,CAC9C,IAAM,EAAU,EAAG,GACb,EAAQ,EAAQ,KAAK,gBAAgB,OAAO,OAC5C,EAAc,EAAe,EAAQ,OAAQ,kBAC7C,EAAc,EAAI,EAAA,KAAA,EAAA,0CAAuD,CAC3E,QAAS,EACT,eAAgB,IAEpB,MAAO,CAAE,YAAA,KAEP,EAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACvE,UACA,SAAU,IAEd,MAAO,CACH,MAAO,EACP,QAAS,EAAU,GACnB,SAAU,EACV,cACA,KAAM,EAAK,KACX,QAAS,EAAc,EAAU,GAAe,KAChD,OAAQ,iBAMxB,SAAS,EAAe,EAAY,EAAyB,iBAAkB,CAC3E,IAAM,EAAI,EAAK,EAAY,KAAM,IAC3B,EAAc,EAAE,GAChB,EAAiB,EAAY,KAAK,OAAO,IAC/C,EAAe,KAAK,UAAU,MAAM,EAAG,IAAY,CAC/C,EAAE,GAAS,IAAI,QAAS,MAE5B,IAAM,EAAc,EAAe,OACnC,OAAO"}