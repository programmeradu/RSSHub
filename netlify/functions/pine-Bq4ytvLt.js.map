{"version":3,"file":"pine-Bq4ytvLt.js","names":["route: Route","got"],"sources":["../../lib/routes/tradingview/pine.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/pine/:version?',\r\n    radar: [\r\n        {\r\n            source: ['tradingview.com/pine-script-docs/en/:version/Release_notes.html'],\r\n            target: '/pine/:version',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { version = 'v5' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 100;\r\n\r\n    const rootUrl = 'https://www.tradingview.com';\r\n    const currentUrl = new URL(`pine-script-docs/en/${version}/Release_notes.html`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const items = $('div.section')\r\n        .toArray()\r\n        .filter((item) => {\r\n            item = $(item);\r\n\r\n            return /\\w+-\\d{4}/.test(item.prop('id'));\r\n        })\r\n        .slice(0, limit)\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const id = item.prop('id');\r\n            const title = item.find('a.toc-backref').first().text();\r\n            const link = new URL(item.find('a.headerlink').prop('href'), currentUrl).href;\r\n\r\n            item.children().first().remove();\r\n\r\n            return {\r\n                title,\r\n                link,\r\n                description: item.html(),\r\n                pubDate: parseDate(`${id.charAt(0).toUpperCase()}${id.slice(1)}`, 'MMMM-YYYY'),\r\n            };\r\n        });\r\n\r\n    const image = new URL('_images/Pine_Script_logo.svg', currentUrl).href;\r\n    const icon = new URL('favicon.ico', rootUrl).href;\r\n\r\n    return {\r\n        item: items,\r\n        title: $('title').text(),\r\n        link: currentUrl,\r\n        description: $('div.text-logo').text(),\r\n        language: $('html').prop('lang'),\r\n        image,\r\n        icon,\r\n        logo: icon,\r\n    };\r\n}\r\n"],"mappings":"oTAKA,MAAaA,EAAe,CACxB,KAAM,kBACN,MAAO,CACH,CACI,OAAQ,CAAC,mEACT,OAAQ,mBAGhB,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,UAAU,MAAS,EAAI,IAAI,QAC7B,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,IAE/E,EAAU,8BACV,EAAa,IAAI,IAAI,uBAAuB,EAAQ,qBAAsB,GAAS,KAEnF,CAAE,KAAM,GAAa,MAAMC,EAAI,GAE/B,EAAI,EAAK,GAET,EAAQ,EAAE,eACX,UACA,OAAQ,IACL,EAAO,EAAE,GAEF,YAAY,KAAK,EAAK,KAAK,SAErC,MAAM,EAAG,GACT,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAK,EAAK,KAAK,MACf,EAAQ,EAAK,KAAK,iBAAiB,QAAQ,OAC3C,EAAO,IAAI,IAAI,EAAK,KAAK,gBAAgB,KAAK,QAAS,GAAY,KAIzE,OAFA,EAAK,WAAW,QAAQ,SAEjB,CACH,QACA,OACA,YAAa,EAAK,OAClB,QAAS,EAAU,GAAG,EAAG,OAAO,GAAG,gBAAgB,EAAG,MAAM,KAAM,gBAIxE,EAAQ,IAAI,IAAI,+BAAgC,GAAY,KAC5D,EAAO,IAAI,IAAI,cAAe,GAAS,KAE7C,MAAO,CACH,KAAM,EACN,MAAO,EAAE,SAAS,OAClB,KAAM,EACN,YAAa,EAAE,iBAAiB,OAChC,SAAU,EAAE,QAAQ,KAAK,QACzB,QACA,OACA,KAAM"}