{"version":3,"file":"aqi-BMhhSUvm.js","names":["route: Route","got"],"sources":["../../lib/routes/aqicn/aqi.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { Route } from '@/types';\r\n\r\nexport const route: Route = {\r\n    path: '/:city/:pollution?',\r\n    categories: ['other'],\r\n    example: '/aqicn/beijing/pm25',\r\n    parameters: {\r\n        city: '城市拼音或地区 ID，详见[aqicn.org](http://aqicn.org/city/)',\r\n        pollution: '可选择显示更详细的空气污染成分',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['aqicn.org'],\r\n        },\r\n    ],\r\n    name: '实时 AQI',\r\n    maintainers: ['ladeng07'],\r\n    handler,\r\n    url: 'aqicn.org',\r\n    descriptions: `\r\n|   参数   | 污染成分 |\r\n| -------- | -------- |\r\n|   pm25   |  PM2.5   |\r\n|   pm10   |  PM10    |\r\n|   o3     |  O3      |\r\n|   no2    |  NO2     |\r\n|   so2    |  SO2     |\r\n|   co     |  CO      |\r\n\r\n举例: [https://rsshub.app/aqicn/beijing/pm25,pm10](https://rsshub.app/aqicn/beijing/pm25,pm10)\r\n\r\n1. 显示单个污染成分，例如「pm25」, [https://rsshub.app/aqicn/beijing/pm25](https://rsshub.app/aqicn/beijing/pm25)\r\n2. 逗号分隔显示多个污染成分，例如「pm25,pm10」，[https://rsshub.app/aqicn/beijing/pm25,pm10](https://rsshub.app/aqicn/beijing/pm25,pm10)\r\n3. 城市子站 ID 获取方法：右键显示网页源代码，搜索 \"idx\" （带双冒号），后面的 ID 就是子站的 ID，如你给的链接 ID 是 4258，RSS 地址就是 [https://rsshub.app/aqicn/4258](https://rsshub.app/aqicn/4258)\r\n`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const city = ctx.req.param('city');\r\n    const pollution = ctx.req.param('pollution') || [];\r\n    const pollutionType = {\r\n        so2: 'so2',\r\n        no2: 'no2',\r\n        co: 'co',\r\n        o3: 'O3',\r\n        pm25: 'PM2.5',\r\n        pm10: 'PM10',\r\n    };\r\n    const area = Number.isNaN(Number(city)) ? city : `@${city}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `http://aqicn.org/aqicn/json/android/${area}/json`,\r\n    });\r\n    const data = response.data;\r\n    const pollutionDetailed =\r\n        pollution.length === 0\r\n            ? ''\r\n            : pollution\r\n                  .split(',')\r\n                  .map((item) => {\r\n                      const pollutionValue = typeof data.historic[pollutionType[item]] === 'object' ? data.historic[pollutionType[item]][Object.keys(data.historic[pollutionType[item]])[0]] : data.historic[pollutionType[item]][0];\r\n                      return `${pollutionType[item].toUpperCase()}:<b>${pollutionValue}</b><br>`;\r\n                  })\r\n                  .join('');\r\n\r\n    return {\r\n        title: `${data.namena}AQI`,\r\n        link: `https://aqicn.org/city/${data.ids.path}`,\r\n        description: `${data.namena}AQI-aqicn.org`,\r\n        item: [\r\n            {\r\n                title: `${data.namena}实时空气质量(AQI)${data.utimecn}`,\r\n                description: `${data.infocn}<br>风力:<b>${data.cwind[0]}</b>级<br>AQI:<b>${data.aqi}</b><br>${pollutionDetailed}<img src=\"${data.wgt}\">`,\r\n                pubDate: parseDate(data.time * 1000),\r\n                guid: `${data.time}-${city}-${pollution}`,\r\n                link: `https://aqicn.org/city/${data.ids.path}`,\r\n            },\r\n        ],\r\n    };\r\n}\r\n"],"mappings":"qRAIA,MAAaA,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,SACb,QAAS,sBACT,WAAY,CACR,KAAM,mDACN,UAAW,mBAEf,MAAO,CACH,CACI,OAAQ,CAAC,eAGjB,KAAM,SACN,YAAa,CAAC,YACd,UACA,IAAK,YACL,aAAc;;;;;;;;;;;;;;;GAkBlB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAY,EAAI,IAAI,MAAM,cAAgB,GAC1C,EAAgB,CAClB,IAAK,MACL,IAAK,MACL,GAAI,KACJ,GAAI,KACJ,KAAM,QACN,KAAM,QAEJ,EAAO,OAAO,MAAM,OAAO,IAAS,EAAO,IAAI,IAE/C,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,uCAAuC,EAAK,SAE/C,EAAO,EAAS,KAChB,EACF,EAAU,SAAW,EACf,GACA,EACK,MAAM,KACN,IAAK,GAAS,CACX,IAAM,EAAiB,OAAO,EAAK,SAAS,EAAc,KAAW,SAAW,EAAK,SAAS,EAAc,IAAO,OAAO,KAAK,EAAK,SAAS,EAAc,KAAQ,IAAM,EAAK,SAAS,EAAc,IAAO,GAC5M,MAAO,GAAG,EAAc,GAAM,cAAc,MAAM,EAAe,YAEpE,KAAK,IAEpB,MAAO,CACH,MAAO,GAAG,EAAK,OAAO,KACtB,KAAM,0BAA0B,EAAK,IAAI,OACzC,YAAa,GAAG,EAAK,OAAO,eAC5B,KAAM,CACF,CACI,MAAO,GAAG,EAAK,OAAO,aAAa,EAAK,UACxC,YAAa,GAAG,EAAK,OAAO,YAAY,EAAK,MAAM,GAAG,kBAAkB,EAAK,IAAI,UAAU,EAAkB,YAAY,EAAK,IAAI,IAClI,QAAS,EAAU,EAAK,KAAO,KAC/B,KAAM,GAAG,EAAK,KAAK,GAAG,EAAK,GAAG,IAC9B,KAAM,0BAA0B,EAAK,IAAI"}