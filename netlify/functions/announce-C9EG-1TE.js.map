{"version":3,"file":"announce-C9EG-1TE.js","names":["route: Route","response","got","$","item"],"sources":["../../lib/routes/dol/announce.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/announce/:owner?/:province?/:office?',\r\n    categories: ['government'],\r\n    example: '/dol/announce',\r\n    parameters: { owner: 'Requester/former land owner', province: 'Province which the land is belongs to', office: 'DOL office name which the land is belongs to (สำนักงานที่ดิน(กรุงเทพมหานคร|จังหวัด*) [สาขา*])' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'e-LandsAnnouncement',\r\n    maintainers: ['itpcc'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://announce.dol.go.th';\r\n    const { owner, province, office } = ctx.req.param();\r\n    const queryParams = {\r\n        searchprovince: '',\r\n        searchoffice: '',\r\n        searchtype: '',\r\n        searchconcerned: owner ?? '',\r\n    };\r\n\r\n    const result = {\r\n        title: `ประกาศสำนักงานที่ดิน${province ? 'จังหวัด' + province + ' ' : ''}${office ? 'สำนักงานที่ดิน' + office : ''}${owner ? 'ชื่อผู้ถือกรรมสิทธิ/ผู้ขอ ' + owner : ''}`,\r\n        link: `${baseUrl}/index.php`,\r\n        item: [],\r\n    };\r\n\r\n    // If office/province provided, fetch index page to lookup province/office code\r\n    if (province || office) {\r\n        const { data: response } = await got(`${baseUrl}/index.php`);\r\n        const $ = load(response);\r\n\r\n        if (province) {\r\n            const slcProvince = $(`select#searchprovince option:contains('${province}')`);\r\n\r\n            if (!slcProvince.length) {\r\n                return result;\r\n            }\r\n\r\n            queryParams.searchprovince = slcProvince.attr('value');\r\n        }\r\n\r\n        if (office) {\r\n            const slcOffice = $(`select#searchoffice option:contains('${office}')`);\r\n\r\n            if (!slcOffice.length) {\r\n                return result;\r\n            }\r\n\r\n            queryParams.searchoffice = slcOffice.attr('value');\r\n        }\r\n    }\r\n\r\n    result.link = `${baseUrl}/index.php?${new URLSearchParams(queryParams).toString()}`;\r\n\r\n    const { data: response } = await got(result.link, {\r\n        https: {\r\n            rejectUnauthorized: false,\r\n        },\r\n    });\r\n    const $ = load(response);\r\n\r\n    result.item = $('div#div table tbody tr:not([class])')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            /** @type cheerio.Cheerio<th>[] */\r\n            const [, topic, requester, reqType, anceBegDate, anceEndDate, officeName, anceFile] = item\r\n                .find('th')\r\n                .toArray()\r\n                .map((item) => $(item));\r\n            const dateList = anceBegDate.text().split('-');\r\n            return {\r\n                title: `${topic.text()} (ผู้ถือกรรมสิทธิ/ผู้ขอ ${requester.text()})`,\r\n                // Template text from Form ท.ด.๒๕\r\n                description: `ประกาศ${officeName.text()} เรื่อง${topic.text()}\r\n                    ด้วย ${requester.text()} ได้ยื่นเรื่องราว ${reqType.text()}\r\n                    จึงขอประกาศให้ทราบทั่วกัน ถ้าผู้ใดจะคัดค้านประการใด ให้ยื่นคำคัดค้านต่อพนักงานเจ้าหน้าที่ ภายใน ${anceEndDate.text()}\r\n                    ประกาศ ณ วันที่ ${anceBegDate.text()}\r\n                `,\r\n                link: `${baseUrl}/${anceFile.find('a').attr('href')}`,\r\n                pubDate: timezone(\r\n                    new Date(\r\n                        // The date is in Buddish year\r\n                        Number.parseInt(dateList[2]) - 543,\r\n                        Number.parseInt(dateList[1]) - 1,\r\n                        Number.parseInt(dateList[0])\r\n                    ),\r\n                    +7\r\n                ),\r\n                author: officeName.text(),\r\n                category: [reqType.text()],\r\n            };\r\n        });\r\n\r\n    return result;\r\n}\r\n"],"mappings":"iTAKA,MAAaA,EAAe,CACxB,KAAM,wCACN,WAAY,CAAC,cACb,QAAS,gBACT,WAAY,CAAE,MAAO,8BAA+B,SAAU,wCAAyC,OAAQ,iGAC/G,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,sBACN,YAAa,CAAC,SACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,6BACV,CAAE,QAAO,WAAU,UAAW,EAAI,IAAI,QACtC,EAAc,CAChB,eAAgB,GAChB,aAAc,GACd,WAAY,GACZ,gBAAiB,GAAS,IAGxB,EAAS,CACX,MAAO,uBAAuB,EAAW,UAAY,EAAW,IAAM,KAAK,EAAS,iBAAmB,EAAS,KAAK,EAAQ,6BAA+B,EAAQ,KACpK,KAAM,GAAG,EAAQ,YACjB,KAAM,IAIV,GAAI,GAAY,EAAQ,CACpB,GAAM,CAAE,KAAMC,GAAa,MAAMC,EAAI,GAAG,EAAQ,aAC1CC,EAAI,EAAKF,GAEf,GAAI,EAAU,CACV,IAAM,EAAcE,EAAE,0CAA0C,EAAS,KAEzE,GAAI,CAAC,EAAY,OACb,OAAO,EAGX,EAAY,eAAiB,EAAY,KAAK,SAGlD,GAAI,EAAQ,CACR,IAAM,EAAYA,EAAE,wCAAwC,EAAO,KAEnE,GAAI,CAAC,EAAU,OACX,OAAO,EAGX,EAAY,aAAe,EAAU,KAAK,UAIlD,EAAO,KAAO,GAAG,EAAQ,aAAa,IAAI,gBAAgB,GAAa,aAEvE,GAAM,CAAE,KAAM,GAAa,MAAMD,EAAI,EAAO,KAAM,CAC9C,MAAO,CACH,mBAAoB,MAGtB,EAAI,EAAK,GAmCf,MAjCA,GAAO,KAAO,EAAE,uCACX,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,GAAM,EAAG,EAAO,EAAW,EAAS,EAAa,EAAa,EAAY,GAAY,EACjF,KAAK,MACL,UACA,IAAK,GAAS,EAAEE,IACf,EAAW,EAAY,OAAO,MAAM,KAC1C,MAAO,CACH,MAAO,GAAG,EAAM,OAAO,0BAA0B,EAAU,OAAO,GAElE,YAAa,SAAS,EAAW,OAAO,SAAS,EAAM,OAAO;2BACnD,EAAU,OAAO,oBAAoB,EAAQ,OAAO;sHACuC,EAAY,OAAO;sCACnG,EAAY,OAAO;kBAEzC,KAAM,GAAG,EAAQ,GAAG,EAAS,KAAK,KAAK,KAAK,UAC5C,QAAS,EACL,IAAI,KAEA,OAAO,SAAS,EAAS,IAAM,IAC/B,OAAO,SAAS,EAAS,IAAM,EAC/B,OAAO,SAAS,EAAS,KAE7B,GAEJ,OAAQ,EAAW,OACnB,SAAU,CAAC,EAAQ,WAIxB"}