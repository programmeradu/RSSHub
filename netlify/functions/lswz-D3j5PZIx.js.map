{"version":3,"file":"lswz-D3j5PZIx.js","names":["got","cache","route: Route"],"sources":["../../lib/routes/gov/lswz/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = 'html/xinwen/index' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 25;\r\n\r\n    const rootUrl = 'https://www.lswz.gov.cn';\r\n    const currentUrl = new URL(`${category}.shtml`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('ul.lists li')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.find('a').text(),\r\n                pubDate: parseDate(item.find('span').text()),\r\n                link: new URL(item.find('a').prop('href'), rootUrl).href,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                $$('ul.lists').remove();\r\n                $$('div.pub-right-source, div.detail_links_pane').remove();\r\n\r\n                const title = $$('meta[name=\"ArticleTitle\"]').prop('content') || $$('div.pub-det-title').text();\r\n                const description = $$('table.pages_content, div.article-content, div.TRS_UEDITOR, div.TRS_PreAppend').html();\r\n                const pubDate = $$('meta[name=\"PubDate\"]').prop('content');\r\n\r\n                item.title = title || item.title;\r\n                item.description = description;\r\n                item.pubDate = pubDate ? timezone(parseDate(pubDate), +8) : item.pubDate;\r\n                item.author = $$('meta[name=\"ContentSource\"]').prop('content')?.trim() ?? undefined;\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('table.pages_content, div.article-content, div.TRS_UEDITOR, div.TRS_PreAppend').text(),\r\n                };\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('div.lsj-index-logo img').prop('src'), rootUrl).href;\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        description: $('meta[name=\"ColumnDescription\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: $('meta[name=\"SiteName\"]').prop('content'),\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/lswz/:category{.+}?',\r\n    name: '国家粮食和物资储备局',\r\n    url: 'lswz.gov.cn',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/gov/lswz',\r\n    parameters: { category: '分类，默认为 `html/xinwen/index`，可在对应分类页 URL 中找到' },\r\n    description: `::: tip\r\n  若订阅 [新闻发布](https://www.lswz.gov.cn/html/xinwen/index.shtml)，网址为 \\`https://www.lswz.gov.cn/html/xinwen/index.shtml\\`。截取 \\`https://www.lswz.gov.cn/\\` 到末尾 \\`.shtml\\` 的部分 \\`html/xinwen/index\\` 作为参数填入，此时路由为 [\\`/gov/lswz/html/xinwen/index\\`](https://rsshub.app/gov/lswz/html/xinwen/index)。\r\n:::\r\n\r\n| [新闻发布](https://www.lswz.gov.cn/html/xinwen/index.shtml)        | [党建工作](https://www.lswz.gov.cn/html/djgz/index.shtml)      |\r\n| ------------------------------------------------------------------ | -------------------------------------------------------------- |\r\n| [html/xinwen/index](https://rsshub.app/gov/lswz/html/xinwen/index) | [html/djgz/index](https://rsshub.app/gov/lswz/html/djgz/index) |\r\n\r\n| [粮食交易](https://www.lswz.gov.cn/html/zmhd/lysj/lsjy.shtml)          | [粮食质量](https://www.lswz.gov.cn/html/zmhd/lysj/lszl.shtml)          |\r\n| ---------------------------------------------------------------------- | ---------------------------------------------------------------------- |\r\n| [html/zmhd/lysj/lsjy](https://rsshub.app/gov/lswz/html/zmhd/lysj/lsjy) | [html/zmhd/lysj/lszl](https://rsshub.app/gov/lswz/html/zmhd/lysj/lszl) |\r\n\r\n\r\n#### [业务频道](https://www.lswz.gov.cn/html/ywpd/index.shtml)\r\n\r\n| [粮食调控](https://www.lswz.gov.cn/html/ywpd/lstk/index.shtml)           | [物资储备](https://www.lswz.gov.cn/html/ywpd/wzcb/index.shtml)           | [能源储备](https://www.lswz.gov.cn/html/ywpd/nycb/index.shtml)           | [安全应急](https://www.lswz.gov.cn/html/ywpd/aqyj/index.shtml)           | [法规体改](https://www.lswz.gov.cn/html/ywpd/fgtg/index.shtml)           |\r\n| ------------------------------------------------------------------------ | ------------------------------------------------------------------------ | ------------------------------------------------------------------------ | ------------------------------------------------------------------------ | ------------------------------------------------------------------------ |\r\n| [html/ywpd/lstk/index](https://rsshub.app/gov/lswz/html/ywpd/lstk/index) | [html/ywpd/wzcb/index](https://rsshub.app/gov/lswz/html/ywpd/wzcb/index) | [html/ywpd/nycb/index](https://rsshub.app/gov/lswz/html/ywpd/nycb/index) | [html/ywpd/aqyj/index](https://rsshub.app/gov/lswz/html/ywpd/aqyj/index) | [html/ywpd/fgtg/index](https://rsshub.app/gov/lswz/html/ywpd/fgtg/index) |\r\n\r\n| [规划建设](https://www.lswz.gov.cn/html/ywpd/gjks/index.shtml)           | [财务审计](https://www.lswz.gov.cn/html/ywpd/cwsj/index.shtml)           | [仓储科技](https://www.lswz.gov.cn/html/ywpd/cckj/index.shtml)           | [执法督查](https://www.lswz.gov.cn/html/ywpd/zfdc/index.shtml)           | [国际交流](https://www.lswz.gov.cn/html/ywpd/gjjl/index.shtml)           |\r\n| ------------------------------------------------------------------------ | ------------------------------------------------------------------------ | ------------------------------------------------------------------------ | ------------------------------------------------------------------------ | ------------------------------------------------------------------------ |\r\n| [html/ywpd/gjks/index](https://rsshub.app/gov/lswz/html/ywpd/gjks/index) | [html/ywpd/cwsj/index](https://rsshub.app/gov/lswz/html/ywpd/cwsj/index) | [html/ywpd/cckj/index](https://rsshub.app/gov/lswz/html/ywpd/cckj/index) | [html/ywpd/zfdc/index](https://rsshub.app/gov/lswz/html/ywpd/zfdc/index) | [html/ywpd/gjjl/index](https://rsshub.app/gov/lswz/html/ywpd/gjjl/index) |\r\n\r\n| [人事人才](https://www.lswz.gov.cn/html/ywpd/rsrc/index.shtml)           | [标准质量](https://www.lswz.gov.cn/html/ywpd/bzzl/index.shtml)           | [粮食和储备研究](https://www.lswz.gov.cn/html/ywpd/lshcbyj/index.shtml)        |\r\n| ------------------------------------------------------------------------ | ------------------------------------------------------------------------ | ------------------------------------------------------------------------------ |\r\n| [html/ywpd/rsrc/index](https://rsshub.app/gov/lswz/html/ywpd/rsrc/index) | [html/ywpd/bzzl/index](https://rsshub.app/gov/lswz/html/ywpd/bzzl/index) | [html/ywpd/lshcbyj/index](https://rsshub.app/gov/lswz/html/ywpd/lshcbyj/index) |\r\n\r\n#### [政策发布](https://www.lswz.gov.cn/html/zcfb/index.shtml)\r\n\r\n| [文件](https://www.lswz.gov.cn/html/zcfb/wenjian.shtml)            | [法律法规](https://www.lswz.gov.cn/html/zcfb/fggz-fg.shtml)        | [规章](https://www.lswz.gov.cn/html/zcfb/fggz-gz.shtml)            |\r\n| ------------------------------------------------------------------ | ------------------------------------------------------------------ | ------------------------------------------------------------------ |\r\n| [html/zcfb/wenjian](https://rsshub.app/gov/lswz/html/zcfb/wenjian) | [html/zcfb/fggz-fg](https://rsshub.app/gov/lswz/html/zcfb/fggz-fg) | [html/zcfb/fggz-gz](https://rsshub.app/gov/lswz/html/zcfb/fggz-gz) |\r\n\r\n#### [通知公告](https://www.lswz.gov.cn/html/tzgg/index.shtml)\r\n\r\n| [行政通知](https://www.lswz.gov.cn/html/tzgg/xztz.shtml)     | [公告通告](https://www.lswz.gov.cn/html/tzgg/ggtg.shtml)     |\r\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\r\n| [html/tzgg/xztz](https://rsshub.app/gov/lswz/html/tzgg/xztz) | [html/tzgg/ggtg](https://rsshub.app/gov/lswz/html/tzgg/ggtg) |\r\n\r\n#### [粮食收购](https://www.lswz.gov.cn/html/zmhd/lysj/lssg-szym.shtml)\r\n\r\n| [收购数据](https://www.lswz.gov.cn/html/zmhd/lysj/lssg-szym.shtml)               | [政策·解读](https://www.lswz.gov.cn/html/zmhd/lysj/lssg-gzdt.shtml)              |\r\n| -------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |\r\n| [html/zmhd/lysj/lssg-szym](https://rsshub.app/gov/lswz/html/zmhd/lysj/lssg-szym) | [html/zmhd/lysj/lssg-gzdt](https://rsshub.app/gov/lswz/html/zmhd/lysj/lssg-gzdt) |\r\n\r\n#### [粮食价格](https://www.lswz.gov.cn/html/zmhd/lysj/lsjg-scjc.shtml)\r\n\r\n| [市场监测](https://www.lswz.gov.cn/html/zmhd/lysj/lsjg-scjc.shtml)               | [市场价格](https://www.lswz.gov.cn/html/zmhd/lysj/lsjg-scjg.shtml)               |\r\n| -------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |\r\n| [html/zmhd/lysj/lsjg-scjc](https://rsshub.app/gov/lswz/html/zmhd/lysj/lsjg-scjc) | [html/zmhd/lysj/lsjg-scjg](https://rsshub.app/gov/lswz/html/zmhd/lysj/lsjg-scjg) |\r\n\r\n  `,\r\n    categories: ['government'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.lswz.gov.cn/:category?'],\r\n            target: (params) => {\r\n                const category = params.category;\r\n\r\n                return `/gov/lswz${category ? `/${category}` : ''}`;\r\n            },\r\n        },\r\n        {\r\n            title: '新闻发布',\r\n            source: ['www.lswz.gov.cn/html/xinwen/index.shtml'],\r\n            target: '/lswz/html/xinwen/index',\r\n        },\r\n        {\r\n            title: '党建工作',\r\n            source: ['www.lswz.gov.cn/html/djgz/index.shtml'],\r\n            target: '/lswz/html/djgz/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 粮食调控',\r\n            source: ['www.lswz.gov.cn/html/ywpd/lstk/index.shtml'],\r\n            target: '/lswz/html/ywpd/lstk/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 物资储备',\r\n            source: ['www.lswz.gov.cn/html/ywpd/wzcb/index.shtml'],\r\n            target: '/lswz/html/ywpd/wzcb/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 能源储备',\r\n            source: ['www.lswz.gov.cn/html/ywpd/nycb/index.shtml'],\r\n            target: '/lswz/html/ywpd/nycb/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 安全应急',\r\n            source: ['www.lswz.gov.cn/html/ywpd/aqyj/index.shtml'],\r\n            target: '/lswz/html/ywpd/aqyj/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 法规体改',\r\n            source: ['www.lswz.gov.cn/html/ywpd/fgtg/index.shtml'],\r\n            target: '/lswz/html/ywpd/fgtg/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 规划建设',\r\n            source: ['www.lswz.gov.cn/html/ywpd/gjks/index.shtml'],\r\n            target: '/lswz/html/ywpd/gjks/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 财务审计',\r\n            source: ['www.lswz.gov.cn/html/ywpd/cwsj/index.shtml'],\r\n            target: '/lswz/html/ywpd/cwsj/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 仓储科技',\r\n            source: ['www.lswz.gov.cn/html/ywpd/cckj/index.shtml'],\r\n            target: '/lswz/html/ywpd/cckj/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 执法督查',\r\n            source: ['www.lswz.gov.cn/html/ywpd/zfdc/index.shtml'],\r\n            target: '/lswz/html/ywpd/zfdc/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 国际交流',\r\n            source: ['www.lswz.gov.cn/html/ywpd/gjjl/index.shtml'],\r\n            target: '/lswz/html/ywpd/gjjl/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 人事人才',\r\n            source: ['www.lswz.gov.cn/html/ywpd/rsrc/index.shtml'],\r\n            target: '/lswz/html/ywpd/rsrc/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 标准质量',\r\n            source: ['www.lswz.gov.cn/html/ywpd/bzzl/index.shtml'],\r\n            target: '/lswz/html/ywpd/bzzl/index',\r\n        },\r\n        {\r\n            title: '业务频道 - 粮食和储备研究',\r\n            source: ['www.lswz.gov.cn/html/ywpd/lshcbyj/index.shtml'],\r\n            target: '/lswz/html/ywpd/lshcbyj/index',\r\n        },\r\n        {\r\n            title: '政策发布 - 文件',\r\n            source: ['www.lswz.gov.cn/html/zcfb/wenjian.shtml'],\r\n            target: '/lswz/html/zcfb/wenjian',\r\n        },\r\n        {\r\n            title: '政策发布 - 法律法规',\r\n            source: ['www.lswz.gov.cn/html/zcfb/fggz-fg.shtml'],\r\n            target: '/lswz/html/zcfb/fggz-fg',\r\n        },\r\n        {\r\n            title: '政策发布 - 规章',\r\n            source: ['www.lswz.gov.cn/html/zcfb/fggz-gz.shtml'],\r\n            target: '/lswz/html/zcfb/fggz-gz',\r\n        },\r\n        {\r\n            title: '通知公告 - 行政通知',\r\n            source: ['www.lswz.gov.cn/html/tzgg/xztz.shtml'],\r\n            target: '/lswz/html/tzgg/xztz',\r\n        },\r\n        {\r\n            title: '通知公告 - 公告通告',\r\n            source: ['www.lswz.gov.cn/html/tzgg/ggtg.shtml'],\r\n            target: '/lswz/html/tzgg/ggtg',\r\n        },\r\n        {\r\n            title: '粮食收购 - 收购数据',\r\n            source: ['www.lswz.gov.cn/html/zmhd/lysj/lssg-szym.shtml'],\r\n            target: '/lswz/html/zmhd/lysj/lssg-szym',\r\n        },\r\n        {\r\n            title: '粮食收购 - 政策·解读',\r\n            source: ['www.lswz.gov.cn/html/zmhd/lysj/lssg-gzdt.shtml'],\r\n            target: '/lswz/html/zmhd/lysj/lssg-gzdt',\r\n        },\r\n        {\r\n            title: '粮食价格 - 市场监测',\r\n            source: ['www.lswz.gov.cn/html/zmhd/lysj/lsjg-scjc.shtml'],\r\n            target: '/lswz/html/zmhd/lysj/lsjg-scjc',\r\n        },\r\n        {\r\n            title: '粮食价格 - 市场价格',\r\n            source: ['www.lswz.gov.cn/html/zmhd/lysj/lsjg-scjg.shtml'],\r\n            target: '/lswz/html/zmhd/lysj/lsjg-scjg',\r\n        },\r\n        {\r\n            title: '粮食交易',\r\n            source: ['www.lswz.gov.cn/html/zmhd/lysj/lsjy.shtml'],\r\n            target: '/lswz/html/zmhd/lysj/lsjy',\r\n        },\r\n        {\r\n            title: '粮食质量',\r\n            source: ['www.lswz.gov.cn/html/zmhd/lysj/lszl.shtml'],\r\n            target: '/lswz/html/zmhd/lysj/lszl',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}