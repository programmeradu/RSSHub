{"version":3,"file":"weekly-best-DzZ202wq.js","names":[],"sources":["../../lib/routes/douban/other/weekly-best.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/movie/weekly/:type?',\r\n    categories: ['social-media'],\r\n    example: '/douban/movie/weekly',\r\n    parameters: { type: '分类，可在榜单页 URL 中找到，默认为一周口碑电影榜' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '一周口碑榜',\r\n    maintainers: ['numm233', 'nczitzk'],\r\n    handler,\r\n    description: `| 一周口碑电影榜      | 华语口碑剧集榜            |\r\n| ------------------- | ------------------------- |\r\n| movie\\_weekly\\_best | tv\\_chinese\\_best\\_weekly |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type') || 'movie_weekly_best';\r\n\r\n    const link = 'https://m.douban.com/movie';\r\n    const apiUrl = `https://m.douban.com/rexxar/api/v2/subject_collection/${type}`;\r\n\r\n    const itemResponse = await got({\r\n        method: 'get',\r\n        url: `${apiUrl}/items?start=0&count=10`,\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n    const infoResponse = await got({\r\n        method: 'get',\r\n        url: apiUrl,\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n\r\n    const data = itemResponse.data.subject_collection_items;\r\n\r\n    return {\r\n        title: infoResponse.data.title,\r\n        link: `https://m.douban.com/subject_collection/${type}`,\r\n        description: infoResponse.data.description,\r\n\r\n        item: data.map(({ title, cover, cover_url, url, rating, null_rating_reason, description, card_subtitle, photos }) => {\r\n            const rate = rating ? `${rating.value.toFixed(1)}分` : null_rating_reason;\r\n            if (cover && cover.url) {\r\n                cover_url = cover.url;\r\n            }\r\n\r\n            return {\r\n                title,\r\n                description: art(path.join(__dirname, '../templates/weekly_best.art'), {\r\n                    title,\r\n                    card_subtitle,\r\n                    description,\r\n                    rate,\r\n                    cover_url,\r\n                    photos,\r\n                }),\r\n                link: url,\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"gVAMA,MAAa,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,gBACb,QAAS,uBACT,WAAY,CAAE,KAAM,+BACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,QACN,YAAa,CAAC,UAAW,WACzB,UACA,YAAa;;iDAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,oBAEhC,EAAO,6BACP,EAAS,yDAAyD,IAElE,EAAe,MAAM,EAAI,CAC3B,OAAQ,MACR,IAAK,GAAG,EAAO,yBACf,QAAS,CACL,QAAS,KAGX,EAAe,MAAM,EAAI,CAC3B,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,KAIX,EAAO,EAAa,KAAK,yBAE/B,MAAO,CACH,MAAO,EAAa,KAAK,MACzB,KAAM,2CAA2C,IACjD,YAAa,EAAa,KAAK,YAE/B,KAAM,EAAK,KAAK,CAAE,QAAO,QAAO,YAAW,MAAK,SAAQ,qBAAoB,cAAa,gBAAe,YAAa,CACjH,IAAM,EAAO,EAAS,GAAG,EAAO,MAAM,QAAQ,GAAG,GAAK,EAKtD,OAJI,GAAS,EAAM,MACf,EAAY,EAAM,KAGf,CACH,QACA,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAsD,CACnE,QACA,gBACA,cACA,OACA,YACA,WAEJ,KAAM"}