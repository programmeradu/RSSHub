{"version":3,"file":"embassy-BC5LCNlf.js","names":["route: Route","supportedList","got","cache","link","$"],"sources":["../../lib/routes/embassy/supported-list.ts","../../lib/routes/embassy/index.ts"],"sourcesContent":["export default {\r\n    ca: {\r\n        country: 'ca',\r\n        countryCN: '加拿大',\r\n        link: 'http://ca.china-embassy.org/chn/zytz/',\r\n        list: 'div[class=nav_title_list] > ul a',\r\n        title: '#News_Body_Title',\r\n        description: '#News_Body_Txt_A',\r\n        pubDate: '#News_Body_Time',\r\n        consulates: {\r\n            montreal: {\r\n                cityCN: '蒙特利尔',\r\n                link: 'http://montreal.chineseconsulate.org/chn/zytz/',\r\n                list: '#docMore > tbody > tr > td:nth-child(3) > div[class=Text_Center] > ul a',\r\n                title: '#News_Body_Title',\r\n                description: '#News_Body_Txt_A',\r\n                pubDate: '#News_Body_Time',\r\n            },\r\n        },\r\n    },\r\n    de: {\r\n        country: 'de',\r\n        countryCN: '德国',\r\n        link: 'http://de.china-embassy.gov.cn/chn/lsfw/jqtz/',\r\n        list: '#docMore a',\r\n        title: '#article > table > tbody > tr:nth-child(2) b',\r\n        description: '#article > table > tbody > tr:nth-child(10) > td > div',\r\n        pubDate: '#article > table > tbody > tr:nth-child(6) > td',\r\n        consulates: {\r\n            munich: {\r\n                cityCN: '慕尼黑',\r\n                link: 'http://munich.chineseconsulate.org/chn/jqtz/',\r\n                list: '#docMore > tbody > tr > td:nth-child(2) > table:nth-child(2) > tbody > tr:nth-child(2) > td > table > tbody a',\r\n                title: '#article > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(1) > td',\r\n                description: '#article > tbody > tr:nth-child(2) > td > div',\r\n                pubDate: '#article > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(4) > td',\r\n            },\r\n        },\r\n    },\r\n    fr: {\r\n        country: 'fr',\r\n        countryCN: '法国',\r\n        link: 'http://fr.chineseembassy.org/chn/zgzfg/zgsg/lsb/',\r\n        list: '#docMore > tbody > tr > td > table > tbody a',\r\n        title: '#article > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(1) > td',\r\n        description: '#article > tbody > tr:nth-child(3) > td',\r\n        pubDate: '#article > tbody > tr:nth-child(2) > td',\r\n        consulates: {\r\n            marseille: {\r\n                cityCN: '马赛',\r\n                link: 'http://marseille.china-consulate.org/chn/lsfwgg/',\r\n                list: '.newslist a',\r\n                title: '#News_Body_Title',\r\n                description: '#News_Body_Txt_A',\r\n                pubDate: '#News_Body_Time',\r\n            },\r\n            strasbourg: {\r\n                cityCN: '斯特拉斯堡',\r\n                link: 'http://strasbourg.china-consulate.org/chn/lsfw/',\r\n                list: '#docMore > tbody a',\r\n                title: '#article > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(1) > td',\r\n                description: '#article > tbody > tr:nth-child(3) > td',\r\n                pubDate: '#article > tbody > tr:nth-child(2) > td',\r\n            },\r\n            lyon: {\r\n                cityCN: '里昂',\r\n                link: 'http://lyon.china-consulate.org/chn/tztg/',\r\n                list: '#manytitle > tbody > tr > td > table > tbody > tr:nth-child(1) > td > table > tbody a',\r\n                title: '#article > table:nth-child(1) > tbody > tr:nth-child(1) > td > font',\r\n                description: '#article > table:nth-child(2) > tbody > tr:nth-child(2) > td > div > div',\r\n                pubDate: '#article > table:nth-child(1) > tbody > tr:nth-child(4) > td > font',\r\n            },\r\n        },\r\n    },\r\n    jp: {\r\n        country: 'jp',\r\n        countryCN: '日本',\r\n        link: 'http://jp.china-embassy.org/chn/lsfws/LSB/',\r\n        list: '#docMore > tbody > tr > td:nth-child(2) > table > tbody > tr:nth-child(2) > td > table:nth-child(3) a',\r\n        title: '#article > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(1) > td',\r\n        description: '#article > tbody > tr:nth-child(2) > td',\r\n        pubDate: '#article > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(4) > td',\r\n        consulates: {\r\n            nagasaki: {\r\n                cityCN: '长崎',\r\n                link: 'http://nagasaki.china-consulate.org/chn/tzgg/',\r\n                list: '.newsList a',\r\n                title: '#News_Body_Title',\r\n                description: '#News_Body_Txt_A',\r\n                pubDate: '#News_Body_Time',\r\n            },\r\n            osaka: {\r\n                cityCN: '大阪',\r\n                link: 'http://osaka.china-consulate.org/chn/tzgg/',\r\n                list: '#liebiao > tbody > tr > td:nth-child(1) > table:nth-child(3) > tbody a',\r\n                title: '#article > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(1) > td',\r\n                description: '#article > tbody > tr:nth-child(3) > td',\r\n                pubDate: '#article > tbody > tr:nth-child(2) > td',\r\n            },\r\n            fukuoka: {\r\n                cityCN: '福冈',\r\n                link: 'http://fukuoka.china-consulate.org/chn/tztg/',\r\n                list: '#docMore > tbody > tr > td:nth-child(2) > table > tbody > tr:nth-child(2) > td > table:nth-child(2) > tbody a',\r\n                title: '#article > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(1) > td',\r\n                description: '#article > tbody > tr:nth-child(3) > td',\r\n                pubDate: '#article > tbody > tr:nth-child(2) > td',\r\n            },\r\n            nagoya: {\r\n                cityCN: '名古屋',\r\n                link: 'http://nagoya.chineseconsulate.org/chn/gzgg/',\r\n                list: '#docMore > div.mbox.fl > div > div.cbox_ul > ul a',\r\n                title: '#News_Body_Title',\r\n                description: '#News_Body_Txt_A',\r\n                pubDate: '#News_Body_Time',\r\n            },\r\n            sapporo: {\r\n                cityCN: '札幌',\r\n                link: 'http://sapporo.china-consulate.org/chn/tzbg/',\r\n                list: '#docMore > tbody > tr > td:nth-child(2) > table > tbody > tr:nth-child(2) > td > table:nth-child(3) > tbody > tr:nth-child(1) a',\r\n                title: '#article > tbody > tr > td > table:nth-child(1) > tbody > tr:nth-child(1) > td',\r\n                description: '#article > tbody > tr > td > table:nth-child(2) > tbody > tr:nth-child(1) > td',\r\n                pubDate: '#article > tbody > tr > td > table:nth-child(1) > tbody > tr:nth-child(4) > td',\r\n            },\r\n            niigata: {\r\n                cityCN: '新潟',\r\n                link: 'http://niigata.china-consulate.org/chn/lsbh/tztg/',\r\n                list: '#docMore a',\r\n                title: '#article > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(4) > td',\r\n                description: '#article > tbody > tr:nth-child(2) > td',\r\n                pubDate: '#article > tbody > tr > td > table:nth-child(1) > tbody > tr:nth-child(4) > td',\r\n            },\r\n        },\r\n    },\r\n    kr: {\r\n        country: 'kr',\r\n        countryCN: '韩国',\r\n        link: 'http://kr.china-embassy.org/chn/lsqz/ls_tz/',\r\n        list: '#TRS a',\r\n        title: '#article > table > tbody > tr:nth-child(1) > td > font > b',\r\n        description: '#article > table > tbody > tr:nth-child(3) > td > div > div:nth-child(2)',\r\n        pubDate: '#article > table > tbody > tr:nth-child(1) > td > font > b',\r\n        consulates: {\r\n            busan: {\r\n                cityCN: '釜山',\r\n                link: 'http://busan.china-consulate.org/chn/lsfw/tzgg101/',\r\n                list: 'body > table:nth-child(6) > tbody > tr > td:nth-child(2) > table:nth-child(2) > tbody > tr:nth-child(3) > td > table > tbody a',\r\n                title: '#article > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(1) > td',\r\n                description: '#article > tbody > tr:nth-child(3) > td',\r\n                pubDate: '#article > tbody > tr:nth-child(2) > td',\r\n            },\r\n            jeju: {\r\n                cityCN: '济州',\r\n                link: 'http://jeju.chineseconsulate.org/chn/ggl/',\r\n                list: '#docMore > tbody > tr > td:nth-child(3) > div > ul:nth-child(5) a',\r\n                title: '#News_Body_Title',\r\n                description: '#News_Body_Txt_A',\r\n                pubDate: '#News_Body_Time',\r\n            },\r\n            gwangju: {\r\n                cityCN: '光州',\r\n                link: 'http://gwangju.china-consulate.org/chn/lbxx/ggtz/',\r\n                list: '#docNum a',\r\n                title: '#article > table > tbody > tr:nth-child(2) > td',\r\n                description: '#article > table > tbody > tr:nth-child(10) > td > div',\r\n                pubDate: '#article > table > tbody > tr:nth-child(6) > td > font',\r\n            },\r\n        },\r\n    },\r\n    my: {\r\n        country: 'my',\r\n        countryCN: '马来西亚',\r\n        link: 'http://my.china-embassy.org/chn/zytz/',\r\n        list: 'div[class=nbox_ul] > ul a',\r\n        title: '#News_Body_Title',\r\n        description: '#News_Body_Txt_A',\r\n        pubDate: '#News_Body_Time',\r\n    },\r\n    sg: {\r\n        country: 'sg',\r\n        countryCN: '新加坡',\r\n        link: 'http://sg.china-embassy.gov.cn/lsfw_0/zytz/',\r\n        list: 'div.news-list a[target=_blank]',\r\n        title: '#News_Body_Title',\r\n        description: 'div.trs_editor_view',\r\n        pubDate: 'div.view-date',\r\n    },\r\n    uk: {\r\n        country: 'uk',\r\n        countryCN: '英国',\r\n        link: 'http://www.chinese-embassy.org.uk/chn/lsfw/lsxz/',\r\n        list: '#docMore > tbody a',\r\n        title: '#article > tbody > tr:nth-child(2) > td',\r\n        description: '#article .content',\r\n        pubDate: '#article > tbody > tr:nth-child(5) > td',\r\n        consulates: {\r\n            belfast: {\r\n                cityCN: '贝尔法斯特',\r\n                link: 'http://belfast.chineseconsulate.org/chn/tztg/',\r\n                list: 'div.newslist a',\r\n                title: '#News_Body_Title',\r\n                description: '#News_Body_Txt_A > div',\r\n                pubDate: '#News_Body_Time',\r\n            },\r\n            edinburgh: {\r\n                cityCN: '爱丁堡',\r\n                link: 'http://edinburgh.china-consulate.org/chn/zytz/',\r\n                list: '#TRS_OUTLINE > tbody > tr:nth-child(3) a',\r\n                title: '#article > tbody > tr:nth-child(1) > td',\r\n                description: '#article > tbody > tr:nth-child(3) > td',\r\n                pubDate: '#article > tbody > tr:nth-child(2) > td',\r\n            },\r\n            manchester: {\r\n                cityCN: '曼彻斯特',\r\n                link: 'http://manchester.chineseconsulate.org/chn/tzgg/',\r\n                list: 'div#TRS a',\r\n                title: '#article > table > tbody > tr:nth-child(1) > td > font > b',\r\n                description: '#article > table > tbody > tr:nth-child(6) > td > div > div',\r\n                pubDate: '#article > table > tbody > tr:nth-child(4) > td > font',\r\n            },\r\n        },\r\n    },\r\n    us: {\r\n        country: 'us',\r\n        countryCN: '美国',\r\n        link: 'http://us.china-embassy.gov.cn/zytz/',\r\n        list: '.list-content ul li a',\r\n        title: 'div.title',\r\n        description: 'div.trs_editor_view',\r\n        pubDate: 'div.date',\r\n        consulates: {\r\n            chicago: {\r\n                cityCN: '芝加哥',\r\n                link: 'http://www.chinaconsulatechicago.org/chn/zytz/',\r\n                list: 'div#TRS a',\r\n                title: '#article > table > tbody > tr:nth-child(1) > td',\r\n                description: '#article > table > tbody > tr:nth-child(6) > td > div',\r\n                pubDate: '#article > table > tbody > tr:nth-child(3) > td > font',\r\n            },\r\n            newyork: {\r\n                cityCN: '纽约',\r\n                link: 'http://newyork.china-consulate.org/chn/fwzc/zxtz/',\r\n                list: 'div.cbox_ul a',\r\n                title: '#News_Body_Title',\r\n                description: '#News_Body_Txt_A',\r\n                pubDate: '#News_Body_Time',\r\n            },\r\n            sanfrancisco: {\r\n                cityCN: '旧金山',\r\n                link: 'http://www.chinaconsulatesf.org/chn/zytz/',\r\n                list: 'div#docMore a',\r\n                title: '#News_Body_Title',\r\n                description: '#article > .News_Body_Txt_A',\r\n                pubDate: '#News_Body_Time',\r\n            },\r\n        },\r\n    },\r\n};\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport supportedList from './supported-list';\r\n\r\nexport const route: Route = {\r\n    path: '/:country/:city?',\r\n    name: 'Unknown',\r\n    maintainers: ['HenryQW'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const country = ctx.req.param('country');\r\n    const city = ctx.req.param('city') ?? undefined;\r\n\r\n    let config = supportedList[country.toLowerCase()];\r\n    let desc;\r\n\r\n    if (city === undefined) {\r\n        desc = `中国驻${config.countryCN}大使馆 -- 重要通知`;\r\n    } else {\r\n        config = config.consulates[city.toLowerCase()];\r\n        desc = `中国驻${config.cityCN}领事馆 -- 重要通知`;\r\n    }\r\n\r\n    const link = config.link;\r\n    const hostname = new URL(link).hostname;\r\n\r\n    const res = await got(link);\r\n    const $ = load(res.data);\r\n\r\n    const list = [];\r\n\r\n    $(config.list)\r\n        .slice(0, 10)\r\n        .each((i, e) => {\r\n            const temp = new URL($(e).attr('href'), link);\r\n            if (temp.hostname === hostname) {\r\n                list.push(temp);\r\n            }\r\n        });\r\n\r\n    const out = await Promise.all(\r\n        list.map((link) =>\r\n            cache.tryGet(link.href, async () => {\r\n                const response = await got(link);\r\n                const $ = load(response.data);\r\n                const single = {\r\n                    title: $(config.title).text(),\r\n                    link,\r\n                    description: $(config.description).html(),\r\n                    pubDate: parseDate($(config.pubDate).text().replace('(', '').replace(')', '')),\r\n                };\r\n                return single;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: desc,\r\n        description: desc,\r\n        link,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"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"}