{"version":3,"file":"call-for-paper-DZiAazhD.js","names":[],"sources":["../../lib/routes/sciencedirect/call-for-paper.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/call-for-paper/:subject',\r\n    categories: ['journal'],\r\n    example: '/sciencedirect/call-for-paper/education',\r\n    parameters: {\r\n        subject: '学科分类，例如“education”',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['sciencedirect.com'],\r\n        },\r\n    ],\r\n    name: 'Call for Papers',\r\n    maintainers: ['etShaw-zh'],\r\n    handler,\r\n    url: 'sciencedirect.com/browse/calls-for-papers',\r\n    description: '`sciencedirect.com/browse/calls-for-papers?subject=education` -> `/sciencedirect/call-for-paper/education`',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { subject = '' } = ctx.req.param();\r\n    const apiUrl = `https://www.sciencedirect.com/browse/calls-for-papers?subject=${subject}`;\r\n    const headers = {\r\n        accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',\r\n        'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36', // need this to avoid 403, 503 error\r\n    };\r\n    const response = await got(apiUrl, { headers });\r\n    const $ = load(response.body);\r\n\r\n    const scriptJSON = $('script[data-iso-key=\"_0\"]').text();\r\n    if (!scriptJSON) {\r\n        throw new Error('Cannot find the script with data-iso-key=\"_0\"');\r\n    }\r\n\r\n    let data;\r\n    try {\r\n        data = JSON.parse(JSON.parse(scriptJSON));\r\n    } catch (error: any) {\r\n        throw new Error(`Failed to parse embedded script JSON: ${error.message}`);\r\n    }\r\n\r\n    const cfpList = data?.callsForPapers?.list || [];\r\n    if (!cfpList.length) {\r\n        throw new Error('No Calls for Papers found');\r\n    }\r\n\r\n    const items = cfpList.map((cfp) => {\r\n        const link = `https://www.sciencedirect.com/special-issue/${cfp.contentId}/${cfp.url}`;\r\n        const description = art(path.join(__dirname, 'templates/description.art'), {\r\n            summary: cfp.summary,\r\n            submissionDeadline: cfp.submissionDeadline,\r\n            displayName: cfp.journal.displayName,\r\n            impactFactor: cfp.journal.impactFactor,\r\n            citeScore: cfp.journal.citeScore,\r\n        });\r\n\r\n        return {\r\n            title: cfp.title,\r\n            author: `${cfp.journal.displayName} (IF: ${cfp.journal.impactFactor})`,\r\n            link,\r\n            description,\r\n            pubDate: cfp.submissionDeadline || '',\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: `ScienceDirect Calls for Papers - ${subject}`,\r\n        link: apiUrl,\r\n        description: `Calls for Papers on ScienceDirect for subject: ${subject}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"+WAMA,MAAa,EAAe,CACxB,KAAM,2BACN,WAAY,CAAC,WACb,QAAS,0CACT,WAAY,CACR,QAAS,sBAEb,MAAO,CACH,CACI,OAAQ,CAAC,uBAGjB,KAAM,kBACN,YAAa,CAAC,aACd,UACA,IAAK,4CACL,YAAa,8GAGjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,UAAU,IAAO,EAAI,IAAI,QAC3B,EAAS,iEAAiE,IAC1E,EAAU,CACZ,OAAQ,0IACR,aAAc,yHAEZ,EAAW,MAAM,EAAI,EAAQ,CAAE,YAC/B,EAAI,EAAK,EAAS,MAElB,EAAa,EAAE,6BAA6B,OAClD,GAAI,CAAC,EACD,MAAU,MAAM,iDAGpB,IAAI,EACJ,GAAI,CACA,EAAO,KAAK,MAAM,KAAK,MAAM,UACxB,EAAY,CACjB,MAAU,MAAM,yCAAyC,EAAM,WAGnE,IAAM,EAAU,GAAM,gBAAgB,MAAQ,GAC9C,GAAI,CAAC,EAAQ,OACT,MAAU,MAAM,6BAGpB,IAAM,EAAQ,EAAQ,IAAK,GAAQ,CAC/B,IAAM,EAAO,+CAA+C,EAAI,UAAU,GAAG,EAAI,MAC3E,EAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACvE,QAAS,EAAI,QACb,mBAAoB,EAAI,mBACxB,YAAa,EAAI,QAAQ,YACzB,aAAc,EAAI,QAAQ,aAC1B,UAAW,EAAI,QAAQ,YAG3B,MAAO,CACH,MAAO,EAAI,MACX,OAAQ,GAAG,EAAI,QAAQ,YAAY,QAAQ,EAAI,QAAQ,aAAa,GACpE,OACA,cACA,QAAS,EAAI,oBAAsB,MAI3C,MAAO,CACH,MAAO,oCAAoC,IAC3C,KAAM,EACN,YAAa,kDAAkD,IAC/D,KAAM"}