{"version":3,"file":"news-CRUbJWRb.js","names":["route: Route","ofetch","itemsArray: MediaItem[]","tagArray: TagItem[]","tagIdNameMapping: { [key: string]: string }"],"sources":["../../lib/routes/isct/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { decode } from 'entities';\r\n\r\ninterface MediaItem {\r\n    ID: string;\r\n    TITLE: string;\r\n    PUBLISH_DATE: string;\r\n    META_DESCRIPTION: string;\r\n    MEDIA_CD: string;\r\n    MEDIA_TYPES: string;\r\n}\r\n\r\ninterface TagItem {\r\n    TAG_ID: string;\r\n    TAG_NAME: string;\r\n}\r\n\r\nexport const route: Route = {\r\n    path: '/news/:lang',\r\n    categories: ['university'],\r\n    example: '/isct/news/ja',\r\n    parameters: { lang: 'language, could be ja or en' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.isct.ac.jp/:lang/news'],\r\n            target: '/news/:lang',\r\n        },\r\n    ],\r\n    name: 'News',\r\n    maintainers: ['catyyy'],\r\n    handler: async (ctx) => {\r\n        const { lang = 'ja' } = ctx.req.param();\r\n        const mediaResponse = await ofetch(`https://www.isct.ac.jp/expansion/get_media_list_json.php?lang_cd=${lang}`);\r\n        const tagResponse = await ofetch(`https://www.isct.ac.jp/expansion/get_tag_list_json.php?lang_cd=${lang}`);\r\n\r\n        const mediaData = JSON.parse(decode(mediaResponse));\r\n        const tagData = JSON.parse(decode(tagResponse));\r\n\r\n        const itemsArray: MediaItem[] = Object.values(mediaData);\r\n        const tagArray: TagItem[] = Object.values(tagData);\r\n\r\n        const tagIdNameMapping: { [key: string]: string } = {};\r\n\r\n        for (const item of Object.values(tagArray)) {\r\n            tagIdNameMapping[item.TAG_ID] = item.TAG_NAME;\r\n        }\r\n\r\n        const items = itemsArray.map((item) => ({\r\n            // 文章标题\r\n            title: item.TITLE,\r\n            // 文章链接\r\n            link: 'news/' + item.MEDIA_CD,\r\n            // 文章正文\r\n            description: item.META_DESCRIPTION,\r\n            // 文章发布日期\r\n            pubDate: parseDate(item.PUBLISH_DATE),\r\n            // 如果有的话，文章作者\r\n            // author: item.user.login,\r\n            // 如果有的话，文章分类\r\n            category: item.MEDIA_TYPES ? [tagIdNameMapping[Number.parseInt(item.MEDIA_TYPES.replaceAll('\"', ''), 10)]] : [],\r\n        }));\r\n        return {\r\n            // 源标题\r\n            title: `ISCT News - ${lang}`,\r\n            // 源链接\r\n            link: `https://www.isct.ac.jp/${lang}/news`,\r\n            // 源文章\r\n            item: items,\r\n        };\r\n    },\r\n};\r\n"],"mappings":"kQAmBA,MAAaA,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,cACb,QAAS,gBACT,WAAY,CAAE,KAAM,+BACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,6BACT,OAAQ,gBAGhB,KAAM,OACN,YAAa,CAAC,UACd,QAAS,KAAO,IAAQ,CACpB,GAAM,CAAE,OAAO,MAAS,EAAI,IAAI,QAC1B,EAAgB,MAAMC,EAAO,oEAAoE,KACjG,EAAc,MAAMA,EAAO,kEAAkE,KAE7F,EAAY,KAAK,MAAM,EAAO,IAC9B,EAAU,KAAK,MAAM,EAAO,IAE5BC,EAA0B,OAAO,OAAO,GACxCC,EAAsB,OAAO,OAAO,GAEpCC,EAA8C,GAEpD,IAAK,IAAM,KAAQ,OAAO,OAAO,GAC7B,EAAiB,EAAK,QAAU,EAAK,SAGzC,IAAM,EAAQ,EAAW,IAAK,IAAU,CAEpC,MAAO,EAAK,MAEZ,KAAM,QAAU,EAAK,SAErB,YAAa,EAAK,iBAElB,QAAS,EAAU,EAAK,cAIxB,SAAU,EAAK,YAAc,CAAC,EAAiB,OAAO,SAAS,EAAK,YAAY,WAAW,IAAK,IAAK,MAAQ,MAEjH,MAAO,CAEH,MAAO,eAAe,IAEtB,KAAM,0BAA0B,EAAK,OAErC,KAAM"}