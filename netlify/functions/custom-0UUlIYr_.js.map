{"version":3,"file":"custom-0UUlIYr_.js","names":["route: Route","ConfigNotFoundError","got","utils","cache"],"sources":["../../lib/routes/youtube/custom.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport utils from './utils';\r\nimport { config } from '@/config';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nexport const route: Route = {\r\n    path: '/c/:username/:embed?',\r\n    categories: ['social-media'],\r\n    example: '/youtube/c/YouTubeCreators',\r\n    parameters: { username: 'YouTube custom URL', embed: 'Default to embed the video, set to any value to disable embedding' },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'YOUTUBE_KEY',\r\n                description: ' YouTube API Key, support multiple keys, split them with `,`, [API Key application](https://console.developers.google.com/)',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.youtube.com/c/:id'],\r\n            target: '/c/:id',\r\n        },\r\n    ],\r\n    name: 'Custom URL',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    if (!config.youtube || !config.youtube.key) {\r\n        throw new ConfigNotFoundError('YouTube RSS is disabled due to the lack of <a href=\"https://docs.rsshub.app/deploy/config#route-specific-configurations\">relevant config</a>');\r\n    }\r\n    const username = ctx.req.param('username');\r\n    const embed = !ctx.req.param('embed');\r\n\r\n    const { data: response } = await got(`https://www.youtube.com/c/${username}`);\r\n    const $ = load(response);\r\n    const ytInitialData = JSON.parse(\r\n        $('script')\r\n            .text()\r\n            .match(/ytInitialData = ({.*?});/)?.[1] || '{}'\r\n    );\r\n    const externalId = ytInitialData.metadata.channelMetadataRenderer.externalId;\r\n    const playlistId = (await utils.getChannelWithId(externalId, 'contentDetails', cache)).data.items[0].contentDetails.relatedPlaylists.uploads;\r\n\r\n    const data = (await utils.getPlaylistItems(playlistId, 'snippet', cache)).data.items;\r\n\r\n    return {\r\n        title: `${username} - YouTube`,\r\n        link: `https://www.youtube.com/c/${username}`,\r\n        description: ytInitialData.metadata.channelMetadataRenderer.description,\r\n        image: ytInitialData.metadata.channelMetadataRenderer.avatar?.thumbnails?.[0]?.url,\r\n        item: data\r\n            .filter((d) => d.snippet.title !== 'Private video' && d.snippet.title !== 'Deleted video')\r\n            .map((item) => {\r\n                const snippet = item.snippet;\r\n                const videoId = snippet.resourceId.videoId;\r\n                const img = utils.getThumbnail(snippet.thumbnails);\r\n                return {\r\n                    title: snippet.title,\r\n                    description: utils.renderDescription(embed, videoId, img, utils.formatDescription(snippet.description)),\r\n                    pubDate: parseDate(snippet.publishedAt),\r\n                    link: `https://www.youtube.com/watch?v=${videoId}`,\r\n                    author: snippet.videoOwnerChannelTitle,\r\n                    image: img.url,\r\n                };\r\n            }),\r\n    };\r\n}\r\n"],"mappings":"ojBASA,MAAaA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,gBACb,QAAS,6BACT,WAAY,CAAE,SAAU,qBAAsB,MAAO,qEACrD,SAAU,CACN,cAAe,CACX,CACI,KAAM,cACN,YAAa,gIAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,yBACT,OAAQ,WAGhB,KAAM,aACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAI,CAAC,EAAO,SAAW,CAAC,EAAO,QAAQ,IACnC,MAAM,IAAIC,EAAoB,gJAElC,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAQ,CAAC,EAAI,IAAI,MAAM,SAEvB,CAAE,KAAM,GAAa,MAAMC,EAAI,6BAA6B,KAC5D,EAAI,EAAK,GACT,EAAgB,KAAK,MACvB,EAAE,UACG,OACA,MAAM,8BAA8B,IAAM,MAE7C,EAAa,EAAc,SAAS,wBAAwB,WAC5D,GAAc,MAAMC,EAAM,iBAAiB,EAAY,iBAAkBC,IAAQ,KAAK,MAAM,GAAG,eAAe,iBAAiB,QAE/H,GAAQ,MAAMD,EAAM,iBAAiB,EAAY,UAAWC,IAAQ,KAAK,MAE/E,MAAO,CACH,MAAO,GAAG,EAAS,YACnB,KAAM,6BAA6B,IACnC,YAAa,EAAc,SAAS,wBAAwB,YAC5D,MAAO,EAAc,SAAS,wBAAwB,QAAQ,aAAa,IAAI,IAC/E,KAAM,EACD,OAAQ,GAAM,EAAE,QAAQ,QAAU,iBAAmB,EAAE,QAAQ,QAAU,iBACzE,IAAK,GAAS,CACX,IAAM,EAAU,EAAK,QACf,EAAU,EAAQ,WAAW,QAC7B,EAAMD,EAAM,aAAa,EAAQ,YACvC,MAAO,CACH,MAAO,EAAQ,MACf,YAAaA,EAAM,kBAAkB,EAAO,EAAS,EAAKA,EAAM,kBAAkB,EAAQ,cAC1F,QAAS,EAAU,EAAQ,aAC3B,KAAM,mCAAmC,IACzC,OAAQ,EAAQ,uBAChB,MAAO,EAAI"}