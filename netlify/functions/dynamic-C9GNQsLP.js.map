{"version":3,"file":"dynamic-C9GNQsLP.js","names":["route: Route","ofetch","title: string | undefined","description: string | undefined","pubDate: Date | undefined","author: string | undefined","link: string | undefined","category: string[] | undefined"],"sources":["../../lib/routes/juejin/dynamic.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/dynamic/:id',\r\n    categories: ['programming'],\r\n    example: '/juejin/dynamic/3051900006845944',\r\n    parameters: { id: '用户 id, 可在用户页 URL 中找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['juejin.cn/user/:id'],\r\n        },\r\n    ],\r\n    name: '用户动态',\r\n    maintainers: ['CaoMeiYouRen'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n\r\n    const response = await ofetch('https://api.juejin.cn/user_api/v1/user/dynamic', {\r\n        query: {\r\n            user_id: id,\r\n            cursor: 0,\r\n        },\r\n    });\r\n    const list = response.data.list;\r\n\r\n    const user = list[0].user;\r\n    const username = user.user_name;\r\n\r\n    const items = list.map((e) => {\r\n        const { target_type, target_data, action, time } = e; // action: 0.发布文章；1.点赞文章；2.发布沸点；3.点赞沸点；4.关注用户；5.关注标签\r\n        let title: string | undefined;\r\n        let description: string | undefined;\r\n        let pubDate: Date | undefined;\r\n        let author: string | undefined;\r\n        let link: string | undefined;\r\n        let category: string[] | undefined;\r\n        switch (target_type) {\r\n            case 'short_msg': {\r\n                // 沸点/点赞等\r\n                const { msg_Info, author_user_info, msg_id, topic } = target_data;\r\n                const { content, pic_list, ctime } = msg_Info;\r\n                title = content;\r\n                const imgs = pic_list.map((img) => `<img src=\"${img}\"><br>`).join('');\r\n                description = `${content.replaceAll('\\n', '<br>')}<br>${imgs}`;\r\n                pubDate = parseDate(Number(ctime) * 1000);\r\n                author = author_user_info.user_name;\r\n                link = `https://juejin.cn/pin/${msg_id}`;\r\n                category = topic.title;\r\n                if (action === 3) {\r\n                    title = `${username} 赞了这篇沸点//@${author}：${title}`;\r\n                    description = `${username} 赞了这篇沸点//@${author}：${description}`;\r\n                }\r\n                break;\r\n            }\r\n            case 'article': {\r\n                // 文章\r\n                const { article_id, article_info, author_user_info, tags } = target_data;\r\n                const { ctime, brief_content } = article_info;\r\n                title = article_info.title;\r\n                description = brief_content;\r\n                pubDate = parseDate(Number(ctime) * 1000);\r\n                author = author_user_info.user_name;\r\n                link = `https://juejin.cn/post/${article_id}`;\r\n                category = [...new Set([target_data.category.category_name, ...tags.map((t) => t.tag_name)])];\r\n                if (action === 1) {\r\n                    title = `${username} 赞了这篇文章//@${author}：${title}`;\r\n                }\r\n                break;\r\n            }\r\n            case 'user': {\r\n                // 关注用户\r\n                const { user_name, user_id } = target_data;\r\n                title = `${username} 关注了 ${user_name}`;\r\n                description = `${user_name}<br>简介：${target_data.description}`;\r\n                author = user_name;\r\n                link = `https://juejin.cn/user/${user_id}`;\r\n                pubDate = parseDate(time * 1000);\r\n                break;\r\n            }\r\n            case 'tag': {\r\n                // 关注标签\r\n                const { tag_name } = target_data;\r\n                title = `${username} 关注了标签 ${tag_name}`;\r\n                description = tag_name;\r\n                category = [tag_name];\r\n                link = `https://juejin.cn/tag/${encodeURIComponent(tag_name)}`;\r\n                pubDate = parseDate(time * 1000);\r\n                break;\r\n            }\r\n            default:\r\n                break;\r\n        }\r\n        return {\r\n            title,\r\n            description,\r\n            pubDate,\r\n            author,\r\n            link,\r\n            category,\r\n            guid: link,\r\n        };\r\n    });\r\n    return {\r\n        title: `掘金用户动态-${username}`,\r\n        link: `https://juejin.cn/user/${id}/`,\r\n        description: user.description || `掘金用户动态-${username}`,\r\n        image: user.avatar_large,\r\n        item: items,\r\n        author: username,\r\n    };\r\n}\r\n"],"mappings":"gOAIA,MAAaA,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,eACb,QAAS,mCACT,WAAY,CAAE,GAAI,wBAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,wBAGjB,KAAM,OACN,YAAa,CAAC,gBACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MAEnB,EAAW,MAAMC,EAAO,iDAAkD,CAC5E,MAAO,CACH,QAAS,EACT,OAAQ,KAGV,EAAO,EAAS,KAAK,KAErB,EAAO,EAAK,GAAG,KACf,EAAW,EAAK,UAEhB,EAAQ,EAAK,IAAK,GAAM,CAC1B,GAAM,CAAE,cAAa,cAAa,SAAQ,QAAS,EAC/CC,EACAC,EACAC,EACAC,EACAC,EACAC,EACJ,OAAQ,EAAR,CACI,IAAK,YAAa,CAEd,GAAM,CAAE,WAAU,mBAAkB,SAAQ,SAAU,EAChD,CAAE,UAAS,WAAU,SAAU,EACrC,EAAQ,EACR,IAAM,EAAO,EAAS,IAAK,GAAQ,aAAa,EAAI,SAAS,KAAK,IAClE,EAAc,GAAG,EAAQ,WAAW;EAAM,QAAQ,MAAM,IACxD,EAAU,EAAU,OAAO,GAAS,KACpC,EAAS,EAAiB,UAC1B,EAAO,yBAAyB,IAChC,EAAW,EAAM,MACb,IAAW,IACX,EAAQ,GAAG,EAAS,YAAY,EAAO,GAAG,IAC1C,EAAc,GAAG,EAAS,YAAY,EAAO,GAAG,KAEpD,MAEJ,IAAK,UAAW,CAEZ,GAAM,CAAE,aAAY,eAAc,mBAAkB,QAAS,EACvD,CAAE,QAAO,iBAAkB,EACjC,EAAQ,EAAa,MACrB,EAAc,EACd,EAAU,EAAU,OAAO,GAAS,KACpC,EAAS,EAAiB,UAC1B,EAAO,0BAA0B,IACjC,EAAW,CAAC,GAAG,IAAI,IAAI,CAAC,EAAY,SAAS,cAAe,GAAG,EAAK,IAAK,GAAM,EAAE,aAC7E,IAAW,IACX,EAAQ,GAAG,EAAS,YAAY,EAAO,GAAG,KAE9C,MAEJ,IAAK,OAAQ,CAET,GAAM,CAAE,YAAW,WAAY,EAC/B,EAAQ,GAAG,EAAS,OAAO,IAC3B,EAAc,GAAG,EAAU,SAAS,EAAY,cAChD,EAAS,EACT,EAAO,0BAA0B,IACjC,EAAU,EAAU,EAAO,KAC3B,MAEJ,IAAK,MAAO,CAER,GAAM,CAAE,YAAa,EACrB,EAAQ,GAAG,EAAS,SAAS,IAC7B,EAAc,EACd,EAAW,CAAC,GACZ,EAAO,yBAAyB,mBAAmB,KACnD,EAAU,EAAU,EAAO,KAC3B,MAEJ,QACI,MAER,MAAO,CACH,QACA,cACA,UACA,SACA,OACA,WACA,KAAM,KAGd,MAAO,CACH,MAAO,UAAU,IACjB,KAAM,0BAA0B,EAAG,GACnC,YAAa,EAAK,aAAe,UAAU,IAC3C,MAAO,EAAK,aACZ,KAAM,EACN,OAAQ"}