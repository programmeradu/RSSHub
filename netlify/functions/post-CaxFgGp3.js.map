{"version":3,"file":"post-CaxFgGp3.js","names":["cache","ofetch","InvalidParameterError"],"sources":["../../lib/routes/myfans/utils.ts","../../lib/routes/myfans/post.ts"],"sourcesContent":["import ofetch from '@/utils/ofetch';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\nimport cache from '@/utils/cache';\r\nimport { Post, UserProfile } from './types';\r\n\r\nconst apiBaseUrl = 'https://api.myfans.jp';\r\nexport const baseUrl = 'https://myfans.jp';\r\n\r\nconst headers = {\r\n    'google-ga-data': 'event328',\r\n};\r\n\r\nexport const showByUsername = (username: string) =>\r\n    cache.tryGet(`myfans:account:${username}`, async () => {\r\n        const accountInfo = await ofetch<UserProfile>(`${apiBaseUrl}/api/v2/users/show_by_username`, {\r\n            headers,\r\n            query: {\r\n                username,\r\n            },\r\n        });\r\n\r\n        if (!accountInfo.id) {\r\n            throw new InvalidParameterError('This creator does not exist.');\r\n        }\r\n\r\n        return accountInfo;\r\n    }) as Promise<UserProfile>;\r\n\r\nexport const getPostByAccountId = async (accountId) => {\r\n    const post = await ofetch(`${apiBaseUrl}/api/v2/users/${accountId}/posts`, {\r\n        headers,\r\n        query: {\r\n            sort_key: 'publish_start_at',\r\n            page: 1,\r\n        },\r\n    });\r\n\r\n    return post.data as Promise<Post[]>;\r\n};\r\n","import { Route } from '@/types';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { showByUsername, getPostByAccountId, baseUrl } from './utils';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\n\r\nexport const route: Route = {\r\n    path: '/user/:username',\r\n    categories: ['multimedia'],\r\n    example: '/myfans/user/secret_japan',\r\n    parameters: { username: 'User handle' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        nsfw: true,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['myfans.jp/:username', 'myfans.jp/:language/:username'],\r\n        },\r\n    ],\r\n    name: 'User Posts',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nconst render = (postImages, body) =>\r\n    art(path.join(__dirname, 'templates/post.art'), {\r\n        postImages,\r\n        body,\r\n    });\r\n\r\nasync function handler(ctx) {\r\n    const { username } = ctx.req.param();\r\n\r\n    const account = await showByUsername(username);\r\n    const posts = await getPostByAccountId(account.id);\r\n\r\n    const items = posts.map((p) => ({\r\n        title: p.body?.replaceAll('\\r\\n', ' ').trim().split(' ')[0],\r\n        description: render(p.post_images, p.body?.replaceAll('\\r\\n', '<br>')),\r\n        pubDate: parseDate(p.published_at),\r\n        link: `${baseUrl}/posts/${p.id}`,\r\n        author: p.user.name,\r\n    }));\r\n\r\n    return {\r\n        title: `${account.name} (@${account.username})`,\r\n        link: `${baseUrl}/${account.username}`,\r\n        description: `${account.posts_count} Post ${account.likes_count} Like ${account.followers_count}\r\nFollowers ${account.followings_count} Follow ${account.about.replaceAll('\\r\\n', ' ')}`,\r\n        image: account.avatar_url,\r\n        icon: account.avatar_url,\r\n        logo: account.avatar_url,\r\n        language: 'ja-JP',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"gdAKA,MAAA,EAAA,wBACA,EAAA,oBAEA,EAAA,CAAA,iBAAA,YAIA,EAAA,GAAA,EAAA,OAAA,kBAAA,IAAA,SAAA,oFASQ,GAAA,CAAA,EAAA,GAAA,MAAA,IAAA,EAAA,gCAIA,OAAA,IAGR,EAAA,KAAA,IAAA,sGASI,OAAA,EAAA,MC/BS,EAAe,CACxB,KAAM,kBACN,WAAY,CAAC,cACb,QAAS,4BACT,WAAY,CAAE,SAAU,eACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,KAAM,IAEV,MAAO,CACH,CACI,OAAQ,CAAC,sBAAuB,mCAGxC,KAAM,aACN,YAAa,CAAC,UACd,WAGE,GAAU,EAAY,IACxB,EAAI,EAAA,KAAA,EAAA,+BAA4C,CAC5C,aACA,SAGR,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,YAAa,EAAI,IAAI,QAEvB,EAAU,MAAM,EAAe,GAC/B,EAAQ,MAAM,EAAmB,EAAQ,IAEzC,EAAQ,EAAM,IAAK,IAAO,CAC5B,MAAO,EAAE,MAAM,WAAW;EAAQ,KAAK,OAAO,MAAM,KAAK,GACzD,YAAa,EAAO,EAAE,YAAa,EAAE,MAAM,WAAW;EAAQ,SAC9D,QAAS,EAAU,EAAE,cACrB,KAAM,GAAG,EAAQ,SAAS,EAAE,KAC5B,OAAQ,EAAE,KAAK,QAGnB,MAAO,CACH,MAAO,GAAG,EAAQ,KAAK,KAAK,EAAQ,SAAS,GAC7C,KAAM,GAAG,EAAQ,GAAG,EAAQ,WAC5B,YAAa,GAAG,EAAQ,YAAY,QAAQ,EAAQ,YAAY,QAAQ,EAAQ,gBAAgB;YAC5F,EAAQ,iBAAiB,UAAU,EAAQ,MAAM,WAAW;EAAQ,OACxE,MAAO,EAAQ,WACf,KAAM,EAAQ,WACd,KAAM,EAAQ,WACd,SAAU,QACV,KAAM"}