{"version":3,"file":"search-D3OySv5x.js","names":["route: Route","got"],"sources":["../../lib/routes/gov/zj/search.ts"],"sourcesContent":["import { Route, DataItem } from '@/types';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport dayjs from 'dayjs';\r\nexport const route: Route = {\r\n    path: '/zj/search/:websiteid?/:word/:cateid?',\r\n    categories: ['government'],\r\n    example: '/gov/zj/search',\r\n    parameters: {\r\n        websiteid: '搜索范围-全省、各市各区、详细信息点击源网站https://www.zj.gov.cn/请求中寻找',\r\n        word: '搜索关键词-默认：人才',\r\n        cateid: '信息分类-默认：658（全部）',\r\n        sortType: '排序类型-默认：2（按时间）',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['search.zj.gov.cn/jsearchfront/search.do'],\r\n            target: '/zj/search/:websiteid?/:word/:cateid?',\r\n        },\r\n    ],\r\n    name: '浙江省人民政府-全省政府网站统一搜索',\r\n    url: 'search.zj.gov.cn/jsearchfront/search.do',\r\n    maintainers: ['HaoyuLee'],\r\n    description: `\r\n| 行政区域         | websiteid |\r\n| ------------ | -- |\r\n| 宁波市本级     | 330201000000000  |\r\n\r\n| 搜索关键词         | word    |\r\n\r\n| 信息分类         | cateid    |\r\n\r\n| 排序类型         | sortType    |\r\n| ------------ | -- |\r\n| 按相关度     | 1  |\r\n| 按时间     | 2  |\r\n    `,\r\n    async handler(ctx) {\r\n        const { websiteid = '330201000000000', word = '人才', cateid = 658, sortType = 2 } = ctx.req.param();\r\n        const {\r\n            data: { result: list },\r\n        } = await got.post('https://search.zj.gov.cn/jsearchfront/interfaces/cateSearch.do', {\r\n            form: {\r\n                websiteid,\r\n                pg: '30',\r\n                p: '1',\r\n                cateid,\r\n                word,\r\n                checkError: 1,\r\n                isContains: 0,\r\n                q: word,\r\n                begin: dayjs().subtract(1, 'week').format('YYYYMMDD'),\r\n                end: dayjs().format('YYYYMMDD'),\r\n                timetype: 2,\r\n                pos: 'title,content,keyword',\r\n                sortType,\r\n            },\r\n        });\r\n        const items =\r\n            list?.map((item: string) => {\r\n                const $ = load(item);\r\n                const title = $('.titleWrapper>a');\r\n                const footer = $('.sourceTime>span');\r\n                return {\r\n                    title: title.text().trim() || '',\r\n                    link: title.attr('href') || '',\r\n                    pubDate: parseDate(footer.eq(1).text().trim().replace('时间:', '')) || '',\r\n                    author: footer.eq(0).text().trim().replace('来源:', '') || '',\r\n                    description: $('.newsDescribe>a').text() || '',\r\n                };\r\n            }) || [];\r\n        const res = {};\r\n        for (const current of items) {\r\n            if (!res[current.link]) {\r\n                res[current.link] = current;\r\n            }\r\n        }\r\n        return {\r\n            title: '浙江省人民政府-全省政府网站统一搜索',\r\n            link: 'https://search.zj.gov.cn/jsearchfront/search.do',\r\n            item: Object.entries(res).map(([, value]) => value) as DataItem[],\r\n        };\r\n    },\r\n};\r\n"],"mappings":"yUAKA,MAAaA,EAAe,CACxB,KAAM,wCACN,WAAY,CAAC,cACb,QAAS,iBACT,WAAY,CACR,UAAW,oDACX,KAAM,cACN,OAAQ,kBACR,SAAU,kBAEd,MAAO,CACH,CACI,OAAQ,CAAC,2CACT,OAAQ,0CAGhB,KAAM,qBACN,IAAK,0CACL,YAAa,CAAC,YACd,YAAa;;;;;;;;;;;;;MAcb,MAAM,QAAQ,EAAK,CACf,GAAM,CAAE,YAAY,kBAAmB,OAAO,KAAM,SAAS,IAAK,WAAW,GAAM,EAAI,IAAI,QACrF,CACF,KAAM,CAAE,OAAQ,IAChB,MAAMC,EAAI,KAAK,iEAAkE,CACjF,KAAM,CACF,YACA,GAAI,KACJ,EAAG,IACH,SACA,OACA,WAAY,EACZ,WAAY,EACZ,EAAG,EACH,MAAO,IAAQ,SAAS,EAAG,QAAQ,OAAO,YAC1C,IAAK,IAAQ,OAAO,YACpB,SAAU,EACV,IAAK,wBACL,cAGF,EACF,GAAM,IAAK,GAAiB,CACxB,IAAM,EAAI,EAAK,GACT,EAAQ,EAAE,mBACV,EAAS,EAAE,oBACjB,MAAO,CACH,MAAO,EAAM,OAAO,QAAU,GAC9B,KAAM,EAAM,KAAK,SAAW,GAC5B,QAAS,EAAU,EAAO,GAAG,GAAG,OAAO,OAAO,QAAQ,MAAO,MAAQ,GACrE,OAAQ,EAAO,GAAG,GAAG,OAAO,OAAO,QAAQ,MAAO,KAAO,GACzD,YAAa,EAAE,mBAAmB,QAAU,OAE9C,GACJ,EAAM,GACZ,IAAK,IAAM,KAAW,EACb,EAAI,EAAQ,QACb,EAAI,EAAQ,MAAQ,GAG5B,MAAO,CACH,MAAO,qBACP,KAAM,kDACN,KAAM,OAAO,QAAQ,GAAK,KAAK,EAAG,KAAW"}