{"version":3,"file":"nosec-wh8I1SR_.js","names":["route: Route","ofetch","got"],"sources":["../../lib/routes/nosec/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\n\r\nconst baseUrl = 'https://nosec.org/home/ajaxindexdata';\r\nconst keykinds = {\r\n    threaten: '威胁情报',\r\n    security: '安全动态',\r\n    hole: '漏洞预警',\r\n    leakage: '数据泄露',\r\n    speech: '专题报告',\r\n    skill: '技术分析',\r\n    tool: '安全工具',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:keykind?',\r\n    categories: ['programming'],\r\n    example: '/nosec/hole',\r\n    parameters: { keykind: '对应文章分类' },\r\n    name: 'Posts',\r\n    maintainers: ['hellodword'],\r\n    description: `| 分类     | 标识       |\r\n| :------- | :--------- |\r\n| 威胁情报 | \\`threaten\\` |\r\n| 安全动态 | \\`security\\` |\r\n| 漏洞预警 | \\`hole\\`     |\r\n| 数据泄露 | \\`leakage\\`  |\r\n| 专题报告 | \\`speech\\`   |\r\n| 技术分析 | \\`skill\\`    |\r\n| 安全工具 | \\`tool\\`     |`,\r\n    handler,\r\n    radar: [\r\n        {\r\n            source: ['nosec.org/home/index/:keykind', 'nosec.org/home/index'],\r\n            target: (params) => `/nosec${params.keykind ? `/${params.keybind.replace('.html', '')}` : ''}`,\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const csrfresponse = await ofetch.raw('https://nosec.org/home/index');\r\n    const $ = load(csrfresponse._data);\r\n    const token = $('meta[name=\"csrf-token\"]').attr('content');\r\n    const cookies = csrfresponse.headers.getSetCookie().toString();\r\n    const xsrf_token = cookies.match(/XSRF-TOKEN=[^\\s;]+/)[0];\r\n    const laravel_session = cookies.match(/laravel_session[^\\s;]+/)[0];\r\n\r\n    const keykind = ctx.req.param('keykind') || '';\r\n    let formdata;\r\n    let title;\r\n    let link;\r\n\r\n    if (Object.hasOwn(keykinds, keykind)) {\r\n        formdata = `keykind=${keykind}&page=1`;\r\n        title = `NOSEC 安全讯息平台 - ${keykinds[keykind]}`;\r\n        link = `https://nosec.org/home/index/${keykind}.html`;\r\n    } else {\r\n        // keykind 未知时则获取全部\r\n        formdata = `keykind=&page=1`;\r\n        title = `NOSEC 安全讯息平台`;\r\n        link = `https://nosec.org/home/index`;\r\n    }\r\n\r\n    const response = await got({\r\n        method: 'post',\r\n        url: baseUrl,\r\n        headers: {\r\n            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n            Accept: 'application/json',\r\n            cookie: `${xsrf_token};${laravel_session}`,\r\n            'X-CSRF-TOKEN': token,\r\n        },\r\n        body: formdata,\r\n    });\r\n\r\n    const data = response.data.data.threatData.data;\r\n\r\n    return {\r\n        // 源标题\r\n        title,\r\n        // 源链接\r\n        link,\r\n        // 源说明\r\n        description: title,\r\n        // 遍历此前获取的数据\r\n        item: data.map((item) => ({\r\n            // 文章标题\r\n            title: item.title,\r\n            // 文章正文\r\n            description: item.summary,\r\n            // 文章发布时间\r\n            pubDate: new Date(item.publiced_at).toUTCString(),\r\n            // 文章链接\r\n            link: `https://nosec.org/home/detail/${item.id}.html`,\r\n            author: item.username,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"wRAKA,MACM,EAAW,CACb,SAAU,OACV,SAAU,OACV,KAAM,OACN,QAAS,OACT,OAAQ,OACR,MAAO,OACP,KAAM,QAGGA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,eACb,QAAS,cACT,WAAY,CAAE,QAAS,UACvB,KAAM,QACN,YAAa,CAAC,cACd,YAAa,oNASb,UACA,MAAO,CACH,CACI,OAAQ,CAAC,gCAAiC,wBAC1C,OAAS,GAAW,SAAS,EAAO,QAAU,IAAI,EAAO,QAAQ,QAAQ,QAAS,MAAQ,QAKtG,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAe,MAAMC,EAAO,IAAI,gCAChC,EAAI,EAAK,EAAa,OACtB,EAAQ,EAAE,2BAA2B,KAAK,WAC1C,EAAU,EAAa,QAAQ,eAAe,WAC9C,EAAa,EAAQ,MAAM,sBAAsB,GACjD,EAAkB,EAAQ,MAAM,0BAA0B,GAE1D,EAAU,EAAI,IAAI,MAAM,YAAc,GACxC,EACA,EACA,EAEA,OAAO,OAAO,EAAU,IACxB,EAAW,WAAW,EAAQ,SAC9B,EAAQ,kBAAkB,EAAS,KACnC,EAAO,gCAAgC,EAAQ,SAG/C,EAAW,kBACX,EAAQ,eACR,EAAO,gCAGX,IAAM,EAAW,MAAMC,EAAI,CACvB,OAAQ,OACR,IAAK,uCACL,QAAS,CACL,eAAgB,mDAChB,OAAQ,mBACR,OAAQ,GAAG,EAAW,GAAG,IACzB,eAAgB,GAEpB,KAAM,IAGJ,EAAO,EAAS,KAAK,KAAK,WAAW,KAE3C,MAAO,CAEH,QAEA,OAEA,YAAa,EAEb,KAAM,EAAK,IAAK,IAAU,CAEtB,MAAO,EAAK,MAEZ,YAAa,EAAK,QAElB,QAAS,IAAI,KAAK,EAAK,aAAa,cAEpC,KAAM,iCAAiC,EAAK,GAAG,OAC/C,OAAQ,EAAK"}