{"version":3,"file":"channel-DXnVHPTh.js","names":["route: Route","cache"],"sources":["../../lib/routes/zaker/channel.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport * as cheerio from 'cheerio';\r\nimport { baseUrl, fetchItem, getSafeLineCookieWithData, parseList } from './utils';\r\nimport pMap from 'p-map';\r\n\r\nexport const route: Route = {\r\n    path: '/channel/:id?',\r\n    parameters: {\r\n        id: '分类 ID，可在 URL 中找到，默认为 `1`',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.myzaker.com/channel/:id'],\r\n            target: '/channel/:id',\r\n        },\r\n    ],\r\n    name: '分类',\r\n    example: '/zaker/channel/13',\r\n    maintainers: ['LogicJake', 'kt286', 'TonyRL'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id') ?? 1;\r\n    const link = `${baseUrl}/channel/${id}`;\r\n\r\n    const { cookie, data } = await getSafeLineCookieWithData(link);\r\n\r\n    const $ = cheerio.load(data);\r\n    const feedTitle = $('head title').text();\r\n    const list = parseList($);\r\n\r\n    const items = await pMap(list, (item) => cache.tryGet(item.link!, () => fetchItem(item, cookie)), { concurrency: 2 });\r\n\r\n    return {\r\n        title: feedTitle,\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"gaAMA,MAAaA,EAAe,CACxB,KAAM,gBACN,WAAY,CACR,GAAI,4BAER,MAAO,CACH,CACI,OAAQ,CAAC,+BACT,OAAQ,iBAGhB,KAAM,KACN,QAAS,oBACT,YAAa,CAAC,YAAa,QAAS,UACpC,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,OAAS,EAC5B,EAAO,GAAG,EAAQ,WAAW,IAE7B,CAAE,SAAQ,QAAS,MAAM,EAA0B,GAEnD,EAAI,EAAQ,KAAK,GACjB,EAAY,EAAE,cAAc,OAC5B,EAAO,EAAU,GAEjB,EAAQ,MAAM,EAAK,EAAO,GAASC,EAAM,OAAO,EAAK,SAAa,EAAU,EAAM,IAAU,CAAE,YAAa,IAEjH,MAAO,CACH,MAAO,EACP,OACA,KAAM"}