{"version":3,"file":"ceic-eDezyxId.js","names":["route: Route","got"],"sources":["../../lib/routes/earthquake/ceic.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/ceic/:type?',\r\n    categories: ['forecast'],\r\n    example: '/earthquake/ceic/1',\r\n    parameters: { type: '类型，见下表' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.cea.gov.cn/cea/xwzx/zqsd/index.html', 'www.cea.gov.cn/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: '中国地震台',\r\n    maintainers: ['SettingDust'],\r\n    handler,\r\n    url: 'www.cea.gov.cn/cea/xwzx/zqsd/index.html',\r\n    description: `| 参数 | 类型                        |\r\n| ---- | --------------------------- |\r\n| 1    | 最近 24 小时地震信息        |\r\n| 2    | 最近 48 小时地震信息        |\r\n| 5    | 最近一年 3.0 级以上地震信息 |\r\n| 7    | 最近一年 3.0 级以下地震     |\r\n| 8    | 最近一年 4.0 级以上地震信息 |\r\n| 9    | 最近一年 5.0 级以上地震信息 |\r\n| 0    | 最近一年 6.0 级以上地震信息 |\r\n\r\n  可通过全局过滤参数订阅您感兴趣的地区.`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let type = Number(ctx.req.param('type'));\r\n    type = type ?? 1;\r\n    const baseUrl = 'http://www.ceic.ac.cn';\r\n    const api = `${baseUrl}/ajax/speedsearch?num=${type}`;\r\n    const mappings = {\r\n        O_TIME: '发震时刻(UTC+8)',\r\n        LOCATION_C: '参考位置',\r\n        M: '震级(M)',\r\n        EPI_LAT: '纬度(°)',\r\n        EPI_LON: '经度(°)',\r\n        EPI_DEPTH: '深度(千米)',\r\n        SAVE_TIME: '录入时间',\r\n    };\r\n\r\n    const typeMappings = {\r\n        1: '最近24小时地震信息',\r\n        2: '最近48小时地震信息',\r\n        3: '最近7天地震信息',\r\n        4: '最近30天地震信息',\r\n        5: '最近一年3.0级以上地震信息',\r\n        6: '最近一年地震信息',\r\n        7: '最近一年3.0级以下地震',\r\n        8: '最近一年4.0级以上地震信息',\r\n        9: '最近一年5.0级以上地震信息',\r\n        0: '最近一年6.0级以上地震信息',\r\n    };\r\n\r\n    // 因为item数量限制20，所以对于RSS来说为无用类型，防止浪费资源\r\n    const disabledType = [3, 4, 6];\r\n\r\n    if (disabledType.includes(type)) {\r\n        type = 1;\r\n    }\r\n    const typeName = typeMappings[type];\r\n\r\n    const response = await got(api);\r\n    const data = response.data.replace(/,\"page\":\"(.*?)\",\"num\":/, ',\"num\":');\r\n    let json = JSON.parse(data.substring(1, data.length - 1)).shuju;\r\n    if (json.length > 20) {\r\n        json = json.slice(0, 20);\r\n    }\r\n\r\n    return {\r\n        title: typeName,\r\n        link: `${baseUrl}/speedsearch`,\r\n        allowEmpty: true,\r\n        item: json.map((entity) => {\r\n            const contentBuilder = [];\r\n            const { NEW_DID, LOCATION_C, M, O_TIME } = entity;\r\n            for (const mappingsKey in mappings) {\r\n                contentBuilder.push(`${mappings[mappingsKey]} ${entity[mappingsKey]}`);\r\n            }\r\n\r\n            return {\r\n                title: `${LOCATION_C}发生${M}级地震`,\r\n                link: `${baseUrl}/${NEW_DID}.html`,\r\n                pubDate: timezone(parseDate(O_TIME, 'YYYY-MM-DD HH:mm:ss'), +8),\r\n                description: contentBuilder.join('<br>'),\r\n                guid: NEW_DID,\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"uUAKA,MAAaA,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,YACb,QAAS,qBACT,WAAY,CAAE,KAAM,UACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,0CAA2C,mBACpD,OAAQ,KAGhB,KAAM,QACN,YAAa,CAAC,eACd,UACA,IAAK,0CACL,YAAa;;;;;;;;;;wBAajB,eAAe,EAAQ,EAAK,CACxB,IAAI,EAAO,OAAO,EAAI,IAAI,MAAM,SAChC,EAAO,GAAQ,EACf,IAAM,EAAU,wBACV,EAAM,GAAG,EAAQ,wBAAwB,IACzC,EAAW,CACb,OAAQ,cACR,WAAY,OACZ,EAAG,QACH,QAAS,QACT,QAAS,QACT,UAAW,SACX,UAAW,QAGT,EAAe,CACjB,EAAG,aACH,EAAG,aACH,EAAG,WACH,EAAG,YACH,EAAG,iBACH,EAAG,WACH,EAAG,eACH,EAAG,iBACH,EAAG,iBACH,EAAG,kBAID,EAAe,CAAC,EAAG,EAAG,GAExB,EAAa,SAAS,KACtB,EAAO,GAEX,IAAM,EAAW,EAAa,GAExB,EAAW,MAAMC,EAAI,GACrB,EAAO,EAAS,KAAK,QAAQ,yBAA0B,WACzD,EAAO,KAAK,MAAM,EAAK,UAAU,EAAG,EAAK,OAAS,IAAI,MAK1D,OAJI,EAAK,OAAS,KACd,EAAO,EAAK,MAAM,EAAG,KAGlB,CACH,MAAO,EACP,KAAM,GAAG,EAAQ,cACjB,WAAY,GACZ,KAAM,EAAK,IAAK,GAAW,CACvB,IAAM,EAAiB,GACjB,CAAE,UAAS,aAAY,IAAG,UAAW,EAC3C,IAAK,IAAM,KAAe,EACtB,EAAe,KAAK,GAAG,EAAS,GAAa,GAAG,EAAO,MAG3D,MAAO,CACH,MAAO,GAAG,EAAW,IAAI,EAAE,KAC3B,KAAM,GAAG,EAAQ,GAAG,EAAQ,OAC5B,QAAS,EAAS,EAAU,EAAQ,uBAAwB,GAC5D,YAAa,EAAe,KAAK,QACjC,KAAM"}