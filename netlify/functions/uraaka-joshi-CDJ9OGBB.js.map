{"version":3,"file":"uraaka-joshi-CDJ9OGBB.js","names":["route: Route","puppeteer"],"sources":["../../lib/routes/uraaka-joshi/uraaka-joshi.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport puppeteer from '@/utils/puppeteer';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    radar: [\r\n        {\r\n            source: ['uraaka-joshi.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['SettingDust', 'Halcao'],\r\n    handler,\r\n    url: 'uraaka-joshi.com/',\r\n};\r\n\r\nasync function handler() {\r\n    const link = `https://www.uraaka-joshi.com/`;\r\n    const title = `裏垢女子まとめ`;\r\n\r\n    const browser = await puppeteer();\r\n\r\n    const page = await browser.newPage();\r\n    await page.setRequestInterception(true);\r\n    page.on('request', (request) => {\r\n        request.resourceType() === 'document' || request.resourceType() === 'script' || request.resourceType() === 'fetch' ? request.continue() : request.abort();\r\n    });\r\n    page.on('requestfinished', async (request) => {\r\n        if (request.url() === link && request.response().status() === 403) {\r\n            await page.close();\r\n        }\r\n    });\r\n\r\n    let html = '';\r\n    try {\r\n        await page.goto(link, {\r\n            waitUntil: 'domcontentloaded',\r\n        });\r\n\r\n        await page.waitForSelector('#pickup03 .grid-cell');\r\n        await page.waitForSelector('#pickup04 .grid-cell');\r\n        await page.waitForSelector('#main-block .grid-cell');\r\n\r\n        const bodyHandle = await page.$('body');\r\n        html = await page.evaluate((body) => body.innerHTML, bodyHandle);\r\n    } catch {\r\n        throw new Error('Access denied (403)');\r\n    }\r\n    await browser.close();\r\n\r\n    const $ = load(html);\r\n    const list = $('.grid-cell');\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        item: list.toArray().map((item) => {\r\n            item = $(item);\r\n\r\n            // remove event and styles\r\n            item.find('*').removeAttr('onclick');\r\n            item.find('*').removeAttr('onerror');\r\n            item.find('*').removeAttr('style');\r\n\r\n            // format account style\r\n            const account = item.find('.account-group-link-row');\r\n            account.html(account.text());\r\n\r\n            // extract video tag from its player\r\n            item.find('.plyr--video').each((_, player) => {\r\n                player = $(player);\r\n\r\n                const video = player.find('video');\r\n                player.replaceWith(video);\r\n                const poster = video.attr('data-poster');\r\n                video.attr('poster', 'https:' + poster);\r\n\r\n                const source = video.find('source');\r\n                const src = source.attr('src');\r\n                source.attr('src', 'https:' + src);\r\n            });\r\n\r\n            // correct src of img tags\r\n            item.find('img').each((_, image) => {\r\n                const src = $(image).attr('data-src');\r\n                $(image).attr('src', 'https:' + src);\r\n            });\r\n\r\n            return {\r\n                title: item.find('.account-group').text() + ` - ${title}`,\r\n                description: item.html(),\r\n                link: item.find('.account-group-link-row').attr('href'),\r\n                pubDate: parseDate(item.find('.profile-char').attr('datetime')),\r\n                guid: item.find('a.tap-image').attr('data-tweet-id') || item.find('video[class^=\"js-player-\"]').attr('data-tweet-id') || parseDate(item.find('.profile-char').attr('datetime')).getTime(),\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"sOAKA,MAAaA,EAAe,CACxB,KAAM,IACN,MAAO,CACH,CACI,OAAQ,CAAC,qBACT,OAAQ,KAGhB,KAAM,UACN,YAAa,CAAC,cAAe,UAC7B,UACA,IAAK,qBAGT,eAAe,GAAU,CACrB,IAAM,EAAO,gCACP,EAAQ,UAER,EAAU,MAAMC,IAEhB,EAAO,MAAM,EAAQ,UAC3B,MAAM,EAAK,uBAAuB,IAClC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,YAAc,EAAQ,iBAAmB,UAAY,EAAQ,iBAAmB,QAAU,EAAQ,WAAa,EAAQ,UAEtJ,EAAK,GAAG,kBAAmB,KAAO,IAAY,CACtC,EAAQ,QAAU,GAAQ,EAAQ,WAAW,WAAa,KAC1D,MAAM,EAAK,UAInB,IAAI,EAAO,GACX,GAAI,CACA,MAAM,EAAK,KAAK,EAAM,CAClB,UAAW,qBAGf,MAAM,EAAK,gBAAgB,wBAC3B,MAAM,EAAK,gBAAgB,wBAC3B,MAAM,EAAK,gBAAgB,0BAE3B,IAAM,EAAa,MAAM,EAAK,EAAE,QAChC,EAAO,MAAM,EAAK,SAAU,GAAS,EAAK,UAAW,QACjD,CACJ,MAAU,MAAM,uBAEpB,MAAM,EAAQ,QAEd,IAAM,EAAI,EAAK,GACT,EAAO,EAAE,cAEf,MAAO,CACH,QACA,OACA,KAAM,EAAK,UAAU,IAAK,GAAS,CAC/B,EAAO,EAAE,GAGT,EAAK,KAAK,KAAK,WAAW,WAC1B,EAAK,KAAK,KAAK,WAAW,WAC1B,EAAK,KAAK,KAAK,WAAW,SAG1B,IAAM,EAAU,EAAK,KAAK,2BAuB1B,OAtBA,EAAQ,KAAK,EAAQ,QAGrB,EAAK,KAAK,gBAAgB,MAAM,EAAG,IAAW,CAC1C,EAAS,EAAE,GAEX,IAAM,EAAQ,EAAO,KAAK,SAC1B,EAAO,YAAY,GACnB,IAAM,EAAS,EAAM,KAAK,eAC1B,EAAM,KAAK,SAAU,SAAW,GAEhC,IAAM,EAAS,EAAM,KAAK,UACpB,EAAM,EAAO,KAAK,OACxB,EAAO,KAAK,MAAO,SAAW,KAIlC,EAAK,KAAK,OAAO,MAAM,EAAG,IAAU,CAChC,IAAM,EAAM,EAAE,GAAO,KAAK,YAC1B,EAAE,GAAO,KAAK,MAAO,SAAW,KAG7B,CACH,MAAO,EAAK,KAAK,kBAAkB,OAAS,MAAM,IAClD,YAAa,EAAK,OAClB,KAAM,EAAK,KAAK,2BAA2B,KAAK,QAChD,QAAS,EAAU,EAAK,KAAK,iBAAiB,KAAK,aACnD,KAAM,EAAK,KAAK,eAAe,KAAK,kBAAoB,EAAK,KAAK,8BAA8B,KAAK,kBAAoB,EAAU,EAAK,KAAK,iBAAiB,KAAK,aAAa"}