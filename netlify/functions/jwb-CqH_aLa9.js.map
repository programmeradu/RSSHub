{"version":3,"file":"jwb-CqH_aLa9.js","names":["route: Route","got","cache","$"],"sources":["../../lib/routes/shu/jwb.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst host = 'https://jwb.shu.edu.cn/';\r\nconst alias = new Map([\r\n    ['notice', 'tzgg'], // 通知公告\r\n    ['news', 'xw'], // 新闻动态\r\n    /* ['policy', 'zcwj'],  政策文件 //BUG */\r\n]);\r\n\r\nexport const route: Route = {\r\n    path: ['/jwb/:type?'],\r\n    radar: [\r\n        {\r\n            source: ['www.shu.edu.cn/index'],\r\n            target: '/:type?',\r\n        },\r\n    ],\r\n    name: '教务部',\r\n    maintainers: ['tuxinghuan', 'GhhG123'],\r\n    handler,\r\n    description: `| 通知通告 | 新闻 | 政策文件(bug) |\r\n| -------- | ---- | -------- |\r\n| notice   | news | policy   |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type') || 'notice';\r\n    const link = `https://jwb.shu.edu.cn/index/${alias.get(type) || type}.htm`;\r\n    const respond = await got.get(link);\r\n    const $ = load(respond.data);\r\n    const title = $('title').text();\r\n    const list = $('.only-list')\r\n        .find('li')\r\n        .slice(0, 10)\r\n        .toArray()\r\n        .map((ele) => ({\r\n            title: $(ele).find('a').text(),\r\n            link: new URL($(ele).find('a').attr('href'), host).href,\r\n            date: $(ele).children('span').text(),\r\n        }));\r\n\r\n    const all = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await got.get(item.link);\r\n                const $ = load(response.data);\r\n                item.author = $('[id$=_lblUser]').text().trim();\r\n                item.pubDate = parseDate(item.date, 'YYYY年MM月DD日');\r\n                item.description = $('.v_news_content').html() || item.title;\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n    return {\r\n        title,\r\n        link,\r\n        image: 'https://www.shu.edu.cn/__local/0/08/C6/1EABE492B0CF228A5564D6E6ABE_779D1EE3_5BF7.png',\r\n        item: all,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MACM,EAAQ,IAAI,IAAI,CAClB,CAAC,SAAU,QACX,CAAC,OAAQ,QAIAA,EAAe,CACxB,KAAM,CAAC,eACP,MAAO,CACH,CACI,OAAQ,CAAC,wBACT,OAAQ,YAGhB,KAAM,MACN,YAAa,CAAC,aAAc,WAC5B,UACA,YAAa;;iCAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,SAChC,EAAO,gCAAgC,EAAM,IAAI,IAAS,EAAK,MAC/D,EAAU,MAAMC,EAAI,IAAI,GACxB,EAAI,EAAK,EAAQ,MACjB,EAAQ,EAAE,SAAS,OACnB,EAAO,EAAE,cACV,KAAK,MACL,MAAM,EAAG,IACT,UACA,IAAK,IAAS,CACX,MAAO,EAAE,GAAK,KAAK,KAAK,OACxB,KAAM,IAAI,IAAI,EAAE,GAAK,KAAK,KAAK,KAAK,QAAS,2BAAM,KACnD,KAAM,EAAE,GAAK,SAAS,QAAQ,UAGhC,EAAM,MAAM,QAAQ,IACtB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAW,MAAMD,EAAI,IAAI,EAAK,MAC9BE,EAAI,EAAK,EAAS,MAIxB,MAHA,GAAK,OAASA,EAAE,kBAAkB,OAAO,OACzC,EAAK,QAAU,EAAU,EAAK,KAAM,eACpC,EAAK,YAAcA,EAAE,mBAAmB,QAAU,EAAK,MAChD,MAInB,MAAO,CACH,QACA,OACA,MAAO,uFACP,KAAM"}