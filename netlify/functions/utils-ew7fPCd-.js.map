{"version":3,"file":"utils-ew7fPCd-.js","names":[],"sources":["../../lib/routes/pikabu/utils.ts"],"sourcesContent":["import { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst baseUrl = 'https://pikabu.ru';\r\n\r\nconst fixImage = (element) => {\r\n    element.find('.story-image__stretch').remove();\r\n    element.find('.story-image__image').each((_, img) => {\r\n        if (img.attribs['data-src'] && img.attribs['data-large-image']) {\r\n            img.attribs.src = img.attribs['data-large-image'];\r\n            delete img.attribs['data-src'];\r\n            delete img.attribs['data-large-image'];\r\n        }\r\n    });\r\n};\r\n\r\nconst fixVideo = (element) => {\r\n    const preview = element\r\n        .find('.player__preview')\r\n        .attr('style')\r\n        .match(/url\\((.+)\\);/)[1];\r\n    const dataType = element.attr('data-type');\r\n    let videoHtml = '';\r\n\r\n    if (dataType === 'video') {\r\n        const videoId = element.attr('data-source').match(/\\/embed\\/(.+)$/)[1];\r\n        videoHtml = art(path.join(__dirname, 'templates/video.art'), { videoId });\r\n    } else if (dataType === 'video-file') {\r\n        const width = element.find('.player__svg-stretch').attr('width');\r\n        const mp4 = `${element.attr('data-source')}.mp4`;\r\n        const webm = element.attr('data-webm');\r\n        videoHtml = art(path.join(__dirname, 'templates/video.art'), { preview, width, mp4, webm });\r\n    } else {\r\n        throw new Error(`Unknown video type: ${dataType}`);\r\n    }\r\n    element.replaceWith(videoHtml);\r\n};\r\n\r\nexport { baseUrl, fixImage, fixVideo };\r\n"],"mappings":"gJAGA,MAAM,EAAU,oBAEV,EAAY,GAAY,CAC1B,EAAQ,KAAK,yBAAyB,SACtC,EAAQ,KAAK,uBAAuB,MAAM,EAAG,IAAQ,CAC7C,EAAI,QAAQ,aAAe,EAAI,QAAQ,sBACvC,EAAI,QAAQ,IAAM,EAAI,QAAQ,oBAC9B,OAAO,EAAI,QAAQ,YACnB,OAAO,EAAI,QAAQ,wBAKzB,EAAY,GAAY,CAC1B,IAAM,EAAU,EACX,KAAK,oBACL,KAAK,SACL,MAAM,gBAAgB,GACrB,EAAW,EAAQ,KAAK,aAC1B,EAAY,GAEhB,GAAI,IAAa,QAAS,CACtB,IAAM,EAAU,EAAQ,KAAK,eAAe,MAAM,kBAAkB,GACpE,EAAY,EAAI,EAAA,KAAA,EAAA,gCAA6C,CAAE,oBACxD,IAAa,aAAc,CAClC,IAAM,EAAQ,EAAQ,KAAK,wBAAwB,KAAK,SAClD,EAAM,GAAG,EAAQ,KAAK,eAAe,MACrC,EAAO,EAAQ,KAAK,aAC1B,EAAY,EAAI,EAAA,KAAA,EAAA,gCAA6C,CAAE,UAAS,QAAO,MAAK,cAEpF,MAAU,MAAM,uBAAuB,KAE3C,EAAQ,YAAY"}