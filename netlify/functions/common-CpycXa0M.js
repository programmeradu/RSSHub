import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{got_default as n}from"./got-CdvI2yKX.js";import{timezone as r}from"./timezone-BrNu6iXe.js";import{load as i}from"cheerio";const a=`https://www.cnbeta.com.tw`,o=(e,a,o)=>Promise.all(e.slice(0,a?Number.parseInt(a):60).map(e=>o(e.link,async()=>{let a=await n(e.link),o=i(a.data);return o(`.topic, .article-topic, .article-global`).remove(),e.description=o(`.article-summary`).html()+o(`.article-content`).html(),e.author=o(`header.title div.meta span.source`).text(),e.pubDate??=r(t(o(`.meta span`).first().text(),`YYYY年MM月DD日 HH:mm`),8),e})));async function s(s){let{type:c,id:l}=s.req.param(),u=c?`${a}/${c}/${l}.htm`:a,d=await n(u),f=i(d.data),p=encodeURI(f(`meta[name="csrf-token"]`).attr(`content`)),m=`${a}/home/more?&type=${f(`div[data-type]`).data(`type`)}&page=1&_csrf=${p}&_=${Date.now()}`;d=await n(m);let h=c?d.data.result.list.map(e=>({title:e.title,description:e.hometext,author:e.source.split(`@http`)[0],pubDate:r(t(e.inputtime),8),link:e.url_show.startsWith(`//`)?`https:${e.url_show}`:e.url_show.replace(`http:`,`https:`),category:e.label.name})):d.data.result.map(e=>({title:e.title,link:e.url_show.startsWith(`//`)?`https:${e.url_show}`:e.url_show.replace(`http:`,`https:`),category:e.label.name}));return{title:f(`title`).text(),link:u,item:await o(h,s.req.query(`limit`),e.tryGet)}}export{s as handler};
//# sourceMappingURL=common-CpycXa0M.js.map