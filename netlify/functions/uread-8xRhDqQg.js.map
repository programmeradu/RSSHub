{"version":3,"file":"uread-8xRhDqQg.js","names":["route: Route","got","data","cache","response"],"sources":["../../lib/routes/wechat/uread.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/uread/:userid',\r\n    categories: ['new-media'],\r\n    example: '/wechat/uread/shensing',\r\n    parameters: { userid: '公众号的微信号, 可在 微信-公众号-更多资料 中找到。并不是所有的都支持，能不能用随缘' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '公众号（优读来源）',\r\n    maintainers: ['kt286'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const userid = ctx.req.param('userid');\r\n    const url = `http://119.29.146.143:8080/reading/subscription/account/recent?uid=${userid}`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n    });\r\n    const data = response.data;\r\n\r\n    const ProcessFeed = (data) => {\r\n        const $ = load(data);\r\n        return $('.rich_media_content').html();\r\n    };\r\n\r\n    const items = await Promise.all(\r\n        data.data.map(async (item) => {\r\n            const link = item.url;\r\n\r\n            const cacheIn = await cache.get(link);\r\n            if (cacheIn) {\r\n                return JSON.parse(cacheIn);\r\n            }\r\n\r\n            const response = await got({\r\n                method: 'get',\r\n                url: link,\r\n            });\r\n\r\n            const description = ProcessFeed(response.data);\r\n\r\n            const single = {\r\n                title: item.title,\r\n                description,\r\n                link,\r\n                author: item.official_account,\r\n                pubDate: item.publish_time,\r\n            };\r\n            cache.set(link, JSON.stringify(single));\r\n            return single;\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: `优读 - ${userid}`,\r\n        link: 'https://uread.ai/',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mTAKA,MAAaA,EAAe,CACxB,KAAM,iBACN,WAAY,CAAC,aACb,QAAS,yBACT,WAAY,CAAE,OAAQ,gDACtB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,YACN,YAAa,CAAC,SACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,EAAI,IAAI,MAAM,UACvB,EAAM,sEAAsE,IAC5E,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,QAEE,EAAO,EAAS,KAEhB,EAAe,GAAS,CAC1B,IAAM,EAAI,EAAKC,GACf,OAAO,EAAE,uBAAuB,QAG9B,EAAQ,MAAM,QAAQ,IACxB,EAAK,KAAK,IAAI,KAAO,IAAS,CAC1B,IAAM,EAAO,EAAK,IAEZ,EAAU,MAAMC,EAAM,IAAI,GAChC,GAAI,EACA,OAAO,KAAK,MAAM,GAGtB,IAAMC,EAAW,MAAMH,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAc,EAAYG,EAAS,MAEnC,EAAS,CACX,MAAO,EAAK,MACZ,cACA,OACA,OAAQ,EAAK,iBACb,QAAS,EAAK,cAGlB,OADA,EAAM,IAAI,EAAM,KAAK,UAAU,IACxB,KAIf,MAAO,CACH,MAAO,QAAQ,IACf,KAAM,oBACN,KAAM"}