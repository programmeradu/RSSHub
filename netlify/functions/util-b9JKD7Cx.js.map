{"version":3,"file":"util-b9JKD7Cx.js","names":[],"sources":["../../lib/routes/gov/safe/util.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst rootUrl = 'https://www.safe.gov.cn';\r\n\r\nconst zxfkCategoryApis = {\r\n    // 业务咨询 https://www.safe.gov.cn/<site>/ywzx/index.html\r\n    ywzx: 'www/busines/businessQuery?siteid=',\r\n\r\n    // 投诉建议 https://www.safe.gov.cn/<site>/tsjy/index.html\r\n    tsjy: 'www/complaint/complaintQuery?siteid=',\r\n};\r\n\r\nconst processZxfkItems = async (site = 'beijing', category = 'ywzx', limit = '3') => {\r\n    const apiUrl = new URL(`${zxfkCategoryApis[category]}${site}`, rootUrl).href;\r\n    const currentUrl = new URL(`${site}/${category}/index.html`, rootUrl).href;\r\n\r\n    const { data: response } = await got(apiUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const items = $('#complaint')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const spans = item.find('span[objid]');\r\n\r\n            const message = {\r\n                author: spans.first().text().replace(/:$/, ''),\r\n                content: spans.eq(1).text(),\r\n                date: spans.eq(2).text(),\r\n            };\r\n\r\n            const reply = {\r\n                author: spans.eq(3).text().replace(/:$/, ''),\r\n                content: spans.eq(4).text(),\r\n                date: spans.eq(5).text(),\r\n            };\r\n\r\n            return {\r\n                title: `${message.author}: ${message.content}`,\r\n                link: currentUrl,\r\n                description: art(path.join(__dirname, 'templates/message.art'), {\r\n                    message,\r\n                    reply,\r\n                }),\r\n                author: `${message.author}/${reply.author}`,\r\n                guid: `${currentUrl}#${message.author}(${message.date})/${reply.author}(${reply.date})`,\r\n                pubDate: parseDate(message.date),\r\n                updated: parseDate(reply.date),\r\n            };\r\n        });\r\n\r\n    const { data: currentResponse } = await got(currentUrl);\r\n\r\n    const content = load(currentResponse);\r\n\r\n    const author = content('meta[name=\"ColumnName\"]').prop('content');\r\n    const subtitle = content('meta[name=\"ColumnType\"]').prop('content');\r\n\r\n    const imagePath = 'safe/templateresource/372b1dfdab204181b9b4f943a8e926a6';\r\n    const image = new URL(`${imagePath}/logo_06.png`, rootUrl).href;\r\n    const icon = new URL(`${imagePath}/safe.ico`, rootUrl).href;\r\n\r\n    return {\r\n        item: items,\r\n        title: `${author} - ${subtitle}`,\r\n        link: currentUrl,\r\n        description: content('meta[name=\"ColumnDescription\"]').prop('content'),\r\n        language: 'zh',\r\n        image,\r\n        icon,\r\n        logo: icon,\r\n        subtitle,\r\n        author,\r\n        allowEmpty: true,\r\n    };\r\n};\r\n\r\nexport { processZxfkItems };\r\n"],"mappings":"oRAMA,MAAM,EAAU,0BAEV,EAAmB,CAErB,KAAM,oCAGN,KAAM,wCAGJ,EAAmB,MAAO,EAAO,UAAW,EAAW,OAAQ,EAAQ,MAAQ,CACjF,IAAM,EAAS,IAAI,IAAI,GAAG,EAAiB,KAAY,IAAQ,GAAS,KAClE,EAAa,IAAI,IAAI,GAAG,EAAK,GAAG,EAAS,aAAc,GAAS,KAEhE,CAAE,KAAM,GAAa,MAAM,EAAI,GAE/B,EAAI,EAAK,GAET,EAAQ,EAAE,cACX,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAQ,EAAK,KAAK,eAElB,EAAU,CACZ,OAAQ,EAAM,QAAQ,OAAO,QAAQ,KAAM,IAC3C,QAAS,EAAM,GAAG,GAAG,OACrB,KAAM,EAAM,GAAG,GAAG,QAGhB,EAAQ,CACV,OAAQ,EAAM,GAAG,GAAG,OAAO,QAAQ,KAAM,IACzC,QAAS,EAAM,GAAG,GAAG,OACrB,KAAM,EAAM,GAAG,GAAG,QAGtB,MAAO,CACH,MAAO,GAAG,EAAQ,OAAO,IAAI,EAAQ,UACrC,KAAM,EACN,YAAa,EAAI,EAAA,KAAA,EAAA,kCAA+C,CAC5D,UACA,UAEJ,OAAQ,GAAG,EAAQ,OAAO,GAAG,EAAM,SACnC,KAAM,GAAG,EAAW,GAAG,EAAQ,OAAO,GAAG,EAAQ,KAAK,IAAI,EAAM,OAAO,GAAG,EAAM,KAAK,GACrF,QAAS,EAAU,EAAQ,MAC3B,QAAS,EAAU,EAAM,SAI/B,CAAE,KAAM,GAAoB,MAAM,EAAI,GAEtC,EAAU,EAAK,GAEf,EAAS,EAAQ,2BAA2B,KAAK,WACjD,EAAW,EAAQ,2BAA2B,KAAK,WAEnD,EAAY,yDACZ,EAAQ,IAAI,IAAI,GAAG,EAAU,cAAe,GAAS,KACrD,EAAO,IAAI,IAAI,GAAG,EAAU,WAAY,GAAS,KAEvD,MAAO,CACH,KAAM,EACN,MAAO,GAAG,EAAO,KAAK,IACtB,KAAM,EACN,YAAa,EAAQ,kCAAkC,KAAK,WAC5D,SAAU,KACV,QACA,OACA,KAAM,EACN,WACA,SACA,WAAY"}