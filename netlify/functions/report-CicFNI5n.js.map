{"version":3,"file":"report-CicFNI5n.js","names":["route: Route","ofetch","bodyJsUrl: string | undefined"],"sources":["../../lib/routes/zhizhuan100/report.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport { parseRelativeDate } from '@/utils/parse-date';\r\nimport ofetch from '@/utils/ofetch';\r\nimport * as cheerio from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/analytic',\r\n    categories: ['finance'],\r\n    view: ViewType.Articles,\r\n    example: '/zhizhuan100/analytic',\r\n    radar: [\r\n        {\r\n            source: ['www.zhizhuan100.com.cn/analysis'],\r\n        },\r\n    ],\r\n    name: 'analytic',\r\n    maintainers: ['Cedaric'],\r\n    handler,\r\n};\r\n\r\nasync function handler() {\r\n    const urlData = await ofetch('https://www.zhizhuan100.com.cn/analysis');\r\n\r\n    const $ = cheerio.load(urlData);\r\n\r\n    const bodyJsUrl: string | undefined = $('script[src*=\"Body.js\"]').attr('src');\r\n\r\n    if (!bodyJsUrl) {\r\n        throw new Error('无法找到 Body.js 脚本文件');\r\n    }\r\n\r\n    const responseData = await ofetch(bodyJsUrl, {\r\n        parseResponse: (txt) => txt,\r\n    });\r\n\r\n    const htmlMatch = responseData.match(/document\\.write\\('(.*)'\\);/s);\r\n    if (!htmlMatch) {\r\n        throw new Error('无法找到HTML内容');\r\n    }\r\n\r\n    const htmlContent = JSON.parse(`\"${htmlMatch[1]}\"`);\r\n    const $content = cheerio.load(htmlContent);\r\n\r\n    const listItems = $content('.w-list-item');\r\n\r\n    const items = listItems\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $content(item);\r\n            const titleElement = $item.find('.w-list-title');\r\n            const dateElement = $item.find('.w-list-date');\r\n            const linkElement = $item.find('.w-list-link');\r\n            const imgElement = $item.find('.w-listpic-in');\r\n\r\n            const title = titleElement.text().trim() || '';\r\n            const dateText = dateElement.text().trim() || '';\r\n            const href = linkElement.attr('href') || '';\r\n            const imgSrc = imgElement.attr('src') || '';\r\n\r\n            const idMatch = href.match(/\\/productinfo\\/(\\d+)\\.html/);\r\n            const id = idMatch ? idMatch[1] : '';\r\n\r\n            return {\r\n                title,\r\n                pubDate: parseRelativeDate(dateText),\r\n                link: href.startsWith('http') ? href : `https://www.zhizhuan100.com.cn${href}`,\r\n                description: `<img src=\"${imgSrc.startsWith('//') ? 'https:' + imgSrc : imgSrc}\" alt=\"${title}\">`,\r\n                guid: id,\r\n            };\r\n        })\r\n        .filter((item) => item.title);\r\n\r\n    return {\r\n        title: '智篆商业-消费报告',\r\n        link: 'https://www.zhizhuan100.com.cn/analysis',\r\n        allowEmpty: true,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"iTAKA,MAAaA,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,WACb,KAAM,EAAS,SACf,QAAS,wBACT,MAAO,CACH,CACI,OAAQ,CAAC,qCAGjB,KAAM,WACN,YAAa,CAAC,WACd,WAGJ,eAAe,GAAU,CACrB,IAAM,EAAU,MAAMC,EAAO,2CAEvB,EAAI,EAAQ,KAAK,GAEjBC,EAAgC,EAAE,0BAA0B,KAAK,OAEvE,GAAI,CAAC,EACD,MAAU,MAAM,qBAGpB,IAAM,EAAe,MAAMD,EAAO,EAAW,CACzC,cAAgB,GAAQ,IAGtB,EAAY,EAAa,MAAM,+BACrC,GAAI,CAAC,EACD,MAAU,MAAM,cAGpB,IAAM,EAAc,KAAK,MAAM,IAAI,EAAU,GAAG,IAC1C,EAAW,EAAQ,KAAK,GAExB,EAAY,EAAS,gBAErB,EAAQ,EACT,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAS,GACjB,EAAe,EAAM,KAAK,iBAC1B,EAAc,EAAM,KAAK,gBACzB,EAAc,EAAM,KAAK,gBACzB,EAAa,EAAM,KAAK,iBAExB,EAAQ,EAAa,OAAO,QAAU,GACtC,EAAW,EAAY,OAAO,QAAU,GACxC,EAAO,EAAY,KAAK,SAAW,GACnC,EAAS,EAAW,KAAK,QAAU,GAEnC,EAAU,EAAK,MAAM,8BACrB,EAAK,EAAU,EAAQ,GAAK,GAElC,MAAO,CACH,QACA,QAAS,EAAkB,GAC3B,KAAM,EAAK,WAAW,QAAU,EAAO,iCAAiC,IACxE,YAAa,aAAa,EAAO,WAAW,MAAQ,SAAW,EAAS,EAAO,SAAS,EAAM,IAC9F,KAAM,KAGb,OAAQ,GAAS,EAAK,OAE3B,MAAO,CACH,MAAO,YACP,KAAM,0CACN,WAAY,GACZ,KAAM"}