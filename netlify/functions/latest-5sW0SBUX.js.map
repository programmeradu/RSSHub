{"version":3,"file":"latest-5sW0SBUX.js","names":["route: Route","got","url"],"sources":["../../lib/routes/douban/book/latest.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\n\r\nconst linkUrl = 'https://book.douban.com/latest';\r\nconst baseUrl = 'https://m.douban.com/rexxar/api/v2/subject_collection';\r\nconst params = 'items?start=0&count=10&mode=collection&for_mobile=1';\r\n\r\nexport const route: Route = {\r\n    path: '/book/latest/:type?',\r\n    categories: ['social-media'],\r\n    example: '/douban/book/latest/fiction',\r\n    parameters: { type: '专题分类，可选，默认为 `all`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '新书速递',\r\n    maintainers: ['fengkx', 'lyqluis'],\r\n    description: `| 文学         | 小说    | 历史文化 | 社会纪实  | 科学新知 | 艺术设计 | 商业经管 | 绘本漫画 |\r\n| ------------ | ------- | -------- | --------- | -------- | -------- | -------- | -------- |\r\n| prose_poetry | fiction | history  | biography | science  | art      | business | comics   |`,\r\n    handler,\r\n};\r\n\r\nconst SUBCATS = {\r\n    all: '全部',\r\n    prose_poetry: '文学',\r\n    fiction: '小说',\r\n    history: '历史文化',\r\n    biography: '社会纪实',\r\n    science: '科学新知',\r\n    art: '艺术设计',\r\n    business: '商业经管',\r\n    comics: '绘本漫画',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type') ?? 'all';\r\n    const subUrl = `new_book_${type}`;\r\n    const url = `${baseUrl}/${subUrl}/${params}`;\r\n\r\n    const res = await got.get(url);\r\n    const items = res.data.items;\r\n\r\n    return {\r\n        title: `豆瓣新书速递${type === 'all' ? '' : '-' + SUBCATS[type]}`,\r\n        link: `${linkUrl}${type === 'all' ? '' : '?subcat=' + SUBCATS[type]}`,\r\n        item: items.map(({ title, url, card_subtitle, cards, pic, rating, null_rating_reason }) => {\r\n            const rate = rating.value ? `${rating.value}分` : null_rating_reason;\r\n            const img = `<img src=\"${pic.normal}\">`;\r\n            const info = card_subtitle;\r\n            const description = `${img}<br>${title}<br><br>${info}<br><br>${cards[0]?.content ?? ''}<br><br>${rate}`;\r\n\r\n            return {\r\n                title,\r\n                description,\r\n                link: url,\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"gOAGA,MAIaA,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,gBACb,QAAS,8BACT,WAAY,CAAE,KAAM,qBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,SAAU,WACxB,YAAa;;+FAGb,WAGE,EAAU,CACZ,IAAK,KACL,aAAc,KACd,QAAS,KACT,QAAS,OACT,UAAW,OACX,QAAS,OACT,IAAK,OACL,SAAU,OACV,OAAQ,QAGZ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,MAChC,EAAS,YAAY,IACrB,EAAM,yDAAc,EAAO,sDAE3B,EAAM,MAAMC,EAAI,IAAI,GACpB,EAAQ,EAAI,KAAK,MAEvB,MAAO,CACH,MAAO,SAAS,IAAS,MAAQ,GAAK,IAAM,EAAQ,KACpD,KAAM,iCAAa,IAAS,MAAQ,GAAK,WAAa,EAAQ,KAC9D,KAAM,EAAM,KAAK,CAAE,QAAO,IAAA,EAAK,gBAAe,QAAO,MAAK,SAAQ,wBAAyB,CACvF,IAAM,EAAO,EAAO,MAAQ,GAAG,EAAO,MAAM,GAAK,EAC3C,EAAM,aAAa,EAAI,OAAO,IAC9B,EAAO,EACP,EAAc,GAAG,EAAI,MAAM,EAAM,UAAU,EAAK,UAAU,EAAM,IAAI,SAAW,GAAG,UAAU,IAElG,MAAO,CACH,QACA,cACA,KAAMC"}