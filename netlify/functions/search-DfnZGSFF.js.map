{"version":3,"file":"search-DfnZGSFF.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/telecompaper/search.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/search/:keyword?/:company?/:sort?/:period?',\r\n    categories: ['journal'],\r\n    example: '/telecompaper/search/Nokia',\r\n    parameters: { keyword: 'Keyword', company: 'Company name, empty by default', sort: 'Sorting, see table below, `Date Descending` by default', period: 'Date selection, Last 12 months by default' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Search',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `Sorting\r\n\r\n| Date Ascending | Date Descending |\r\n| -------------- | --------------- |\r\n| 1              | 2               |\r\n\r\n  Date selection\r\n\r\n| 1 month | 3 months | 6 months | 12 months | 24 months |\r\n| ------- | -------- | -------- | --------- | --------- |\r\n| 1       | 3        | 6        | 12        | 24        |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const keyword = ctx.req.param('keyword') || '';\r\n    const company = ctx.req.param('company') || '';\r\n    const sort = ctx.req.param('sort') || '2';\r\n    const period = ctx.req.param('period') || '12';\r\n\r\n    const rootUrl = `https://www.telecompaper.com/search/index.aspx?search=${keyword}`;\r\n\r\n    let response = await got({\r\n            method: 'get',\r\n            url: rootUrl,\r\n        }),\r\n        $ = load(response.data);\r\n\r\n    response = await got({\r\n        method: 'post',\r\n        url: rootUrl,\r\n        data: JSON.stringify({\r\n            __EVENTTARGET: '',\r\n            __EVENTARGUMENT: '',\r\n            __VSTATE: $('#__VSTATE').attr('value'),\r\n            __VIEWSTATE: '',\r\n            ctl00$header$searchText: 'Search keywords',\r\n            ctl00$header$searchTextMobile: 'Search keywords',\r\n            ctl00$MainPlaceHolder$SearchText: keyword,\r\n            ctl00$MainPlaceHolder$CompanyText: company,\r\n            ctl00$MainPlaceHolder$Sort: Number.parseInt(sort),\r\n            ctl00$MainPlaceHolder$Results: 20,\r\n            ctl00$MainPlaceHolder$Date: 'Timeframe1',\r\n            ctl00$MainPlaceHolder$Period: Number.parseInt(period),\r\n            ctl00$MainPlaceHolder$txtStartDate: '',\r\n            ctl00$MainPlaceHolder$txtEndDate: '',\r\n            ctl00$MainPlaceHolder$chkEnglish: 'on',\r\n            ctl00$MainPlaceHolder$Submit: 'Search',\r\n        }),\r\n    });\r\n    $ = load(response.data);\r\n\r\n    const list = $('table.details_rows tbody tr')\r\n        .slice(0, 15)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const a = item.find('a');\r\n            return {\r\n                title: a.text(),\r\n                link: a.attr('href'),\r\n                pubDate: new Date(item.find('span.source').text().split(' | ')[0] + ' GMT+1').toUTCString(),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n                const content = load(detailResponse.data);\r\n\r\n                item.description = content('#pageContainer').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `Telecompaper Search - ${keyword}`,\r\n        link: rootUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mTAKA,MAAaA,EAAe,CACxB,KAAM,8CACN,WAAY,CAAC,WACb,QAAS,6BACT,WAAY,CAAE,QAAS,UAAW,QAAS,iCAAkC,KAAM,yDAA0D,OAAQ,6CACrJ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;;;;;4DAajB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,EAAI,IAAI,MAAM,YAAc,GACtC,EAAU,EAAI,IAAI,MAAM,YAAc,GACtC,EAAO,EAAI,IAAI,MAAM,SAAW,IAChC,EAAS,EAAI,IAAI,MAAM,WAAa,KAEpC,EAAU,yDAAyD,IAErE,EAAW,MAAMC,EAAI,CACjB,OAAQ,MACR,IAAK,IAET,EAAI,EAAK,EAAS,MAEtB,EAAW,MAAMA,EAAI,CACjB,OAAQ,OACR,IAAK,EACL,KAAM,KAAK,UAAU,CACjB,cAAe,GACf,gBAAiB,GACjB,SAAU,EAAE,aAAa,KAAK,SAC9B,YAAa,GACb,wBAAyB,kBACzB,8BAA+B,kBAC/B,iCAAkC,EAClC,kCAAmC,EACnC,2BAA4B,OAAO,SAAS,GAC5C,8BAA+B,GAC/B,2BAA4B,aAC5B,6BAA8B,OAAO,SAAS,GAC9C,mCAAoC,GACpC,iCAAkC,GAClC,iCAAkC,KAClC,6BAA8B,aAGtC,EAAI,EAAK,EAAS,MAElB,IAAM,EAAO,EAAE,+BACV,MAAM,EAAG,IACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAI,EAAK,KAAK,KACpB,MAAO,CACH,MAAO,EAAE,OACT,KAAM,EAAE,KAAK,QACb,QAAS,IAAI,KAAK,EAAK,KAAK,eAAe,OAAO,MAAM,OAAO,GAAK,UAAU,iBAIpF,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAER,EAAU,EAAK,EAAe,MAIpC,MAFA,GAAK,YAAc,EAAQ,kBAAkB,OAEtC,MAKnB,MAAO,CACH,MAAO,yBAAyB,IAChC,KAAM,EACN,KAAM"}