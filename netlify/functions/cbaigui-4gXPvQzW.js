import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{art as n}from"./render-CxhTJIsl.js";import{parseDate as r}from"./parse-date-Bgabdhlb.js";import{getSubPath as i}from"./common-utils-CvkwbCD5.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import o from"node:path";import{load as s}from"cheerio";t();const c=`https://cbaigui.com`,l=`wp-json/wp/v2`,u=async(e,t)=>{let n=new URL(`${l}/${e}?search=${t}`,c).href,{data:r}=await a(n);return r.findLast(e=>e.name===t)?.id??void 0},d={path:`*`,name:`Unknown`,maintainers:[],handler:f};async function f(t){let d=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):50,f,p=new URL(i(t).replace(/^\/cbaigui/,``),c).href,m=new URL(`${l}/posts?_embed=true&per_page=${d}`,c).href,h=i(t).match(/^\/post-(tag|category)\/(.*)$/);if(h){f=decodeURI(h[2].split(`/`).pop());let e=h[1]===`tag`?`tags`:`categories`,t=await u(e,f);t&&(m=new URL(`${l}/posts?_embed=true&per_page=${d}&${e}=${t}`,c).href)}let{data:g}=await a(m),_=g.slice(0,d).map(t=>{let i=t._embedded[`wp:term`],a=s(t.content?.rendered??t.content);return a(`figure`).each(function(){let t=a(this).find(`img`),r=t.prop(`data-actualsrc`)??t.prop(`data-original`),i=t.prop(`data-rawwidth`),s=t.prop(`data-rawheight`);a(this).replaceWith(n(o.join(e,`templates/figure-954623e8.art`),{src:r,width:i,height:s}))}),a(`p img`).each(function(){let t=a(this),r=t.prop(`src`).split(`!`)[0],i=t.prop(`width`),s=t.prop(`height`);a(this).replaceWith(n(o.join(e,`templates/figure-954623e8.art`),{src:r,width:i,height:s}))}),{title:t.title?.rendered??t.title,link:t.link,description:a.html(),author:t._embedded.author.map(e=>e.name).join(`/`),category:[...i[0],...i[1]].map(e=>e.name),guid:t.guid?.rendered??t.guid,pubDate:r(t.date_gmt),updated:r(t.modified_gmt)}}),{data:v}=await a(p),y=s(v),b=y(`link[rel="apple-touch-icon"]`).first().prop(`href`);return{item:_,title:`纪妖${f?` - ${f}`:``}`,link:p,description:y(`meta[name="description"]`).prop(`content`),language:`zh-cn`,image:y(`meta[name="msapplication-TileImage"]`).prop(`content`),icon:b,logo:b,subtitle:y(`p.site-description`).text(),author:y(`p.site-title`).text()}}export{d as route};
//# sourceMappingURL=cbaigui-4gXPvQzW.js.map