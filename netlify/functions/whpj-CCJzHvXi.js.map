{"version":3,"file":"whpj-CCJzHvXi.js","names":["route: Route","got"],"sources":["../../lib/routes/icbc/whpj.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/whpj/:format?',\r\n    categories: ['other'],\r\n    example: '/icbc/whpj/zs?filter_title=%E8%8B%B1%E9%95%91',\r\n    parameters: { format: '输出的标题格式，默认为标题 + 所有价格。短格式仅包含货币名称。' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['icbc.com.cn/column/1438058341489590354.html'],\r\n            target: '/whpj',\r\n        },\r\n    ],\r\n    name: '外汇牌价',\r\n    maintainers: ['leoleoasd'],\r\n    handler,\r\n    url: 'icbc.com.cn/column/1438058341489590354.html',\r\n    description: `| 短格式 | 参考价 | 现汇买卖 | 现钞买卖 | 现汇买入 | 现汇卖出 | 现钞买入 | 现钞卖出 |\r\n| ------ | ------ | -------- | -------- | -------- | -------- | -------- | -------- |\r\n| short  | zs     | xh       | xc       | xhmr     | xhmc     | xcmr     | xcmc     |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    // yes, insecure\r\n    // their openssl version isn't safe anyway (https://stackoverflow.com/questions/75763525/curl-35-error0a000152ssl-routinesunsafe-legacy-renegotiation-disabled)\r\n    const { data } = await got('http://papi.icbc.com.cn/exchanges/ns/getLatest');\r\n    const format = ctx.req.param('format');\r\n\r\n    return {\r\n        title: '中国工商银行外汇牌价',\r\n        link: 'https://www.icbc.com.cn/column/1438058341489590354.html',\r\n        item: data.data.map((item) => {\r\n            const name = `${item.currencyCHName} ${item.currencyENName}`;\r\n\r\n            const xhmr = `现汇买入价：${item.foreignBuy}`;\r\n\r\n            const xcmr = `现钞买入价：${item.cashBuy}`;\r\n\r\n            const xhmc = `现汇卖出价：${item.foreignSell}`;\r\n\r\n            const xcmc = `现钞卖出价：${item.cashSell}`;\r\n\r\n            const zs = `参考价：${item.reference}`;\r\n\r\n            const content = `${xhmr} ${xcmr} ${xhmc} ${xcmc} ${zs}`;\r\n\r\n            const formatTitle = () => {\r\n                switch (format) {\r\n                    case 'short':\r\n                        return name;\r\n                    case 'xh':\r\n                        return `${name} ${xhmr} ${xhmc}`;\r\n                    case 'xc':\r\n                        return `${name} ${xcmr} ${xcmc}`;\r\n                    case 'zs':\r\n                        return `${name} ${zs}`;\r\n                    case 'xhmr':\r\n                        return `${name} ${xhmr}`;\r\n                    case 'xhmc':\r\n                        return `${name} ${xhmc}`;\r\n                    case 'xcmr':\r\n                        return `${name} ${xcmr}`;\r\n                    case 'xcmc':\r\n                        return `${name} ${xcmc}`;\r\n                    default:\r\n                        return `${name} ${content}`;\r\n                }\r\n            };\r\n            return {\r\n                title: formatTitle(),\r\n                pubDate: new Date(`${item.publishDate} ${item.publishTime}`),\r\n                description: content.replaceAll(/\\s/g, '<br>'),\r\n                guid: `${name} ${item.publishDate} ${item.publishTime}`,\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"gOAGA,MAAaA,EAAe,CACxB,KAAM,iBACN,WAAY,CAAC,SACb,QAAS,gDACT,WAAY,CAAE,OAAQ,oCACtB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,+CACT,OAAQ,UAGhB,KAAM,OACN,YAAa,CAAC,aACd,UACA,IAAK,8CACL,YAAa;;wFAKjB,eAAe,EAAQ,EAAK,CAGxB,GAAM,CAAE,QAAS,MAAMC,EAAI,kDACrB,EAAS,EAAI,IAAI,MAAM,UAE7B,MAAO,CACH,MAAO,aACP,KAAM,0DACN,KAAM,EAAK,KAAK,IAAK,GAAS,CAC1B,IAAM,EAAO,GAAG,EAAK,eAAe,GAAG,EAAK,iBAEtC,EAAO,SAAS,EAAK,aAErB,EAAO,SAAS,EAAK,UAErB,EAAO,SAAS,EAAK,cAErB,EAAO,SAAS,EAAK,WAErB,EAAK,OAAO,EAAK,YAEjB,EAAU,GAAG,EAAK,GAAG,EAAK,GAAG,EAAK,GAAG,EAAK,GAAG,IAE7C,MAAoB,CACtB,OAAQ,EAAR,CACI,IAAK,QACD,OAAO,EACX,IAAK,KACD,MAAO,GAAG,EAAK,GAAG,EAAK,GAAG,IAC9B,IAAK,KACD,MAAO,GAAG,EAAK,GAAG,EAAK,GAAG,IAC9B,IAAK,KACD,MAAO,GAAG,EAAK,GAAG,IACtB,IAAK,OACD,MAAO,GAAG,EAAK,GAAG,IACtB,IAAK,OACD,MAAO,GAAG,EAAK,GAAG,IACtB,IAAK,OACD,MAAO,GAAG,EAAK,GAAG,IACtB,IAAK,OACD,MAAO,GAAG,EAAK,GAAG,IACtB,QACI,MAAO,GAAG,EAAK,GAAG,MAG9B,MAAO,CACH,MAAO,IACP,QAAS,IAAI,KAAK,GAAG,EAAK,YAAY,GAAG,EAAK,eAC9C,YAAa,EAAQ,WAAW,MAAO,QACvC,KAAM,GAAG,EAAK,GAAG,EAAK,YAAY,GAAG,EAAK"}