{"version":3,"file":"category-CvDmXBkh.js","names":[],"sources":["../../lib/routes/vimeo/category.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/category/:category/:staffpicks?',\r\n    categories: ['social-media'],\r\n    view: ViewType.Videos,\r\n    example: '/vimeo/category/documentary/staffpicks',\r\n    parameters: {\r\n        category: 'Category name can get from url like `documentary` in [https://vimeo.com/categories/documentary/videos](https://vimeo.com/categories/documentary/videos) ',\r\n        staffpicks: 'type `staffpicks` to sort with staffpicks',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Category',\r\n    maintainers: ['MisteryMonster'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category, staffpicks } = ctx.req.param();\r\n\r\n    const categoryparams = category;\r\n    let sortparams = '&direction=desc&sort=date';\r\n    let feedtitle = category;\r\n    if (staffpicks && staffpicks !== 'staffpicks') {\r\n        return;\r\n    }\r\n\r\n    if (staffpicks) {\r\n        sortparams += '&filter=conditional_featured';\r\n        feedtitle += `: ${category} staffpicks`;\r\n    }\r\n\r\n    const url = `https://api.vimeo.com/categories/${categoryparams}/videos?page=1&per_page=18${sortparams}`;\r\n    const tokenresponse = await got({\r\n        method: 'get',\r\n        url: 'https://vimeo.com/_rv/viewer',\r\n    });\r\n    const VimeoAuthorization = tokenresponse.data.jwt;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n        headers: {\r\n            Authorization: `jwt ${VimeoAuthorization}`,\r\n        },\r\n    });\r\n\r\n    const vimeojs = response.data.data;\r\n\r\n    const feedlink = `https://vimeo.com/categories/${category}/videos/sort:latest`;\r\n    const feedlinkstaffpicks = '?staffpicked=true';\r\n    const feedDescription = await cache.tryGet(feedlink + (staffpicks ? feedlinkstaffpicks : ''), async () => {\r\n        const response = await got({\r\n            url: feedlink + (staffpicks ? feedlinkstaffpicks : ''),\r\n        });\r\n        const description = load(response.data);\r\n        return description('meta[name=\"description\"]').attr('content');\r\n    });\r\n\r\n    return {\r\n        title: `${feedtitle} | Vimeo category`,\r\n        link: feedlink + (staffpicks ? feedlinkstaffpicks : ''),\r\n        description: feedDescription,\r\n        item: vimeojs.map((item) => ({\r\n            title: item.name,\r\n            description: art(path.join(__dirname, 'templates/description.art'), {\r\n                videoUrl: item.uri.replace(`/videos`, ''),\r\n                vdescription: item.description || '',\r\n            }),\r\n            pubDate: parseDate(item.created_time),\r\n            link: item.link,\r\n            author: item.user.name,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"ugBASA,MAAa,EAAe,CACxB,KAAM,mCACN,WAAY,CAAC,gBACb,KAAM,EAAS,OACf,QAAS,yCACT,WAAY,CACR,SAAU,2JACV,WAAY,6CAEhB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,WACN,YAAa,CAAC,kBACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAU,cAAe,EAAI,IAAI,QAEnC,EAAiB,EACnB,EAAa,4BACb,EAAY,EAChB,GAAI,GAAc,IAAe,aAC7B,OAGA,IACA,GAAc,+BACd,GAAa,KAAK,EAAS,cAG/B,IAAM,EAAM,oCAAoC,EAAe,4BAA4B,IACrF,EAAgB,MAAM,EAAI,CAC5B,OAAQ,MACR,IAAK,iCAEH,EAAqB,EAAc,KAAK,IAExC,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,MACA,QAAS,CACL,cAAe,OAAO,OAIxB,EAAU,EAAS,KAAK,KAExB,EAAW,gCAAgC,EAAS,qBACpD,EAAqB,oBACrB,EAAkB,MAAM,EAAM,OAAO,GAAY,EAAa,EAAqB,IAAK,SAAY,CACtG,IAAM,EAAW,MAAM,EAAI,CACvB,IAAK,GAAY,EAAa,EAAqB,MAEjD,EAAc,EAAK,EAAS,MAClC,OAAO,EAAY,4BAA4B,KAAK,aAGxD,MAAO,CACH,MAAO,GAAG,EAAU,mBACpB,KAAM,GAAY,EAAa,EAAqB,IACpD,YAAa,EACb,KAAM,EAAQ,IAAK,IAAU,CACzB,MAAO,EAAK,KACZ,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,SAAU,EAAK,IAAI,QAAQ,UAAW,IACtC,aAAc,EAAK,aAAe,KAEtC,QAAS,EAAU,EAAK,cACxB,KAAM,EAAK,KACX,OAAQ,EAAK,KAAK"}