{"version":3,"file":"weekly-DWTMVglb.js","names":["route: Route","got","cache","$"],"sources":["../../lib/routes/caixin/weekly.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/weekly',\r\n    categories: ['traditional-media'],\r\n    example: '/caixin/weekly',\r\n    radar: [\r\n        {\r\n            source: ['weekly.caixin.com/', 'weekly.caixin.com/*'],\r\n        },\r\n    ],\r\n    name: '财新周刊',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'weekly.caixin.com/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const link = 'https://weekly.caixin.com';\r\n\r\n    const { data: response } = await got(link);\r\n    const $ = load(response);\r\n\r\n    const list = [\r\n        ...$('.mi')\r\n            .toArray()\r\n            .map((item) => ({\r\n                link: $(item).find('a').attr('href')?.replace('http:', 'https:'),\r\n            })),\r\n        ...$('.xsjCon a')\r\n            .toArray()\r\n            .map((item) => ({\r\n                link: $(item).attr('href'),\r\n            })),\r\n    ].slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 10) as DataItem[];\r\n\r\n    const items = (await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data } = await got(item.link);\r\n                const $ = load(data);\r\n\r\n                item.title = $('head title')\r\n                    .text()\r\n                    .replace(/_财新周刊频道_财新网$/, '')\r\n                    .trim();\r\n                item.pubDate = parseDate(\r\n                    $('.source')\r\n                        .text()\r\n                        .match(/出版日期：(\\d{4}-\\d{2}-\\d{2})/)[1]\r\n                );\r\n\r\n                $('.subscribe').remove();\r\n\r\n                const report = $('.report');\r\n                report.find('.title, .source, .date').remove();\r\n\r\n                item.description = $('.cover').html() + report.html() + $('.magIntro2').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    )) as DataItem[];\r\n\r\n    return {\r\n        title: $('head title')\r\n            .text()\r\n            .replace(/_财新周刊频道_财新网$/, '')\r\n            .trim(),\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,UACN,WAAY,CAAC,qBACb,QAAS,iBACT,MAAO,CACH,CACI,OAAQ,CAAC,qBAAsB,yBAGvC,KAAM,OACN,YAAa,CAAC,UACd,UACA,IAAK,sBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,4BAEP,CAAE,KAAM,GAAa,MAAMC,EAAI,GAC/B,EAAI,EAAK,GAET,EAAO,CACT,GAAG,EAAE,OACA,UACA,IAAK,IAAU,CACZ,KAAM,EAAE,GAAM,KAAK,KAAK,KAAK,SAAS,QAAQ,QAAS,aAE/D,GAAG,EAAE,aACA,UACA,IAAK,IAAU,CACZ,KAAM,EAAE,GAAM,KAAK,YAE7B,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,IAE5E,EAAS,MAAM,QAAQ,IACzB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,QAAS,MAAMD,EAAI,EAAK,MAC1BE,EAAI,EAAK,GAEf,EAAK,MAAQA,EAAE,cACV,OACA,QAAQ,eAAgB,IACxB,OACL,EAAK,QAAU,EACXA,EAAE,WACG,OACA,MAAM,4BAA4B,IAG3C,EAAE,cAAc,SAEhB,IAAM,EAASA,EAAE,WAKjB,OAJA,EAAO,KAAK,0BAA0B,SAEtC,EAAK,YAAcA,EAAE,UAAU,OAAS,EAAO,OAASA,EAAE,cAAc,OAEjE,MAKnB,MAAO,CACH,MAAO,EAAE,cACJ,OACA,QAAQ,eAAgB,IACxB,OACL,OACA,KAAM"}