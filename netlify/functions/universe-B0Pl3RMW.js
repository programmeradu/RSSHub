import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{parseDate as e}from"./parse-date-Bgabdhlb.js";import{ofetch_default as t}from"./ofetch-Bzt0BXUH.js";import{load as n}from"cheerio";import r from"markdown-it";import i from"node:vm";const a=`https://raw.githubusercontent.com`,o=`${a}/typst/packages/main/packages/preview`;function s(e,t){if(e.includes(`://`))e.startsWith(`https://typst.app/universe/package`)?e=e.replaceAll(`https://typst.app/universe/package`,`${o}/${t.name}/${t.version}`):e.startsWith(`https://github.com/`)&&e.match(/\.(jpeg|jpg|gif|png|bmp|webp)$/gi)?.length&&(e=e.replace(`https://github.com/`,`${a}/`));else{let n=e.startsWith(`/`)?``:`/`,r=`${o}/${t.name}/${t.version}${n}`,i=new URL(e,r);e=i.toString()}return e}const c={path:`/universe`,categories:[`program-update`],example:`/typst/universe`,radar:[{source:[`typst.app/universe`],target:`/universe`}],name:`Universe`,maintainers:[`HPDell`],handler:async()=>{let a=`https://typst.app/universe/search?kind=packages%2Ctemplates&packages=last-updated`,o=await t(a),c=n(o),l=c(`script`).toArray().map(e=>e.attribs.src).find(e=>e&&e.startsWith(`/scripts/universe-search`)),u=await t(`https://typst.app${l}`,{parseResponse:e=>e}),d=u.match(/(an.exports=[\S\s]+);var ([$A-Z_a-z][\w$]*)=new Intl.Collator/)?.[1];if(d){d=d.slice(0,-2);let t={an:{exports:[]}};i.createContext(t),i.runInContext(d,t,{displayErrors:!0});let o=r(`commonmark`),c=t.an.exports.sort((e,t)=>e.updatedAt-t.updatedAt),l=new Map(c.map(e=>[e.name,e])),u=[...l.values()].map(t=>{let r=n(o.render(t.readme));return r(`img`).each((e,n)=>{let r=n.attribs.src;n.attribs.src=s(r,t)}),{title:`${t.name} (${t.version}) | ${t.description}`,link:`https://typst.app/universe/package/${t.name}`,description:r.html(),pubDate:e(t.updatedAt,`X`)}});return{title:`Typst universe`,link:a,item:u}}else return{title:`Typst universe`,link:a,item:[]}}};export{c as route};
//# sourceMappingURL=universe-B0Pl3RMW.js.map