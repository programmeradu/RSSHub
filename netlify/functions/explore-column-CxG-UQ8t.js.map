{"version":3,"file":"explore-column-CxG-UQ8t.js","names":["route: Route","got","title","response","$"],"sources":["../../lib/routes/douban/other/explore-column.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport * as url from 'node:url';\r\n\r\nconst host = 'https://www.douban.com/explore/column/';\r\nexport const route: Route = {\r\n    path: '/explore/column/:id',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const link = url.resolve(host, id);\r\n    const response = await got.get(link);\r\n    const $ = load(response.data);\r\n    const title = $('div.h1').text();\r\n\r\n    const list = $('div.item')\r\n        .slice(0, 10)\r\n        .toArray()\r\n        .map((item) => {\r\n            const info = {\r\n                title: $(item).find('div.title a').text(),\r\n                link: $(item).find('div.title a').attr('href'),\r\n                author: $(item).find('div.usr-pic a').text(),\r\n            };\r\n            return info;\r\n        });\r\n\r\n    for (let i = list.length - 1; i >= 0; i--) {\r\n        if (list[i].author === '[已注销]') {\r\n            list.splice(i, 1);\r\n        }\r\n    }\r\n\r\n    const out = await Promise.all(\r\n        list.map(async (info) => {\r\n            const title = info.title;\r\n            const author = info.author;\r\n            const itemUrl = info.link;\r\n\r\n            const response = await got.get(itemUrl);\r\n            const $ = load(response.data);\r\n            const description = $('#link-report').html();\r\n\r\n            const single = {\r\n                title,\r\n                link: itemUrl,\r\n                description,\r\n                author,\r\n            };\r\n            return single;\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: `${title}-豆瓣发现`,\r\n        link,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"0RAKA,MACaA,EAAe,CACxB,KAAM,sBACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAO,EAAI,QAAQ,yCAAM,GACzB,EAAW,MAAMC,EAAI,IAAI,GACzB,EAAI,EAAK,EAAS,MAClB,EAAQ,EAAE,UAAU,OAEpB,EAAO,EAAE,YACV,MAAM,EAAG,IACT,UACA,IAAK,GAAS,CACX,IAAM,EAAO,CACT,MAAO,EAAE,GAAM,KAAK,eAAe,OACnC,KAAM,EAAE,GAAM,KAAK,eAAe,KAAK,QACvC,OAAQ,EAAE,GAAM,KAAK,iBAAiB,QAE1C,OAAO,IAGf,IAAK,IAAI,EAAI,EAAK,OAAS,EAAG,GAAK,EAAG,IAC9B,EAAK,GAAG,SAAW,SACnB,EAAK,OAAO,EAAG,GAIvB,IAAM,EAAM,MAAM,QAAQ,IACtB,EAAK,IAAI,KAAO,IAAS,CACrB,IAAMC,EAAQ,EAAK,MACb,EAAS,EAAK,OACd,EAAU,EAAK,KAEfC,EAAW,MAAMF,EAAI,IAAI,GACzBG,EAAI,EAAKD,EAAS,MAClB,EAAcC,EAAE,gBAAgB,OAEhC,EAAS,CACX,MAAA,EACA,KAAM,EACN,cACA,UAEJ,OAAO,KAIf,MAAO,CACH,MAAO,GAAG,EAAM,OAChB,OACA,KAAM"}