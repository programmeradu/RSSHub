{"version":3,"file":"en-BwXda52D.js","names":["route: Route","ofetch","cache","r","$","res: any"],"sources":["../../lib/routes/shisu/en.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst url = 'http://en.shisu.edu.cn';\r\nconst urlBackup = 'https://en.shisu.edu.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/en/:section',\r\n    categories: ['university'],\r\n    example: '/shisu/en/news',\r\n    parameters: { section: 'The name of resources' },\r\n    radar: [\r\n        {\r\n            source: ['en.shisu.edu.cn/resources/:section/'],\r\n            target: '/en/:section',\r\n        },\r\n    ],\r\n    name: 'SISU TODAY | FEATURED STORIES',\r\n    maintainers: ['Duuckjing'],\r\n    handler,\r\n    description: `- features: Read a series of in-depth stories about SISU faculty, students, alumni and beyond campus.\r\n  - news: SISU TODAY English site.`,\r\n};\r\n\r\nasync function process(baseUrl: string, section: any) {\r\n    const r = await ofetch(`${baseUrl}/resources/${section}/`);\r\n    const $ = load(r);\r\n    const itemsoup = $('.tab-con:nth-child(1) ul li')\r\n        .toArray()\r\n        .map((i0) => {\r\n            const i = $(i0);\r\n            const img = i.find('img').attr('src');\r\n            const link = `${baseUrl}${i.find('h3>a').attr('href')}`;\r\n            return {\r\n                title: i.find('h3>a').text().trim(),\r\n                link,\r\n                pubDate: parseDate(i.find('p.time').text()),\r\n                itunes_item_image: `${baseUrl}${img}`,\r\n            };\r\n        });\r\n    const items = await Promise.all(\r\n        itemsoup.map((j) =>\r\n            cache.tryGet(j.link, async () => {\r\n                const r = await ofetch(j.link);\r\n                const $ = load(r);\r\n                j.description = $('.details-con')\r\n                    .html()!\r\n                    .replaceAll(/<o:p>[\\S\\s]*?<\\/o:p>/g, '')\r\n                    .replaceAll(/(<p[^>]*>&nbsp;<\\/p>\\s*)+/gm, '<p>&nbsp;</p>');\r\n                return j;\r\n            })\r\n        )\r\n    );\r\n    return {\r\n        title: String(section) === 'features' ? 'FEATURED STORIES' : 'SISU TODAY',\r\n        link: `${url}/resources/${section}/`,\r\n        item: items,\r\n    };\r\n}\r\n\r\nasync function handler(ctx) {\r\n    const { section } = ctx.req.param();\r\n    let res: any;\r\n    try {\r\n        await ofetch(url);\r\n        res = process(url, section);\r\n    } catch {\r\n        await ofetch(urlBackup);\r\n        res = process(urlBackup, section);\r\n    }\r\n    return res;\r\n}\r\n"],"mappings":"mTAMA,MAAM,EAAM,yBACN,EAAY,0BAELA,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,cACb,QAAS,iBACT,WAAY,CAAE,QAAS,yBACvB,MAAO,CACH,CACI,OAAQ,CAAC,uCACT,OAAQ,iBAGhB,KAAM,gCACN,YAAa,CAAC,aACd,UACA,YAAa;qCAIjB,eAAe,EAAQ,EAAiB,EAAc,CAClD,IAAM,EAAI,MAAMC,EAAO,GAAG,EAAQ,aAAa,EAAQ,IACjD,EAAI,EAAK,GACT,EAAW,EAAE,+BACd,UACA,IAAK,GAAO,CACT,IAAM,EAAI,EAAE,GACN,EAAM,EAAE,KAAK,OAAO,KAAK,OACzB,EAAO,GAAG,IAAU,EAAE,KAAK,QAAQ,KAAK,UAC9C,MAAO,CACH,MAAO,EAAE,KAAK,QAAQ,OAAO,OAC7B,OACA,QAAS,EAAU,EAAE,KAAK,UAAU,QACpC,kBAAmB,GAAG,IAAU,OAGtC,EAAQ,MAAM,QAAQ,IACxB,EAAS,IAAK,GACVC,EAAM,OAAO,EAAE,KAAM,SAAY,CAC7B,IAAMC,EAAI,MAAMF,EAAO,EAAE,MACnBG,EAAI,EAAKD,GAKf,MAJA,GAAE,YAAcC,EAAE,gBACb,OACA,WAAW,wBAAyB,IACpC,WAAW,8BAA+B,iBACxC,MAInB,MAAO,CACH,MAAO,OAAO,KAAa,WAAa,mBAAqB,aAC7D,KAAM,GAAG,EAAI,aAAa,EAAQ,GAClC,KAAM,GAId,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAY,EAAI,IAAI,QACxBC,EACJ,GAAI,CACA,MAAMJ,EAAO,GACb,EAAM,EAAQ,EAAK,QACf,CACJ,MAAMA,EAAO,GACb,EAAM,EAAQ,EAAW,GAE7B,OAAO"}