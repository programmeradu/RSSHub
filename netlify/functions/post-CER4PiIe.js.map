{"version":3,"file":"post-CER4PiIe.js","names":["route: Route","got"],"sources":["../../lib/routes/yande/post.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport got from '@/utils/got';\r\nimport queryString from 'query-string';\r\n\r\nexport const route: Route = {\r\n    path: '/post/popular_recent/:period?',\r\n    categories: ['picture'],\r\n    view: ViewType.Pictures,\r\n    example: '/yande/post/popular_recent/1d',\r\n    parameters: {\r\n        period: {\r\n            description: '展示时间',\r\n            options: [\r\n                { value: '1d', label: '最近 24 小时' },\r\n                { value: '1w', label: '最近一周' },\r\n                { value: '1m', label: '最近一月' },\r\n                { value: '1y', label: '最近一年' },\r\n            ],\r\n            default: '1d',\r\n        },\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['yande.re/post'],\r\n        },\r\n    ],\r\n    name: 'Popular Recent Posts',\r\n    maintainers: ['magic-akari', 'SettingDust', 'fashioncj', 'NekoAria'],\r\n    description: `| 最近 24 小时    | 最近一周     | 最近一月    | 最近一年     |\r\n| ------- | -------- | ------- | -------- |\r\n| 1d | 1w | 1m | 1y |`,\r\n    handler,\r\n    features: {\r\n        nsfw: true,\r\n    },\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { period = '1d' } = ctx.req.param();\r\n\r\n    const response = await got({\r\n        url: 'https://yande.re/post/popular_recent.json',\r\n        searchParams: queryString.stringify({\r\n            period,\r\n        }),\r\n    });\r\n\r\n    const posts = response.data;\r\n\r\n    const titles = {\r\n        '1d': 'Last 24 hours',\r\n        '1w': 'Last week',\r\n        '1m': 'Last month',\r\n        '1y': 'Last year',\r\n    };\r\n\r\n    const mime = {\r\n        jpg: 'jpeg',\r\n        png: 'png',\r\n    };\r\n\r\n    const title = titles[period];\r\n\r\n    return {\r\n        title: `${title} - yande.re`,\r\n        link: `https://yande.re/post/popular_recent?period=${period}`,\r\n        item: posts.map((post) => ({\r\n            title: post.tags,\r\n            id: `${ctx.path}#${post.id}`,\r\n            guid: `${ctx.path}#${post.id}`,\r\n            link: `https://yande.re/post/show/${post.id}`,\r\n            author: post.author,\r\n            pubDate: new Date(post.created_at * 1e3).toUTCString(),\r\n            description: (() => {\r\n                const result = [`<img src=\"${post.sample_url}\" />`];\r\n                result.push(`<p>Rating:${post.rating}</p> <p>Score:${post.score}</p>`);\r\n                if (post.source) {\r\n                    result.push(`<a href=\"${post.source}\">Source</a>`);\r\n                }\r\n                if (post.parent_id) {\r\n                    result.push(`<a href=\"https://yande.re/post/show/${post.parent_id}\">Parent</a>`);\r\n                }\r\n                return result.join('');\r\n            })(),\r\n            media: {\r\n                content: {\r\n                    url: post.file_url,\r\n                    type: `image/${mime[post.file_ext]}`,\r\n                },\r\n                thumbnail: {\r\n                    url: post.preview_url,\r\n                },\r\n            },\r\n            category: post.tags.split(/\\s+/),\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"2SAIA,MAAaA,EAAe,CACxB,KAAM,gCACN,WAAY,CAAC,WACb,KAAM,EAAS,SACf,QAAS,gCACT,WAAY,CACR,OAAQ,CACJ,YAAa,OACb,QAAS,CACL,CAAE,MAAO,KAAM,MAAO,YACtB,CAAE,MAAO,KAAM,MAAO,QACtB,CAAE,MAAO,KAAM,MAAO,QACtB,CAAE,MAAO,KAAM,MAAO,SAE1B,QAAS,OAGjB,MAAO,CACH,CACI,OAAQ,CAAC,mBAGjB,KAAM,uBACN,YAAa,CAAC,cAAe,cAAe,YAAa,YACzD,YAAa;;uBAGb,UACA,SAAU,CACN,KAAM,KAId,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,SAAS,MAAS,EAAI,IAAI,QAE5B,EAAW,MAAMC,EAAI,CACvB,IAAK,4CACL,aAAc,EAAY,UAAU,CAChC,aAIF,EAAQ,EAAS,KAEjB,EAAS,CACX,KAAM,gBACN,KAAM,YACN,KAAM,aACN,KAAM,aAGJ,EAAO,CACT,IAAK,OACL,IAAK,OAGH,EAAQ,EAAO,GAErB,MAAO,CACH,MAAO,GAAG,EAAM,aAChB,KAAM,+CAA+C,IACrD,KAAM,EAAM,IAAK,IAAU,CACvB,MAAO,EAAK,KACZ,GAAI,GAAG,EAAI,KAAK,GAAG,EAAK,KACxB,KAAM,GAAG,EAAI,KAAK,GAAG,EAAK,KAC1B,KAAM,8BAA8B,EAAK,KACzC,OAAQ,EAAK,OACb,QAAS,IAAI,KAAK,EAAK,WAAa,KAAK,cACzC,iBAAoB,CAChB,IAAM,EAAS,CAAC,aAAa,EAAK,WAAW,OAQ7C,OAPA,EAAO,KAAK,aAAa,EAAK,OAAO,gBAAgB,EAAK,MAAM,OAC5D,EAAK,QACL,EAAO,KAAK,YAAY,EAAK,OAAO,eAEpC,EAAK,WACL,EAAO,KAAK,uCAAuC,EAAK,UAAU,eAE/D,EAAO,KAAK,QAEvB,MAAO,CACH,QAAS,CACL,IAAK,EAAK,SACV,KAAM,SAAS,EAAK,EAAK,aAE7B,UAAW,CACP,IAAK,EAAK,cAGlB,SAAU,EAAK,KAAK,MAAM"}