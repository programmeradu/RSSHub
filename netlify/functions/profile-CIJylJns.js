import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{config as n}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./proxy-D7ccvALx.js";import"./dist-IvUHtNe1.js";import{cache_default as r}from"./cache-kimkMTWJ.js";import{art as i}from"./render-CxhTJIsl.js";import{ofetch_default as a}from"./ofetch-Bzt0BXUH.js";import{not_found_default as o}from"./not-found-CRS5K6wf.js";import{getPuppeteerPage as s}from"./puppeteer-f0D6AISB.js";import c from"node:path";import{load as l}from"cheerio";t();const u={path:`/profile/:id/:type?/:functionalFlag?`,categories:[`social-media`],example:`/picuki/profile/linustech`,parameters:{id:`Tiktok user id (without @)`,type:{description:`Type of profile page`,options:[{value:`profile`,label:`Profile Page`},{value:`story`,label:`Story Page`}],default:`profile`},functionalFlag:{description:`Functional flag for video embedding`,options:[{value:`0`,label:`Off, only show video poster as an image`},{value:`1`,label:`On`}],default:`1`}},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.picuki.com/profile/:id`],target:`/profile/:id`},{source:[`www.picuki.com/story/:id`],target:`/profile/:id/story`}],name:`User Profile - Picuki`,maintainers:[`hoilc`,`Rongronggg9`,`devinmugen`,`NekoAria`],handler:d};async function d(t){let u=t.req.param(`id`),d=t.req.param(`type`)??`profile`,f=t.req.param(`functionalFlag`)??`1`,p=f!==`0`,m=`https://www.picuki.com`,h=`${m}/${d===`story`?`story`:`profile`}/${u}`,g=await r.tryGet(`picuki:${d}:${u}`,async()=>{let e;try{e=await a(h,{headers:{"User-Agent":n.trueUA}})}catch(t){if(t.status===403){let{page:t,destory:n}=await s(h,{onBeforeLoad:async e=>{let t=new Set([`document`,`script`,`xhr`,`fetch`]);await e.setRequestInterception(!0),e.on(`request`,e=>{t.has(e.resourceType())?e.continue():e.abort()})}});await t.waitForSelector(`.content`),e=await t.content(),await n()}else throw new o(t.message)}let t=l(e);if(t(`.posts-empty`).length)throw Error(t(`.posts-empty`).text().trim()||`No posts found`);if(t(`.error-p`).length)throw Error(t(`.error-p span`).text().trim()||`Profile not found`);let r=t(`.profile-info .username`).text().trim(),i=t(`.posts-video .posts__video-item`).toArray().map(e=>{let n=t(e),i=n.attr(`href`)?.split(`/`).pop(),a=n.find(`img`);return{title:a.attr(`alt`)||``,author:r,renderData:{poster:a.attr(`src`),source:n.find(`.popup-open`).data(`source`),id:i},link:`${m}/media/${i}`,guid:`https://www.tiktok.com/@${u}/video/${i}`}});return{title:t(`head title`).text(),description:t(`.posts-current`).text().trim(),image:t(`.profile-image`).attr(`src`),items:i}}),_=g.items.map(t=>({...t,description:i(c.join(e,`templates/user-5aa582cb.art`),{poster:t.renderData.poster,source:t.renderData.source,useIframe:p,id:t.renderData.id})}));return{title:g.title,link:h,image:g.image,description:g.description,item:_}}export{u as route};
//# sourceMappingURL=profile-CIJylJns.js.map