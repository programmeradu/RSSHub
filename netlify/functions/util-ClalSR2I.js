import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{art as n}from"./render-CxhTJIsl.js";import{parseDate as r}from"./parse-date-Bgabdhlb.js";import{got_default as i}from"./got-CdvI2yKX.js";import a from"node:path";import{load as o}from"cheerio";import s from"crypto-js";t();const c=`huxiu.com`,l=`https://www.${c}`,u=`https://api-article.${c}`,d=`https://api-brief.${c}`,f=`https://api-account.${c}`,p=`https://moment-api.${c}`,m=`https://search-api.${c}`,h=t=>{let r=o(t);return r(`div.neirong-shouquan`).remove(),r(`em.vote__bar, div.vote__btn, div.vote__time`).remove(),r(`p img`).each((t,i)=>{i=r(i),(i.prop(`src`)??i.prop(`_src`))!==void 0&&i.parent().replaceWith(n(a.join(e,`templates/description-3471b3f6.art`),{image:{src:(i.prop(`src`)??i.prop(`_src`)).split(/\?/)[0],width:i.prop(`data-w`),height:i.prop(`data-h`)}}))}),r(`p, span`).each((e,t)=>{t=r(t),t.contents().length===1&&/^\s*$/.test(t.text())?t.remove():(t.removeClass(),t.removeAttr(`data-check-id label class`))}),r(`.text-big-title`).each((e,t)=>{t.tagName=`h3`,t=r(t),t.removeClass(),t.removeAttr(`class`)}),r(`.text-sm-title`).each((e,t)=>{t.tagName=`h4`,t=r(t),t.removeClass(),t.removeAttr(`class`)}),r.html()},g=async e=>{let t=new URL(`briefColumn/detail`,d).href,{data:{data:n}}=await i.post(t,{form:{platform:`www`,brief_column_id:e}}),r=new URL(`club/${n.club_id}.html`,l).href,{data:a}=await i(r),s=o(a),c=`${n.name}-${n.sub_name}`,u=new URL(s(`link[rel="apple-touch-icon"]`).prop(`href`),l).href,f=s(`meta[name="author"]`).prop(`content`);return{title:`${c}-${f}`,link:r,description:n.summary,language:s(`html`).prop(`lang`),image:n.head_img,icon:u,logo:u,subtitle:c,author:f,itunes_author:f,itunes_category:`News`,allowEmpty:!0}},_=async e=>{let t=new URL(`club/${e}.html`,l).href,{data:n}=await i(t),r=o(n),a=r(`title`).text(),s=new URL(r(`link[rel="apple-touch-icon"]`).prop(`href`),l).href,c=r(`meta[name="author"]`).prop(`content`);return{data:{title:a,link:t,description:r(`ul.content-item li.content`).text().trim(),language:r(`html`).prop(`lang`),image:r(`div.header img.img`).prop(`data-src`)?.split(/\?/)[0]??void 0,icon:s,logo:s,subtitle:a.split(/-/)[0],author:c,itunes_author:c,itunes_category:`News`,allowEmpty:!0},briefColumnId:n.match(/"brief_column_id":"(\d+)",/)[1]}},v=async e=>{let{data:t}=await i(e),n=o(t),r=new URL(n(`link[rel="apple-touch-icon"]`).prop(`href`),l).href,a=n(`meta[name="author"]`).prop(`content`);return{title:n(`title`).text(),link:e,description:n(`div.tag-content`).text()||n(`span.author-intro`).text()||n(`p.collection__intro`).text()||n(`meta[name="description"]`).prop(`content`),language:n(`html`).prop(`lang`),icon:r,logo:r,subtitle:n(`title`).text().split(/-/)[0],author:a,itunes_author:a,itunes_category:`News`,allowEmpty:!0}},y=async t=>{let{data:o}=await i(t.link),s=S(o),c=s?.briefStoreModule?.brief_detail.brief??s?.articleDetail?.articleDetail??void 0;if(!c)return t;let{processed:l,processedItem:u={}}=w(c.audio_info);Object.keys(u).length!==0&&(u.itunes_item_image=c.pic_path??c.share_info?.share_img??void 0);let{processed:d,processedItem:f={}}=D(c.video_info);return t.title=c.title??t.title,t.description=n(a.join(e,`templates/description-3471b3f6.art`),{image:{src:c.pic_path},video:d,audio:l,preface:h(c.content_preface??c.preface),summary:c.ai_summary,description:h(c.content)}),t.author=c.user_info?.username??t.author,t.category=[c.video_article_tag,c.brief_column?.name??void 0,c.club_info?.name??void 0,...c.tags_info?.map(e=>e.name)??[],...c.relation_info?.channel?.map(e=>e.name)??[]].filter(Boolean),t.pubDate=r(c.dateline??c.publish_time,`X`),t.upvote=c.agreenum??t.upvote,t.comments=c.commentnum??c.total_comment_num??t.comments,t.upvote=Number.parseInt(t.upvote,10),t.comments=Number.parseInt(t.comments,10),{...u,...f,...t}},b=()=>{let e=``;for(let t=0;t<16;t++)e+=`abcdefghijklmnopqrstuvwxyz1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ`.charAt(Math.floor(Math.random()*62));return e},x=()=>{let e=Math.round(Date.now()/1e3).toString(),t=b(),n=[`hUzaABtNfDE-6UiyaYhfsmjW-8dnoyVc`,e,t].sort();return{nonce:t,timestamp:e,signature:s.SHA1(n[0]+n[1]+n[2]).toString()}},S=e=>{let t=e.match(/window\.__INITIAL_STATE__=({.*?});\(function\(\)/);if(t)return JSON.parse(t[1])},C=[``,`low`],w=e=>{let t=e?C.find(t=>Object.hasOwn(e,`audio_${t===``?``:`${t}_`}path`)):void 0;if(t===void 0)return{processed:void 0,processedItem:{}};let n=`audio_${t}path`,r=`audio_${t}size`,i={duration:e.format_length_new??e.format_length,size:Object.hasOwn(e,r)?e[r]:void 0,src:e[n],type:`audio/${e[n].split(/\./).pop()}`},a={itunes_duration:i.duration,enclosure_url:i.src,enclosure_length:i.size,enclosure_type:i.type};return{processed:i,processedItem:a}},T=async(t,i,o)=>(t=t.map(t=>{let i=``,o=``;if(t.moment_id)i=`huxiu-moment-${t.moment_id}`,o=t.url||new URL(`moment/${t.moment_id}.html`,l).href;else if(t.brief_id||/huxiu\.com\/brief\//.test(t.url))t.brief_id=t.brief_id??t.aid,i=`huxiu-brief-${t.brief_id}`,o=new URL(`brief/${t.brief_id}.html`,l).href;else if(t.aid)i=`huxiu-article-${t.aid}`,o=new URL(`article/${t.aid}.html`,l).href;else return``;let{processed:s,processedItem:c={}}=w(t.audio_info);Object.keys(c).length!==0&&(c.itunes_item_image=t.pic_path??t.share_info?.share_img??void 0);let{processed:u,processedItem:d={}}=D(t.video_info),f=t.count_info?.agree??t.count_info?.favtimes??t.agree_num??0,p=t.count_info?.disagree??0,m=t.count_info?.total_comment_num??t.count_info?.commentnum??t.total_comment_num??t.commentnum??0;return{...c,...d,title:(t.title??t.summary??t.content)?.replace(/<\/?(?:em|br)?>/g,``),link:o,description:n(a.join(e,`templates/description-3471b3f6.art`),{image:{src:t.origin_pic_path??t.pic_path??t.big_pic_path?.split(/\?/)[0]??void 0},audio:s,video:u,summary:t.summary??t.content??t.preface}),author:t.user_info?.username??t.brief_column?.name??t.author_info?.username??t.author,guid:i,pubDate:t.publish_time??t.dateline?r(t.publish_time??t.dateline,`X`):void 0,upvotes:Number.parseInt(f,10),downvotes:Number.parseInt(p,10),comments:Number.parseInt(m,10)}}).filter(Boolean).slice(0,i),await Promise.all(t.map(e=>o(e.guid,async()=>{if(new RegExp(c,`i`).test(new URL(e.link).hostname)){if(!e.guid.startsWith(`huxiu-moment`))return await y(e)}else return e;return e})))),E=[`fhd`,`fhd_medium`,`wifi`,`fhd_low`,`flow`,`hd`,`sd`],D=e=>{let t=e?E.find(t=>Object.hasOwn(e,`${t}_link`)):void 0;if(t===void 0)return{processed:void 0,processedItem:{}};let n=`${t}_link`,r=`origin_${t}_size`,i={duration:e.duration??e.origin_duration,poster:e.cover??e.custom_cover_path??e.gif_path,size:Object.hasOwn(e,r)?e[r]:void 0,src:e[n],type:`video/${e[n].split(/\./).pop()}`},a={itunes_item_image:i.poster,itunes_duration:i.duration,enclosure_url:i.src,enclosure_length:i.size,enclosure_type:i.type};return{processed:i,processedItem:a}};export{u as apiArticleRootUrl,d as apiBriefRootUrl,f as apiMemberRootUrl,p as apiMomentRootUrl,m as apiSearchRootUrl,g as fetchBriefColumnData,_ as fetchClubData,v as fetchData,x as generateSignature,T as processItems,l as rootUrl};
//# sourceMappingURL=util-ClalSR2I.js.map