{"version":3,"file":"zfxxgk-Ye65UVAS.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/gov/chinamine-safety/zfxxgk.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { rootUrl, processItems, fetchData } from './util';\r\n\r\nexport const route: Route = {\r\n    path: '/chinamine-safety/zfxxgk/:category{.+}?',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'fdzdgknr/tzgg' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 30;\r\n\r\n    const currentUrl = new URL(`zfxxgk/${category.endsWith('/') ? category : `${category}/`}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    let items = $('ul#ogi-list li a, div#ogi-list dd a')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.contents().first().text(),\r\n                link: new URL(item.prop('href'), currentUrl).href,\r\n                pubDate: parseDate(item.parent().find('span').text()),\r\n            };\r\n        });\r\n\r\n    items = await processItems(items, cache.tryGet);\r\n\r\n    return {\r\n        item: items,\r\n        ...fetchData($, currentUrl),\r\n    };\r\n}\r\n"],"mappings":"qdAQA,MAAaA,EAAe,CACxB,KAAM,0CACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,iBAAoB,EAAI,IAAI,QACzC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAa,IAAI,IAAI,UAAU,EAAS,SAAS,KAAO,EAAW,GAAG,EAAS,KAAM,GAAS,KAE9F,CAAE,KAAM,GAAa,MAAMC,EAAI,GAE/B,EAAI,EAAK,GAEX,EAAQ,EAAE,uCACT,MAAM,EAAG,GACT,UACA,IAAK,IACF,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,WAAW,QAAQ,OAC/B,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAY,KAC7C,QAAS,EAAU,EAAK,SAAS,KAAK,QAAQ,WAM1D,MAFA,GAAQ,MAAM,EAAa,EAAOC,EAAM,QAEjC,CACH,KAAM,EACN,GAAG,EAAU,EAAG"}