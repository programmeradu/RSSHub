{"version":3,"file":"utils-4GdOexRu.js","names":["ofetch"],"sources":["../../lib/routes/css-tricks/utils.ts"],"sourcesContent":["import { load } from 'cheerio';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { DataItem } from '@/types';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const rootUrl = 'https://css-tricks.com';\r\ntype Card = {\r\n    id: string;\r\n    title: string;\r\n    link: string;\r\n    thumbnail: string;\r\n};\r\n\r\nexport async function extractMiniCards(cardselector: string, titleSelector: string = '', descSelector: string = '') {\r\n    const response = await ofetch(rootUrl);\r\n    const $ = load(response);\r\n    const cards = $(cardselector).toArray();\r\n    const title = titleSelector ? $(titleSelector).text().trim() : '';\r\n    const description = descSelector ? $(descSelector).text().trim() : '';\r\n    return {\r\n        title,\r\n        description,\r\n        cards,\r\n    };\r\n}\r\n\r\nfunction extractCardsInfo(cards) {\r\n    return cards.map((card) => {\r\n        const $ = load(card);\r\n        const id = $(card).attr('id');\r\n        const thumbnail = $(card).find('div.article-thumbnail-wrap > a >img').attr('src');\r\n        const article = $('div.article-article');\r\n        const title = article.find('h2 > a').text();\r\n        const link = article.find('h2 > a').attr('href');\r\n        return {\r\n            id,\r\n            title,\r\n            link,\r\n            thumbnail,\r\n        } as Card;\r\n    });\r\n}\r\n\r\nfunction extractMiniCardsInfo(cards) {\r\n    return cards.map((card) => {\r\n        const $ = load(card);\r\n        const id = $(card).attr('id')?.replace('mini-', '');\r\n        const thumbnail = '';\r\n        const title = $('h3.mini-card-title').find('a:not(.aal_anchor)').text();\r\n        const link = $('h3.mini-card-title').find('a:not(.aal_anchor)').attr('href');\r\n        return {\r\n            id,\r\n            title,\r\n            link,\r\n            thumbnail,\r\n        } as Card;\r\n    });\r\n}\r\n\r\nexport async function processWithWp(cards, mini: boolean = false, type: string = 'posts') {\r\n    const cardsWithInfo = mini ? extractMiniCardsInfo(cards) : extractCardsInfo(cards);\r\n    const ids = cardsWithInfo.map((card: Card) => card.id.replace('post-', ''));\r\n    const allPosts = await ofetch(`${rootUrl}/wp-json/wp/v2/${type}?include=${ids.join(',')}&_embed&per_page=${ids.length}`);\r\n    // To maintain the ID/post Order\r\n    const idMappedPost = Object.fromEntries(allPosts.map((post) => [post.id, post]));\r\n    return ids.map((id) => extractPostDetails(idMappedPost[id]));\r\n}\r\n\r\nfunction extractPostDetails(data) {\r\n    const title = data.title.rendered;\r\n    const link = data.link;\r\n    const content = data.content.rendered;\r\n    const summary = data.excerpt.rendered;\r\n    const date = data.date_gmt;\r\n    const updateDate = data.modified_gmt;\r\n    const author = data._embedded?.author;\r\n    const authorName = author?.[0]?.name;\r\n    const authorUrl = author?.[0]?.link;\r\n    const authorAvatar = author?.[0]?.avatar_urls['48'];\r\n    const thumbnail = data._embedded?.['wp:featuredmedia']?.[0]?.source_url;\r\n    const tags = data._embedded?.['wp:term']?.[1]?.map((tag) => tag.name);\r\n    return {\r\n        title,\r\n        link,\r\n        description: content,\r\n        banner: thumbnail,\r\n        image: thumbnail,\r\n        pubDate: parseDate(date),\r\n        updated: parseDate(updateDate),\r\n        author: [\r\n            {\r\n                name: authorName || '',\r\n                url: authorUrl || '',\r\n                avatar: authorAvatar || '',\r\n            },\r\n        ],\r\n        content: {\r\n            html: content,\r\n            text: summary,\r\n        },\r\n        category: tags,\r\n    } as DataItem;\r\n}\r\n"],"mappings":"0IAKA,MAAa,EAAU,yBAQvB,eAAsB,EAAiB,EAAsB,EAAwB,GAAI,EAAuB,GAAI,CAChH,IAAM,EAAW,MAAMA,EAAO,GACxB,EAAI,EAAK,GACT,EAAQ,EAAE,GAAc,UACxB,EAAQ,EAAgB,EAAE,GAAe,OAAO,OAAS,GACzD,EAAc,EAAe,EAAE,GAAc,OAAO,OAAS,GACnE,MAAO,CACH,QACA,cACA,SAIR,SAAS,EAAiB,EAAO,CAC7B,OAAO,EAAM,IAAK,GAAS,CACvB,IAAM,EAAI,EAAK,GACT,EAAK,EAAE,GAAM,KAAK,MAClB,EAAY,EAAE,GAAM,KAAK,uCAAuC,KAAK,OACrE,EAAU,EAAE,uBACZ,EAAQ,EAAQ,KAAK,UAAU,OAC/B,EAAO,EAAQ,KAAK,UAAU,KAAK,QACzC,MAAO,CACH,KACA,QACA,OACA,eAKZ,SAAS,EAAqB,EAAO,CACjC,OAAO,EAAM,IAAK,GAAS,CACvB,IAAM,EAAI,EAAK,GACT,EAAK,EAAE,GAAM,KAAK,OAAO,QAAQ,QAAS,IAE1C,EAAQ,EAAE,sBAAsB,KAAK,sBAAsB,OAC3D,EAAO,EAAE,sBAAsB,KAAK,sBAAsB,KAAK,QACrE,MAAO,CACH,KACA,QACA,OACA,gBAKZ,eAAsB,EAAc,EAAO,EAAgB,GAAO,EAAe,QAAS,CACtF,IAAM,EAAgB,EAAO,EAAqB,GAAS,EAAiB,GACtE,EAAM,EAAc,IAAK,GAAe,EAAK,GAAG,QAAQ,QAAS,KACjE,EAAW,MAAMA,EAAO,GAAG,EAAQ,iBAAiB,EAAK,WAAW,EAAI,KAAK,KAAK,mBAAmB,EAAI,UAEzG,EAAe,OAAO,YAAY,EAAS,IAAK,GAAS,CAAC,EAAK,GAAI,KACzE,OAAO,EAAI,IAAK,GAAO,EAAmB,EAAa,KAG3D,SAAS,EAAmB,EAAM,CAC9B,IAAM,EAAQ,EAAK,MAAM,SACnB,EAAO,EAAK,KACZ,EAAU,EAAK,QAAQ,SACvB,EAAU,EAAK,QAAQ,SACvB,EAAO,EAAK,SACZ,EAAa,EAAK,aAClB,EAAS,EAAK,WAAW,OACzB,EAAa,IAAS,IAAI,KAC1B,EAAY,IAAS,IAAI,KACzB,EAAe,IAAS,IAAI,YAAY,IACxC,EAAY,EAAK,YAAY,sBAAsB,IAAI,WACvD,EAAO,EAAK,YAAY,aAAa,IAAI,IAAK,GAAQ,EAAI,MAChE,MAAO,CACH,QACA,OACA,YAAa,EACb,OAAQ,EACR,MAAO,EACP,QAAS,EAAU,GACnB,QAAS,EAAU,GACnB,OAAQ,CACJ,CACI,KAAM,GAAc,GACpB,IAAK,GAAa,GAClB,OAAQ,GAAgB,KAGhC,QAAS,CACL,KAAM,EACN,KAAM,GAEV,SAAU"}