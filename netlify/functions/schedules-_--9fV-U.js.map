{"version":3,"file":"schedules-_--9fV-U.js","names":[],"sources":["../../lib/routes/lovelive-anime/schedules.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\nconst renderDescription = (desc) => art(path.join(__dirname, 'templates/scheduleDesc.art'), desc);\r\nimport dayjs from 'dayjs';\r\nimport utc from 'dayjs/plugin/utc.js';\r\nimport timezone from 'dayjs/plugin/timezone.js';\r\ndayjs.extend(utc);\r\ndayjs.extend(timezone);\r\n\r\nexport const route: Route = {\r\n    path: '/schedules/:serie?/:category?',\r\n    parameters: {\r\n        serie: 'Love Live! Series sub-projects abbreviation, see the following table',\r\n        category: 'The official website lists the categories, see the following table for details',\r\n    },\r\n    name: 'Schedule',\r\n    example: '/lovelive-anime/schedules',\r\n    categories: ['anime'],\r\n    maintainers: ['axojhf'],\r\n    handler,\r\n    description: `| Sub-project Name (not full name) | 全シリーズ              | Lovelive!  | Lovelive! Sunshine!! | Lovelive! Nijigasaki High School Idol Club | Lovelive! Superstar!! | ラブライブ！スクールアイドルミュージカル |\r\n| -------------------------------- | ----------------------- | ---------- | -------------------- | ------------------------------------------ | --------------------- | ---------------------------------------- |\r\n| \\`serie\\` parameter                | *No parameter* or \\`all\\` | \\`lovelive\\` | \\`sunshine\\`           | \\`nijigasaki\\`                               | \\`superstar\\`           | \\`musical\\`                                |\r\n\r\n| Category Name        | 全て                    | ライブ | イベント | 生配信    |\r\n| -------------------- | ----------------------- | ------ | -------- | --------- |\r\n| \\`category\\` parameter | *No parameter* or \\`all\\` | \\`live\\` | \\`event\\`  | \\`haishin\\` |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { serie = 'all', category = 'all' } = ctx.req.param();\r\n    const rootUrl = 'https://www.lovelive-anime.jp/common/api/calendar_list.php';\r\n    const nowTime = dayjs();\r\n    const dataPara = {\r\n        year: nowTime.year(),\r\n        month: nowTime.format('MM'),\r\n    };\r\n    if (serie && 'all' !== serie) {\r\n        dataPara.series = [serie];\r\n    }\r\n    if (category && 'all' !== category) {\r\n        dataPara.category = [category];\r\n    }\r\n    const response = await ofetch(`${rootUrl}?site=jp&ip=lovelive&data=${encodeURIComponent(JSON.stringify(dataPara))}`);\r\n\r\n    const items = response.data.schedule_list.map((item) => {\r\n        const link = item.url.select_url;\r\n        const title = item.title;\r\n        const category = item.categories.name;\r\n        const eventStartDate = dayjs.unix(item.event_startdate).tz('Asia/Tokyo').format('YYYY-MM-DD HH:mm:ss JST');\r\n        const eventEndDate = dayjs.unix(item.event_enddate).tz('Asia/Tokyo').format('YYYY-MM-DD HH:mm:ss JST');\r\n\r\n        return {\r\n            link,\r\n            pubDate: item.start_endflg ? dayjs.unix(item.event_enddate).tz('Asia/Tokyo') : dayjs.unix(item.event_startdate).tz('Asia/Tokyo'),\r\n            title,\r\n            category,\r\n            description: renderDescription({\r\n                desc: item.event_dspdate,\r\n                startTime: eventStartDate,\r\n                endTime: eventEndDate,\r\n            }),\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: `${category} - ${serie} - Love Live Official Website Schedule`,\r\n        link: 'https://www.lovelive-anime.jp/schedule/',\r\n        item: items,\r\n        description:\r\n            'The schedule date and other information shall be subject to the announcement on the official website. The RSS route has not been strictly tested, and the captured information cannot be guaranteed to be correct.',\r\n    };\r\n}\r\n"],"mappings":"2XAKA,MAAM,EAAqB,GAAS,EAAI,EAAA,KAAA,EAAA,uCAAoD,GAI5F,EAAM,OAAO,GACb,EAAM,OAAO,GAEb,MAAa,EAAe,CACxB,KAAM,gCACN,WAAY,CACR,MAAO,uEACP,SAAU,kFAEd,KAAM,WACN,QAAS,4BACT,WAAY,CAAC,SACb,YAAa,CAAC,UACd,UACA,YAAa,u1BASjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,QAAQ,MAAO,WAAW,OAAU,EAAI,IAAI,QAE9C,EAAU,IACV,EAAW,CACb,KAAM,EAAQ,OACd,MAAO,EAAQ,OAAO,OAEtB,GAAmB,IAAV,QACT,EAAS,OAAS,CAAC,IAEnB,GAAsB,IAAV,QACZ,EAAS,SAAW,CAAC,IAEzB,IAAM,EAAW,MAAM,EAAO,uFAAuC,mBAAmB,KAAK,UAAU,OAEjG,EAAQ,EAAS,KAAK,cAAc,IAAK,GAAS,CACpD,IAAM,EAAO,EAAK,IAAI,WAChB,EAAQ,EAAK,MACb,EAAW,EAAK,WAAW,KAC3B,EAAiB,EAAM,KAAK,EAAK,iBAAiB,GAAG,cAAc,OAAO,2BAC1E,EAAe,EAAM,KAAK,EAAK,eAAe,GAAG,cAAc,OAAO,2BAE5E,MAAO,CACH,OACA,QAAS,EAAK,aAAe,EAAM,KAAK,EAAK,eAAe,GAAG,cAAgB,EAAM,KAAK,EAAK,iBAAiB,GAAG,cACnH,QACA,SAAA,EACA,YAAa,EAAkB,CAC3B,KAAM,EAAK,cACX,UAAW,EACX,QAAS,OAKrB,MAAO,CACH,MAAO,GAAG,EAAS,KAAK,EAAM,wCAC9B,KAAM,0CACN,KAAM,EACN,YACI"}