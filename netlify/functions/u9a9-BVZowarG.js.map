{"version":3,"file":"u9a9-BVZowarG.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/u9a9/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst baseUrl = 'https://u9a9.com';\r\n\r\nexport const route: Route = {\r\n    path: ['/:preview?', '/search/:keyword/:preview?'],\r\n    example: '/u9a9/search/新片速递',\r\n    radar: [\r\n        {\r\n            source: ['u9a9.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Search',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'u9a9.com/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { preview, keyword } = ctx.req.param();\r\n\r\n    let link;\r\n    let title;\r\n    if (keyword) {\r\n        link = `${baseUrl}/?type=2&search=${keyword}`;\r\n        title = `${keyword} - U9A9`;\r\n    } else {\r\n        link = baseUrl;\r\n        title = 'U9A9';\r\n    }\r\n\r\n    const { data: response } = await got(link);\r\n    const $ = load(response);\r\n\r\n    const list = $('table tr')\r\n        .slice(1) // skip thead\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const a = item.find('td').eq(1).find('a');\r\n            const { size, unit } = item\r\n                .find('td')\r\n                .eq(3)\r\n                .text()\r\n                .match(/(?<size>\\d+\\.\\d+)\\s(?<unit>\\w+)/).groups;\r\n            return {\r\n                title: a.attr('title'),\r\n                link: `${baseUrl}${a.attr('href')}`,\r\n                pubDate: timezone(parseDate(item.find('td').eq(4).text()), +8),\r\n\r\n                enclosure_url: item.find('td').eq(2).find('a').eq(1).attr('href'),\r\n                enclosure_length: Number.parseInt(size * (unit === 'GB' ? 1024 * 1024 * 1024 : 1024 * 1024)),\r\n                enclosure_type: 'application/x-bittorrent',\r\n            };\r\n        });\r\n\r\n    const items = preview\r\n        ? await Promise.all(\r\n              list.map((item) =>\r\n                  cache.tryGet(item.link, async () => {\r\n                      const { data: response } = await got(item.link);\r\n                      const $ = load(response);\r\n\r\n                      item.description = $('.panel-body').eq(1).html();\r\n\r\n                      return item;\r\n                  })\r\n              )\r\n          )\r\n        : list;\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAM,EAAU,mBAEHA,EAAe,CACxB,KAAM,CAAC,aAAc,8BACrB,QAAS,oBACT,MAAO,CACH,CACI,OAAQ,CAAC,aACT,OAAQ,KAGhB,KAAM,SACN,YAAa,CAAC,UACd,UACA,IAAK,aAGT,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,UAAS,WAAY,EAAI,IAAI,QAEjC,EACA,EACA,GACA,EAAO,GAAG,EAAQ,kBAAkB,IACpC,EAAQ,GAAG,EAAQ,WAEnB,EAAO,EACP,EAAQ,QAGZ,GAAM,CAAE,KAAM,GAAa,MAAMC,EAAI,GAC/B,EAAI,EAAK,GAET,EAAO,EAAE,YACV,MAAM,GACN,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAI,EAAK,KAAK,MAAM,GAAG,GAAG,KAAK,KAC/B,CAAE,OAAM,QAAS,EAClB,KAAK,MACL,GAAG,GACH,OACA,MAAM,mCAAmC,OAC9C,MAAO,CACH,MAAO,EAAE,KAAK,SACd,KAAM,GAAG,IAAU,EAAE,KAAK,UAC1B,QAAS,EAAS,EAAU,EAAK,KAAK,MAAM,GAAG,GAAG,QAAS,GAE3D,cAAe,EAAK,KAAK,MAAM,GAAG,GAAG,KAAK,KAAK,GAAG,GAAG,KAAK,QAC1D,iBAAkB,OAAO,SAAS,GAAQ,IAAS,KAAO,KAAO,KAAO,KAAO,KAAO,OACtF,eAAgB,8BAItB,EAAQ,EACR,MAAM,QAAQ,IACV,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAIf,MAFA,GAAK,YAAcC,EAAE,eAAe,GAAG,GAAG,OAEnC,MAInB,EAEN,MAAO,CACH,QACA,OACA,KAAM"}