{"version":3,"file":"utils-Y8U_0mAH.js","names":["got"],"sources":["../../lib/routes/jianshu/utils.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\n// 加载文章页\r\nconst loadContent = async (link) => {\r\n    const response = await got.get(link);\r\n    const $ = load(response.data);\r\n    // 解析日期\r\n    const pubDate = timezone(parseDate($('time').attr('datetime')), +8);\r\n    // 去除样式\r\n    $('.image-container, .image-container-fill').removeAttr('style');\r\n    // 处理视频\r\n    $('.video-package').each((index, elem) => {\r\n        const $item = $(elem);\r\n        const desc = $item.find('.video-description').html();\r\n        const url = $item.attr('data-video-url');\r\n\r\n        $item.html(`\r\n            <p>${desc}</p>\r\n            <iframe frameborder=\"0\" src=\"${url}\" allowFullScreen=\"true\"></iframe>\r\n        `);\r\n    });\r\n    // 提取内容\r\n    const description = $('article').html();\r\n\r\n    return { description, pubDate };\r\n};\r\n\r\nconst ProcessFeed = (list, caches) => {\r\n    const host = 'https://www.jianshu.com';\r\n\r\n    return Promise.all(\r\n        list.map((item) => {\r\n            const $ = load(item);\r\n            const $title = $('.title');\r\n            // 还原相对链接为绝对链接\r\n            const itemUrl = new URL($title.attr('href'), host).toString();\r\n            // 使用tryGet方法从缓存获取内容。\r\n            // 当缓存中无法获取到链接内容的时候，则使用load方法加载文章内容\r\n            return caches.tryGet(itemUrl, async () => {\r\n                const other = await loadContent(itemUrl);\r\n                // 合并解析后的结果集作为该篇文章最终的输出结果\r\n                return {\r\n                    title: $title.text(),\r\n                    link: itemUrl,\r\n                    author: $('.nickname').text(),\r\n                    ...other,\r\n                };\r\n            });\r\n        })\r\n    );\r\n};\r\n\r\nexport default { ProcessFeed };\r\n"],"mappings":"sLAMA,MAAM,EAAc,KAAO,IAAS,CAChC,IAAM,EAAW,MAAMA,EAAI,IAAI,GACzB,EAAI,EAAK,EAAS,MAElB,EAAU,EAAS,EAAU,EAAE,QAAQ,KAAK,aAAc,GAEhE,EAAE,2CAA2C,WAAW,SAExD,EAAE,kBAAkB,MAAM,EAAO,IAAS,CACtC,IAAM,EAAQ,EAAE,GACV,EAAO,EAAM,KAAK,sBAAsB,OACxC,EAAM,EAAM,KAAK,kBAEvB,EAAM,KAAK;iBACF,EAAK;2CACqB,EAAI;aAI3C,IAAM,EAAc,EAAE,WAAW,OAEjC,MAAO,CAAE,cAAa,YAGpB,GAAe,EAAM,IAGhB,QAAQ,IACX,EAAK,IAAK,GAAS,CACf,IAAM,EAAI,EAAK,GACT,EAAS,EAAE,UAEX,EAAU,IAAI,IAAI,EAAO,KAAK,QAAS,2BAAM,WAGnD,OAAO,EAAO,OAAO,EAAS,SAAY,CACtC,IAAM,EAAQ,MAAM,EAAY,GAEhC,MAAO,CACH,MAAO,EAAO,OACd,KAAM,EACN,OAAQ,EAAE,aAAa,OACvB,GAAG,QAOvB,IAAA,EAAe,CAAE"}