{"version":3,"file":"user-dynamic-DG7YpUOe.js","names":["route: Route","utils","got","InvalidParameterError"],"sources":["../../lib/routes/coolapk/user-dynamic.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport utils from './utils';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: '/user/:uid/dynamic',\r\n    categories: ['social-media'],\r\n    example: '/coolapk/user/3177668/dynamic',\r\n    parameters: { uid: '在个人界面右上分享-复制链接获取' },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'ALLOW_USER_HOTLINK_TEMPLATE',\r\n                optional: true,\r\n                description: '设置为`true`并添加`image_hotlink_template`参数来代理图片',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '用户',\r\n    maintainers: ['xizeyoupan'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const uid = ctx.req.param('uid');\r\n    const full_url = utils.base_url + `/v6/user/feedList?uid=${uid}&page=1&showAnonymous=0&isIncludeTop=1&showDoing=1`;\r\n    let username;\r\n    const response = await got(full_url, {\r\n        headers: utils.getHeaders(),\r\n    });\r\n    const data = response.data.data;\r\n    if (!data) {\r\n        throw new InvalidParameterError('这个人没有任何动态。');\r\n    }\r\n    let out = await Promise.all(\r\n        data.map((item) => {\r\n            if (!username) {\r\n                username = item.username;\r\n            }\r\n\r\n            return utils.parseDynamic(item);\r\n        })\r\n    );\r\n\r\n    out = out.filter(Boolean); // 去除空值\r\n    if (out.length === 0) {\r\n        throw new InvalidParameterError('这个人还没有图文或动态。');\r\n    }\r\n    return {\r\n        title: `酷安个人动态-${username}`,\r\n        link: `https://www.coolapk.com/u/${uid}`,\r\n        description: `酷安个人动态-${username}`,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"ubAKA,MAAaA,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,gBACb,QAAS,gCACT,WAAY,CAAE,IAAK,oBACnB,SAAU,CACN,cAAe,CACX,CACI,KAAM,8BACN,SAAU,GACV,YAAa,gDAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,cACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,EAAI,IAAI,MAAM,OACpB,EAAWC,EAAM,SAAW,yBAAyB,EAAI,oDAC3D,EACE,EAAW,MAAMC,EAAI,EAAU,CACjC,QAASD,EAAM,eAEb,EAAO,EAAS,KAAK,KAC3B,GAAI,CAAC,EACD,MAAM,IAAIE,EAAsB,cAEpC,IAAI,EAAM,MAAM,QAAQ,IACpB,EAAK,IAAK,IACD,IACD,EAAW,EAAK,UAGbF,EAAM,aAAa,MAKlC,GADA,EAAM,EAAI,OAAO,SACb,EAAI,SAAW,EACf,MAAM,IAAIE,EAAsB,gBAEpC,MAAO,CACH,MAAO,UAAU,IACjB,KAAM,6BAA6B,IACnC,YAAa,UAAU,IACvB,KAAM"}