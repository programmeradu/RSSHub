{"version":3,"file":"yz-C43Z2DIQ.js","names":["got","route: Route","got","util","cache"],"sources":["../../lib/routes/szu/yz/utils.ts","../../lib/routes/szu/yz/index.ts"],"sourcesContent":["import { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst ProcessFeed = (list, cache, current) =>\r\n    Promise.all(\r\n        list\r\n            .filter((item) => {\r\n                // 如果不包含链接说明不是新闻item，如表头的tr\r\n                const $ = load(item, null, false);\r\n                return $('a').length;\r\n\r\n                // return typeof ($('a').attr('href')) !== undefined;\r\n                // return false;\r\n            })\r\n            .map((item) => {\r\n                let $ = load(item, null, false);\r\n                const $url = new URL($('a').attr('href'), current.url).href;\r\n                return cache.tryGet($url, async () => {\r\n                    // 加载新闻内容页面\r\n                    const response = await got($url);\r\n\r\n                    const data = response.data;\r\n                    $ = load(data); // 使用 cheerio 加载返回的 HTML\r\n\r\n                    // 还原图片地址\r\n                    $(`${current.selector.content} img`).each((index, elem) => {\r\n                        const $elem = $(elem);\r\n                        const src = $elem.attr('src');\r\n                        if (src) {\r\n                            $elem.attr('src', new URL(src, current.url).href);\r\n                        }\r\n                    });\r\n\r\n                    // 还原链接地址\r\n                    $(`${current.selector.content} a, ul[style]`).each((index, elem) => {\r\n                        const $elem = $(elem);\r\n                        const src = $elem.attr('href');\r\n                        if (src) {\r\n                            $elem.attr('href', new URL(src, current.url).href);\r\n                        }\r\n                    });\r\n\r\n                    // 去除样式\r\n                    $('img, div, span, p, table, td, tr, a').removeAttr('style');\r\n                    $('style, script').remove();\r\n\r\n                    const title = $('h2').text();\r\n\r\n                    const single = {\r\n                        title,\r\n                        description: $(current.selector.content).html() + ($('ul[style]').length ? $('ul[style]').html() : ''),\r\n                        link: $url,\r\n                        pubDate: timezone(\r\n                            parseDate(\r\n                                $('div.ny_fbt')\r\n                                    .text()\r\n                                    .match(/(\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2})/)[0],\r\n                                'YYYY-MM-DD HH:mm'\r\n                            ),\r\n                            8\r\n                        ), // 混有发表时间和点击量，取出时间\r\n                        author: '深圳大学研究生招生网',\r\n                    };\r\n                    // 返回列表上提取到的信息\r\n                    return single;\r\n                });\r\n            })\r\n    );\r\n\r\nexport default { ProcessFeed };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport util from './utils';\r\n\r\nconst map = new Map([\r\n    [1, { title: '硕士招生 - 深圳大学研究生招生网' }],\r\n    [2, { title: '博士招生 - 深圳大学研究生招生网' }],\r\n]);\r\n\r\nexport const route: Route = {\r\n    path: '/yz/:type?',\r\n    categories: ['university'],\r\n    example: '/szu/yz/1',\r\n    parameters: { type: '默认为 `1`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '研究生招生网',\r\n    maintainers: ['NagaruZ'],\r\n    handler,\r\n    description: `| 研究生 | 博士生 |\r\n| ------ | ------ |\r\n| 1      | 2      |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let type = Number.parseInt(ctx.req.param('type'));\r\n    const struct = {\r\n        1: {\r\n            selector: {\r\n                list: '.list',\r\n                item: 'li',\r\n                content: '#vsb_content',\r\n            },\r\n            url: 'https://yz.szu.edu.cn/sszs/gg.htm',\r\n        },\r\n        2: {\r\n            selector: {\r\n                list: '.list',\r\n                item: 'li',\r\n                content: '#vsb_content, #vsb_content_2',\r\n            },\r\n            url: 'https://yz.szu.edu.cn/bszs/gg.htm',\r\n        },\r\n    };\r\n    if (type !== 1 && type !== 2) {\r\n        // fallback to default\r\n        type = 1;\r\n    }\r\n    const url = struct[type].url;\r\n\r\n    const response = await got(url);\r\n    const data = response.data;\r\n\r\n    const $ = load(data);\r\n    const list = $(struct[type].selector.list).find(struct[type].selector.item).toArray();\r\n\r\n    const name = $('title').text();\r\n    const result = await util.ProcessFeed(list, cache, struct[type]);\r\n\r\n    return {\r\n        title: map.get(type).title,\r\n        link: url,\r\n        description: name,\r\n        item: result,\r\n    };\r\n}\r\n"],"mappings":"0ZAKA,MAAM,GAAe,EAAM,EAAO,IAC9B,QAAQ,IACJ,EACK,OAAQ,GAAS,CAEd,IAAM,EAAI,EAAK,EAAM,KAAM,IAC3B,OAAO,EAAE,KAAK,SAKjB,IAAK,GAAS,CACX,IAAI,EAAI,EAAK,EAAM,KAAM,IACnB,EAAO,IAAI,IAAI,EAAE,KAAK,KAAK,QAAS,EAAQ,KAAK,KACvD,OAAO,EAAM,OAAO,EAAM,SAAY,CAElC,IAAM,EAAW,MAAME,EAAI,GAErB,EAAO,EAAS,KACtB,EAAI,EAAK,GAGT,EAAE,GAAG,EAAQ,SAAS,QAAQ,OAAO,MAAM,EAAO,IAAS,CACvD,IAAM,EAAQ,EAAE,GACV,EAAM,EAAM,KAAK,OACnB,GACA,EAAM,KAAK,MAAO,IAAI,IAAI,EAAK,EAAQ,KAAK,QAKpD,EAAE,GAAG,EAAQ,SAAS,QAAQ,gBAAgB,MAAM,EAAO,IAAS,CAChE,IAAM,EAAQ,EAAE,GACV,EAAM,EAAM,KAAK,QACnB,GACA,EAAM,KAAK,OAAQ,IAAI,IAAI,EAAK,EAAQ,KAAK,QAKrD,EAAE,uCAAuC,WAAW,SACpD,EAAE,iBAAiB,SAEnB,IAAM,EAAQ,EAAE,MAAM,OAEhB,EAAS,CACX,QACA,YAAa,EAAE,EAAQ,SAAS,SAAS,QAAU,EAAE,aAAa,OAAS,EAAE,aAAa,OAAS,IACnG,KAAM,EACN,QAAS,EACL,EACI,EAAE,cACG,OACA,MAAM,mCAAmC,GAC9C,oBAEJ,GAEJ,OAAQ,cAGZ,OAAO,OAK3B,IAAA,EAAe,CAAE,eCjEjB,MAAM,EAAM,IAAI,IAAI,CAChB,CAAC,EAAG,CAAE,MAAO,sBACb,CAAC,EAAG,CAAE,MAAO,wBAGJD,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,cACb,QAAS,YACT,WAAY,CAAE,KAAM,WACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,WACd,UACA,YAAa;;sBAKjB,eAAe,EAAQ,EAAK,CACxB,IAAI,EAAO,OAAO,SAAS,EAAI,IAAI,MAAM,SACnC,EAAS,CACX,EAAG,CACC,SAAU,CACN,KAAM,QACN,KAAM,KACN,QAAS,gBAEb,IAAK,qCAET,EAAG,CACC,SAAU,CACN,KAAM,QACN,KAAM,KACN,QAAS,gCAEb,IAAK,sCAGT,IAAS,GAAK,IAAS,IAEvB,EAAO,GAEX,IAAM,EAAM,EAAO,GAAM,IAEnB,EAAW,MAAMC,EAAI,GACrB,EAAO,EAAS,KAEhB,EAAI,EAAK,GACT,EAAO,EAAE,EAAO,GAAM,SAAS,MAAM,KAAK,EAAO,GAAM,SAAS,MAAM,UAEtE,EAAO,EAAE,SAAS,OAClB,EAAS,MAAMC,EAAK,YAAY,EAAMC,EAAO,EAAO,IAE1D,MAAO,CACH,MAAO,EAAI,IAAI,GAAM,MACrB,KAAM,EACN,YAAa,EACb,KAAM"}