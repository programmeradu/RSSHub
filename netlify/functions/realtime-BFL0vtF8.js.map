{"version":3,"file":"realtime-BFL0vtF8.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/stheadline/std/realtime.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst baseUrl = 'https://www.stheadline.com';\r\n\r\nexport const route: Route = {\r\n    path: '/std/:category{.+}?',\r\n    name: '即時',\r\n    maintainers: ['TonyRL'],\r\n    example: '/stheadline/std/realtimenews',\r\n    parameters: { category: '分類路徑，URL 中 `www.stheadline.com/` 後至中文分類名前部分，預設為 `realtimenews`' },\r\n    radar: [\r\n        {\r\n            source: ['www.stheadline.com/theme/:category/chineseCategory', 'www.stheadline.com/:category/:chineseCategory'],\r\n            target: '/std/:category',\r\n        },\r\n    ],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'realtimenews' } = ctx.req.param();\r\n    const url = `${baseUrl}/${category}`;\r\n    const { data: response } = await got(url);\r\n    const $ = load(response);\r\n\r\n    let items = $('.news-block .news-detail > a')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item.find('.title').text(),\r\n                link: new URL(item.attr('href'), 'https://www.stheadline.com').href,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n\r\n                return {\r\n                    ...item,\r\n                    description: $('.content-body').html(),\r\n                    pubDate: parseDate($('meta[property=\"article:published_time\"]').attr('content')),\r\n                    category: $(\"meta[name='keyword']\").attr('content').split(','),\r\n                    guid: item.link.slice(0, item.link.lastIndexOf('/')),\r\n                };\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head meta[name=\"title\"]').attr('content') || $('head title').text(),\r\n        description: $('meta[name=description]').attr('content'),\r\n        image: 'https://www.sthlstatic.com/sthl/assets/favicon/android-icon-192x192.png',\r\n        language: 'zh-HK',\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAEaA,EAAe,CACxB,KAAM,sBACN,KAAM,KACN,YAAa,CAAC,UACd,QAAS,+BACT,WAAY,CAAE,SAAU,kEACxB,MAAO,CACH,CACI,OAAQ,CAAC,qDAAsD,iDAC/D,OAAQ,mBAGhB,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,gBAAmB,EAAI,IAAI,QACxC,EAAM,8BAAc,IACpB,CAAE,KAAM,GAAa,MAAMC,EAAI,GAC/B,EAAI,EAAK,GAEX,EAAQ,EAAE,gCACT,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,UAAU,OAC3B,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,8BAA8B,QAqB3E,MAjBA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAEf,MAAO,CACH,GAAG,EACH,YAAaC,EAAE,iBAAiB,OAChC,QAAS,EAAUA,EAAE,2CAA2C,KAAK,YACrE,SAAUA,EAAE,wBAAwB,KAAK,WAAW,MAAM,KAC1D,KAAM,EAAK,KAAK,MAAM,EAAG,EAAK,KAAK,YAAY,WAMxD,CACH,MAAO,EAAE,2BAA2B,KAAK,YAAc,EAAE,cAAc,OACvE,YAAa,EAAE,0BAA0B,KAAK,WAC9C,MAAO,0EACP,SAAU,QACV,KAAM,EACN,KAAM"}