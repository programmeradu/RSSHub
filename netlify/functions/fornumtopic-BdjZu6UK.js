import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import s from"node:path";import{load as c}from"cheerio";import l from"iconv-lite";t();const u=`https://www.txrjy.com`,d={path:`/fornumtopic/:channel?`,categories:[`bbs`],example:`/txrjy/fornumtopic`,parameters:{channel:`频道的 id，见下表，默认为最新500个主题帖`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`论坛 频道`,maintainers:[`Fatpandac`],handler:f,description:`| 最新 500 个主题帖 | 最新 500 个回复帖 | 最新精华帖 | 最新精华帖 | 一周热帖 | 本月热帖 |
| :---------------: | :---------------: | :--------: | :--------: | :------: | :------: |
|         1         |         2         |      3     |      4     |     5    |     6    |`};async function f(t){let d=t.req.param(`channel`)??`1`,f=`${u}/c114-listnewtopic.php?typeid=${d}`,p=await a(f,{responseType:`buffer`}),m=c(l.decode(p.data,`gbk`)),h=m(`div.z > a`).last().text(),g=m(`tbody > tr`).slice(0,25).toArray().map(e=>({title:m(e).find(`td.title2`).text(),link:new URL(m(e).find(`td.title2 > a`).attr(`href`),u).href,author:m(e).find(`td.author`).text(),pubDate:o(i(m(e).find(`td.dateline`).text(),`YYYY-M-D HH:mm`),8),category:m(e).find(`td.forum`).text()})).filter(e=>e.title),_=await Promise.all(g.map(t=>n.tryGet(t.link,async()=>{let n=await a(t.link,{responseType:`buffer`}),i=c(l.decode(n.data,`gbk`));return t.description=i(`div.c_table`).toArray().map(t=>r(s.join(e,`templates/fornumtopic-5ab8f8aa.art`),{content:i(t).find(`td.t_f`).find(`div.a_pr`).remove().end().html()?.replace(/(<img.*?) src=".*?"(.*?>)/g,`$1$2`).replaceAll(/(<img.*?)zoomfile(.*?>)/g,`$1src$2`),pattl:i(t).find(`div.pattl`).html()?.replace(/(<img.*?) src=".*?"(.*?>)/g,`$1$2`).replaceAll(/(<img.*?)zoomfile(.*?>)/g,`$1src$2`),author:i(t).find(`a.xw1`).text().trim()})).join(`
`),t})));return{title:`通信人家园 - 论坛 ${h}`,link:f,item:_}}export{d as route};
//# sourceMappingURL=fornumtopic-BdjZu6UK.js.map