{"version":3,"file":"news-8-5Q3jan.js","names":["JP: Mapping","heading: string[]","separator: string[]","body: string[]","handler: Route['handler']","ja: Route['handler']","ofetch","route: Route"],"sources":["../../lib/routes/bluearchive/news.ts"],"sourcesContent":["import type { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\n// type id => display name\r\ntype Mapping = Record<string, string>;\r\n\r\nconst JP: Mapping = {\r\n    '0': '全て',\r\n    '1': 'イベント',\r\n    '2': 'お知らせ',\r\n    '3': 'メンテナンス',\r\n};\r\n\r\n// render into MD table\r\nconst mkTable = (mapping: Mapping): string => {\r\n    const heading: string[] = [],\r\n        separator: string[] = [],\r\n        body: string[] = [];\r\n\r\n    for (const key in mapping) {\r\n        heading.push(mapping[key]);\r\n        separator.push(':--:');\r\n        body.push(key);\r\n    }\r\n\r\n    return [heading.join(' | '), separator.join(' | '), body.join(' | ')].map((s) => `| ${s} |`).join('\\n');\r\n};\r\n\r\nconst handler: Route['handler'] = async (ctx) => {\r\n    const { server } = ctx.req.param();\r\n\r\n    switch (server.toUpperCase()) {\r\n        case 'JP':\r\n            return await ja(ctx);\r\n        default:\r\n            throw [];\r\n    }\r\n};\r\n\r\nconst ja: Route['handler'] = async (ctx) => {\r\n    const { type = '0' } = ctx.req.param();\r\n\r\n    const data = await ofetch<{ data: { rows: { id: number; content: string; summary: string; publishTime: number }[] } }, 'json'>('https://api-web.bluearchive.jp/api/news/list', {\r\n        params: {\r\n            typeId: type,\r\n            pageNum: 16,\r\n            pageIndex: 1,\r\n        },\r\n    });\r\n\r\n    return {\r\n        title: `ブルアカ - ${JP[type]}`,\r\n        link: 'https://bluearchive.jp/news/newsJump',\r\n        language: 'ja-JP',\r\n        image: 'https://webcnstatic.yostar.net/ba_cn_web/prod/web/favicon.png', // The CN website has a larger one\r\n        icon: 'https://webcnstatic.yostar.net/ba_cn_web/prod/web/favicon.png',\r\n        logo: 'https://webcnstatic.yostar.net/ba_cn_web/prod/web/favicon.png',\r\n        item: data.data.rows.map((row) => ({\r\n            title: row.summary,\r\n            description: row.content,\r\n            link: `https://bluearchive.jp/news/newsJump/${row.id}`,\r\n            pubDate: parseDate(row.publishTime),\r\n        })),\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/news/:server/:type?',\r\n    name: 'News',\r\n    categories: ['game'],\r\n    maintainers: ['equt'],\r\n    example: '/bluearchive/news/jp',\r\n    parameters: {\r\n        server: 'game server (ISO 3166 two-letter country code, case-insensitive), only `JP` is supported for now',\r\n        type: 'news type, checkout the table below for details',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    handler,\r\n    description: [JP].map((el) => mkTable(el)).join('\\n\\n'),\r\n};\r\n"],"mappings":"gOAOA,MAAMA,EAAc,CAChB,EAAK,KACL,EAAK,OACL,EAAK,OACL,EAAK,UAIH,EAAW,GAA6B,CAC1C,IAAMC,EAAoB,GACtBC,EAAsB,GACtBC,EAAiB,GAErB,IAAK,IAAM,KAAO,EACd,EAAQ,KAAK,EAAQ,IACrB,EAAU,KAAK,QACf,EAAK,KAAK,GAGd,MAAO,CAAC,EAAQ,KAAK,OAAQ,EAAU,KAAK,OAAQ,EAAK,KAAK,QAAQ,IAAK,GAAM,KAAK,EAAE,KAAK,KAAK;IAGhGC,EAA4B,KAAO,IAAQ,CAC7C,GAAM,CAAE,UAAW,EAAI,IAAI,QAE3B,OAAQ,EAAO,cAAf,CACI,IAAK,KACD,OAAO,MAAM,EAAG,GACpB,QACI,KAAM,KAIZC,EAAuB,KAAO,IAAQ,CACxC,GAAM,CAAE,OAAO,KAAQ,EAAI,IAAI,QAEzB,EAAO,MAAMC,EAA4G,+CAAgD,CAC3K,OAAQ,CACJ,OAAQ,EACR,QAAS,GACT,UAAW,KAInB,MAAO,CACH,MAAO,UAAU,EAAG,KACpB,KAAM,uCACN,SAAU,QACV,MAAO,gEACP,KAAM,gEACN,KAAM,gEACN,KAAM,EAAK,KAAK,KAAK,IAAK,IAAS,CAC/B,MAAO,EAAI,QACX,YAAa,EAAI,QACjB,KAAM,wCAAwC,EAAI,KAClD,QAAS,EAAU,EAAI,kBAKtBC,EAAe,CACxB,KAAM,uBACN,KAAM,OACN,WAAY,CAAC,QACb,YAAa,CAAC,QACd,QAAS,uBACT,WAAY,CACR,OAAQ,mGACR,KAAM,mDAEV,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,UACA,YAAa,CAAC,GAAI,IAAK,GAAO,EAAQ,IAAK,KAAK"}