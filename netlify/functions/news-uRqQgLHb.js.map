{"version":3,"file":"news-uRqQgLHb.js","names":["limit: number","baseUrl: string","apiBaseUrl: string","targetUrl: string","apiListUrl: string","apiInfoUrl: string","ofetch","$: CheerioAPI","items: DataItem[]","title: string","pubDate: number | string","linkUrl: string | undefined","authors: DataItem['author']","guid: string","image: string | undefined","updated: number | string","processedItem: DataItem","cache","description: string","route: Route"],"sources":["../../lib/routes/qq/lol/news.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport iconv from 'iconv-lite';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nimport { type CheerioAPI, load } from 'cheerio';\r\nimport { type Context } from 'hono';\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const { category = 23 } = ctx.req.param();\r\n    const limit: number = Number.parseInt(ctx.req.query('limit') ?? '30', 10);\r\n\r\n    const baseUrl: string = 'https://lol.qq.com';\r\n    const apiBaseUrl: string = 'https://apps.game.qq.com';\r\n    const targetUrl: string = new URL('news/index.shtml', baseUrl).href;\r\n    const apiListUrl: string = new URL('cmc/zmMcnTargetContentList', apiBaseUrl).href;\r\n    const apiInfoUrl: string = new URL('cmc/zmMcnContentInfo', apiBaseUrl).href;\r\n\r\n    const response = await ofetch(apiListUrl, {\r\n        query: {\r\n            page: 1,\r\n            num: limit,\r\n            target: category,\r\n        },\r\n    });\r\n    const targetResponse = await ofetch(targetUrl, {\r\n        responseType: 'arrayBuffer',\r\n    });\r\n\r\n    const $: CheerioAPI = load(iconv.decode(Buffer.from(targetResponse), 'gbk'));\r\n    const language = $('html').attr('lang') ?? 'zh-CN';\r\n\r\n    let items: DataItem[] = [];\r\n\r\n    items = response.data.result.slice(0, limit).map((item): DataItem => {\r\n        const title: string = item.sTitle;\r\n        const pubDate: number | string = item.sCreated;\r\n        const linkUrl: string | undefined = item.iDocID ? `${item.iVideoId ? 'v/v2' : 'news'}/detail.shtml?docid=${item.iDocID}` : undefined;\r\n        const authors: DataItem['author'] = item.sAuthor\r\n            ? [\r\n                  {\r\n                      name: item.sAuthor,\r\n                      avatar: item.sCreaterHeader,\r\n                  },\r\n              ]\r\n            : undefined;\r\n        const guid: string = item.iDocID;\r\n        const image: string | undefined = item.sIMG ? (item.sIMG.startsWith('http') ? item.sIMG : `https:${item.sIMG}`) : undefined;\r\n        const updated: number | string = item.updated ?? pubDate;\r\n\r\n        const processedItem: DataItem = {\r\n            title,\r\n            pubDate: pubDate ? timezone(parseDate(pubDate), +8) : undefined,\r\n            link: linkUrl ? new URL(linkUrl, baseUrl).href : undefined,\r\n            author: authors,\r\n            guid,\r\n            id: guid,\r\n            image,\r\n            banner: image,\r\n            updated: updated ? timezone(parseDate(updated), +8) : undefined,\r\n            language,\r\n        };\r\n\r\n        return processedItem;\r\n    });\r\n\r\n    items = (\r\n        await Promise.all(\r\n            items.map((item) => {\r\n                if (!item.link) {\r\n                    return item;\r\n                }\r\n\r\n                return cache.tryGet(item.link, async (): Promise<DataItem> => {\r\n                    const detailResponse = await ofetch(apiInfoUrl, {\r\n                        query: {\r\n                            type: 0,\r\n                            docid: item.guid,\r\n                        },\r\n                    });\r\n\r\n                    const result = detailResponse?.data?.result ?? undefined;\r\n\r\n                    if (!result) {\r\n                        return item;\r\n                    }\r\n\r\n                    const title: string = result.sTitle;\r\n                    const description: string = result.sContent;\r\n                    const pubDate: number | string = result.sCreated;\r\n                    const linkUrl: string | undefined = result.iDocID ? `${result.iVideoId ? 'v/v2' : 'news'}/detail.shtml?docid=${result.iDocID}` : undefined;\r\n                    const authors: DataItem['author'] = result.sAuthor\r\n                        ? [\r\n                              {\r\n                                  name: result.sAuthor,\r\n                                  avatar: result.sCreaterHeader,\r\n                              },\r\n                          ]\r\n                        : undefined;\r\n                    const guid: string = `qq-lol-${result.iDocID}`;\r\n                    const image: string | undefined = result.sIMG ? (result.sIMG.startsWith('http') ? result.sIMG : `https:${result.sIMG}`) : undefined;\r\n                    const updated: number | string = result.sIdxTime ?? pubDate;\r\n\r\n                    const processedItem: DataItem = {\r\n                        title,\r\n                        description,\r\n                        pubDate: pubDate ? timezone(parseDate(pubDate), +8) : undefined,\r\n                        link: linkUrl ? new URL(linkUrl, baseUrl).href : undefined,\r\n                        author: authors,\r\n                        guid,\r\n                        id: guid,\r\n                        content: {\r\n                            html: description,\r\n                            text: description,\r\n                        },\r\n                        image,\r\n                        banner: image,\r\n                        updated: updated ? timezone(parseDate(updated), +8) : undefined,\r\n                        language,\r\n                    };\r\n\r\n                    return {\r\n                        ...item,\r\n                        ...processedItem,\r\n                    };\r\n                });\r\n            })\r\n        )\r\n    ).filter((_): _ is DataItem => true);\r\n\r\n    return {\r\n        title: `${$('div.website-path a')\r\n            .toArray()\r\n            .map((a) => $(a).text())\r\n            .join('')} - ${$(`li[data-newsId=\"${category}\"]`).text()}`,\r\n        description: $('meta[name=\"Description\"]').attr('content'),\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: `https:${$('a.logo img').attr('src')}`,\r\n        author: $('meta[name=\"author\"]').attr('content'),\r\n        language,\r\n        id: targetUrl,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/lol/news/:category?',\r\n    name: '英雄联盟新闻',\r\n    url: 'lol.qq.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/qq/lol/news',\r\n    parameters: {\r\n        category: '分类，默认为 `23`，即综合，见下表',\r\n    },\r\n    description: `:::tip\r\n若订阅 [英雄联盟首页新闻列表 - 公告](https://lol.qq.com/news/index.shtml)，网址为 \\`https://lol.qq.com/news/index.shtml\\`，请选择 \\`24\\` 作为 \\`category\\` 参数填入，此时目标路由为 [\\`/qq/lol/news/24\\`](https://rsshub.app/qq/lol/news/24)。\r\n:::\r\n\r\n| 综合 | 公告 | 赛事 | 攻略 | 社区 |\r\n| ---- | ---- | ---- | ---- | ---- |\r\n| 23   | 24   | 25   | 27   | 28   |\r\n`,\r\n    categories: ['game'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            title: '综合',\r\n            source: ['lol.qq.com/news/index.shtml'],\r\n            target: '/lol/news/23',\r\n        },\r\n        {\r\n            title: '公告',\r\n            source: ['lol.qq.com/news/index.shtml'],\r\n            target: '/lol/news/24',\r\n        },\r\n        {\r\n            title: '赛事',\r\n            source: ['lol.qq.com/news/index.shtml'],\r\n            target: '/lol/news/25',\r\n        },\r\n        {\r\n            title: '攻略',\r\n            source: ['lol.qq.com/news/index.shtml'],\r\n            target: '/lol/news/27',\r\n        },\r\n        {\r\n            title: '社区',\r\n            source: ['lol.qq.com/news/index.shtml'],\r\n            target: '/lol/news/28',\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n};\r\n"],"mappings":"8aAWA,MAAa,EAAU,KAAO,IAAgC,CAC1D,GAAM,CAAE,WAAW,IAAO,EAAI,IAAI,QAC5BA,EAAgB,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IAEhEC,EAAkB,qBAClBC,EAAqB,2BACrBC,EAAoB,IAAI,IAAI,mBAAoB,GAAS,KACzDC,EAAqB,IAAI,IAAI,6BAA8B,GAAY,KACvEC,EAAqB,IAAI,IAAI,uBAAwB,GAAY,KAEjE,EAAW,MAAMC,EAAO,EAAY,CACtC,MAAO,CACH,KAAM,EACN,IAAK,EACL,OAAQ,KAGV,EAAiB,MAAMA,EAAO,EAAW,CAC3C,aAAc,gBAGZC,EAAgB,EAAK,EAAM,OAAO,OAAO,KAAK,GAAiB,QAC/D,EAAW,EAAE,QAAQ,KAAK,SAAW,QAEvCC,EAAoB,GAkGxB,MAhGA,GAAQ,EAAS,KAAK,OAAO,MAAM,EAAG,GAAO,IAAK,GAAmB,CACjE,IAAMC,EAAgB,EAAK,OACrBC,EAA2B,EAAK,SAChCC,EAA8B,EAAK,OAAS,GAAG,EAAK,SAAW,OAAS,OAAO,sBAAsB,EAAK,SAAW,IAAA,GACrHC,EAA8B,EAAK,QACnC,CACI,CACI,KAAM,EAAK,QACX,OAAQ,EAAK,iBAGrB,IAAA,GACAC,EAAe,EAAK,OACpBC,EAA4B,EAAK,KAAQ,EAAK,KAAK,WAAW,QAAU,EAAK,KAAO,SAAS,EAAK,OAAU,IAAA,GAC5GC,EAA2B,EAAK,SAAW,EAE3CC,EAA0B,CAC5B,QACA,QAAS,EAAU,EAAS,EAAU,GAAU,GAAM,IAAA,GACtD,KAAM,EAAU,IAAI,IAAI,EAAS,GAAS,KAAO,IAAA,GACjD,OAAQ,EACR,OACA,GAAI,EACJ,QACA,OAAQ,EACR,QAAS,EAAU,EAAS,EAAU,GAAU,GAAM,IAAA,GACtD,YAGJ,OAAO,IAGX,GACI,MAAM,QAAQ,IACV,EAAM,IAAK,GACF,EAAK,KAIHC,EAAM,OAAO,EAAK,KAAM,SAA+B,CAC1D,IAAM,EAAiB,MAAMX,EAAO,EAAY,CAC5C,MAAO,CACH,KAAM,EACN,MAAO,EAAK,QAId,EAAS,GAAgB,MAAM,QAAU,IAAA,GAE/C,GAAI,CAAC,EACD,OAAO,EAGX,IAAMG,EAAgB,EAAO,OACvBS,EAAsB,EAAO,SAC7BR,EAA2B,EAAO,SAClCC,EAA8B,EAAO,OAAS,GAAG,EAAO,SAAW,OAAS,OAAO,sBAAsB,EAAO,SAAW,IAAA,GAC3HC,EAA8B,EAAO,QACrC,CACI,CACI,KAAM,EAAO,QACb,OAAQ,EAAO,iBAGvB,IAAA,GACAC,EAAe,UAAU,EAAO,SAChCC,EAA4B,EAAO,KAAQ,EAAO,KAAK,WAAW,QAAU,EAAO,KAAO,SAAS,EAAO,OAAU,IAAA,GACpHC,EAA2B,EAAO,UAAY,EAE9CC,EAA0B,CAC5B,QACA,cACA,QAAS,EAAU,EAAS,EAAU,GAAU,GAAM,IAAA,GACtD,KAAM,EAAU,IAAI,IAAI,EAAS,GAAS,KAAO,IAAA,GACjD,OAAQ,EACR,OACA,GAAI,EACJ,QAAS,CACL,KAAM,EACN,KAAM,GAEV,QACA,OAAQ,EACR,QAAS,EAAU,EAAS,EAAU,GAAU,GAAM,IAAA,GACtD,YAGJ,MAAO,CACH,GAAG,EACH,GAAG,KArDA,KA0DrB,OAAQ,GAAqB,IAExB,CACH,MAAO,GAAG,EAAE,sBACP,UACA,IAAK,GAAM,EAAE,GAAG,QAChB,KAAK,IAAI,KAAK,EAAE,mBAAmB,EAAS,KAAK,SACtD,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,EACN,KAAM,EACN,WAAY,GACZ,MAAO,SAAS,EAAE,cAAc,KAAK,SACrC,OAAQ,EAAE,uBAAuB,KAAK,WACtC,WACA,GAAI,IAICG,EAAe,CACxB,KAAM,uBACN,KAAM,SACN,IAAK,aACL,YAAa,CAAC,WACd,UACA,QAAS,eACT,WAAY,CACR,SAAU,uBAEd,YAAa,4TAQb,WAAY,CAAC,QACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,MAAO,KACP,OAAQ,CAAC,+BACT,OAAQ,gBAEZ,CACI,MAAO,KACP,OAAQ,CAAC,+BACT,OAAQ,gBAEZ,CACI,MAAO,KACP,OAAQ,CAAC,+BACT,OAAQ,gBAEZ,CACI,MAAO,KACP,OAAQ,CAAC,+BACT,OAAQ,gBAEZ,CACI,MAAO,KACP,OAAQ,CAAC,+BACT,OAAQ,iBAGhB,KAAM,EAAS"}