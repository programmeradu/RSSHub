{"version":3,"file":"news-Cul2sOvq.js","names":["route: Route","ofetch","list: DataItem[]","cache"],"sources":["../../lib/routes/samd/news.ts"],"sourcesContent":["import { Route, DataItem } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { load } from 'cheerio';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nconst dict = { '434': '行业资讯', '436': '协会动态', '438': '重要通知', '440': '政策法规' };\r\n\r\nexport const route: Route = {\r\n    path: '/news/:typeId',\r\n    categories: ['government'],\r\n    example: '/samd/news/440',\r\n    parameters: { type: '文章类型ID，见下表' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    description: `| 行业资讯 | 协会动态 | 重要通知 | 政策法规 |\r\n| --- | --- | --- | --- |\r\n| 434 | 436 | 438 | 440 |`,\r\n    name: '资讯信息',\r\n    maintainers: ['hualiong'],\r\n    handler: async (ctx) => {\r\n        const baseURL = 'https://www.samd.org.cn/home';\r\n        const typeId = ctx.req.param('typeId');\r\n\r\n        const { rows } = await ofetch('/GetNewsByTagId', {\r\n            baseURL,\r\n            method: 'POST',\r\n            query: {\r\n                page: 1,\r\n                rows: 10,\r\n                typeId,\r\n                status: 1,\r\n            },\r\n        });\r\n\r\n        const list: DataItem[] = rows.map((row) => ({\r\n            title: row.title,\r\n            category: [row.tag_names],\r\n            link: `${baseURL}/newsDetail?id=${row.auto_id}&typeId=${typeId}`,\r\n            image: row.img_url ? baseURL + row.img_url : null,\r\n        }));\r\n\r\n        const items = await Promise.all(\r\n            list.map((item) =>\r\n                cache.tryGet(item.link!, async () => {\r\n                    const $ = load(await ofetch(item.link!));\r\n\r\n                    const content = $('.content');\r\n                    item.author = content.find('.author span').text();\r\n                    item.pubDate = timezone(parseDate(content.find('.time').text(), '发布时间：YYYY-MM-DD HH:mm:ss'), +8);\r\n\r\n                    content.children('.titles').remove();\r\n                    content.children('.auxi').remove();\r\n                    item.description = content.html()!;\r\n\r\n                    return item;\r\n                })\r\n            )\r\n        );\r\n\r\n        return {\r\n            title: `${dict[typeId]} - 深圳市医疗器械行业协会`,\r\n            link: 'https://www.samd.org.cn/home/newsList',\r\n            item: items as DataItem[],\r\n        };\r\n    },\r\n};\r\n"],"mappings":"qWAOA,MAAM,EAAO,CAAE,IAAO,OAAQ,IAAO,OAAQ,IAAO,OAAQ,IAAO,QAEtDA,EAAe,CACxB,KAAM,gBACN,WAAY,CAAC,cACb,QAAS,iBACT,WAAY,CAAE,KAAM,cACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,YAAa;;2BAGb,KAAM,OACN,YAAa,CAAC,YACd,QAAS,KAAO,IAAQ,CACpB,IAAM,EAAU,+BACV,EAAS,EAAI,IAAI,MAAM,UAEvB,CAAE,QAAS,MAAMC,EAAO,kBAAmB,CAC7C,UACA,OAAQ,OACR,MAAO,CACH,KAAM,EACN,KAAM,GACN,SACA,OAAQ,KAIVC,EAAmB,EAAK,IAAK,IAAS,CACxC,MAAO,EAAI,MACX,SAAU,CAAC,EAAI,WACf,KAAM,GAAG,EAAQ,iBAAiB,EAAI,QAAQ,UAAU,IACxD,MAAO,EAAI,QAAU,EAAU,EAAI,QAAU,QAG3C,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAO,SAAY,CACjC,IAAM,EAAI,EAAK,MAAMF,EAAO,EAAK,OAE3B,EAAU,EAAE,YAQlB,MAPA,GAAK,OAAS,EAAQ,KAAK,gBAAgB,OAC3C,EAAK,QAAU,EAAS,EAAU,EAAQ,KAAK,SAAS,OAAQ,4BAA6B,GAE7F,EAAQ,SAAS,WAAW,SAC5B,EAAQ,SAAS,SAAS,SAC1B,EAAK,YAAc,EAAQ,OAEpB,MAKnB,MAAO,CACH,MAAO,GAAG,EAAK,GAAQ,gBACvB,KAAM,wCACN,KAAM"}