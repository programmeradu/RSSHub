{"version":3,"file":"viewpoint-DHFqgOOg.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/chinathinktanks/viewpoint.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate, parseRelativeDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { CookieJar } from 'tough-cookie';\r\n\r\nconst cookieJar = new CookieJar();\r\nconst baseUrl = 'https://www.chinathinktanks.org.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/:id',\r\n    categories: ['study'],\r\n    example: '/chinathinktanks/57',\r\n    parameters: { id: '见下表，亦可在网站 url 里找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '观点与实践',\r\n    maintainers: ['Aeliu'],\r\n    handler,\r\n    description: `| \\`:id\\` | 专题名称 |\r\n| ----- | -------- |\r\n| 2     | 党的建设 |\r\n| 3     | 社会     |\r\n| 4     | 生态     |\r\n| 5     | 政治     |\r\n| 6     | 经济     |\r\n| 7     | 文化     |\r\n| 9     | 热点专题 |\r\n| 10    | 国际关系 |\r\n| 13    | 国外智库 |\r\n| 46    | 智库报告 |\r\n| 57    | 智库要闻 |\r\n| 126   | 世界经济 |\r\n| 127   | 宏观经济 |\r\n| 128   | 区域经济 |\r\n| 129   | 产业企业 |\r\n| 130   | 三农问题 |\r\n| 131   | 财政金融 |\r\n| 132   | 科技创新 |\r\n| 133   | 民主     |\r\n| 134   | 法治     |\r\n| 135   | 行政     |\r\n| 136   | 国家治理 |\r\n| 137   | 社会事业 |\r\n| 138   | 社会保障 |\r\n| 139   | 民族宗教 |\r\n| 140   | 人口就业 |\r\n| 141   | 社会治理 |\r\n| 142   | 文化产业 |\r\n| 143   | 公共文化 |\r\n| 144   | 文化体制 |\r\n| 145   | 文化思想 |\r\n| 146   | 资源     |\r\n| 147   | 能源     |\r\n| 148   | 环境     |\r\n| 149   | 生态文明 |\r\n| 150   | 思想建设 |\r\n| 151   | 作风建设 |\r\n| 152   | 组织建设 |\r\n| 153   | 制度建设 |\r\n| 154   | 反腐倡廉 |\r\n| 155   | 中国外交 |\r\n| 156   | 全球治理 |\r\n| 157   | 大国关系 |\r\n| 158   | 地区政治 |\r\n| 181   | 执政能力 |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const link = `https://www.chinathinktanks.org.cn/content/list?id=${ctx.req.param('id')}&pt=1`;\r\n\r\n    const response = await got(link, {\r\n        cookieJar,\r\n    });\r\n    const $ = load(response.data);\r\n\r\n    let items = $('.main-content-left-list-item')\r\n        .toArray()\r\n        .map((e) => {\r\n            e = $(e);\r\n            return {\r\n                title: e.find('.title span').text(),\r\n                link: baseUrl + e.attr('href'),\r\n                author: e.find('.author-by span').text(),\r\n                pubDate: e.find('.author-time').text(),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await got({\r\n                    url: item.link,\r\n                    cookieJar,\r\n                });\r\n                const $ = load(response.data);\r\n                const content = $('#art');\r\n                item.description = content.html();\r\n                item.pubDate = item.pubDate.includes('-') ? timezone(parseDate(item.pubDate, 'YYYY-MM-DD'), +8) : parseRelativeDate(item.pubDate);\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `中国智库网 —— ${$('title').text().split('_中国智库网')[0]}`,\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0dAQA,MAAM,EAAY,IAAI,EAGTA,EAAe,CACxB,KAAM,OACN,WAAY,CAAC,SACb,QAAS,sBACT,WAAY,CAAE,GAAI,qBAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,QACN,YAAa,CAAC,SACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;mBAiDjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,sDAAsD,EAAI,IAAI,MAAM,MAAM,OAEjF,EAAW,MAAMC,EAAI,EAAM,CAC7B,cAEE,EAAI,EAAK,EAAS,MAEpB,EAAQ,EAAE,gCACT,UACA,IAAK,IACF,EAAI,EAAE,GACC,CACH,MAAO,EAAE,KAAK,eAAe,OAC7B,KAAM,qCAAU,EAAE,KAAK,QACvB,OAAQ,EAAE,KAAK,mBAAmB,OAClC,QAAS,EAAE,KAAK,gBAAgB,UAqB5C,MAjBA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAW,MAAMF,EAAI,CACvB,IAAK,EAAK,KACV,cAEEG,EAAI,EAAKD,EAAS,MAClB,EAAUC,EAAE,QAIlB,MAHA,GAAK,YAAc,EAAQ,OAC3B,EAAK,QAAU,EAAK,QAAQ,SAAS,KAAO,EAAS,EAAU,EAAK,QAAS,cAAe,GAAM,EAAkB,EAAK,SAElH,MAKZ,CACH,MAAO,YAAY,EAAE,SAAS,OAAO,MAAM,UAAU,KACrD,OACA,KAAM"}