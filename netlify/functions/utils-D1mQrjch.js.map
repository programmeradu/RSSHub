{"version":3,"file":"utils-D1mQrjch.js","names":[],"sources":["../../lib/routes/caareviews/utils.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst rootUrl = 'http://www.caareviews.org';\r\n\r\nconst getList = async (url) => {\r\n    const response = await got(url);\r\n    const $ = load(response.data);\r\n    const list = $('#infinite-content > div')\r\n        .toArray()\r\n        .map((item) => ({\r\n            title: $(item).find('div.title').text().trim(),\r\n            link: new URL($(item).find('div.title > em > a').attr('href'), rootUrl).href,\r\n            author: $(item).find('div.contributors').text().trim(),\r\n        }));\r\n\r\n    return list;\r\n};\r\n\r\nconst getItems = (ctx, list) =>\r\n    Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got(item.link);\r\n                const $ = load(detailResponse.data);\r\n\r\n                const coverUrl = new URL($('div.cover > a').attr('href'), rootUrl).href;\r\n                const content = $('div.content.full-review').html();\r\n                item.description = art(path.join(__dirname, 'templates/utils.art'), {\r\n                    coverUrl,\r\n                    content,\r\n                });\r\n                $('div.review_heading').remove();\r\n                item.pubDate = parseDate($('div.header-text > div.clearfix').text());\r\n                item.doi = $('div.crossref > a').attr('href').replace('http://dx.doi.org/', '');\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\nexport { rootUrl, getList, getItems };\r\n"],"mappings":"wUAOA,MAAM,EAAU,4BAEV,EAAU,KAAO,IAAQ,CAC3B,IAAM,EAAW,MAAM,EAAI,GACrB,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,2BACV,UACA,IAAK,IAAU,CACZ,MAAO,EAAE,GAAM,KAAK,aAAa,OAAO,OACxC,KAAM,IAAI,IAAI,EAAE,GAAM,KAAK,sBAAsB,KAAK,QAAS,GAAS,KACxE,OAAQ,EAAE,GAAM,KAAK,oBAAoB,OAAO,UAGxD,OAAO,GAGL,GAAY,EAAK,IACnB,QAAQ,IACJ,EAAK,IAAK,GACN,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAM,EAAI,EAAK,MAChC,EAAI,EAAK,EAAe,MAExB,EAAW,IAAI,IAAI,EAAE,iBAAiB,KAAK,QAAS,GAAS,KAC7D,EAAU,EAAE,2BAA2B,OAS7C,MARA,GAAK,YAAc,EAAI,EAAA,KAAA,EAAA,gCAA6C,CAChE,WACA,YAEJ,EAAE,sBAAsB,SACxB,EAAK,QAAU,EAAU,EAAE,kCAAkC,QAC7D,EAAK,IAAM,EAAE,oBAAoB,KAAK,QAAQ,QAAQ,qBAAsB,IAErE"}