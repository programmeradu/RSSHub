{"version":3,"file":"utils-CHq1mGTi.js","names":[],"sources":["../../lib/routes/4gamers/utils.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nconst getCategories = (tryGet) =>\r\n    tryGet('4gamers:categories', async () => {\r\n        const { data: response } = await got('https://www.4gamers.com.tw/site/api/news/category');\r\n\r\n        return response.data.map((category) => ({\r\n            id: category.id,\r\n            name: category.name,\r\n        }));\r\n    });\r\n\r\nconst parseList = (results) =>\r\n    results.map((item) => ({\r\n        title: item.title,\r\n        author: item.author.nickname,\r\n        intro: item.intro,\r\n        pubDate: parseDate(item.createPublishedAt, 'x'),\r\n        link: item.canonicalUrl,\r\n        category: [...new Set([item.category.name, ...item.tags])],\r\n        articleId: item.id,\r\n    }));\r\n\r\nconst parseItem = async (item) => {\r\n    const { data: response } = await got('https://www.4gamers.com.tw/site/api/news/find-section', {\r\n        searchParams: {\r\n            sub: item.articleId,\r\n        },\r\n    });\r\n\r\n    item.description = renderDescription(\r\n        item.intro,\r\n        response.data.contentSection.sections\r\n            .map((section) => {\r\n                switch (section['@type']) {\r\n                    case 'ContentAdsSection':\r\n                    case 'ScrollerAdsSection':\r\n                    case 'textScrollerAdsSection':\r\n                        return '';\r\n                    case 'RawHtmlSection':\r\n                        return section.html;\r\n                    case 'ImageGroupSection':\r\n                        return renderImages(section.items);\r\n                    default:\r\n                        throw new InvalidParameterError(`Unhandled section type: ${section['@type']} on ${item.link}`);\r\n                }\r\n            })\r\n            .join('')\r\n    );\r\n\r\n    return item;\r\n};\r\n\r\nconst renderDescription = (intro, content) =>\r\n    art(path.join(__dirname, 'templates/description.art'), {\r\n        intro,\r\n        content,\r\n    });\r\nconst renderImages = (images) =>\r\n    art(path.join(__dirname, 'templates/image.art'), {\r\n        images,\r\n    });\r\n\r\nexport { getCategories, parseList, parseItem, renderDescription, renderImages };\r\n"],"mappings":"iUAMA,MAAM,EAAiB,GACnB,EAAO,qBAAsB,SAAY,CACrC,GAAM,CAAE,KAAM,GAAa,MAAM,EAAI,qDAErC,OAAO,EAAS,KAAK,IAAK,IAAc,CACpC,GAAI,EAAS,GACb,KAAM,EAAS,UAIrB,EAAa,GACf,EAAQ,IAAK,IAAU,CACnB,MAAO,EAAK,MACZ,OAAQ,EAAK,OAAO,SACpB,MAAO,EAAK,MACZ,QAAS,EAAU,EAAK,kBAAmB,KAC3C,KAAM,EAAK,aACX,SAAU,CAAC,GAAG,IAAI,IAAI,CAAC,EAAK,SAAS,KAAM,GAAG,EAAK,QACnD,UAAW,EAAK,MAGlB,EAAY,KAAO,IAAS,CAC9B,GAAM,CAAE,KAAM,GAAa,MAAM,EAAI,wDAAyD,CAC1F,aAAc,CACV,IAAK,EAAK,aAwBlB,MApBA,GAAK,YAAc,EACf,EAAK,MACL,EAAS,KAAK,eAAe,SACxB,IAAK,GAAY,CACd,OAAQ,EAAQ,SAAhB,CACI,IAAK,oBACL,IAAK,qBACL,IAAK,yBACD,MAAO,GACX,IAAK,iBACD,OAAO,EAAQ,KACnB,IAAK,oBACD,OAAO,EAAa,EAAQ,OAChC,QACI,MAAM,IAAI,EAAsB,2BAA2B,EAAQ,SAAS,MAAM,EAAK,WAGlG,KAAK,KAGP,GAGL,GAAqB,EAAO,IAC9B,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACnD,QACA,YAEF,EAAgB,GAClB,EAAI,EAAA,KAAA,EAAA,gCAA6C,CAC7C"}