import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import"./ofetch-Bzt0BXUH.js";import{got_default as e}from"./got-CdvI2yKX.js";import*as t from"node:url";import{load as n}from"cheerio";const r={path:`/iap/:country/:id`,categories:[`program-update`],example:`/appstore/iap/us/id953286746`,parameters:{country:"App Store Country, obtain from the app URL https://apps.apple.com/us/app/id953286746, in this case, `us`",id:"App Store app id, obtain from the app URL https://apps.apple.com/us/app/id953286746, in this case, `id953286746`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`In-App-Purchase Price Drop Alert`,maintainers:[`HenryQW`],handler:i};async function i(r){let i=r.req.param(`country`),a=r.req.param(`id`),o=`https://apps.apple.com/${i}/app/${a}`,s=t.resolve(o,`?mt=8#see-all/in-app-purchases`),c=await e.get(s),l=n(c.data),u=l(`html`).attr(`lang`),d=(await e({method:`get`,url:`https://amp-api.apps.apple.com/v1/catalog/${i}/apps/${a.replace(`id`,``)}?platform=web&include=Cmerchandised-in-apps%2Ctop-in-apps%2Ceula&l=${u}`,headers:{authorization:`Bearer eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IkNSRjVITkJHUFEifQ.eyJpc3MiOiI4Q1UyNk1LTFM0IiwiaWF0IjoxNjA3MDMxMTcwLCJleHAiOjE2MTAwNTUxNzB9.qzq2PKkPBNDwHbShoBY3T7J2IjgWsR_MyAvTnZtQB5FZjsH_ZY5esBa0qXbA9kUiq_90GkRoNVMR03meOQQ7SQ`,authority:`amp-api.apps.apple.com`,referer:s}})).data.data[0],f=d.attributes,p=f.name,m=f.deviceFamilies.includes(`mac`)?`macOS`:`iOS`,h,g=[],_=d.relationships[`top-in-apps`].data;return _&&(h=`${i===`cn`?`内购限免提醒`:`IAP price watcher`}: ${p} for ${m}`,g=_.map(e=>{let t=`${e.attributes.name} is now ${e.attributes.offers[0].priceFormatted}`,n={link:o,guid:e.attributes.url,description:e.attributes.artwork?e.attributes.description.standard+`<br><img src=${e.attributes.artwork.url.replace(`{w}x{h}{c}.{f}`,`320x0w.jpg`)}>`:e.attributes.description.standard,title:t,pubDate:new Date().toUTCString()};return n})),{title:h,link:o,item:g}}export{r as route};
//# sourceMappingURL=in-app-purchase-C619lx22.js.map