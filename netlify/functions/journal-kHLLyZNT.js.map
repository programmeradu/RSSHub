{"version":3,"file":"journal-kHLLyZNT.js","names":[],"sources":["../../lib/routes/ieee/journal.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\n\r\nconst ieeeHost = 'https://ieeexplore.ieee.org';\r\n\r\nexport const route: Route = {\r\n    name: 'IEEE Journal Articles',\r\n    maintainers: ['HenryQW'],\r\n    categories: ['journal'],\r\n    path: '/journal/:punumber/:earlyAccess?',\r\n    parameters: {\r\n        punumber: 'Publication Number, look for `punumber` in the URL',\r\n        earlyAccess: 'Optional, set any value to get early access articles',\r\n    },\r\n    example: '/ieee/journal/6287639/preprint',\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const publicationNumber = ctx.req.param('punumber');\r\n    const earlyAccess = !!ctx.req.param('earlyAccess');\r\n\r\n    const metadata = await fetchMetadata(publicationNumber);\r\n    const { displayTitle, currentIssue, preprintIssue, coverImagePath } = metadata;\r\n    const { issueNumber, volume } = earlyAccess ? preprintIssue : currentIssue;\r\n\r\n    const tocData = await fetchTOCData(publicationNumber, issueNumber);\r\n    const list = tocData.records.map((item) => {\r\n        const mappedItem = mapRecordToItem(volume)(item);\r\n\r\n        mappedItem.description = art(path.join(__dirname, 'templates/description.art'), {\r\n            item: mappedItem,\r\n        });\r\n\r\n        return mappedItem;\r\n    });\r\n\r\n    return {\r\n        title: displayTitle,\r\n        link: `${ieeeHost}/xpl/tocresult.jsp?isnumber=${issueNumber}`,\r\n        item: list,\r\n        image: `${ieeeHost}${coverImagePath}`,\r\n    };\r\n}\r\n\r\nasync function fetchMetadata(punumber) {\r\n    const response = await got(`${ieeeHost}/rest/publication/home/metadata?pubid=${punumber}`);\r\n    return response.data;\r\n}\r\n\r\nasync function fetchTOCData(punumber, isnumber) {\r\n    const response = await got.post(`${ieeeHost}/rest/search/pub/${punumber}/issue/${isnumber}/toc`, {\r\n        json: { punumber, isnumber, rowsPerPage: '100' },\r\n    });\r\n    return response.data;\r\n}\r\n\r\nfunction mapRecordToItem(volume) {\r\n    return (item) => ({\r\n        abstract: item.abstract || '',\r\n        authors: item.authors ? item.authors.map((author) => author.preferredName).join('; ') : '',\r\n        description: '',\r\n        doi: item.doi,\r\n        link: item.htmlLink,\r\n        title: item.articleTitle || '',\r\n        volume,\r\n    });\r\n}\r\n"],"mappings":"gVAMA,MAAM,EAAW,8BAEJ,EAAe,CACxB,KAAM,wBACN,YAAa,CAAC,WACd,WAAY,CAAC,WACb,KAAM,mCACN,WAAY,CACR,SAAU,qDACV,YAAa,wDAEjB,QAAS,iCACT,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAoB,EAAI,IAAI,MAAM,YAClC,EAAc,CAAC,CAAC,EAAI,IAAI,MAAM,eAE9B,EAAW,MAAM,EAAc,GAC/B,CAAE,eAAc,eAAc,gBAAe,kBAAmB,EAChE,CAAE,cAAa,UAAW,EAAc,EAAgB,EAExD,EAAU,MAAM,EAAa,EAAmB,GAChD,EAAO,EAAQ,QAAQ,IAAK,GAAS,CACvC,IAAM,EAAa,EAAgB,GAAQ,GAM3C,MAJA,GAAW,YAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAC5E,KAAM,IAGH,IAGX,MAAO,CACH,MAAO,EACP,KAAM,GAAG,EAAS,8BAA8B,IAChD,KAAM,EACN,MAAO,GAAG,IAAW,KAI7B,eAAe,EAAc,EAAU,CACnC,IAAM,EAAW,MAAM,EAAI,GAAG,EAAS,wCAAwC,KAC/E,OAAO,EAAS,KAGpB,eAAe,EAAa,EAAU,EAAU,CAC5C,IAAM,EAAW,MAAM,EAAI,KAAK,GAAG,EAAS,mBAAmB,EAAS,SAAS,EAAS,MAAO,CAC7F,KAAM,CAAE,WAAU,WAAU,YAAa,SAE7C,OAAO,EAAS,KAGpB,SAAS,EAAgB,EAAQ,CAC7B,MAAQ,KAAU,CACd,SAAU,EAAK,UAAY,GAC3B,QAAS,EAAK,QAAU,EAAK,QAAQ,IAAK,GAAW,EAAO,eAAe,KAAK,MAAQ,GACxF,YAAa,GACb,IAAK,EAAK,IACV,KAAM,EAAK,SACX,MAAO,EAAK,cAAgB,GAC5B"}