{"version":3,"file":"news-D5hTlkae.js","names":["route: Route","ofetch","data: NewsItem[]"],"sources":["../../lib/routes/aibase/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\nimport { rootUrl, buildApiUrl } from './util';\r\n\r\nexport const route: Route = {\r\n    path: '/news',\r\n    name: '资讯',\r\n    url: 'www.aibase.com',\r\n    maintainers: ['zreo0'],\r\n    handler: async (ctx) => {\r\n        // 每页数量限制\r\n        const limit = Number.parseInt(ctx.req.query('limit') ?? '30', 10);\r\n        // 用项目中已有的获取页面方法，获取页面以及 Token\r\n        const currentUrl = new URL('discover', rootUrl).href;\r\n        const currentHtml = await ofetch(currentUrl);\r\n        const $ = load(currentHtml);\r\n        const logoSrc = $('img.logo').prop('src');\r\n        const image = logoSrc ? new URL(logoSrc, rootUrl).href : '';\r\n        const author = $('title').text().split(/_/).pop();\r\n        const { apiInfoListUrl } = await buildApiUrl($);\r\n        // 获取资讯列表，解析数据\r\n        const data: NewsItem[] = await ofetch(apiInfoListUrl, {\r\n            headers: {\r\n                accept: 'application/json;charset=utf-8',\r\n            },\r\n            query: {\r\n                pagesize: limit,\r\n                page: 1,\r\n                type: 1,\r\n                isen: 0,\r\n            },\r\n        });\r\n        const items = data.map((item) => ({\r\n            // 文章标题\r\n            title: item.title,\r\n            // 文章链接\r\n            link: `https://www.aibase.com/zh/news/${item.Id}`,\r\n            // 文章正文\r\n            description: item.summary,\r\n            // 文章发布日期\r\n            pubDate: parseDate(item.addtime),\r\n            // 文章作者\r\n            author: item.author || 'AI Base',\r\n        }));\r\n\r\n        return {\r\n            title: 'AI新闻资讯',\r\n            description: 'AI新闻资讯 - 不错过全球AI革新的每一个时刻',\r\n            language: 'zh-cn',\r\n            link: 'https://www.aibase.com/zh/news',\r\n            item: items,\r\n            allowEmpty: true,\r\n            image,\r\n            author,\r\n        };\r\n    },\r\n    example: '/aibase/news',\r\n    description: '获取 AI 资讯列表',\r\n    categories: ['new-media'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.aibase.com/zh/news'],\r\n            target: '/news',\r\n        },\r\n    ],\r\n};\r\n\r\n/** API 返回的资讯结构 */\r\ninterface NewsItem {\r\n    /** 文章 ID */\r\n    Id: number;\r\n    /** 文章标题 */\r\n    title: string;\r\n    /** 文章副标题 */\r\n    subtitle: string;\r\n    /** 文章简要描述 */\r\n    description: string;\r\n    /** 文章主图 */\r\n    thumb: string;\r\n    classname: string;\r\n    /** 正文总结 */\r\n    summary: string;\r\n    /** 标签，字符串，样例：[\\\"人工智能\\\",\\\"Hingham高中\\\"] */\r\n    tags: string;\r\n    /** 可能是来源 */\r\n    sourcename: string;\r\n    /** 作者 */\r\n    author: string;\r\n    status: number;\r\n    url: string;\r\n    type: number;\r\n    added: number;\r\n    /** 添加时间 */\r\n    addtime: string;\r\n    /** 更新时间 */\r\n    upded: number;\r\n    updtime: string;\r\n    isshoulu: number;\r\n    vurl: string;\r\n    vsize: number;\r\n    weight: number;\r\n    isailog: number;\r\n    sites: string;\r\n    categrates: string;\r\n    /** 访问量 */\r\n    pv: number;\r\n}\r\n"],"mappings":"yXAMA,MAAaA,EAAe,CACxB,KAAM,QACN,KAAM,KACN,IAAK,iBACL,YAAa,CAAC,SACd,QAAS,KAAO,IAAQ,CAEpB,IAAM,EAAQ,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IAExD,EAAa,IAAI,IAAI,WAAY,GAAS,KAC1C,EAAc,MAAMC,EAAO,GAC3B,EAAI,EAAK,GACT,EAAU,EAAE,YAAY,KAAK,OAC7B,EAAQ,EAAU,IAAI,IAAI,EAAS,GAAS,KAAO,GACnD,EAAS,EAAE,SAAS,OAAO,MAAM,KAAK,MACtC,CAAE,kBAAmB,MAAM,EAAY,GAEvCC,EAAmB,MAAMD,EAAO,EAAgB,CAClD,QAAS,CACL,OAAQ,kCAEZ,MAAO,CACH,SAAU,EACV,KAAM,EACN,KAAM,EACN,KAAM,KAGR,EAAQ,EAAK,IAAK,IAAU,CAE9B,MAAO,EAAK,MAEZ,KAAM,kCAAkC,EAAK,KAE7C,YAAa,EAAK,QAElB,QAAS,EAAU,EAAK,SAExB,OAAQ,EAAK,QAAU,aAG3B,MAAO,CACH,MAAO,SACP,YAAa,2BACb,SAAU,QACV,KAAM,iCACN,KAAM,EACN,WAAY,GACZ,QACA,WAGR,QAAS,eACT,YAAa,aACb,WAAY,CAAC,aACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,0BACT,OAAQ"}