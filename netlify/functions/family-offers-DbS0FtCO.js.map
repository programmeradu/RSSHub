{"version":3,"file":"family-offers-DbS0FtCO.js","names":["got","route: Route","products"],"sources":["../../lib/routes/ikea/cn/family-offers.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { generateProductItem } from './utils';\r\n\r\nconst familyPriceProductsRequest = ({ pageIndex = 1 }) =>\r\n    got({\r\n        method: 'post',\r\n        url: 'https://www.ikea.cn/api-host/search/prod/advanced/special',\r\n        headers: {\r\n            'X-Client-Platform': 'PcWeb',\r\n        },\r\n        json: {\r\n            contentType: 'PRODUCT,CONTENT,PLANNER',\r\n            filters: {\r\n                filters: {},\r\n                sortOption: 'RELEVANCE',\r\n            },\r\n            pageIndex,\r\n            pageSize: 25,\r\n            pageType: '',\r\n            queryContent: 'family_price',\r\n        },\r\n    });\r\n\r\nconst productRequest = async (productIds) => {\r\n    const response = await got({\r\n        url: 'https://www.ikea.cn/api-host/content/products',\r\n        headers: {\r\n            'X-Client-Platform': 'PcWeb',\r\n        },\r\n        searchParams: new URLSearchParams(productIds),\r\n    });\r\n    return response.data;\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/cn/family_offers',\r\n    categories: ['shopping'],\r\n    example: '/ikea/cn/family_offers',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['ikea.cn/cn/zh/offers/family-offers', 'ikea.cn/'],\r\n        },\r\n    ],\r\n    name: '中国 - 会员特惠',\r\n    maintainers: ['jzhangdev'],\r\n    handler,\r\n    url: 'ikea.cn/cn/zh/offers/family-offers',\r\n};\r\n\r\nasync function handler() {\r\n    const familyPriceProductIds = [];\r\n    const productRequests = [];\r\n\r\n    const familyPriceProductsLoadMore = async ({ pageIndex }) => {\r\n        const response = await familyPriceProductsRequest({ pageIndex });\r\n        const {\r\n            data: { productPage, products },\r\n        } = response.data;\r\n\r\n        for (const { id } of products) {\r\n            familyPriceProductIds.push(['ids', id]);\r\n        }\r\n\r\n        if (productPage.end < productPage.total) {\r\n            await familyPriceProductsLoadMore({ pageIndex: pageIndex + 1 });\r\n        }\r\n        return;\r\n    };\r\n\r\n    await familyPriceProductsLoadMore({ pageIndex: 1 });\r\n\r\n    while (familyPriceProductIds.length) {\r\n        productRequests.push(productRequest(familyPriceProductIds.splice(0, 25)));\r\n    }\r\n\r\n    const productResponses = await Promise.all(productRequests);\r\n    const products = productResponses.flat();\r\n\r\n    return {\r\n        title: 'IKEA 宜家 - 会员特惠',\r\n        link: 'https://www.ikea.cn/cn/zh/offers/family-offers/',\r\n        description: '会员特惠',\r\n        item: products.map((element) => generateProductItem(element)),\r\n    };\r\n}\r\n"],"mappings":"iVAIA,MAAM,GAA8B,CAAE,YAAY,KAC9CA,EAAI,CACA,OAAQ,OACR,IAAK,4DACL,QAAS,CACL,oBAAqB,SAEzB,KAAM,CACF,YAAa,0BACb,QAAS,CACL,QAAS,GACT,WAAY,aAEhB,YACA,SAAU,GACV,SAAU,GACV,aAAc,kBAIpB,EAAiB,KAAO,IAAe,CACzC,IAAM,EAAW,MAAMA,EAAI,CACvB,IAAK,gDACL,QAAS,CACL,oBAAqB,SAEzB,aAAc,IAAI,gBAAgB,KAEtC,OAAO,EAAS,MAGPC,EAAe,CACxB,KAAM,oBACN,WAAY,CAAC,YACb,QAAS,yBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,qCAAsC,cAGvD,KAAM,YACN,YAAa,CAAC,aACd,UACA,IAAK,sCAGT,eAAe,GAAU,CACrB,IAAM,EAAwB,GACxB,EAAkB,GAElB,EAA8B,MAAO,CAAE,eAAgB,CACzD,IAAM,EAAW,MAAM,EAA2B,CAAE,cAC9C,CACF,KAAM,CAAE,cAAa,SAAA,IACrB,EAAS,KAEb,IAAK,GAAM,CAAE,QAAQC,EACjB,EAAsB,KAAK,CAAC,MAAO,IAGnC,EAAY,IAAM,EAAY,OAC9B,MAAM,EAA4B,CAAE,UAAW,EAAY,KAOnE,IAFA,MAAM,EAA4B,CAAE,UAAW,IAExC,EAAsB,QACzB,EAAgB,KAAK,EAAe,EAAsB,OAAO,EAAG,MAGxE,IAAM,EAAmB,MAAM,QAAQ,IAAI,GACrC,EAAW,EAAiB,OAElC,MAAO,CACH,MAAO,iBACP,KAAM,kDACN,YAAa,OACb,KAAM,EAAS,IAAK,GAAY,EAAoB"}