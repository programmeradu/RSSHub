{"version":3,"file":"info-CObAFbie.js","names":[],"sources":["../../lib/routes/yoasobi-music/info.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { parseJSONP } from './jsonp-helper';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/info/:category?',\r\n    categories: ['live'],\r\n    example: '/yoasobi-music/info/news',\r\n    parameters: { category: '`news`, `biography`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.yoasobi-music.jp/', 'www.yoasobi-music.jp/:category'],\r\n            target: '/info/:category',\r\n        },\r\n    ],\r\n    name: 'News & Biography',\r\n    maintainers: [],\r\n    handler,\r\n    url: 'www.yoasobi-music.jp/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category');\r\n\r\n    const ARTIST = 'YOASOBI',\r\n        SONYJPURL = 'https://www.sonymusic.co.jp',\r\n        BASEURL = 'https://www.sonymusic.co.jp/json/v2/artist',\r\n        POSTFIX = category === 'news' ? 'start/0/count/-1' : 'start/0/count/-1/callback/hotCallback';\r\n\r\n    const officialUrl = `https://www.yoasobi-music.jp/${category}`;\r\n    const api = `${BASEURL}/${ARTIST}/${category === 'news' ? 'information' : 'hottopic'}/${POSTFIX}`;\r\n    const title = `LATEST ${category.toUpperCase()}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: api,\r\n    });\r\n\r\n    const data = parseJSONP(response.data).items.map((item) => {\r\n        const isBio = category === 'biography';\r\n        const randomEmoji = (() => {\r\n            const emojis = ['㊗️', '🎉', '🎊', '🎈', '🎁', '🎂', '🎀', '🎗', '🎆', '🎇', '🎐', '🎑', '🎃'];\r\n            return emojis[Math.floor(Math.random() * emojis.length)];\r\n        })();\r\n\r\n        return {\r\n            id: isBio ? null : item.id,\r\n            guid: isBio ? `bio:${item.url}` : `news:${item.title}${item.date}`,\r\n            title: isBio ? `${randomEmoji} ${item.url}` : item.title,\r\n            category: item.category ?? 'Achievement',\r\n            date: isBio ? item.url : item.date,\r\n            description: isBio ? item.kiji : item.article,\r\n            image: isBio ? (item.image_url === '' ? null : `${SONYJPURL}${item.image_url}`) : null,\r\n        };\r\n    });\r\n\r\n    return {\r\n        // the source title\r\n        title,\r\n        // the source url\r\n        link: officialUrl,\r\n        // the source description\r\n        description: `Yoasobi's latest ${category}`,\r\n        // iterate through all leaf objects\r\n        item: data.map((i) => ({\r\n            // the article title\r\n            title: i.title,\r\n            // the article content\r\n            description: art(path.join(__dirname, 'templates/info.art'), {\r\n                image: i.image,\r\n                category: i.category,\r\n                description: i.description.replaceAll('\\n', '<br>'),\r\n            }),\r\n            // the article publish time\r\n            pubDate: parseDate(i.date),\r\n            // guid\r\n            guid: i.guid,\r\n            // the article link\r\n            link: i.id ? `${officialUrl}/${i.id}` : officialUrl,\r\n            category: i.category,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"6bAQA,MAAa,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,QACb,QAAS,2BACT,WAAY,CAAE,SAAU,uBACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,wBAAyB,kCAClC,OAAQ,oBAGhB,KAAM,mBACN,YAAa,GACb,UACA,IAAK,yBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YAK3B,EAAU,IAAa,OAAS,mBAAqB,wCAEnD,EAAc,gCAAgC,IAC9C,EAAM,sDAAwB,IAAa,OAAS,cAAgB,WAAW,GAAG,IAClF,EAAQ,UAAU,EAAS,gBAE3B,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAO,EAAW,EAAS,MAAM,MAAM,IAAK,GAAS,CACvD,IAAM,EAAQ,IAAa,YACrB,OAAqB,CACvB,IAAM,EAAS,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACxF,OAAO,EAAO,KAAK,MAAM,KAAK,SAAW,EAAO,aAGpD,MAAO,CACH,GAAI,EAAQ,KAAO,EAAK,GACxB,KAAM,EAAQ,OAAO,EAAK,MAAQ,QAAQ,EAAK,QAAQ,EAAK,OAC5D,MAAO,EAAQ,GAAG,EAAY,GAAG,EAAK,MAAQ,EAAK,MACnD,SAAU,EAAK,UAAY,cAC3B,KAAM,EAAQ,EAAK,IAAM,EAAK,KAC9B,YAAa,EAAQ,EAAK,KAAO,EAAK,QACtC,MAAO,EAAS,EAAK,YAAc,GAAK,KAAO,8BAAe,EAAK,YAAe,QAI1F,MAAO,CAEH,QAEA,KAAM,EAEN,YAAa,oBAAoB,IAEjC,KAAM,EAAK,IAAK,IAAO,CAEnB,MAAO,EAAE,MAET,YAAa,EAAI,EAAA,KAAA,EAAA,+BAA4C,CACzD,MAAO,EAAE,MACT,SAAU,EAAE,SACZ,YAAa,EAAE,YAAY,WAAW;EAAM,UAGhD,QAAS,EAAU,EAAE,MAErB,KAAM,EAAE,KAER,KAAM,EAAE,GAAK,GAAG,EAAY,GAAG,EAAE,KAAO,EACxC,SAAU,EAAE"}