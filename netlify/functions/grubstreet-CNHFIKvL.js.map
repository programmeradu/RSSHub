{"version":3,"file":"grubstreet-CNHFIKvL.js","names":["got","cache","route: Route","utils"],"sources":["../../lib/routes/grubstreet/utils.ts","../../lib/routes/grubstreet/index.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nasync function loadContent(link) {\r\n    const response = await got(link);\r\n    const $ = load(response.data);\r\n\r\n    const description = $('div.article-content');\r\n\r\n    // remove the content that we don't want to show\r\n    description.find('aside.related').remove();\r\n    description.find('aside.article-details_heading-with-paragraph').remove();\r\n    description.find('section.package-list').remove();\r\n    description.find('div.source-links h2').remove();\r\n    description.find('div.source-links svg').remove();\r\n    description.find('div.mobile-secondary-area').remove();\r\n    description.find('aside.newsletter-flex-text').remove();\r\n\r\n    return {\r\n        description: description.html(),\r\n    };\r\n}\r\n\r\nfunction ProcessFeed(list, caches) {\r\n    return Promise.all(\r\n        list.map((item) =>\r\n            caches.tryGet(item.canonicalUrl, async () => {\r\n                const itemUrl = item.canonicalUrl.replace('http://', 'https://');\r\n\r\n                let bylineString;\r\n                if (item.byline) {\r\n                    const byline = item.byline[0];\r\n\r\n                    if (byline && byline.names) {\r\n                        const bylineNames = byline.names.map((name) => name.text);\r\n\r\n                        if (bylineNames && bylineNames.length > 0) {\r\n                            const bylineNamesString = bylineNames.join(', ');\r\n\r\n                            bylineString = 'by ' + bylineNamesString;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                const single = {\r\n                    title: item.plaintextPrimaryHeadline,\r\n                    link: itemUrl,\r\n                    guid: itemUrl,\r\n                    pubDate: item.date,\r\n                };\r\n\r\n                if (bylineString) {\r\n                    single.author = bylineString;\r\n                }\r\n\r\n                const { description } = await loadContent(itemUrl);\r\n                single.description = description;\r\n\r\n                return single;\r\n            })\r\n        )\r\n    );\r\n}\r\n\r\nconst getData = async (ctx, url, title, description) => {\r\n    const response = await got(url);\r\n\r\n    const data = response.data;\r\n\r\n    // limit the list to only 25 articles, to make sure that load times remain reasonable\r\n    const list = data.articles.slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 25);\r\n    const result = await ProcessFeed(list, cache);\r\n\r\n    return {\r\n        title,\r\n        link: url,\r\n        description,\r\n        item: result,\r\n    };\r\n};\r\n\r\nexport default { getData };\r\n","import { Route } from '@/types';\r\nimport utils from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    radar: [\r\n        {\r\n            source: ['grubstreet.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['loganrockmore'],\r\n    handler,\r\n    url: 'grubstreet.com/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const url = `https://www.grubstreet.com/_components/newsfeed/instances/grubstreet-index@published`;\r\n    const title = `Grub Street`;\r\n    const description = `New York Magazine's Food and Restaurant Blog`;\r\n\r\n    return await utils.getData(ctx, url, title, description);\r\n}\r\n"],"mappings":"mTAIA,eAAe,EAAY,EAAM,CAC7B,IAAM,EAAW,MAAMA,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAc,EAAE,uBAWtB,OARA,EAAY,KAAK,iBAAiB,SAClC,EAAY,KAAK,gDAAgD,SACjE,EAAY,KAAK,wBAAwB,SACzC,EAAY,KAAK,uBAAuB,SACxC,EAAY,KAAK,wBAAwB,SACzC,EAAY,KAAK,6BAA6B,SAC9C,EAAY,KAAK,8BAA8B,SAExC,CACH,YAAa,EAAY,QAIjC,SAAS,EAAY,EAAM,EAAQ,CAC/B,OAAO,QAAQ,IACX,EAAK,IAAK,GACN,EAAO,OAAO,EAAK,aAAc,SAAY,CACzC,IAAM,EAAU,EAAK,aAAa,QAAQ,UAAW,YAEjD,EACJ,GAAI,EAAK,OAAQ,CACb,IAAM,EAAS,EAAK,OAAO,GAE3B,GAAI,GAAU,EAAO,MAAO,CACxB,IAAM,EAAc,EAAO,MAAM,IAAK,GAAS,EAAK,MAEpD,GAAI,GAAe,EAAY,OAAS,EAAG,CACvC,IAAM,EAAoB,EAAY,KAAK,MAE3C,EAAe,MAAQ,IAKnC,IAAM,EAAS,CACX,MAAO,EAAK,yBACZ,KAAM,EACN,KAAM,EACN,QAAS,EAAK,MAGd,IACA,EAAO,OAAS,GAGpB,GAAM,CAAE,eAAgB,MAAM,EAAY,GAG1C,MAFA,GAAO,YAAc,EAEd,MAMvB,MAAM,EAAU,MAAO,EAAK,EAAK,EAAO,IAAgB,CACpD,IAAM,EAAW,MAAMA,EAAI,GAErB,EAAO,EAAS,KAGhB,EAAO,EAAK,SAAS,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,IACrG,EAAS,MAAM,EAAY,EAAMC,GAEvC,MAAO,CACH,QACA,KAAM,EACN,cACA,KAAM,IAId,IAAA,EAAe,CAAE,WC/EjB,MAAaC,EAAe,CACxB,KAAM,IACN,MAAO,CACH,CACI,OAAQ,CAAC,mBACT,OAAQ,KAGhB,KAAM,UACN,YAAa,CAAC,iBACd,UACA,IAAK,mBAGT,eAAe,EAAQ,EAAK,CAKxB,OAAO,MAAMC,EAAM,QAAQ,EAAK,uFAAK,cAAO"}