{"version":3,"file":"the-batch-E-UP1-Xw.js","names":[],"sources":["../../lib/routes/deeplearning/the-batch.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { tag } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 1;\r\n\r\n    const rootUrl = 'https://www.deeplearning.ai';\r\n    const currentUrl = new URL(`the-batch${tag ? `/tag/${tag.replace(/^tag\\//, '').replace(/\\/$/, '')}` : ''}/`, rootUrl).href;\r\n\r\n    const response = await ofetch(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    const data = JSON.parse($('script#__NEXT_DATA__').text());\r\n\r\n    const nextBuildId = data.buildId;\r\n    const posts = data.props?.pageProps?.posts ?? [];\r\n\r\n    let items = posts.slice(0, limit).map((item) => {\r\n        const title = item.title;\r\n        const description = art(path.join(__dirname, 'templates/description.art'), {\r\n            images: item.feature_image\r\n                ? [\r\n                      {\r\n                          src: item.feature_image,\r\n                          alt: item.feature_image_alt,\r\n                      },\r\n                  ]\r\n                : undefined,\r\n            intro: item.excerpt ?? item.custom_excerpt,\r\n        });\r\n        const image = item.feature_image;\r\n        const guid = `the-batch-${item.slug}`;\r\n\r\n        return {\r\n            title,\r\n            description,\r\n            pubDate: parseDate(item.published_at),\r\n            link: new URL(`_next/data/${nextBuildId}/the-batch/${item.slug}.json`, rootUrl).href,\r\n            category: item.tags.map((t) => t.name),\r\n            guid,\r\n            id: guid,\r\n            content: {\r\n                html: description,\r\n                text: item.excerpt ?? item.custom_excerpt,\r\n            },\r\n            image,\r\n            banner: image,\r\n            language,\r\n        };\r\n    });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await ofetch(item.link);\r\n\r\n                const post = detailResponse.pageProps?.post ?? undefined;\r\n\r\n                if (!post) {\r\n                    return item;\r\n                }\r\n\r\n                const $$ = load(post.html);\r\n\r\n                $$('a').each((_, ele) => {\r\n                    if (ele.attribs.href?.includes('utm_campaign')) {\r\n                        const url = new URL(ele.attribs.href);\r\n                        url.searchParams.delete('utm_campaign');\r\n                        url.searchParams.delete('utm_source');\r\n                        url.searchParams.delete('utm_medium');\r\n                        url.searchParams.delete('_hsenc');\r\n                        ele.attribs.href = url.href;\r\n                    }\r\n                });\r\n\r\n                const title = post.title;\r\n                const description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    images: post.feature_image\r\n                        ? [\r\n                              {\r\n                                  src: post.feature_image,\r\n                                  alt: post.feature_image_alt,\r\n                              },\r\n                          ]\r\n                        : undefined,\r\n                    intro: post.excerpt ?? post.custom_excerpt,\r\n                    description: $$.html(),\r\n                });\r\n                const guid = `the-batch-${post.slug}`;\r\n                const image = post.feature_image;\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = parseDate(post.published_at);\r\n                item.link = new URL(`the-batch/${post.slug}`, rootUrl).href;\r\n                item.category = post.tags.map((t) => t.name);\r\n                item.author = post.authors.map((a) => a.name).join('/');\r\n                item.guid = guid;\r\n                item.id = guid;\r\n                item.content = {\r\n                    html: description,\r\n                    text: post.excerpt ?? post.custom_excerpt,\r\n                };\r\n                item.image = image;\r\n                item.banner = image;\r\n                item.updated = parseDate(post.updated_at);\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('meta[property=\"og:image\"]').prop('content'), rootUrl).href;\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        description: $('meta[property=\"og:description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: $('meta[property=\"og:site_name\"]').prop('content'),\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/the-batch/:tag{.+}?',\r\n    name: 'The Batch',\r\n    url: 'www.deeplearning.ai',\r\n    maintainers: ['nczitzk', 'juvenn', 'TonyRL'],\r\n    handler,\r\n    example: '/deeplearning/the-batch',\r\n    parameters: { tag: 'Tag, Weekly Issues by default' },\r\n    description: `::: tip\r\n  If you subscribe to [Data Points](https://www.deeplearning.ai/the-batch/tag/data-points/)ï¼Œwhere the URL is \\`https://www.deeplearning.ai/the-batch/tag/data-points/\\`, extract the part \\`https://www.deeplearning.ai/the-batch/tag\\` to the end, which is \\`data-points\\`, and use it as the parameter to fill in. Therefore, the route will be [\\`/deeplearning/the-batch/data-points\\`](https://rsshub.app/deeplearning/the-batch/data-points).\r\n\r\n:::\r\n\r\n| Tag                                                                    | ID                                                                   |\r\n| ---------------------------------------------------------------------- | -------------------------------------------------------------------- |\r\n| [Weekly Issues](https://www.deeplearning.ai/the-batch/)                | [*null*](https://rsshub.app/deeplearning/the-batch)                  |\r\n| [Andrew's Letters](https://www.deeplearning.ai/the-batch/tag/letters/) | [letters](https://rsshub.app/deeplearning/the-batch/letters)         |\r\n| [Data Points](https://www.deeplearning.ai/the-batch/tag/data-points/)  | [data-points](https://rsshub.app/deeplearning/the-batch/data-points) |\r\n| [ML Research](https://www.deeplearning.ai/the-batch/tag/research/)     | [research](https://rsshub.app/deeplearning/the-batch/research)       |\r\n| [Business](https://www.deeplearning.ai/the-batch/tag/business/)        | [business](https://rsshub.app/deeplearning/the-batch/business)       |\r\n| [Science](https://www.deeplearning.ai/the-batch/tag/science/)          | [science](https://rsshub.app/deeplearning/the-batch/science)         |\r\n| [AI & Society](https://www.deeplearning.ai/the-batch/tag/ai-society/)  | [ai-society](https://rsshub.app/deeplearning/the-batch/ai-society)   |\r\n| [Culture](https://www.deeplearning.ai/the-batch/tag/culture/)          | [culture](https://rsshub.app/deeplearning/the-batch/culture)         |\r\n| [Hardware](https://www.deeplearning.ai/the-batch/tag/hardware/)        | [hardware](https://rsshub.app/deeplearning/the-batch/hardware)       |\r\n| [AI Careers](https://www.deeplearning.ai/the-batch/tag/ai-careers/)    | [ai-careers](https://rsshub.app/deeplearning/the-batch/ai-careers)   |\r\n\r\n#### [Letters from Andrew Ng](https://www.deeplearning.ai/the-batch/tag/letters/)\r\n\r\n| Tag                                                                                     | ID                                                                                     |\r\n| --------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- |\r\n| [All](https://www.deeplearning.ai/the-batch/tag/letters/)                               | [letters](https://rsshub.app/deeplearning/the-batch/letters)                           |\r\n| [Personal Insights](https://www.deeplearning.ai/the-batch/tag/personal-insights/)       | [personal-insights](https://rsshub.app/deeplearning/the-batch/personal-insights)       |\r\n| [Technical Insights](https://www.deeplearning.ai/the-batch/tag/technical-insights/)     | [technical-insights](https://rsshub.app/deeplearning/the-batch/technical-insights)     |\r\n| [Business Insights](https://www.deeplearning.ai/the-batch/tag/business-insights/)       | [business-insights](https://rsshub.app/deeplearning/the-batch/business-insights)       |\r\n| [Tech & Society](https://www.deeplearning.ai/the-batch/tag/tech-society/)               | [tech-society](https://rsshub.app/deeplearning/the-batch/tech-society)                 |\r\n| [DeepLearning.AI News](https://www.deeplearning.ai/the-batch/tag/deeplearning-ai-news/) | [deeplearning-ai-news](https://rsshub.app/deeplearning/the-batch/deeplearning-ai-news) |\r\n| [AI Careers](https://www.deeplearning.ai/the-batch/tag/ai-careers/)                     | [ai-careers](https://rsshub.app/deeplearning/the-batch/ai-careers)                     |\r\n| [Just For Fun](https://www.deeplearning.ai/the-batch/tag/just-for-fun/)                 | [just-for-fun](https://rsshub.app/deeplearning/the-batch/just-for-fun)                 |\r\n| [Learning & Education](https://www.deeplearning.ai/the-batch/tag/learning-education/)   | [learning-education](https://rsshub.app/deeplearning/the-batch/learning-education)     |\r\n    `,\r\n    categories: ['programming'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.deeplearning.ai/the-batch', 'www.deeplearning.ai/the-batch/tag/:tag/'],\r\n            target: (params) => {\r\n                const tag = params.tag;\r\n\r\n                return `/the-batch${tag ? `/${tag}` : ''}`;\r\n            },\r\n        },\r\n        {\r\n            title: 'Weekly Issues',\r\n            source: ['www.deeplearning.ai/the-batch/'],\r\n            target: '/the-batch',\r\n        },\r\n        {\r\n            title: \"Andrew's Letters\",\r\n            source: ['www.deeplearning.ai/the-batch/tag/letters/'],\r\n            target: '/the-batch/letters',\r\n        },\r\n        {\r\n            title: 'Data Points',\r\n            source: ['www.deeplearning.ai/the-batch/tag/data-points/'],\r\n            target: '/the-batch/data-points',\r\n        },\r\n        {\r\n            title: 'ML Research',\r\n            source: ['www.deeplearning.ai/the-batch/tag/research/'],\r\n            target: '/the-batch/research',\r\n        },\r\n        {\r\n            title: 'Business',\r\n            source: ['www.deeplearning.ai/the-batch/tag/business/'],\r\n            target: '/the-batch/business',\r\n        },\r\n        {\r\n            title: 'Science',\r\n            source: ['www.deeplearning.ai/the-batch/tag/science/'],\r\n            target: '/the-batch/science',\r\n        },\r\n        {\r\n            title: 'AI & Society',\r\n            source: ['www.deeplearning.ai/the-batch/tag/ai-society/'],\r\n            target: '/the-batch/ai-society',\r\n        },\r\n        {\r\n            title: 'Culture',\r\n            source: ['www.deeplearning.ai/the-batch/tag/culture/'],\r\n            target: '/the-batch/culture',\r\n        },\r\n        {\r\n            title: 'Hardware',\r\n            source: ['www.deeplearning.ai/the-batch/tag/hardware/'],\r\n            target: '/the-batch/hardware',\r\n        },\r\n        {\r\n            title: 'AI Careers',\r\n            source: ['www.deeplearning.ai/the-batch/tag/ai-careers/'],\r\n            target: '/the-batch/ai-careers',\r\n        },\r\n        {\r\n            title: 'Letters from Andrew Ng - All',\r\n            source: ['www.deeplearning.ai/the-batch/tag/letters/'],\r\n            target: '/the-batch/letters',\r\n        },\r\n        {\r\n            title: 'Letters from Andrew Ng - Personal Insights',\r\n            source: ['www.deeplearning.ai/the-batch/tag/personal-insights/'],\r\n            target: '/the-batch/personal-insights',\r\n        },\r\n        {\r\n            title: 'Letters from Andrew Ng - Technical Insights',\r\n            source: ['www.deeplearning.ai/the-batch/tag/technical-insights/'],\r\n            target: '/the-batch/technical-insights',\r\n        },\r\n        {\r\n            title: 'Letters from Andrew Ng - Business Insights',\r\n            source: ['www.deeplearning.ai/the-batch/tag/business-insights/'],\r\n            target: '/the-batch/business-insights',\r\n        },\r\n        {\r\n            title: 'Letters from Andrew Ng - Tech & Society',\r\n            source: ['www.deeplearning.ai/the-batch/tag/tech-society/'],\r\n            target: '/the-batch/tech-society',\r\n        },\r\n        {\r\n            title: 'Letters from Andrew Ng - DeepLearning.AI News',\r\n            source: ['www.deeplearning.ai/the-batch/tag/deeplearning-ai-news/'],\r\n            target: '/the-batch/deeplearning-ai-news',\r\n        },\r\n        {\r\n            title: 'Letters from Andrew Ng - AI Careers',\r\n            source: ['www.deeplearning.ai/the-batch/tag/ai-careers/'],\r\n            target: '/the-batch/ai-careers',\r\n        },\r\n        {\r\n            title: 'Letters from Andrew Ng - Just For Fun',\r\n            source: ['www.deeplearning.ai/the-batch/tag/just-for-fun/'],\r\n            target: '/the-batch/just-for-fun',\r\n        },\r\n        {\r\n            title: 'Letters from Andrew Ng - Learning & Education',\r\n            source: ['www.deeplearning.ai/the-batch/tag/learning-education/'],\r\n            target: '/the-batch/learning-education',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}