{"version":3,"file":"changelog-BAkLCAFd.js","names":["ofetch"],"sources":["../../lib/routes/taptap/common/changelog.ts"],"sourcesContent":["import ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { getRootUrl, appDetail, X_UA } from '../utils';\r\n\r\nexport async function handler(ctx) {\r\n    const requestPath = ctx.req.path.replace('/taptap', '');\r\n    const isIntl = requestPath.startsWith('/intl/');\r\n    const id = ctx.req.param('id');\r\n    const lang = ctx.req.param('lang') ?? (isIntl ? 'en_US' : 'zh_CN');\r\n\r\n    const url = `${getRootUrl(isIntl)}/app/${id}`;\r\n\r\n    const detail = await appDetail(id, lang, isIntl);\r\n\r\n    const appImg = detail.app.icon.original_url;\r\n    const appName = detail.app.title;\r\n    const appDescription = `${appName}${detail.app.developers ? ' by' + detail.app.developers.map((item) => item.name).join(' & ') : ''}`;\r\n\r\n    const response = await ofetch(`${getRootUrl(isIntl)}/webapiv2/apk/v1/list-by-app?app_id=${id}&from=0&limit=10&${X_UA(lang)}`, {\r\n        headers: {\r\n            Referer: url,\r\n        },\r\n    });\r\n\r\n    const list = response.data.list;\r\n\r\n    return {\r\n        title: `TapTap 更新记录 ${appName}`,\r\n        description: appDescription,\r\n        link: url,\r\n        image: appImg,\r\n        item: list.map((item) => ({\r\n            title: `${appName} / ${item.version_label}`,\r\n            description: item.whatsnew.text,\r\n            pubDate: parseDate(item.update_date, 'X'),\r\n            link: url,\r\n            guid: item.version_label,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"qLAIA,eAAsB,EAAQ,EAAK,CAC/B,IAAM,EAAc,EAAI,IAAI,KAAK,QAAQ,UAAW,IAC9C,EAAS,EAAY,WAAW,UAChC,EAAK,EAAI,IAAI,MAAM,MACnB,EAAO,EAAI,IAAI,MAAM,UAAY,EAAS,QAAU,SAEpD,EAAM,GAAG,EAAW,GAAQ,OAAO,IAEnC,EAAS,MAAM,EAAU,EAAI,EAAM,GAEnC,EAAS,EAAO,IAAI,KAAK,aACzB,EAAU,EAAO,IAAI,MACrB,EAAiB,GAAG,IAAU,EAAO,IAAI,WAAa,MAAQ,EAAO,IAAI,WAAW,IAAK,GAAS,EAAK,MAAM,KAAK,OAAS,KAE3H,EAAW,MAAMA,EAAO,GAAG,EAAW,GAAQ,sCAAsC,EAAG,mBAAmB,EAAK,KAAS,CAC1H,QAAS,CACL,QAAS,KAIX,EAAO,EAAS,KAAK,KAE3B,MAAO,CACH,MAAO,eAAe,IACtB,YAAa,EACb,KAAM,EACN,MAAO,EACP,KAAM,EAAK,IAAK,IAAU,CACtB,MAAO,GAAG,EAAQ,KAAK,EAAK,gBAC5B,YAAa,EAAK,SAAS,KAC3B,QAAS,EAAU,EAAK,YAAa,KACrC,KAAM,EACN,KAAM,EAAK"}