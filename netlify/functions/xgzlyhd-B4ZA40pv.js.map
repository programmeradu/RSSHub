{"version":3,"file":"xgzlyhd-B4ZA40pv.js","names":[],"sources":["../../lib/routes/gov/samr/xgzlyhd.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst rootUrl = 'https://xgzlyhd.samr.gov.cn';\r\nconst apiUrl = new URL('gjjly/message/getMessageList', rootUrl).href;\r\nconst apiDataUrl = new URL('gjjly/message/getDataList', rootUrl).href;\r\nconst currentUrl = new URL('gjjly/index', rootUrl).href;\r\n\r\nconst types = {\r\n    category: '1',\r\n    department: '2',\r\n};\r\n\r\nconst fetchOptions = async (type) => {\r\n    const { data: response } = await got.post(apiDataUrl, {\r\n        json: {\r\n            type: types[type],\r\n        },\r\n    });\r\n\r\n    return response.data;\r\n};\r\n\r\nconst getOption = async (type, name) => {\r\n    const options = await fetchOptions(type);\r\n    const results = options.filter((o) => o.name === name || o.code === name);\r\n\r\n    if (results.length > 0) {\r\n        return results.pop();\r\n    }\r\n    return;\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/samr/xgzlyhd/:category?/:department?',\r\n    categories: ['government'],\r\n    example: '/gov/samr/xgzlyhd',\r\n    parameters: { category: '留言类型，见下表，默认为全部', department: '回复部门，见下表，默认为全部' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['xgzlyhd.samr.gov.cn/gjjly/index'],\r\n        },\r\n    ],\r\n    name: '留言咨询',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    url: 'xgzlyhd.samr.gov.cn/gjjly/index',\r\n    description: `#### 留言类型\r\n\r\n| 类型                                       | 类型 id                          |\r\n| ------------------------------------------ | -------------------------------- |\r\n| 反腐倡廉                                   | 14101a4192df48b592b5cfd77a26c0cf |\r\n| 规划统计                                   | b807cf9cdf434635ae908d48757e0f39 |\r\n| 行政执法和复议                             | 8af2530e77154d7b939428667b7413f6 |\r\n| 假冒仿冒行为                               | 75374a34b95341829e08e54d4a0d8c04 |\r\n| 走私贩私                                   | 84c728530e1e478e94fe3f0030171c53 |\r\n| 登记注册                                   | 07fff64612dc41aca871c06587abf71d |\r\n| 个体工商户登记                             | ca8f91ba9a2347a0acd57ea5fd12a5c8 |\r\n| 信用信息公示系统                           | 1698886c3cdb495998d5ea9285a487f5 |\r\n| 市场主体垄断                               | 77bfe965843844449c47d29f2feb7999 |\r\n| 反不正当竞争                               | 2c919b1dc39440d8850c4f6c405869f8 |\r\n| 商业贿赂                                   | b494e6535af149c5a51fd4197993f061 |\r\n| 打击传销与规范直销                         | 407a1404844e48558da46139f16d6232 |\r\n| 消费环境建设                               | 94c2003331dd4c5fa19b0cf88d720676 |\r\n| 网络交易监管                               | 6302aac5b87140598da53f85c1ccb8fa |\r\n| 动产抵押登记                               | 3856de5835444229943b18cac7781e9f |\r\n| 广告监管                                   | d0e38171042048c2bf31b05c5e57aa68 |\r\n| 三包                                       | c4dbd85692604a428b1ea7613e67beb8 |\r\n| 缺陷产品召回                               | f93c9a6b81e941d09a547406370e1c0c |\r\n| 工业生产许可                               | 2b41afaabaa24325b53a5bd7deba895b |\r\n| 产品质量监督抽查                           | 4388504cb0c04e988e2cf0c90d4a3f14 |\r\n| 食品安全协调                               | 3127b9f409c24d0eaa60b13c25f819fa |\r\n| 食品生产监管                               | beaa5555d1364e5bb2a0f0a7cc9720e5 |\r\n| 食品销售、餐饮服务、食用农产品销售监管     | 3b6c49c6ce934e1b9505601a3b881a6a |\r\n| 保健、特殊医学用途配方和婴幼儿配方乳粉监管 | 13b43888f8554e078b1dfa475e2aaab0 |\r\n| 食品监督抽检、召回                         | 0eb6c75581bf41ecaedc629370cb425c |\r\n| 食品安全标准                               | 399cfd9abfa34c22a5cb3bb971a43819 |\r\n| 特种设备人员、机构管理                     | e5d0e51cc7d0412790efac605008bf20 |\r\n| 特种设备检验                               | 03f22fb3d4cd4f09b632079359e9dd7d |\r\n| 计量器具                                   | 90b25e22861446d5822e07c7c1f5169a |\r\n| 计量机构和人员管理                         | 76202742f06c459da7482160e0ce17ad |\r\n| 国家标准                                   | 299b9672e1c246e69485a5b695f42c5b |\r\n| 行业、地方、团体、企业标准                 | cbdc804c9b2c4e259a159c32eccf4ca9 |\r\n| 认证监督管理                               | 41259262a42e4de49b5c0b7362ac3796 |\r\n| 认可与检验检测                             | cb3c9d1e3d364f2a8b1cd70efa69d1cb |\r\n| 新闻宣传                                   | e3e553e4019c46ccbdc06136900138e9 |\r\n| 科技财务                                   | 47367b9704964355ba52899a4c5abbb0 |\r\n| 干部人事                                   | 6b978e3c127c489ea8e2d693b768887e |\r\n| 国际合作                                   | dd5ce768e33e435ab4bfb769ab6e079a |\r\n| 党群工作                                   | aa71052978af4304937eb382f24f9902 |\r\n| 退休干部                                   | 44505fc58c81428eb5cef15706007b5e |\r\n| 虚假宣传                                   | 5bb2b83ecadb4bf89a779cee414a81dd |\r\n| 滥用行政权力                               | 1215206156dc48029b98da825f26fcbc |\r\n| 公平竞争                                   | 9880a23dcbb04deba2cc7b4404e13ff6 |\r\n| 滥用市场支配地位                           | fea04f0acd84486e84cf71d9c13005b0 |\r\n| 数字经济领域反垄断执法                     | 4bea424a6e4c4e2aac19fe3c73f9be23 |\r\n| 并购行为                                   | 90e315647acd415ca68f97fc1b42053d |\r\n| 经营者集中案件                             | d6571d2cd5624bc18191b342a2e8defb |\r\n| 数字经济领域反垄断审查                     | 03501ef176ef44fba1c7c70da44ba8a0 |\r\n| 综合执法                                   | cfbb1b5dade446299670ca38844b265e |\r\n| 信用监管                                   | a9d76ea04a3a4433946bc02b0bdb77eb |\r\n| 3C 认证                                    | 111decc7b14a4fdbae86fb4a3ba5c0c1 |\r\n| 食用农产品                                 | 3159db51f8ca4f23a9340d87d5572d40 |\r\n| 食品添加                                   | 4e4b0e0152334cbb9c62fd1b80138305 |\r\n\r\n#### 回复部门\r\n\r\n| 部门                         | 部门 id                          |\r\n| ---------------------------- | -------------------------------- |\r\n| 办公厅                       | 6ed539b270634667afc4d466b67a53f7 |\r\n| 法规司                       | 8625ec7ff8d744ad80a1d1a2bf19cf19 |\r\n| 执法稽查局                   | 313a8cb1c09042dea52be52cb392c557 |\r\n| 登记注册局                   | e4553350549f45f38da5602147cf8639 |\r\n| 信用监督管理司               | 6af98157255a4a858eac5f94ba8d98f4 |\r\n| 竞争政策协调司               | 8d2266be4791483297822e1aa5fc0a96 |\r\n| 综合规划司                   | 958e1619159c45a7b76663a59d9052ea |\r\n| 反垄断执法一司               | f9fb3f6225964c71ab82224a91f21b2c |\r\n| 反垄断执法二司               | 7986c79e4f16403493d5b480aec30be4 |\r\n| 价格监督检查和反不正当竞争局 | c5d2b1b273b545cfbc6f874f670654ab |\r\n| 网络交易监督管理司           | 6ac05b4dbd4e41c69f4529262540459b |\r\n| 广告监督管理司               | 96457dfe16c54840885b79b4e6e17523 |\r\n| 质量发展局                   | cb8d2b16fbb540dca296aa33a43fc573 |\r\n| 质量监督司                   | af2c4e0a54c04f76b512c29ddd075d40 |\r\n| 食品安全协调司               | cc29962c74e84ef2b21e44336da6c6c5 |\r\n| 食品生产安全监督管理司       | b334db85a253458285db70b30ee26b0a |\r\n| 食品经营安全监督管理司       | 4315f0261a5d49f7bdcc5a7524e19ce3 |\r\n| 特殊食品安全监督管理司       | 62d14f386317486ca94bc53ca7f88891 |\r\n| 食品安全抽检监测司           | abfc910832cc460a81876ad418618159 |\r\n| 特种设备安全监察局           | ea79f90bec5840ef9b0881c83682225a |\r\n| 计量司                       | b0556236fbcf4f45b6fdec8004dac3e4 |\r\n| 标准技术管理司               | a558d07a51f4454fa59290e0d6e93c26 |\r\n| 标准创新管理司               | ffb3a80984b344ed8d168f4af6508af0 |\r\n| 认证监督管理司               | ca4987393d514debb4d1e2126f576987 |\r\n| 认可与检验检测监督管理司     | 796bfab21b15498e88c9032fe3e3c9f1 |\r\n| 新闻宣传司                   | 884fc0ea6c184ad58dda10e2170a1eda |\r\n| 科技和财务司                 | 117355eea94c426199e2e519fd98ce07 |\r\n| 人事司                       | a341e8b7929e44769b9424b7cf69d32a |\r\n| 国际司                       | f784499ef24541f5b20de4c24cfc61e7 |\r\n| 机关党委                     | a49119c6f40045dd994f3910500cedfa |\r\n| 离退办                       | 6bf265ffd1c94fa4a3f1687b03fa908b |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category, department } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 10;\r\n\r\n    let categoryOption;\r\n    let departmentOption;\r\n\r\n    if (category) {\r\n        categoryOption = await getOption('category', category);\r\n    }\r\n\r\n    if (department) {\r\n        departmentOption = await getOption('department', department);\r\n    }\r\n\r\n    const { data: response } = await got.post(apiUrl, {\r\n        json: {\r\n            clyj: '',\r\n            curPage: '1',\r\n            endTime: '',\r\n            fzsj: departmentOption?.code ?? '',\r\n            lybt: undefined,\r\n            lylx: categoryOption?.code ?? '',\r\n            lynr: '',\r\n            startTime: '',\r\n            zj: '',\r\n        },\r\n    });\r\n\r\n    const items = response.data.data.slice(0, limit).map((item) => ({\r\n        title: item.lybt,\r\n        link: `${currentUrl}#${item.zj}`,\r\n        description: art(path.join(__dirname, 'templates/description.art'), {\r\n            item,\r\n        }),\r\n        author: `${item.lyr} ⇄ ${item.fzsjCn}`,\r\n        category: [item.fzsjCn],\r\n        guid: `${currentUrl}#${item.zj}`,\r\n        pubDate: parseDate(item.pubtime),\r\n    }));\r\n\r\n    const { data: currentResponse } = await got(currentUrl);\r\n\r\n    const $ = load(currentResponse);\r\n\r\n    const author = '国家市场监督管理总局';\r\n    const title = $('title').text();\r\n    const subtitle = [categoryOption ? categoryOption.name : undefined, departmentOption ? departmentOption.name : undefined].filter(Boolean).join(' - ');\r\n    const icon = new URL($('link[rel=\"icon\"]').prop('href'), rootUrl).href;\r\n\r\n    return {\r\n        item: items,\r\n        title: `${author}${title}${subtitle ? ` - ${subtitle}` : ''}`,\r\n        link: currentUrl,\r\n        description: $('meta[property=\"og:description\"]').prop('content'),\r\n        language: 'zh',\r\n        image: new URL(`gjjly/${$('div.fd-logo img').prop('src')}`, rootUrl).href,\r\n        icon,\r\n        logo: icon,\r\n        subtitle,\r\n        author,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"oaAQA,MAAM,EAAU,8BACV,EAAS,IAAI,IAAI,+BAAgC,GAAS,KAC1D,EAAa,IAAI,IAAI,4BAA6B,GAAS,KAC3D,EAAa,IAAI,IAAI,cAAe,GAAS,KAE7C,EAAQ,CACV,SAAU,IACV,WAAY,KAGV,EAAe,KAAO,IAAS,CACjC,GAAM,CAAE,KAAM,GAAa,MAAM,EAAI,KAAK,EAAY,CAClD,KAAM,CACF,KAAM,EAAM,MAIpB,OAAO,EAAS,MAGd,EAAY,MAAO,EAAM,IAAS,CACpC,IAAM,EAAU,MAAM,EAAa,GAC7B,EAAU,EAAQ,OAAQ,GAAM,EAAE,OAAS,GAAQ,EAAE,OAAS,GAEpE,GAAI,EAAQ,OAAS,EACjB,OAAO,EAAQ,OAKV,EAAe,CACxB,KAAM,wCACN,WAAY,CAAC,cACb,QAAS,oBACT,WAAY,CAAE,SAAU,iBAAkB,WAAY,kBACtD,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,qCAGjB,KAAM,OACN,YAAa,CAAC,WACd,UACA,IAAK,kCACL,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;mEA+FjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAU,cAAe,EAAI,IAAI,QACnC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAEjF,EACA,EAEA,IACA,EAAiB,MAAM,EAAU,WAAY,IAG7C,IACA,EAAmB,MAAM,EAAU,aAAc,IAGrD,GAAM,CAAE,KAAM,GAAa,MAAM,EAAI,KAAK,EAAQ,CAC9C,KAAM,CACF,KAAM,GACN,QAAS,IACT,QAAS,GACT,KAAM,GAAkB,MAAQ,GAChC,KAAM,IAAA,GACN,KAAM,GAAgB,MAAQ,GAC9B,KAAM,GACN,UAAW,GACX,GAAI,MAIN,EAAQ,EAAS,KAAK,KAAK,MAAM,EAAG,GAAO,IAAK,IAAU,CAC5D,MAAO,EAAK,KACZ,KAAM,GAAG,EAAW,GAAG,EAAK,KAC5B,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,SAEJ,OAAQ,GAAG,EAAK,IAAI,KAAK,EAAK,SAC9B,SAAU,CAAC,EAAK,QAChB,KAAM,GAAG,EAAW,GAAG,EAAK,KAC5B,QAAS,EAAU,EAAK,YAGtB,CAAE,KAAM,GAAoB,MAAM,EAAI,GAEtC,EAAI,EAAK,GAET,EAAS,aACT,EAAQ,EAAE,SAAS,OACnB,EAAW,CAAC,EAAiB,EAAe,KAAO,IAAA,GAAW,EAAmB,EAAiB,KAAO,IAAA,IAAW,OAAO,SAAS,KAAK,OACzI,EAAO,IAAI,IAAI,EAAE,oBAAoB,KAAK,QAAS,GAAS,KAElE,MAAO,CACH,KAAM,EACN,MAAO,GAAG,IAAS,IAAQ,EAAW,MAAM,IAAa,KACzD,KAAM,EACN,YAAa,EAAE,mCAAmC,KAAK,WACvD,SAAU,KACV,MAAO,IAAI,IAAI,SAAS,EAAE,mBAAmB,KAAK,SAAU,GAAS,KACrE,OACA,KAAM,EACN,WACA,SACA,WAAY"}