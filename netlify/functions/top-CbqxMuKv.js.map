{"version":3,"file":"top-CbqxMuKv.js","names":["route: Route","got","cache","response","$","data"],"sources":["../../lib/routes/zcool/top.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { extractArticle, extractWork } from './utils';\r\nconst baseUrl = 'https://www.zcool.com.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/top/:type',\r\n    categories: ['design'],\r\n    view: ViewType.Pictures,\r\n    example: '/zcool/top/design',\r\n    parameters: {\r\n        type: {\r\n            description: '推荐类型',\r\n            options: [\r\n                { value: 'design', label: '作品榜单' },\r\n                { value: 'article', label: '文章榜单' },\r\n            ],\r\n        },\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '作品总榜单',\r\n    maintainers: ['yuuow'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type');\r\n    const url = `${baseUrl}/top/${type === 'design' ? 'index.do' : 'article.do?rankType=8'}`;\r\n\r\n    const { data: response } = await got(url);\r\n\r\n    const $ = load(response);\r\n\r\n    const data = JSON.parse($('script#__NEXT_DATA__').text());\r\n\r\n    const list = data.props.pageProps.listResult.data.map((item) => ({\r\n        title: item.rankingTitle,\r\n        author: item.member.name,\r\n        category: [item.productCategoryStr, item.productSubCateStr, ...item.tags],\r\n        link: item.pageUrl,\r\n        pubDate: parseDate(item.rankingPublishTime),\r\n    }));\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n\r\n                const data = JSON.parse($('script#__NEXT_DATA__').text());\r\n                item.pubDate = parseDate(data.props.pageProps.data.publishTime, 'x');\r\n\r\n                if (item.link.startsWith('https://www.zcool.com.cn/article/')) {\r\n                    item.description = extractArticle(data);\r\n                } else if (item.link.startsWith('https://www.zcool.com.cn/work/')) {\r\n                    item.description = extractWork(data);\r\n                }\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: data.props.pageProps.seo.title,\r\n        description: data.props.pageProps.seo.description,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0fAMA,MAEaA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,UACb,KAAM,EAAS,SACf,QAAS,oBACT,WAAY,CACR,KAAM,CACF,YAAa,OACb,QAAS,CACL,CAAE,MAAO,SAAU,MAAO,QAC1B,CAAE,MAAO,UAAW,MAAO,WAIvC,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,QACN,YAAa,CAAC,SACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAM,gCAAkB,IAAS,SAAW,WAAa,0BAEzD,CAAE,KAAM,GAAa,MAAMC,EAAI,GAE/B,EAAI,EAAK,GAET,EAAO,KAAK,MAAM,EAAE,wBAAwB,QAE5C,EAAO,EAAK,MAAM,UAAU,WAAW,KAAK,IAAK,IAAU,CAC7D,MAAO,EAAK,aACZ,OAAQ,EAAK,OAAO,KACpB,SAAU,CAAC,EAAK,mBAAoB,EAAK,kBAAmB,GAAG,EAAK,MACpE,KAAM,EAAK,QACX,QAAS,EAAU,EAAK,uBAGtB,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAETE,EAAO,KAAK,MAAMD,EAAE,wBAAwB,QASlD,MARA,GAAK,QAAU,EAAUC,EAAK,MAAM,UAAU,KAAK,YAAa,KAE5D,EAAK,KAAK,WAAW,qCACrB,EAAK,YAAc,EAAeA,GAC3B,EAAK,KAAK,WAAW,oCAC5B,EAAK,YAAc,EAAYA,IAG5B,MAKnB,MAAO,CACH,MAAO,EAAK,MAAM,UAAU,IAAI,MAChC,YAAa,EAAK,MAAM,UAAU,IAAI,YACtC,KAAM,EACN,KAAM"}