{"version":3,"file":"news-today-DbwJd17p.js","names":["route: Route","ofetch","items: any"],"sources":["../../lib/routes/visionias/news-today.ts"],"sourcesContent":["import { Data, Route } from '@/types';\r\nimport { baseUrl, extractNews } from './utils';\r\nimport dayjs from 'dayjs';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\n\r\nimport logger from '@/utils/logger';\r\n\r\nexport const route: Route = {\r\n    path: '/newsToday/:filter?',\r\n    example: '/visionias/newsToday',\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    parameters: {\r\n        filter: {\r\n            description: 'Period to fetch news for the current month. All news for the current month or only the latest',\r\n            default: 'latest',\r\n            options: [\r\n                { value: 'all', label: 'All' },\r\n                { value: 'latest', label: 'Latest' },\r\n            ],\r\n        },\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['visionias.in/current-affairs/news-today'],\r\n            target: '/newsToday',\r\n        },\r\n    ],\r\n    name: 'News Today',\r\n    maintainers: ['Rjnishant530'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx): Promise<Data> {\r\n    const filter = ctx.req.param('filter') ?? 'latest';\r\n    const currentYear = dayjs().year();\r\n    const currentMonth = dayjs().month() + 1;\r\n    logger.debug(`Getting news for month ${currentMonth} and year ${currentYear}`);\r\n    const response = await ofetch(`${baseUrl}/current-affairs/news-today/getbymonth?year=${currentYear}&month=${currentMonth}`);\r\n\r\n    let items: any = [];\r\n    // let title = 'News Today';\r\n\r\n    if (response.length !== 0) {\r\n        if (filter === 'latest') {\r\n            const currentUrl = response[0].url;\r\n            // title = response[0].formatted_published_at;\r\n            items = await processCurrentNews(currentUrl);\r\n        } else {\r\n            const results = await Promise.all(response.map((element) => processCurrentNews(element.url)));\r\n            items.push(...results.flat());\r\n        }\r\n    }\r\n    return {\r\n        title: 'News Today | Current Affairs | Vision IAS',\r\n        link: `${baseUrl}/current-affairs/news-today/archive`,\r\n        description: 'News Today is a daily bulletin providing readers with a comprehensive overview of news developments, news types, and technical terms.',\r\n        language: 'en',\r\n        item: items,\r\n        image: `${baseUrl}/current-affairs/images/news-today-logo.svg`,\r\n        icon: `https://cdn.visionias.in/new-system-assets/images/home_page/home/vision-logo-footer.png`,\r\n        logo: `https://cdn.visionias.in/new-system-assets/images/home_page/home/vision-logo-footer.png`,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n\r\nasync function processCurrentNews(currentUrl) {\r\n    const response = await ofetch(`${baseUrl}${currentUrl}`);\r\n    const $ = load(response);\r\n    const items = $(`#table-of-content > ul > li > a`)\r\n        .toArray()\r\n        .map((item) => {\r\n            const link = $(item).attr('href');\r\n            const title = $(item).clone().children('span').remove().end().text().trim();\r\n            return {\r\n                title,\r\n                link: title === 'Also in News' ? link : `${baseUrl}${link}`,\r\n                guid: link,\r\n            };\r\n        });\r\n    const newsPromises = await Promise.allSettled(items.map((item) => extractNews(item, 'main > div > div.mt-6 > div.flex > div.flex.mt-6')));\r\n    return newsPromises.flatMap((news) => (news.status === 'fulfilled' ? (Array.isArray(news.value) ? news.value : [news.value]) : [{ title: 'Error Parse News' }]));\r\n}\r\n"],"mappings":"iZAQA,MAAaA,EAAe,CACxB,KAAM,sBACN,QAAS,uBACT,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,WAAY,CACR,OAAQ,CACJ,YAAa,gGACb,QAAS,SACT,QAAS,CACL,CAAE,MAAO,MAAO,MAAO,OACvB,CAAE,MAAO,SAAU,MAAO,aAItC,MAAO,CACH,CACI,OAAQ,CAAC,2CACT,OAAQ,eAGhB,KAAM,aACN,YAAa,CAAC,gBACd,WAGJ,eAAe,EAAQ,EAAoB,CACvC,IAAM,EAAS,EAAI,IAAI,MAAM,WAAa,SACpC,EAAc,IAAQ,OACtB,EAAe,IAAQ,QAAU,EACvC,EAAO,MAAM,0BAA0B,EAAa,YAAY,KAChE,IAAM,EAAW,MAAMC,EAAO,GAAG,EAAQ,8CAA8C,EAAY,SAAS,KAExGC,EAAa,GAGjB,GAAI,EAAS,SAAW,EACpB,GAAI,IAAW,SAAU,CACrB,IAAM,EAAa,EAAS,GAAG,IAE/B,EAAQ,MAAM,EAAmB,OAC9B,CACH,IAAM,EAAU,MAAM,QAAQ,IAAI,EAAS,IAAK,GAAY,EAAmB,EAAQ,OACvF,EAAM,KAAK,GAAG,EAAQ,QAG9B,MAAO,CACH,MAAO,4CACP,KAAM,GAAG,EAAQ,qCACjB,YAAa,wIACb,SAAU,KACV,KAAM,EACN,MAAO,GAAG,EAAQ,6CAClB,KAAM,0FACN,KAAM,0FACN,WAAY,IAIpB,eAAe,EAAmB,EAAY,CAC1C,IAAM,EAAW,MAAMD,EAAO,GAAG,IAAU,KACrC,EAAI,EAAK,GACT,EAAQ,EAAE,mCACX,UACA,IAAK,GAAS,CACX,IAAM,EAAO,EAAE,GAAM,KAAK,QACpB,EAAQ,EAAE,GAAM,QAAQ,SAAS,QAAQ,SAAS,MAAM,OAAO,OACrE,MAAO,CACH,QACA,KAAM,IAAU,eAAiB,EAAO,GAAG,IAAU,IACrD,KAAM,KAGZ,EAAe,MAAM,QAAQ,WAAW,EAAM,IAAK,GAAS,EAAY,EAAM,sDACpF,OAAO,EAAa,QAAS,GAAU,EAAK,SAAW,YAAe,MAAM,QAAQ,EAAK,OAAS,EAAK,MAAQ,CAAC,EAAK,OAAU,CAAC,CAAE,MAAO"}