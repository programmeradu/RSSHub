{"version":3,"file":"rss-C0mLHREB.js","names":["route: Route","parser","cache","ofetch"],"sources":["../../lib/routes/nytimes/rss.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport parser from '@/utils/rss-parser';\r\nimport { load } from 'cheerio';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nexport const route: Route = {\r\n    path: '/rss/:cat?',\r\n    categories: ['traditional-media'],\r\n    view: ViewType.Articles,\r\n    example: '/nytimes/rss/HomePage',\r\n    parameters: {\r\n        cat: {\r\n            description: \"Category name, corresponding to the last segment of [official feed's](https://www.nytimes.com/rss) url.\",\r\n        },\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['nytimes.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'News',\r\n    maintainers: ['HenryQW', 'pseudoyu', 'dzx-dzx'],\r\n    handler,\r\n    url: 'nytimes.com/',\r\n    description: `Enhance the official EN RSS feed`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const url = `https://rss.nytimes.com/services/xml/rss/nyt/${ctx.req.param('cat')}.xml`;\r\n\r\n    const rss = await parser.parseURL(url);\r\n\r\n    return {\r\n        ...rss,\r\n        item: await Promise.all(\r\n            rss.items.map((e) =>\r\n                cache.tryGet(e.link, async () => {\r\n                    const res = await ofetch(e.link, { headers: { 'User-Agent': 'Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)' }, referrer: 'https://www.google.com/' });\r\n\r\n                    const $ = load(res);\r\n\r\n                    return {\r\n                        ...e,\r\n                        description: $(\"[name='articleBody']\").html(),\r\n                        author: $('meta[name=\"byl\"]').attr('content'),\r\n                    };\r\n                })\r\n            )\r\n        ),\r\n    };\r\n}\r\n"],"mappings":"2WAMA,MAAaA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,qBACb,KAAM,EAAS,SACf,QAAS,wBACT,WAAY,CACR,IAAK,CACD,YAAa,4GAGrB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,gBACT,OAAQ,KAGhB,KAAM,OACN,YAAa,CAAC,UAAW,WAAY,WACrC,UACA,IAAK,eACL,YAAa,oCAGjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,gDAAgD,EAAI,IAAI,MAAM,OAAO,MAE3E,EAAM,MAAMC,EAAO,SAAS,GAElC,MAAO,CACH,GAAG,EACH,KAAM,MAAM,QAAQ,IAChB,EAAI,MAAM,IAAK,GACXC,EAAM,OAAO,EAAE,KAAM,SAAY,CAC7B,IAAM,EAAM,MAAMC,EAAO,EAAE,KAAM,CAAE,QAAS,CAAE,aAAc,4EAA8E,SAAU,4BAE9I,EAAI,EAAK,GAEf,MAAO,CACH,GAAG,EACH,YAAa,EAAE,wBAAwB,OACvC,OAAQ,EAAE,oBAAoB,KAAK"}