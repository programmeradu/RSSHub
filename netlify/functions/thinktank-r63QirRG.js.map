{"version":3,"file":"thinktank-r63QirRG.js","names":["route: Route","got","InvalidParameterError","cache"],"sources":["../../lib/routes/aisixiang/thinktank.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nimport { rootUrl, ossUrl, ProcessFeed } from './utils';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: '/thinktank/:id/:type?',\r\n    categories: ['reading'],\r\n    example: '/aisixiang/thinktank/WuQine/论文',\r\n    parameters: { id: '专栏 ID，一般为作者拼音，可在URL中找到', type: '栏目类型，参考下表，默认为全部' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '思想库（专栏）',\r\n    maintainers: ['hoilc', 'nczitzk'],\r\n    handler,\r\n    description: `| 论文 | 时评 | 随笔 | 演讲 | 访谈 | 著作 | 读书 | 史论 | 译作 | 诗歌 | 书信 | 科学 |\r\n| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { id, type = '' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 30;\r\n\r\n    const currentUrl = new URL(`thinktank/${id}.html`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const title = `${$('h2').first().text().trim()}${type}`;\r\n\r\n    let items = [];\r\n\r\n    const targetList = $('h3')\r\n        .toArray()\r\n        .filter((h) => (type ? $(h).text() === type : true));\r\n    if (!targetList) {\r\n        throw new InvalidParameterError(`Not found ${type} in ${id}: ${currentUrl}`);\r\n    }\r\n\r\n    for (const l of targetList) {\r\n        items = [...items, ...$(l).parent().find('ul li a').toArray()];\r\n    }\r\n\r\n    items = items.slice(0, limit).map((item) => {\r\n        item = $(item);\r\n\r\n        return {\r\n            title: item.text().split('：').pop(),\r\n            link: new URL(item.prop('href'), rootUrl).href,\r\n        };\r\n    });\r\n\r\n    return {\r\n        item: await ProcessFeed(limit, cache.tryGet, items),\r\n        title: `爱思想 - ${title}`,\r\n        link: currentUrl,\r\n        description: $('div.thinktank-author-description-box p').text(),\r\n        language: 'zh-cn',\r\n        image: new URL('images/logo_thinktank.jpg', ossUrl).href,\r\n        subtitle: title,\r\n    };\r\n}\r\n"],"mappings":"0gBAQA,MAAaA,EAAe,CACxB,KAAM,wBACN,WAAY,CAAC,WACb,QAAS,iCACT,WAAY,CAAE,GAAI,yBAA0B,KAAM,mBAClD,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,UACN,YAAa,CAAC,QAAS,WACvB,UACA,YAAa;wFAIjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,KAAI,OAAO,IAAO,EAAI,IAAI,QAC5B,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAa,IAAI,IAAI,aAAa,EAAG,OAAQ,GAAS,KAEtD,CAAE,KAAM,GAAa,MAAMC,EAAI,GAE/B,EAAI,EAAK,GAET,EAAQ,GAAG,EAAE,MAAM,QAAQ,OAAO,SAAS,IAE7C,EAAQ,GAEN,EAAa,EAAE,MAChB,UACA,OAAQ,GAAO,EAAO,EAAE,GAAG,SAAW,EAAO,IAClD,GAAI,CAAC,EACD,MAAM,IAAIC,EAAsB,aAAa,EAAK,MAAM,EAAG,IAAI,KAGnE,IAAK,IAAM,KAAK,EACZ,EAAQ,CAAC,GAAG,EAAO,GAAG,EAAE,GAAG,SAAS,KAAK,WAAW,WAYxD,MATA,GAAQ,EAAM,MAAM,EAAG,GAAO,IAAK,IAC/B,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,OAAO,MAAM,KAAK,MAC9B,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAS,QAI3C,CACH,KAAM,MAAM,EAAY,EAAOC,EAAM,OAAQ,GAC7C,MAAO,SAAS,IAChB,KAAM,EACN,YAAa,EAAE,0CAA0C,OACzD,SAAU,QACV,MAAO,IAAI,IAAI,4BAA6B,GAAQ,KACpD,SAAU"}