{"version":3,"file":"forum-D9QswM2C.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/sis001/forum.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { config } from '@/config';\r\nimport { load } from 'cheerio';\r\nimport type { Context } from 'hono';\r\nimport { getCookie, getThread } from './common';\r\n\r\nexport const route: Route = {\r\n    path: '/forum/:id?',\r\n    categories: ['bbs'],\r\n    example: '/sis001/forum/322',\r\n    parameters: { id: '子版块 ID，可在子论坛 URL 找到，默认为 `Funny Jokes | 短篇笑话区`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        nsfw: true,\r\n    },\r\n    name: '子版块',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx: Context) {\r\n    const { id = 76 } = ctx.req.param();\r\n    const url = `${config.sis001.baseUrl}/forum/forum-${id}-1.html`;\r\n\r\n    const cookie = await getCookie(url);\r\n    const response = await got(url, { headers: { cookie } });\r\n    const $ = load(response.data);\r\n\r\n    let items = $('form table')\r\n        .last()\r\n        .find('tbody')\r\n        .toArray()\r\n        .slice(1) // skip first empty row\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item.find('th em').text() + ' ' + item.find('span a').eq(0).text(),\r\n                link: new URL(item.find('span a').eq(0).attr('href'), `${config.sis001.baseUrl}/forum/`).href,\r\n                author: item.find('.author a').text(),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(items.map((item) => cache.tryGet(item.link, async () => await getThread(cookie, item))));\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        description: $('meta[name=description]').attr('content'),\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"ocAQA,MAAaA,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,OACb,QAAS,oBACT,WAAY,CAAE,GAAI,iDAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,KAAM,IAEV,KAAM,MACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAc,CACjC,GAAM,CAAE,KAAK,IAAO,EAAI,IAAI,QACtB,EAAM,GAAG,EAAO,OAAO,QAAQ,eAAe,EAAG,SAEjD,EAAS,MAAM,EAAU,GACzB,EAAW,MAAMC,EAAI,EAAK,CAAE,QAAS,CAAE,YACvC,EAAI,EAAK,EAAS,MAEpB,EAAQ,EAAE,cACT,OACA,KAAK,SACL,UACA,MAAM,GACN,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,SAAS,OAAS,IAAM,EAAK,KAAK,UAAU,GAAG,GAAG,OACnE,KAAM,IAAI,IAAI,EAAK,KAAK,UAAU,GAAG,GAAG,KAAK,QAAS,GAAG,EAAO,OAAO,QAAQ,UAAU,KACzF,OAAQ,EAAK,KAAK,aAAa,UAM3C,MAFA,GAAQ,MAAM,QAAQ,IAAI,EAAM,IAAK,GAASC,EAAM,OAAO,EAAK,KAAM,SAAY,MAAM,EAAU,EAAQ,MAEnG,CACH,MAAO,EAAE,cAAc,OACvB,YAAa,EAAE,0BAA0B,KAAK,WAC9C,KAAM,EACN,KAAM"}