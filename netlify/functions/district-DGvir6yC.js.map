{"version":3,"file":"district-DGvir6yC.js","names":["route: Route","cache","GB2312Response","response","$"],"sources":["../../lib/routes/ce/district.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { load } from 'cheerio';\r\nimport { ofetch } from 'ofetch';\r\n\r\nexport const route: Route = {\r\n    path: '/district/:category?',\r\n    name: '地方经济',\r\n    url: 'district.ce.cn',\r\n    maintainers: ['cscnk52'],\r\n    handler,\r\n    example: '/ce/district',\r\n    parameters: { category: '栏目标识，默认为 roll（即时新闻）' },\r\n    description: `| 即时新闻 | 经济动态 | 独家视角 | 专题 | 数说地方 | 地方播报 | 专稿 | 港澳台 |\r\n|----------|----------|----------|------|----------|----------|------|--------|\r\n| roll     | jjdt     | poll     | ch   | ssdf     | dfbb     | zg   | gat    |`,\r\n    categories: ['traditional-media'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        supportRadar: true,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['district.ce.cn/newarea/:category/index.shtml'],\r\n            target: '/district/:category?',\r\n        },\r\n        {\r\n            source: ['district.ce.cn/newarea/:category'],\r\n            target: '/district/:category?',\r\n        },\r\n        {\r\n            source: ['district.ce.cn'],\r\n            target: '/district',\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const rootUrl = 'http://district.ce.cn/';\r\n    const { category = 'roll' } = ctx.req.param();\r\n    const url = `${rootUrl}newarea/${category}/index.shtml`;\r\n    const GB2312Response = await ofetch(url, { responseType: 'arrayBuffer' });\r\n\r\n    // originally site use gb2312 encoding\r\n    const response = new TextDecoder('gb2312').decode(new Uint8Array(GB2312Response));\r\n    const $ = load(response);\r\n\r\n    const bigTitle = $('div.channl a').eq(1).attr('title');\r\n\r\n    const list = $('div.sec_left li')\r\n        .toArray()\r\n        .map((e) => {\r\n            const element = $(e);\r\n            const title = element.find('a').text().trim();\r\n            const link = new URL(element.find('a').attr('href'), url).href;\r\n            return {\r\n                title,\r\n                link,\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const GB2312Response = await ofetch(item.link, { responseType: 'arrayBuffer' });\r\n                const response = new TextDecoder('gb2312').decode(new Uint8Array(GB2312Response));\r\n                const $ = load(response);\r\n\r\n                const pubDateText = $('span#articleTime').text().trim();\r\n                item.pubDate = timezone(parseDate(pubDateText, 'YYYY年MM月DD日 HH:mm'), +8);\r\n\r\n                item.description = $('div.TRS_Editor').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `中国经济网地方经济 - ${bigTitle}`,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mUAOA,MAAaA,EAAe,CACxB,KAAM,uBACN,KAAM,OACN,IAAK,iBACL,YAAa,CAAC,WACd,UACA,QAAS,eACT,WAAY,CAAE,SAAU,uBACxB,YAAa;;iFAGb,WAAY,CAAC,qBACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,aAAc,IAElB,MAAO,CACH,CACI,OAAQ,CAAC,gDACT,OAAQ,wBAEZ,CACI,OAAQ,CAAC,oCACT,OAAQ,wBAEZ,CACI,OAAQ,CAAC,kBACT,OAAQ,cAGhB,KAAM,EAAS,UAGnB,eAAe,EAAQ,EAAK,CACxB,GACM,CAAE,WAAW,QAAW,EAAI,IAAI,QAChC,EAAM,iCAAqB,EAAS,cACpC,EAAiB,MAAM,EAAO,EAAK,CAAE,aAAc,gBAGnD,EAAW,IAAI,YAAY,UAAU,OAAO,IAAI,WAAW,IAC3D,EAAI,EAAK,GAET,EAAW,EAAE,gBAAgB,GAAG,GAAG,KAAK,SAExC,EAAO,EAAE,mBACV,UACA,IAAK,GAAM,CACR,IAAM,EAAU,EAAE,GACZ,EAAQ,EAAQ,KAAK,KAAK,OAAO,OACjC,EAAO,IAAI,IAAI,EAAQ,KAAK,KAAK,KAAK,QAAS,GAAK,KAC1D,MAAO,CACH,QACA,UAIN,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAiB,MAAM,EAAO,EAAK,KAAM,CAAE,aAAc,gBACzDC,EAAW,IAAI,YAAY,UAAU,OAAO,IAAI,WAAWD,IAC3DE,EAAI,EAAKD,GAET,EAAcC,EAAE,oBAAoB,OAAO,OAIjD,MAHA,GAAK,QAAU,EAAS,EAAU,EAAa,qBAAsB,GAErE,EAAK,YAAcA,EAAE,kBAAkB,OAChC,MAKnB,MAAO,CACH,MAAO,eAAe,IACtB,KAAM,EACN,KAAM"}