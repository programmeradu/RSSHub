{"version":3,"file":"notice-BLqIhiFt.js","names":["got","title","cache","route: Route"],"sources":["../../lib/routes/hdu/auto/utils.ts","../../lib/routes/hdu/auto/notice.ts"],"sourcesContent":["import { Data, DataItem } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst BASE_URL = 'https://auto.hdu.edu.cn';\r\n\r\nexport const fetchAutoNews = async (path: string, title: string): Promise<Data> => {\r\n    const link = `${BASE_URL}/${path}`;\r\n    const response = await got(link);\r\n    const $ = load(response.data);\r\n\r\n    const list = $('.rightlist')\r\n        .toArray()\r\n        .map((item): DataItem => {\r\n            const $item = $(item);\r\n            const $a = $item.find('.newstitle a');\r\n            const href = $a.attr('href');\r\n            const title = $a.text().trim();\r\n            const dateMatch = $item\r\n                .find('.newsinfo')\r\n                .text()\r\n                .match(/日期：(\\d{4}\\/\\d{2}\\/\\d{2})/);\r\n            const brief = $item.find('.newsbrief').text().trim();\r\n\r\n            return {\r\n                title: title || '无标题',\r\n                link: href ? new URL(href, BASE_URL).href : BASE_URL,\r\n                pubDate: dateMatch ? parseDate(dateMatch[1], 'YYYY/MM/DD') : undefined,\r\n                description: brief || '',\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data } = await got(item.link);\r\n                const $detail = load(data);\r\n                const description = $detail('.wp_articlecontent').html();\r\n                return { ...item, description: description || item.description };\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `杭州电子科技大学自动化学院 - ${title}`,\r\n        link,\r\n        item: items as DataItem[],\r\n    };\r\n};\r\n","import { Route } from '@/types';\r\nimport { fetchAutoNews } from './utils';\r\nimport logger from '@/utils/logger';\r\n\r\nconst typeMap = {\r\n    notice: {\r\n        name: '通知公告',\r\n        path: '3779/list.htm',\r\n    },\r\n    graduate: {\r\n        name: '研究生教育',\r\n        path: '3754/list.htm',\r\n    },\r\n    undergraduate: {\r\n        name: '本科教学',\r\n        path: '3745/list.htm',\r\n    },\r\n    student: {\r\n        name: '学生工作',\r\n        path: '3726/list.htm',\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/auto/:type?',\r\n    categories: ['university'],\r\n    example: '/hdu/auto',\r\n    parameters: { type: '分类，见下表，默认为通知公告' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '自动化学院',\r\n    maintainers: ['jalenzz'],\r\n    handler: (ctx) => {\r\n        let type = ctx.req.param('type') || 'notice';\r\n        if (!(type in typeMap)) {\r\n            logger.error(`Invalid type: ${type}. Valid types are: ${Object.keys(typeMap).join(', ')}, defaulting to notice`);\r\n            type = 'notice';\r\n        }\r\n        return fetchAutoNews(typeMap[type].path, typeMap[type].name);\r\n    },\r\n    description: `| 通知公告  | 研究生教育 |    本科教学    | 学生工作  |\r\n| -------- | -------- |   --------    | -------- |\r\n| notice   | graduate | undergraduate | student  |`,\r\n    radar: [\r\n        {\r\n            source: ['auto.hdu.edu.cn/main.htm', 'auto.hdu.edu.cn/3779/list.htm'],\r\n            target: '/auto/notice',\r\n        },\r\n        {\r\n            source: ['auto.hdu.edu.cn/main.htm', 'auto.hdu.edu.cn/3754/list.htm'],\r\n            target: '/auto/graduate',\r\n        },\r\n        {\r\n            source: ['auto.hdu.edu.cn/main.htm', 'auto.hdu.edu.cn/3745/list.htm'],\r\n            target: '/auto/undergraduate',\r\n        },\r\n        {\r\n            source: ['auto.hdu.edu.cn/main.htm', 'auto.hdu.edu.cn/3726/list.htm'],\r\n            target: '/auto/student',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"iYAMA,MAAM,EAAW,0BAEJ,EAAgB,MAAO,EAAc,IAAiC,CAC/E,IAAM,EAAO,GAAG,EAAS,GAAG,IACtB,EAAW,MAAMA,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,cACV,UACA,IAAK,GAAmB,CACrB,IAAM,EAAQ,EAAE,GACV,EAAK,EAAM,KAAK,gBAChB,EAAO,EAAG,KAAK,QACfC,EAAQ,EAAG,OAAO,OAClB,EAAY,EACb,KAAK,aACL,OACA,MAAM,4BACL,EAAQ,EAAM,KAAK,cAAc,OAAO,OAE9C,MAAO,CACH,MAAOA,GAAS,MAChB,KAAM,EAAO,IAAI,IAAI,EAAM,GAAU,KAAO,EAC5C,QAAS,EAAY,EAAU,EAAU,GAAI,cAAgB,IAAA,GAC7D,YAAa,GAAS,MAI5B,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,QAAS,MAAMF,EAAI,EAAK,MAC1B,EAAU,EAAK,GACf,EAAc,EAAQ,sBAAsB,OAClD,MAAO,CAAE,GAAG,EAAM,YAAa,GAAe,EAAK,iBAK/D,MAAO,CACH,MAAO,mBAAmB,IAC1B,OACA,KAAM,IC5CR,EAAU,CACZ,OAAQ,CACJ,KAAM,OACN,KAAM,iBAEV,SAAU,CACN,KAAM,QACN,KAAM,iBAEV,cAAe,CACX,KAAM,OACN,KAAM,iBAEV,QAAS,CACL,KAAM,OACN,KAAM,kBAIDG,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,cACb,QAAS,YACT,WAAY,CAAE,KAAM,kBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,QACN,YAAa,CAAC,WACd,QAAU,GAAQ,CACd,IAAI,EAAO,EAAI,IAAI,MAAM,SAAW,SAKpC,OAJM,KAAQ,IACV,EAAO,MAAM,iBAAiB,EAAK,qBAAqB,OAAO,KAAK,GAAS,KAAK,MAAM,yBACxF,EAAO,UAEJ,EAAc,EAAQ,GAAM,KAAM,EAAQ,GAAM,OAE3D,YAAa;;oDAGb,MAAO,CACH,CACI,OAAQ,CAAC,2BAA4B,iCACrC,OAAQ,gBAEZ,CACI,OAAQ,CAAC,2BAA4B,iCACrC,OAAQ,kBAEZ,CACI,OAAQ,CAAC,2BAA4B,iCACrC,OAAQ,uBAEZ,CACI,OAAQ,CAAC,2BAA4B,iCACrC,OAAQ"}