{"version":3,"file":"announcement-B4f9MIPt.js","names":["handler: Route['handler']","got","cache","route: Route"],"sources":["../../lib/routes/xbmu/announcement.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\n\r\nconst BASE_URL = 'https://www.xbmu.edu.cn/xwzx/tzgg.htm';\r\n\r\nconst handler: Route['handler'] = async () => {\r\n    try {\r\n        // Fetch the announcements page\r\n        const { data: listResponse } = await got(BASE_URL);\r\n        const $ = load(listResponse);\r\n\r\n        // Select all list items containing announcement information\r\n        const ITEM_SELECTOR = 'body > div.container.list-container.ny_mani > div > div.news_list > ul > li';\r\n        const listItems = $(ITEM_SELECTOR);\r\n\r\n        // Map through each list item to extract details\r\n        const announcementLinkList = await Promise.all(\r\n            listItems.toArray().map((element) => {\r\n                const rawDate = $(element).find('span').text().trim();\r\n                const [day, yearMonth] = rawDate.split('/').map((s) => s.trim());\r\n                const formattedDate = parseDate(`${yearMonth}-${day}`).toUTCString();\r\n\r\n                const title = $(element).find('a').attr('title') || '通知公告';\r\n                const relativeHref = $(element).find('a').attr('href') || '';\r\n                const link = `https://www.xbmu.edu.cn/${relativeHref.replaceAll('../', '')}`;\r\n\r\n                return {\r\n                    date: formattedDate,\r\n                    title,\r\n                    link,\r\n                };\r\n            })\r\n        );\r\n\r\n        return {\r\n            title: '西北民族大学通知公告',\r\n            description: '西北民族大学近日通知公告',\r\n            link: BASE_URL,\r\n            image: 'http://210.26.0.114:9090/mdxg/img/weex/default_img.jpg',\r\n            item: (await Promise.all(\r\n                announcementLinkList.map((item) =>\r\n                    cache.tryGet(item.link, async () => {\r\n                        const CONTENT_SELECTOR = '#vsb_content > div';\r\n                        const { data: contentResponse } = await got(item.link);\r\n                        const contentPage = load(contentResponse);\r\n                        const content = contentPage(CONTENT_SELECTOR).html() || '';\r\n                        return {\r\n                            title: item.title,\r\n                            pubDate: item.date,\r\n                            link: item.link,\r\n                            description: content,\r\n                            category: ['university'],\r\n                            guid: item.link,\r\n                            id: item.link,\r\n                            image: 'http://210.26.0.114:9090/mdxg/img/weex/default_img.jpg',\r\n                            content,\r\n                            updated: item.date,\r\n                            language: 'zh-cn',\r\n                        };\r\n                    })\r\n                )\r\n            )) as DataItem[],\r\n            allowEmpty: true,\r\n            language: 'zh-cn',\r\n            feedLink: 'https://rsshub.app/xbmu/announcement',\r\n            id: 'https://rsshub.app/xbmu/announcement',\r\n        };\r\n    } catch (error) {\r\n        throw new Error(`Error fetching announcements: ${error}`);\r\n    }\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/announcement',\r\n    name: '通知公告',\r\n    maintainers: ['PrinOrange'],\r\n    handler,\r\n    categories: ['university'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    example: '/xbmu/announcement',\r\n};\r\n"],"mappings":"wWAMA,MAAM,EAAW,wCAEXA,EAA4B,SAAY,CAC1C,GAAI,CAEA,GAAM,CAAE,KAAM,GAAiB,MAAMC,EAAI,GACnC,EAAI,EAAK,GAIT,EAAY,EAAE,+EAGd,EAAuB,MAAM,QAAQ,IACvC,EAAU,UAAU,IAAK,GAAY,CACjC,IAAM,EAAU,EAAE,GAAS,KAAK,QAAQ,OAAO,OACzC,CAAC,EAAK,GAAa,EAAQ,MAAM,KAAK,IAAK,GAAM,EAAE,QACnD,EAAgB,EAAU,GAAG,EAAU,GAAG,KAAO,cAEjD,EAAQ,EAAE,GAAS,KAAK,KAAK,KAAK,UAAY,OAC9C,EAAe,EAAE,GAAS,KAAK,KAAK,KAAK,SAAW,GACpD,EAAO,2BAA2B,EAAa,WAAW,MAAO,MAEvE,MAAO,CACH,KAAM,EACN,QACA,WAKZ,MAAO,CACH,MAAO,aACP,YAAa,eACb,KAAM,EACN,MAAO,yDACP,KAAO,MAAM,QAAQ,IACjB,EAAqB,IAAK,GACtBC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GACM,CAAE,KAAM,GAAoB,MAAMD,EAAI,EAAK,MAC3C,EAAc,EAAK,GACnB,EAAU,EAAY,sBAAkB,QAAU,GACxD,MAAO,CACH,MAAO,EAAK,MACZ,QAAS,EAAK,KACd,KAAM,EAAK,KACX,YAAa,EACb,SAAU,CAAC,cACX,KAAM,EAAK,KACX,GAAI,EAAK,KACT,MAAO,yDACP,UACA,QAAS,EAAK,KACd,SAAU,aAK1B,WAAY,GACZ,SAAU,QACV,SAAU,uCACV,GAAI,8CAEH,EAAO,CACZ,MAAU,MAAM,iCAAiC,OAI5CE,EAAe,CACxB,KAAM,gBACN,KAAM,OACN,YAAa,CAAC,cACd,UACA,WAAY,CAAC,cACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,QAAS"}