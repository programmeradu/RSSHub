{"version":3,"file":"scai-CtpSmhyq.js","names":["route: Route","ofetch","pubDate: Date","dateText","cache"],"sources":["../../lib/routes/swjtu/scai.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nconst rootURL = 'https://scai.swjtu.edu.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/scai/:type',\r\n    categories: ['university'],\r\n    example: '/swjtu/scai/bks',\r\n    parameters: { type: '通知类型' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['scai.swjtu.edu.cn/'],\r\n        },\r\n    ],\r\n    name: '计算机与人工智能学院',\r\n    description: `\r\n| 分区              | 参数         |\r\n| ----------------- | ----------- |\r\n| 本科生教育         | bks         |\r\n| 研究生教育         | yjs         |\r\n| 学生工作           | xsgz        |\r\n`,\r\n    maintainers: ['AzureG03', 'SuperJeason'],\r\n    handler,\r\n};\r\n\r\nconst partition = {\r\n    bks: {\r\n        title: '本科生教育',\r\n        url: `${rootURL}/web/page-module.html?mid=B730BEB095B31840`,\r\n    },\r\n    yjs: {\r\n        title: '研究生教育',\r\n        url: `${rootURL}/web/page-module.html?mid=6A69B0E32021446B`,\r\n    },\r\n    xsgz: {\r\n        title: '学生工作',\r\n        url: `${rootURL}/web/page-module.html?mid=F3D3909EB1861B5D`,\r\n    },\r\n};\r\n\r\nconst getItem = (item, cache) => {\r\n    const title = item.find('a').text();\r\n    const link = `${rootURL}${item.find('a').attr('href').slice(2)}`;\r\n    // console.log(link);\r\n\r\n    return cache.tryGet(link, async () => {\r\n        const res = await ofetch(link);\r\n        const $ = load(res);\r\n        let pubDate: Date;\r\n        let dateText = $('div.news-info span:nth-of-type(2)').text();\r\n        // 转教务通知时的时间获取方法\r\n        if (!dateText) {\r\n            dateText = $('div.news-top-bar span:nth-of-type(1)').text();\r\n        }\r\n        // 'date' may be undefined. and 'parseDate' will return current time.\r\n        // 转其他院的通知，获取不到具体时间，先从列表页获取具体信息\r\n        if (dateText) {\r\n            const dateMatch = dateText.match(/\\d{4}(-|\\/|.)\\d{1,2}\\1\\d{1,2}/);\r\n            if (!dateMatch || !dateMatch[0]) {\r\n                return null;\r\n            }\r\n            pubDate = parseDate(dateMatch[0]);\r\n        } else {\r\n            const dateItem = item.find('.calendar'); // 注意 .calendar 是 class\r\n            const day = dateItem.find('.day').text().trim(); // \"31\" （文本需 trim 去空格）\r\n            const ymd = dateItem.find('.date').text().trim(); // \"2025/03\"\r\n            const [year, month] = ymd.split('/'); // [\"2025\", \"03\"]\r\n            const dateText = `${year}-${month}-${day.padStart(2, '0')}`;\r\n            pubDate = new Date(dateText);\r\n        }\r\n        const description = $('div.content-main').html();\r\n        // 确实无法获取时间就以当前时间为准\r\n        pubDate ||= new Date('2025-04-12'); // 使用当前时间作为默认值\r\n        return {\r\n            title,\r\n            pubDate,\r\n            link,\r\n            description,\r\n        };\r\n    });\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { type } = ctx.req.param();\r\n    const url = partition[type].url;\r\n    const res = await ofetch(url);\r\n\r\n    const $ = load(res);\r\n    const $list = $('div.list-top-item, div.item-wrapper');\r\n\r\n    const items = await Promise.all(\r\n        $list.toArray().map((i) => {\r\n            const $item = $(i);\r\n            return getItem($item, cache);\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: `西南交大计院-${partition[type].title}`,\r\n        link: url,\r\n        item: items,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"mTAMA,MAAM,EAAU,4BAEHA,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,cACb,QAAS,kBACT,WAAY,CAAE,KAAM,QACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,wBAGjB,KAAM,aACN,YAAa;;;;;;EAOb,YAAa,CAAC,WAAY,eAC1B,WAGE,EAAY,CACd,IAAK,CACD,MAAO,QACP,IAAK,GAAG,EAAQ,6CAEpB,IAAK,CACD,MAAO,QACP,IAAK,GAAG,EAAQ,6CAEpB,KAAM,CACF,MAAO,OACP,IAAK,GAAG,EAAQ,8CAIlB,GAAW,EAAM,IAAU,CAC7B,IAAM,EAAQ,EAAK,KAAK,KAAK,OACvB,EAAO,GAAG,IAAU,EAAK,KAAK,KAAK,KAAK,QAAQ,MAAM,KAG5D,OAAO,EAAM,OAAO,EAAM,SAAY,CAClC,IAAM,EAAM,MAAMC,EAAO,GACnB,EAAI,EAAK,GACXC,EACA,EAAW,EAAE,qCAAqC,OAOtD,GALK,IACD,EAAW,EAAE,wCAAwC,QAIrD,EAAU,CACV,IAAM,EAAY,EAAS,MAAM,iCACjC,GAAI,CAAC,GAAa,CAAC,EAAU,GACzB,OAAO,KAEX,EAAU,EAAU,EAAU,QAC3B,CACH,IAAM,EAAW,EAAK,KAAK,aACrB,EAAM,EAAS,KAAK,QAAQ,OAAO,OACnC,EAAM,EAAS,KAAK,SAAS,OAAO,OACpC,CAAC,EAAM,GAAS,EAAI,MAAM,KAC1BC,EAAW,GAAG,EAAK,GAAG,EAAM,GAAG,EAAI,SAAS,EAAG,OACrD,EAAU,IAAI,KAAKA,GAEvB,IAAM,EAAc,EAAE,oBAAoB,OAG1C,MADA,KAAY,IAAI,KAAK,cACd,CACH,QACA,UACA,OACA,kBAKZ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,QAAS,EAAI,IAAI,QACnB,EAAM,EAAU,GAAM,IACtB,EAAM,MAAMF,EAAO,GAEnB,EAAI,EAAK,GACT,EAAQ,EAAE,uCAEV,EAAQ,MAAM,QAAQ,IACxB,EAAM,UAAU,IAAK,GAAM,CACvB,IAAM,EAAQ,EAAE,GAChB,OAAO,EAAQ,EAAOG,MAI9B,MAAO,CACH,MAAO,UAAU,EAAU,GAAM,QACjC,KAAM,EACN,KAAM,EACN,WAAY"}