{"version":3,"file":"user-bYK4srsA.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/lfsyd/user.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { ProcessForm, ProcessFeed } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/user/:id?',\r\n    radar: [\r\n        {\r\n            source: ['www.iyingdi.com/tz/people/:id', 'www.iyingdi.com/tz/people/:id/*'],\r\n            target: '/user/:id',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['auto-bot-ty'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const rootUrl = 'https://www.iyingdi.com';\r\n    const listUrl = 'https://api.iyingdi.com/web/user/event-list';\r\n    const form = {\r\n        event_types: 'content',\r\n        page: 1,\r\n        size: 15,\r\n        timestamp: '',\r\n        user_id: id,\r\n    };\r\n\r\n    const response = await got({\r\n        method: 'post',\r\n        url: listUrl,\r\n        headers: {\r\n            Host: 'api.iyingdi.com',\r\n            'Login-Token': 'nologin',\r\n            Origin: rootUrl,\r\n            Platform: 'pc',\r\n            Referer: `${rootUrl}/tz/people/${id}/postList`,\r\n        },\r\n        form: ProcessForm(form),\r\n    });\r\n\r\n    const { data } = response.data;\r\n    const { nickname } = data[0].author;\r\n\r\n    const articleList = data.map((item) => ({\r\n        title: item.event_data.title,\r\n        pubDate: parseDate(item.event_data.show_time * 1000),\r\n        link: `${rootUrl}/tz/post/${item.event_data.post_id}`,\r\n        guid: item.event_data.title,\r\n        postId: item.event_data.post_id,\r\n    }));\r\n\r\n    const items = await ProcessFeed(cache, articleList);\r\n\r\n    return {\r\n        title: `${nickname} - 旅法师营地 `,\r\n        link: `${rootUrl}/tz/people/${id}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mcAMA,MAAaA,EAAe,CACxB,KAAM,aACN,MAAO,CACH,CACI,OAAQ,CAAC,gCAAiC,mCAC1C,OAAQ,cAGhB,KAAM,UACN,YAAa,CAAC,eACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAU,0BAEV,EAAO,CACT,YAAa,UACb,KAAM,EACN,KAAM,GACN,UAAW,GACX,QAAS,GAGP,EAAW,MAAMC,EAAI,CACvB,OAAQ,OACR,IAAK,8CACL,QAAS,CACL,KAAM,kBACN,cAAe,UACf,OAAQ,EACR,SAAU,KACV,QAAS,GAAG,EAAQ,aAAa,EAAG,YAExC,KAAM,EAAY,KAGhB,CAAE,QAAS,EAAS,KACpB,CAAE,YAAa,EAAK,GAAG,OAEvB,EAAc,EAAK,IAAK,IAAU,CACpC,MAAO,EAAK,WAAW,MACvB,QAAS,EAAU,EAAK,WAAW,UAAY,KAC/C,KAAM,GAAG,EAAQ,WAAW,EAAK,WAAW,UAC5C,KAAM,EAAK,WAAW,MACtB,OAAQ,EAAK,WAAW,WAGtB,EAAQ,MAAM,EAAYC,EAAO,GAEvC,MAAO,CACH,MAAO,GAAG,EAAS,WACnB,KAAM,GAAG,EAAQ,aAAa,IAC9B,KAAM"}