{"version":3,"file":"app-comment-B1coSEcr.js","names":[],"sources":["../../lib/routes/qoo-app/user/app-comment.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { userUrl, appsUrl } from '../utils';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/user/:lang?/appComment/:uid',\r\n    categories: ['anime'],\r\n    example: '/qoo-app/user/en/appComment/35399143',\r\n    parameters: { lang: 'Language, see the table above, empty means `中文`', uid: 'User ID, can be found in URL' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'User Game Comments',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { uid, lang = '' } = ctx.req.param();\r\n    const link = `${userUrl}${lang ? `/${lang}` : ''}/${uid}`;\r\n\r\n    const { data: response } = await got(link);\r\n    const { data } = await got(`${userUrl}/getUserAppCommentList`, {\r\n        searchParams: {\r\n            fid: uid,\r\n        },\r\n    });\r\n\r\n    const $ = load(response);\r\n    const username = $('.person .name').text();\r\n\r\n    const items = data.list.map((item) => ({\r\n        title: `${username} ▶ ${item.app.name}`,\r\n        link: `${appsUrl}/comment-detail/${item.comment.id}`,\r\n        description: art(path.join(__dirname, '../templates/comment.art'), {\r\n            rating: item.score,\r\n            text: item.comment.content,\r\n        }),\r\n        pubDate: timezone(parseDate(item.comment.created_at, 'YYYY-MM-DD'), 8),\r\n        author: username,\r\n    }));\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        link,\r\n        image: decodeURIComponent($('.person div.slot').attr('data-args')).replace('avatar=', '').split('?')[0],\r\n        language: $('html').attr('lang'),\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"ihBAUA,MAAa,EAAe,CACxB,KAAM,+BACN,WAAY,CAAC,SACb,QAAS,uCACT,WAAY,CAAE,KAAM,kDAAmD,IAAK,gCAC5E,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,qBACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,MAAK,OAAO,IAAO,EAAI,IAAI,QAC7B,EAAO,GAAG,IAAU,EAAO,IAAI,IAAS,GAAG,GAAG,IAE9C,CAAE,KAAM,GAAa,MAAM,EAAI,GAC/B,CAAE,QAAS,MAAM,EAAI,GAAG,EAAQ,wBAAyB,CAC3D,aAAc,CACV,IAAK,KAIP,EAAI,EAAK,GACT,EAAW,EAAE,iBAAiB,OAE9B,EAAQ,EAAK,KAAK,IAAK,IAAU,CACnC,MAAO,GAAG,EAAS,KAAK,EAAK,IAAI,OACjC,KAAM,GAAG,EAAQ,kBAAkB,EAAK,QAAQ,KAChD,YAAa,EAAI,EAAA,KAAA,EAAA,kCAAkD,CAC/D,OAAQ,EAAK,MACb,KAAM,EAAK,QAAQ,UAEvB,QAAS,EAAS,EAAU,EAAK,QAAQ,WAAY,cAAe,GACpE,OAAQ,KAGZ,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,OACA,MAAO,mBAAmB,EAAE,oBAAoB,KAAK,cAAc,QAAQ,UAAW,IAAI,MAAM,KAAK,GACrG,SAAU,EAAE,QAAQ,KAAK,QACzB,KAAM"}