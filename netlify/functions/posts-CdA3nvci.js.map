{"version":3,"file":"posts-CdA3nvci.js","names":[],"sources":["../../lib/routes/deadline/posts.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    radar: [\r\n        {\r\n            source: ['deadline.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'deadline.com/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://deadline.com';\r\n    const response = await got(`${baseUrl}/wp-json/wp/v2/posts`, {\r\n        searchParams: {\r\n            per_page: ctx.req.query('limit') ?? 30,\r\n            _embed: true,\r\n        },\r\n    });\r\n\r\n    const items = response.data.map((item) => {\r\n        const embedded = item._embedded;\r\n        const $ = load(item.content.rendered, null, false);\r\n\r\n        $('.c-lazy-image__img').each((_, img) => {\r\n            img = $(img);\r\n            if (img.attr('data-lazy-src')) {\r\n                img.attr('src', img.attr('data-lazy-src').split('?')[0]);\r\n                img.removeAttr('data-lazy-src');\r\n                img.removeAttr('data-lazy-srcset');\r\n            }\r\n        });\r\n        $('[class^=\"lrv-a-crop-\"]').contents().unwrap();\r\n\r\n        const description = art(path.join(__dirname, 'templates/desc.art'), {\r\n            desc: $.html(),\r\n            embedded,\r\n        });\r\n        return {\r\n            title: item.title.rendered,\r\n            link: item.link,\r\n            guid: item.guid.rendered,\r\n            description,\r\n            pubDate: parseDate(item.date_gmt),\r\n            author: embedded.author[0].name,\r\n            category: [...new Set([...embedded['wp:term'][0].map((i) => i.name), ...embedded['wp:term'][1].map((i) => i.name)])],\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: 'Deadline â€“ Hollywood Entertainment Breaking News',\r\n        description: 'Deadline.com is always the first to break up-to-the-minute entertainment, Hollywood and media news, with an unfiltered, no-holds-barred analysis of events.',\r\n        link: baseUrl,\r\n        language: 'en-US',\r\n        image: `${baseUrl}/wp-content/themes/pmc-deadline-2019/assets/app/icons/apple-touch-icon.png`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"oaAQA,MAAa,EAAe,CACxB,KAAM,IACN,MAAO,CACH,CACI,OAAQ,CAAC,iBACT,OAAQ,KAGhB,KAAM,UACN,YAAa,CAAC,UACd,UACA,IAAK,iBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,uBACV,EAAW,MAAM,EAAI,GAAG,EAAQ,sBAAuB,CACzD,aAAc,CACV,SAAU,EAAI,IAAI,MAAM,UAAY,GACpC,OAAQ,MAIV,EAAQ,EAAS,KAAK,IAAK,GAAS,CACtC,IAAM,EAAW,EAAK,UAChB,EAAI,EAAK,EAAK,QAAQ,SAAU,KAAM,IAE5C,EAAE,sBAAsB,MAAM,EAAG,IAAQ,CACrC,EAAM,EAAE,GACJ,EAAI,KAAK,mBACT,EAAI,KAAK,MAAO,EAAI,KAAK,iBAAiB,MAAM,KAAK,IACrD,EAAI,WAAW,iBACf,EAAI,WAAW,uBAGvB,EAAE,0BAA0B,WAAW,SAEvC,IAAM,EAAc,EAAI,EAAA,KAAA,EAAA,+BAA4C,CAChE,KAAM,EAAE,OACR,aAEJ,MAAO,CACH,MAAO,EAAK,MAAM,SAClB,KAAM,EAAK,KACX,KAAM,EAAK,KAAK,SAChB,cACA,QAAS,EAAU,EAAK,UACxB,OAAQ,EAAS,OAAO,GAAG,KAC3B,SAAU,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,EAAS,WAAW,GAAG,IAAK,GAAM,EAAE,MAAO,GAAG,EAAS,WAAW,GAAG,IAAK,GAAM,EAAE,YAIpH,MAAO,CACH,MAAO,mDACP,YAAa,8JACb,KAAM,EACN,SAAU,QACV,MAAO,GAAG,EAAQ,4EAClB,KAAM"}