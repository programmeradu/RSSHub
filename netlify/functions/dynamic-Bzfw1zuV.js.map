{"version":3,"file":"dynamic-Bzfw1zuV.js","names":["route: Route","got"],"sources":["../../lib/routes/afdian/dynamic.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport type { Route } from '@/types';\r\n\r\nexport const route: Route = {\r\n    path: '/dynamic/:uid?',\r\n    categories: ['other'],\r\n    example: '/afdian/dynamic/@afdian',\r\n    parameters: { uid: '用户id，用户动态页面url里可找到' },\r\n    name: '用户动态',\r\n    maintainers: ['sanmmm'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const url_slug = ctx.req.param('uid').replace('@', '');\r\n    const baseUrl = 'https://afdian.com';\r\n    const userInfoRes = await got(`${baseUrl}/api/user/get-profile-by-slug`, {\r\n        searchParams: {\r\n            url_slug,\r\n        },\r\n    });\r\n    const userInfo = userInfoRes.data.data.user;\r\n    const { user_id, name, avatar } = userInfo;\r\n\r\n    const dynamicRes = await got(`${baseUrl}/api/post/get-list`, {\r\n        searchParams: {\r\n            type: 'old',\r\n            user_id,\r\n        },\r\n    });\r\n    const list = dynamicRes.data.data.list.map((item) => {\r\n        const { publish_time, title, content, pics = [], post_id } = item;\r\n        return {\r\n            title,\r\n            description: [content, pics.map((url) => `<img src=\"${url}\"/>`).join('')].filter((str) => !!str).join('<br/>'),\r\n            link: `${baseUrl}/p/${post_id}`,\r\n            pubDate: new Date(Number(publish_time) * 1000).toUTCString(),\r\n        };\r\n    });\r\n    return {\r\n        title: `${name}的爱发电动态`,\r\n        description: `${name}的爱发电动态`,\r\n        image: avatar,\r\n        link: `${baseUrl}/@${url_slug}`,\r\n        item: list,\r\n    };\r\n}\r\n"],"mappings":"gOAGA,MAAaA,EAAe,CACxB,KAAM,iBACN,WAAY,CAAC,SACb,QAAS,0BACT,WAAY,CAAE,IAAK,sBACnB,KAAM,OACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,OAAO,QAAQ,IAAK,IAC7C,EAAU,qBACV,EAAc,MAAMC,EAAI,GAAG,EAAQ,+BAAgC,CACrE,aAAc,CACV,cAGF,EAAW,EAAY,KAAK,KAAK,KACjC,CAAE,UAAS,OAAM,UAAW,EAE5B,EAAa,MAAMA,EAAI,GAAG,EAAQ,oBAAqB,CACzD,aAAc,CACV,KAAM,MACN,aAGF,EAAO,EAAW,KAAK,KAAK,KAAK,IAAK,GAAS,CACjD,GAAM,CAAE,eAAc,QAAO,UAAS,OAAO,GAAI,WAAY,EAC7D,MAAO,CACH,QACA,YAAa,CAAC,EAAS,EAAK,IAAK,GAAQ,aAAa,EAAI,MAAM,KAAK,KAAK,OAAQ,GAAQ,CAAC,CAAC,GAAK,KAAK,SACtG,KAAM,GAAG,EAAQ,KAAK,IACtB,QAAS,IAAI,KAAK,OAAO,GAAgB,KAAM,iBAGvD,MAAO,CACH,MAAO,GAAG,EAAK,QACf,YAAa,GAAG,EAAK,QACrB,MAAO,EACP,KAAM,GAAG,EAAQ,IAAI,IACrB,KAAM"}