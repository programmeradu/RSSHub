{"version":3,"file":"list-Bpjk2foU.js","names":[],"sources":["../../lib/routes/bc3ts/list.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { Media, PostResponse } from './types';\r\nimport { config } from '@/config';\r\n\r\nexport const route: Route = {\r\n    path: '/post/list/:sort?',\r\n    example: '/bc3ts/post/list',\r\n    parameters: {\r\n        sort: '排序方式，`1` 為最新，`2` 為熱門，默认為 `1`',\r\n    },\r\n    features: {\r\n        antiCrawler: true,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['web.bc3ts.net'],\r\n        },\r\n    ],\r\n    name: '動態',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nconst baseUrl = 'https://web.bc3ts.net';\r\n\r\nconst renderMedia = (media: Media[]) => art(path.join(__dirname, 'templates/media.art'), { media });\r\n\r\nasync function handler(ctx) {\r\n    const { sort = '1' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n\r\n    const response = await ofetch<PostResponse>('https://app.bc3ts.net/post/list/v2', {\r\n        headers: {\r\n            apikey: 'zlF+kaPfem%23we$2@90irpE*_RGjdw',\r\n            app_version: '3.0.28',\r\n            version: '2.0.0',\r\n            'User-Agent': config.trueUA,\r\n        },\r\n        query: {\r\n            limits: limit,\r\n            sort_type: sort,\r\n        },\r\n    });\r\n\r\n    const items = response.data.map((p) => ({\r\n        title: p.title ?? p.content.split('\\n')[0],\r\n        description: p.content.replaceAll('\\n', '<br>') + (p.media.length && renderMedia(p.media)),\r\n        link: `${baseUrl}/post/${p.id}`,\r\n        author: p.user.name,\r\n        pubDate: parseDate(p.created_time, 'x'),\r\n        category: p.group.name,\r\n        upvotes: p.like_count,\r\n        comments: p.comment_count,\r\n    }));\r\n\r\n    return {\r\n        title: `爆料公社${sort === '1' ? '最新' : '熱門'}動態`,\r\n        link: baseUrl,\r\n        language: 'zh-TW',\r\n        image: 'https://img.bc3ts.net/image/web/main/logo-white-new-2023.png',\r\n        icon: 'https://img.bc3ts.net/image/web/main/logo/logo_icon_6th_2024_192x192.png',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"iWASA,MAAa,EAAe,CACxB,KAAM,oBACN,QAAS,mBACT,WAAY,CACR,KAAM,gCAEV,SAAU,CACN,YAAa,IAEjB,MAAO,CACH,CACI,OAAQ,CAAC,mBAGjB,KAAM,KACN,YAAa,CAAC,UACd,WAGE,EAAU,wBAEV,EAAe,GAAmB,EAAI,EAAA,KAAA,EAAA,gCAA6C,CAAE,UAE3F,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAO,KAAQ,EAAI,IAAI,QACzB,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAW,MAAM,EAAqB,qCAAsC,CAC9E,QAAS,CACL,OAAQ,kCACR,YAAa,SACb,QAAS,QACT,aAAc,EAAO,QAEzB,MAAO,CACH,OAAQ,EACR,UAAW,KAIb,EAAQ,EAAS,KAAK,IAAK,IAAO,CACpC,MAAO,EAAE,OAAS,EAAE,QAAQ,MAAM;GAAM,GACxC,YAAa,EAAE,QAAQ,WAAW;EAAM,SAAW,EAAE,MAAM,QAAU,EAAY,EAAE,QACnF,KAAM,GAAG,EAAQ,QAAQ,EAAE,KAC3B,OAAQ,EAAE,KAAK,KACf,QAAS,EAAU,EAAE,aAAc,KACnC,SAAU,EAAE,MAAM,KAClB,QAAS,EAAE,WACX,SAAU,EAAE,iBAGhB,MAAO,CACH,MAAO,OAAO,IAAS,IAAM,KAAO,KAAK,IACzC,KAAM,EACN,SAAU,QACV,MAAO,+DACP,KAAM,2EACN,KAAM"}