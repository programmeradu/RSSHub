{"version":3,"file":"jk-BglaGECs.js","names":["route: Route","ofetch","list: DataItem[]","cache"],"sources":["../../lib/routes/sicau/jk.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/jk/:gid/:typeId/:sortType/:token',\r\n    categories: ['university'],\r\n    example: '/sicau/jk/0/0/2/8d95466cf63e537292b303cb92b5958c',\r\n    parameters: {\r\n        gid: '活动所属组织ID，见下表',\r\n        typeId: '活动类别ID，见下表',\r\n        sortType: '排序方式，见下表',\r\n        token: '访问令牌，可通过示例中的令牌直接访问（会过期）',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '二课活动',\r\n    maintainers: ['hualiong'],\r\n    url: 'jk.sicau.edu.cn',\r\n    description: `\r\n\r\n::: tip\r\n**本校学生**可以直接 POST \\`https://jk.sicau.edu.cn/user/login/v1.0.0/snoLogin\\` 从返回结果中的 \\`token\\` 字段拿到个人令牌，记得在url后添加以下**查询参数**：\r\n\r\n-   sid: \\`f1c97a0e81c24e98adb1ebdadca0699b\\`\r\n-   loginName: \\`你的学号\\`\r\n-   password: \\`你的i川农密码\\`\r\n\r\n:::\r\n\r\n::: warning\r\n由于i川农后台有请求限制，为避免一次性大量请求而被限流，每次只请求结果的第一页数据，即前20条\r\n:::\r\n\r\n**活动所属组织ID：**\r\n\r\n| ID   | 组织                 | ID   | 组织               | ID   | 组织                   | ID   | 组织                   |\r\n| ---- | -------------------- | ---- | ------------------ | ---- | ---------------------- | ---- | ---------------------- |\r\n| 0    | 全部组织             | 14   | 校纪委             | 28   | 食品学院               | 42   | 经济学院               |\r\n| 1    | 管理学院             | 15   | 生命科学学院       | 29   | 环境学院               | 43   | 机电学院               |\r\n| 2    | 学生心理健康服务中心 | 16   | 水利水电学院       | 30   | 国家重点实验室         | 44   | 都江堰校区综合办后管科 |\r\n| 3    | 档案馆               | 17   | 国合处             | 31   | 党委统战部             | 45   | 园艺学院               |\r\n| 4    | 马克思主义学院       | 18   | 商旅学院           | 32   | 草业科技学院           | 46   | 资源学院               |\r\n| 5    | 都江堰校区党政办     | 19   | 风景园林学院       | 33   | 商学院                 | 47   | 学生处                 |\r\n| 6    | 土木工程学院         | 20   | 建筑与城乡规划学院 | 34   | 党委组织部             | 48   | 农学院                 |\r\n| 7    | 林学院               | 21   | 体育学院           | 35   | 校团委                 | 49   | 公共管理学院           |\r\n| 8    | 动物医学院           | 22   | 校体委             | 36   | 法学院                 | 50   | 图书馆                 |\r\n| 9    | 保卫处               | 23   | 校区团委           | 37   | 水稻研究所             | 51   | 校学生会               |\r\n| 10   | 理学院               | 24   | 后勤管理处         | 38   | 研究生院               | 52   | 动物科技学院           |\r\n| 11   | 艺术与传媒学院       | 25   | 教务处             | 39   | 后勤服务总公司         | 53   | 信息工程学院           |\r\n| 12   | 大学生艺术团         | 26   | 人文学院           | 40   | 招生就业处             |      |                        |\r\n| 13   | 都江堰校区基础教学部 | 27   | 党委宣传部         | 41   | 学生社团管理与服务中心 |      |                        |\r\n\r\n**活动类别ID：**\r\n\r\n| ID   | 组织             | ID   | 组织                 | ID   | 组织           |\r\n| ---- | ---------------- | ---- | -------------------- | ---- | -------------- |\r\n| 0    | 所有类别         | 5    | 校本文化（校规校纪） | 10   | 体质测试       |\r\n| 1    | 党团学习         | 6    | 德育—社会实践        | 11   | 文化艺术活动   |\r\n| 2    | 学生干部社会工作 | 7    | 创新创业类           | 12   | 文艺演出或讲座 |\r\n| 3    | 校院班任务       | 8    | 科技学术讲座         | 13   | 劳动教育       |\r\n| 4    | 德育（志愿公益） | 9    | 体育活动（新）       |      |                |\r\n\r\n**排序方式：**\r\n\r\n| 即将开始 | 最新活动 | 可参与 |\r\n| -------  | -------- | -------- |\r\n| 1     | 2     | 4     |\r\n`,\r\n    handler: async (ctx) => {\r\n        const { gid, typeId, sortType, token } = ctx.req.param();\r\n        const $post = ofetch.create({\r\n            baseURL: 'https://jk.sicau.edu.cn/act/actInfo/v1.0.0',\r\n            headers: { 'x-access-token': token },\r\n            method: 'post',\r\n        });\r\n        const query = async (page: number) =>\r\n            await $post(`/getUserSchoolActList`, {\r\n                query: {\r\n                    gid: gidDict[gid],\r\n                    typeId: typeDict[typeId],\r\n                    sortType,\r\n                    page,\r\n                },\r\n            });\r\n\r\n        const res = await Promise.all([query(1), query(2)]);\r\n\r\n        for (const each of res) {\r\n            if (each.code !== '0') {\r\n                throw new Error(each.message);\r\n            }\r\n        }\r\n\r\n        const list: DataItem[] = [...res[0].content, ...res[1].content]\r\n            .filter((e) => e.statusName !== '待发学时')\r\n            .map((each) => ({\r\n                id: each.id,\r\n                guid: each.id,\r\n                title: each.title,\r\n                image: each.logo,\r\n            }));\r\n\r\n        const items = await Promise.all(\r\n            list.map((item) =>\r\n                cache.tryGet(String(item.id), async () => {\r\n                    const { code, message, content } = await $post(`/getActDetail?actId=${item.id}`);\r\n                    if (code === '0') {\r\n                        item.author = content.groupName;\r\n                        item.pubDate = timezone(parseDate(content.startDate, 'YYYY-MM-DD HH:mm:ss'), +8);\r\n                        item.category = [content.typeName, content.levelName];\r\n                        item.description = `<img src=\"${item.image}\" alt=\"${item.title}\" /><p style='white-space: pre-wrap'>${content.description}</p>`;\r\n\r\n                        return item;\r\n                    }\r\n                    throw new Error(message);\r\n                })\r\n            )\r\n        );\r\n\r\n        return {\r\n            title: '二课活动 - 四川农业大学',\r\n            link: 'https://jk.sicau.edu.cn/act/actInfo/v1.0.0/getUserSchoolActList',\r\n            language: 'zh-cn',\r\n            item: items as DataItem[],\r\n        };\r\n    },\r\n};\r\n\r\nconst typeDict = {\r\n    '0': '',\r\n    '1': '17a3b11f2d254518b13406ccd18a85b5',\r\n    '2': '000392a845ff47d09978c6ddd6dda2d4',\r\n    '3': '9ead58d01d3d424ea70b194910893660',\r\n    '4': 'e233038099914313950ad9058e4c7176',\r\n    '5': 'ccdec1bf8a32497998a4d2b3285e8fa0',\r\n    '6': '1db34972f7b247a6a60aac15285870d5',\r\n    '7': '3a230729aac44b3aa0127c8cdcf15555',\r\n    '8': '0157365febe548ee86848dd58c7b8b4b',\r\n    '9': 'fe94059a28e5440fb1097679b4744981',\r\n    '10': '5b91902f42854301ae60d30018f8786c',\r\n    '11': '1cee1aea9994489286fe2a7d42b6e21e',\r\n    '12': '4f7a37aa8ca2452dbf5f44fc7cfa2679',\r\n    '13': '7969c78baee34a6f90e029d95db18592',\r\n};\r\n\r\nconst gidDict = {\r\n    '0': '',\r\n    '1': '075c882582bf4392b5f858e18169c6fa',\r\n    '2': '0b6869479c1d4e69b01afa73534ddf7e',\r\n    '3': '0b9b91adfcc2494190a06b6ceb33136c',\r\n    '4': '0d0ad5dca6f24f3290c5dc62c9e534bf',\r\n    '5': '0e0d4803c89a419fa2c87ea415cf0efc',\r\n    '6': '11944f4920c645e3936a429f4da48165',\r\n    '7': '13968d883e2146febd41fea97b8e935c',\r\n    '8': '16e9229a200e4644ac9d283f44dfbd8c',\r\n    '9': '1838c6d0dd394ffebe5305a8efaabd24',\r\n    '10': '1bb0a81892a74ca792dbf726521284bc',\r\n    '11': '1cad939489de4868bcbba1366dc454e8',\r\n    '12': '22ddaea411e44df68bdb614d2e97cea1',\r\n    '13': '23fd994f03ca4174b364b371a67dcacd',\r\n    '14': '2a1fb8567c0e4c1b93d82259b8f784f6',\r\n    '15': '2a5f3f75505140cc897c2187b3dcf91a',\r\n    '16': '5016d53f98164d9c81484acbbc6b761d',\r\n    '17': '56e1f5bea3ab4921b2e3bb37bfbdf629',\r\n    '18': '597d5baff6ab469992d4ecb54f7b4c38',\r\n    '19': '607a4eefcbd549018c2e253c60b227de',\r\n    '20': '61e0696b35da46a69cbd57e2a415e919',\r\n    '21': '67c4d8cdaf04456eae344f01e67e0ca0',\r\n    '22': '70f29b197d8945be8c6f9714a1923057',\r\n    '23': '78d0b179286845e9b589cb27c5b2b3b4',\r\n    '24': '7cf23874959a4827b8c15c9f7b99eb64',\r\n    '25': '82d71d8ada514858ab30e5f58e64706e',\r\n    '26': '89c9be371ab8498499f0b3aff520f4c4',\r\n    '27': '8b459d361d4b493b918656710104a4a7',\r\n    '28': '8cd045b1390146fd8d5ad155db8b59e1',\r\n    '29': '8f231145f3664726beb551378e1f5d99',\r\n    '30': '97062a27a31e40a7a5be49475e3df099',\r\n    '31': 'ae9e85188f084cb3be8a0fa3ebf6c7b5',\r\n    '32': 'b88245cc3c9c47f8ab121ad5c2fa3282',\r\n    '33': 'ba368a3503274da781c1960ba084793f',\r\n    '34': 'be4149fac2394326b19270e3b70fd704',\r\n    '35': 'be68e601768b4e57830bbceb829a2942',\r\n    '36': 'c514507d08d3415e965abf84d9dfd31b',\r\n    '37': 'c7d5a7b282854f14aafb22ed69abef7a',\r\n    '38': 'ca1423660dd940439af1921a5c48e521',\r\n    '39': 'd09f1391b0de4667aaf8ed6313582667',\r\n    '40': 'd393b583269e420f93cf7cf07ef7b694',\r\n    '41': 'd79d6ef35687400da1c3106080ad294a',\r\n    '42': 'd850db1a4811420f934ef7c783ba72b1',\r\n    '43': 'd8f1ecac920346b79650fbd2783c9a86',\r\n    '44': 'dba67112679e4df2892a8896ac2cb898',\r\n    '45': 'dd7345a743c6464fafdded750c08a4d8',\r\n    '46': 'dfa126fc8e494259bf3d88d61afca53e',\r\n    '47': 'e1f80975b5e940f3a3e416ac45e79ce8',\r\n    '48': 'ea117c42071a40b5b08423b392bc5722',\r\n    '49': 'f4017020fe9a456599754c88c1d9a341',\r\n    '50': 'f548b78687094c428085dfb0b064ed32',\r\n    '51': 'fa5098c59a9c4db6b287744049053762',\r\n    '52': 'fccf2f15e15a479ba9b5564efee436c7',\r\n    '53': 'fcf30bbdd8004026ae9b447f2722aecf',\r\n};\r\n"],"mappings":"sUAMA,MAAaA,EAAe,CACxB,KAAM,oCACN,WAAY,CAAC,cACb,QAAS,mDACT,WAAY,CACR,IAAK,eACL,OAAQ,aACR,SAAU,WACV,MAAO,2BAEX,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,YACd,IAAK,kBACL,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAkDb,QAAS,KAAO,IAAQ,CACpB,GAAM,CAAE,MAAK,SAAQ,WAAU,SAAU,EAAI,IAAI,QAC3C,EAAQC,EAAO,OAAO,CACxB,QAAS,6CACT,QAAS,CAAE,iBAAkB,GAC7B,OAAQ,SAEN,EAAQ,KAAO,IACjB,MAAM,EAAM,wBAAyB,CACjC,MAAO,CACH,IAAK,EAAQ,GACb,OAAQ,EAAS,GACjB,WACA,UAIN,EAAM,MAAM,QAAQ,IAAI,CAAC,EAAM,GAAI,EAAM,KAE/C,IAAK,IAAM,KAAQ,EACf,GAAI,EAAK,OAAS,IACd,MAAU,MAAM,EAAK,SAI7B,IAAMC,EAAmB,CAAC,GAAG,EAAI,GAAG,QAAS,GAAG,EAAI,GAAG,SAClD,OAAQ,GAAM,EAAE,aAAe,QAC/B,IAAK,IAAU,CACZ,GAAI,EAAK,GACT,KAAM,EAAK,GACX,MAAO,EAAK,MACZ,MAAO,EAAK,QAGd,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,OAAO,EAAK,IAAK,SAAY,CACtC,GAAM,CAAE,OAAM,UAAS,WAAY,MAAM,EAAM,uBAAuB,EAAK,MAC3E,GAAI,IAAS,IAMT,MALA,GAAK,OAAS,EAAQ,UACtB,EAAK,QAAU,EAAS,EAAU,EAAQ,UAAW,uBAAwB,GAC7E,EAAK,SAAW,CAAC,EAAQ,SAAU,EAAQ,WAC3C,EAAK,YAAc,aAAa,EAAK,MAAM,SAAS,EAAK,MAAM,uCAAuC,EAAQ,YAAY,MAEnH,EAEX,MAAU,MAAM,OAK5B,MAAO,CACH,MAAO,gBACP,KAAM,kEACN,SAAU,QACV,KAAM,KAKZ,EAAW,CACb,EAAK,GACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,oCAGJ,EAAU,CACZ,EAAK,GACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,EAAK,mCACL,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM,mCACN,GAAM"}