{"version":3,"file":"liulinblog-B3VMbJdb.js","names":["route: Route","got","a","cache"],"sources":["../../lib/routes/liulinblog/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/:params{.+}?',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const params = ctx.req.param('params');\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n\r\n    const rootUrl = 'https://www.liulinblog.com';\r\n    const currentUrl = params ? new URL(params, rootUrl).href : rootUrl;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    let items = $('div.scroll')\r\n        .first()\r\n        .find('article')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('h2.entry-title a');\r\n\r\n            return {\r\n                title: a.prop('title'),\r\n                link: a.prop('href'),\r\n                description: item.find('div.entry-excerpt').html(),\r\n                author: item\r\n                    .find('span.meta-author a')\r\n                    .toArray()\r\n                    .map((a) => $(a).prop('title'))\r\n                    .join(' / '),\r\n                category: item\r\n                    .find('span.meta-category-dot a[rel=\"category\"]')\r\n                    .toArray()\r\n                    .map((c) => $(c).text()),\r\n                guid: `liulinblog-${item.prop('id')}`,\r\n                pubDate: parseDate(item.find('span.meta-date time').prop('datetime')),\r\n                comments: item.find('span.meta-comment').text() ? Number.parseInt(item.find('span.meta-comment').text().trim(), 10) : 0,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const content = load(detailResponse);\r\n\r\n                content('div[role=\"alert\"]').remove();\r\n\r\n                item.title = content('meta[property=\"og:title\"]').prop('content');\r\n                item.description = content('div.entry-content').html();\r\n                item.author = content('div.entry-meta')\r\n                    .first()\r\n                    .find('span.meta-author a')\r\n                    .toArray()\r\n                    .map((a) => content(a).prop('title'))\r\n                    .join(' / ');\r\n                item.category = content('div.entry-meta')\r\n                    .first()\r\n                    .find('span.meta-category a[rel=\"category\"]')\r\n                    .toArray()\r\n                    .map((c) => content(c).text());\r\n                item.guid = `liulinblog-${content('article').first().prop('id')}`;\r\n                item.pubDate = parseDate(content('span.meta-date time').first().prop('datetime'));\r\n                item.comments = content('h3.comments-title').text()\r\n                    ? Number.parseInt(\r\n                          content('h3.comments-title')\r\n                              .text()\r\n                              .match(/\\((\\d+)\\)/),\r\n                          10\r\n                      )\r\n                    : 0;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const icon = $('link[rel=\"icon\"]').prop('href');\r\n    const title = $('img.logo').prop('alt');\r\n\r\n    return {\r\n        item: items,\r\n        title: `${title} - ${params ? $('h1.term-title').text().split('搜索到')[0] : '最新'}`,\r\n        link: currentUrl,\r\n        description: $('meta[name=\"description\"]').prop('content'),\r\n        language: 'zh-cn',\r\n        image: $('img.logo').prop('src'),\r\n        icon,\r\n        logo: icon,\r\n        subtitle: $('p.term-description').text(),\r\n        author: title,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,gBACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,EAAI,IAAI,MAAM,UACvB,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,6BACV,EAAa,EAAS,IAAI,IAAI,EAAQ,GAAS,KAAO,EAEtD,CAAE,KAAM,GAAa,MAAMC,EAAI,GAE/B,EAAI,EAAK,GAEX,EAAQ,EAAE,cACT,QACA,KAAK,WACL,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAI,EAAK,KAAK,oBAEpB,MAAO,CACH,MAAO,EAAE,KAAK,SACd,KAAM,EAAE,KAAK,QACb,YAAa,EAAK,KAAK,qBAAqB,OAC5C,OAAQ,EACH,KAAK,sBACL,UACA,IAAK,GAAM,EAAEC,GAAG,KAAK,UACrB,KAAK,OACV,SAAU,EACL,KAAK,4CACL,UACA,IAAK,GAAM,EAAE,GAAG,QACrB,KAAM,cAAc,EAAK,KAAK,QAC9B,QAAS,EAAU,EAAK,KAAK,uBAAuB,KAAK,aACzD,SAAU,EAAK,KAAK,qBAAqB,OAAS,OAAO,SAAS,EAAK,KAAK,qBAAqB,OAAO,OAAQ,IAAM,KAIlI,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAMF,EAAI,EAAK,MAE1C,EAAU,EAAK,GA4BrB,OA1BA,EAAQ,qBAAqB,SAE7B,EAAK,MAAQ,EAAQ,6BAA6B,KAAK,WACvD,EAAK,YAAc,EAAQ,qBAAqB,OAChD,EAAK,OAAS,EAAQ,kBACjB,QACA,KAAK,sBACL,UACA,IAAK,GAAM,EAAQ,GAAG,KAAK,UAC3B,KAAK,OACV,EAAK,SAAW,EAAQ,kBACnB,QACA,KAAK,wCACL,UACA,IAAK,GAAM,EAAQ,GAAG,QAC3B,EAAK,KAAO,cAAc,EAAQ,WAAW,QAAQ,KAAK,QAC1D,EAAK,QAAU,EAAU,EAAQ,uBAAuB,QAAQ,KAAK,aACrE,EAAK,SAAW,EAAQ,qBAAqB,OACvC,OAAO,SACH,EAAQ,qBACH,OACA,MAAM,aACX,IAEJ,EAEC,MAKnB,IAAM,EAAO,EAAE,oBAAoB,KAAK,QAClC,EAAQ,EAAE,YAAY,KAAK,OAEjC,MAAO,CACH,KAAM,EACN,MAAO,GAAG,EAAM,KAAK,EAAS,EAAE,iBAAiB,OAAO,MAAM,OAAO,GAAK,OAC1E,KAAM,EACN,YAAa,EAAE,4BAA4B,KAAK,WAChD,SAAU,QACV,MAAO,EAAE,YAAY,KAAK,OAC1B,OACA,KAAM,EACN,SAAU,EAAE,sBAAsB,OAClC,OAAQ"}