{"version":3,"file":"notice-Di2Y59LT.js","names":["pageUrl: string","got","articleUrl: string","route: Route","results: { title: string; link: string; pubDate: Date }[]","cache"],"sources":["../../lib/routes/tongji/sem/_utils.ts","../../lib/routes/tongji/sem/notice.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { config } from '@/config';\r\n\r\nexport async function getNotifByPage(url): Promise<{ title: string; link: string; pubDate: Date }[]> {\r\n    const pageUrl: string = url;\r\n\r\n    try {\r\n        const response = await got.get(pageUrl, {\r\n            headers: {\r\n                'User-Agent': config.ua,\r\n            },\r\n        });\r\n\r\n        const html = response.body;\r\n        const $ = load(html);\r\n\r\n        const notifListElements = $('#page-wrap > div.maim_pages > div > div.leftmain_page > div > ul > li');\r\n\r\n        return notifListElements.toArray().map((Element) => {\r\n            const aTagFirst = $(Element).find('a.bt');\r\n            const aTagSecond = $(Element).find('a.time');\r\n\r\n            const title = aTagFirst.attr('title');\r\n            const href = aTagFirst.attr('href');\r\n            const time = aTagSecond.text().trim();\r\n\r\n            return {\r\n                title,\r\n                link: href,\r\n                pubDate: parseDate(time, 'YYYY-MM-DD'),\r\n            };\r\n        });\r\n    } catch {\r\n        // console.error(error);\r\n    }\r\n    return [];\r\n}\r\n\r\nexport async function getArticle(item) {\r\n    const articleUrl: string = item.link;\r\n\r\n    if (articleUrl.includes('sem.tongji.edu.cn/semch')) {\r\n        // console.log(articleUrl);\r\n\r\n        try {\r\n            const response = await got.get(articleUrl, {\r\n                headers: {\r\n                    'User-Agent': config.ua,\r\n                },\r\n            });\r\n\r\n            const html = response.body;\r\n            const $ = load(html);\r\n\r\n            const articleContentElement = $('#page-wrap > div.maim_pages > div > div.leftmain_page > div');\r\n            item.description = articleContentElement ? articleContentElement.html() : '';\r\n        } catch {\r\n            // console.error(error);\r\n        }\r\n    }\r\n\r\n    return item;\r\n}\r\n","// Warning: The author still knows nothing about javascript!\r\nimport { Route } from '@/types';\r\nimport { getNotifByPage, getArticle } from './_utils';\r\nimport cache from '@/utils/cache';\r\n\r\nexport const route: Route = {\r\n    path: '/sem/:type?',\r\n    categories: ['university'],\r\n    example: '/tongji/sem/notice',\r\n    parameters: { type: '通知类型，默认为 `notice`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '经济与管理学院通知',\r\n    maintainers: ['sitdownkevin'],\r\n    url: 'sem.tongji.edu.cn/semch',\r\n    handler,\r\n    description: `| 学院通知 | 招生通知 | 学术观点 | 新闻 | 活动 | 视点 | 教师与行政人员招聘 |\r\n| -------- | -------------- | ------------------ | ---- | ---------- | --------- | ------------------ |\r\n| notice   | enrollment     | academic-paper     | news | events     | focus     | collegerecruitment |\r\n`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type') || 'notice';\r\n    const subType = new Set(['enrollment', 'academic-paper', 'news', 'events', 'focus', 'collegerecruitment']);\r\n    const subTypeName = {\r\n        notice: '学院通知',\r\n        enrollment: '招生通知',\r\n        'academic-paper': '学术观点',\r\n        news: '新闻',\r\n        events: '活动',\r\n        focus: '视点',\r\n        collegerecruitment: '教师与行政人员招聘',\r\n    };\r\n\r\n    const url = `https://sem.tongji.edu.cn/semch/category/frontpage/${subType.has(type) ? type : 'notice'}`;\r\n\r\n    const results: { title: string; link: string; pubDate: Date }[] = await getNotifByPage(url);\r\n\r\n    const resultsWithContent = await Promise.all(results.map((item) => cache.tryGet(item.link, () => getArticle(item))));\r\n\r\n    // feed the data to rss\r\n    return {\r\n        title: '同济大学经济与管理学院',\r\n        description: String(subType.has(type) ? subTypeName[type] : '学院通知'),\r\n        image: 'https://upload.wikimedia.org/wikipedia/zh/f/f8/Tongji_University_Emblem.svg',\r\n        icon: 'https://upload.wikimedia.org/wikipedia/zh/f/f8/Tongji_University_Emblem.svg',\r\n        logo: 'https://upload.wikimedia.org/wikipedia/zh/f/f8/Tongji_University_Emblem.svg',\r\n        link: 'https://sem.tongji.edu.cn/semch',\r\n        item: resultsWithContent,\r\n    };\r\n}\r\n"],"mappings":"yXAKA,eAAsB,EAAe,EAAgE,CACjG,IAAMA,EAAkB,EAExB,GAAI,CACA,IAAM,EAAW,MAAMC,EAAI,IAAI,EAAS,CACpC,QAAS,CACL,aAAc,EAAO,MAIvB,EAAO,EAAS,KAChB,EAAI,EAAK,GAET,EAAoB,EAAE,yEAE5B,OAAO,EAAkB,UAAU,IAAK,GAAY,CAChD,IAAM,EAAY,EAAE,GAAS,KAAK,QAC5B,EAAa,EAAE,GAAS,KAAK,UAE7B,EAAQ,EAAU,KAAK,SACvB,EAAO,EAAU,KAAK,QACtB,EAAO,EAAW,OAAO,OAE/B,MAAO,CACH,QACA,KAAM,EACN,QAAS,EAAU,EAAM,sBAG7B,EAGR,MAAO,GAGX,eAAsB,EAAW,EAAM,CACnC,IAAMC,EAAqB,EAAK,KAEhC,GAAI,EAAW,SAAS,2BAGpB,GAAI,CACA,IAAM,EAAW,MAAMD,EAAI,IAAI,EAAY,CACvC,QAAS,CACL,aAAc,EAAO,MAIvB,EAAO,EAAS,KAChB,EAAI,EAAK,GAET,EAAwB,EAAE,+DAChC,EAAK,YAAc,EAAwB,EAAsB,OAAS,QACtE,EAKZ,OAAO,EC1DX,MAAaE,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,cACb,QAAS,qBACT,WAAY,CAAE,KAAM,qBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,YACN,YAAa,CAAC,gBACd,IAAK,0BACL,UACA,YAAa;;;GAMjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,SAChC,EAAU,IAAI,IAAI,CAAC,aAAc,iBAAkB,OAAQ,SAAU,QAAS,uBAC9E,EAAc,CAChB,OAAQ,OACR,WAAY,OACZ,iBAAkB,OAClB,KAAM,KACN,OAAQ,KACR,MAAO,KACP,mBAAoB,aAGlB,EAAM,sDAAsD,EAAQ,IAAI,GAAQ,EAAO,WAEvFC,EAA4D,MAAM,EAAe,GAEjF,EAAqB,MAAM,QAAQ,IAAI,EAAQ,IAAK,GAASC,EAAM,OAAO,EAAK,SAAY,EAAW,MAG5G,MAAO,CACH,MAAO,cACP,YAAa,OAAO,EAAQ,IAAI,GAAQ,EAAY,GAAQ,QAC5D,MAAO,8EACP,KAAM,8EACN,KAAM,8EACN,KAAM,kCACN,KAAM"}