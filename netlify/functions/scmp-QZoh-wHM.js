import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as n}from"./got-CdvI2yKX.js";import{parseItem as r}from"./utils-0UKlELVQ.js";import{load as i}from"cheerio";const a={path:`/:category_id`,categories:[`traditional-media`],example:`/scmp/3`,parameters:{category_id:`Category`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`scmp.com/rss/:category_id/feed`]}],name:`News`,maintainers:[`proletarius101`],handler:s,description:`See the [official RSS page](https://www.scmp.com/rss) to get the ID of each category. This route provides fulltext that the offical feed doesn't.`},o=e=>{if(!e)return;let t={};for(let n in e)Object.hasOwn(e,n)&&(t[n]=e[n]);return t};async function s(a){let s=a.req.param(`category_id`),c=`https://www.scmp.com/rss/${s}/feed`,{data:l}=await n(c),u=i(l,{xmlMode:!0}),d=u(`item`).toArray().map(e=>{let n=u(e),r=n.find(`enclosure`).first(),i=n.find(String.raw`media\:content`).toArray()[0],a=n.find(String.raw`media\:thumbnail`).toArray()[0];return{title:n.find(`title`).text(),description:n.find(`description`).text(),link:n.find(`link`).text().split(`?utm_source`)[0],author:n.find(`author`).text(),pubDate:t(n.find(`pubDate`).text()),enclosure_url:r?.attr(`url`),enclosure_length:r?.attr(`length`),enclosure_type:r?.attr(`type`),media:{content:i?o(i.attribs):{},thumbnail:a?.attribs?o(a.attribs):void 0}}}),f=await Promise.all(d.map(t=>e.tryGet(t.link,()=>r(t))));return a.set(`json`,{items:f}),{title:u(`channel > title`).text(),link:u(`channel > link`).text(),description:u(`channel > description`).text(),item:f,language:`en-hk`,icon:`https://assets.i-scmp.com/static/img/icons/scmp-icon-256x256.png`,logo:`https://customerservice.scmp.com/img/logo_scmp@2x.png`,image:u(`channel > image > url`).text()}}export{a as route};
//# sourceMappingURL=scmp-QZoh-wHM.js.map