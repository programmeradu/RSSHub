{"version":3,"file":"album-C0W9xeNQ.js","names":[],"sources":["../../lib/routes/iqiyi/album.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: '/album/:id',\r\n    categories: ['multimedia'],\r\n    example: '/iqiyi/album/神武天尊-2020-1b4lufwxd7h',\r\n    parameters: { id: '剧集 id, 可在该主页 URL 中找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '剧集',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    description: `::: tip\r\n  可抓取內容根据服务器所在地区而定\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n\r\n    const { data: response } = await got(`https://www.iq.com/album/${id}`);\r\n\r\n    const $ = load(response);\r\n    const nextData = JSON.parse($('#__NEXT_DATA__').text());\r\n    const { album } = nextData.props.initialState;\r\n\r\n    const {\r\n        data: { data: baseInfo },\r\n    } = await got(`https://pcw-api.iqiyi.com/album/album/baseinfo/${album.videoAlbumInfo.albumId}`);\r\n\r\n    if (Object.keys(album.cacheAlbumList).length === 0) {\r\n        throw new InvalidParameterError(`${baseInfo.name} is not available in this server region.`);\r\n    }\r\n\r\n    let pos = 1;\r\n    let hasMore = false;\r\n    let epgs = [];\r\n    do {\r\n        const {\r\n            data: { data },\r\n            // eslint-disable-next-line no-await-in-loop\r\n        } = await got(`https://pcw-api.iq.com/api/v2/episodeListSource/${album.videoAlbumInfo.albumId}`, {\r\n            searchParams: {\r\n                platformId: 3,\r\n                modeCode: 'intl',\r\n                langCode: 'zh_cn',\r\n                endOrder: album.videoAlbumInfo.maxOrder,\r\n                startOrder: pos,\r\n            },\r\n        });\r\n        epgs = [...epgs, ...data.epg];\r\n        pos = data.pos;\r\n        hasMore = data.hasMore;\r\n    } while (hasMore);\r\n\r\n    const items = epgs.map((item) => ({\r\n        title: item.name,\r\n        description: art(path.join(__dirname, 'templates/album.art'), {\r\n            item,\r\n        }),\r\n        link: `https://www.iq.com/play/${item.playLocSuffix}`,\r\n        pubDate: parseDate(item.initIssueTime),\r\n    }));\r\n\r\n    return {\r\n        title: baseInfo.name,\r\n        description: baseInfo.description,\r\n        image: album.videoAlbumInfo.albumFocus1024,\r\n        link: `https://www.iq.com/album/${album.videoAlbumInfo.albumLocSuffix}`,\r\n        item: items,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"gfASA,MAAa,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,cACb,QAAS,qCACT,WAAY,CAAE,GAAI,wBAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,UACd,UACA,YAAa;;MAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MAEnB,CAAE,KAAM,GAAa,MAAM,EAAI,4BAA4B,KAE3D,EAAI,EAAK,GACT,EAAW,KAAK,MAAM,EAAE,kBAAkB,QAC1C,CAAE,SAAU,EAAS,MAAM,aAE3B,CACF,KAAM,CAAE,KAAM,IACd,MAAM,EAAI,kDAAkD,EAAM,eAAe,WAErF,GAAI,OAAO,KAAK,EAAM,gBAAgB,SAAW,EAC7C,MAAM,IAAI,EAAsB,GAAG,EAAS,KAAK,2CAGrD,IAAI,EAAM,EACN,EAAU,GACV,EAAO,GACX,EAAG,CACC,GAAM,CACF,KAAM,CAAE,SAER,MAAM,EAAI,mDAAmD,EAAM,eAAe,UAAW,CAC7F,aAAc,CACV,WAAY,EACZ,SAAU,OACV,SAAU,QACV,SAAU,EAAM,eAAe,SAC/B,WAAY,KAGpB,EAAO,CAAC,GAAG,EAAM,GAAG,EAAK,KACzB,EAAM,EAAK,IACX,EAAU,EAAK,cACV,GAET,IAAM,EAAQ,EAAK,IAAK,IAAU,CAC9B,MAAO,EAAK,KACZ,YAAa,EAAI,EAAA,KAAA,EAAA,gCAA6C,CAC1D,SAEJ,KAAM,2BAA2B,EAAK,gBACtC,QAAS,EAAU,EAAK,kBAG5B,MAAO,CACH,MAAO,EAAS,KAChB,YAAa,EAAS,YACtB,MAAO,EAAM,eAAe,eAC5B,KAAM,4BAA4B,EAAM,eAAe,iBACvD,KAAM,EACN,WAAY"}