{"version":3,"file":"stock-comments-CUW5h0VM.js","names":[],"sources":["../../lib/routes/xueqiu/stock-comments.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport sanitizeHtml from 'sanitize-html';\r\n\r\nexport const route: Route = {\r\n    path: '/stock_comments/:id',\r\n    categories: ['finance'],\r\n    example: '/xueqiu/stock_comments/SZ002626',\r\n    parameters: { id: '股票代码（需要带上交易所）' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['xueqiu.com/S/:id'],\r\n        },\r\n    ],\r\n    name: '股票评论',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n\r\n    const res = await got({\r\n        method: 'get',\r\n        url: `https://xueqiu.com/query/v1/symbol/search/status?u=11111&count=100&comment=0&symbol=${id}&source=all&sort=time`,\r\n    });\r\n\r\n    // 获取stock_name\r\n    const stock_name = await cache.tryGet(`stock_name_${id}`, async () => {\r\n        const res = await got({\r\n            method: 'get',\r\n            url: `https://xueqiu.com/S/${id}`,\r\n        });\r\n        const $ = load(res.data); // 使用 cheerio 加载返回的 HTML\r\n        return $('.stock-name').text().split('(')[0];\r\n    });\r\n\r\n    const data = res.data.list;\r\n    return {\r\n        title: `${id} ${stock_name} - 评论`,\r\n        link: `https://xueqiu.com/S/${id}`,\r\n        description: `${stock_name} - 评论`,\r\n        item: data.map((item) => {\r\n            let link = `https://xueqiu.com${item.target}`;\r\n            if (item.quote_cards) {\r\n                link = item.quote_cards[0].target_url;\r\n            }\r\n            const description = art(path.join(__dirname, 'templates/comments_description.art'), { item });\r\n            return {\r\n                title: item.title || sanitizeHtml(item.text, { allowedTags: [], allowedAttributes: {} }),\r\n                description,\r\n                pubDate: parseDate(item.created_at),\r\n                link,\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"qfAUA,MAAa,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,WACb,QAAS,kCACT,WAAY,CAAE,GAAI,iBAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,sBAGjB,KAAM,OACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MAEnB,EAAM,MAAM,EAAI,CAClB,OAAQ,MACR,IAAK,uFAAuF,EAAG,yBAI7F,EAAa,MAAM,EAAM,OAAO,cAAc,IAAM,SAAY,CAClE,IAAM,EAAM,MAAM,EAAI,CAClB,OAAQ,MACR,IAAK,wBAAwB,MAE3B,EAAI,EAAK,EAAI,MACnB,OAAO,EAAE,eAAe,OAAO,MAAM,KAAK,KAGxC,EAAO,EAAI,KAAK,KACtB,MAAO,CACH,MAAO,GAAG,EAAG,GAAG,EAAW,OAC3B,KAAM,wBAAwB,IAC9B,YAAa,GAAG,EAAW,OAC3B,KAAM,EAAK,IAAK,GAAS,CACrB,IAAI,EAAO,qBAAqB,EAAK,SACjC,EAAK,cACL,EAAO,EAAK,YAAY,GAAG,YAE/B,IAAM,EAAc,EAAI,EAAA,KAAA,EAAA,+CAA4D,CAAE,SACtF,MAAO,CACH,MAAO,EAAK,OAAS,EAAa,EAAK,KAAM,CAAE,YAAa,GAAI,kBAAmB,KACnF,cACA,QAAS,EAAU,EAAK,YACxB"}