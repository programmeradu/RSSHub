{"version":3,"file":"profile-VCxrN9ic.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/link3/profile.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nexport const route: Route = {\r\n    path: '/profile/:handle',\r\n    name: 'Link3 Profile',\r\n    url: 'link3.to',\r\n    maintainers: ['cxheng315'],\r\n    example: '/link3/profile/synfutures_defi',\r\n    parameters: { handle: 'Profile handle' },\r\n    categories: ['other'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['link3.to/:handle'],\r\n            target: '/:handle',\r\n        },\r\n    ],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const url = 'https://api.cyberconnect.dev/profile/';\r\n\r\n    const handle = ctx.req.param('handle');\r\n\r\n    const response = await ofetch(url, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n        },\r\n        body: {\r\n            variables: {\r\n                handle,\r\n            },\r\n            query: `\r\n                query getProfile($id: ID, $handle: String) {\r\n                    profile(id: $id, handle: $handle) {\r\n                        status\r\n                        data {\r\n                            handle\r\n                            ... on OrgProfile {\r\n                                displayName\r\n                                bio\r\n                                profilePicture\r\n                                backgroundPicture\r\n                                __typename\r\n                            }\r\n                            ... on PerProfile {\r\n                                bio\r\n                                personalDisplayName: displayName {\r\n                                    displayName\r\n                                }\r\n                                personalProfilePicture: profilePicture {\r\n                                    picture\r\n                                }\r\n                                personalBackgroundPicture: backgroundPicture {\r\n                                    picture\r\n                                }\r\n                                __typename\r\n                            }\r\n                            blocks {\r\n                                ... on Block {\r\n                                    ... on EventBlock {\r\n                                        __typename\r\n                                        events {\r\n                                            id\r\n                                            title\r\n                                            info\r\n                                            posterUrl\r\n                                            startTimestamp\r\n                                            endTimestamp\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n            `,\r\n        },\r\n    });\r\n\r\n    const status = response.data.profile.status;\r\n\r\n    if (status !== 'SUCCESS') {\r\n        return {\r\n            title: 'Error',\r\n            description: 'Profile not found',\r\n            items: [\r\n                {\r\n                    title: 'Error',\r\n                    description: 'Profile not found',\r\n                    link: `https://link3.to/${handle}`,\r\n                },\r\n            ],\r\n        };\r\n    }\r\n\r\n    const profile = response.data.profile.data;\r\n\r\n    const items = profile.blocks\r\n        .filter((block) => block.__typename === 'EventBlock')\r\n        .flatMap((block) => block.events)\r\n        .map((event) => ({\r\n            title: event.title,\r\n            link: `https://link3.to/e/${event.id}`,\r\n            description: event.info ?? '',\r\n            author: profile.handle,\r\n            guid: event.id,\r\n            pubDate: event.startTimestamp ? parseDate(event.startTimestamp * 1000) : null,\r\n            itunes_item_image: event.posterUrl,\r\n            itunes_duration: event.endTimestamp - event.startTimestamp,\r\n        }));\r\n\r\n    return {\r\n        title: profile.displayName ?? profile.personalDisplayName.displayName,\r\n        link: `https://link3.to/${profile.handle}`,\r\n        description: profile.bio,\r\n        logo: profile.profilePicture ?? profile.personalProfilePicture.picture,\r\n        image: profile.profilePicture ?? profile.personalProfilePicture.picture,\r\n        author: profile.handle,\r\n        item:\r\n            items && items.length > 0\r\n                ? items\r\n                : [\r\n                      {\r\n                          title: 'No events',\r\n                          description: 'No events',\r\n                          link: `https://link3.to/${handle}`,\r\n                      },\r\n                  ],\r\n    };\r\n}\r\n"],"mappings":"gOAIA,MAAaA,EAAe,CACxB,KAAM,mBACN,KAAM,gBACN,IAAK,WACL,YAAa,CAAC,aACd,QAAS,iCACT,WAAY,CAAE,OAAQ,kBACtB,WAAY,CAAC,SACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,oBACT,OAAQ,aAGhB,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAEM,EAAS,EAAI,IAAI,MAAM,UAEvB,EAAW,MAAMC,EAAO,wCAAK,CAC/B,OAAQ,OACR,QAAS,CACL,eAAgB,oBAEpB,KAAM,CACF,UAAW,CACP,UAEJ,MAAO;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;iBAiDT,EAAS,EAAS,KAAK,QAAQ,OAErC,GAAI,IAAW,UACX,MAAO,CACH,MAAO,QACP,YAAa,oBACb,MAAO,CACH,CACI,MAAO,QACP,YAAa,oBACb,KAAM,oBAAoB,OAM1C,IAAM,EAAU,EAAS,KAAK,QAAQ,KAEhC,EAAQ,EAAQ,OACjB,OAAQ,GAAU,EAAM,aAAe,cACvC,QAAS,GAAU,EAAM,QACzB,IAAK,IAAW,CACb,MAAO,EAAM,MACb,KAAM,sBAAsB,EAAM,KAClC,YAAa,EAAM,MAAQ,GAC3B,OAAQ,EAAQ,OAChB,KAAM,EAAM,GACZ,QAAS,EAAM,eAAiB,EAAU,EAAM,eAAiB,KAAQ,KACzE,kBAAmB,EAAM,UACzB,gBAAiB,EAAM,aAAe,EAAM,kBAGpD,MAAO,CACH,MAAO,EAAQ,aAAe,EAAQ,oBAAoB,YAC1D,KAAM,oBAAoB,EAAQ,SAClC,YAAa,EAAQ,IACrB,KAAM,EAAQ,gBAAkB,EAAQ,uBAAuB,QAC/D,MAAO,EAAQ,gBAAkB,EAAQ,uBAAuB,QAChE,OAAQ,EAAQ,OAChB,KACI,GAAS,EAAM,OAAS,EAClB,EACA,CACI,CACI,MAAO,YACP,YAAa,YACb,KAAM,oBAAoB"}