{"version":3,"file":"files-DCJbo272.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/alipan/files.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { AnonymousShareInfo, ShareList, TokenResponse } from './types';\r\n\r\nexport const route: Route = {\r\n    path: '/files/:share_id/:parent_file_id?',\r\n    example: '/alipan/files/jjtKEgXJAtC/64a957744876479ab17941b29d1289c6ebdd71ef',\r\n    parameters: { share_id: '分享 id，可以从分享页面 URL 中找到', parent_file_id: '文件夹 id，可以从文件夹页面 URL 中找到' },\r\n    radar: [\r\n        {\r\n            source: ['www.alipan.com/s/:share_id/folder/:parent_file_id', 'www.alipan.com/s/:share_id'],\r\n        },\r\n    ],\r\n    name: '文件列表',\r\n    maintainers: ['DIYgod'],\r\n    handler,\r\n    url: 'www.alipan.com/s',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { share_id, parent_file_id } = ctx.req.param();\r\n    const url = `https://www.aliyundrive.com/s/${share_id}${parent_file_id ? `/folder/${parent_file_id}` : ''}`;\r\n\r\n    const headers = {\r\n        referer: 'https://www.aliyundrive.com/',\r\n        origin: 'https://www.aliyundrive.com',\r\n        'x-canary': 'client=web,app=share,version=v2.3.1',\r\n    };\r\n\r\n    const shareRes = await ofetch<AnonymousShareInfo>('https://api.aliyundrive.com/adrive/v3/share_link/get_share_by_anonymous', {\r\n        method: 'POST',\r\n        headers,\r\n        query: {\r\n            share_id,\r\n        },\r\n        body: {\r\n            share_id,\r\n        },\r\n    });\r\n\r\n    const tokenRes = await ofetch<TokenResponse>('https://api.aliyundrive.com/v2/share_link/get_share_token', {\r\n        method: 'POST',\r\n        headers,\r\n        body: {\r\n            share_id,\r\n        },\r\n    });\r\n    const shareToken = tokenRes.share_token;\r\n\r\n    const listRes = await ofetch<ShareList>('https://api.aliyundrive.com/adrive/v2/file/list_by_share', {\r\n        method: 'POST',\r\n        headers: {\r\n            ...headers,\r\n            'x-share-token': shareToken,\r\n        },\r\n        body: {\r\n            limit: 100,\r\n            order_by: 'created_at',\r\n            order_direction: 'DESC',\r\n            parent_file_id: parent_file_id || 'root',\r\n            share_id,\r\n        },\r\n    });\r\n\r\n    const result = listRes.items.map((item) => ({\r\n        title: item.name,\r\n        description: item.name + (item.thumbnail ? `<img src=\"${item.thumbnail}\">` : ''),\r\n        link: url,\r\n        pubDate: parseDate(item.created_at),\r\n        updated: parseDate(item.updated_at),\r\n        guid: item.file_id,\r\n    }));\r\n\r\n    return {\r\n        title: `${shareRes.display_name || `${share_id}${parent_file_id ? `-${parent_file_id}` : ''}`}-阿里云盘`,\r\n        link: url,\r\n        item: result,\r\n    };\r\n}\r\n"],"mappings":"gOAKA,MAAaA,EAAe,CACxB,KAAM,oCACN,QAAS,qEACT,WAAY,CAAE,SAAU,wBAAyB,eAAgB,2BACjE,MAAO,CACH,CACI,OAAQ,CAAC,oDAAqD,gCAGtE,KAAM,OACN,YAAa,CAAC,UACd,UACA,IAAK,oBAGT,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAU,kBAAmB,EAAI,IAAI,QACvC,EAAM,iCAAiC,IAAW,EAAiB,WAAW,IAAmB,KAEjG,EAAU,CACZ,QAAS,+BACT,OAAQ,8BACR,WAAY,uCAGV,EAAW,MAAMC,EAA2B,0EAA2E,CACzH,OAAQ,OACR,UACA,MAAO,CACH,YAEJ,KAAM,CACF,cAIF,EAAW,MAAMA,EAAsB,4DAA6D,CACtG,OAAQ,OACR,UACA,KAAM,CACF,cAGF,EAAa,EAAS,YAEtB,EAAU,MAAMA,EAAkB,2DAA4D,CAChG,OAAQ,OACR,QAAS,CACL,GAAG,EACH,gBAAiB,GAErB,KAAM,CACF,MAAO,IACP,SAAU,aACV,gBAAiB,OACjB,eAAgB,GAAkB,OAClC,cAIF,EAAS,EAAQ,MAAM,IAAK,IAAU,CACxC,MAAO,EAAK,KACZ,YAAa,EAAK,MAAQ,EAAK,UAAY,aAAa,EAAK,UAAU,IAAM,IAC7E,KAAM,EACN,QAAS,EAAU,EAAK,YACxB,QAAS,EAAU,EAAK,YACxB,KAAM,EAAK,WAGf,MAAO,CACH,MAAO,GAAG,EAAS,cAAgB,GAAG,IAAW,EAAiB,IAAI,IAAmB,KAAK,OAC9F,KAAM,EACN,KAAM"}