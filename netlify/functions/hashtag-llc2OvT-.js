import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./proxy-D7ccvALx.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{art as n}from"./render-CxhTJIsl.js";import{parseDate as r}from"./parse-date-Bgabdhlb.js";import{invalid_parameter_default as i}from"./invalid-parameter-CUJdROXf.js";import{puppeteer_default as a}from"./puppeteer-f0D6AISB.js";import{fallback as o,queryToBoolean as s}from"./readable-social-D7TWDGpz.js";import{getOriginAvatar as c,proxyVideo as l,resolveUrl as u,templates as d}from"./utils-ulJkQMHi.js";const f={path:`/hashtag/:cid/:routeParams?`,categories:[`social-media`],example:`/douyin/hashtag/1592824105719812`,parameters:{cid:`标签 ID，可在标签页面 URL 中找到`,routeParams:`额外参数，query string 格式，请参阅上面的表格`},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`douyin.com/hashtag/:cid`],target:`/hashtag/:cid`}],name:`标签`,maintainers:[`TonyRL`],handler:p};async function p(f){let p=f.req.param(`cid`);if(Number.isNaN(p))throw new i(`Invalid tag ID. Tag ID should be a number.`);let m=Object.fromEntries(new URLSearchParams(f.req.param(`routeParams`))),h=o(void 0,s(m.embed),!1),g=o(void 0,s(m.iframe),!1),_=u(m.relay,!0,!0),v=`https://www.douyin.com/hashtag/${p}`,y=await t.tryGet(`douyin:hashtag:${p}`,async()=>{let e=await a(),t=await e.newPage();await t.setRequestInterception(!0);let n=``;t.on(`request`,e=>{e.resourceType()===`document`||e.resourceType()===`script`||e.resourceType()===`xhr`?e.continue():e.abort()}),t.on(`response`,async e=>{let t=e.request();t.url().includes(`/v1/web/challenge/aweme`)&&(n=await e.json())}),await t.goto(v,{waitUntil:`networkidle2`}),await t.waitForSelector(`#RENDER_DATA`);let r=await t.evaluate(()=>document.querySelector(`#RENDER_DATA`).textContent);await e.close();let i=JSON.parse(decodeURIComponent(r)),o=Object.keys(i).find(e=>i[e].topicDetail);return i[o].defaultData=n.aweme_list,i[o]},e.cache.routeExpire,!1),b=y.topicDetail,x=b.chaName,S=c(b.hashtagProfile),C=y.defaultData,w=C.map(e=>{let t=e.video&&e.video.bit_rate&&e.video.bit_rate.map(e=>u(e.play_addr.url_list[0]));_&&(t=t.map(e=>l(e,_)));let i=e.video&&e.video.duration;i=i&&i/1e3;let a;a=a||e.video&&e.video.origin_cover&&e.video.origin_cover.url_list.at(-1),a=a&&u(a);let o=e.desc&&e.desc.replaceAll(`
`,`<br>`),s=n(h&&t?d.embed:d.cover,{img:a,videoList:t,duration:i});s=h&&t&&g?n(d.iframe,{content:s}):s;let c=n(d.desc,{desc:o,media:s});return{title:e.desc,description:c,link:`https://www.douyin.com/video/${e.aweme_id}`,pubDate:r(e.create_time,`X`),category:e.text_extra.map(e=>e.hashtag_name),author:e.author.nickname}});return{title:x,description:`${b.viewCount} 次播放`,image:S,link:v,item:w}}export{f as route};
//# sourceMappingURL=hashtag-llc2OvT-.js.map