{"version":3,"file":"news-CxUPSQHr.js","names":["route: Route","ofetch","cache","response","$"],"sources":["../../lib/routes/kelownacapnews/news.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/:type',\r\n    categories: ['new-media'],\r\n    example: '/kelownacapnews/local-news',\r\n    parameters: { type: 'Type of news' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.kelownacapnews.com/:type'],\r\n            target: '/:type',\r\n        },\r\n    ],\r\n    name: 'News',\r\n    maintainers: ['hualiong'],\r\n    url: 'www.kelownacapnews.com',\r\n    description: `\\`type\\` is as follows:\r\n  \r\n| News type     | Value         | News type    | Value        |\r\n| ------------- | ------------- | ------------ | ------------ |\r\n| News          | news          | Sports       | sports       |\r\n| Local News    | local-news    | Business     | business     |\r\n| Canadian News | national-news | Trending Now | trending-now |\r\n| World News    | world-news    | Opinion      | opinion      |\r\n| Entertainment | entertainment |              |              |`,\r\n    handler: async (ctx) => {\r\n        const type = ctx.req.param('type');\r\n        const baseURL = 'https://www.kelownacapnews.com';\r\n\r\n        const response = await ofetch(`${baseURL}/${type}`);\r\n        const $ = load(response);\r\n\r\n        const list = $('.media')\r\n            .toArray()\r\n            .map((item): DataItem => {\r\n                const a = $(item);\r\n                return {\r\n                    title: a.find('.media-heading').text(),\r\n                    pubDate: parseDate(a.find('.media-links time').attr('datetime')!),\r\n                    link: baseURL + a.attr('href'),\r\n                };\r\n            });\r\n\r\n        const items = await Promise.all(\r\n            list.map((item) =>\r\n                cache.tryGet(item.link!, async () => {\r\n                    const response = await ofetch(item.link!);\r\n                    const $ = load(response);\r\n\r\n                    let image = $('.details-file')!;\r\n                    if (!image.length) {\r\n                        image = $('#sliderImgs .tablist-item .galleryWrap');\r\n                    }\r\n                    const byline = $('.details-byline');\r\n                    const profileTitle = byline.find('.profile-title');\r\n                    if (profileTitle.length) {\r\n                        item.author = profileTitle.find('a').text();\r\n                    }\r\n                    let label = '';\r\n                    if (image.length > 1) {\r\n                        for (const e of image.toArray()) {\r\n                            const img = $(e);\r\n                            label += `<figure style=\"margin: 10px 0 0 0\"><img src='${img.data('src')}' /><figcaption>${img.attr('title')}</figcaption></figure>`;\r\n                        }\r\n                    } else {\r\n                        label = `<figure style=\"margin: 0\">${image.html()!}</figure>`;\r\n                    }\r\n                    item.description = label + $('.details-body').html()!;\r\n\r\n                    return item;\r\n                })\r\n            )\r\n        );\r\n\r\n        return {\r\n            title: `${$('.body-title').text()} - Kelowna Capital News`,\r\n            link: `${baseURL}/${type}`,\r\n            item: items as DataItem[],\r\n        };\r\n    },\r\n};\r\n"],"mappings":"mTAMA,MAAaA,EAAe,CACxB,KAAM,SACN,WAAY,CAAC,aACb,QAAS,6BACT,WAAY,CAAE,KAAM,gBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,gCACT,OAAQ,WAGhB,KAAM,OACN,YAAa,CAAC,YACd,IAAK,yBACL,YAAa;;;;;;;;iEASb,QAAS,KAAO,IAAQ,CACpB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAU,iCAEV,EAAW,MAAMC,EAAO,GAAG,EAAQ,GAAG,KACtC,EAAI,EAAK,GAET,EAAO,EAAE,UACV,UACA,IAAK,GAAmB,CACrB,IAAM,EAAI,EAAE,GACZ,MAAO,CACH,MAAO,EAAE,KAAK,kBAAkB,OAChC,QAAS,EAAU,EAAE,KAAK,qBAAqB,KAAK,aACpD,KAAM,EAAU,EAAE,KAAK,WAI7B,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAO,SAAY,CACjC,IAAMC,EAAW,MAAMF,EAAO,EAAK,MAC7BG,EAAI,EAAKD,GAEX,EAAQC,EAAE,iBACT,EAAM,SACP,EAAQA,EAAE,2CAEd,IAAM,EAASA,EAAE,mBACX,EAAe,EAAO,KAAK,kBAC7B,EAAa,SACb,EAAK,OAAS,EAAa,KAAK,KAAK,QAEzC,IAAI,EAAQ,GACZ,GAAI,EAAM,OAAS,EACf,IAAK,IAAM,KAAK,EAAM,UAAW,CAC7B,IAAM,EAAMA,EAAE,GACd,GAAS,gDAAgD,EAAI,KAAK,OAAO,kBAAkB,EAAI,KAAK,SAAS,6BAGjH,EAAQ,6BAA6B,EAAM,OAAQ,WAIvD,MAFA,GAAK,YAAc,EAAQA,EAAE,iBAAiB,OAEvC,MAKnB,MAAO,CACH,MAAO,GAAG,EAAE,eAAe,OAAO,yBAClC,KAAM,GAAG,EAAQ,GAAG,IACpB,KAAM"}