import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import{logger_default as n}from"./logger-CWOoofbD.js";import"./proxy-D7ccvALx.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as r}from"./cache-kimkMTWJ.js";import{art as i}from"./render-CxhTJIsl.js";import{parseDate as a}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as o}from"./got-CdvI2yKX.js";import{puppeteer_default as s}from"./puppeteer-f0D6AISB.js";import{setCookies as c}from"./puppeteer-utils-DuxVCYwW.js";import l from"node:path";import{load as u}from"cheerio";import{CookieJar as d}from"tough-cookie";t();const f={path:`/:topicPath{.+}?`,radar:[{source:[`pnas.org/*topicPath`],target:`/:topicPath`}],name:`Unknown`,maintainers:[],handler:p,url:`pnas.org/*topicPath`};async function p(t){let f=`https://www.pnas.org`,p=t.req.param(`topicPath`),m=`${f}/${p??`latest`}`,h=await r.get(`pnas:cookieJar`),g=!h;h=g?new d:d.fromJSON(h);let{data:_}=await o(m,{cookieJar:h});g&&await r.set(`pnas:cookieJar`,h.toJSON());let v=u(_),y=v(`.card--row-reversed .card-content`).toArray().map(e=>{e=v(e);let t=e.find(`.article-title a`);return{title:t.text(),link:new URL(t.attr(`href`),f).href,pubDate:a(e.find(`.card__meta__date`).text())}}),b=await s(),x=await Promise.all(y.map(t=>r.tryGet(t.link,async()=>{let r=await b.newPage();await c(r,await h.getCookieString(t.link),`.pnas.org`),await r.setRequestInterception(!0),r.on(`request`,e=>{e.resourceType()===`document`?e.continue():e.abort()}),n.http(`Requesting ${t.link}`),await r.goto(t.link,{waitUntil:`domcontentloaded`,referer:m}),await r.waitForSelector(`.core-container`);let a=await r.evaluate(()=>document.documentElement.innerHTML);await r.close();let o=u(a),s=JSON.parse(o(`script`).text().match(/PNASdataLayer =(.*?);/)[1]);o(`.signup-alert-ad, .citations-truncation button`).remove();let{keywords:d,topic:f}=s.page.attributes;return t.category=[...d,f],t.author=s.page.pageInfo.author,t.doi=s.page.pageInfo.DOI,t.description=i(l.join(e,`templates/article-89bd2a6c.art`),{access:s.user.access===`yes`,abstracts:o(`#abstracts .core-container`).html(),articleBody:o(`[property=articleBody]`).html(),dataAvailability:o(`#data-availability`).html(),acknowledgments:o(`#acknowledgments`).html(),supplementaryMaterials:o(`#supplementary-materials`).html(),bibliography:o(`#bibliography`).html()}),t})));return await b.close(),{title:`${v(`.banner-widget__content h1`).text()} - PNAS`,description:v(`.banner-widget__content p`).text(),image:`https://www.pnas.org/favicon.ico`,language:`en-US`,link:m,item:x}}export{f as route};
//# sourceMappingURL=pnas-B2BiOyVU.js.map