import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import o from"node:path";import{load as s}from"cheerio";import c from"query-string";t();const l={path:`/mmda/tags/:tags?`,categories:[`picture`],example:`/booru/mmda/tags/full_body%20blue_eyes`,parameters:{tags:"标签，多个标签使用 `%20` 连接，如需根据作者查询则在 `user:` 后接上作者名，如：`user:xxxx`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`mmda.booru.org/index.php`]}],name:`MMDArchive 标签查询`,maintainers:[`N78Wy`],handler:u,description:"For example:\n\n  -   默认查询 (什么 tag 都不加)：`/booru/mmda/tags`\n  -   默认查询单个 tag：`/booru/mmda/tags/full_body`\n  -   默认查询多个 tag：`/booru/mmda/tags/full_body%20blue_eyes`\n  -   默认查询根据作者查询：`/booru/mmda/tags/user:xxxx`"};async function u(t){let l=`https://mmda.booru.org`,u=t.req.param(`tags`),d=c.stringify({tags:u,page:`post`,s:`list`},{skipNull:!0}),{data:f}=await a(`${l}/index.php`,{searchParams:d}),p=s(f),m=p(`#post-list > div.content > div > div:nth-child(3) span`).toArray().map(t=>{t=p(t);let n=t.find(`a`).first(),i=t.find(`script[type="text/javascript"]`).first().text(),a=i.match(/user':'(.*?)'/)?.[1]??``,s=n.find(`img`).first().attr(`title`)??``,c=n.find(`img`).first().attr(`src`)??``;return{title:s,link:`${l}/${n.attr(`href`)}`,image:c,author:a,description:r(o.join(e,`templates/description-62d28c25.art`),{title:s,image:c,by:a})}}),h=await Promise.all(m.map(t=>n.tryGet(t.link,async()=>{let{data:n}=await a(t.link),c=s(n),l=c(`#tag_list > ul`);l.find(`li, br, strong`).remove();let u=l.text(),d=/(?<key>[^\s:]+)\s*:\s*(?<value>.+)/gm,f={};for(let e of u.matchAll(d)){let{key:t,value:n}=e.groups??{};f[t.trim().toLocaleLowerCase()]=n.trim()}let p=c(`#image`).attr(`src`);return f.posted&&(t.pubDate=i(f.posted)),t.description=r(o.join(e,`templates/description-62d28c25.art`),{title:t.title,image:p??t.image,posted:t.pubDate??``,by:f.by,source:f.source,rating:f.rating,score:f.score}),t})));return{title:u,link:`${l}/index.php?${d}`,item:h}}export{l as route};
//# sourceMappingURL=mmda-DR_h_SpH.js.map