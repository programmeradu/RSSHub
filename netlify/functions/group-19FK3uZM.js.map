{"version":3,"file":"group-19FK3uZM.js","names":["route: Route","ConfigNotFoundError"],"sources":["../../lib/routes/zsxq/group.ts"],"sourcesContent":["import type { Data, Route } from '@/types';\r\nimport type { Context } from 'hono';\r\nimport { config } from '@/config';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\nimport type { GroupInfoResponse, TopicsResponse } from './types';\r\nimport { customFetch, generateTopicDataItem } from './utils';\r\n\r\nexport const route: Route = {\r\n    name: '星球',\r\n    categories: ['social-media'],\r\n    path: '/group/:id/:scope?',\r\n    example: '/zsxq/group/88855458825252',\r\n    parameters: {\r\n        id: '星球id，从网页端url中获取',\r\n        scope: '栏目分类，默认为\"all\"，见下表',\r\n    },\r\n    maintainers: ['KarasuShin'],\r\n    radar: [\r\n        {\r\n            source: ['wx.zsxq.com/dweb2/index/group/:id'],\r\n        },\r\n    ],\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'ZSXQ_ACCESS_TOKEN',\r\n                description:\r\n                    '知识星球访问令牌,获取方式：\\n1. 登录知识星球网页版\\n2. 打开浏览器开发者工具，切换到 Application 面板\\n3. 点击侧边栏中的Storage -> Cookies -> https://wx.zsxq.com\\n4. 复制 Cookie 中的 zsxq_access_token 值',\r\n            },\r\n        ],\r\n    },\r\n    handler,\r\n    description: `| all  | digests | by_owner | questions | tasks |\r\n| ---- | ------ | --------- | -------- | ------ |\r\n| 最新 | 精华    | 只看星主    | 问答      | 作业   |`,\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const groupId = ctx.req.param('id');\r\n    const scope = ctx.req.param('scope') ?? 'all';\r\n    const accessToken = config.zsxq.accessToken;\r\n\r\n    if (!accessToken) {\r\n        throw new ConfigNotFoundError('该 RSS 源由于配置不正确而被禁用：令牌丢失。');\r\n    }\r\n\r\n    let count = Number(ctx.req.query('limit')) || 20;\r\n    if (count > 30) {\r\n        count = 30;\r\n    }\r\n\r\n    const { group } = await customFetch<GroupInfoResponse>(`/groups/${groupId}`);\r\n\r\n    const { topics } = await customFetch<TopicsResponse>(`/groups/${groupId}/topics?scope=${scope}&count=${count}`);\r\n\r\n    return {\r\n        title: `知识星球 - ${group.name}`,\r\n        description: group.description,\r\n        image: group.background_url,\r\n        link: `https://wx.zsxq.com/dweb2/index/group/${groupId}`,\r\n        item: generateTopicDataItem(topics),\r\n    };\r\n}\r\n"],"mappings":"mZAOA,MAAaA,EAAe,CACxB,KAAM,KACN,WAAY,CAAC,gBACb,KAAM,qBACN,QAAS,6BACT,WAAY,CACR,GAAI,kBACJ,MAAO,qBAEX,YAAa,CAAC,cACd,MAAO,CACH,CACI,OAAQ,CAAC,uCAGjB,SAAU,CACN,cAAe,CACX,CACI,KAAM,oBACN,YACI;;;;wCAIhB,UACA,YAAa;;4CAKjB,eAAe,EAAQ,EAA6B,CAChD,IAAM,EAAU,EAAI,IAAI,MAAM,MACxB,EAAQ,EAAI,IAAI,MAAM,UAAY,MAClC,EAAc,EAAO,KAAK,YAEhC,GAAI,CAAC,EACD,MAAM,IAAIC,EAAoB,4BAGlC,IAAI,EAAQ,OAAO,EAAI,IAAI,MAAM,WAAa,GAC1C,EAAQ,KACR,EAAQ,IAGZ,GAAM,CAAE,SAAU,MAAM,EAA+B,WAAW,KAE5D,CAAE,UAAW,MAAM,EAA4B,WAAW,EAAQ,gBAAgB,EAAM,SAAS,KAEvG,MAAO,CACH,MAAO,UAAU,EAAM,OACvB,YAAa,EAAM,YACnB,MAAO,EAAM,eACb,KAAM,yCAAyC,IAC/C,KAAM,EAAsB"}