{"version":3,"file":"jwc-CffiEk7h.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/sspu/jwc.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/jwc/:listId',\r\n    radar: [\r\n        {\r\n            source: ['jwc.sspu.edu.cn/jwc/:listId/list.htm'],\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const listId = ctx.req.param('listId');\r\n    const baseUrl = 'https://jwc.sspu.edu.cn';\r\n\r\n    const { data: response, url: link } = await got(`${baseUrl}/${listId}/list.htm`);\r\n    const $ = load(response);\r\n\r\n    const list = $('.news_list .news')\r\n        .slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 15)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const title = item.find('.news_title a');\r\n            return {\r\n                title: title.attr('title'),\r\n                link: `${baseUrl}${title.attr('href')}`,\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n\r\n                item.description = $('.wp_articlecontent').html();\r\n                item.pubDate = timezone(parseDate($('.arti_update').text(), 'YYYY-MM-DD HH:mm:ss'), +8);\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAaA,EAAe,CACxB,KAAM,eACN,MAAO,CACH,CACI,OAAQ,CAAC,0CAGjB,KAAM,UACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,EAAI,IAAI,MAAM,UACvB,EAAU,0BAEV,CAAE,KAAM,EAAU,IAAK,GAAS,MAAMC,EAAI,GAAG,EAAQ,GAAG,EAAO,YAC/D,EAAI,EAAK,GAET,EAAO,EAAE,oBACV,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAC5E,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAQ,EAAK,KAAK,iBACxB,MAAO,CACH,MAAO,EAAM,KAAK,SAClB,KAAM,GAAG,IAAU,EAAM,KAAK,aAIpC,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAKf,MAHA,GAAK,YAAcC,EAAE,sBAAsB,OAC3C,EAAK,QAAU,EAAS,EAAUA,EAAE,gBAAgB,OAAQ,uBAAwB,GAE7E,MAKnB,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,OACA,KAAM"}