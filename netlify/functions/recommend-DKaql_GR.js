import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import{logger_default as e}from"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import{md5 as r}from"./md5-4BNsOP-F.js";import{ofetch_default as i}from"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{load as o}from"cheerio";const s=()=>t.tryGet(`51cto:token`,async()=>{let e=await i(`https://api-media.51cto.com/api/token-get`);return e.data.data.token},3600,!1),c=(e,t={},n,i)=>{t.timestamp=n,t.token=i;let a=Object.keys(t).sort();return r(r(e)+r(a+r(i)+n))},l={path:`/index/recommend`,categories:[`programming`],example:`/51cto/index/recommend`,radar:[{source:[`51cto.com/`]}],name:`推荐`,maintainers:[`cnkmmk`,`ovo-tim`],handler:f,url:`51cto.com/`},u=/'(WTKkN|bOYDu|wyeCN)':\s*(\d+)/g;async function d(t,r=``){let a=null,s=await i(t.url,{headers:{cookie:r}}),c=o(s);if(a=new URL(t.url).host===`ost.51cto.com`?c(`.posts-content`).html():c(`article`).html(),!a&&r===``)try{let e=s.match(u).slice(0,3),n=e.map(e=>Number(e.split(`:`)[1])),[r,i,a]=n,o=`__tst_status=`+(r+i+a)+`#;`;return await d(t,o)}catch(t){e.error(t)}return{title:t.title,link:t.url,pubDate:n(t.pubdate,8),description:a||t.abstract}}async function f(e){let n=`index/index/recommend`,r=await s(),i=Date.now(),o={page:1,page_size:e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):50,limit_time:0,name_en:``},l=await a(`https://api-media.51cto.com/${n}`,{searchParams:{...o,timestamp:i,token:r,sign:c(n,o,i,r)}}),u=l.data.data.data.list,f=await Promise.all(u.map(e=>t.tryGet(e.url,async()=>await d(e))));return{title:`51CTO`,link:`https://www.51cto.com/`,description:`51cto - 推荐`,item:f}}export{l as route};
//# sourceMappingURL=recommend-DKaql_GR.js.map