{"version":3,"file":"utils-MLbS_z5b.js","names":["ofetch","$"],"sources":["../../lib/routes/techpowerup/utils.ts"],"sourcesContent":["import ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport md5 from '@/utils/md5';\r\n\r\nconst baseUrl = 'https://www.techpowerup.com';\r\n\r\nconst headers = {\r\n    cookie: `botcheck=${md5(Date.now().toString())}`,\r\n};\r\n\r\nconst fixImages = ($) => {\r\n    $('div.responsive-image-xx').each((_, d) => {\r\n        removeResponsiveStyle(d);\r\n    });\r\n    $('figure').each((_, f) => {\r\n        removeFigureStyle(f);\r\n    });\r\n    $('.newspost img').each((_, img) => {\r\n        hdImage(img);\r\n    });\r\n};\r\n\r\nconst hdImage = (img) => {\r\n    img.attribs.src = img.attribs.src.replace('_thm', '').replace('_small', '');\r\n    if (img.parentNode.name === 'a' && img.parentNode.attribs['data-width'] && img.parentNode.attribs['data-height']) {\r\n        img.attribs.width = img.parentNode.attribs['data-width'];\r\n        img.attribs.height = img.parentNode.attribs['data-height'];\r\n    }\r\n};\r\nconst removeFigureStyle = (f) => {\r\n    delete f.attribs.style;\r\n};\r\n\r\nconst removeResponsiveStyle = (div) => {\r\n    delete div.attribs.style;\r\n};\r\n\r\nconst parseReviews = async ($, item) => {\r\n    const { review } = JSON.parse($('script[type=\"application/ld+json\"]').text());\r\n\r\n    const content = $('.text');\r\n    const nextPages = $('#pagesel option')\r\n        .toArray()\r\n        .map((a) => `${baseUrl}${a.attribs.value}`)\r\n        .slice(1, -1);\r\n\r\n    if (nextPages.length) {\r\n        const pages = await Promise.all(\r\n            nextPages.map(async (url) => {\r\n                const response = await ofetch(url, {\r\n                    headers,\r\n                });\r\n                const $ = load(response);\r\n                $('.text div.responsive-image-xx').each((_, d) => {\r\n                    removeResponsiveStyle(d);\r\n                });\r\n                $('.text figure').each((_, f) => {\r\n                    removeFigureStyle(f);\r\n                });\r\n                $('.text img').each((_, img) => {\r\n                    hdImage(img);\r\n                });\r\n                return $('.text').html();\r\n            })\r\n        );\r\n        content.append(pages);\r\n    }\r\n\r\n    item.author = review.author.name;\r\n    item.pubDate = parseDate(review.datePublished);\r\n    item.updated = parseDate(review.dateModified);\r\n    item.description = content.html();\r\n};\r\n\r\nexport { baseUrl, headers, fixImages, hdImage, parseReviews, removeFigureStyle, removeResponsiveStyle };\r\n"],"mappings":"kLAKA,MAAM,EAAU,8BAEV,EAAU,CACZ,OAAQ,YAAY,EAAI,KAAK,MAAM,eAGjC,EAAa,GAAM,CACrB,EAAE,2BAA2B,MAAM,EAAG,IAAM,CACxC,EAAsB,KAE1B,EAAE,UAAU,MAAM,EAAG,IAAM,CACvB,EAAkB,KAEtB,EAAE,iBAAiB,MAAM,EAAG,IAAQ,CAChC,EAAQ,MAIV,EAAW,GAAQ,CACrB,EAAI,QAAQ,IAAM,EAAI,QAAQ,IAAI,QAAQ,OAAQ,IAAI,QAAQ,SAAU,IACpE,EAAI,WAAW,OAAS,KAAO,EAAI,WAAW,QAAQ,eAAiB,EAAI,WAAW,QAAQ,iBAC9F,EAAI,QAAQ,MAAQ,EAAI,WAAW,QAAQ,cAC3C,EAAI,QAAQ,OAAS,EAAI,WAAW,QAAQ,iBAG9C,EAAqB,GAAM,CAC7B,OAAO,EAAE,QAAQ,OAGf,EAAyB,GAAQ,CACnC,OAAO,EAAI,QAAQ,OAGjB,EAAe,MAAO,EAAG,IAAS,CACpC,GAAM,CAAE,UAAW,KAAK,MAAM,EAAE,sCAAsC,QAEhE,EAAU,EAAE,SACZ,EAAY,EAAE,mBACf,UACA,IAAK,GAAM,GAAG,IAAU,EAAE,QAAQ,SAClC,MAAM,EAAG,IAEd,GAAI,EAAU,OAAQ,CAClB,IAAM,EAAQ,MAAM,QAAQ,IACxB,EAAU,IAAI,KAAO,IAAQ,CACzB,IAAM,EAAW,MAAMA,EAAO,EAAK,CAC/B,YAEEC,EAAI,EAAK,GAUf,OATA,EAAE,iCAAiC,MAAM,EAAG,IAAM,CAC9C,EAAsB,KAE1B,EAAE,gBAAgB,MAAM,EAAG,IAAM,CAC7B,EAAkB,KAEtB,EAAE,aAAa,MAAM,EAAG,IAAQ,CAC5B,EAAQ,KAELA,EAAE,SAAS,UAG1B,EAAQ,OAAO,GAGnB,EAAK,OAAS,EAAO,OAAO,KAC5B,EAAK,QAAU,EAAU,EAAO,eAChC,EAAK,QAAU,EAAU,EAAO,cAChC,EAAK,YAAc,EAAQ"}