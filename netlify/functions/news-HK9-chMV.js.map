{"version":3,"file":"news-HK9-chMV.js","names":[],"sources":["../../lib/routes/jimmyspa/news.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:language',\r\n    categories: ['design'],\r\n    view: ViewType.Pictures,\r\n    example: '/jimmyspa/news/tw',\r\n    parameters: {\r\n        language: {\r\n            description: '语言',\r\n            options: [\r\n                { value: 'tw', label: '臺灣正體' },\r\n                { value: 'en', label: 'English' },\r\n                { value: 'jp', label: '日本語' },\r\n            ],\r\n        },\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.jimmyspa.com/:language/News'],\r\n        },\r\n    ],\r\n    name: 'News',\r\n    description: `\r\n| language | Description |\r\n| ---   | ---   |\r\n| tw | 臺灣正體 |\r\n| en | English |\r\n| jp | 日本語 |\r\n    `,\r\n    maintainers: ['Cedaric'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const language = ctx.req.param('language');\r\n    const rootUrl = 'https://www.jimmyspa.com';\r\n\r\n    const currentUrl = new URL(`/${language}/News/Ajax/changeList?year=&keyword=&categoryId=0&page=1`, rootUrl).href;\r\n\r\n    const responseData = await got(currentUrl);\r\n\r\n    const $ = load(responseData.data.view);\r\n\r\n    const items = $('ul#appendNews li.card_block')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $$ = load(item);\r\n            const title = $$('a.news_card .info_wrap h3').text();\r\n            const image = $$('a.news_card .card_img img').prop('src') || '';\r\n            const link = $$('a.news_card').prop('data-route');\r\n            const itemdate = $$('a.news_card div.date').html() || '';\r\n            const pubDate = convertHtmlDateToStandardFormat(itemdate.toString());\r\n\r\n            const description = art(path.join(__dirname, 'templates/description.art'), {\r\n                images: image\r\n                    ? [\r\n                          {\r\n                              src: image,\r\n                              alt: title,\r\n                          },\r\n                      ]\r\n                    : undefined,\r\n                description: $$('a.news_card .info_wrap p').text(),\r\n            });\r\n\r\n            return {\r\n                title,\r\n                link,\r\n                description,\r\n                pubDate,\r\n                content: {\r\n                    html: description,\r\n                    text: title,\r\n                },\r\n            };\r\n        });\r\n\r\n    return {\r\n        title: `幾米 - 最新消息(${language})`,\r\n        link: `${rootUrl}/${language}/News`,\r\n        allowEmpty: true,\r\n        item: items,\r\n    };\r\n}\r\n\r\nfunction convertHtmlDateToStandardFormat(htmlContent: string): Date | undefined {\r\n    const dateRegex = /<p>(\\d{1,2})<\\/p>\\s*<p>(\\d{1,2})\\s*\\.\\s*([A-Za-z]{3})<\\/p>/;\r\n    const match = htmlContent.match(dateRegex);\r\n\r\n    if (match) {\r\n        const day = Number.parseInt(match[1]) + 1;\r\n        const year = match[2];\r\n        const monthAbbreviation = match[3];\r\n\r\n        const monthMapping: { [key: string]: string } = {\r\n            Jan: '01',\r\n            Feb: '02',\r\n            Mar: '03',\r\n            Apr: '04',\r\n            May: '05',\r\n            Jun: '06',\r\n            Jul: '07',\r\n            Aug: '08',\r\n            Sep: '09',\r\n            Oct: '10',\r\n            Nov: '11',\r\n            Dec: '12',\r\n        };\r\n\r\n        const month = monthMapping[monthAbbreviation] || '';\r\n\r\n        return parseDate(`20${year}-${month}-${day}`);\r\n    }\r\n\r\n    return undefined;\r\n}\r\n"],"mappings":"mdAOA,MAAa,EAAe,CACxB,KAAM,kBACN,WAAY,CAAC,UACb,KAAM,EAAS,SACf,QAAS,oBACT,WAAY,CACR,SAAU,CACN,YAAa,KACb,QAAS,CACL,CAAE,MAAO,KAAM,MAAO,QACtB,CAAE,MAAO,KAAM,MAAO,WACtB,CAAE,MAAO,KAAM,MAAO,UAIlC,MAAO,CACH,CACI,OAAQ,CAAC,qCAGjB,KAAM,OACN,YAAa;;;;;;MAOb,YAAa,CAAC,WACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAU,2BAEV,EAAa,IAAI,IAAI,IAAI,EAAS,0DAA2D,GAAS,KAEtG,EAAe,MAAM,EAAI,GAEzB,EAAI,EAAK,EAAa,KAAK,MAE3B,EAAQ,EAAE,+BACX,UACA,IAAK,GAAS,CACX,IAAM,EAAK,EAAK,GACV,EAAQ,EAAG,6BAA6B,OACxC,EAAQ,EAAG,6BAA6B,KAAK,QAAU,GACvD,EAAO,EAAG,eAAe,KAAK,cAC9B,EAAW,EAAG,wBAAwB,QAAU,GAChD,EAAU,EAAgC,EAAS,YAEnD,EAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACvE,OAAQ,EACF,CACI,CACI,IAAK,EACL,IAAK,IAGb,IAAA,GACN,YAAa,EAAG,4BAA4B,SAGhD,MAAO,CACH,QACA,OACA,cACA,UACA,QAAS,CACL,KAAM,EACN,KAAM,MAKtB,MAAO,CACH,MAAO,aAAa,EAAS,GAC7B,KAAM,GAAG,EAAQ,GAAG,EAAS,OAC7B,WAAY,GACZ,KAAM,GAId,SAAS,EAAgC,EAAuC,CAC5E,IAAM,EAAY,6DACZ,EAAQ,EAAY,MAAM,GAEhC,GAAI,EAAO,CACP,IAAM,EAAM,OAAO,SAAS,EAAM,IAAM,EAClC,EAAO,EAAM,GACb,EAAoB,EAAM,GAE1B,EAA0C,CAC5C,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,MAGH,EAAQ,EAAa,IAAsB,GAEjD,OAAO,EAAU,KAAK,EAAK,GAAG,EAAM,GAAG"}