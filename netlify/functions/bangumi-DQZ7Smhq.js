import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{getSubPath as n}from"./common-utils-CvkwbCD5.js";import"./ofetch-Bzt0BXUH.js";import{got_default as r}from"./got-CdvI2yKX.js";const i={path:`/*`,categories:[`anime`],radar:[{source:[`bangumi.moe/`]}],name:`Latest`,example:`/bangumi.moe`,maintainers:[`nczitzk`],handler:a,url:`bangumi.moe/`};async function a(i){let a=n(i)===`/`,o=`https://bangumi.moe`,s,c=[];if(a){let e=`${o}/api/torrent/latest`;s=await r({method:`get`,url:e})}else{let t=`${o}/api/tag/search`,a=`${o}/api/torrent/search`,l=n(i).split(`/`).slice(2);c=await Promise.all(l.map(n=>e.tryGet(n,async()=>{let e=await r({method:`post`,url:t,json:{name:decodeURIComponent(n),keywords:!0,multi:!0}});return e.data.found?e.data.tag.map(e=>e._id)[0]:``}))),s=await r({method:`post`,url:a,json:{tag_id:c}})}let l=s.data.torrents?.slice(0,i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`)):30).map(e=>({title:e.title,link:`${o}/torrent/${e._id}`,description:e.introduction,pubDate:t(e.publish_time),enclosure_url:e.magnet,enclosure_type:`application/x-bittorrent`,category:e.tag_ids}))??[];return l=await Promise.all(l.map(t=>e.tryGet(t.link,async()=>{let e=await r({method:`post`,url:`${o}/api/tag/fetch`,json:{_ids:t.category}});t.category=[];for(let n of e.data)for(let e of n.synonyms)t.category.push(e);return t}))),{title:`萌番组 Bangumi Moe`,link:a||l.length===0?o:`${o}/search/${c.join(`+`)}`,item:l,allowEmpty:!0}}export{i as route};
//# sourceMappingURL=bangumi-DQZ7Smhq.js.map