{"version":3,"file":"thwiki-BaeKFd9J.js","names":["route: Route","got"],"sources":["../../lib/routes/thwiki/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport dayjs from 'dayjs';\r\n\r\nexport const route: Route = {\r\n    path: '/calendar/:before?/:after?',\r\n    categories: ['anime'],\r\n    example: '/thwiki/calendar',\r\n    parameters: { before: 'From how many days ago (default 30)', after: 'To how many days after (default 30)' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['thwiki.cc/', 'thwiki.cc/日程表'],\r\n            target: '/calendar',\r\n        },\r\n    ],\r\n    name: 'Calendar',\r\n    maintainers: ['aether17'],\r\n    handler,\r\n    url: 'thwiki.cc/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const beforeDays = ctx.req.param('before') ? Number.parseInt(ctx.req.param('before')) : 30;\r\n    const afterDays = ctx.req.param('after') ? Number.parseInt(ctx.req.param('after')) : 30;\r\n    const before = dayjs().subtract(beforeDays, 'day').format('YYYY-MM-DD');\r\n    const after = dayjs().add(afterDays, 'day').format('YYYY-MM-DD');\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `https://calendar-serverless.thwiki.cc/api/events/${before}/${after}`,\r\n        headers: {\r\n            Origin: 'https://thwiki.cc',\r\n        },\r\n    });\r\n    const data = response.data.results;\r\n\r\n    return {\r\n        title: 'Touhou events calendar (THBWiki)',\r\n        link: `https://calendar.thwiki.cc/`,\r\n        description: 'A Touhou related events calendar api from THBWiki',\r\n        item: data.map((item) => ({\r\n            title: item.title,\r\n            author: item.title,\r\n            category: item.type ? item.type[0] : '活动',\r\n            description: `${item.desc}. 开始时间: ${item.startStr}. 结束时间: ${item.endStr}.${item.type ? ' 活动类型: ' + item.type[0] : ''}`,\r\n            guid: item.id,\r\n            link: item.url,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"qPAIA,MAAaA,EAAe,CACxB,KAAM,6BACN,WAAY,CAAC,SACb,QAAS,mBACT,WAAY,CAAE,OAAQ,sCAAuC,MAAO,uCACpE,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,aAAc,iBACvB,OAAQ,cAGhB,KAAM,WACN,YAAa,CAAC,YACd,UACA,IAAK,cAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAa,EAAI,IAAI,MAAM,UAAY,OAAO,SAAS,EAAI,IAAI,MAAM,WAAa,GAClF,EAAY,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GAC/E,EAAS,IAAQ,SAAS,EAAY,OAAO,OAAO,cACpD,EAAQ,IAAQ,IAAI,EAAW,OAAO,OAAO,cAE7C,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,oDAAoD,EAAO,GAAG,IACnE,QAAS,CACL,OAAQ,uBAGV,EAAO,EAAS,KAAK,QAE3B,MAAO,CACH,MAAO,mCACP,KAAM,8BACN,YAAa,oDACb,KAAM,EAAK,IAAK,IAAU,CACtB,MAAO,EAAK,MACZ,OAAQ,EAAK,MACb,SAAU,EAAK,KAAO,EAAK,KAAK,GAAK,KACrC,YAAa,GAAG,EAAK,KAAK,UAAU,EAAK,SAAS,UAAU,EAAK,OAAO,GAAG,EAAK,KAAO,UAAY,EAAK,KAAK,GAAK,KAClH,KAAM,EAAK,GACX,KAAM,EAAK"}