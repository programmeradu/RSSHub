import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as r}from"./got-CdvI2yKX.js";import{ViewType as i}from"./types-A5bA50Mg.js";const a=`NGA_skull/6.0.5(iPhone10,3;iOS 12.0.1)`,o={path:`/forum/:fid/:recommend?`,categories:[`bbs`],view:i.Articles,example:`/nga/forum/489`,parameters:{fid:`分区 id, 可在分区主页 URL 找到, 没有 fid 时 stid 同样适用`,recommend:`是否只显示精华主题, 留空为否, 任意值为是`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`分区帖子`,maintainers:[`xyqfer`],handler:s};async function s(i){let{fid:o,recommend:s}=i.req.param(),c=Math.floor(Date.now()/1e3),l=`guestJs=${c};`;e.nga.uid&&e.nga.cid&&(l=`ngaPassportUid=${e.nga.uid}; ngaPassportCid=${e.nga.cid};`);let u=e=>e.replaceAll(/\[img](.+?)\[\/img]/g,(e,t)=>{let n=t.replaceAll(/\?.*/g,``);return`<img src="${n}" />`}).replaceAll(/\[url](.+?)\[\/url]/g,`<a href="$1">$1</a>`),d=await r.post(`https://ngabbs.com/app_api.php?__lib=subject&__act=list`,{headers:{"X-User-Agent":a,Cookie:l},form:{fid:o,recommend:s?1:0}}),f=d.data.forumname,p=d.data.result.data.filter(({tid:e})=>e),m=await Promise.all(p.map(async({subject:e,postdate:i,tid:o})=>{let s=`https://nga.178.com/read.php?tid=${o}`,c={title:e,description:``,link:s,pubDate:n(i,`X`)},d=await t.tryGet(`nga-forum: ${s}`,async()=>{let e=await r.post(`https://ngabbs.com/app_api.php?__lib=post&__act=list`,{headers:{"X-User-Agent":a,Cookie:l},form:{tid:o}});return e.data.code===0?u(e.data.result[0].content):e.data.msg});return c.description=d,c}));return{title:`NGA-${f}${s?`-精华`:``}`,link:`https://nga.178.com/thread.php?fid=${o}`,description:`NGA是国内专业的游戏玩家社区,魔兽世界,英雄联盟,炉石传说,风暴英雄,暗黑破坏神3(D3)游戏攻略讨论,以及其他热门游戏玩家社区`,item:m}}export{o as route};
//# sourceMappingURL=forum-Y0LSRphp.js.map