import{config as e}from"./config-Dl8a1sIg.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{fallback as n,queryToBoolean as r,queryToInteger as i}from"./readable-social-D7TWDGpz.js";import a from"node:url";import{TwitterApi as o}from"twitter-api-v2";const s=e=>a.parse(e,!0).query,c=e=>{let t=null;if(t=e.match(/^(https?:\/\/\w+\.twimg\.com\/media\/[^/:]+)\.(jpg|jpeg|gif|png|bmp|webp)(:\w+)?$/i)){let e=t[2];return t[2]===`jpeg`&&(e=`jpg`),`${t[1]}?format=${e}&name=orig`}else if(t=e.match(/^(https?:\/\/\w+\.twimg\.com\/.+)(\?.+)$/i)){let n=s(e);return!n.format||!n.name||n.name===`orig`?e:t[1]+`?format=`+n.format+`&name=orig`}else return e},l=e=>e.replaceAll(/<br><br>|<br>/g,` `),u=e=>{let t=e.full_text,n=e.id_str||e.conversation_id_str,r=e.entities.urls||[];for(let e of r)t=t.replaceAll(e.url,e.expanded_url?.endsWith(n)?``:e.expanded_url);let i=e.extended_entities?.media||[];for(let e of i)t=t.replaceAll(e.url,``);return t.trim().replaceAll(`
`,`<br>`)},d=(e,{data:a=[]},o={})=>{let s=new URLSearchParams(e.req.param(`routeParams`)),d={readable:n(o.readable,r(s.get(`readable`)),!1),authorNameBold:n(o.authorNameBold,r(s.get(`authorNameBold`)),!1),showAuthorInTitle:n(o.showAuthorInTitle,r(s.get(`showAuthorInTitle`)),!1),showAuthorAsTitleOnly:n(o.showAuthorAsTitleOnly,r(s.get(`showAuthorAsTitleOnly`)),!1),showAuthorInDesc:n(o.showAuthorInDesc,r(s.get(`showAuthorInDesc`)),!1),showQuotedAuthorAvatarInDesc:n(o.showQuotedAuthorAvatarInDesc,r(s.get(`showQuotedAuthorAvatarInDesc`)),!1),showAuthorAvatarInDesc:n(o.showAuthorAvatarInDesc,r(s.get(`showAuthorAvatarInDesc`)),!1),showEmojiForRetweetAndReply:n(o.showEmojiForRetweetAndReply,r(s.get(`showEmojiForRetweetAndReply`)),!1),showSymbolForRetweetAndReply:n(o.showSymbolForRetweetAndReply,r(s.get(`showSymbolForRetweetAndReply`)),!0),showRetweetTextInTitle:n(o.showRetweetTextInTitle,r(s.get(`showRetweetTextInTitle`)),!0),addLinkForPics:n(o.addLinkForPics,r(s.get(`addLinkForPics`)),!1),showTimestampInDescription:n(o.showTimestampInDescription,r(s.get(`showTimestampInDescription`)),!1),showQuotedInTitle:n(o.showQuotedInTitle,r(s.get(`showQuotedInTitle`)),!1),widthOfPics:n(o.widthOfPics,i(s.get(`widthOfPics`)),-1),heightOfPics:n(o.heightOfPics,i(s.get(`heightOfPics`)),-1),sizeOfAuthorAvatar:n(o.sizeOfAuthorAvatar,i(s.get(`sizeOfAuthorAvatar`)),48),sizeOfQuotedAuthorAvatar:n(o.sizeOfQuotedAuthorAvatar,i(s.get(`sizeOfQuotedAuthorAvatar`)),24),mediaNumber:n(o.mediaNumber,i(s.get(`mediaNumber`)),!1)};o=d;let{readable:f,authorNameBold:p,showAuthorInTitle:m,showAuthorAsTitleOnly:h,showAuthorInDesc:g,showQuotedAuthorAvatarInDesc:_,showAuthorAvatarInDesc:v,showEmojiForRetweetAndReply:y,showSymbolForRetweetAndReply:b,showRetweetTextInTitle:x,addLinkForPics:S,showTimestampInDescription:C,showQuotedInTitle:w,mediaNumber:T,widthOfPics:E,heightOfPics:D,sizeOfAuthorAvatar:O,sizeOfQuotedAuthorAvatar:k}=o,A=(e,t=``)=>{let n=``,r=null;for(let t of e.video_info.variants)(!r||(t.bitrate||0)>(r.bitrate||-1/0))&&(r=t);if(r&&r.url){let i=e.type===`animated_gif`?`autoplay loop muted webkit-playsinline playsinline`:``;f||(n+=`<br>`),n+=`<video width="${e.sizes.large.w}" height="${e.sizes.large.h}" src='${r.url}' ${i} controls='controls' poster='${c(e.media_url_https)}' ${t}></video>`}return n},j=e=>{let t=``;if(e.extended_entities){let n=e.extended_entities.media.length,r=1;for(let i of e.extended_entities.media){let e=``,a=``,o;switch(i.type){case`animated_gif`:case`video`:e=A(i);break;case`photo`:default:o=c(i.media_url_https),f||(e+=`<br>`),S&&(e+=`<a href='${o}' target='_blank' rel='noopener noreferrer'>`),e+=`<img `,E>=0&&(e+=` width="${E}"`,a+=`width: ${E}px;`),D>0&&(e+=`height="${D}" `,a+=`height: ${D}px;`),E<=0&&D<=0&&(e+=`width="${i.sizes.large.w}" height="${i.sizes.large.h}" `),e+=` style="${a}" ${f?`hspace="4" vspace="8"`:``} src="${o}">`,S&&(e+=`</a>`);break}t+=e,T&&(t+=`<p style="text-align:center">${r}/${n}</p>`,r++)}}return f&&t&&(t=`<br clear='both' /><div style='clear: both'></div>`+t),t},M=e=>{let t=``;if(e.extended_entities)for(let n of e.extended_entities.media){let e,r;switch(n.type){case`video`:e=A(n,`width="0" height="0"`);break;case`photo`:default:r=c(n.media_url_https),e=`<img width='0' height='0' hidden='true' src='${r}'>`;break}t+=e}return t};return a.map(e=>{let n=e;e=e.retweeted_status||e,e.full_text=e.full_text||e.text,e.full_text=u(e);let r=j(e),i=M(e),a=``,o=``;if(e.is_quote_status){let n=e.quoted_status;if(n){n.full_text=n.full_text||n.text;let e=n.user;a+=`<div class="rsshub-quote">`,f?(a+=`<br clear='both' /><div style='clear: both'></div>`,a+=`<blockquote style='background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;'>`):a+=`<br><br>`,f&&(a+=`<a href='https://x.com/${e.screen_name}' target='_blank' rel='noopener noreferrer'>`),_&&(a+=`<img width='${k}' height='${k}' src='${e.profile_image_url_https}' ${f?`hspace="8" vspace="8" align="left"`:``}>`),p&&(a+=`<strong>`),a+=e.name,p&&(a+=`</strong>`),f&&(a+=`</a>`),a+=`:&ensp;`,a+=u(n),f||(a+=`<br>`),a+=j(n),i+=M(n),o+=y?` üí¨ `:b?` RT `:``,o+=`${e.name}: ${u(n)}`,f&&(a+=`<br><small>Link: <a href='https://x.com/${e.screen_name}/status/${n.id_str||n.conversation_id_str}' target='_blank' rel='noopener noreferrer'>https://x.com/${e.screen_name}/status/${n.id_str||n.conversation_id_str}</a></small>`),C&&(a+=`<br><small>`+t(n.created_at),a+=`</small>`,f&&(a+=`<br clear='both' /><div style='clear: both'></div>`)),f&&(a+=`</blockquote>`),a+=`</div>`}}let s=``;m&&(s+=n.user?.name+`: `);let c=n!==e,d=e.is_quote_status;!c&&(!d||x)&&(e.in_reply_to_screen_name&&(s+=y?`‚Ü©Ô∏è `:b?`Re `:``),s+=l(n.full_text)),c&&(s+=y?`üîÅ `:b?`RT `:``,s+=e.user.name+`: `,e.in_reply_to_screen_name&&(s+=y?` ‚Ü©Ô∏è `:b?` Re `:``),s+=l(e.full_text)),w&&(s+=o),h&&(s=n.user?.name);let S=``;g&&v&&(S+=i),c&&(g&&(f&&(S+=`<small>`,S+=`<a href='https://x.com/${n.user?.screen_name}' target='_blank' rel='noopener noreferrer'>`),p&&(S+=`<strong>`),S+=n.user?.name,p&&(S+=`</strong>`),f&&(S+=`</a>`),S+=`&ensp;`),S+=y?`üîÅ`:b?`RT`:``,g||(S+=`&ensp;`,f&&(S+=`<a href='https://x.com/${e.user?.screen_name}' target='_blank' rel='noopener noreferrer'>`),p&&(S+=`<strong>`),S+=e.user?.name,p&&(S+=`</strong>`),f&&(S+=`</a>`)),f&&(S+=`</small>`),S+=`<br>`),g&&(f&&(S+=`<a href='https://x.com/${e.user?.screen_name}' target='_blank' rel='noopener noreferrer'>`),v&&(S+=`<img width='${O}' height='${O}' src='${e.user.profile_image_url_https}' ${f?`hspace="8" vspace="8" align="left"`:``}>`),p&&(S+=`<strong>`),S+=e.user?.name,p&&(S+=`</strong>`),f&&(S+=`</a>`),S+=`:&ensp;`),e.in_reply_to_screen_name&&(S+=y?`‚Ü©Ô∏è `:b?`Re `:``),S+=e.full_text;let T=S.match(/(\s)?(#[^\s;<]+)/g)?.map(e=>e?.match(/#([^\s<]+)/)?.[1]);S+=r,S+=a,f&&(S+=`<br clear='both' /><div style='clear: both'></div>`),C&&(f&&(S+=`<hr>`),S+=`<small>${t(e.created_at)}</small>`);let E=n.user?.screen_name&&(n.id_str||n.conversation_id_str)?`https://x.com/${n.user?.screen_name}/status/${n.id_str||n.conversation_id_str}`:`https://x.com/${e.user?.screen_name}/status/${e.id_str||e.conversation_id_str}`;return{title:s,author:[{name:n.user?.name,url:`https://x.com/${n.user?.screen_name}`,avatar:n.user?.profile_image_url_https}],description:S,pubDate:t(e.created_at),link:E,guid:E.replace(`x.com`,`twitter.com`),category:T,_extra:c&&{links:[{url:`https://x.com/${e.user?.screen_name||userScreenName}/status/${e.conversation_id_str}`,type:`repost`}]}||e.is_quote_status&&{links:[{url:`https://x.com/${e.quoted_status?.user?.screen_name}/status/${e.quoted_status?.id_str||e.quoted_status?.conversation_id_str}`,type:`quote`}]}||e.in_reply_to_screen_name&&e.in_reply_to_status_id_str&&{links:[{url:`https://x.com/${e.in_reply_to_screen_name}/status/${e.in_reply_to_status_id_str}`,type:`reply`}]}}})};let f=()=>null;if(e.twitter.consumer_key&&e.twitter.consumer_secret){let t=e.twitter.consumer_key.split(`,`),n=e.twitter.consumer_secret.split(`,`),r={},i=0,a=-1;for(let[e,a]of t.entries()){let t=n[e];a&&t&&(r[e]=new o({appKey:a,appSecret:t}).readOnly,i=e+1)}f=()=>(a++,r[a%i].appLogin())}const p=e=>{let t,a,o,s,c=!1;switch(e){case`exclude_rts_replies`:case`exclude_replies_rts`:a=!1,o=!1;break;case`include_replies`:a=!0,o=!0;break;case`exclude_rts`:a=!1,o=!1;break;default:{let l=new URLSearchParams(e);t=n(void 0,i(l.get(`count`))),a=n(void 0,r(l.get(`includeReplies`)),!1),o=n(void 0,r(l.get(`includeRts`)),!0),c=n(void 0,r(l.get(`forceWebApi`)),!1),s=n(void 0,r(l.get(`onlyMedia`)),!1)}}return{count:t,include_replies:a,include_rts:o,force_web_api:c,only_media:s}},m=function(e){let t=[];for(let n of e){if(n.retweeted_status)continue;t.push(n)}return t},h=function(e){let t=e.filter(e=>e.extended_entities&&e.extended_entities.media);return t};var g={ProcessFeed:d,getAppClient:f,parseRouteParams:p,excludeRetweet:m,keepOnlyMedia:h};export{g as utils_default};
//# sourceMappingURL=utils-D9tUviZV.js.map