import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import"./timezone-BrNu6iXe.js";import{bbsOrigin as e,fetchThread as t,generateDescription as n,getDate as r}from"./utils-ulRZsC01.js";import{load as i}from"cheerio";const a={name:`BBS - 讨论串`,categories:[`bbs`],path:`/bbs/thread/:tid`,example:`/yamibo/bbs/thread/541914`,parameters:{tid:`讨论串 id，可从URL中提取。https://bbs.yamibo.com/forum.php?mod=viewthread&tid=xxxx中的xxx或https://bbs.yamibo.com/thread-aaa-b-c.html中的aaa部分即为tid值`},maintainers:[`KarasuShin`],handler:o,features:{antiCrawler:!0,requireConfig:[{optional:!0,name:`YAMIBO_SALT`,description:`百合会BBS登录后的认证信息，获取方式：1. 登录百合会BBS网页版 2. 打开浏览器开发者工具，切换到 Application 面板
3. 点击侧边栏中的Storage -> Cookies -> https://bbs.yamibo.com 4. 复制 Cookie 中的 EeqY_2132_saltkey 值`},{optional:!0,name:`YAMIBO_AUTH`,description:`百合会BBS登录后的认证信息，获取方式：1. 登录百合会BBS网页版 2. 打开浏览器开发者工具，切换到 Application 面板
3. 点击侧边栏中的Storage -> Cookies -> https://bbs.yamibo.com 4. 复制 Cookie 中的 EeqY_2132_auth 值`}]},description:`::: warning
百合会BBS访问部分讨论串需要用户登录认证，请参考配置说明
:::`};async function o(a){let o=a.req.param(`tid`),{data:s,link:c}=await t(o,{ordertype:`1`});if(!s)return{title:`讨论串不存在`,link:c,item:[]};let l=i(s),u=l(`title`).text().replace(` -  百合会 -  Powered by Discuz!`,``),d=l(`#postlist>div[id^="post_"]`).toArray().map(t=>{let i=l(t),a=!!i.has(`#fj`).length,s=i.attr(`id`).match(/\d+/)[0],c=i.find(`table`).find(`tr`).first(),u=c.find(`#favatar${s}`),d=u.find(`.authi`).text(),f=a?`主楼`:c.find(`#postnum${s} em`).text(),p=a?`${e}/forum.php?mod=viewthread&tid=${o}`:`${e}/forum.php?mod=redirect&goto=findpost&ptid=${o}&pid=${s}`,m=n(i,s),h=c.find(`#authorposton${s}`).text().match(/\d{4}(?:-\d{1,2}){2} \d{2}:\d{2}/)[0];return{title:`${f} - ${d}`,link:p,description:m,pubDate:r(h)}});return{title:u,link:c,item:d}}export{a as route};
//# sourceMappingURL=thread-Dru-ocCH.js.map