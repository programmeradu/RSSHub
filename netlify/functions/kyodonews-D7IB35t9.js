import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import{invalid_parameter_default as s}from"./invalid-parameter-CUJdROXf.js";import{config_not_found_default as c}from"./config-not-found-BVqhRP9D.js";import l from"node:path";import{load as u}from"cheerio";t();const d=(e,t)=>e.startsWith(`http`)?e:`${t}${e}`,f={path:`/:language?/:keyword?`,categories:[`traditional-media`],example:`/kyodonews`,parameters:{language:"语言: `china` = 简体中文 (默认), `tchina` = 繁體中文",keyword:`关键词`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`最新报道`,maintainers:[`Rongronggg9`],handler:p,description:"`keyword` 为关键词，由于共同网有许多关键词并不在主页列出，此处不一一列举，可从关键词页的 URL 的最后一级路径中提取。如 `日中关系` 的关键词页 URL 为 `https://china.kyodonews.net/news/japan-china_relationship`, 则将 `japan-china_relationship` 填入 `keyword`。特别地，当填入 `rss` 时，将从共同网官方 RSS 中抓取文章；略去时，将从首页抓取最新报道 (注意：首页更新可能比官方 RSS 稍慢)。"};async function p(t){let f=t.req.param(`language`)??`china`,p=t.req.param(`keyword`)===`RSS`?`rss`:t.req.param(`keyword`)??``;if(![`china`,`tchina`].includes(f))throw new c(`Invalid language`);let m=`https://${f}.kyodonews.net`,h=`${m}/${p?p===`rss`?`rss/news.xml`:`news/${p}`:``}`,g;try{g=await a(h)}catch(e){throw e.response&&e.response.statusCode===404?new s(`Invalid keyword`):e}let _=u(g.data,{xmlMode:p===`rss`}),v,y,b,x;return b=`${m}/apple-touch-icon-180x180.png`,p===`rss`?(v=_(`channel > title`).text(),y=_(`channel > description`).text(),x=_(`item`).toArray().map(e=>{let t=_(e),n=t.find(`link`).text();return{link:n}})):(v=_(`head > title`).text(),y=_(`meta[name="description"]`).attr(`content`),b=d(_(`head > link[rel="apple-touch-icon"]`).attr(`href`),m)||b,x=_(`div.sec-latest > ul > li`).toArray().map(e=>{e=_(e);let t=e.find(`a`).attr(`href`);return{link:d(t,m)}})),x=await Promise.all(x.map(t=>n.tryGet(t.link,async()=>{let n=await a(t.link),s=u(n.data);t.title=s(`head > title`).text(),t.author=s(`meta[name="author"]`).attr(`content`);let c=s(`div.mainpic`);c.find(`div`).each((e,t)=>{t=s(t),t.css(`text-align`,`center`)}),c.find(`img`).each((e,t)=>{t=s(t),t.attr(`src`,t.attr(`data-src`)),t.removeAttr(`data-src`),t.wrap(`<div>`)});let d=c.html();d=d?d.trim():``;let f=s(`div.article-body`).html();f=f?f.trim().replace(/（完）(?=<\/p>\s*$)/m,``):``,t.description=r(l.join(e,`templates/article-7fb700c0.art`),{mainPic:d,articleBody:f});let p=s(`script[type="application/ld+json"]`).html(),m=p&&p.match(/"datePublished":"([\d\s-:]*?)"/),h=p&&p.match(/"dateModified":"([\d\s-:]*?)"/);return m&&(t.pubDate=o(i(m[1]),9)),h&&(t.updated=o(i(h[1]),9)),t.category=s(`p.credit > a`).toArray().map(e=>s(e).text()),t}))),{title:v,description:y,link:h,item:x,image:b}}export{f as route};
//# sourceMappingURL=kyodonews-D7IB35t9.js.map