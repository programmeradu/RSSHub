{"version":3,"file":"knowledge-BzZ2Mr8B.js","names":[],"sources":["../../lib/routes/dedao/knowledge.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/knowledge/:topic?/:type?',\r\n    categories: ['new-media'],\r\n    example: '/dedao/knowledge',\r\n    parameters: { topic: '话题 id，可在对应话题页 URL 中找到', type: '分享类型，`true` 指精选，`false` 指最新，默认为精选' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['dedao.cn/knowledge/topic/:topic', 'dedao.cn/knowledge', 'dedao.cn/'],\r\n        },\r\n    ],\r\n    name: '知识城邦',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const topic = ctx.req.param('topic') ?? '';\r\n    const type = /t|y/i.test(ctx.req.param('type') ?? 'true');\r\n    const count = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 100;\r\n\r\n    const rootUrl = 'https://www.dedao.cn';\r\n    const currentUrl = `${rootUrl}/knowledge${topic === '' ? '' : '/topic/' + topic}`;\r\n    const apiUrl = `${rootUrl}/pc/ledgers/${topic === '' ? 'notes/friends_timeline' : 'topic/notes/list'}`;\r\n    const detailUrl = `${rootUrl}/pc/ledgers/topic/detail`;\r\n\r\n    let title = '',\r\n        description = '';\r\n\r\n    if (topic !== '') {\r\n        const detailResponse = await got({\r\n            method: 'post',\r\n            url: detailUrl,\r\n            json: {\r\n                incr_view_count: false,\r\n                topic_id_hazy: topic,\r\n            },\r\n        });\r\n\r\n        title = detailResponse.data.c.name;\r\n        description = detailResponse.data.c.intro;\r\n    }\r\n\r\n    const response = await got({\r\n        method: 'post',\r\n        url: apiUrl,\r\n        json: {\r\n            count,\r\n            load_chain: true,\r\n            is_elected: type,\r\n            page_id: 0,\r\n            topic_id_hazy: topic,\r\n            version: 2,\r\n        },\r\n    });\r\n\r\n    const items = (topic === '' ? response.data.c.notes : response.data.c.note_detail_list).map((item) => ({\r\n        title: item.f_part.note,\r\n        author: item.f_part.nick_name,\r\n        link: `${rootUrl}/knowledge/note/${item.f_part.note_id_hazy}`,\r\n        pubDate: parseDate(item.f_part.time_desc, 'MM-DD'),\r\n        description: art(path.join(__dirname, 'templates/knowledge.art'), {\r\n            rootUrl,\r\n            f_part: item.f_part,\r\n            s_part: item.s_part,\r\n        }),\r\n    }));\r\n\r\n    return {\r\n        title: `得到 - 知识城邦${title === '' ? '' : ' - ' + title}`,\r\n        link: currentUrl,\r\n        item: items,\r\n        description,\r\n    };\r\n}\r\n"],"mappings":"qYAOA,MAAa,EAAe,CACxB,KAAM,4BACN,WAAY,CAAC,aACb,QAAS,mBACT,WAAY,CAAE,MAAO,wBAAyB,KAAM,qCACpD,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,kCAAmC,qBAAsB,eAG1E,KAAM,OACN,YAAa,CAAC,WACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,UAAY,GAClC,EAAO,OAAO,KAAK,EAAI,IAAI,MAAM,SAAW,QAC5C,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAE3E,EAAU,uBACV,EAAa,GAAG,EAAQ,YAAY,IAAU,GAAK,GAAK,UAAY,IACpE,EAAS,GAAG,EAAQ,cAAc,IAAU,GAAK,yBAA2B,qBAC5E,EAAY,GAAG,EAAQ,0BAEzB,EAAQ,GACR,EAAc,GAElB,GAAI,IAAU,GAAI,CACd,IAAM,EAAiB,MAAM,EAAI,CAC7B,OAAQ,OACR,IAAK,EACL,KAAM,CACF,gBAAiB,GACjB,cAAe,KAIvB,EAAQ,EAAe,KAAK,EAAE,KAC9B,EAAc,EAAe,KAAK,EAAE,MAGxC,IAAM,EAAW,MAAM,EAAI,CACvB,OAAQ,OACR,IAAK,EACL,KAAM,CACF,QACA,WAAY,GACZ,WAAY,EACZ,QAAS,EACT,cAAe,EACf,QAAS,KAIX,GAAS,IAAU,GAAK,EAAS,KAAK,EAAE,MAAQ,EAAS,KAAK,EAAE,kBAAkB,IAAK,IAAU,CACnG,MAAO,EAAK,OAAO,KACnB,OAAQ,EAAK,OAAO,UACpB,KAAM,GAAG,EAAQ,kBAAkB,EAAK,OAAO,eAC/C,QAAS,EAAU,EAAK,OAAO,UAAW,SAC1C,YAAa,EAAI,EAAA,KAAA,EAAA,oCAAiD,CAC9D,UACA,OAAQ,EAAK,OACb,OAAQ,EAAK,YAIrB,MAAO,CACH,MAAO,YAAY,IAAU,GAAK,GAAK,MAAQ,IAC/C,KAAM,EACN,KAAM,EACN"}