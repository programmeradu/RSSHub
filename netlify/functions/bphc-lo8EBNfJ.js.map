{"version":3,"file":"bphc-lo8EBNfJ.js","names":["route: Route","ofetch","cache"],"sources":["../../lib/routes/gov/beijing/bphc/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { getSubPath } from '@/utils/common-utils';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst mapping = {\r\n    '/project': {\r\n        title: '项目介绍',\r\n        list: '/front/index/project/page',\r\n        detail: '/front/index/project',\r\n        link: '/#/communityDetail?id=',\r\n    },\r\n    '/announcement': {\r\n        title: '通知公告',\r\n        list: '/front/announcement/page',\r\n        detail: '/front/announcement/',\r\n        link: '/#/announcementList/detail?id=',\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/beijing/bphc/*',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const rootUrl = 'https://gycpt.bphc.com.cn';\r\n    const defaultPath = 'announcement';\r\n\r\n    const pathname = getSubPath(ctx).replaceAll(/(^\\/beijing\\/bphc|\\/$)/g, '');\r\n    const key = pathname === '' ? defaultPath : pathname.endsWith('/') ? pathname.slice(0, -1) : pathname;\r\n    const obj = mapping[key];\r\n    const currentUrl = `${rootUrl}${obj.list}`;\r\n\r\n    const listResp = await ofetch(currentUrl);\r\n    const list = listResp.data?.records ?? [];\r\n    const items = await Promise.all(\r\n        list.map((item) => {\r\n            const detail = `${rootUrl}${obj.detail}/${item.id}`;\r\n            return cache.tryGet(detail, async () => {\r\n                const detailResponse = await ofetch(detail);\r\n                const description = (detailResponse.data?.content || detailResponse.data?.introduction) ?? '';\r\n                const single = {\r\n                    title: item.title || item.fullName,\r\n                    author: description.match(/来源：(.*?)</)?.[1].trim() ?? item.operator,\r\n                    link: `${rootUrl}${obj.link}${item.id}`,\r\n                    description,\r\n                    pubDate: timezone(parseDate(item.createTime), +8),\r\n                };\r\n                return single;\r\n            });\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: obj.title,\r\n        link: rootUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"8XAOA,MAAM,EAAU,CACZ,WAAY,CACR,MAAO,OACP,KAAM,4BACN,OAAQ,uBACR,KAAM,0BAEV,gBAAiB,CACb,MAAO,OACP,KAAM,2BACN,OAAQ,uBACR,KAAM,mCAIDA,EAAe,CACxB,KAAM,kBACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,4BAGV,EAAW,EAAW,GAAK,WAAW,0BAA2B,IACjE,EAAM,IAAa,GAAK,eAAc,EAAS,SAAS,KAAO,EAAS,MAAM,EAAG,IAAM,EACvF,EAAM,EAAQ,GACd,EAAa,GAAG,IAAU,EAAI,OAE9B,EAAW,MAAMC,EAAO,GACxB,EAAO,EAAS,MAAM,SAAW,GACjC,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GAAS,CACf,IAAM,EAAS,GAAG,IAAU,EAAI,OAAO,GAAG,EAAK,KAC/C,OAAOC,EAAM,OAAO,EAAQ,SAAY,CACpC,IAAM,EAAiB,MAAMD,EAAO,GAC9B,GAAe,EAAe,MAAM,SAAW,EAAe,MAAM,eAAiB,GACrF,EAAS,CACX,MAAO,EAAK,OAAS,EAAK,SAC1B,OAAQ,EAAY,MAAM,eAAe,GAAG,QAAU,EAAK,SAC3D,KAAM,GAAG,IAAU,EAAI,OAAO,EAAK,KACnC,cACA,QAAS,EAAS,EAAU,EAAK,YAAa,IAElD,OAAO,OAKnB,MAAO,CACH,MAAO,EAAI,MACX,KAAM,EACN,KAAM"}