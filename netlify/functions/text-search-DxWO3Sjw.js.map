{"version":3,"file":"text-search-DxWO3Sjw.js","names":["route: Route","ofetch","items: DataItem[]","link"],"sources":["../../lib/routes/asianfanfics/text-search.ts"],"sourcesContent":["import { config } from '@/config';\r\nimport { DataItem, Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\n\r\n// test url http://localhost:1200/asianfanfics/text-search/milklove\r\n\r\nexport const route: Route = {\r\n    path: '/text-search/:keyword',\r\n    categories: ['reading'],\r\n    example: '/asianfanfics/text-search/milklove',\r\n    parameters: {\r\n        keyword: '关键词',\r\n    },\r\n    name: '关键词',\r\n    maintainers: ['KazooTTT'],\r\n    radar: [\r\n        {\r\n            source: ['www.asianfanfics.com/browse/text_search?q=:keyword'],\r\n            target: '/text-search/:keyword',\r\n        },\r\n    ],\r\n    description: '匹配asianfanfics搜索关键词',\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const keyword = ctx.req.param('keyword');\r\n    if (keyword.trim() === '') {\r\n        throw new Error('关键词不能为空');\r\n    }\r\n    const link = `https://www.asianfanfics.com/browse/text_search?q=${keyword}+`;\r\n\r\n    const response = await ofetch(link, {\r\n        headers: {\r\n            'user-agent': config.trueUA,\r\n        },\r\n    });\r\n    const $ = load(response);\r\n\r\n    const items: DataItem[] = $('.primary-container .excerpt')\r\n        .toArray()\r\n        .filter((element) => {\r\n            const $element = $(element);\r\n            return $element.find('.excerpt__title a').length > 0;\r\n        })\r\n        .map((element) => {\r\n            const $element = $(element);\r\n            const title = $element.find('.excerpt__title a').text();\r\n            const link = 'https://www.asianfanfics.com' + $element.find('.excerpt__title a').attr('href');\r\n            const author = $element.find('.excerpt__meta__name a').text().trim();\r\n            const pubDate = parseDate($element.find('time').attr('datetime') || '');\r\n            const description = $element.find('.excerpt__text').html();\r\n\r\n            return {\r\n                title,\r\n                link,\r\n                author,\r\n                pubDate,\r\n                description,\r\n            };\r\n        });\r\n\r\n    return {\r\n        title: `Asianfanfics - 关键词：${keyword}`,\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"gRAQA,MAAaA,EAAe,CACxB,KAAM,wBACN,WAAY,CAAC,WACb,QAAS,qCACT,WAAY,CACR,QAAS,OAEb,KAAM,MACN,YAAa,CAAC,YACd,MAAO,CACH,CACI,OAAQ,CAAC,sDACT,OAAQ,0BAGhB,YAAa,sBACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,EAAI,IAAI,MAAM,WAC9B,GAAI,EAAQ,SAAW,GACnB,MAAU,MAAM,WAEpB,IAAM,EAAO,qDAAqD,EAAQ,GAEpE,EAAW,MAAMC,EAAO,EAAM,CAChC,QAAS,CACL,aAAc,EAAO,UAGvB,EAAI,EAAK,GAETC,EAAoB,EAAE,+BACvB,UACA,OAAQ,GAAY,CACjB,IAAM,EAAW,EAAE,GACnB,OAAO,EAAS,KAAK,qBAAqB,OAAS,IAEtD,IAAK,GAAY,CACd,IAAM,EAAW,EAAE,GACb,EAAQ,EAAS,KAAK,qBAAqB,OAC3CC,EAAO,+BAAiC,EAAS,KAAK,qBAAqB,KAAK,QAChF,EAAS,EAAS,KAAK,0BAA0B,OAAO,OACxD,EAAU,EAAU,EAAS,KAAK,QAAQ,KAAK,aAAe,IAC9D,EAAc,EAAS,KAAK,kBAAkB,OAEpD,MAAO,CACH,QACA,KAAA,EACA,SACA,UACA,iBAIZ,MAAO,CACH,MAAO,sBAAsB,IAC7B,OACA,KAAM"}