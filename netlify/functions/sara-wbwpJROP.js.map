{"version":3,"file":"sara-wbwpJROP.js","names":["route: Route","ofetch","cache"],"sources":["../../lib/routes/sara/index.ts"],"sourcesContent":["import { Route, DataItem } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nconst typeMap = {\r\n    dynamic: '协会动态',\r\n    announcement: '通知公告',\r\n    industry: '行业动态',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:type',\r\n    categories: ['government'],\r\n    example: '/sara/announcement',\r\n    parameters: { type: 'dynamic | announcement | industry' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    description: `| 协会动态 | 通知公告 |行业动态 |\r\n| -------- | ------------ | -------- |\r\n| dynamic | announcement | industry |`,\r\n\r\n    name: '新闻资讯',\r\n    maintainers: ['HChenZi'],\r\n    handler: async (ctx) => {\r\n        const baseUrl = 'http://www.sara.org.cn';\r\n        const type = ctx.req.param('type');\r\n\r\n        const url = `${baseUrl}/news/${type}.htm`;\r\n        const response = await ofetch(url);\r\n        const $ = load(response);\r\n        const list = $('.newsItem_total > dd')\r\n            .toArray()\r\n            .map((item) => {\r\n                const a = $(item).find('a').first();\r\n                return {\r\n                    link: `${baseUrl}${a.attr('href')}`,\r\n                    title: a.attr('title'),\r\n                };\r\n            });\r\n        const items = (await Promise.all(list.map((elem) => getFeedItem(elem)))) as DataItem[];\r\n        return {\r\n            title: typeMap[type],\r\n            link: url,\r\n            item: items,\r\n        };\r\n    },\r\n};\r\n\r\nasync function getFeedItem(item) {\r\n    return await cache.tryGet(item.link, async () => {\r\n        const response = await ofetch(item.link);\r\n        const $ = load(response);\r\n        return {\r\n            description: $('.text').html(),\r\n            language: 'zh-cn',\r\n            ...item,\r\n        };\r\n    });\r\n}\r\n"],"mappings":"8PAKA,MAAM,EAAU,CACZ,QAAS,OACT,aAAc,OACd,SAAU,QAGDA,EAAe,CACxB,KAAM,SACN,WAAY,CAAC,cACb,QAAS,qBACT,WAAY,CAAE,KAAM,qCACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,YAAa;;uCAIb,KAAM,OACN,YAAa,CAAC,WACd,QAAS,KAAO,IAAQ,CACpB,IAAM,EAAU,yBACV,EAAO,EAAI,IAAI,MAAM,QAErB,EAAM,GAAG,EAAQ,QAAQ,EAAK,MAC9B,EAAW,MAAMC,EAAO,GACxB,EAAI,EAAK,GACT,EAAO,EAAE,wBACV,UACA,IAAK,GAAS,CACX,IAAM,EAAI,EAAE,GAAM,KAAK,KAAK,QAC5B,MAAO,CACH,KAAM,GAAG,IAAU,EAAE,KAAK,UAC1B,MAAO,EAAE,KAAK,YAGpB,EAAS,MAAM,QAAQ,IAAI,EAAK,IAAK,GAAS,EAAY,KAChE,MAAO,CACH,MAAO,EAAQ,GACf,KAAM,EACN,KAAM,KAKlB,eAAe,EAAY,EAAM,CAC7B,OAAO,MAAMC,EAAM,OAAO,EAAK,KAAM,SAAY,CAC7C,IAAM,EAAW,MAAMD,EAAO,EAAK,MAC7B,EAAI,EAAK,GACf,MAAO,CACH,YAAa,EAAE,SAAS,OACxB,SAAU,QACV,GAAG"}