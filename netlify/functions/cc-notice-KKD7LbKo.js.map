{"version":3,"file":"cc-notice-KKD7LbKo.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/nankai/cc-notice.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport cache from '@/utils/cache';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/cc/:type?',\r\n    categories: ['university'],\r\n    example: '/nankai/cc/13291',\r\n    parameters: { type: '栏目编号（若为空则默认为\"最新动态\"）' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['cc.nankai.edu.cn', 'cc.nankai.edu.cn/:type/list.htm'],\r\n            target: '/cc/:type?',\r\n        },\r\n    ],\r\n    name: '计算机学院',\r\n    maintainers: ['vicguo0724'],\r\n    description: `| 最新动态 | 学院公告 | 学生工作通知 | 科研信息 | 本科生教学 | 党团园地 | 研究生招生 | 研究生教学 | 境外交流 |\r\n| -------- | -------- | ---------- | -------- | ---------- | -------- | ---------- | ---------- | -------- |\r\n| 13291    | 13292    | 13293      | 13294    | 13295      | 13296    | 13297      | 13298      | 13299    |`,\r\n    url: 'cc.nankai.edu.cn',\r\n    handler: async (ctx) => {\r\n        // 从 URL 参数中获取通知分类\r\n        const { type = '13291' } = ctx.req.param();\r\n        const baseUrl = 'https://cc.nankai.edu.cn';\r\n        const { data: response } = await got(`${baseUrl}/${type}/list.htm`);\r\n        const $ = load(response);\r\n\r\n        // 获取分类名称\r\n        const categoryName = $('.accordion .selected a').text().trim() || '最新动态';\r\n\r\n        // 解析新闻列表\r\n        const list = $('#wp_news_w49 table tr')\r\n            .slice(1) // 跳过表头\r\n            .toArray()\r\n            .map((tr) => {\r\n                const $tr = $(tr);\r\n                const cells = $tr.find('td');\r\n\r\n                if (cells.length < 5) {\r\n                    return null;\r\n                }\r\n\r\n                const title = cells.eq(1).text().trim();\r\n                const publisher = cells.eq(2).text().trim();\r\n                const dateStr = cells.eq(3).text().trim();\r\n\r\n                // 从onclick属性中提取链接\r\n                const onclick = $tr.attr('onclick');\r\n                let link = '';\r\n                if (onclick) {\r\n                    const match = onclick.match(/window\\.location\\.href='([^']+)';/);\r\n                    if (match) {\r\n                        link = match[1];\r\n                        if (!link.startsWith('http')) {\r\n                            link = `${baseUrl}${link}`;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                return {\r\n                    title,\r\n                    link,\r\n                    pubDate: timezone(parseDate(dateStr), +8),\r\n                    author: publisher,\r\n                };\r\n            })\r\n            .filter((item) => item && item.link); // 过滤掉空项目和没有链接的项目\r\n\r\n        // 获取每篇文章的详细内容\r\n        const items = await Promise.all(\r\n            list.map((item) =>\r\n                item\r\n                    ? cache.tryGet(item.link, async () => {\r\n                          try {\r\n                              const { data: response } = await got(item.link);\r\n                              const $ = load(response);\r\n\r\n                              // 优化内容选择器逻辑，避免重复选择\r\n                              let description = $('.wp_articlecontent').html() || $('.body-news-detail').html();\r\n\r\n                              description = description || item.title;\r\n                              item.description = description;\r\n                          } catch {\r\n                              // 如果获取详细内容失败，返回基本信息\r\n                              item.description = item.title + ' (获取详细内容失败)';\r\n                          }\r\n                          return item;\r\n                      })\r\n                    : null\r\n            )\r\n        );\r\n\r\n        return {\r\n            // 源标题\r\n            title: `南开大学计算机学院-${categoryName}`,\r\n            // 源链接\r\n            link: `${baseUrl}/${type}/list.htm`,\r\n            // 源文章\r\n            item: items,\r\n        };\r\n    },\r\n};\r\n"],"mappings":"0ZAOA,MAAaA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,cACb,QAAS,mBACT,WAAY,CAAE,KAAM,uBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,mBAAoB,mCAC7B,OAAQ,eAGhB,KAAM,QACN,YAAa,CAAC,cACd,YAAa;;8GAGb,IAAK,mBACL,QAAS,KAAO,IAAQ,CAEpB,GAAM,CAAE,OAAO,SAAY,EAAI,IAAI,QAC7B,EAAU,2BACV,CAAE,KAAM,GAAa,MAAMC,EAAI,GAAG,EAAQ,GAAG,EAAK,YAClD,EAAI,EAAK,GAGT,EAAe,EAAE,0BAA0B,OAAO,QAAU,OAG5D,EAAO,EAAE,yBACV,MAAM,GACN,UACA,IAAK,GAAO,CACT,IAAM,EAAM,EAAE,GACR,EAAQ,EAAI,KAAK,MAEvB,GAAI,EAAM,OAAS,EACf,OAAO,KAGX,IAAM,EAAQ,EAAM,GAAG,GAAG,OAAO,OAC3B,EAAY,EAAM,GAAG,GAAG,OAAO,OAC/B,EAAU,EAAM,GAAG,GAAG,OAAO,OAG7B,EAAU,EAAI,KAAK,WACrB,EAAO,GACX,GAAI,EAAS,CACT,IAAM,EAAQ,EAAQ,MAAM,qCACxB,IACA,EAAO,EAAM,GACR,EAAK,WAAW,UACjB,EAAO,GAAG,IAAU,MAKhC,MAAO,CACH,QACA,OACA,QAAS,EAAS,EAAU,GAAU,GACtC,OAAQ,KAGf,OAAQ,GAAS,GAAQ,EAAK,MAG7B,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACN,EACMC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,CACA,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAGX,EAAcC,EAAE,sBAAsB,QAAUA,EAAE,qBAAqB,OAE3E,EAAc,GAAe,EAAK,MAClC,EAAK,YAAc,OACf,CAEJ,EAAK,YAAc,EAAK,MAAQ,cAEpC,OAAO,IAEX,OAId,MAAO,CAEH,MAAO,aAAa,IAEpB,KAAM,GAAG,EAAQ,GAAG,EAAK,WAEzB,KAAM"}