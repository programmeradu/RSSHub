{"version":3,"file":"sitemap-6Kpp9IEI.js","names":["route: Route","ConfigNotFoundError","got"],"sources":["../../lib/routes/rsshub/transform/sitemap.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { config } from '@/config';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nexport const route: Route = {\r\n    path: '/transform/sitemap/:url/:routeParams?',\r\n    name: 'Unknown',\r\n    maintainers: ['flrngel'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    if (!config.feature.allow_user_supply_unsafe_domain) {\r\n        throw new ConfigNotFoundError(`This RSS is disabled unless 'ALLOW_USER_SUPPLY_UNSAFE_DOMAIN' is set to 'true'.`);\r\n    }\r\n    const url = ctx.req.param('url');\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n    });\r\n\r\n    const routeParams = new URLSearchParams(ctx.req.param('routeParams'));\r\n    const $ = load(response.data, { xmlMode: true });\r\n\r\n    const rssTitle = routeParams.get('title') || ($('urlset url').length && $('urlset url').first().find('loc').text() ? $('urlset url').first().find('loc').text() : 'Sitemap');\r\n\r\n    const urls = $('urlset url').toArray();\r\n    const items =\r\n        urls && urls.length\r\n            ? urls\r\n                  .map((item) => {\r\n                      try {\r\n                          const title = $(item).find('loc').text() || '';\r\n                          const link = $(item).find('loc').text() || '';\r\n                          const description = $(item).find('loc').text() || '';\r\n                          const pubDate = $(item).find('lastmod').text() || undefined;\r\n\r\n                          return {\r\n                              title,\r\n                              link,\r\n                              description,\r\n                              pubDate,\r\n                          };\r\n                      } catch {\r\n                          return null;\r\n                      }\r\n                  })\r\n                  .filter(Boolean)\r\n            : [];\r\n\r\n    return {\r\n        title: rssTitle,\r\n        link: url,\r\n        description: `Proxy ${url}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0VAMA,MAAaA,EAAe,CACxB,KAAM,wCACN,KAAM,UACN,YAAa,CAAC,WACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAI,CAAC,EAAO,QAAQ,gCAChB,MAAM,IAAIC,EAAoB,mFAElC,IAAM,EAAM,EAAI,IAAI,MAAM,OACpB,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,QAGE,EAAc,IAAI,gBAAgB,EAAI,IAAI,MAAM,gBAChD,EAAI,EAAK,EAAS,KAAM,CAAE,QAAS,KAEnC,EAAW,EAAY,IAAI,WAAa,EAAE,cAAc,QAAU,EAAE,cAAc,QAAQ,KAAK,OAAO,OAAS,EAAE,cAAc,QAAQ,KAAK,OAAO,OAAS,WAE5J,EAAO,EAAE,cAAc,UACvB,EACF,GAAQ,EAAK,OACP,EACK,IAAK,GAAS,CACX,GAAI,CACA,IAAM,EAAQ,EAAE,GAAM,KAAK,OAAO,QAAU,GACtC,EAAO,EAAE,GAAM,KAAK,OAAO,QAAU,GACrC,EAAc,EAAE,GAAM,KAAK,OAAO,QAAU,GAC5C,EAAU,EAAE,GAAM,KAAK,WAAW,QAAU,IAAA,GAElD,MAAO,CACH,QACA,OACA,cACA,gBAEA,CACJ,OAAO,QAGd,OAAO,SACZ,GAEV,MAAO,CACH,MAAO,EACP,KAAM,EACN,YAAa,SAAS,IACtB,KAAM"}