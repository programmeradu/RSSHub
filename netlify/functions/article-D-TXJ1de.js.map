{"version":3,"file":"article-D-TXJ1de.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/dora-world/article.ts"],"sourcesContent":["import { Route, Data, DataItem, ViewType } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst baseUrl = 'https://www.dora-world.com';\r\n\r\nexport const route: Route = {\r\n    path: '/article/:topic/:topicId?',\r\n    categories: ['anime'],\r\n    view: ViewType.Articles,\r\n    example: '/dora-world/article/contents',\r\n    parameters: {\r\n        topic: 'Topic name, can be found in URL. For example: the topic name of [https://www.dora-world.com/movie](https://www.dora-world.com/movie) is `movie`',\r\n        topicId: 'Topic id, can be found in URL. For example: the topic id of [https://www.dora-world.com/contents?t=197](https://www.dora-world.com/contents?t=197) is `197`',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.dora-world.com/:topic'],\r\n        },\r\n    ],\r\n    name: 'Article',\r\n    maintainers: ['AChangAZha'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx): Promise<Data> {\r\n    const { topic, topicId = '' } = ctx.req.param();\r\n    const topicIdParam = topicId === '' ? '' : `?t=${topicId}`;\r\n    const link = `${baseUrl}/${topic}${topicIdParam}`;\r\n    const { data: html } = await got(baseUrl);\r\n    const $ = load(html);\r\n    const nextData = JSON.parse($('script#__NEXT_DATA__').text());\r\n    const nextBuildId = nextData.buildId;\r\n    const { data: response } = await got(`${baseUrl}/_next/data/${nextBuildId}/${topic}.json${topicIdParam}`);\r\n    const title = `${response.pageProps.label_name} - ドラえもんチャンネル`;\r\n    const contents = response.pageProps.contents;\r\n    const list = contents.map((item) => ({\r\n        title: item.title,\r\n        link: item.page_url.startsWith('http') ? item.page_url : `${baseUrl}${item.page_url}`,\r\n        description: item.page_url.startsWith('/contents/') ? '' : `<p>${item.title}</p><img src=\"${item.image_url}\" alt=\"\">`,\r\n        pubDate: timezone(parseDate(item.publish_at), +9),\r\n        category: item.tags.map((tag) => tag.name),\r\n        guid: item.id,\r\n    }));\r\n    return {\r\n        title,\r\n        link,\r\n        language: 'ja',\r\n        image: 'https://dora-world.com/assets/images/DORAch_web-touch-icon.png',\r\n        item: (await Promise.all(\r\n            list.map(\r\n                async (item) =>\r\n                    await cache.tryGet(item.link, async () => {\r\n                        if (item.description === '') {\r\n                            item.description = await getContent(nextBuildId, item.guid);\r\n                        }\r\n                        return item;\r\n                    })\r\n            )\r\n        ).then((items) => items.filter((item) => item !== null))) as DataItem[],\r\n    };\r\n}\r\n\r\nasync function getContent(nextBuildId: string, contentId: string) {\r\n    const { data: response } = await got(`${baseUrl}/_next/data/${nextBuildId}/contents/${contentId}.json`);\r\n    const $ = load(response.pageProps.content.content);\r\n    const content = $('.main_unit');\r\n    content.find('.tag').remove();\r\n    content.find('div[style=\"display:none\"]').remove();\r\n    const rubyRegex = /<ruby>(.*?)<rt>(.*?)<\\/rt><\\/ruby>/g;\r\n    const description =\r\n        content\r\n            .html()\r\n            ?.replace(rubyRegex, '$1（$2）')\r\n            ?.replace(/[^\\u0009\\u000A\\u000D\\u0020-\\uD7FF\\uE000-\\uFDCF\\uFDE0-\\uFFFD]/gm, '') ?? '';\r\n    return description;\r\n}\r\n"],"mappings":"ycAOA,MAAM,EAAU,6BAEHA,EAAe,CACxB,KAAM,4BACN,WAAY,CAAC,SACb,KAAM,EAAS,SACf,QAAS,+BACT,WAAY,CACR,MAAO,kJACP,QAAS,+JAEb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,+BAGjB,KAAM,UACN,YAAa,CAAC,cACd,WAGJ,eAAe,EAAQ,EAAoB,CACvC,GAAM,CAAE,QAAO,UAAU,IAAO,EAAI,IAAI,QAClC,EAAe,IAAY,GAAK,GAAK,MAAM,IAC3C,EAAO,GAAG,EAAQ,GAAG,IAAQ,IAC7B,CAAE,KAAM,GAAS,MAAMC,EAAI,GAC3B,EAAI,EAAK,GACT,EAAW,KAAK,MAAM,EAAE,wBAAwB,QAChD,EAAc,EAAS,QACvB,CAAE,KAAM,GAAa,MAAMA,EAAI,GAAG,EAAQ,cAAc,EAAY,GAAG,EAAM,OAAO,KACpF,EAAQ,GAAG,EAAS,UAAU,WAAW,eACzC,EAAW,EAAS,UAAU,SAC9B,EAAO,EAAS,IAAK,IAAU,CACjC,MAAO,EAAK,MACZ,KAAM,EAAK,SAAS,WAAW,QAAU,EAAK,SAAW,GAAG,IAAU,EAAK,WAC3E,YAAa,EAAK,SAAS,WAAW,cAAgB,GAAK,MAAM,EAAK,MAAM,gBAAgB,EAAK,UAAU,WAC3G,QAAS,EAAS,EAAU,EAAK,YAAa,GAC9C,SAAU,EAAK,KAAK,IAAK,GAAQ,EAAI,MACrC,KAAM,EAAK,MAEf,MAAO,CACH,QACA,OACA,SAAU,KACV,MAAO,iEACP,KAAO,MAAM,QAAQ,IACjB,EAAK,IACD,KAAO,IACH,MAAMC,EAAM,OAAO,EAAK,KAAM,UACtB,EAAK,cAAgB,KACrB,EAAK,YAAc,MAAM,EAAW,EAAa,EAAK,OAEnD,MAGrB,KAAM,GAAU,EAAM,OAAQ,GAAS,IAAS,QAI1D,eAAe,EAAW,EAAqB,EAAmB,CAC9D,GAAM,CAAE,KAAM,GAAa,MAAMD,EAAI,GAAG,EAAQ,cAAc,EAAY,YAAY,EAAU,QAC1F,EAAI,EAAK,EAAS,UAAU,QAAQ,SACpC,EAAU,EAAE,cAClB,EAAQ,KAAK,QAAQ,SACrB,EAAQ,KAAK,6BAA6B,SAC1C,IAAM,EAAY,sCACZ,EACF,EACK,QACC,QAAQ,EAAW,WACnB,QAAQ,iEAAkE,KAAO,GAC3F,OAAO"}