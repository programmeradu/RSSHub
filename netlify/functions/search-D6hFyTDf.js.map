{"version":3,"file":"search-D6hFyTDf.js","names":["route: Route","EhAPI","cache"],"sources":["../../lib/routes/ehentai/search.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport EhAPI from './ehapi';\r\n\r\nexport const route: Route = {\r\n    path: '/search/:params?/:page?/:routeParams?',\r\n    categories: ['picture'],\r\n    example: '/ehentai/search/f_cats=1021/0/bittorrent=true&embed_thumb=false',\r\n    parameters: { params: 'Search parameters. You can copy the content after `https://e-hentai.org/?`', page: 'Page number, set 0 to get latest', routeParams: 'Additional parameters, see the table above' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: true,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Search',\r\n    maintainers: ['yindaheng98', 'syrinka'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const page = ctx.req.param('page');\r\n    let params = ctx.req.param('params');\r\n    const routeParams = new URLSearchParams(ctx.req.param('routeParams'));\r\n    const bittorrent = routeParams.get('bittorrent') || false;\r\n    const embed_thumb = routeParams.get('embed_thumb') || false;\r\n    let items;\r\n    if (page) {\r\n        // 如果定义了page，就要覆盖params\r\n        params = params.replace(/&*next=[^&]$/, '').replace(/next=[^&]&/, '');\r\n        items = await EhAPI.getSearchItems(cache, params, page, bittorrent, embed_thumb);\r\n    } else {\r\n        items = await EhAPI.getSearchItems(cache, params, undefined, bittorrent, embed_thumb);\r\n    }\r\n    let title = params;\r\n    const match = /f_search=([^&]+)/.exec(title);\r\n    if (match !== null) {\r\n        title = match[1];\r\n    }\r\n\r\n    return EhAPI.from_ex\r\n        ? {\r\n              title: title + ' - ExHentai Search ',\r\n              link: `https://exhentai.org/?${params}`,\r\n              item: items,\r\n          }\r\n        : {\r\n              title: title + ' - E-Hentai Search ',\r\n              link: `https://e-hentai.org/?${params}`,\r\n              item: items,\r\n          };\r\n}\r\n"],"mappings":"iVAIA,MAAaA,EAAe,CACxB,KAAM,wCACN,WAAY,CAAC,WACb,QAAS,kEACT,WAAY,CAAE,OAAQ,6EAA8E,KAAM,mCAAoC,YAAa,8CAC3J,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,cAAe,WAC7B,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACvB,EAAS,EAAI,IAAI,MAAM,UACrB,EAAc,IAAI,gBAAgB,EAAI,IAAI,MAAM,gBAChD,EAAa,EAAY,IAAI,eAAiB,GAC9C,EAAc,EAAY,IAAI,gBAAkB,GAClD,EACA,GAEA,EAAS,EAAO,QAAQ,eAAgB,IAAI,QAAQ,aAAc,IAClE,EAAQ,MAAMC,EAAM,eAAeC,EAAO,EAAQ,EAAM,EAAY,IAEpE,EAAQ,MAAMD,EAAM,eAAeC,EAAO,EAAQ,IAAA,GAAW,EAAY,GAE7E,IAAI,EAAQ,EACN,EAAQ,mBAAmB,KAAK,GAKtC,OAJI,IAAU,OACV,EAAQ,EAAM,IAGXD,EAAM,QACP,CACI,MAAO,EAAQ,sBACf,KAAM,yBAAyB,IAC/B,KAAM,GAEV,CACI,MAAO,EAAQ,sBACf,KAAM,yBAAyB,IAC/B,KAAM"}