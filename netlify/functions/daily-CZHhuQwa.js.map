{"version":3,"file":"daily-CZHhuQwa.js","names":["route: Route","ofetch","response: DailyData","cache","$"],"sources":["../../lib/routes/aibase/daily.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\nimport { rootUrl, buildApiUrl } from './util';\r\nimport cache from '@/utils/cache';\r\n\r\nexport const route: Route = {\r\n    path: '/daily',\r\n    name: 'AI日报',\r\n    url: 'www.aibase.com',\r\n    maintainers: ['3tuuu'],\r\n    handler: async (ctx) => {\r\n        // 每页数量限制\r\n        const limit = Number.parseInt(ctx.req.query('limit') ?? '30', 10);\r\n        // 用项目中已有的获取页面方法，获取页面以及 Token\r\n        const currentUrl = new URL('discover', rootUrl).href;\r\n        const currentHtml = await ofetch(currentUrl);\r\n        const $ = load(currentHtml);\r\n        const logoSrc = $('img.logo').prop('src');\r\n        const image = logoSrc ? new URL(logoSrc, rootUrl).href : '';\r\n        const author = 'AI Base';\r\n        const { aILogListUrl } = await buildApiUrl($);\r\n        const response: DailyData = await ofetch(aILogListUrl, {\r\n            headers: {\r\n                accept: 'application/json;charset=utf-8',\r\n            },\r\n            query: {\r\n                pagesize: limit,\r\n                page: 1,\r\n                type: 2,\r\n                isen: 0,\r\n            },\r\n        });\r\n        if (!response || !response.data) {\r\n            throw new Error('日报数据不存在或为空');\r\n        }\r\n        const items = await Promise.all(\r\n            response.data.slice(0, limit).map(async (item) => {\r\n                const articleUrl = `https://www.aibase.com/zh/news/${item.Id}`;\r\n                return await cache.tryGet(articleUrl, async () => {\r\n                    const articleHtml = await ofetch(articleUrl);\r\n                    const $ = load(articleHtml);\r\n                    const description = $('.post-content').html();\r\n                    if (!description) {\r\n                        throw new Error(`Empty content: ${articleUrl}`);\r\n                    }\r\n                    return {\r\n                        title: item.title,\r\n                        link: articleUrl,\r\n                        description,\r\n                        pubDate: parseDate(item.addtime),\r\n                        author: 'AI Base',\r\n                    };\r\n                });\r\n            })\r\n        );\r\n\r\n        return {\r\n            title: 'AI日报',\r\n            description: '每天三分钟关注AI行业趋势',\r\n            language: 'zh-cn',\r\n            link: 'https://www.aibase.com/zh/daily',\r\n            item: items,\r\n            allowEmpty: true,\r\n            image,\r\n            author,\r\n        };\r\n    },\r\n    example: '/aibase/daily',\r\n    description: '获取 AI 日报',\r\n    categories: ['new-media'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.aibase.com/zh/daily'],\r\n            target: '/daily',\r\n        },\r\n    ],\r\n};\r\n\r\ninterface DailyData {\r\n    has_more: boolean;\r\n    message: string;\r\n    data: DailyItem[];\r\n}\r\ninterface DailyItem {\r\n    /** 文章 ID */\r\n    Id: number;\r\n    /** 添加时间 */\r\n    addtime: string;\r\n    /** 文章标题 */\r\n    title: string;\r\n    /** 文章副标题 */\r\n    subtitle: string;\r\n    /** 文章简要描述 */\r\n    desc: string;\r\n    /** 文章主图 */\r\n    orgthumb: string;\r\n    playtime: number;\r\n    pv: string;\r\n}\r\n"],"mappings":"6aAOA,MAAaA,EAAe,CACxB,KAAM,SACN,KAAM,OACN,IAAK,iBACL,YAAa,CAAC,SACd,QAAS,KAAO,IAAQ,CAEpB,IAAM,EAAQ,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IAExD,EAAa,IAAI,IAAI,WAAY,GAAS,KAC1C,EAAc,MAAMC,EAAO,GAC3B,EAAI,EAAK,GACT,EAAU,EAAE,YAAY,KAAK,OAC7B,EAAQ,EAAU,IAAI,IAAI,EAAS,GAAS,KAAO,GAEnD,CAAE,gBAAiB,MAAM,EAAY,GACrCC,EAAsB,MAAMD,EAAO,EAAc,CACnD,QAAS,CACL,OAAQ,kCAEZ,MAAO,CACH,SAAU,EACV,KAAM,EACN,KAAM,EACN,KAAM,KAGd,GAAI,CAAC,GAAY,CAAC,EAAS,KACvB,MAAU,MAAM,cAEpB,IAAM,EAAQ,MAAM,QAAQ,IACxB,EAAS,KAAK,MAAM,EAAG,GAAO,IAAI,KAAO,IAAS,CAC9C,IAAM,EAAa,kCAAkC,EAAK,KAC1D,OAAO,MAAME,EAAM,OAAO,EAAY,SAAY,CAC9C,IAAM,EAAc,MAAMF,EAAO,GAC3BG,EAAI,EAAK,GACT,EAAcA,EAAE,iBAAiB,OACvC,GAAI,CAAC,EACD,MAAU,MAAM,kBAAkB,KAEtC,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EACN,cACA,QAAS,EAAU,EAAK,SACxB,OAAQ,gBAMxB,MAAO,CACH,MAAO,OACP,YAAa,gBACb,SAAU,QACV,KAAM,kCACN,KAAM,EACN,WAAY,GACZ,QACA,mBAGR,QAAS,gBACT,YAAa,WACb,WAAY,CAAC,aACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,2BACT,OAAQ"}