{"version":3,"file":"news-yk7GcwcY.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/toranoana/news.ts"],"sourcesContent":["import { Route, Data, DataItem } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:category?',\r\n    categories: ['anime'],\r\n    example: '/toranoana/news/toragen',\r\n    parameters: { category: 'category' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Category',\r\n    maintainers: ['Tsuyumi25'],\r\n    handler,\r\n    radar: [\r\n        {\r\n            title: '総合新着記事',\r\n            source: ['news.toranoana.jp'],\r\n            target: '/news',\r\n        },\r\n        {\r\n            title: '女性向け',\r\n            source: ['news.toranoana.jp/joshi'],\r\n            target: '/news/joshi',\r\n        },\r\n        {\r\n            title: 'イラスト展',\r\n            source: ['news.toranoana.jp/exhibitions'],\r\n            target: '/news/exhibition',\r\n        },\r\n        {\r\n            source: ['news.toranoana.jp/category/:category'],\r\n            target: '/news/:category',\r\n        },\r\n    ],\r\n    description: `\r\n::: warning TIP\r\n[総合新着記事](https://news.toranoana.jp)→\\`/toranoana/news\\`  \r\n[女性向け](https://news.toranoana.jp/joshi)→\\`/toranoana/news/joshi\\`  \r\n[イラスト展](https://news.toranoana.jp/exhibitions)→\\`/toranoana/news/exhibition\\`  \r\n[\\`https://news.toranoana.jp/category/media\\`](https://news.toranoana.jp/category/media)→\\`/toranoana/news/media\\`\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx): Promise<Data> {\r\n    const { category = '' } = ctx.req.param();\r\n    let apiUrl = 'https://news.toranoana.jp/wp-json/wp/v2/posts';\r\n\r\n    if (category) {\r\n        const categoryResponse = await ofetch(`https://news.toranoana.jp/wp-json/wp/v2/categories?slug=${category}`);\r\n        if (categoryResponse && categoryResponse.length > 0) {\r\n            apiUrl += `?categories=${categoryResponse[0].id}`;\r\n        }\r\n    } else {\r\n        // exclude category-joshi to get result of general\r\n        apiUrl += `?categories_exclude=1598`;\r\n    }\r\n\r\n    const posts = await ofetch(apiUrl, {\r\n        query: {\r\n            per_page: 20,\r\n            _embed: 'wp:featuredmedia',\r\n        },\r\n    });\r\n\r\n    if (!posts || !posts.length) {\r\n        throw new Error('No posts found');\r\n    }\r\n\r\n    const items = posts.map((post) => {\r\n        const $ = load(post.content.rendered);\r\n\r\n        // remove unnecessary title\r\n        $('h1').first().remove();\r\n        $('h2').first().remove();\r\n\r\n        let thumbnail = '';\r\n        if (post._embedded && post._embedded['wp:featuredmedia'][0].source_url) {\r\n            thumbnail = post._embedded['wp:featuredmedia'][0].source_url;\r\n        }\r\n\r\n        if (thumbnail) {\r\n            $('body').prepend(`<img src=\"${thumbnail}\" alt=\"${post.title.rendered}\" />`);\r\n        }\r\n\r\n        return {\r\n            title: post.title.rendered,\r\n            link: post.link,\r\n            description: $.html(),\r\n            pubDate: parseDate(post.date_gmt),\r\n            guid: post.link,\r\n            author: 'とらのあな',\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: category ? `とらのあな総合インフォメーション - ${category}` : 'とらのあな総合インフォメーション',\r\n        link: category ? `https://news.toranoana.jp/category/${category}` : 'https://news.toranoana.jp/',\r\n        description: 'とらのあなの最新情報をお届け！同人誌、書籍、コミック、店舗フェア、イラスト展、とらのあな限定版、キャンペーンなど…スペシャルでお得な情報をいち早くチェック！',\r\n        item: items.filter(Boolean) as DataItem[],\r\n        language: 'ja',\r\n    };\r\n}\r\n"],"mappings":"+PAKA,MAAaA,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,SACb,QAAS,0BACT,WAAY,CAAE,SAAU,YACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,WACN,YAAa,CAAC,aACd,UACA,MAAO,CACH,CACI,MAAO,SACP,OAAQ,CAAC,qBACT,OAAQ,SAEZ,CACI,MAAO,OACP,OAAQ,CAAC,2BACT,OAAQ,eAEZ,CACI,MAAO,QACP,OAAQ,CAAC,iCACT,OAAQ,oBAEZ,CACI,OAAQ,CAAC,wCACT,OAAQ,oBAGhB,YAAa,qVASjB,eAAe,EAAQ,EAAoB,CACvC,GAAM,CAAE,WAAW,IAAO,EAAI,IAAI,QAC9B,EAAS,gDAEb,GAAI,EAAU,CACV,IAAM,EAAmB,MAAMC,EAAO,2DAA2D,KAC7F,GAAoB,EAAiB,OAAS,IAC9C,GAAU,eAAe,EAAiB,GAAG,WAIjD,GAAU,2BAGd,IAAM,EAAQ,MAAMA,EAAO,EAAQ,CAC/B,MAAO,CACH,SAAU,GACV,OAAQ,sBAIhB,GAAI,CAAC,GAAS,CAAC,EAAM,OACjB,MAAU,MAAM,kBAGpB,IAAM,EAAQ,EAAM,IAAK,GAAS,CAC9B,IAAM,EAAI,EAAK,EAAK,QAAQ,UAG5B,EAAE,MAAM,QAAQ,SAChB,EAAE,MAAM,QAAQ,SAEhB,IAAI,EAAY,GAShB,OARI,EAAK,WAAa,EAAK,UAAU,oBAAoB,GAAG,aACxD,EAAY,EAAK,UAAU,oBAAoB,GAAG,YAGlD,GACA,EAAE,QAAQ,QAAQ,aAAa,EAAU,SAAS,EAAK,MAAM,SAAS,OAGnE,CACH,MAAO,EAAK,MAAM,SAClB,KAAM,EAAK,KACX,YAAa,EAAE,OACf,QAAS,EAAU,EAAK,UACxB,KAAM,EAAK,KACX,OAAQ,WAIhB,MAAO,CACH,MAAO,EAAW,sBAAsB,IAAa,mBACrD,KAAM,EAAW,sCAAsC,IAAa,6BACpE,YAAa,iFACb,KAAM,EAAM,OAAO,SACnB,SAAU"}