{"version":3,"file":"daily-section-eTPAhpBB.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/zhihu/daily-section.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { header, processImage } from './utils';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\n// 参考：https://github.com/izzyleung/ZhihuDailyPurify/wiki/%E7%9F%A5%E4%B9%8E%E6%97%A5%E6%8A%A5-API-%E5%88%86%E6%9E%90\r\n// 文章给出了v7版 api的信息，包含全文api\r\n\r\nexport const route: Route = {\r\n    path: '/daily/section/:sectionId',\r\n    categories: ['social-media'],\r\n    example: '/zhihu/daily/section/2',\r\n    parameters: { sectionId: '合集 id，可在 https://news-at.zhihu.com/api/7/sections 找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['daily.zhihu.com/*'],\r\n            target: '/daily',\r\n        },\r\n    ],\r\n    name: '知乎日报 - 合集',\r\n    maintainers: ['ccbikai'],\r\n    handler,\r\n    url: 'daily.zhihu.com/*',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const sectionId = ctx.req.param('sectionId');\r\n    const listRes = await got({\r\n        method: 'get',\r\n        url: `https://news-at.zhihu.com/api/7/section/${sectionId}`,\r\n        headers: {\r\n            ...header,\r\n            Referer: `https://news-at.zhihu.com/api/7/section/${sectionId}`,\r\n        },\r\n    });\r\n    // 根据api的说明，过滤掉极个别站外链接\r\n    const storyList = listRes.data.stories.filter((el) => el.url.startsWith('https://daily.zhihu.com/'));\r\n    const resultItem = await Promise.all(\r\n        storyList.map((story) => {\r\n            const url = 'https://news-at.zhihu.com/api/7/news/' + story.id;\r\n            const item = {\r\n                title: story.title,\r\n                pubDate: parseDate(story.date, 'YYYYMMDD'),\r\n                description: '',\r\n                link: 'https://daily.zhihu.com/story/' + story.id,\r\n            };\r\n            return cache.tryGet(`https://daily.zhihu.com/story/${story.id}`, async () => {\r\n                const storyDetail = await got({\r\n                    method: 'get',\r\n                    url,\r\n                    headers: {\r\n                        Referer: url,\r\n                    },\r\n                });\r\n                item.description = processImage(storyDetail.data.body.replaceAll(/<div class=\"meta\">([\\S\\s]*?)<\\/div>/g, '<strong>$1</strong>').replaceAll(/<\\/?h2.*?>/g, ''));\r\n\r\n                return item;\r\n            });\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: `${listRes.data.name} - 知乎日报`,\r\n        link: 'https://daily.zhihu.com',\r\n        description: '每天3次，每次7分钟',\r\n        image: 'http://static.daily.zhihu.com/img/new_home_v3/mobile_top_logo.png',\r\n        item: resultItem,\r\n    };\r\n}\r\n"],"mappings":"kaASA,MAAaA,EAAe,CACxB,KAAM,4BACN,WAAY,CAAC,gBACb,QAAS,yBACT,WAAY,CAAE,UAAW,wDACzB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,qBACT,OAAQ,WAGhB,KAAM,YACN,YAAa,CAAC,WACd,UACA,IAAK,qBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAY,EAAI,IAAI,MAAM,aAC1B,EAAU,MAAMC,EAAI,CACtB,OAAQ,MACR,IAAK,2CAA2C,IAChD,QAAS,CACL,GAAG,EACH,QAAS,2CAA2C,OAItD,EAAY,EAAQ,KAAK,QAAQ,OAAQ,GAAO,EAAG,IAAI,WAAW,6BAClE,EAAa,MAAM,QAAQ,IAC7B,EAAU,IAAK,GAAU,CACrB,IAAM,EAAM,wCAA0C,EAAM,GACtD,EAAO,CACT,MAAO,EAAM,MACb,QAAS,EAAU,EAAM,KAAM,YAC/B,YAAa,GACb,KAAM,iCAAmC,EAAM,IAEnD,OAAOC,EAAM,OAAO,iCAAiC,EAAM,KAAM,SAAY,CACzE,IAAM,EAAc,MAAMD,EAAI,CAC1B,OAAQ,MACR,MACA,QAAS,CACL,QAAS,KAKjB,MAFA,GAAK,YAAc,EAAa,EAAY,KAAK,KAAK,WAAW,uCAAwC,uBAAuB,WAAW,cAAe,KAEnJ,OAKnB,MAAO,CACH,MAAO,GAAG,EAAQ,KAAK,KAAK,SAC5B,KAAM,0BACN,YAAa,aACb,MAAO,oEACP,KAAM"}