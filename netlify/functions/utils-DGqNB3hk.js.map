{"version":3,"file":"utils-DGqNB3hk.js","names":[],"sources":["../../lib/routes/taptap/utils.ts"],"sourcesContent":["import ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\nimport cache from '@/utils/cache';\r\nimport { Detail } from './types';\r\n\r\nconst X_UA = (lang = 'zh_CN') => `X-UA=${encodeURIComponent(`V=1&PN=WebApp&VN=0.1.0&LANG=${lang}&PLT=PC`)}`;\r\n\r\nconst getRootUrl = (isIntl = false) => (isIntl ? 'https://www.taptap.io' : 'https://www.taptap.cn');\r\n\r\nconst appDetail = (appId, lang = 'zh_CN', isIntl = false) =>\r\n    cache.tryGet(`taptap:appDetail:${appId}:${lang}:${isIntl}`, async () => {\r\n        const data = await ofetch(`${getRootUrl(isIntl)}/webapiv2/group/v1/detail?app_id=${appId}&${X_UA(lang)}`, {\r\n            headers: {\r\n                Referer: `${getRootUrl(isIntl)}/app/${appId}`,\r\n            },\r\n        });\r\n        return data.data;\r\n    }) as Promise<Detail>;\r\n\r\nconst imagePost = (images) =>\r\n    art(path.join(__dirname, 'templates/imagePost.art'), {\r\n        images,\r\n    });\r\n\r\nconst topicPost = async (appId, topicId, lang = 'zh_CN') => {\r\n    const res = await ofetch(`${getRootUrl(false)}/webapiv2/topic/v1/detail?id=${topicId}&${X_UA(lang)}`, {\r\n        headers: {\r\n            Referer: `${getRootUrl(false)}/app/${appId}`,\r\n        },\r\n    });\r\n    const $ = load(res.data.first_post.contents.text, null, false);\r\n    $('img').each((_, e) => {\r\n        const $e = $(e);\r\n        $e.attr('src', $e.attr('data-origin-url'));\r\n        $e.removeAttr('data-origin-url');\r\n    });\r\n    return $.html();\r\n};\r\n\r\nconst videoPost = (video) =>\r\n    art(path.join(__dirname, 'templates/videoPost.art'), {\r\n        previewUrl: video.thumbnail.original_url || video.thumbnail.url,\r\n    });\r\n\r\nexport { getRootUrl, X_UA, appDetail, imagePost, topicPost, videoPost };\r\n"],"mappings":"yRAOA,MAAM,GAAQ,EAAO,UAAY,QAAQ,mBAAmB,+BAA+B,EAAK,YAE1F,GAAc,EAAS,KAAW,EAAS,wBAA0B,wBAErE,GAAa,EAAO,EAAO,QAAS,EAAS,KAC/C,EAAM,OAAO,oBAAoB,EAAM,GAAG,EAAK,GAAG,IAAU,SAAY,CACpE,IAAM,EAAO,MAAM,EAAO,GAAG,EAAW,GAAQ,mCAAmC,EAAM,GAAG,EAAK,KAAS,CACtG,QAAS,CACL,QAAS,GAAG,EAAW,GAAQ,OAAO,OAG9C,OAAO,EAAK,OAGd,EAAa,GACf,EAAI,EAAA,KAAA,EAAA,oCAAiD,CACjD,WAGF,EAAY,MAAO,EAAO,EAAS,EAAO,UAAY,CACxD,IAAM,EAAM,MAAM,EAAO,GAAG,EAAW,IAAO,+BAA+B,EAAQ,GAAG,EAAK,KAAS,CAClG,QAAS,CACL,QAAS,GAAG,EAAW,IAAO,OAAO,OAGvC,EAAI,EAAK,EAAI,KAAK,WAAW,SAAS,KAAM,KAAM,IAMxD,OALA,EAAE,OAAO,MAAM,EAAG,IAAM,CACpB,IAAM,EAAK,EAAE,GACb,EAAG,KAAK,MAAO,EAAG,KAAK,oBACvB,EAAG,WAAW,qBAEX,EAAE,QAGP,EAAa,GACf,EAAI,EAAA,KAAA,EAAA,oCAAiD,CACjD,WAAY,EAAM,UAAU,cAAgB,EAAM,UAAU"}