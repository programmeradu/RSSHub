{"version":3,"file":"util-Dess27yo.js","names":["cache","got"],"sources":["../../lib/routes/mydrivers/util.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport cache from '@/utils/cache';\r\n\r\nconst domain = 'mydrivers.com';\r\nconst rootUrl = `https://m.${domain}`;\r\nconst rootRSSUrl = `https://rss.${domain}`;\r\nconst apiVoteUrl = new URL('m/newsvote.ashx', rootUrl).href;\r\n\r\nconst title = '快科技';\r\n\r\nconst categories = {\r\n    new: '最新',\r\n    hot: '热门',\r\n    zhibo: '直播',\r\n};\r\n\r\n/**\r\n * Converts a path string into a query string.\r\n * @param {string} path - The path string separated by slashes, containing key-value pairs.\r\n * @returns {string} - The query string with key-value pairs separated by question marks and equal signs.\r\n */\r\nconst convertToQueryString = (path) => {\r\n    const parts = path.split('/');\r\n    const queryStringParams = [];\r\n\r\n    for (let i = 0; i < parts.length; i += 2) {\r\n        const key = parts[i];\r\n        const value = parts[i + 1];\r\n        if (key !== undefined && value !== undefined) {\r\n            queryStringParams.push(`${key}=${value}`);\r\n        }\r\n    }\r\n\r\n    return `?${queryStringParams.join('&')}`;\r\n};\r\n\r\n/**\r\n * Retrieves information from a given URL using a provided tryGet function.\r\n * @param {string} url - The URL to retrieve information from.\r\n * @param {number|undefined} [range] - The index value of the range (optional).\r\n * @returns {Promise<Object>} - A promise that resolves to an object containing the retrieved information.\r\n */\r\nconst getInfo = (url, range) =>\r\n    cache.tryGet(url, async () => {\r\n        const { data: response } = await got(url);\r\n\r\n        const $ = load(response);\r\n\r\n        const icon = new URL($('link[rel=\"apple-touch-icon-precomposed\"]').prop('href'), rootUrl).href;\r\n        const image = `https:${$('div.logo a img').prop('src')}`;\r\n        const ranges = $('div.hottime a')\r\n            .toArray()\r\n            .map((a) => $(a).text());\r\n\r\n        return {\r\n            title: `${title} - ${range !== undefined && ranges ? ranges[range] : $(`a[data-id=\"${url.split(/=/).pop()}\"]`).text() || $('#newsEventSwitch a.cur').text()}`,\r\n            link: url,\r\n            description: $('meta[name=\"description\"]').prop('content'),\r\n            language: 'zh-cn',\r\n            image,\r\n            icon,\r\n            logo: icon,\r\n            subtitle: $('meta[name=\"keywords\"]').prop('content'),\r\n            author: title,\r\n            allowEmpty: true,\r\n        };\r\n    });\r\n\r\n/**\r\n * Process items asynchronously.\r\n *\r\n * @param {Array<Object>} items - The array of items to process.\r\n * @param {function} tryGet - The tryGet function that handles the retrieval process.\r\n * @returns {Promise<Array<Object>>} Returns a Promise that resolves to an array of processed items.\r\n */\r\nconst processItems = async (items) =>\r\n    await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(`${domain}#${item.guid}`, async () => {\r\n                const { data: detailResponse } = await got(`${rootUrl}/newsview/${item.guid}.html`);\r\n\r\n                const { data: voteResponse } = await got.post(apiVoteUrl, {\r\n                    json: {\r\n                        Tid: item.guid,\r\n                    },\r\n                });\r\n\r\n                const content = load(detailResponse);\r\n\r\n                item.title = content('div.news_t').text() || item.title;\r\n                item.description = content('#content').html() ?? item.description;\r\n                item.author = content('li.writer').text() || item.author;\r\n                item.category = [\r\n                    ...(item.category ?? []),\r\n                    ...content('div.bqian1 a')\r\n                        .toArray()\r\n                        .map((c) => content(c).contents().last().text().trim()),\r\n                ].filter(Boolean);\r\n                item.guid = `${domain}#${item.guid}`;\r\n                item.pubDate = item.pubDate ?? timezone(parseDate(content('li.writer').next().text().trim(), 'YYYY年MM月DD日 HH:mm'), +8);\r\n                item.upvotes = voteResponse.NewsSupport ? Number.parseInt(voteResponse.NewsSupport, 10) : 0;\r\n                item.downvotes = voteResponse.NewsOppose ? Number.parseInt(voteResponse.NewsOppose, 10) : 0;\r\n                item.comments = content('#tpinglun').text() ? Number.parseInt(content('#tpinglun').text(), 10) : 0;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\nexport { rootUrl, rootRSSUrl, title, categories, convertToQueryString, getInfo, processItems };\r\n"],"mappings":"0OAMA,MAAM,EAAS,gBACT,EAAU,aAAa,IACvB,EAAa,eAAe,IAC5B,EAAa,IAAI,IAAI,kBAAmB,GAAS,KAEjD,EAAQ,MAER,EAAa,CACf,IAAK,KACL,IAAK,KACL,MAAO,MAQL,EAAwB,GAAS,CACnC,IAAM,EAAQ,EAAK,MAAM,KACnB,EAAoB,GAE1B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM,OAAQ,GAAK,EAAG,CACtC,IAAM,EAAM,EAAM,GACZ,EAAQ,EAAM,EAAI,GACpB,IAAQ,IAAA,IAAa,IAAU,IAAA,IAC/B,EAAkB,KAAK,GAAG,EAAI,GAAG,KAIzC,MAAO,IAAI,EAAkB,KAAK,QAShC,GAAW,EAAK,IAClBA,EAAM,OAAO,EAAK,SAAY,CAC1B,GAAM,CAAE,KAAM,GAAa,MAAMC,EAAI,GAE/B,EAAI,EAAK,GAET,EAAO,IAAI,IAAI,EAAE,4CAA4C,KAAK,QAAS,GAAS,KACpF,EAAQ,SAAS,EAAE,kBAAkB,KAAK,SAC1C,EAAS,EAAE,iBACZ,UACA,IAAK,GAAM,EAAE,GAAG,QAErB,MAAO,CACH,MAAO,GAAG,EAAM,KAAK,IAAU,IAAA,IAAa,EAAS,EAAO,GAAS,EAAE,cAAc,EAAI,MAAM,KAAK,MAAM,KAAK,QAAU,EAAE,0BAA0B,SACrJ,KAAM,EACN,YAAa,EAAE,4BAA4B,KAAK,WAChD,SAAU,QACV,QACA,OACA,KAAM,EACN,SAAU,EAAE,yBAAyB,KAAK,WAC1C,OAAQ,EACR,WAAY,MAWlB,EAAe,KAAO,IACxB,MAAM,QAAQ,IACV,EAAM,IAAK,GACPD,EAAM,OAAO,GAAG,EAAO,GAAG,EAAK,OAAQ,SAAY,CAC/C,GAAM,CAAE,KAAM,GAAmB,MAAMC,EAAI,GAAG,EAAQ,YAAY,EAAK,KAAK,QAEtE,CAAE,KAAM,GAAiB,MAAMA,EAAI,KAAK,EAAY,CACtD,KAAM,CACF,IAAK,EAAK,QAIZ,EAAU,EAAK,GAiBrB,MAfA,GAAK,MAAQ,EAAQ,cAAc,QAAU,EAAK,MAClD,EAAK,YAAc,EAAQ,YAAY,QAAU,EAAK,YACtD,EAAK,OAAS,EAAQ,aAAa,QAAU,EAAK,OAClD,EAAK,SAAW,CACZ,GAAI,EAAK,UAAY,GACrB,GAAG,EAAQ,gBACN,UACA,IAAK,GAAM,EAAQ,GAAG,WAAW,OAAO,OAAO,SACtD,OAAO,SACT,EAAK,KAAO,GAAG,EAAO,GAAG,EAAK,OAC9B,EAAK,QAAU,EAAK,SAAW,EAAS,EAAU,EAAQ,aAAa,OAAO,OAAO,OAAQ,qBAAsB,GACnH,EAAK,QAAU,EAAa,YAAc,OAAO,SAAS,EAAa,YAAa,IAAM,EAC1F,EAAK,UAAY,EAAa,WAAa,OAAO,SAAS,EAAa,WAAY,IAAM,EAC1F,EAAK,SAAW,EAAQ,aAAa,OAAS,OAAO,SAAS,EAAQ,aAAa,OAAQ,IAAM,EAE1F"}