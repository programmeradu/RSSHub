{"version":3,"file":"video-C4CPjEw8.js","names":["route: Route","puppeteer","cache"],"sources":["../../lib/routes/iqiyi/video.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport { config } from '@/config';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport logger from '@/utils/logger';\r\nimport puppeteer from '@/utils/puppeteer';\r\n\r\n// /iqiyi/user/video/:uid\r\n// http://localhost:1200/iqiyi/user/video/2289191062\r\nexport const route: Route = {\r\n    path: '/user/video/:uid',\r\n    categories: ['multimedia'],\r\n    example: '/iqiyi/user/video/2289191062',\r\n    parameters: { uid: '用户名' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['iqiyi.com/u/:uid/*'],\r\n        },\r\n    ],\r\n    name: '用户视频',\r\n    maintainers: ['talengu', 'JimenezLi'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const uid = ctx.req.param('uid');\r\n    const link = `https://www.iqiyi.com/u/${uid}/videos`;\r\n\r\n    // Use puppeteer because iqiyi page has a delay.\r\n    const browser = await puppeteer();\r\n    const data = await cache.tryGet(\r\n        link,\r\n        async () => {\r\n            const page = await browser.newPage();\r\n            await page.setRequestInterception(true);\r\n            page.on('request', (request) => {\r\n                request.resourceType() === 'document' || request.resourceType() === 'script' ? request.continue() : request.abort();\r\n            });\r\n            logger.http(`Requesting ${link}`);\r\n            await page.goto(link, {\r\n                waitUntil: 'domcontentloaded',\r\n            });\r\n            await page.waitForSelector('li.pic-txt-li');\r\n            const html = await page.content();\r\n\r\n            const $ = load(html);\r\n            const list = $('li.pic-txt-li');\r\n\r\n            return {\r\n                title: $('title').text(),\r\n                link,\r\n                item: list.toArray().map((item) => ({\r\n                    title: $(item).attr('title'),\r\n                    // description: `<img src=\"${$(item).find('.li-pic img').attr('src')}\">`,\r\n                    pubDate: parseDate($(item).find('.li-sub span.sub-date').text(), 'YYYY-MM-DD'),\r\n                    link: $(item).find('.li-dec a').attr('href'),\r\n                })),\r\n            };\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    );\r\n    await browser.close();\r\n\r\n    return data;\r\n}\r\n"],"mappings":"oUAUA,MAAaA,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,cACb,QAAS,+BACT,WAAY,CAAE,IAAK,OACnB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,wBAGjB,KAAM,OACN,YAAa,CAAC,UAAW,aACzB,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,EAAI,IAAI,MAAM,OACpB,EAAO,2BAA2B,EAAI,SAGtC,EAAU,MAAMC,IAChB,EAAO,MAAMC,EAAM,OACrB,EACA,SAAY,CACR,IAAM,EAAO,MAAM,EAAQ,UAC3B,MAAM,EAAK,uBAAuB,IAClC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,YAAc,EAAQ,iBAAmB,SAAW,EAAQ,WAAa,EAAQ,UAEhH,EAAO,KAAK,cAAc,KAC1B,MAAM,EAAK,KAAK,EAAM,CAClB,UAAW,qBAEf,MAAM,EAAK,gBAAgB,iBAC3B,IAAM,EAAO,MAAM,EAAK,UAElB,EAAI,EAAK,GACT,EAAO,EAAE,iBAEf,MAAO,CACH,MAAO,EAAE,SAAS,OAClB,OACA,KAAM,EAAK,UAAU,IAAK,IAAU,CAChC,MAAO,EAAE,GAAM,KAAK,SAEpB,QAAS,EAAU,EAAE,GAAM,KAAK,yBAAyB,OAAQ,cACjE,KAAM,EAAE,GAAM,KAAK,aAAa,KAAK,aAIjD,EAAO,MAAM,YACb,IAIJ,OAFA,MAAM,EAAQ,QAEP"}