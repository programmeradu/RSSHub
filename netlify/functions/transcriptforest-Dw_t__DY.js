import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import o from"node:path";import{load as s}from"cheerio";t();const c=e=>{let t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60),i=String(t).padStart(2,`0`),a=String(n).padStart(2,`0`),o=String(r).padStart(2,`0`);return`${i}:${a}:${o}`},l={path:`/:channel?`,radar:[{source:[`www.transcriptforest.com/en/channel`],target:``}],name:`Unknown`,maintainers:[`nczitzk`],handler:u,url:`www.transcriptforest.com/en/channel`};async function u(t){let l=t.req.param(`channel`),u=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):10,d=`https://www.transcriptforest.com`,{data:f}=await a(d),p=JSON.parse(f.match(/({"props".*"scriptLoader":\[]})<\/script>/)?.[1]),m=p.buildId,h=p.defaultLocale,g=p.props.pageProps.listChannel,_=l?g.find(e=>e.channel_id===l||e.channel_name===l):void 0,v=new URL(`_next/data/${m}/en${_?`/channel/${_.channel_id}`:``}.json`,d).href,y=new URL(_?`${h}/channel/${_.channel_id}`:``,d).href,{data:b}=await a(v,{searchParams:{channelName:_?_.channel_id:``,offset:0}}),x=b.pageProps.listEpisode.data.slice(0,u).map(t=>({title:t.episode_name,link:new URL(`${h}/${t.channel_id}/${t.episode_id}`,d).href,detailUrl:new URL(`_next/data/${m}/${h}/${t.channel_id}/${t.episode_id}.json`,d).href,description:r(o.join(e,`templates/description-a363210f.art`),{texts:t.episode_description.split(/\n\n/).map(e=>({text:e}))}),author:t.channel_name,guid:t.id,pubDate:i(t.published_at),updated:i(t.updated_at),itunes_item_image:t.episode_cover.split(/\?/)[0],itunes_duration:t.episode_duration,enclosure_url:t.source_media,enclosure_type:`audio/mpeg`}));x=await Promise.all(x.map(t=>n.tryGet(t.link,async()=>{let{data:n}=await a(t.detailUrl),{data:i}=await a(n.pageProps.currentEpisode.ps4_url);return t.description=r(o.join(e,`templates/description-a363210f.art`),{audios:[{src:n.pageProps.currentEpisode.media,type:`audio/mpeg`}]})+t.description+r(o.join(e,`templates/description-a363210f.art`),{texts:i.map(e=>({startTime:c(e.startTime),endTime:c(e.endTime),text:e.readOnlyText}))}),delete t.detailUrl,t})));let{data:S}=await a(y),C=s(S),w=C(`title`).text(),T=C(`meta[property="og:image"]`).prop(`content`),E=new URL(C(`link[rel="apple-touch-icon"]`).prop(`href`),d).href,D=w.split(/\|/)[0].trim();return{item:x,title:w,link:y,description:C(`meta[name="description"]`).prop(`content`),language:C(`html`).prop(`lang`),image:T,icon:E,logo:E,author:D,itunes_author:D,allowEmpty:!0}}export{l as route};
//# sourceMappingURL=transcriptforest-Dw_t__DY.js.map