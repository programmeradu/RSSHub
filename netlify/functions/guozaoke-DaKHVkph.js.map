{"version":3,"file":"guozaoke-DaKHVkph.js","names":["route: Route","got","url","cache","res","$","item"],"sources":["../../lib/routes/guozaoke/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseRelativeDate } from '@/utils/parse-date';\r\nimport { config } from '@/config';\r\nimport cache from '@/utils/cache';\r\nimport pMap from 'p-map';\r\n\r\nexport const route: Route = {\r\n    path: '/default',\r\n    categories: ['bbs'],\r\n    example: '/guozaoke/default',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '过早客',\r\n    maintainers: ['xiaoshame'],\r\n    handler,\r\n    url: 'guozaoke.com/',\r\n};\r\n\r\nasync function handler() {\r\n    const url = 'https://www.guozaoke.com/';\r\n    const res = await got({\r\n        method: 'get',\r\n        url,\r\n        headers: {\r\n            Cookie: config.guozaoke.cookies,\r\n            'User-Agent': config.ua,\r\n        },\r\n    });\r\n    const $ = load(res.data);\r\n\r\n    const list = $('div.topic-item').toArray();\r\n    const maxItems = 20; // 最多取20个数据\r\n\r\n    const items = list\r\n        .slice(0, maxItems)\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            const title = $item.find('h3.title a').text();\r\n            const url = $item.find('h3.title a').attr('href');\r\n            const author = $item.find('span.username a').text();\r\n            const lastTouched = $item.find('span.last-touched').text();\r\n            const pubDate = parseRelativeDate(lastTouched);\r\n            const link = url ? url.split('#')[0] : undefined;\r\n            return link ? { title, link, author, pubDate } : undefined;\r\n        })\r\n        .filter((item) => item !== undefined);\r\n\r\n    const out = await pMap(\r\n        items,\r\n        (item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const url = `https://www.guozaoke.com${item.link}`;\r\n                const res = await got({\r\n                    method: 'get',\r\n                    url,\r\n                    headers: {\r\n                        Cookie: config.guozaoke.cookies,\r\n                    },\r\n                });\r\n\r\n                const $ = load(res.data);\r\n                let content = $('div.ui-content').html();\r\n                content = content ? content.trim() : '';\r\n                const comments = $('.reply-item').map((i, el) => {\r\n                    const $el = $(el);\r\n                    const comment = $el.find('span.content').text().trim();\r\n                    const author = $el.find('span.username').text();\r\n                    return {\r\n                        comment,\r\n                        author,\r\n                    };\r\n                });\r\n                if (comments && comments.length > 0) {\r\n                    for (const item of comments) {\r\n                        content += '<br>' + item.author + ': ' + item.comment;\r\n                    }\r\n                }\r\n                item.description = content;\r\n                return item;\r\n            }),\r\n        { concurrency: 2 }\r\n    );\r\n\r\n    return {\r\n        title: '过早客',\r\n        link: url,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"sZAQA,MAAaA,EAAe,CACxB,KAAM,WACN,WAAY,CAAC,OACb,QAAS,oBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,MACN,YAAa,CAAC,aACd,UACA,IAAK,iBAGT,eAAe,GAAU,CACrB,IAAM,EAAM,4BACN,EAAM,MAAMC,EAAI,CAClB,OAAQ,MACR,MACA,QAAS,CACL,OAAQ,EAAO,SAAS,QACxB,aAAc,EAAO,MAGvB,EAAI,EAAK,EAAI,MAEb,EAAO,EAAE,kBAAkB,UAG3B,EAAQ,EACT,MAAM,EAAG,IACT,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GACV,EAAQ,EAAM,KAAK,cAAc,OACjCC,EAAM,EAAM,KAAK,cAAc,KAAK,QACpC,EAAS,EAAM,KAAK,mBAAmB,OACvC,EAAc,EAAM,KAAK,qBAAqB,OAC9C,EAAU,EAAkB,GAC5B,EAAOA,EAAMA,EAAI,MAAM,KAAK,GAAK,IAAA,GACvC,OAAO,EAAO,CAAE,QAAO,OAAM,SAAQ,WAAY,IAAA,KAEpD,OAAQ,GAAS,IAAS,IAAA,IAEzB,EAAM,MAAM,EACd,EACC,GACGC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMD,EAAM,2BAA2B,EAAK,OACtCE,EAAM,MAAMH,EAAI,CAClB,OAAQ,MACR,IAAA,EACA,QAAS,CACL,OAAQ,EAAO,SAAS,WAI1BI,EAAI,EAAKD,EAAI,MACf,EAAUC,EAAE,kBAAkB,OAClC,EAAU,EAAU,EAAQ,OAAS,GACrC,IAAM,EAAWA,EAAE,eAAe,KAAK,EAAG,IAAO,CAC7C,IAAM,EAAMA,EAAE,GACR,EAAU,EAAI,KAAK,gBAAgB,OAAO,OAC1C,EAAS,EAAI,KAAK,iBAAiB,OACzC,MAAO,CACH,UACA,YAGR,GAAI,GAAY,EAAS,OAAS,EAC9B,IAAK,IAAMC,KAAQ,EACf,GAAW,OAASA,EAAK,OAAS,KAAOA,EAAK,QAItD,MADA,GAAK,YAAc,EACZ,IAEf,CAAE,YAAa,IAGnB,MAAO,CACH,MAAO,MACP,KAAM,EACN,KAAM"}