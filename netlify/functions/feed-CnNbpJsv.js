import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{config as n}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as r}from"./cache-kimkMTWJ.js";import{art as i}from"./render-CxhTJIsl.js";import{parseDate as a}from"./parse-date-Bgabdhlb.js";import{ofetch_default as o}from"./ofetch-Bzt0BXUH.js";import s from"node:path";import*as c from"cheerio";t();const l={path:`/:creator`,categories:[`new-media`],example:`/patreon/straightupsisters`,parameters:{creator:`Patreon creator id, can be found in the url`},features:{requireConfig:[{name:`PATREON_SESSION_ID`,optional:!0,description:`The value of the session_id cookie after logging in to Patreon, required to access paid posts`}]},radar:[{source:[`patreon.com/:creator`]}],name:`Home`,maintainers:[`TonyRL`],handler:u};async function u(t){let{creator:l}=t.req.param(),u=`https://www.patreon.com/${l}`,d=await r.tryGet(`patreon:creator:${l}`,async()=>{let e=await o(u),t=c.load(e),n=JSON.parse(t(`#__NEXT_DATA__`).text()),r=n.props.pageProps.bootstrapEnvelope;return{meta:r.meta,id:r.pageBootstrap.campaign.data.id,attributes:r.pageBootstrap.campaign.data.attributes}});if(!d.id)throw Error(`Creator not found`);let f={};n.patreon?.sessionId&&(f={Cookie:`session_id=${n.patreon.sessionId}`});let p=await o(`https://www.patreon.com/api/posts`,{headers:f,query:{include:`campaign,access_rules,access_rules.tier.null,attachments_media,audio,audio_preview.null,drop,images,media,native_video_insights,poll.choices,poll.current_user_responses.user,poll.current_user_responses.choice,poll.current_user_responses.poll,user,user_defined_tags,ti_checks,video.null,content_unlock_options.product_variant.null`,"fields[campaign]":`currency,show_audio_post_download_links,avatar_photo_url,avatar_photo_image_urls,earnings_visibility,is_nsfw,is_monthly,name,url`,"fields[post]":`change_visibility_at,comment_count,commenter_count,content,created_at,current_user_can_comment,current_user_can_delete,current_user_can_report,current_user_can_view,current_user_comment_disallowed_reason,current_user_has_liked,embed,image,insights_last_updated_at,is_paid,like_count,meta_image_url,min_cents_pledged_to_view,monetization_ineligibility_reason,post_file,post_metadata,published_at,patreon_url,post_type,pledge_url,preview_asset_type,thumbnail,thumbnail_url,teaser_text,title,upgrade_url,url,was_posted_by_campaign_owner,has_ti_violation,moderation_status,post_level_suspension_removal_date,pls_one_liners_by_category,video,video_preview,view_count,content_unlock_options,is_new_to_current_user,watch_state`,"fields[post_tag]":`tag_type,value`,"fields[user]":`image_url,full_name,url`,"fields[access_rule]":`access_rule_type,amount_cents`,"fields[media]":`id,image_urls,display,download_url,metadata,file_name`,"fields[native_video_insights]":`average_view_duration,average_view_pct,has_preview,id,last_updated_at,num_views,preview_views,video_duration`,"fields[content-unlock-option]":`content_unlock_type`,"fields[product-variant]":`price_cents,currency_code,checkout_url,is_hidden,published_at_datetime,content_type,orders_count,access_metadata`,"filter[campaign_id]":d.id,"filter[contains_exclusive_posts]":!0,"filter[is_draft]":!1,sort:`-published_at`,"json-api-use-default-includes":!1,"json-api-version":`1.0`}}),m=p.data.map(({attributes:t,relationships:n})=>{for(let[e,t]of Object.entries(n))t.data&&(n[e]=Array.isArray(t.data)?t.data.map(e=>p.included.find(t=>t.id===e.id)):p.included.find(e=>e.id===t.data.id));return t.video_preview&&(n.video_preview=p.included.find(e=>Number.parseInt(e.id)===t.video_preview?.media_id)),{title:t.title,description:i(s.join(e,`templates/description-f86d980a.art`),{attributes:t,relationships:n,included:p.included}),link:t.url,pubDate:a(t.published_at),image:t.thumbnail?.url??t.image?.url,category:n.user_defined_tags?.map(e=>e.attributes.value)}});return{title:d.meta.title,description:d.meta.desc,link:u,image:d.attributes.avatar_photo_url,item:m,allowEmpty:!0}}export{l as route};
//# sourceMappingURL=feed-CnNbpJsv.js.map