{"version":3,"file":"auditstatus-CLsD9kRt.js","names":["route: Route","got"],"sources":["../../lib/routes/gov/csrc/auditstatus.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport md5 from '@/utils/md5';\r\n\r\nexport const route: Route = {\r\n    path: '/csrc/auditstatus/:apply_id',\r\n    categories: ['government'],\r\n    example: '/gov/csrc/auditstatus/9ce91cf2d750ee62de27fbbcb05fa483',\r\n    parameters: { apply_id: '事项类别id，`https://neris.csrc.gov.cn/alappl/home/xkDetail` 列表中各地址的 appMatrCde 参数' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '申请事项进度',\r\n    maintainers: ['hillerliao'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://neris.csrc.gov.cn';\r\n    const { apply_id } = ctx.req.param();\r\n    const itemUrl = `${baseUrl}/alappl/home1/onlinealog`;\r\n    const res = await got(itemUrl, {\r\n        searchParams: {\r\n            appMatrCde: apply_id,\r\n        },\r\n    });\r\n    const $ = load(res.data);\r\n\r\n    const out = $('tr[height=\"50\"]')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const itemTitle = item.find('li.templateTip').text();\r\n            const audit_status_td = item.find('td[style=\"font-weight:100 ;color: black ;position: relative;left:20px\"]');\r\n            const audit_status = audit_status_td.eq(-1).text();\r\n            const title = '【' + audit_status + '】' + itemTitle;\r\n            const audit_date = audit_status_td.eq(-1).next('td').text();\r\n\r\n            let audit_desc = '';\r\n            if (audit_status_td.length > 1) {\r\n                for (let i = 0; i < audit_status_td.length; i++) {\r\n                    audit_desc += audit_status_td.eq(i).next('td').text() + '，' + audit_status_td.eq(i).text() + '；';\r\n                }\r\n            } else {\r\n                audit_desc = audit_date + '，' + audit_status;\r\n            }\r\n\r\n            const description = itemTitle + '：' + audit_desc;\r\n\r\n            const single = {\r\n                title,\r\n                description,\r\n                pubDate: timezone(parseDate(audit_date), 8),\r\n                link: res.url,\r\n                guid: `${res.url}#${md5(description)}`,\r\n            };\r\n            return single;\r\n        });\r\n\r\n    return {\r\n        title: `${$('.zx2 div').attr('title')} - 申请事项进度查询 - 中国证监会`,\r\n        link: res.url,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"8YAOA,MAAaA,EAAe,CACxB,KAAM,8BACN,WAAY,CAAC,cACb,QAAS,yDACT,WAAY,CAAE,SAAU,iFACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,cACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GACM,CAAE,YAAa,EAAI,IAAI,QAEvB,EAAM,MAAMC,EAAI,oDAAS,CAC3B,aAAc,CACV,WAAY,KAGd,EAAI,EAAK,EAAI,MAEb,EAAM,EAAE,mBACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAY,EAAK,KAAK,kBAAkB,OACxC,EAAkB,EAAK,KAAK,2EAC5B,EAAe,EAAgB,GAAG,IAAI,OACtC,EAAQ,IAAM,EAAe,IAAM,EACnC,EAAa,EAAgB,GAAG,IAAI,KAAK,MAAM,OAEjD,EAAa,GACjB,GAAI,EAAgB,OAAS,EACzB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAgB,OAAQ,IACxC,GAAc,EAAgB,GAAG,GAAG,KAAK,MAAM,OAAS,IAAM,EAAgB,GAAG,GAAG,OAAS,SAGjG,EAAa,EAAa,IAAM,EAGpC,IAAM,EAAc,EAAY,IAAM,EAEhC,EAAS,CACX,QACA,cACA,QAAS,EAAS,EAAU,GAAa,GACzC,KAAM,EAAI,IACV,KAAM,GAAG,EAAI,IAAI,GAAG,EAAI,MAE5B,OAAO,IAGf,MAAO,CACH,MAAO,GAAG,EAAE,YAAY,KAAK,SAAS,qBACtC,KAAM,EAAI,IACV,KAAM"}