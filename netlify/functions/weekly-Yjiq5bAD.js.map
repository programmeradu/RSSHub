{"version":3,"file":"weekly-Yjiq5bAD.js","names":[],"sources":["../../lib/routes/iresearch/weekly.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/weekly/:category?',\r\n    categories: ['other'],\r\n    example: '/iresearch/weekly',\r\n    parameters: { category: '分类，见下表，默认为全部' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '周度市场观察',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `| 家电行业 | 服装行业 | 美妆行业 | 食品饮料行业 |\r\n| -------- | -------- | -------- | ------------ |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? '';\r\n\r\n    const rootUrl = 'https://www.iresearch.com.cn';\r\n    const currentUrl = `${rootUrl}/report?type=3`;\r\n    const apiUrl = `${rootUrl}/api/json/report/ireport.json`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: apiUrl,\r\n    });\r\n\r\n    const items = JSON.parse(response.data.slice(1))\r\n        .filter((item) => (category ? item.classname === category : true))\r\n        .slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 200)\r\n        .map((item) => ({\r\n            title: item.reportname,\r\n            pubDate: parseDate(item.addtime),\r\n            link: `${rootUrl}/report/detail?id=${item.id}`,\r\n            category: [item.classname, ...item.keywords.split(',')],\r\n            description: art(path.join(__dirname, 'templates/weekly.art'), {\r\n                id: item.id,\r\n                cover: item.reportpic,\r\n                content: item.shortcoutent,\r\n                pages: item.PagesCount,\r\n            }),\r\n        }));\r\n\r\n    return {\r\n        title: '艾瑞咨询 - 周度市场观察',\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"qYAOA,MAAa,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,SACb,QAAS,oBACT,WAAY,CAAE,SAAU,gBACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,WACd,UACA,YAAa;oDAIjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,GAExC,EAAU,+BACV,EAAa,GAAG,EAAQ,gBACxB,EAAS,GAAG,EAAQ,+BAEpB,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAQ,KAAK,MAAM,EAAS,KAAK,MAAM,IACxC,OAAQ,GAAU,EAAW,EAAK,YAAc,EAAW,IAC3D,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAC5E,IAAK,IAAU,CACZ,MAAO,EAAK,WACZ,QAAS,EAAU,EAAK,SACxB,KAAM,GAAG,EAAQ,oBAAoB,EAAK,KAC1C,SAAU,CAAC,EAAK,UAAW,GAAG,EAAK,SAAS,MAAM,MAClD,YAAa,EAAI,EAAA,KAAA,EAAA,iCAA8C,CAC3D,GAAI,EAAK,GACT,MAAO,EAAK,UACZ,QAAS,EAAK,aACd,MAAO,EAAK,gBAIxB,MAAO,CACH,MAAO,gBACP,KAAM,EACN,KAAM"}