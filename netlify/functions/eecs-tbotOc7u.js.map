{"version":3,"file":"eecs-tbotOc7u.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/pku/utils.ts","../../lib/routes/pku/eecs.ts"],"sourcesContent":["const eecsMap = new Map([\r\n    [0, 'qb.htm'],\r\n    [1, 'xytz.htm'],\r\n    [2, 'rstz.htm'],\r\n    [6, 'jwtz.htm'],\r\n    [8, 'xgtz.htm'],\r\n    [7, 'kytz.htm'],\r\n    [5, 'cwtz.htm'],\r\n    [3, 'ghtz.htm'],\r\n    [4, 'yytz.htm'],\r\n]);\r\n\r\nexport { eecsMap };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { eecsMap } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/eecs/:type?',\r\n    name: 'Unknown',\r\n    maintainers: ['Ir1d'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const host = 'https://eecs.pku.edu.cn';\r\n\r\n    let type = ctx.params && Number.parseInt(ctx.req.param('type'));\r\n    if (type === undefined) {\r\n        type = 0;\r\n    }\r\n\r\n    const response = await got(host + '/xygk1/ggtz/' + eecsMap.get(type));\r\n\r\n    const $ = load(response.data);\r\n    let items = $('.hvr-shutter-out-vertical')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item.attr('title'),\r\n                link: new URL(item.attr('href'), host).href,\r\n                pubDate: parseDate(item.find('em').text()),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detail = await got(item.link);\r\n                const content = load(detail.data);\r\n\r\n                content('input').remove();\r\n                content('h1').remove();\r\n                content('.con_xq').remove();\r\n\r\n                content('form[name=_newscontent_fromname] img').each((_, i) => {\r\n                    i = $(i);\r\n                    if (i.attr('src').startsWith('/')) {\r\n                        i.attr('src', new URL(i.attr('src'), host).href);\r\n                    }\r\n                });\r\n                content('form[name=_newscontent_fromname] ul li a').each((_, a) => {\r\n                    a = $(a);\r\n                    if (a.attr('href').startsWith('/')) {\r\n                        a.attr('href', new URL(a.attr('href'), host).href);\r\n                    }\r\n                });\r\n\r\n                item.description = content('form[name=_newscontent_fromname]').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link: host + '/xygk1/ggtz/' + eecsMap.get(type),\r\n        description: '北大信科 公告通知',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAAA,MAAM,EAAU,IAAI,IAAI,CACpB,CAAC,EAAG,UACJ,CAAC,EAAG,YACJ,CAAC,EAAG,YACJ,CAAC,EAAG,YACJ,CAAC,EAAG,YACJ,CAAC,EAAG,YACJ,CAAC,EAAG,YACJ,CAAC,EAAG,YACJ,CAAC,EAAG,cCDKA,EAAe,CACxB,KAAM,eACN,KAAM,UACN,YAAa,CAAC,QACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,0BAET,EAAO,EAAI,QAAU,OAAO,SAAS,EAAI,IAAI,MAAM,SACnD,IAAS,IAAA,KACT,EAAO,GAGX,IAAM,EAAW,MAAMC,EAAI,EAAO,eAAiB,EAAQ,IAAI,IAEzD,EAAI,EAAK,EAAS,MACpB,EAAQ,EAAE,6BACT,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,SACjB,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAM,KACvC,QAAS,EAAU,EAAK,KAAK,MAAM,WAiC/C,MA7BA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAS,MAAMD,EAAI,EAAK,MACxB,EAAU,EAAK,EAAO,MAoB5B,OAlBA,EAAQ,SAAS,SACjB,EAAQ,MAAM,SACd,EAAQ,WAAW,SAEnB,EAAQ,wCAAwC,MAAM,EAAG,IAAM,CAC3D,EAAI,EAAE,GACF,EAAE,KAAK,OAAO,WAAW,MACzB,EAAE,KAAK,MAAO,IAAI,IAAI,EAAE,KAAK,OAAQ,GAAM,QAGnD,EAAQ,4CAA4C,MAAM,EAAG,IAAM,CAC/D,EAAI,EAAE,GACF,EAAE,KAAK,QAAQ,WAAW,MAC1B,EAAE,KAAK,OAAQ,IAAI,IAAI,EAAE,KAAK,QAAS,GAAM,QAIrD,EAAK,YAAc,EAAQ,oCAAoC,OACxD,MAKZ,CACH,MAAO,EAAE,SAAS,OAClB,KAAM,EAAO,eAAiB,EAAQ,IAAI,GAC1C,YAAa,YACb,KAAM"}