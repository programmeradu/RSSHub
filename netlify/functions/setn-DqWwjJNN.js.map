{"version":3,"file":"setn-DqWwjJNN.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/setn/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst defaultRootUrl = 'https://www.setn.com';\r\n\r\nconst rootUrls = {\r\n    娛樂: 'https://star.setn.com',\r\n    健康: 'https://health.setn.com',\r\n    旅遊: 'https://travel.setn.com',\r\n    富房網: 'https://fuhouse.setn.com',\r\n    女孩: 'https://watch.setn.com',\r\n};\r\n\r\nconst ids = {\r\n    即時: '',\r\n    熱門: 0,\r\n    政治: 6,\r\n    社會: 41,\r\n    國際: 5,\r\n    兩岸: 68,\r\n    生活: 4,\r\n    運動: 34,\r\n    地方: 97,\r\n    財經: 2,\r\n    名家: 9,\r\n    新奇: 42,\r\n    科技: 7,\r\n    汽車: 12,\r\n    寵物: 47,\r\n    HOT焦點: 31,\r\n};\r\n\r\nconst getCurrentUrl = (category) => {\r\n    const rootUrl = Object.hasOwn(rootUrls, category) ? rootUrls[category] : defaultRootUrl;\r\n\r\n    if (Object.hasOwn(ids, category)) {\r\n        return `${rootUrl}/ViewAll.aspx${ids[category] === '' ? '' : `?PageGroupID=${ids[category]}`}`;\r\n    }\r\n\r\n    return `${rootUrl}/viewall`;\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    categories: ['traditional-media'],\r\n    example: '/setn',\r\n    parameters: { category: '分类，见下表，默认为即時' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['setn.com/ViewAll.aspx', 'setn.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: '新聞',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    url: 'setn.com/ViewAll.aspx',\r\n    description: `| 即時 | 熱門 | 娛樂 | 政治 | 社會 |\r\n| ---- | ---- | ---- | ---- | ---- |\r\n\r\n| 國際 | 兩岸 | 生活 | 健康 | 旅遊 |\r\n| ---- | ---- | ---- | ---- | ---- |\r\n\r\n| 運動 | 地方 | 財經 | 富房網 | 名家 |\r\n| ---- | ---- | ---- | ------ | ---- |\r\n\r\n| 新奇 | 科技 | 汽車 | 寵物 | 女孩 | HOT 焦點 |\r\n| ---- | ---- | ---- | ---- | ---- | -------- |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? '即時';\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 42;\r\n\r\n    const currentUrl = getCurrentUrl(category);\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    let items = $('#NewsList, .newsList, .hotNewsList')\r\n        .find('.newsItems, .st-news, .all_three_list, div.title-word')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('a').last();\r\n            const link = a.attr('href').replaceAll(/(\\?|&)utm_campaign=.*/g, '');\r\n\r\n            return {\r\n                title: a.text(),\r\n                link: link.startsWith('http') ? link : `${Object.hasOwn(rootUrls, category) ? rootUrls[category] : defaultRootUrl}${link}`,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n\r\n                const content = load(detailResponse.data);\r\n\r\n                let head = {};\r\n                try {\r\n                    head = JSON.parse(content('script[type=\"application/ld+json\"]').first().text());\r\n                } catch {\r\n                    head = {};\r\n                }\r\n\r\n                content('#gad_setn_innity_oop_1x1').remove();\r\n\r\n                item.title = content('h1').text();\r\n                item.author = head?.author?.name || content('meta[name=\"author\"]').attr('content');\r\n                item.category = [content('meta[property=\"article:section\"]').attr('content'), ...content('meta[name=\"news_keywords\"]').attr('content').split(',')];\r\n                item.pubDate = timezone(parseDate(content('meta[property=\"article:published_time\"]').attr('content')), +8);\r\n                item.description = content('article, .content-p').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `三立新聞網 - ${category}`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAM,EAAiB,uBAEjB,EAAW,CACb,GAAI,wBACJ,GAAI,0BACJ,GAAI,0BACJ,IAAK,2BACL,GAAI,0BAGF,EAAM,CACR,GAAI,GACJ,GAAI,EACJ,GAAI,EACJ,GAAI,GACJ,GAAI,EACJ,GAAI,GACJ,GAAI,EACJ,GAAI,GACJ,GAAI,GACJ,GAAI,EACJ,GAAI,EACJ,GAAI,GACJ,GAAI,EACJ,GAAI,GACJ,GAAI,GACJ,MAAO,IAGL,EAAiB,GAAa,CAChC,IAAM,EAAU,OAAO,OAAO,EAAU,GAAY,EAAS,GAAY,EAMzE,OAJI,OAAO,OAAO,EAAK,GACZ,GAAG,EAAQ,eAAe,EAAI,KAAc,GAAK,GAAK,gBAAgB,EAAI,OAG9E,GAAG,EAAQ,WAGTA,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,qBACb,QAAS,QACT,WAAY,CAAE,SAAU,gBACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,wBAAyB,aAClC,OAAQ,KAGhB,KAAM,KACN,YAAa,CAAC,WACd,UACA,IAAK,wBACL,YAAa;;;;;;;;;;kDAajB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,KACxC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GAE3E,EAAa,EAAc,GAE3B,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAEpB,EAAQ,EAAE,sCACT,KAAK,yDACL,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAI,EAAK,KAAK,KAAK,OACnB,EAAO,EAAE,KAAK,QAAQ,WAAW,yBAA0B,IAEjE,MAAO,CACH,MAAO,EAAE,OACT,KAAM,EAAK,WAAW,QAAU,EAAO,GAAG,OAAO,OAAO,EAAU,GAAY,EAAS,GAAY,IAAiB,OAkChI,MA9BA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGR,EAAU,EAAK,EAAe,MAEhC,EAAO,GACX,GAAI,CACA,EAAO,KAAK,MAAM,EAAQ,sCAAsC,QAAQ,aACpE,CACJ,EAAO,GAWX,OARA,EAAQ,4BAA4B,SAEpC,EAAK,MAAQ,EAAQ,MAAM,OAC3B,EAAK,OAAS,GAAM,QAAQ,MAAQ,EAAQ,uBAAuB,KAAK,WACxE,EAAK,SAAW,CAAC,EAAQ,oCAAoC,KAAK,WAAY,GAAG,EAAQ,8BAA8B,KAAK,WAAW,MAAM,MAC7I,EAAK,QAAU,EAAS,EAAU,EAAQ,2CAA2C,KAAK,YAAa,GACvG,EAAK,YAAc,EAAQ,uBAAuB,OAE3C,MAKZ,CACH,MAAO,WAAW,IAClB,KAAM,EACN,KAAM"}