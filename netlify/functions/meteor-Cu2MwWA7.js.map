{"version":3,"file":"meteor-Cu2MwWA7.js","names":["route: Route","cache","got"],"sources":["../../lib/routes/meteor/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { baseUrl, getBoards, renderDesc } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/:board?',\r\n    categories: ['bbs'],\r\n    example: '/meteor/all',\r\n    parameters: { board: '看板 ID 或簡稱，可在 URL 或下方路由找到，預設為 `all`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '看板',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let { board = 'all' } = ctx.req.param();\r\n\r\n    const boards = await getBoards(cache.tryGet);\r\n    let boardInfo;\r\n    if (board !== 'all') {\r\n        boardInfo = boards.find((b) => b.id === board || b.alias === board);\r\n        board = boardInfo.id;\r\n    }\r\n\r\n    const { data: response } = await got.post(`${baseUrl}/article/get_new_articles`, {\r\n        json: {\r\n            boardId: board,\r\n            isCollege: false,\r\n            page: 0,\r\n            pageSize: ctx.req.query('limit') ? Number(ctx.req.query('limit')) : 30,\r\n        },\r\n    });\r\n\r\n    const result = JSON.parse(decodeURIComponent(response.result));\r\n\r\n    const items = await Promise.all(\r\n        result.map((item) =>\r\n            cache.tryGet(`meteor:${item.id}`, () => ({\r\n                title: item.title,\r\n                description: renderDesc(item.content),\r\n                link: `${baseUrl}/article/${item.shortId}`,\r\n                author: item.authorAlias,\r\n                pubDate: parseDate(item.createdAt),\r\n            }))\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${board === 'all' ? '全部看板' : boardInfo.title} | Meteor 學生社群`,\r\n        description: board === 'all' ? null : boardInfo.feedDescription,\r\n        image: board === 'all' ? null : boardInfo.imgUrl === 'not_set' ? null : boardInfo.imgUrl,\r\n        link: `${board === 'all' ? `${baseUrl}/board/all` : boardInfo.link}/new`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mbAMA,MAAaA,EAAe,CACxB,KAAM,WACN,WAAY,CAAC,OACb,QAAS,cACT,WAAY,CAAE,MAAO,sCACrB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAI,CAAE,QAAQ,OAAU,EAAI,IAAI,QAE1B,EAAS,MAAM,EAAUC,EAAM,QACjC,EACA,IAAU,QACV,EAAY,EAAO,KAAM,GAAM,EAAE,KAAO,GAAS,EAAE,QAAU,GAC7D,EAAQ,EAAU,IAGtB,GAAM,CAAE,KAAM,GAAa,MAAMC,EAAI,KAAK,GAAG,EAAQ,2BAA4B,CAC7E,KAAM,CACF,QAAS,EACT,UAAW,GACX,KAAM,EACN,SAAU,EAAI,IAAI,MAAM,SAAW,OAAO,EAAI,IAAI,MAAM,UAAY,MAItE,EAAS,KAAK,MAAM,mBAAmB,EAAS,SAEhD,EAAQ,MAAM,QAAQ,IACxB,EAAO,IAAK,GACRD,EAAM,OAAO,UAAU,EAAK,UAAa,CACrC,MAAO,EAAK,MACZ,YAAa,EAAW,EAAK,SAC7B,KAAM,GAAG,EAAQ,WAAW,EAAK,UACjC,OAAQ,EAAK,YACb,QAAS,EAAU,EAAK,gBAKpC,MAAO,CACH,MAAO,GAAG,IAAU,MAAQ,OAAS,EAAU,MAAM,gBACrD,YAAa,IAAU,MAAQ,KAAO,EAAU,gBAChD,MAAO,IAAU,OAAe,EAAU,SAAW,UAA5B,KAA+C,EAAU,OAClF,KAAM,GAAG,IAAU,MAAQ,GAAG,EAAQ,YAAc,EAAU,KAAK,MACnE,KAAM"}