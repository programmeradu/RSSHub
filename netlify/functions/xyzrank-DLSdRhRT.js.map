{"version":3,"file":"xyzrank-DLSdRhRT.js","names":[],"sources":["../../lib/routes/xyzrank/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    radar: [\r\n        {\r\n            source: ['xyzrank.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n    url: 'xyzrank.com/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? '';\r\n\r\n    const rootUrl = 'https://xyzrank.com';\r\n    const currentUrl = `${rootUrl}/#/${category}`;\r\n\r\n    let response = await got({\r\n        method: 'get',\r\n        url: rootUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    response = await got({\r\n        method: 'get',\r\n        url: response.data.match(/<script type=\"module\" crossorigin src=\"(.*?)\"><\\/script>/)[1],\r\n    });\r\n\r\n    const matches = response.data.match(/pI=\"(.*?)\",gI=\"(.*?)\",mI=\"(.*?)\",_I=\"(.*?)\";var/);\r\n\r\n    const categories = {\r\n        '': {\r\n            url: matches[3],\r\n            title: '热门节目',\r\n            id: 'hot-episodes',\r\n            type: 'episodes',\r\n        },\r\n        'hot-podcasts': {\r\n            url: matches[1],\r\n            title: '热门播客',\r\n            id: 'full',\r\n            type: 'podcasts',\r\n        },\r\n        'hot-episodes-new': {\r\n            url: matches[4],\r\n            title: '新锐节目',\r\n            id: 'hot-episodes-new',\r\n            type: 'episodes',\r\n        },\r\n        'new-podcasts': {\r\n            url: matches[2],\r\n            title: '新锐播客',\r\n            id: 'new-podcasts',\r\n            type: 'podcasts',\r\n        },\r\n    };\r\n\r\n    response = await got({\r\n        method: 'get',\r\n        url: categories[category].url,\r\n    });\r\n\r\n    const type = categories[category].type;\r\n\r\n    const items = response.data.data[type].slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 250).map((item, index) => ({\r\n        title: `#${index + 1} ${item.title ?? item.name}`,\r\n        category: [item.primaryGenreName],\r\n        author: item.authorsText,\r\n        link: `${item.link ?? item.links[0].url}${item.trackCount ? `#${item.trackCount}` : ''}`,\r\n        pubDate: parseDate(item.postTime ?? item.lastReleaseDate),\r\n        description: art(path.join(__dirname, 'templates/description.art'), {\r\n            logo: item.logoURL,\r\n            items:\r\n                type === 'podcasts'\r\n                    ? {\r\n                          '#': index + 1,\r\n                          播客电台: item.name,\r\n                          主持: item.authorsText,\r\n                          分类: item.primaryGenreName,\r\n                          更新频率: `${(item.avgUpdateFreq / 24).toFixed(1)}天`,\r\n                          最近更新: `${item.lastReleaseDateDayCount.toFixed(1)}天前`,\r\n                          总集数: item.trackCount,\r\n                          平均时长: `${item.avgDuration}′`,\r\n                          平均播放量: item.avgPlayCount,\r\n                          平均评论量: item.avgCommentCount,\r\n                          千播互动量: (item.avgInteractIndicator * 1000).toFixed(0),\r\n                          平均打开率: `${(item.avgOpenRate * 100).toFixed(1)}%`,\r\n                          小宇宙: item.links[0].url,\r\n                          'Apple Podcasts': item.links[1].url,\r\n                          官方网站: item.links[2].url,\r\n                          'RSS 订阅': item.links[3].url,\r\n                      }\r\n                    : {\r\n                          '#': index + 1,\r\n                          节目标题: item.title,\r\n                          播客电台: item.podcastName,\r\n                          播放量: item.playCount,\r\n                          评论量: item.commentCount,\r\n                          互动率: `${((item.commentCount / item.playCount) * 100).toFixed(1)}%`,\r\n                          打开率: `${(item.openRate * 100).toFixed(1)}%`,\r\n                          时长: `${item.duration}′`,\r\n                          发布时间: item.postTime,\r\n                          分类: item.primaryGenreName,\r\n                          链接: item.link,\r\n                      },\r\n        }),\r\n    }));\r\n\r\n    return {\r\n        title: `${$('title').text()} - ${categories[category].title}`,\r\n        link: currentUrl,\r\n        item: items,\r\n        description: $('meta[property=\"og:description\"]').attr('content'),\r\n    };\r\n}\r\n"],"mappings":"oaAQA,MAAa,EAAe,CACxB,KAAM,cACN,MAAO,CACH,CACI,OAAQ,CAAC,gBACT,OAAQ,KAGhB,KAAM,UACN,YAAa,GACb,UACA,IAAK,gBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,GAExC,EAAU,sBACV,EAAa,GAAG,EAAQ,KAAK,IAE/B,EAAW,MAAM,EAAI,CACrB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAExB,EAAW,MAAM,EAAI,CACjB,OAAQ,MACR,IAAK,EAAS,KAAK,MAAM,4DAA4D,KAGzF,IAAM,EAAU,EAAS,KAAK,MAAM,mDAE9B,EAAa,CACf,GAAI,CACA,IAAK,EAAQ,GACb,MAAO,OACP,GAAI,eACJ,KAAM,YAEV,eAAgB,CACZ,IAAK,EAAQ,GACb,MAAO,OACP,GAAI,OACJ,KAAM,YAEV,mBAAoB,CAChB,IAAK,EAAQ,GACb,MAAO,OACP,GAAI,mBACJ,KAAM,YAEV,eAAgB,CACZ,IAAK,EAAQ,GACb,MAAO,OACP,GAAI,eACJ,KAAM,aAId,EAAW,MAAM,EAAI,CACjB,OAAQ,MACR,IAAK,EAAW,GAAU,MAG9B,IAAM,EAAO,EAAW,GAAU,KAE5B,EAAQ,EAAS,KAAK,KAAK,GAAM,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAK,KAAK,EAAM,KAAW,CAC1I,MAAO,IAAI,EAAQ,EAAE,GAAG,EAAK,OAAS,EAAK,OAC3C,SAAU,CAAC,EAAK,kBAChB,OAAQ,EAAK,YACb,KAAM,GAAG,EAAK,MAAQ,EAAK,MAAM,GAAG,MAAM,EAAK,WAAa,IAAI,EAAK,aAAe,KACpF,QAAS,EAAU,EAAK,UAAY,EAAK,iBACzC,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,KAAM,EAAK,QACX,MACI,IAAS,WACH,CACI,IAAK,EAAQ,EACb,KAAM,EAAK,KACX,GAAI,EAAK,YACT,GAAI,EAAK,iBACT,KAAM,IAAI,EAAK,cAAgB,IAAI,QAAQ,GAAG,GAC9C,KAAM,GAAG,EAAK,wBAAwB,QAAQ,GAAG,IACjD,IAAK,EAAK,WACV,KAAM,GAAG,EAAK,YAAY,GAC1B,MAAO,EAAK,aACZ,MAAO,EAAK,gBACZ,OAAQ,EAAK,qBAAuB,KAAM,QAAQ,GAClD,MAAO,IAAI,EAAK,YAAc,KAAK,QAAQ,GAAG,GAC9C,IAAK,EAAK,MAAM,GAAG,IACnB,iBAAkB,EAAK,MAAM,GAAG,IAChC,KAAM,EAAK,MAAM,GAAG,IACpB,SAAU,EAAK,MAAM,GAAG,KAE5B,CACI,IAAK,EAAQ,EACb,KAAM,EAAK,MACX,KAAM,EAAK,YACX,IAAK,EAAK,UACV,IAAK,EAAK,aACV,IAAK,IAAK,EAAK,aAAe,EAAK,UAAa,KAAK,QAAQ,GAAG,GAChE,IAAK,IAAI,EAAK,SAAW,KAAK,QAAQ,GAAG,GACzC,GAAI,GAAG,EAAK,SAAS,GACrB,KAAM,EAAK,SACX,GAAI,EAAK,iBACT,GAAI,EAAK,WAK/B,MAAO,CACH,MAAO,GAAG,EAAE,SAAS,OAAO,KAAK,EAAW,GAAU,QACtD,KAAM,EACN,KAAM,EACN,YAAa,EAAE,mCAAmC,KAAK"}