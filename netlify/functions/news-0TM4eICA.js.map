{"version":3,"file":"news-0TM4eICA.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/yomiuri/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    categories: ['traditional-media'],\r\n    example: '/yomiuri/news',\r\n    parameters: { category: 'Category, `news` by default' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.yomiuri.co.jp/:category?'],\r\n        },\r\n    ],\r\n    name: 'News',\r\n    maintainers: ['Arracc'],\r\n    handler,\r\n    description: `Free articles only.\r\n\r\n| Category       | Parameter |\r\n| -------------- | --------- |\r\n| 新着・速報     | news      |\r\n| 社会           | national  |\r\n| 政治           | politics  |\r\n| 経済           | economy   |\r\n| スポーツ       | sports    |\r\n| 国際           | world     |\r\n| 地域           | local     |\r\n| 科学・ＩＴ     | science   |\r\n| エンタメ・文化 | culture   |\r\n| ライフ         | life      |\r\n| 医療・健康     | medical   |\r\n| 教育・就活     | kyoiku    |\r\n| 選挙・世論調査 | election  |\r\n| 囲碁・将棋     | igoshougi |\r\n| 社説           | editorial |\r\n| 皇室           | koushitsu |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'news' } = ctx.req.param();\r\n    const url = `https://www.yomiuri.co.jp/${category}`;\r\n\r\n    const response = await got(url);\r\n    const data = response.data;\r\n    const $ = load(data);\r\n\r\n    let list;\r\n    if (category === 'news') {\r\n        list = $('.news-top-latest__list .news-top-latest__list-item__inner')\r\n            .toArray()\r\n            .map((item) => {\r\n                item = $(item);\r\n                const a = item.find('h3 a');\r\n                return {\r\n                    title: a.text(),\r\n                    link: a.attr('href'),\r\n                    pubDate: timezone(parseDate(item.find('time').attr('datetime')), +9),\r\n                    locked: item.find('.icon-locked').length,\r\n                };\r\n            });\r\n    } else {\r\n        $('.p-category-reading-recommend').remove();\r\n        list = $('.layout-contents__main .c-list-title')\r\n            .toArray()\r\n            .map((item) => {\r\n                item = $(item);\r\n                const a = item.find('h3 a');\r\n                const parent = item.parent();\r\n                return {\r\n                    title: a.text(),\r\n                    link: a.attr('href'),\r\n                    pubDate: timezone(parseDate(parent.find('time').attr('datetime')), +9),\r\n                    locked: parent.find('.c-list-member-only').length,\r\n                };\r\n            });\r\n    }\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                if (item.locked) {\r\n                    return item;\r\n                }\r\n\r\n                const response = await got(item.link);\r\n                const $ = load(response.data);\r\n                const mainContent = $('.p-main-contents');\r\n\r\n                mainContent.find('[class^=ev-article], svg').remove();\r\n                mainContent.find('img').each((_, img) => {\r\n                    img.attribs.src = img.attribs.src.split('?')[0];\r\n                });\r\n\r\n                item.description = mainContent.html();\r\n                item.pubDate = parseDate($('meta[property=\"article:published_time\"]').attr('content')); // 2023-05-17T22:33:00+09:00\r\n                item.updated = parseDate($('meta[property=\"article:modified_time\"]').attr('content'));\r\n\r\n                const tag = $('.p-header-category-breadcrumbs li a').last().text();\r\n                item.category = tag;\r\n                item.title = `[${tag}] ${item.title}`;\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        link: url,\r\n        image: 'https://www.yomiuri.co.jp/apple-touch-icon.png',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAaA,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,qBACb,QAAS,gBACT,WAAY,CAAE,SAAU,+BACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,kCAGjB,KAAM,OACN,YAAa,CAAC,UACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;+BAsBjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,QAAW,EAAI,IAAI,QAChC,EAAM,6BAA6B,IAEnC,EAAW,MAAMC,EAAI,GACrB,EAAO,EAAS,KAChB,EAAI,EAAK,GAEX,EACA,IAAa,OACb,EAAO,EAAE,6DACJ,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAI,EAAK,KAAK,QACpB,MAAO,CACH,MAAO,EAAE,OACT,KAAM,EAAE,KAAK,QACb,QAAS,EAAS,EAAU,EAAK,KAAK,QAAQ,KAAK,aAAc,GACjE,OAAQ,EAAK,KAAK,gBAAgB,WAI9C,EAAE,iCAAiC,SACnC,EAAO,EAAE,wCACJ,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAI,EAAK,KAAK,QACd,EAAS,EAAK,SACpB,MAAO,CACH,MAAO,EAAE,OACT,KAAM,EAAE,KAAK,QACb,QAAS,EAAS,EAAU,EAAO,KAAK,QAAQ,KAAK,aAAc,GACnE,OAAQ,EAAO,KAAK,uBAAuB,WAK3D,IAAM,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,EAAK,OACL,OAAO,EAGX,IAAMC,EAAW,MAAMF,EAAI,EAAK,MAC1BG,EAAI,EAAKD,EAAS,MAClB,EAAcC,EAAE,oBAEtB,EAAY,KAAK,4BAA4B,SAC7C,EAAY,KAAK,OAAO,MAAM,EAAG,IAAQ,CACrC,EAAI,QAAQ,IAAM,EAAI,QAAQ,IAAI,MAAM,KAAK,KAGjD,EAAK,YAAc,EAAY,OAC/B,EAAK,QAAU,EAAUA,EAAE,2CAA2C,KAAK,YAC3E,EAAK,QAAU,EAAUA,EAAE,0CAA0C,KAAK,YAE1E,IAAM,EAAMA,EAAE,uCAAuC,OAAO,OAG5D,MAFA,GAAK,SAAW,EAChB,EAAK,MAAQ,IAAI,EAAI,IAAI,EAAK,QACvB,MAKnB,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,KAAM,EACN,MAAO,iDACP,KAAM"}