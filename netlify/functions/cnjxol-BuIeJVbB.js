import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{invalid_parameter_default as o}from"./invalid-parameter-CUJdROXf.js";import s from"node:path";import{load as c}from"cheerio";t();const l={jxrb:`嘉兴日报`,nhwb:`南湖晚报`},u={path:`/:category?/:id?`,name:`Unknown`,maintainers:[],handler:d};async function d(t){let u=t.req.param(`category`)??`jxrb`,d=t.req.param(`id`);if(!Object.keys(l).includes(u))throw new o(`Invalid category`);let f=`https://${u}.cnjxol.com`,p=`${f}/${u}Paper/pc/layout`,m=await a({method:`get`,url:p}),h=c(m.data),g=h(`a`).first().attr(`href`).match(/\d{6}\/\d{2}/)[0],_=[];if(d){let e=`${p}/${g}/node_${d}.html`,t=await a({method:`get`,url:e});h=c(t.data),_=h(`#articlelist .clearfix a`).toArray().map(e=>`${p}/${h(e).attr(`href`)}`.replaceAll(`layout/../../../`,``))}else await Promise.all(h(`#list li a`).toArray().map(async e=>{let t=await a({method:`get`,url:`${p}/${h(e).attr(`href`)}`}),n=c(t.data);_.push(...n(`#articlelist .clearfix a`).toArray().map(e=>`${p}/${n(e).attr(`href`)}`.replaceAll(`layout/../../../`,``)))}));return _=await Promise.all(_.map(t=>n.tryGet(t,async()=>{let n=await a({method:`get`,url:t}),o=c(n.data);return{link:t,title:o(`#Title`).text(),pubDate:i(o(`date`).text()),description:r(s.join(e,`templates/description-80a34b72.art`),{attachment:o(`.attachment`).html(),content:o(`founder-content`).html()})}}))),{title:`${l[u]}${d?` - ${h(`#layout`).text()}`:``}`,link:p,item:_}}export{u as route};
//# sourceMappingURL=cnjxol-BuIeJVbB.js.map