import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import{invalid_parameter_default as s}from"./invalid-parameter-CUJdROXf.js";import{isValidHost as c}from"./valid-host-DEPw8oAS.js";import l from"node:path";import{load as u}from"cheerio";t();const d={path:`/:id?/:category{.+}?`,name:`Unknown`,maintainers:[],handler:f};async function f(t){let{id:d=`news`,category:f=`china`}=t.req.param();if(!c(d))throw new s(`Invalid id`);let p=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):30,m=`http://${d}.m4.cn`,h=new URL(f?`/${f.replace(/\/$/,``)}/`:`/`,m).href,{data:g}=await a(h),_=u(g),v=_(`div.articleitem0 div.aheader0`).slice(0,p).toArray().map(t=>{t=_(t);let n=t.find(`a`).first();return{title:n.text(),link:n.prop(`href`),description:r(l.join(e,`templates/description-b958bde9.art`),{images:[{src:t.parent().find(`div.aimg0 a img`).prop(`src`),alt:n.text()}]}),category:t.find(`a.aclass`).toArray().map(e=>_(e).text().replaceAll(`[]`,``).trim()),pubDate:o(i(t.find(`span.atime`).text()),8)}});v=await Promise.all(v.map(t=>n.tryGet(t.link,async()=>{let{data:n}=await a(t.link),s=u(n);return t.title=s(`h1`).first().text(),t.description=r(l.join(e,`templates/description-b958bde9.art`),{intro:s(`div.aintro1, p.cont-summary`).text(),description:s(`div.content0, div.cont-detail`).html()}),t.category=s(`span.dd0 a, a[rel="category"]`).toArray().map(e=>s(e).text()).slice(1),t.pubDate=o(i(s(`span.atime1, span.post-time`).text()),8),t})));let y=_(`a.logo0_b img`).prop(`src`);return{item:v,title:_(`title`).text(),link:h,description:_(`meta[name="description"]`).prop(`content`),language:`zh`,image:y,subtitle:_(`meta[name="keywords"]`).prop(`content`),author:_(`meta[name="author"]`).prop(`content`),allowEmpty:!0}}export{d as route};
//# sourceMappingURL=m4-sZuGWvp4.js.map