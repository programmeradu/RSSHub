{"version":3,"file":"newlist-C7FWxL5Z.js","names":["route: Route","got","cache","response"],"sources":["../../lib/routes/ncpssd/newlist.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { Route } from '@/types';\r\n\r\nexport const route: Route = {\r\n    path: '/newlist',\r\n    categories: ['study'],\r\n    example: '/ncpssd/newlist',\r\n    radar: [\r\n        {\r\n            source: ['ncpssd.cn/', 'ncpssd.cn/newlist'],\r\n        },\r\n    ],\r\n    name: '最新文献',\r\n    maintainers: ['LyleLee'],\r\n    handler,\r\n    url: 'ncpssd.cn/',\r\n};\r\n\r\nasync function handler() {\r\n    const baseUrl = 'https://www.ncpssd.cn';\r\n    const argument = '/newlist?type=0';\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: baseUrl + argument,\r\n    });\r\n\r\n    const data = response.data;\r\n    const $ = load(data);\r\n    const items = $('.news-list > li');\r\n\r\n    const list = items.toArray().map((p) => {\r\n        const title = $(p)\r\n            .find('a')\r\n            .text()\r\n            .replaceAll(/(\\r\\n|\\n|\\r)/gm, '')\r\n            .trim();\r\n        const articleUrl =\r\n            baseUrl +\r\n            $(p)\r\n                .find('a')\r\n                .attr('onclick')\r\n                ?.match(/\\('(.*?)'\\)/)?.[1];\r\n        const parseUrl = new URL(articleUrl);\r\n\r\n        return {\r\n            title,\r\n            link: articleUrl,\r\n            lngid: parseUrl.searchParams.get('id'),\r\n            type: parseUrl.searchParams.get('typename'),\r\n            pageType: parseUrl.searchParams.get('nav'),\r\n        };\r\n    });\r\n\r\n    const paper = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const url = 'https://www.ncpssd.cn/articleinfoHandler/getjournalarticletable'; // Adjust the URL accordingly\r\n                const headers = {\r\n                    Accept: 'application/json, text/javascript, */*; q=0.01',\r\n                    'Content-Type': 'application/json; charset=UTF-8',\r\n                };\r\n\r\n                const requestBody = {\r\n                    lngid: item.lngid,\r\n                    type: item.type,\r\n                    pageType: item.pageType,\r\n                };\r\n\r\n                const response = await got.post(url, {\r\n                    headers,\r\n                    json: requestBody,\r\n                    responseType: 'json', // Set the expected response type\r\n                });\r\n\r\n                return {\r\n                    title: item.title,\r\n                    link: item.link,\r\n                    author: response.data.data.showwriter,\r\n                    description: response.data.data.remarkc,\r\n                    pubDate: parseDate(response.data.data.publishDateTime),\r\n                };\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        // 源标题\r\n        title: '国家哲学社会科学文献中心',\r\n        // 源链接\r\n        link: baseUrl + argument,\r\n        // 源文章\r\n        item: paper,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,WACN,WAAY,CAAC,SACb,QAAS,kBACT,MAAO,CACH,CACI,OAAQ,CAAC,aAAc,uBAG/B,KAAM,OACN,YAAa,CAAC,WACd,UACA,IAAK,cAGT,eAAe,GAAU,CACrB,IAAM,EAAU,wBACV,EAAW,kBAEX,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,EAAU,IAGb,EAAO,EAAS,KAChB,EAAI,EAAK,GACT,EAAQ,EAAE,mBAEV,EAAO,EAAM,UAAU,IAAK,GAAM,CACpC,IAAM,EAAQ,EAAE,GACX,KAAK,KACL,OACA,WAAW,iBAAkB,IAC7B,OACC,EACF,EACA,EAAE,GACG,KAAK,KACL,KAAK,YACJ,MAAM,iBAAiB,GAC3B,EAAW,IAAI,IAAI,GAEzB,MAAO,CACH,QACA,KAAM,EACN,MAAO,EAAS,aAAa,IAAI,MACjC,KAAM,EAAS,aAAa,IAAI,YAChC,SAAU,EAAS,aAAa,IAAI,UAItC,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IACM,EAAU,CACZ,OAAQ,iDACR,eAAgB,mCAGd,EAAc,CAChB,MAAO,EAAK,MACZ,KAAM,EAAK,KACX,SAAU,EAAK,UAGbC,EAAW,MAAMF,EAAI,KAAK,kEAAK,CACjC,UACA,KAAM,EACN,aAAc,SAGlB,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EAAK,KACX,OAAQE,EAAS,KAAK,KAAK,WAC3B,YAAaA,EAAS,KAAK,KAAK,QAChC,QAAS,EAAUA,EAAS,KAAK,KAAK,sBAMtD,MAAO,CAEH,MAAO,eAEP,KAAM,EAAU,EAEhB,KAAM"}