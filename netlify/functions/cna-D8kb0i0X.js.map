{"version":3,"file":"cna-D8kb0i0X.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/cna/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { getFullText } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/:id?',\r\n    categories: ['traditional-media'],\r\n    example: '/cna/aall',\r\n    parameters: { id: '分类 id 或新闻专题 id。分类 id 见下表，新闻专题 id 為 https://www.cna.com.tw/list/newstopic.aspx 中，連結的數字部份。此參數默认为 aall' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '分类',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `| 即時 | 政治 | 國際 | 兩岸 | 產經 | 證券 | 科技 | 生活 | 社會 | 地方 | 文化 | 運動 | 娛樂 |\r\n| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |\r\n| aall | aipl | aopl | acn  | aie  | asc  | ait  | ahel | asoc | aloc | acul | aspt | amov |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id') || 'aall';\r\n    const isTopic = /^\\d+$/.test(id);\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n\r\n    const { data: response } = await got({\r\n        method: 'post',\r\n        url: `https://www.cna.com.tw/cna2018api/api/${isTopic ? 'WTopic' : 'WNewsList'}`,\r\n        json: {\r\n            action: '0',\r\n            category: isTopic ? 'newstopic' : id,\r\n            tno: isTopic ? id : undefined,\r\n            pagesize: limit,\r\n            pageidx: 1,\r\n        },\r\n    });\r\n\r\n    const {\r\n        ResultData: { MetaData: metadata },\r\n        ResultData: resultData,\r\n    } = response;\r\n    const list = (isTopic ? resultData.Topic.NewsItems : resultData.Items).slice(0, limit).map((item) => ({\r\n        title: item.HeadLine,\r\n        link: item.PageUrl,\r\n        pubDate: timezone(parseDate(item.CreateTime), +8),\r\n    }));\r\n\r\n    const items = await Promise.all(list.map((item) => cache.tryGet(item.link, async () => await getFullText(item))));\r\n\r\n    return {\r\n        title: metadata.Title,\r\n        description: metadata.Description,\r\n        link: metadata.CanonicalUrl,\r\n        image: metadata.Image,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"6aAOA,MAAaA,EAAe,CACxB,KAAM,QACN,WAAY,CAAC,qBACb,QAAS,YACT,WAAY,CAAE,GAAI,uGAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa;;+FAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,OAAS,OAC5B,EAAU,QAAQ,KAAK,GACvB,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,CAAE,KAAM,GAAa,MAAMC,EAAI,CACjC,OAAQ,OACR,IAAK,yCAAyC,EAAU,SAAW,cACnE,KAAM,CACF,OAAQ,IACR,SAAU,EAAU,YAAc,EAClC,IAAK,EAAU,EAAK,IAAA,GACpB,SAAU,EACV,QAAS,KAIX,CACF,WAAY,CAAE,SAAU,GACxB,WAAY,GACZ,EACE,GAAQ,EAAU,EAAW,MAAM,UAAY,EAAW,OAAO,MAAM,EAAG,GAAO,IAAK,IAAU,CAClG,MAAO,EAAK,SACZ,KAAM,EAAK,QACX,QAAS,EAAS,EAAU,EAAK,YAAa,MAG5C,EAAQ,MAAM,QAAQ,IAAI,EAAK,IAAK,GAASC,EAAM,OAAO,EAAK,KAAM,SAAY,MAAM,EAAY,MAEzG,MAAO,CACH,MAAO,EAAS,MAChB,YAAa,EAAS,YACtB,KAAM,EAAS,aACf,MAAO,EAAS,MAChB,KAAM"}