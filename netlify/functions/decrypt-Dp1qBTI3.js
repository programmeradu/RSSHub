import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import{logger_default as e}from"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import{ofetch_default as r}from"./ofetch-Bzt0BXUH.js";import{rss_parser_default as i}from"./rss-parser-1vyhErsD.js";import{load as a}from"cheerio";const o={path:`/`,categories:[`finance`],example:`/decrypt`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`News`,maintainers:[`pseudoyu`],handler:s,radar:[{source:[`decrypt.co/`],target:`/`}],description:`Get latest news from Decrypt.`};async function s(r){let a=r.req.query(`limit`)?Number.parseInt(r.req.query(`limit`)):20,o=await i.parseURL(`https://decrypt.co/feed`),s=await Promise.all(o.items.filter(e=>e&&e.link&&!e.link.includes(`/videos`)).slice(0,a).map(r=>t.tryGet(`decrypt:article:${r.link}`,async()=>{if(!r.link)return{};try{let e=await c(r.link);return{title:r.title||`Untitled`,link:r.link.split(`?`)[0],pubDate:r.pubDate?n(r.pubDate):void 0,description:e?.fullText??(r.content||``),author:r.creator||`Decrypt`,category:e?.tags?[...new Set([...r.categories??[],...e.tags])]:r.categories||[],guid:r.guid||r.link,image:e?.featuredImage??r.enclosure?.url}}catch(t){return e.warn(`Couldn't fetch full content for ${r.link}: ${t.message}`),{title:r.title||`Untitled`,link:r.link.split(`?`)[0],pubDate:r.pubDate?n(r.pubDate):void 0,description:r.content||``,author:r.creator||`Decrypt`,category:r.categories||[],guid:r.guid||r.link,image:r.enclosure?.url}}})));return{title:o.title||`Decrypt`,link:o.link||`https://decrypt.co`,description:o.description||`Latest news from Decrypt`,item:s,language:o.language||`en`,image:o.image?.url}}async function c(t){try{let e=await r(t),n=a(e),i=JSON.parse(n(`script#__NEXT_DATA__`).text()),o=i.props.pageProps.post;if(o.content.length){let e=`<img src="${o.featuredImage.src}" alt="${o.featuredImage.alt}">`+o.content;return{fullText:e,featuredImage:o.featuredImage.src,tags:o.tags.data.map(e=>e.name)}}return null}catch(n){return e.error(`Error extracting full text from ${t}: ${n}`),null}}export{o as route};
//# sourceMappingURL=decrypt-Dp1qBTI3.js.map