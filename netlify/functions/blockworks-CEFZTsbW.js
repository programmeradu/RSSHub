import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import{logger_default as t}from"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{parseDate as r}from"./parse-date-Bgabdhlb.js";import{ofetch_default as i}from"./ofetch-Bzt0BXUH.js";import{rss_parser_default as a}from"./rss-parser-1vyhErsD.js";import{load as o}from"cheerio";const s={path:`/`,categories:[`finance`],example:`/blockworks`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`blockworks.co/`],target:`/`}],name:`News`,maintainers:[`pseudoyu`],handler:c,description:`Blockworks news with full text support.`};async function c(e){let t=await a.parseURL(`https://blockworks.co/feed`),i=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):20,o=t.items.slice(0,i),s=await u(),c=await Promise.all(o.map(e=>({...e,link:e.link?.split(`?`)[0]})).map(e=>n.tryGet(e.link,async()=>{let t=await l(e.link.split(`/`).pop(),s);return{title:e.title||`Untitled`,pubDate:e.isoDate?r(e.isoDate):void 0,link:e.link,description:t.description||e.content||e.contentSnippet||e.summary||``,author:e.author,category:t.category,media:t.imageUrl?{content:{url:t.imageUrl}}:void 0}})));return{title:t.title||`Blockworks News`,link:t.link||`https://blockworks.co`,description:t.description||`Latest news from Blockworks`,item:c,language:t.language||`en`}}async function l(e,n){try{let t=await i(`https://blockworks.co/_next/data/${n}/news/${e}.json?slug=${e}`),r=t.pageProps.article,a=o(r.content,null,!1);return a(`hr`).remove(),a(`p > em, p > strong`).each((e,t)=>{let n=a(t);(n.text().includes(`To read full editions`)||n.text().includes(`Get the news in your inbox`))&&n.parent().remove()}),a(`ul.wp-block-list > li > a`).each((e,t)=>{let n=a(t);n.attr(`href`)===`https://blockworks.co/newsletter/daily`&&n.parent().parent().remove()}),{description:a.html(),imageUrl:r.imageUrl,category:[...new Set([...r.categories,...r.tags])]}}catch(e){return t.error(`Error extracting full text from Blockworks:`,e),{description:``,imageUrl:``,category:[]}}}const u=()=>n.tryGet(`blockworks:buildId`,async()=>{let e=await i(`https://blockworks.co`),t=o(e);return t(`script#__NEXT_DATA__`).text()?.match(/"buildId":"(.*?)",/)?.[1]||``},e.cache.routeExpire,!1);export{s as route};
//# sourceMappingURL=blockworks-CEFZTsbW.js.map