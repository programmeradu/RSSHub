{"version":3,"file":"lianxh-DkPfpIUp.js","names":["route: Route","ofetch","cache","response"],"sources":["../../lib/routes/lianxh/index.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport * as cheerio from 'cheerio';\r\nimport type { Context } from 'hono';\r\nimport markdownit from 'markdown-it';\r\n\r\nconst md = markdownit({\r\n    html: true,\r\n    breaks: true,\r\n});\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    example: '/lianxh',\r\n    parameters: { category: '分类 id，可在对应分类页 URL 中找到，默认为 `all`，即全部' },\r\n    radar: [\r\n        {\r\n            source: ['www.lianxh.cn/blogs/all.html', 'www.lianxh.cn/'],\r\n        },\r\n    ],\r\n    name: '精彩资讯',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    url: 'www.lianxh.cn/',\r\n    description: `| 分类                 | id  |\r\n -------------------- | --- |\r\n 全部                 | all |\r\n Stata 入门           | 16  |\r\n Stata 教程           | 17  |\r\n 计量专题             | 18  |\r\n 内生性 - 因果推断    | 19  |\r\n 面板数据             | 20  |\r\n 交乘项 - 调节 - 中介 | 21  |\r\n 结果输出             | 22  |\r\n 工具软件             | 23  |\r\n Stata 绘图           | 24  |\r\n 数据处理             | 25  |\r\n Stata 程序           | 26  |\r\n Probit-Logit         | 27  |\r\n 时间序列             | 28  |\r\n 空间计量 - 网络分析  | 29  |\r\n Markdown-LaTeX       | 30  |\r\n 论文写作             | 31  |\r\n 回归分析             | 32  |\r\n 其它                 | 33  |\r\n 数据分享             | 34  |\r\n Stata 资源           | 35  |\r\n 文本分析 - 爬虫      | 36  |\r\n Python-R-Matlab      | 37  |\r\n IV-GMM               | 38  |\r\n 倍分法 DID           | 39  |\r\n 断点回归 RDD         | 40  |\r\n PSM-Matching         | 41  |\r\n 合成控制法           | 42  |\r\n Stata 命令           | 43  |\r\n 专题课程             | 44  |\r\n 风险管理             | 45  |\r\n 生存分析             | 46  |\r\n 机器学习             | 47  |\r\n 分位数回归           | 48  |\r\n SFA-DEA - 效率分析   | 49  |\r\n 答疑 - 板书          | 50  |\r\n 论文重现             | 51  |\r\n 最新课程             | 52  |\r\n 公开课               | 53  |`,\r\n};\r\n\r\nasync function handler(ctx: Context) {\r\n    const { category = 'all' } = ctx.req.param();\r\n\r\n    const rootUrl = 'https://www.lianxh.cn';\r\n    const currentUrl = `${rootUrl}/blogs/${category}.html`;\r\n\r\n    const response = await ofetch(currentUrl);\r\n\r\n    const $ = cheerio.load(response);\r\n\r\n    const list = $('.card-body > a')\r\n        .slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')!, 10) : 30)\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            const href = $item.attr('href');\r\n            return {\r\n                title: $item.find('h5').text().trim(),\r\n                link: rootUrl + href,\r\n                id: href?.split('/').pop()?.split('.')[0],\r\n            };\r\n        }) as DataItem[];\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link!, async () => {\r\n                const { data: response } = await ofetch(`${rootUrl}/web-api/article`, {\r\n                    query: {\r\n                        id: item.id,\r\n                    },\r\n                });\r\n\r\n                item.description = md.render(response.details);\r\n                item.pubDate = parseDate(response.release_time, 'YYYY-MM-DD');\r\n                item.author = response.author;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `连享会 - ${$('.card-title').text()}`,\r\n        link: currentUrl,\r\n        item: items as DataItem[],\r\n    };\r\n}\r\n"],"mappings":"yUAQA,MAAM,EAAK,EAAW,CAClB,KAAM,GACN,OAAQ,KAGCA,EAAe,CACxB,KAAM,cACN,QAAS,UACT,WAAY,CAAE,SAAU,uCACxB,MAAO,CACH,CACI,OAAQ,CAAC,+BAAgC,oBAGjD,KAAM,OACN,YAAa,CAAC,WACd,UACA,IAAK,iBACL,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;6BA2CjB,eAAe,EAAQ,EAAc,CACjC,GAAM,CAAE,WAAW,OAAU,EAAI,IAAI,QAE/B,EAAU,wBACV,EAAa,GAAG,EAAQ,SAAS,EAAS,OAE1C,EAAW,MAAMC,EAAO,GAExB,EAAI,EAAQ,KAAK,GAEjB,EAAO,EAAE,kBACV,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAW,IAAM,IACjF,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GACV,EAAO,EAAM,KAAK,QACxB,MAAO,CACH,MAAO,EAAM,KAAK,MAAM,OAAO,OAC/B,KAAM,EAAU,EAChB,GAAI,GAAM,MAAM,KAAK,OAAO,MAAM,KAAK,MAI7C,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAO,SAAY,CACjC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAO,GAAG,EAAQ,kBAAmB,CAClE,MAAO,CACH,GAAI,EAAK,MAQjB,MAJA,GAAK,YAAc,EAAG,OAAOE,EAAS,SACtC,EAAK,QAAU,EAAUA,EAAS,aAAc,cAChD,EAAK,OAASA,EAAS,OAEhB,MAKnB,MAAO,CACH,MAAO,SAAS,EAAE,eAAe,SACjC,KAAM,EACN,KAAM"}