import{config as e}from"./config-Dl8a1sIg.js";import{logger_default as t}from"./logger-CWOoofbD.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{parseDate as r}from"./parse-date-Bgabdhlb.js";import{ofetch_default as i}from"./ofetch-Bzt0BXUH.js";import{timezone as a}from"./timezone-BrNu6iXe.js";import*as o from"cheerio";import s from"crypto-js";const c=[`globalThis`,`headless`,`languages`,`permHook`,`vendor`,`webDriverValue`,`webdriver`],l=`https://www.myzaker.com`,u=(e,t=20)=>{for(let n=0;n<1e8;n++){let r=s.SHA256(e+n).toString(),i=0;for(let e of r){if(e!==`0`){i+=4-Number.parseInt(e,16).toString(2).length;break}i+=4}if(i>=t)return n}return 0},d=e=>{let t=`0`.repeat(16);return s.enc.Utf8.parse((e+t).slice(0,16))},f=(e,t)=>{let n=s.enc.Utf8.parse(`1234567890123456`);return s.AES.encrypt(JSON.stringify(e),d(t),{iv:n,padding:s.pad.Pkcs7})},p=(e,t)=>f(e,t).ciphertext.toString(),m=async r=>{let a=`zaker:cookie`,o=await n.get(a,!1);if(o)return JSON.parse(o);let s=`https://challenge.rivers.chaitin.cn/captcha/api`,d=await i.raw(r),f=d.headers.getSetCookie().find(e=>e.startsWith(`sl-session`))?.split(`;`)[0].split(`sl-session=`)[1],m=d._data.match(/once_id:\s*"(.*?)",/)?.[1];if(t.debug(`getSafeLineCookie: sl-session=${f}, onceId=${m}`),!/window\.captcha/.test(d._data))return t.debug(`getSafeLineCookie: Failed to get once_id`),{cookie:d.headers.getSetCookie().map(e=>e.split(`;`)[0]).join(`; `),data:d._data};let h=await i(`${s}/seed`,{headers:{Referer:`${l}/`},query:{once_id:m,v:`1.0.0`,hints:c.sort(()=>Math.random()-.5).join(`,`)}}),g=e.ua,_=h.seed,v=Math.trunc(Math.random()*2e3+1e3);t.debug(`getSafeLineCookie: ua=${g}, seed=${_}, takeTime=${v}`);let y=p({resolution:`1920x1080`,languages:[`en-US`],useragents:[g,g,g],hint:0,salt:String(u(_,16)),taketime:v},_),b=await i(`${s}/inspect`,{method:`POST`,headers:{Referer:`${l}/`,"Content-Type":`text/plain`},query:{seed:_},body:y});if(t.debug(`getSafeLineCookie: inspectResponse=${JSON.stringify(b)}`),b.reason)return t.error(`getSafeLineCookie: reason=${b.reason}`),{cookie:d.headers.getSetCookie().map(e=>e.split(`;`)[0]).join(`; `),data:d._data};let x=await i.raw(r,{headers:{Cookie:`sl-session=${f}; sl_waf_recap=${b.jwt}`}}),S=x.headers.getSetCookie().map(e=>e.split(`;`)[0]).join(`; `);return t.debug(`getSafeLineCookie: ${S}`),n.set(a,JSON.stringify(S),3600),{cookie:S,data:x._data}},h=e=>{let t=JSON.parse(e(`script:contains("window.WinPageData")`).text().match(/window\.WinPageData\s*=\s*({.*})/)?.[1]??`{}`);return t.data.article.map(e=>({title:e.title,description:e.desc,link:`https:`+e.url,author:e.author_name,pubDate:a(r(e.date,`MM月DD日`),8),category:e.tag.map(e=>e.tag),image:e.thumbnail_mpic}))},g=async(e,t)=>{let n=await i(e.link,{headers:{Cookie:t}}),r=o.load(n),a=r(`div.article_content div`);return a.find(`img`).each((e,t)=>{let n=r(t);n.attr(`src`,n.attr(`data-original`)),n.removeAttr(`data-original`)}),e.description=a.html(),e};export{l as baseUrl,g as fetchItem,m as getSafeLineCookieWithData,h as parseList};
//# sourceMappingURL=utils-BOPzJq98.js.map