{"version":3,"file":"recent-show-C7wAoROh.js","names":[],"sources":["../../lib/routes/shoac/recent-show.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/recent-show',\r\n    categories: ['shopping'],\r\n    example: '/shoac/recent-show',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['shoac.com.cn/'],\r\n        },\r\n    ],\r\n    name: '演出月历',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'shoac.com.cn/',\r\n};\r\n\r\nasync function handler() {\r\n    const baseUrl = 'https://www.shoac.com.cn';\r\n\r\n    const headers = {\r\n        Channel: 'theatre_pc',\r\n        Location: '121.458563,31.250315',\r\n        Theater: 1323,\r\n        'Flagship-Store': true,\r\n    };\r\n\r\n    const { data: products } = await got.post(`${baseUrl}/platform-backend/good/theater/dongyi-products`, {\r\n        headers,\r\n        json: {\r\n            page: 1,\r\n            size: 12,\r\n            calendar: false,\r\n            timeSort: true,\r\n            venueId: '',\r\n        },\r\n    });\r\n\r\n    const list = products.data.records.map((item) => ({\r\n        title: item.productNameShort,\r\n        category: [item.categoryName, item.subCategoryName],\r\n        link: `${baseUrl}/#/detail?projectId=${item.projectId}`,\r\n        projectId: item.projectId,\r\n        minPrice: item.minPrice,\r\n        maxPrice: item.maxPrice,\r\n        placeCname: item.placeCname,\r\n    }));\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detail } = await got(`${baseUrl}/platform-backend/good/project/detail/old/${item.projectId}`, {\r\n                    headers,\r\n                    searchParams: {\r\n                        distributionSeriesId: '',\r\n                        distributionChannelId: '',\r\n                    },\r\n                });\r\n                const { data: show } = await got(`${baseUrl}/platform-backend/good/shows/old/${item.projectId}`, {\r\n                    headers,\r\n                    searchParams: {\r\n                        distributionSeriesId: '',\r\n                        distributionChannelId: '',\r\n                    },\r\n                });\r\n\r\n                item.description = art(path.join(__dirname, 'templates/detail.art'), {\r\n                    item,\r\n                    detail: detail.data,\r\n                    show: show.data,\r\n                });\r\n                item.pubDate = show.data.showInfoDetailList ? parseDate(show.data.showInfoDetailList[0].saleBeginTime, 'x') : null;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '演出月历 - 上海东方艺术中心管理有限公司',\r\n        link: baseUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"ybAQA,MAAa,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,YACb,QAAS,qBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,mBAGjB,KAAM,OACN,YAAa,CAAC,UACd,UACA,IAAK,iBAGT,eAAe,GAAU,CACrB,IAAM,EAAU,2BAEV,EAAU,CACZ,QAAS,aACT,SAAU,uBACV,QAAS,KACT,iBAAkB,IAGhB,CAAE,KAAM,GAAa,MAAM,EAAI,KAAK,GAAG,EAAQ,gDAAiD,CAClG,UACA,KAAM,CACF,KAAM,EACN,KAAM,GACN,SAAU,GACV,SAAU,GACV,QAAS,MAIX,EAAO,EAAS,KAAK,QAAQ,IAAK,IAAU,CAC9C,MAAO,EAAK,iBACZ,SAAU,CAAC,EAAK,aAAc,EAAK,iBACnC,KAAM,GAAG,EAAQ,sBAAsB,EAAK,YAC5C,UAAW,EAAK,UAChB,SAAU,EAAK,SACf,SAAU,EAAK,SACf,WAAY,EAAK,cAGf,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACN,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAW,MAAM,EAAI,GAAG,EAAQ,4CAA4C,EAAK,YAAa,CACxG,UACA,aAAc,CACV,qBAAsB,GACtB,sBAAuB,MAGzB,CAAE,KAAM,GAAS,MAAM,EAAI,GAAG,EAAQ,mCAAmC,EAAK,YAAa,CAC7F,UACA,aAAc,CACV,qBAAsB,GACtB,sBAAuB,MAW/B,MAPA,GAAK,YAAc,EAAI,EAAA,KAAA,EAAA,iCAA8C,CACjE,OACA,OAAQ,EAAO,KACf,KAAM,EAAK,OAEf,EAAK,QAAU,EAAK,KAAK,mBAAqB,EAAU,EAAK,KAAK,mBAAmB,GAAG,cAAe,KAAO,KAEvG,MAKnB,MAAO,CACH,MAAO,wBACP,KAAM,EACN,KAAM"}