{"version":3,"file":"digest-DZSABNok.js","names":["limit: number","baseUrl: string","apiBaseUrl: string","targetUrl: string","apiUrl: string","ofetch","$: CheerioAPI","language: string","items: DataItem[]","title: string","description: string","pubDate: number | string","linkUrl: string","guid: string","updated: number | string","processedItem: DataItem","route: Route"],"sources":["../../lib/routes/ifanr/digest.ts"],"sourcesContent":["import { type CheerioAPI, load } from 'cheerio';\r\nimport { type Context } from 'hono';\r\n\r\nimport { type DataItem, type Route, type Data, ViewType } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const limit: number = Number.parseInt(ctx.req.query('limit') ?? '20', 10);\r\n\r\n    const baseUrl: string = 'https://www.ifanr.com';\r\n    const apiBaseUrl: string = 'https://sso.ifanr.com';\r\n    const targetUrl: string = new URL('digest', baseUrl).href;\r\n    const apiUrl: string = new URL('api/v5/wp/buzz', apiBaseUrl).href;\r\n\r\n    const response = await ofetch(apiUrl, {\r\n        query: {\r\n            limit,\r\n            offset: 0,\r\n        },\r\n    });\r\n\r\n    const targetResponse = await ofetch(targetUrl);\r\n    const $: CheerioAPI = load(targetResponse);\r\n    const language: string = $('html').attr('lang') ?? 'zh-CN';\r\n\r\n    const items: DataItem[] = response.objects.slice(0, limit).map((item): DataItem => {\r\n        const title: string = item.post_title;\r\n        const description: string = item.post_content;\r\n        const pubDate: number | string = item.created_at;\r\n        const linkUrl: string = `digest/${item.post_id}`;\r\n        const guid: string = `ifanr-digest-${item.post_id}`;\r\n        const updated: number | string = item.updated_at ?? pubDate;\r\n\r\n        const processedItem: DataItem = {\r\n            title,\r\n            description,\r\n            pubDate: pubDate ? parseDate(pubDate, 'X') : undefined,\r\n            link: new URL(linkUrl, baseUrl).href,\r\n            guid,\r\n            id: guid,\r\n            content: {\r\n                html: description,\r\n                text: item.post_content ?? description,\r\n            },\r\n            updated: updated ? parseDate(updated) : undefined,\r\n            language,\r\n            _extra: {\r\n                links: [\r\n                    {\r\n                        url: item.buzz_original_url,\r\n                        type: 'via',\r\n                        content_html: item.post_content,\r\n                    },\r\n                ],\r\n            },\r\n        };\r\n\r\n        return processedItem;\r\n    });\r\n\r\n    const title: string = $('title').text();\r\n\r\n    return {\r\n        title,\r\n        description: title,\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: $('img.c-header-navbar__logo').attr('src'),\r\n        author: $('meta[property=\"og:site_name\"]').attr('content'),\r\n        language,\r\n        id: $('meta[property=\"og:url\"]').attr('content'),\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/digest',\r\n    name: '快讯',\r\n    url: 'www.ifanr.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/ifanr/digest',\r\n    parameters: undefined,\r\n    description: undefined,\r\n    categories: ['new-media'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.ifanr.comdigest'],\r\n            target: '/digest',\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n};\r\n"],"mappings":"8SAQA,MAAa,EAAU,KAAO,IAAgC,CAC1D,IAAMA,EAAgB,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IAEhEC,EAAkB,wBAElBE,EAAoB,IAAI,IAAI,SAAU,GAAS,KAC/CC,EAAiB,IAAI,IAAI,iBAAkB,yBAAY,KAEvD,EAAW,MAAMC,EAAO,EAAQ,CAClC,MAAO,CACH,QACA,OAAQ,KAIV,EAAiB,MAAMA,EAAO,GAC9BC,EAAgB,EAAK,GACrBC,EAAmB,EAAE,QAAQ,KAAK,SAAW,QAE7CC,EAAoB,EAAS,QAAQ,MAAM,EAAG,GAAO,IAAK,GAAmB,CAC/E,IAAMC,EAAgB,EAAK,WACrBC,EAAsB,EAAK,aAC3BC,EAA2B,EAAK,WAChCC,EAAkB,UAAU,EAAK,UACjCC,EAAe,gBAAgB,EAAK,UACpCC,EAA2B,EAAK,YAAc,EAE9CC,EAA0B,CAC5B,MAAA,EACA,cACA,QAAS,EAAU,EAAU,EAAS,KAAO,IAAA,GAC7C,KAAM,IAAI,IAAI,EAAS,GAAS,KAChC,OACA,GAAI,EACJ,QAAS,CACL,KAAM,EACN,KAAM,EAAK,cAAgB,GAE/B,QAAS,EAAU,EAAU,GAAW,IAAA,GACxC,WACA,OAAQ,CACJ,MAAO,CACH,CACI,IAAK,EAAK,kBACV,KAAM,MACN,aAAc,EAAK,iBAMnC,OAAO,IAGLN,EAAgB,EAAE,SAAS,OAEjC,MAAO,CACH,QACA,YAAa,EACb,KAAM,EACN,KAAM,EACN,WAAY,GACZ,MAAO,EAAE,6BAA6B,KAAK,OAC3C,OAAQ,EAAE,iCAAiC,KAAK,WAChD,WACA,GAAI,EAAE,2BAA2B,KAAK,aAIjCO,EAAe,CACxB,KAAM,UACN,KAAM,KACN,IAAK,gBACL,YAAa,CAAC,WACd,UACA,QAAS,gBACT,WAAY,IAAA,GACZ,YAAa,IAAA,GACb,WAAY,CAAC,aACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,uBACT,OAAQ,YAGhB,KAAM,EAAS"}