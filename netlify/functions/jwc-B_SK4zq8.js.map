{"version":3,"file":"jwc-B_SK4zq8.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/ustc/jwc.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nconst noticeUrl = 'https://www.teach.ustc.edu.cn/category/notice';\r\nconst noticeType = { teaching: '教学', info: '信息', exam: '考试', exchange: '交流' };\r\n\r\nexport const route: Route = {\r\n    path: '/jwc/:type?',\r\n    categories: ['university'],\r\n    example: '/ustc/jwc/info',\r\n    parameters: { type: '分类，默认显示所有种类' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.teach.ustc.edu.cn/'],\r\n            target: '/jwc',\r\n        },\r\n    ],\r\n    name: '教务处通知新闻',\r\n    maintainers: ['hang333'],\r\n    handler,\r\n    url: 'www.teach.ustc.edu.cn/',\r\n    description: `| 信息 | 教学     | 考试 | 交流     |\r\n| ---- | -------- | ---- | -------- |\r\n| info | teaching | exam | exchange |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type') ?? '';\r\n    // 发起 HTTP GET 请求\r\n    const response = await got({\r\n        method: 'get',\r\n\r\n        /* headers: {\r\n            'user-agent': UA,\r\n        }, */\r\n        url: `${noticeUrl}${type === '' ? '' : '-' + type}`,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n    let items = $(type === '' ? 'ul[class=\"article-list with-tag\"] > li' : 'ul[class=article-list] > li')\r\n        .toArray()\r\n        .map((element) => {\r\n            const child = $(element).children();\r\n            const info = {\r\n                title: type === '' ? $(child[0]).find('a').text() + ' - ' + $(child[1]).find('a').text() : $(child[0]).find('a').text(),\r\n                link: type === '' ? $(child[1]).find('a').attr('href') : $(child[0]).find('a').attr('href'),\r\n                pubDate: timezone(parseDate($(element).find('.date').text().trim(), 'YYYY-MM-DD'), +8),\r\n            };\r\n            return info;\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items\r\n            .filter((item) => item.link)\r\n            .map((item) =>\r\n                cache.tryGet(item.link, async () => {\r\n                    const response = await got(item.link);\r\n                    const $ = load(response.data);\r\n                    // www.teach ?? pms.cmet ?? news\r\n                    item.description = $('main[class=single]').html() ?? $('.card-footer').html() ?? $('.v_news_content').html();\r\n                    item.pubDate = $('li[class=meta-date]').text() ? timezone(parseDate($('li[class=meta-date]').text(), 'YYYY-MM-DD HH:mm'), +8) : item.pubDate;\r\n                    return item;\r\n                })\r\n            )\r\n    );\r\n\r\n    const desc = type === '' ? '中国科学技术大学教务处 - 通知新闻' : `中国科学技术大学教务处 - ${noticeType[type]}类通知`;\r\n\r\n    return {\r\n        title: desc,\r\n        description: desc,\r\n        link: `${noticeUrl}${type === '' ? '' : '-' + type}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAMA,MAAM,EAAY,gDACZ,EAAa,CAAE,SAAU,KAAM,KAAM,KAAM,KAAM,KAAM,SAAU,MAE1DA,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,cACb,QAAS,iBACT,WAAY,CAAE,KAAM,eACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,0BACT,OAAQ,SAGhB,KAAM,UACN,YAAa,CAAC,WACd,UACA,IAAK,yBACL,YAAa;;wCAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,GAEhC,EAAW,MAAMC,EAAI,CACvB,OAAQ,MAKR,IAAK,GAAG,IAAY,IAAS,GAAK,GAAK,IAAM,MAG3C,EAAI,EAAK,EAAS,MACpB,EAAQ,EAAE,IAAS,GAAK,yCAA2C,+BAClE,UACA,IAAK,GAAY,CACd,IAAM,EAAQ,EAAE,GAAS,WACnB,EAAO,CACT,MAAO,IAAS,GAAK,EAAE,EAAM,IAAI,KAAK,KAAK,OAAS,MAAQ,EAAE,EAAM,IAAI,KAAK,KAAK,OAAS,EAAE,EAAM,IAAI,KAAK,KAAK,OACjH,KAAM,IAAS,GAAK,EAAE,EAAM,IAAI,KAAK,KAAK,KAAK,QAAU,EAAE,EAAM,IAAI,KAAK,KAAK,KAAK,QACpF,QAAS,EAAS,EAAU,EAAE,GAAS,KAAK,SAAS,OAAO,OAAQ,cAAe,IAEvF,OAAO,IAGf,EAAQ,MAAM,QAAQ,IAClB,EACK,OAAQ,GAAS,EAAK,MACtB,IAAK,GACFC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAW,MAAMF,EAAI,EAAK,MAC1BG,EAAI,EAAKD,EAAS,MAIxB,MAFA,GAAK,YAAcC,EAAE,sBAAsB,QAAUA,EAAE,gBAAgB,QAAUA,EAAE,mBAAmB,OACtG,EAAK,QAAUA,EAAE,uBAAuB,OAAS,EAAS,EAAUA,EAAE,uBAAuB,OAAQ,oBAAqB,GAAM,EAAK,QAC9H,MAKvB,IAAM,EAAO,IAAS,GAAK,qBAAuB,iBAAiB,EAAW,GAAM,KAEpF,MAAO,CACH,MAAO,EACP,YAAa,EACb,KAAM,GAAG,IAAY,IAAS,GAAK,GAAK,IAAM,IAC9C,KAAM"}