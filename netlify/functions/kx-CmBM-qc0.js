import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{ofetch_default as n}from"./ofetch-Bzt0BXUH.js";import{timezone as r}from"./timezone-BrNu6iXe.js";import{ViewType as i}from"./types-A5bA50Mg.js";import{load as a}from"cheerio";const o=async i=>{let o=Number.parseInt(i.req.query(`limit`)??`30`,10),s=`https://www.stcn.com`,c=new URL(`article/list/kx.html`,s).href,l=new URL(`article/list.html`,s).href,u=await n(c),d=await n(l,{headers:{"x-requested-with":`XMLHttpRequest`},query:{type:`kx`}}),f=a(u),p=f(`html`).attr(`lang`)??`zh-CN`,m=[];return m=d.data.slice(0,o).map(e=>{let n=e.title,r=e.content,i=e.time,a=e.url,o=e.tags?e.tags.map(e=>e.name):[],c=e.source,l=e.share?.image,u=i,d={title:n,description:r,pubDate:i?t(i,`X`):void 0,link:a?new URL(a,s).href:void 0,category:o,author:c,content:{html:r,text:e.content??r},image:l,banner:l,updated:u?t(u,`X`):void 0,language:p};return d}),m=(await Promise.all(m.map(i=>i.link?e.tryGet(i.link,async()=>{let e=await n(i.link),o=a(e),s=o(`div.detail-title`).text(),c=o(`div.detail-content`).html()??``,l=o(`div.detail-info span`).last().text().trim(),u=[...new Set([...i.category,...o(`meta[name="keywords"]`).attr(`content`)?.split(/,/)??[]])],d=o(`div.detail-info span`).first().text().split(/：/).pop(),f=l,m={title:s,description:c,pubDate:l?r(t(l),8):i.pubDate,category:u,author:d,content:{html:c,text:c},updated:f?r(t(f),8):i.updated,language:p};return{...i,...m}}):i))).filter(e=>!0),{title:f(`title`).text(),description:f(`meta[name="description"]`).attr(`content`),link:c,item:m,allowEmpty:!0,image:f(`img.stcn-logo`).attr(`src`),author:f(`meta[name="keywords"]`).attr(`content`)?.split(/,/)[0],language:p,id:c}},s={path:`/article/list/kx`,name:`快讯`,url:`www.stcn.com`,maintainers:[`nczitzk`],handler:o,example:`/stcn/article/list/kx`,parameters:void 0,description:void 0,categories:[`finance`],features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.stcn.com/article/list/kx.html`],target:`/article/list/kx`}],view:i.Articles};export{o as handler,s as route};
//# sourceMappingURL=kx-CmBM-qc0.js.map