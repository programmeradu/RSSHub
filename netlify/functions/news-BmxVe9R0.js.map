{"version":3,"file":"news-BmxVe9R0.js","names":["got","route: Route","cache","got","response","$"],"sources":["../../lib/routes/qianp/utils.ts","../../lib/routes/qianp/news.ts"],"sourcesContent":["import got from '@/utils/got';\r\n\r\nconst getTokenAndSecret = (tryGet) =>\r\n    tryGet('qianp:token', async () => {\r\n        const response = await got('https://qianp.com/news/recommend/');\r\n        const token = response.headers['set-cookie']\r\n            .find((cookie) => cookie.startsWith('token='))\r\n            ?.split(';')[0]\r\n            ?.split('=')[1];\r\n        const secret = response.headers['set-cookie']\r\n            .find((cookie) => cookie.startsWith('secret='))\r\n            ?.split(';')[0]\r\n            ?.split('=')[1];\r\n        return { token, secret };\r\n    });\r\n\r\nexport { getTokenAndSecret };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { getTokenAndSecret } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:path{.+}?',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://qianp.com';\r\n    const { path = 'news/recommend' } = ctx.req.param();\r\n    const url = `${baseUrl}/${path}/`;\r\n\r\n    const { token, secret } = await getTokenAndSecret(cache.tryGet);\r\n    const headers = {\r\n        cookie: token ? `t=${token}; r=${secret - 100}` : undefined,\r\n    };\r\n    const { data: response } = await got(url, {\r\n        headers,\r\n    });\r\n    const $ = load(response);\r\n\r\n    const list = $('.newslist .infor')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const a = item.find('a').first();\r\n            return {\r\n                title: a.attr('title'),\r\n                link: a.attr('href'),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link, {\r\n                    headers,\r\n                });\r\n                const $ = load(response);\r\n\r\n                item.category = [...new Set($('meta[name=keywords]').attr('content').split('ï¼Œ'))];\r\n                item.author = $('meta[name=author]').attr('content');\r\n                item.pubDate = parseDate($('meta[property=\"bytedance:published_time\"]').attr('content'));\r\n\r\n                item.description = $('.news_center').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        description: $('meta[name=\"description\"]').attr('content'),\r\n        link: url,\r\n        image: `${baseUrl}/favicon.ico`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAEA,MAAM,EAAqB,GACvB,EAAO,cAAe,SAAY,CAC9B,IAAM,EAAW,MAAMG,EAAI,qCACrB,EAAQ,EAAS,QAAQ,cAC1B,KAAM,GAAW,EAAO,WAAW,YAClC,MAAM,KAAK,IACX,MAAM,KAAK,GACX,EAAS,EAAS,QAAQ,cAC3B,KAAM,GAAW,EAAO,WAAW,aAClC,MAAM,KAAK,IACX,MAAM,KAAK,GACjB,MAAO,CAAE,QAAO,YCNXF,EAAe,CACxB,KAAM,mBACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,oBACV,CAAE,OAAO,kBAAqB,EAAI,IAAI,QACtC,EAAM,GAAG,EAAQ,GAAG,EAAK,GAEzB,CAAE,QAAO,UAAW,MAAM,EAAkBC,EAAM,QAClD,EAAU,CACZ,OAAQ,EAAQ,KAAK,EAAM,MAAM,EAAS,MAAQ,IAAA,IAEhD,CAAE,KAAM,GAAa,MAAMC,EAAI,EAAK,CACtC,YAEE,EAAI,EAAK,GAET,EAAO,EAAE,oBACV,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAI,EAAK,KAAK,KAAK,QACzB,MAAO,CACH,MAAO,EAAE,KAAK,SACd,KAAM,EAAE,KAAK,WAInB,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACND,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAME,GAAa,MAAMD,EAAI,EAAK,KAAM,CAC5C,YAEEE,EAAI,EAAKD,GAQf,MANA,GAAK,SAAW,CAAC,GAAG,IAAI,IAAIC,EAAE,uBAAuB,KAAK,WAAW,MAAM,OAC3E,EAAK,OAASA,EAAE,qBAAqB,KAAK,WAC1C,EAAK,QAAU,EAAUA,EAAE,6CAA6C,KAAK,YAE7E,EAAK,YAAcA,EAAE,gBAAgB,OAE9B,MAKnB,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,EACN,MAAO,GAAG,EAAQ,cAClB,KAAM"}