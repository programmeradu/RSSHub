{"version":3,"file":"release-CSqr2Rb-.js","names":["route: Route","puppeteer","cache","page","res","$"],"sources":["../../lib/routes/bluestacks/release.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport * as cheerio from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport puppeteer from '@/utils/puppeteer';\r\n\r\nconst pageUrl = 'https://support.bluestacks.com/hc/en-us/articles/360056960211-Release-Notes-BlueStacks-5';\r\n\r\nexport const route: Route = {\r\n    path: '/release/5',\r\n    categories: ['program-update'],\r\n    example: '/bluestacks/release/5',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: true,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['bluestacks.com/hc/en-us/articles/360056960211-Release-Notes-BlueStacks-5', 'bluestacks.com/'],\r\n        },\r\n    ],\r\n    name: 'BlueStacks 5 Release Notes',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'bluestacks.com/hc/en-us/articles/360056960211-Release-Notes-BlueStacks-5',\r\n};\r\n\r\nasync function handler() {\r\n    const browser = await puppeteer();\r\n    const page = await browser.newPage();\r\n    await page.setRequestInterception(true);\r\n    page.on('request', (request) => {\r\n        request.resourceType() === 'document' || request.resourceType() === 'script' ? request.continue() : request.abort();\r\n    });\r\n    await page.goto(pageUrl, {\r\n        waitUntil: 'domcontentloaded',\r\n    });\r\n    const res = await page.evaluate(() => document.documentElement.innerHTML);\r\n    await page.close();\r\n\r\n    const $ = cheerio.load(res);\r\n\r\n    const items = $('div h3 a')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item.text(),\r\n                link: item.attr('href'),\r\n            };\r\n        });\r\n\r\n    await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const page = await browser.newPage();\r\n                await page.setRequestInterception(true);\r\n                page.on('request', (request) => {\r\n                    request.resourceType() === 'document' || request.resourceType() === 'script' ? request.continue() : request.abort();\r\n                });\r\n                await page.goto(item.link, {\r\n                    waitUntil: 'domcontentloaded',\r\n                });\r\n                const res = await page.evaluate(() => document.documentElement.innerHTML);\r\n                const $ = cheerio.load(res);\r\n                await page.close();\r\n\r\n                item.description = $('div.article__body').html();\r\n                item.pubDate = parseDate($('div.meta time').attr('datetime'));\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    await browser.close();\r\n\r\n    return {\r\n        title: $('.article__title').text().trim(),\r\n        description: $('meta[name=description]').text().trim(),\r\n        link: pageUrl,\r\n        image: $('link[rel=\"shortcut icon\"]').attr('href'),\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"qRAMA,MAAM,EAAU,2FAEHA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,kBACb,QAAS,wBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,2EAA4E,qBAG7F,KAAM,6BACN,YAAa,CAAC,UACd,UACA,IAAK,4EAGT,eAAe,GAAU,CACrB,IAAM,EAAU,MAAMC,IAChB,EAAO,MAAM,EAAQ,UAC3B,MAAM,EAAK,uBAAuB,IAClC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,YAAc,EAAQ,iBAAmB,SAAW,EAAQ,WAAa,EAAQ,UAEhH,MAAM,EAAK,KAAK,EAAS,CACrB,UAAW,qBAEf,IAAM,EAAM,MAAM,EAAK,aAAe,SAAS,gBAAgB,WAC/D,MAAM,EAAK,QAEX,IAAM,EAAI,EAAQ,KAAK,GAEjB,EAAQ,EAAE,YACX,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,OACZ,KAAM,EAAK,KAAK,WA6B5B,OAzBA,MAAM,QAAQ,IACV,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAO,MAAM,EAAQ,UAC3B,MAAMA,EAAK,uBAAuB,IAClC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,YAAc,EAAQ,iBAAmB,SAAW,EAAQ,WAAa,EAAQ,UAEhH,MAAMA,EAAK,KAAK,EAAK,KAAM,CACvB,UAAW,qBAEf,IAAMC,EAAM,MAAMD,EAAK,aAAe,SAAS,gBAAgB,WACzDE,EAAI,EAAQ,KAAKD,GAMvB,OALA,MAAMD,EAAK,QAEX,EAAK,YAAcE,EAAE,qBAAqB,OAC1C,EAAK,QAAU,EAAUA,EAAE,iBAAiB,KAAK,aAE1C,MAKnB,MAAM,EAAQ,QAEP,CACH,MAAO,EAAE,mBAAmB,OAAO,OACnC,YAAa,EAAE,0BAA0B,OAAO,OAChD,KAAM,EACN,MAAO,EAAE,6BAA6B,KAAK,QAC3C,KAAM"}