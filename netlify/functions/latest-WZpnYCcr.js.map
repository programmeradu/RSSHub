{"version":3,"file":"latest-WZpnYCcr.js","names":["ofetch","route: Route"],"sources":["../../lib/routes/matters/latest.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { baseUrl, gqlEndpoint, parseItem } from './utils';\r\n\r\nconst handler = async (ctx) => {\r\n    const { type = 'latest' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n    const options = {\r\n        latest: {\r\n            title: '最新',\r\n            apiType: 'newest',\r\n        },\r\n        heat: {\r\n            title: '熱議',\r\n            apiType: 'hottest',\r\n        },\r\n        essence: {\r\n            title: '精華',\r\n            apiType: 'icymi',\r\n        },\r\n    };\r\n\r\n    const response = await ofetch(gqlEndpoint, {\r\n        method: 'POST',\r\n        body: {\r\n            query: `{\r\n                viewer {\r\n                  recommendation {\r\n                    feed: ${options[type].apiType}(input: {first: ${limit}}) {\r\n                      edges {\r\n                        node {\r\n                          shortHash\r\n                          title\r\n                          content\r\n                          createdAt\r\n                          author {\r\n                            displayName\r\n                          }\r\n                          tags {\r\n                            content\r\n                          }\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              }`,\r\n        },\r\n    });\r\n\r\n    const item = response.data.viewer.recommendation.feed.edges.map(({ node }) => parseItem(node));\r\n\r\n    return {\r\n        title: `Matters | ${options[type].title}`,\r\n        link: baseUrl,\r\n        item,\r\n    };\r\n};\r\nexport const route: Route = {\r\n    path: '/latest/:type?',\r\n    name: 'Latest, heat, essence',\r\n    example: '/matters/latest/heat',\r\n    parameters: { uid: 'Defaults to latest, see table below' },\r\n    maintainers: ['xyqfer', 'Cerebrater', 'xosdy'],\r\n    handler,\r\n    radar: [\r\n        {\r\n            source: ['matters.town'],\r\n        },\r\n    ],\r\n    description: `| 最新   | 热门 | 精华    |\r\n| ------ | ---- | ------- |\r\n| latest | heat | essence |`,\r\n};\r\n"],"mappings":"0RAIA,MAAM,EAAU,KAAO,IAAQ,CAC3B,GAAM,CAAE,OAAO,UAAa,EAAI,IAAI,QAC9B,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAC/E,EAAU,CACZ,OAAQ,CACJ,MAAO,KACP,QAAS,UAEb,KAAM,CACF,MAAO,KACP,QAAS,WAEb,QAAS,CACL,MAAO,KACP,QAAS,UAIX,EAAW,MAAMA,EAAO,EAAa,CACvC,OAAQ,OACR,KAAM,CACF,MAAO;;;4BAGS,EAAQ,GAAM,QAAQ,kBAAkB,EAAM;;;;;;;;;;;;;;;;;;oBAsBhE,EAAO,EAAS,KAAK,OAAO,eAAe,KAAK,MAAM,KAAK,CAAE,UAAW,EAAU,IAExF,MAAO,CACH,MAAO,aAAa,EAAQ,GAAM,QAClC,KAAM,EACN,SAGKC,EAAe,CACxB,KAAM,iBACN,KAAM,wBACN,QAAS,uBACT,WAAY,CAAE,IAAK,uCACnB,YAAa,CAAC,SAAU,aAAc,SACtC,UACA,MAAO,CACH,CACI,OAAQ,CAAC,kBAGjB,YAAa"}