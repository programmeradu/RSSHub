{"version":3,"file":"dut-wdv5KotC.js","names":["route: Route","InvalidParameterError","defaults","shortcuts","got","cache"],"sources":["../../lib/routes/dut/defaults.ts","../../lib/routes/dut/shortcuts.ts","../../lib/routes/dut/index.ts"],"sourcesContent":["export default {\r\n    // 新闻网：https://news.dlut.edu.cn\r\n    // 默认 -> 头条关注 https://news.dlut.edu.cn/ttgz.htm\r\n    news: 'ttgz',\r\n\r\n    // 教务处：http://teach.dlut.edu.cn\r\n    // 默认 -> 新闻快递 http://teach.dlut.edu.cn/xwkd/xwkd.htm\r\n    teach: 'xwkd/xwkd',\r\n\r\n    // 人事处：http://perdep.dlut.edu.cn\r\n    // 默认 -> 通知公告 http://perdep.dlut.edu.cn/tzgg/tzgg.htm\r\n    perdep: 'tzgg/tzgg',\r\n\r\n    // 研究生院：http://gs.dlut.edu.cn\r\n    // 默认 -> 重要通知 http://gs.dlut.edu.cn/zytz.htm\r\n    gs: 'zytz',\r\n\r\n    // 软件学院：http://ssdut.dlut.edu.cn\r\n    // 默认 -> 焦点新闻 http://ssdut.dlut.edu.cn/ywgg/xueyuanxinwen/jdxw.htm\r\n    ssdut: 'ywgg/xueyuanxinwen/jdxw',\r\n\r\n    // 开发区校区：http://eda.dlut.edu.cn\r\n    // 默认 -> 通知公告 http://eda.dlut.edu.cn/tzgg/tzgg.htm\r\n    eda: 'tzgg/tzgg',\r\n\r\n    // 盘锦校区：https://panjin.dlut.edu.cn/index.htm\r\n    // 默认 -> 公告 https://panjin.dlut.edu.cn/index/gg.htm\r\n    panjin: 'index/gg',\r\n\r\n    // 盘锦校区学生事务办公室：http://xsgzb.dlut.edu.cn\r\n    // 默认 -> 通知公告 http://xsgzb.dlut.edu.cn/index/zytz.htm\r\n    xsgzb: 'index/zytz',\r\n\r\n    // 盘锦校区教务教学事务办公室：http://pjteach.dlut.edu.cn\r\n    // 默认 -> 新闻快递 http://pjteach.dlut.edu.cn/index/xwkd.htm\r\n    pjteach: 'index/xwkd',\r\n\r\n    // 盘锦校区总务部：http://pjxqzwb.dlut.edu.cn/index.htm\r\n    // 默认 -> 通知公告 http://pjxqzwb.dlut.edu.cn/index/tzgg.htm\r\n    pjxqzwb: 'index/tzgg',\r\n\r\n    // 体育与健康学院盘锦分院：http://tjpj.dlut.edu.cn/index.htm\r\n    // 默认 -> 通知公告 http://tjpj.dlut.edu.cn/index/zxgg.htm\r\n    tjpj: 'index/zxgg',\r\n\r\n    // 国际合作与交流处（港澳台办）：http://dutdice.dlut.edu.cn\r\n    // 默认 -> 新闻速递 http://dutdice.dlut.edu.cn/xwsd/xxxw.htm\r\n    dutdice: 'xwsd/xxxw',\r\n\r\n    // 体育场馆中心：http://tycgzx.dlut.edu.cn\r\n    // 默认 -> 通知公告 http://tycgzx.dlut.edu.cn/tzgg/tzgg.htm\r\n    tycgzx: 'tzgg/tzgg',\r\n\r\n    // 公共基础学院：http://fldpj.dlut.edu.cn/index.htm\r\n    // 默认 -> 重要通知 http://fldpj.dlut.edu.cn/index/zytz.htm\r\n    fldpj: 'index/zytz',\r\n};\r\n","export default {\r\n    news: {\r\n        xwjj: 'xwjj01',\r\n        rcpy: 'xwjj01/rcpy',\r\n        kxyj: 'xwjj01/kxyj',\r\n        jlhz: 'xwjj01-kxyj',\r\n        yxfc: 'yxfc1',\r\n        dgrw: 'dgrw/dgrw1',\r\n        yxdg: 'yxdg1',\r\n        mtdg: 'mtdg/mtdg',\r\n    },\r\n    teach: {\r\n        xwkd: 'xwkd/xwkd',\r\n        zytg: 'zytg/zytg',\r\n        bhgs: 'zytg/bhgs',\r\n    },\r\n    perdep: {\r\n        tzgg: 'tzgg/tzgg',\r\n        gzdt: 'gzdt/gzdt1',\r\n        zcfg: 'zcfg/zcfg',\r\n    },\r\n    gs: {\r\n        gzdt: 'gzdt1',\r\n        zcfg: 'zcfg/zcfg',\r\n    },\r\n    ssdut: {\r\n        jdxw: 'ywgg/xueyuanxinwen/jdxw',\r\n        zhxw: 'ywgg/xueyuanxinwen',\r\n        xytz: 'index/xytz',\r\n        xsdt: 'index/xsdt',\r\n        bkstz: 'index/bkstz',\r\n        yjstz: 'yjspy/yjspy/yjstz',\r\n    },\r\n    eda: {\r\n        tzgg: 'tzgg/tzgg',\r\n        xqxw: 'xqxw/xqxw',\r\n    },\r\n    panjin: {\r\n        xqxw: 'index/xqxw',\r\n        xywh: 'index/xywh',\r\n        xyfc: 'index/xyfc',\r\n        xsdt: 'index/xsdt',\r\n        mtbd: 'index/mtbd',\r\n        gg: 'index/gg',\r\n    },\r\n    xsgzb: {\r\n        zytz: 'index/zytz',\r\n        xgdt: 'index/xgdt',\r\n        gsgonggao: 'index/gsgonggao',\r\n    },\r\n    pjteach: {\r\n        xwkd: 'index/xwkd',\r\n        zytz: 'index/zytz',\r\n        xkyks: 'index/xkyks',\r\n        jxwj: 'index/jxwj',\r\n        cjwt: 'index/cjwt',\r\n    },\r\n    pjxqzwb: {\r\n        tzgg: 'index/tzgg',\r\n        zwkx: 'index/zwkx',\r\n    },\r\n    tjpj: {\r\n        xyxw: 'index/xyxw',\r\n        zxgg: 'index/zxgg',\r\n    },\r\n    dutdice: {\r\n        jstz: 'tzgg/jstz',\r\n        xstong_zhi: 'tzgg/xstong_zhi',\r\n        xwsd: 'xwsd/xxxw',\r\n    },\r\n    tycgzx: {\r\n        tzgg: 'tzgg/tzgg',\r\n        hdrc: 'hdrc/hdrc',\r\n        xwdt: 'xwdt/xwdt',\r\n        jkzs: 'jkzs/jkzs1',\r\n    },\r\n    fldpj: {\r\n        xsdt: 'kxyj/xsdt',\r\n        zytz: 'index/zytz',\r\n        ywgk: 'index/ywgk',\r\n    },\r\n};\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport defaults from './defaults';\r\nimport shortcuts from './shortcuts';\r\nimport { isValidHost } from '@/utils/valid-host';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: ['/*/*', '/:0?'],\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const site = ctx.params[0] ?? 'news';\r\n    if (!isValidHost(site)) {\r\n        throw new InvalidParameterError('Invalid site');\r\n    }\r\n\r\n    let items;\r\n    let category = ctx.params[1] ?? (Object.hasOwn(defaults, site) ? defaults[site] : '');\r\n    category = Object.hasOwn(shortcuts, site) ? (Object.hasOwn(shortcuts[site], category) ? shortcuts[site][category] : category) : category;\r\n\r\n    const rootUrl = `https://${site}.dlut.edu.cn`;\r\n    const currentUrl = `${rootUrl}/${category}.htm`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    if (site === 'panjin') {\r\n        items = $('a.news').slice(0, -4);\r\n    } else if (site === 'fldpj') {\r\n        items = $('li[id^=\"line_u9\"]').find('a');\r\n    } else {\r\n        $('.Next, .rjxw_left, .pb_sys_common').remove();\r\n        items = $('.txt, .itemlist, .wall, .list, .list01, .ny_list, .rjxw_right, .rj_yjs_con, .c_hzjl_list1, .winstyle67894, .winstyle80936, .winstyle50738, #lili').find('a');\r\n    }\r\n\r\n    items = items\r\n        .slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 50)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const result = {\r\n                link: item.attr('href').startsWith('http') ? item.attr('href') : `${rootUrl}/${item.attr('href').replace(/^[./]+/, '')}`,\r\n            };\r\n\r\n            if (site === 'fldpj') {\r\n                result.title = item.find('em').text();\r\n                result.pubDate = parseDate(item.find('span').text());\r\n            } else {\r\n                const dateRegex = /(\\d{4}[/年-]\\d{2}[/月-]\\d{2})/;\r\n\r\n                let dateMatch = item.parent().text().match(dateRegex);\r\n                if (!dateMatch) {\r\n                    dateMatch = item.parent().parent().text().match(dateRegex);\r\n                }\r\n\r\n                result.title = item.text().trim() === '' ? item.next().text() : item.text();\r\n                if (dateMatch) {\r\n                    result.pubDate = parseDate(dateMatch[1].replaceAll(/年|月/g, '-'));\r\n                }\r\n            }\r\n\r\n            return result;\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                try {\r\n                    const detailResponse = await got({\r\n                        method: 'get',\r\n                        url: item.link,\r\n                    });\r\n\r\n                    const content = load(detailResponse.data);\r\n\r\n                    item.description = content('.v_news_content, .conbox').html();\r\n                } catch {\r\n                    // Fo example: http://dutdice.dlut.edu.cn/nry.jsp?urltype=news.NewsContentUrl&wbtreeid=1006&wbnewsid=9820\r\n                    // do nothing to the cases which require fetching resources from the Intranet :P\r\n                }\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"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"}