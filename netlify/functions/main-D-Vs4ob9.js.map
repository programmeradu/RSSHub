{"version":3,"file":"main-D-Vs4ob9.js","names":["got","route: Route","InvalidParameterError","got","cache"],"sources":["../../lib/routes/solidot/_article.ts","../../lib/routes/solidot/main.ts"],"sourcesContent":["import got from '@/utils/got'; // get web content\r\nimport { load } from 'cheerio'; // html parser\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport default async function get_article(url) {\r\n    const domain = 'https://www.solidot.org';\r\n\r\n    if (/^\\/.*$/.test(url)) {\r\n        url = domain + url;\r\n    }\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n    });\r\n    const data = response.data;\r\n    const $ = load(data);\r\n\r\n    const date_raw = $('div.talk_time').clone().children().remove().end().text();\r\n    const date_str_zh = date_raw.replaceAll(/^[^`]*发表于(.*分)[^`]*$/g, '$1'); // use [^`] to match \\n\r\n    const date_str = date_str_zh\r\n        .replaceAll(/[年月]/g, '-')\r\n        .replaceAll('时', ':')\r\n        .replaceAll(/[分日]/g, '');\r\n\r\n    const title = $('div.block_m > div.ct_tittle > div.bg_htit > h2').text();\r\n    const category = $('div.icon_float > a').attr('title');\r\n    const author = $('div.talk_time > b')\r\n        .text()\r\n        .replaceAll(/^来自(.*)部门$/g, '$1');\r\n    $('div.ct_tittle').remove();\r\n    $('div.talk_time').remove();\r\n    const description = $('div.block_m')\r\n        .html()\r\n        .replaceAll(/(href.*?)<u>(.*?)<\\/u>/g, `$1$2`)\r\n        .replaceAll('href=\"/', 'href=\"' + domain + '/')\r\n        // Preserve the not extremely disturbing donation ad\r\n        // to support the site.\r\n        .replaceAll(/(<img.*liiLIZF8Uh6yM.*?>)/g, `<br><br>$1`);\r\n\r\n    const item = {\r\n        title,\r\n        pubDate: timezone(parseDate(date_str), +8),\r\n        author,\r\n        link: url,\r\n        description,\r\n        category,\r\n    };\r\n    return item;\r\n}\r\n","import { Route, ViewType } from '@/types';\r\nimport cache from '@/utils/cache';\r\n// Warning: The author still knows nothing about javascript!\r\n\r\n// params:\r\n// type: subject type\r\n\r\nimport got from '@/utils/got'; // get web content\r\nimport { load } from 'cheerio'; // html parser\r\nimport get_article from './_article';\r\nimport { isValidHost } from '@/utils/valid-host';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: '/:type?',\r\n    categories: ['traditional-media'],\r\n    view: ViewType.Articles,\r\n    example: '/solidot/linux',\r\n    parameters: {\r\n        type: {\r\n            description: '消息类型，在网站上方选择后复制子域名或参见 [https://www.solidot.org/index.rss](https://www.solidot.org/index.rss) 即可',\r\n            options: [\r\n                { value: 'www', label: '全部' },\r\n                { value: 'startup', label: '创业' },\r\n                { value: 'linux', label: 'Linux' },\r\n                { value: 'science', label: '科学' },\r\n                { value: 'technology', label: '科技' },\r\n                { value: 'mobile', label: '移动' },\r\n                { value: 'apple', label: '苹果' },\r\n                { value: 'hardware', label: '硬件' },\r\n                { value: 'software', label: '软件' },\r\n                { value: 'security', label: '安全' },\r\n                { value: 'games', label: '游戏' },\r\n                { value: 'books', label: '书籍' },\r\n                { value: 'ask', label: 'ask' },\r\n                { value: 'idle', label: 'idle' },\r\n                { value: 'blog', label: '博客' },\r\n                { value: 'cloud', label: '云计算' },\r\n                { value: 'story', label: '奇客故事' },\r\n            ],\r\n            default: 'www',\r\n        },\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '最新消息',\r\n    maintainers: ['sgqy', 'hang333', 'TonyRL'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type') ?? 'www';\r\n    if (!isValidHost(type)) {\r\n        throw new InvalidParameterError('Invalid type');\r\n    }\r\n\r\n    const base_url = `https://${type}.solidot.org`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url: base_url,\r\n    });\r\n    const data = response.data; // content is html format\r\n    const $ = load(data);\r\n\r\n    // get urls\r\n    const a = $('div.block_m').find('div.bg_htit > h2 > a');\r\n    const urls = [];\r\n    for (const element of a) {\r\n        urls.push($(element).attr('href'));\r\n    }\r\n\r\n    // get articles\r\n    const msg_list = await Promise.all(urls.map((u) => cache.tryGet(u, () => get_article(u))));\r\n\r\n    // feed the data\r\n    return {\r\n        title: '奇客的资讯，重要的东西',\r\n        link: base_url,\r\n        item: msg_list,\r\n    };\r\n}\r\n"],"mappings":"4kBAKA,eAA8B,EAAY,EAAK,CAC3C,IAAM,EAAS,0BAEX,SAAS,KAAK,KACd,EAAM,EAAS,GAEnB,IAAM,EAAW,MAAMG,EAAI,CACvB,OAAQ,MACR,QAEE,EAAO,EAAS,KAChB,EAAI,EAAK,GAET,EAAW,EAAE,iBAAiB,QAAQ,WAAW,SAAS,MAAM,OAChE,EAAc,EAAS,WAAW,wBAAyB,MAC3D,EAAW,EACZ,WAAW,QAAS,KACpB,WAAW,IAAK,KAChB,WAAW,QAAS,IAEnB,EAAQ,EAAE,kDAAkD,OAC5D,EAAW,EAAE,sBAAsB,KAAK,SACxC,EAAS,EAAE,qBACZ,OACA,WAAW,cAAe,MAC/B,EAAE,iBAAiB,SACnB,EAAE,iBAAiB,SACnB,IAAM,EAAc,EAAE,eACjB,OACA,WAAW,0BAA2B,QACtC,WAAW,UAAW,SAAW,EAAS,KAG1C,WAAW,6BAA8B,cAExC,EAAO,CACT,QACA,QAAS,EAAS,EAAU,GAAW,GACvC,SACA,KAAM,EACN,cACA,YAEJ,OAAO,ECnCX,MAAaF,EAAe,CACxB,KAAM,UACN,WAAY,CAAC,qBACb,KAAM,EAAS,SACf,QAAS,iBACT,WAAY,CACR,KAAM,CACF,YAAa,kGACb,QAAS,CACL,CAAE,MAAO,MAAO,MAAO,MACvB,CAAE,MAAO,UAAW,MAAO,MAC3B,CAAE,MAAO,QAAS,MAAO,SACzB,CAAE,MAAO,UAAW,MAAO,MAC3B,CAAE,MAAO,aAAc,MAAO,MAC9B,CAAE,MAAO,SAAU,MAAO,MAC1B,CAAE,MAAO,QAAS,MAAO,MACzB,CAAE,MAAO,WAAY,MAAO,MAC5B,CAAE,MAAO,WAAY,MAAO,MAC5B,CAAE,MAAO,WAAY,MAAO,MAC5B,CAAE,MAAO,QAAS,MAAO,MACzB,CAAE,MAAO,QAAS,MAAO,MACzB,CAAE,MAAO,MAAO,MAAO,OACvB,CAAE,MAAO,OAAQ,MAAO,QACxB,CAAE,MAAO,OAAQ,MAAO,MACxB,CAAE,MAAO,QAAS,MAAO,OACzB,CAAE,MAAO,QAAS,MAAO,SAE7B,QAAS,QAGjB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,OAAQ,UAAW,UACjC,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,MACtC,GAAI,CAAC,EAAY,GACb,MAAM,IAAIC,EAAsB,gBAGpC,IAAM,EAAW,WAAW,EAAK,cAC3B,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAEH,EAAO,EAAS,KAChB,EAAI,EAAK,GAGT,EAAI,EAAE,eAAe,KAAK,wBAC1B,EAAO,GACb,IAAK,IAAM,KAAW,EAClB,EAAK,KAAK,EAAE,GAAS,KAAK,SAI9B,IAAM,EAAW,MAAM,QAAQ,IAAI,EAAK,IAAK,GAAMC,EAAM,OAAO,MAAS,EAAY,MAGrF,MAAO,CACH,MAAO,cACP,KAAM,EACN,KAAM"}