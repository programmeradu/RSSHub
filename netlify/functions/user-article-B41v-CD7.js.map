{"version":3,"file":"user-article-B41v-CD7.js","names":["route: Route","ofetch","item","cache","response"],"sources":["../../lib/routes/luogu/user-article.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport * as cheerio from 'cheerio';\r\nimport { getUserInfoFromUID } from './utils';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/user/article/:uid',\r\n    categories: ['programming'],\r\n    example: '/luogu/user/article/1',\r\n    parameters: { name: '用户 UID' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['luogu.com/user/:uid'],\r\n        },\r\n        {\r\n            source: ['luogu.com.cn/user/:uid'],\r\n        },\r\n    ],\r\n    name: '用户文章',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nconst baseUrl = 'https://www.luogu.com';\r\n\r\nasync function handler(ctx) {\r\n    const { uid } = ctx.req.param();\r\n\r\n    const userInfo = await getUserInfoFromUID(uid);\r\n    const response = await ofetch(`${baseUrl}/api/article/find`, {\r\n        query: {\r\n            user: uid,\r\n            page: 1,\r\n            ascending: false,\r\n        },\r\n    });\r\n\r\n    const posts = response.articles.result.map((item) => ({\r\n        title: item.title,\r\n        link: `${baseUrl}/article/${item.lid}`,\r\n        author: item.author.name,\r\n        pubDate: parseDate(item.time, 'X'),\r\n        description: item.content,\r\n    }));\r\n\r\n    const item = await Promise.all(\r\n        posts.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await ofetch(item.link);\r\n                const $ = cheerio.load(response);\r\n                item.description = $('div#rendered-preview').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${userInfo.name} 的个人中心 - 洛谷 | 计算机科学教育新生态`,\r\n        description: userInfo.description,\r\n        link: `${baseUrl}/user/${uid}#article`,\r\n        image: userInfo.avatar,\r\n        item,\r\n    };\r\n}\r\n"],"mappings":"+ZAOA,MAAaA,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,eACb,QAAS,wBACT,WAAY,CAAE,KAAM,UACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,wBAEb,CACI,OAAQ,CAAC,4BAGjB,KAAM,OACN,YAAa,CAAC,UACd,WAGE,EAAU,wBAEhB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAQ,EAAI,IAAI,QAElB,EAAW,MAAM,EAAmB,GACpC,EAAW,MAAMC,EAAO,GAAG,EAAQ,mBAAoB,CACzD,MAAO,CACH,KAAM,EACN,KAAM,EACN,UAAW,MAIb,EAAQ,EAAS,SAAS,OAAO,IAAK,IAAU,CAClD,MAAOC,EAAK,MACZ,KAAM,GAAG,EAAQ,WAAWA,EAAK,MACjC,OAAQA,EAAK,OAAO,KACpB,QAAS,EAAUA,EAAK,KAAM,KAC9B,YAAaA,EAAK,WAGhB,EAAO,MAAM,QAAQ,IACvB,EAAM,IAAK,GACPC,EAAM,OAAOD,EAAK,KAAM,SAAY,CAChC,IAAME,EAAW,MAAMH,EAAOC,EAAK,MAC7B,EAAI,EAAQ,KAAKE,GAGvB,MAFA,GAAK,YAAc,EAAE,wBAAwB,OAEtCF,MAKnB,MAAO,CACH,MAAO,GAAG,EAAS,KAAK,0BACxB,YAAa,EAAS,YACtB,KAAM,GAAG,EAAQ,QAAQ,EAAI,UAC7B,MAAO,EAAS,OAChB"}