{"version":3,"file":"tag-DZH3h2va.js","names":["route: Route","ofetch","items: DataItem[]","link"],"sources":["../../lib/routes/asianfanfics/tag.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\n\r\nimport { config } from '@/config';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\n\r\n// test url http://localhost:1200/asianfanfics/tag/milklove/N\r\n\r\nexport const route: Route = {\r\n    path: '/tag/:tag/:type',\r\n    categories: ['reading'],\r\n    example: '/asianfanfics/tag/milklove/N',\r\n    parameters: {\r\n        tag: '标签',\r\n        type: '排序类型',\r\n    },\r\n    name: '标签',\r\n    maintainers: ['KazooTTT'],\r\n    radar: [\r\n        {\r\n            source: ['www.asianfanfics.com/browse/tag/:tag/:type'],\r\n            target: '/tag/:tag/:type',\r\n        },\r\n    ],\r\n    description: `匹配asianfanfics标签，支持排序类型：\r\n- L: Latest 最近更新\r\n- N: Newest 最近发布\r\n- O: Oldest 最早发布\r\n- C: Completed 已完成\r\n- OS: One Shots 短篇\r\n`,\r\n    handler,\r\n};\r\n\r\ntype Type = 'L' | 'N' | 'O' | 'C' | 'OS';\r\n\r\nconst typeToText = {\r\n    L: '最近更新',\r\n    N: '最近发布',\r\n    O: '最早发布',\r\n    C: '已完成',\r\n    OS: '短篇',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const tag = ctx.req.param('tag');\r\n    const type = ctx.req.param('type') as Type;\r\n\r\n    if (!type || !['L', 'N', 'O', 'C', 'OS'].includes(type)) {\r\n        throw new Error('无效的排序类型');\r\n    }\r\n    const link = `https://www.asianfanfics.com/browse/tag/${tag}/${type}`;\r\n\r\n    const response = await ofetch(link, {\r\n        headers: {\r\n            'user-agent': config.trueUA,\r\n            Referer: 'https://www.asianfanfics.com/',\r\n        },\r\n    });\r\n    const $ = load(response);\r\n\r\n    const items: DataItem[] = $('.primary-container .excerpt')\r\n        .toArray()\r\n        .filter((element) => {\r\n            const $element = $(element);\r\n            return $element.find('.excerpt__title a').length > 0;\r\n        })\r\n        .map((element) => {\r\n            const $element = $(element);\r\n            const title = $element.find('.excerpt__title a').text();\r\n            const link = 'https://www.asianfanfics.com' + $element.find('.excerpt__title a').attr('href');\r\n            const author = $element.find('.excerpt__meta__name a').text().trim();\r\n            const pubDate = parseDate($element.find('time').attr('datetime') || '');\r\n            const description = $element.find('.excerpt__text').html();\r\n\r\n            return {\r\n                title,\r\n                link,\r\n                author,\r\n                pubDate,\r\n                description,\r\n            };\r\n        });\r\n\r\n    return {\r\n        title: `Asianfanfics - 标签：${tag} - ${typeToText[type]}`,\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"gRASA,MAAaA,EAAe,CACxB,KAAM,kBACN,WAAY,CAAC,WACb,QAAS,+BACT,WAAY,CACR,IAAK,KACL,KAAM,QAEV,KAAM,KACN,YAAa,CAAC,YACd,MAAO,CACH,CACI,OAAQ,CAAC,8CACT,OAAQ,oBAGhB,YAAa;;;;;;EAOb,WAKE,EAAa,CACf,EAAG,OACH,EAAG,OACH,EAAG,OACH,EAAG,MACH,GAAI,MAGR,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,EAAI,IAAI,MAAM,OACpB,EAAO,EAAI,IAAI,MAAM,QAE3B,GAAI,CAAC,GAAQ,CAAC,CAAC,IAAK,IAAK,IAAK,IAAK,MAAM,SAAS,GAC9C,MAAU,MAAM,WAEpB,IAAM,EAAO,2CAA2C,EAAI,GAAG,IAEzD,EAAW,MAAMC,EAAO,EAAM,CAChC,QAAS,CACL,aAAc,EAAO,OACrB,QAAS,mCAGX,EAAI,EAAK,GAETC,EAAoB,EAAE,+BACvB,UACA,OAAQ,GAAY,CACjB,IAAM,EAAW,EAAE,GACnB,OAAO,EAAS,KAAK,qBAAqB,OAAS,IAEtD,IAAK,GAAY,CACd,IAAM,EAAW,EAAE,GACb,EAAQ,EAAS,KAAK,qBAAqB,OAC3CC,EAAO,+BAAiC,EAAS,KAAK,qBAAqB,KAAK,QAChF,EAAS,EAAS,KAAK,0BAA0B,OAAO,OACxD,EAAU,EAAU,EAAS,KAAK,QAAQ,KAAK,aAAe,IAC9D,EAAc,EAAS,KAAK,kBAAkB,OAEpD,MAAO,CACH,QACA,KAAA,EACA,SACA,UACA,iBAIZ,MAAO,CACH,MAAO,qBAAqB,EAAI,KAAK,EAAW,KAChD,OACA,KAAM"}