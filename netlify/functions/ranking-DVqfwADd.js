import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{parseDuration as e}from"./helpers-DzX-lcQO.js";import"./render-CxhTJIsl.js";import"./md5-4BNsOP-F.js";import"./ofetch-Bzt0BXUH.js";import{got_default as t}from"./got-CdvI2yKX.js";import{ViewType as n}from"./types-A5bA50Mg.js";import{getVideoUrl as r,utils_default as i}from"./utils-BY2D8TfT.js";const a=[`0`,`1`,`4`,`168`,`3`,`1`,`3`,`129`,`4`,`36`,`188`,`234`,`223`,`160`,`211`,`217`,`119`,`155`,`5`,`181`,`2`,`5`,`7`,`0`,`0`],o=[`全站`,`番剧`,`国产动画`,`国创相关`,`纪录片`,`动画`,`音乐`,`舞蹈`,`游戏`,`知识`,`科技`,`运动`,`汽车`,`生活`,`美食`,`动物圈`,`鬼畜`,`时尚`,`娱乐`,`影视`,`电影`,`电视剧`,`综艺`,`原创`,`新人`],s=[`all`,`bangumi`,`guochan`,`guochuang`,`documentary`,`douga`,`music`,`dance`,`game`,`knowledge`,`tech`,`sports`,`car`,`life`,`food`,`animal`,`kichiku`,`fashion`,`ent`,`cinephile`,`movie`,`tv`,`variety`,`origin`,`rookie`],c=[`x/rid`,`pgc/web`,`pgc/season`,`x/rid`,`pgc/season`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`pgc/season`,`pgc/season`,`pgc/season`,`x/type`,`x/type`],l={path:`/ranking/:rid_index?/:embed?/:redirect1?/:redirect2?`,name:`排行榜`,maintainers:[`DIYgod`,`hyoban`],categories:[`social-media`],view:n.Videos,example:`/bilibili/ranking/0`,parameters:{rid_index:{description:`排行榜分区 id 序号`,default:`0`,options:Array.from({length:a.length},(e,t)=>({value:String(t),label:o[t]})).filter((e,t)=>!c[t].startsWith(`pgc/`))},embed:`默认为开启内嵌视频, 任意值为关闭`,redirect1:`留空，用于兼容之前的路由`,redirect2:`留空，用于兼容之前的路由`},handler:f};function u(e){let t=a.indexOf(e);if(t===-1)throw Error(`Invalid rid`);return t}function d(e){if(e<0||e>=a.length)throw Error(`Invalid rid index`);let t=a[e],n=c[e],r=o[e],i=s[e],l=``;switch(n){case`x/rid`:l=`https://api.bilibili.com/x/web-interface/ranking?rid=${t}&type=all`;break;case`pgc/web`:l=`https://api.bilibili.com/pgc/web/rank/list?day=3&season_type=${t}`;break;case`pgc/season`:l=`https://api.bilibili.com/pgc/season/rank/web/list?day=3&season_type=${t}`;break;case`x/type`:l=`https://api.bilibili.com/x/web-interface/ranking?rid=0&type=${i}`;break;default:throw Error(`Invalid rid type`)}return{apiURL:l,referer:`https://www.bilibili.com/v/popular/rank/${i}`,ridChinese:r,ridType:n,link:`https://www.bilibili.com/v/popular/rank/${i}`}}async function f(n){let a=n.req.param();if(a.redirect1||a.redirect2){let e=a.redirect2?`/`+a.redirect2:``;return n.set(`redirect`,`/bilibili/ranking/${u(a.rid_index)}${e}`),null}let o=n.req.param(`rid_index`)||`0`,s=!n.req.param(`embed`),{apiURL:c,referer:l,ridChinese:f,link:p,ridType:m}=d(Number(o));if(m.startsWith(`pgc/`))throw Error(`This type of ranking is not supported yet`);let h=await t({method:`get`,url:c,headers:{Referer:l}}),g=h.data.data||h.data.result,_=g.list||[];return{title:`bilibili 排行榜-${f}`,link:p,item:_.map(t=>({title:t.title,description:i.renderUGCDescription(s,t.pic,t.description||t.title,t.aid,void 0,t.bvid),pubDate:t.create&&new Date(t.create).toUTCString(),author:t.author,link:!t.create||new Date(t.create).getTime()/1e3>i.bvidTime&&t.bvid?`https://www.bilibili.com/video/${t.bvid}`:`https://www.bilibili.com/video/av${t.aid}`,image:t.pic,attachments:t.bvid?[{url:r(t.bvid),mime_type:`text/html`,duration_in_seconds:e(t.duration)}]:void 0}))}}export{l as route};
//# sourceMappingURL=ranking-DVqfwADd.js.map