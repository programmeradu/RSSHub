{"version":3,"file":"gist-DJMBxxxt.js","names":["route: Route","got"],"sources":["../../lib/routes/github/gist.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { config } from '@/config';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/gist/:gistId',\r\n    categories: ['programming'],\r\n    example: '/github/gist/d2c152bb7179d07015f336b1a0582679',\r\n    parameters: { gistId: 'Gist ID' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['gist.github.com/:owner/:gistId/revisions', 'gist.github.com/:owner/:gistId/stargazers', 'gist.github.com/:owner/:gistId/forks', 'gist.github.com/:owner/:gistId'],\r\n        },\r\n    ],\r\n    name: 'Gist Commits',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const gistId = ctx.req.param('gistId');\r\n\r\n    const headers = { Accept: 'application/vnd.github.v3+json' };\r\n    if (config.github && config.github.access_token) {\r\n        headers.Authorization = `Bearer ${config.github.access_token}`;\r\n    }\r\n\r\n    const host = 'https://gist.github.com';\r\n    const apiUrl = `https://api.github.com/gists/${gistId}`;\r\n\r\n    const { data: response } = await got(apiUrl, {\r\n        headers,\r\n    });\r\n\r\n    const items = response.history.map((item, index) => ({\r\n        title: `${item.user.login} ${index === response.history.length - 1 ? 'created' : 'revised'} this gist`,\r\n        description: item.change_status.total ? `${item.change_status.additions} additions and ${item.change_status.deletions} deletions` : null,\r\n        link: `${host}/${gistId}/${item.version}`,\r\n        pubDate: parseDate(item.committed_at), // e.g. 2022-09-02T11:09:56Z\r\n    }));\r\n\r\n    return {\r\n        allowEmpty: true,\r\n        title: `${response.owner.login} / ${Object.values(response.files)[0].filename}`,\r\n        description: response.description,\r\n        image: response.owner.avatar_url,\r\n        link: `${response.html_url}/revisions`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"sSAKA,MAAaA,EAAe,CACxB,KAAM,gBACN,WAAY,CAAC,eACb,QAAS,gDACT,WAAY,CAAE,OAAQ,WACtB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,2CAA4C,4CAA6C,uCAAwC,oCAGlJ,KAAM,eACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,EAAI,IAAI,MAAM,UAEvB,EAAU,CAAE,OAAQ,kCACtB,EAAO,QAAU,EAAO,OAAO,eAC/B,EAAQ,cAAgB,UAAU,EAAO,OAAO,gBAGpD,IACM,EAAS,gCAAgC,IAEzC,CAAE,KAAM,GAAa,MAAMC,EAAI,EAAQ,CACzC,YAGE,EAAQ,EAAS,QAAQ,KAAK,EAAM,KAAW,CACjD,MAAO,GAAG,EAAK,KAAK,MAAM,GAAG,IAAU,EAAS,QAAQ,OAAS,EAAI,UAAY,UAAU,YAC3F,YAAa,EAAK,cAAc,MAAQ,GAAG,EAAK,cAAc,UAAU,iBAAiB,EAAK,cAAc,UAAU,YAAc,KACpI,KAAM,2BAAW,EAAO,GAAG,EAAK,UAChC,QAAS,EAAU,EAAK,iBAG5B,MAAO,CACH,WAAY,GACZ,MAAO,GAAG,EAAS,MAAM,MAAM,KAAK,OAAO,OAAO,EAAS,OAAO,GAAG,WACrE,YAAa,EAAS,YACtB,MAAO,EAAS,MAAM,WACtB,KAAM,GAAG,EAAS,SAAS,YAC3B,KAAM"}