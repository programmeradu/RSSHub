{"version":3,"file":"aljazeera-CEE1FuPM.js","names":[],"sources":["../../lib/routes/aljazeera/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport { getSubPath } from '@/utils/common-utils';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nconst languages = {\r\n    arabic: {\r\n        rootUrl: 'https://www.aljazeera.net',\r\n        rssUrl: 'rss',\r\n    },\r\n    chinese: {\r\n        rootUrl: 'https://chinese.aljazeera.net',\r\n        rssUrl: undefined,\r\n    },\r\n    english: {\r\n        rootUrl: 'https://www.aljazeera.com',\r\n        rssUrl: 'xml/rss/all.xml',\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '*',\r\n    name: 'Unknown',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const params = getSubPath(ctx) === '/' ? ['arabic'] : getSubPath(ctx).replace(/^\\//, '').split('/');\r\n\r\n    if (!Object.hasOwn(languages, params[0])) {\r\n        params.unshift('arabic');\r\n    }\r\n\r\n    const language = params.shift();\r\n    const isRSS = params.length === 1 && params.at(-1) === 'rss' && languages[language].rssUrl;\r\n\r\n    const rootUrl = languages[language].rootUrl;\r\n    const currentUrl = `${rootUrl}/${isRSS ? languages[language].rssUrl : params.join('/')}`;\r\n\r\n    const response = await ofetch(currentUrl);\r\n    const $ = load(response);\r\n\r\n    let items = isRSS\r\n        ? response.data.match(new RegExp('<link>' + rootUrl + '/(.*?)</link>', 'g')).map((item) => ({\r\n              link: item.match(/<link>(.*?)<\\/link>/)[1],\r\n          }))\r\n        : $('.u-clickable-card__link')\r\n              .toArray()\r\n              .map((item) => {\r\n                  item = $(item);\r\n\r\n                  return {\r\n                      link: `${rootUrl}${item.attr('href')}`,\r\n                  };\r\n              });\r\n\r\n    items = await Promise.all(\r\n        items.slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 50).map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await ofetch(item.link);\r\n\r\n                const content = load(detailResponse);\r\n\r\n                content('.more-on').parent().remove();\r\n                content('.responsive-image img').removeAttr('srcset');\r\n                let pubDate;\r\n\r\n                const datePublished = detailResponse.match(/\"datePublished\": ?\"(.*?)\",/);\r\n                if (datePublished && datePublished.length > 1) {\r\n                    pubDate = detailResponse.match(/\"datePublished\": ?\"(.*?)\",/)[1];\r\n                } else {\r\n                    // uploadDate replaces datePublished for video articles\r\n                    const uploadDate = detailResponse.match(/\"uploadDate\": ?\"(.*?)\",/)[1];\r\n\r\n                    pubDate = uploadDate && uploadDate.length > 1 ? uploadDate : content('div.date-simple > span:nth-child(2)').text();\r\n                }\r\n\r\n                item.title = content('h1').first().text();\r\n                item.author = content('.author').text();\r\n                item.pubDate = pubDate;\r\n                item.description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    image: content('.article-featured-image').html(),\r\n                    description: content('.wysiwyg').html(),\r\n                });\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('title').first().text(),\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"ucASA,MAAM,EAAY,CACd,OAAQ,CACJ,QAAS,4BACT,OAAQ,OAEZ,QAAS,CACL,QAAS,gCACT,OAAQ,IAAA,IAEZ,QAAS,CACL,QAAS,4BACT,OAAQ,oBAIH,EAAe,CACxB,KAAM,IACN,KAAM,UACN,YAAa,CAAC,WACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,EAAW,KAAS,IAAM,CAAC,UAAY,EAAW,GAAK,QAAQ,MAAO,IAAI,MAAM,KAE1F,OAAO,OAAO,EAAW,EAAO,KACjC,EAAO,QAAQ,UAGnB,IAAM,EAAW,EAAO,QAClB,EAAQ,EAAO,SAAW,GAAK,EAAO,GAAG,MAAQ,OAAS,EAAU,GAAU,OAE9E,EAAU,EAAU,GAAU,QAC9B,EAAa,GAAG,EAAQ,GAAG,EAAQ,EAAU,GAAU,OAAS,EAAO,KAAK,OAE5E,EAAW,MAAM,EAAO,GACxB,EAAI,EAAK,GAEX,EAAQ,EACN,EAAS,KAAK,MAAU,OAAO,SAAW,EAAU,gBAAiB,MAAM,IAAK,IAAU,CACtF,KAAM,EAAK,MAAM,uBAAuB,MAE5C,EAAE,2BACG,UACA,IAAK,IACF,EAAO,EAAE,GAEF,CACH,KAAM,GAAG,IAAU,EAAK,KAAK,aAsC/C,MAlCA,GAAQ,MAAM,QAAQ,IAClB,EAAM,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAAI,IAAK,GACvF,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAM,EAAO,EAAK,MAEnC,EAAU,EAAK,GAErB,EAAQ,YAAY,SAAS,SAC7B,EAAQ,yBAAyB,WAAW,UAC5C,IAAI,EAEE,EAAgB,EAAe,MAAM,8BAC3C,GAAI,GAAiB,EAAc,OAAS,EACxC,EAAU,EAAe,MAAM,8BAA8B,OAC1D,CAEH,IAAM,EAAa,EAAe,MAAM,2BAA2B,GAEnE,EAAU,GAAc,EAAW,OAAS,EAAI,EAAa,EAAQ,uCAAuC,OAWhH,MARA,GAAK,MAAQ,EAAQ,MAAM,QAAQ,OACnC,EAAK,OAAS,EAAQ,WAAW,OACjC,EAAK,QAAU,EACf,EAAK,YAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACtE,MAAO,EAAQ,2BAA2B,OAC1C,YAAa,EAAQ,YAAY,SAG9B,MAKZ,CACH,MAAO,EAAE,SAAS,QAAQ,OAC1B,KAAM,EACN,KAAM"}