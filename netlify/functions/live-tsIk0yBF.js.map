{"version":3,"file":"live-tsIk0yBF.js","names":["route: Route","ConfigNotFoundError","got","utils","cache"],"sources":["../../lib/routes/youtube/live.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport utils from './utils';\r\nimport { config } from '@/config';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nexport const route: Route = {\r\n    path: '/live/:username/:embed?',\r\n    categories: ['live'],\r\n    example: '/youtube/live/@GawrGura',\r\n    parameters: { username: 'YouTuber id', embed: 'Default to embed the video, set to any value to disable embedding' },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'YOUTUBE_KEY',\r\n                description: ' YouTube API Key, support multiple keys, split them with `,`, [API Key application](https://console.developers.google.com/)',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Live',\r\n    maintainers: ['sussurr127'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    if (!config.youtube || !config.youtube.key) {\r\n        throw new ConfigNotFoundError('YouTube RSS is disabled due to the lack of <a href=\"https://docs.rsshub.app/deploy/config#route-specific-configurations\">relevant config</a>');\r\n    }\r\n    const username = ctx.req.param('username');\r\n    const embed = !ctx.req.param('embed');\r\n\r\n    let channelName;\r\n    let channelId;\r\n\r\n    const link = `https://www.youtube.com/${username}`;\r\n    const response = await got(link);\r\n    const $ = load(response.data);\r\n    channelId = $('meta[itemprop=\"identifier\"]').attr('content');\r\n    channelName = $('meta[itemprop=\"name\"]').attr('content');\r\n\r\n    if (!channelId) {\r\n        const channelInfo = (await utils.getChannelWithUsername(username, 'snippet', cache)).data.items[0];\r\n        channelId = channelInfo.id;\r\n        channelName = channelInfo.snippet.title;\r\n    }\r\n\r\n    const data = (await utils.getLive(channelId, cache)).data.items;\r\n\r\n    return {\r\n        title: `${channelName || username}'s Live Status`,\r\n        link: `https://www.youtube.com/channel/${channelId}`,\r\n        description: `$${channelName || username}'s live streaming status`,\r\n        item: data.map((item) => {\r\n            const snippet = item.snippet;\r\n            const liveVideoId = item.id.videoId;\r\n            const img = utils.getThumbnail(snippet.thumbnails);\r\n            return {\r\n                title: snippet.title,\r\n                description: utils.renderDescription(embed, liveVideoId, img, utils.formatDescription(snippet.description)),\r\n                pubDate: parseDate(snippet.publishedAt),\r\n                guid: liveVideoId,\r\n                link: `https://www.youtube.com/watch?v=${liveVideoId}`,\r\n                image: img.url,\r\n            };\r\n        }),\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"ojBASA,MAAaA,EAAe,CACxB,KAAM,0BACN,WAAY,CAAC,QACb,QAAS,0BACT,WAAY,CAAE,SAAU,cAAe,MAAO,qEAC9C,SAAU,CACN,cAAe,CACX,CACI,KAAM,cACN,YAAa,gIAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,cACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAI,CAAC,EAAO,SAAW,CAAC,EAAO,QAAQ,IACnC,MAAM,IAAIC,EAAoB,gJAElC,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAQ,CAAC,EAAI,IAAI,MAAM,SAEzB,EACA,EAEE,EAAO,2BAA2B,IAClC,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,MAIxB,GAHA,EAAY,EAAE,+BAA+B,KAAK,WAClD,EAAc,EAAE,yBAAyB,KAAK,WAE1C,CAAC,EAAW,CACZ,IAAM,GAAe,MAAMC,EAAM,uBAAuB,EAAU,UAAWC,IAAQ,KAAK,MAAM,GAChG,EAAY,EAAY,GACxB,EAAc,EAAY,QAAQ,MAGtC,IAAM,GAAQ,MAAMD,EAAM,QAAQ,EAAWC,IAAQ,KAAK,MAE1D,MAAO,CACH,MAAO,GAAG,GAAe,EAAS,gBAClC,KAAM,mCAAmC,IACzC,YAAa,IAAI,GAAe,EAAS,0BACzC,KAAM,EAAK,IAAK,GAAS,CACrB,IAAM,EAAU,EAAK,QACf,EAAc,EAAK,GAAG,QACtB,EAAMD,EAAM,aAAa,EAAQ,YACvC,MAAO,CACH,MAAO,EAAQ,MACf,YAAaA,EAAM,kBAAkB,EAAO,EAAa,EAAKA,EAAM,kBAAkB,EAAQ,cAC9F,QAAS,EAAU,EAAQ,aAC3B,KAAM,EACN,KAAM,mCAAmC,IACzC,MAAO,EAAI,OAGnB,WAAY"}