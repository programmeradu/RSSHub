{"version":3,"file":"manhua-CwHAQ_qw.js","names":[],"sources":["../../lib/routes/fffdm/manhua/manhua.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nconst domain = 'manhua.fffdm.com';\r\nconst host = `https://${domain}`;\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst get_pic = async (url) => {\r\n    const response = await got(url);\r\n    const data = response.data;\r\n    return {\r\n        comicTitle: data.mhinfo.title,\r\n        chapterTitle: data.title,\r\n        pics: data.cont,\r\n        pubDate: parseDate(data.mh.time),\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/manhua/:id/:cdn?',\r\n    categories: ['anime'],\r\n    example: '/fffdm/manhua/93',\r\n    parameters: { id: '漫画ID。默认获取全部，建议使用通用参数limit获取指定数量', cdn: 'cdn加速器。默认5，当前可选1-5' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.fffdm.com/manhua/:id', 'www.fffdm.com/:id'],\r\n            target: '/manhua/:id',\r\n        },\r\n    ],\r\n    name: '在线漫画',\r\n    maintainers: ['zytomorrow'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const count = ctx.req.query('limit') || 99999;\r\n    const cdnNum = ctx.req.param('cdn') || 5;\r\n    const cdn = !Number.isNaN(Number.parseInt(cdnNum)) && 1 <= Number.parseInt(cdnNum) && Number.parseInt(cdnNum) <= 5 ? `https://p${cdnNum}.fzacg.com` : `https://p5.fzacg.com`;\r\n\r\n    // 获取漫画清单\r\n    const response = await got(`${host}/api/manhua/${id}`);\r\n    const data = response.data;\r\n\r\n    const chapter_detail = await Promise.all(\r\n        data.mhlist.splice(0, count).map((item) => {\r\n            const url = `${host}/api/manhua/${id}/${item.url}`;\r\n            return cache.tryGet(url, async () => {\r\n                const picContent = await get_pic(url);\r\n                return {\r\n                    title: picContent.chapterTitle,\r\n                    description: art(path.join(__dirname, '../templates/manhua.art'), { pic: picContent.pics, cdn }),\r\n                    link: `${host}/${id}/${item.url}/`,\r\n                    comicTitle: picContent.comicTitle,\r\n                    pubDate: picContent.pubDate,\r\n                };\r\n            });\r\n        })\r\n    );\r\n    return {\r\n        title: '风之动漫 - ' + chapter_detail[0].comicTitle,\r\n        link: `${host}/${id}`,\r\n        description: '风之动漫',\r\n        item: chapter_detail,\r\n    };\r\n}\r\n"],"mappings":"ybAIA,MACM,EAAO,2BAKP,EAAU,KAAO,IAAQ,CAC3B,IAAM,EAAW,MAAM,EAAI,GACrB,EAAO,EAAS,KACtB,MAAO,CACH,WAAY,EAAK,OAAO,MACxB,aAAc,EAAK,MACnB,KAAM,EAAK,KACX,QAAS,EAAU,EAAK,GAAG,QAItB,EAAe,CACxB,KAAM,oBACN,WAAY,CAAC,SACb,QAAS,mBACT,WAAY,CAAE,GAAI,kCAAmC,IAAK,sBAC1D,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,2BAA4B,qBACrC,OAAQ,gBAGhB,KAAM,OACN,YAAa,CAAC,cACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAQ,EAAI,IAAI,MAAM,UAAY,MAClC,EAAS,EAAI,IAAI,MAAM,QAAU,EACjC,EAAM,CAAC,OAAO,MAAM,OAAO,SAAS,KAAY,GAAK,OAAO,SAAS,IAAW,OAAO,SAAS,IAAW,EAAI,YAAY,EAAO,YAAc,uBAGhJ,EAAW,MAAM,EAAI,GAAG,EAAK,cAAc,KAC3C,EAAO,EAAS,KAEhB,EAAiB,MAAM,QAAQ,IACjC,EAAK,OAAO,OAAO,EAAG,GAAO,IAAK,GAAS,CACvC,IAAM,EAAM,GAAG,EAAK,cAAc,EAAG,GAAG,EAAK,MAC7C,OAAO,EAAM,OAAO,EAAK,SAAY,CACjC,IAAM,EAAa,MAAM,EAAQ,GACjC,MAAO,CACH,MAAO,EAAW,aAClB,YAAa,EAAI,EAAA,KAAA,EAAA,iCAAiD,CAAE,IAAK,EAAW,KAAM,QAC1F,KAAM,GAAG,EAAK,GAAG,EAAG,GAAG,EAAK,IAAI,GAChC,WAAY,EAAW,WACvB,QAAS,EAAW,cAKpC,MAAO,CACH,MAAO,UAAY,EAAe,GAAG,WACrC,KAAM,GAAG,EAAK,GAAG,IACjB,YAAa,OACb,KAAM"}