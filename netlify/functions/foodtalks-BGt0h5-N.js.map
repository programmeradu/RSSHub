{"version":3,"file":"foodtalks-BGt0h5-N.js","names":["namespace: Namespace","route: Route","cache","ofetch"],"sources":["../../lib/routes/foodtalks/namespace.ts","../../lib/routes/foodtalks/index.ts"],"sourcesContent":["import type { Namespace } from '@/types';\r\n\r\nexport const namespace: Namespace = {\r\n    name: 'FoodTalks全球食品资讯网',\r\n    url: 'www.foodtalks.cn',\r\n    categories: ['new-media'],\r\n    lang: 'zh-CN',\r\n    description: 'FoodTalks全球食品资讯网是一个提供食品饮料行业新闻、资讯、分析和商业资源的领先在线平台。它涵盖行业趋势、市场动态、产品创新、投融资信息以及企业新闻，连接行业内的专业人士、企业和消费者。',\r\n};\r\n","import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport cache from '@/utils/cache';\r\nimport { namespace } from './namespace';\r\nimport logger from '@/utils/logger';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    categories: namespace.categories,\r\n    example: '/foodtalks',\r\n    radar: [\r\n        {\r\n            source: ['www.foodtalks.cn'],\r\n        },\r\n    ],\r\n    name: 'FoodTalks global food information network',\r\n    maintainers: ['Geraldxm'],\r\n    handler,\r\n    url: 'www.foodtalks.cn',\r\n};\r\n\r\nfunction processItems(list: any[], fullTextApi: string) {\r\n    return Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                try {\r\n                    const response = await ofetch(fullTextApi.replace('{id}', item.id), {\r\n                        headers: {\r\n                            referrer: 'https://www.foodtalks.cn/',\r\n                            method: 'GET',\r\n                        },\r\n                    });\r\n                    item.description = response.data.content;\r\n                    return item;\r\n                } catch (error) {\r\n                    logger.error(`Error fetching full text for ${item.link}:`, error);\r\n                    return item;\r\n                }\r\n            })\r\n        )\r\n    );\r\n}\r\n\r\nasync function handler(ctx) {\r\n    const limit = ctx.req.query('limit') || 15;\r\n    const url = `https://api-we.foodtalks.cn/news/news/page?current=1&size=${limit}&isLatest=1&language=ZH`;\r\n    const response = await ofetch(url, {\r\n        headers: {\r\n            referrer: 'https://www.foodtalks.cn/',\r\n            method: 'GET',\r\n        },\r\n    });\r\n    const records = response.data.records;\r\n\r\n    const list = records.map((item) => ({\r\n        title: item.title,\r\n        pubDate: new Date(item.publishTime),\r\n        link: `https://www.foodtalks.cn/news/${item.id}`,\r\n        category: item.parentTagCode === 'category' ? item.tagCode : item.parentTagCode,\r\n        author: item.author === null ? item.sourceName : item.author,\r\n        id: item.id,\r\n        image: item.coverImg,\r\n    }));\r\n\r\n    const fullTextApi = 'https://api-we.foodtalks.cn/news/news/{id}?language=ZH';\r\n    const items = await processItems(list, fullTextApi);\r\n\r\n    return {\r\n        title: namespace.name,\r\n        description: namespace.description,\r\n        link: 'https://' + namespace.url,\r\n        item: items,\r\n        image: 'https://www.foodtalks.cn/static/img/news-site-logo.7aaa5463.svg',\r\n    };\r\n}\r\n"],"mappings":"wPAEA,MAAaA,EAAuB,CAChC,KAAM,mBACN,IAAK,mBACL,WAAY,CAAC,aACb,KAAM,QACN,YAAa,oGCDJC,EAAe,CACxB,KAAM,IACN,WAAY,EAAU,WACtB,QAAS,aACT,MAAO,CACH,CACI,OAAQ,CAAC,sBAGjB,KAAM,4CACN,YAAa,CAAC,YACd,UACA,IAAK,oBAGT,SAAS,EAAa,EAAa,EAAqB,CACpD,OAAO,QAAQ,IACX,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,CACA,IAAM,EAAW,MAAMC,EAAO,EAAY,QAAQ,OAAQ,EAAK,IAAK,CAChE,QAAS,CACL,SAAU,4BACV,OAAQ,SAIhB,MADA,GAAK,YAAc,EAAS,KAAK,QAC1B,QACF,EAAO,CAEZ,OADA,EAAO,MAAM,gCAAgC,EAAK,KAAK,GAAI,GACpD,OAO3B,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,UAAY,GAClC,EAAM,6DAA6D,EAAM,yBACzE,EAAW,MAAMA,EAAO,EAAK,CAC/B,QAAS,CACL,SAAU,4BACV,OAAQ,SAGV,EAAU,EAAS,KAAK,QAExB,EAAO,EAAQ,IAAK,IAAU,CAChC,MAAO,EAAK,MACZ,QAAS,IAAI,KAAK,EAAK,aACvB,KAAM,iCAAiC,EAAK,KAC5C,SAAU,EAAK,gBAAkB,WAAa,EAAK,QAAU,EAAK,cAClE,OAAQ,EAAK,SAAW,KAAO,EAAK,WAAa,EAAK,OACtD,GAAI,EAAK,GACT,MAAO,EAAK,YAIV,EAAQ,MAAM,EAAa,EAAM,0DAEvC,MAAO,CACH,MAAO,EAAU,KACjB,YAAa,EAAU,YACvB,KAAM,WAAa,EAAU,IAC7B,KAAM,EACN,MAAO"}