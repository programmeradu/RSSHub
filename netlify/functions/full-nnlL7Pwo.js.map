{"version":3,"file":"full-nnlL7Pwo.js","names":["cache","got","route: Route","parser"],"sources":["../../lib/routes/economist/full.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport parser from '@/utils/rss-parser';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nconst getArticleDetail = (link) =>\r\n    cache.tryGet(link, async () => {\r\n        const response = await got(link);\r\n        const $ = load(response.data);\r\n        $('div.article-audio-player__center-tooltip').remove();\r\n        const nextData = JSON.parse($('head script[type=\"application/ld+json\"]').first().text());\r\n\r\n        const figure = $('figure[class^=css-]').first().parent().parent().html() || '';\r\n        const body = $('p[data-component=\"paragraph\"]').parent().parent().html();\r\n        const article = figure + body;\r\n        const categories = nextData.keywords?.map((k) => k);\r\n\r\n        return { article, categories };\r\n    });\r\n\r\nexport const route: Route = {\r\n    path: '/:endpoint',\r\n    categories: ['traditional-media'],\r\n    view: ViewType.Articles,\r\n    example: '/economist/latest',\r\n    parameters: { endpoint: 'Category name, can be found on the [official page](https://www.economist.com/rss). For example, https://www.economist.com/china/rss.xml to china' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['economist.com/:endpoint'],\r\n        },\r\n    ],\r\n    name: 'Category',\r\n    maintainers: ['ImSingee'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const endpoint = ctx.req.param('endpoint');\r\n    const feed = await parser.parseURL(`https://www.economist.com/${endpoint}/rss.xml`);\r\n\r\n    const items = await Promise.all(\r\n        feed.items.slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 30).map(async (item) => {\r\n            const path = item.link.slice(item.link.lastIndexOf('/') + 1);\r\n            const isNotCollection = !/^\\d{4}-\\d{2}-\\d{2}$/.test(path);\r\n            const itemDetails = isNotCollection ? await getArticleDetail(item.link) : null;\r\n            return {\r\n                title: item.title,\r\n                description: isNotCollection ? itemDetails.article : item.content,\r\n                link: item.link,\r\n                guid: item.guid,\r\n                pubDate: item.pubDate,\r\n                category: isNotCollection ? itemDetails.categories : null,\r\n            };\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: feed.title,\r\n        link: feed.link,\r\n        description: feed.description,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"gaAMA,MAAM,EAAoB,GACtBA,EAAM,OAAO,EAAM,SAAY,CAC3B,IAAM,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,MACxB,EAAE,4CAA4C,SAC9C,IAAM,EAAW,KAAK,MAAM,EAAE,2CAA2C,QAAQ,QAE3E,EAAS,EAAE,uBAAuB,QAAQ,SAAS,SAAS,QAAU,GACtE,EAAO,EAAE,iCAAiC,SAAS,SAAS,OAC5D,EAAU,EAAS,EACnB,EAAa,EAAS,UAAU,IAAK,GAAM,GAEjD,MAAO,CAAE,UAAS,gBAGbC,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,qBACb,KAAM,EAAS,SACf,QAAS,oBACT,WAAY,CAAE,SAAU,oJACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,6BAGjB,KAAM,WACN,YAAa,CAAC,YACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAO,MAAMC,EAAO,SAAS,6BAA6B,EAAS,WAEnE,EAAQ,MAAM,QAAQ,IACxB,EAAK,MAAM,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,IAAI,IAAI,KAAO,IAAS,CAC/G,IAAM,EAAO,EAAK,KAAK,MAAM,EAAK,KAAK,YAAY,KAAO,GACpD,EAAkB,CAAC,sBAAsB,KAAK,GAC9C,EAAc,EAAkB,MAAM,EAAiB,EAAK,MAAQ,KAC1E,MAAO,CACH,MAAO,EAAK,MACZ,YAAa,EAAkB,EAAY,QAAU,EAAK,QAC1D,KAAM,EAAK,KACX,KAAM,EAAK,KACX,QAAS,EAAK,QACd,SAAU,EAAkB,EAAY,WAAa,SAKjE,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EAAK,KACX,YAAa,EAAK,YAClB,KAAM"}