{"version":3,"file":"commonslibrary-m3jY9ESC.js","names":["route: Route","puppeteer"],"sources":["../../lib/routes/parliament.uk/commonslibrary.ts"],"sourcesContent":["import { load } from 'cheerio';\r\nimport { Route } from '@/types';\r\nimport puppeteer from '@/utils/puppeteer';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/commonslibrary/type/:topic?',\r\n    categories: ['government'],\r\n    example: '/parliament.uk/commonslibrary/type/research-briefing',\r\n    parameters: { topic: 'research by topic, string, example: [research-briefing|data-dashboard]' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: true,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Commonlibrary',\r\n    maintainers: ['AntiKnot'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { topic } = ctx.req.param();\r\n    const baseUrl = 'https://commonslibrary.parliament.uk';\r\n    const url = `${baseUrl}/type/${topic}/`;\r\n    const browser = await puppeteer();\r\n    const page = await browser.newPage();\r\n    await page.setRequestInterception(true);\r\n    page.on('request', (request) => {\r\n        request.resourceType() === 'document' ? request.continue() : request.abort();\r\n    });\r\n    await page.goto(url, {\r\n        waitUntil: 'domcontentloaded',\r\n    });\r\n\r\n    const html = await page.evaluate(() => document.documentElement.innerHTML);\r\n    await page.close();\r\n    const $ = load(html);\r\n    const items = $('div.l-box.l-box--no-border.card__text')\r\n        .toArray()\r\n        .map((article) => ({\r\n            title: $(article).find('.card__text a').text().trim(),\r\n            link: $(article).find('.card__text a').attr('href'),\r\n            description: $(article).find('p').last().text().trim(),\r\n            pubDate: timezone($(article).find('.card__date time').attr('datetime')),\r\n        }));\r\n    await browser.close();\r\n    return {\r\n        title: `parliament - lordslibrary - ${topic}`,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mOAKA,MAAaA,EAAe,CACxB,KAAM,+BACN,WAAY,CAAC,cACb,QAAS,uDACT,WAAY,CAAE,MAAO,0EACrB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,gBACN,YAAa,CAAC,YACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,SAAU,EAAI,IAAI,QAEpB,EAAM,6CAAmB,EAAM,GAC/B,EAAU,MAAMC,IAChB,EAAO,MAAM,EAAQ,UAC3B,MAAM,EAAK,uBAAuB,IAClC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,WAAa,EAAQ,WAAa,EAAQ,UAEzE,MAAM,EAAK,KAAK,EAAK,CACjB,UAAW,qBAGf,IAAM,EAAO,MAAM,EAAK,aAAe,SAAS,gBAAgB,WAChE,MAAM,EAAK,QACX,IAAM,EAAI,EAAK,GACT,EAAQ,EAAE,yCACX,UACA,IAAK,IAAa,CACf,MAAO,EAAE,GAAS,KAAK,iBAAiB,OAAO,OAC/C,KAAM,EAAE,GAAS,KAAK,iBAAiB,KAAK,QAC5C,YAAa,EAAE,GAAS,KAAK,KAAK,OAAO,OAAO,OAChD,QAAS,EAAS,EAAE,GAAS,KAAK,oBAAoB,KAAK,gBAGnE,OADA,MAAM,EAAQ,QACP,CACH,MAAO,+BAA+B,IACtC,KAAM,EACN,KAAM"}