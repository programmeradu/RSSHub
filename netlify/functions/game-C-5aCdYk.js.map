{"version":3,"file":"game-C-5aCdYk.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/3dmgame/game.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { parseArticle } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/games/:name/:type?',\r\n    radar: [\r\n        {\r\n            source: ['3dmgame.com/games/:name/:type'],\r\n        },\r\n    ],\r\n    name: '游戏资讯',\r\n    categories: ['game'],\r\n    maintainers: ['sinchang', 'jacky2001114', 'HenryQW', 'lyqluis'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { name, type = 'news' } = ctx.req.param();\r\n    const url = `https://www.3dmgame.com/games/${name}/${type}/`;\r\n\r\n    const { data: response } = await got(url);\r\n    const $ = load(response);\r\n    const listSelector = type === 'resource' ? $('.ZQ_Left .Llis_4 .lis li, .zq_left .rigtbox7 li').toArray() : $('.ZQ_Left .lis, .zq_left .newsleft li').toArray();\r\n\r\n    const list = listSelector.map((i) => {\r\n        i = $(i);\r\n        const a = i.find('a[href]').last();\r\n        const time = i.find('.time');\r\n        return {\r\n            title: a.text(),\r\n            description: i.find('.miaoshu').text(),\r\n            link: a.attr('href'),\r\n            pubDate: time.length ? parseDate(time.text().trim()) : null, // 2020-12-31\r\n        };\r\n    });\r\n\r\n    const items = await Promise.all(list.map((item) => parseArticle(item, cache.tryGet)));\r\n\r\n    return {\r\n        title: $('head title').text().split('_')[0],\r\n        description: $('head meta[name=\"Description\"]').attr('content'),\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0bAOA,MAAaA,EAAe,CACxB,KAAM,sBACN,MAAO,CACH,CACI,OAAQ,CAAC,mCAGjB,KAAM,OACN,WAAY,CAAC,QACb,YAAa,CAAC,WAAY,eAAgB,UAAW,WACrD,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAM,OAAO,QAAW,EAAI,IAAI,QAClC,EAAM,iCAAiC,EAAK,GAAG,EAAK,GAEpD,CAAE,KAAM,GAAa,MAAMC,EAAI,GAC/B,EAAI,EAAK,GACT,EAAe,IAAS,WAAa,EAAE,mDAAmD,UAAY,EAAE,wCAAwC,UAEhJ,EAAO,EAAa,IAAK,GAAM,CACjC,EAAI,EAAE,GACN,IAAM,EAAI,EAAE,KAAK,WAAW,OACtB,EAAO,EAAE,KAAK,SACpB,MAAO,CACH,MAAO,EAAE,OACT,YAAa,EAAE,KAAK,YAAY,OAChC,KAAM,EAAE,KAAK,QACb,QAAS,EAAK,OAAS,EAAU,EAAK,OAAO,QAAU,QAIzD,EAAQ,MAAM,QAAQ,IAAI,EAAK,IAAK,GAAS,EAAa,EAAMC,EAAM,UAE5E,MAAO,CACH,MAAO,EAAE,cAAc,OAAO,MAAM,KAAK,GACzC,YAAa,EAAE,iCAAiC,KAAK,WACrD,KAAM,EACN,KAAM"}