{"version":3,"file":"ielts-B1vgfvx8.js","names":["route: Route","cache","puppeteer","html","got","$"],"sources":["../../lib/routes/ielts/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nconst targetUrl = 'https://ielts.neea.cn/allnews?locale=zh_CN';\r\nimport { config } from '@/config';\r\nimport puppeteer from '@/utils/puppeteer';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    radar: [\r\n        {\r\n            source: ['ielts.neea.cn/allnews'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['zenxds'],\r\n    handler,\r\n    url: 'ielts.neea.cn/allnews',\r\n};\r\n\r\nasync function handler() {\r\n    const html = await cache.tryGet(\r\n        targetUrl,\r\n        async () => {\r\n            const browser = await puppeteer();\r\n            const page = await browser.newPage();\r\n            await page.setRequestInterception(true);\r\n            page.on('request', (request) => {\r\n                request.resourceType() === 'document' || request.resourceType() === 'script' ? request.continue() : request.abort();\r\n            });\r\n            await page.goto(targetUrl, {\r\n                waitUntil: 'domcontentloaded',\r\n            });\r\n            await page.waitForSelector('div.container');\r\n\r\n            const html = await page.evaluate(() => document.documentElement.innerHTML);\r\n            await browser.close();\r\n            return html;\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    );\r\n\r\n    const $ = load(html);\r\n\r\n    const list = $('#newsListUl li')\r\n        .toArray()\r\n        .map((elem) => {\r\n            const $elem = $(elem);\r\n            return {\r\n                title: $elem.find('a').text(),\r\n                link: $elem.find('a').attr('href'),\r\n                pubDate: timezone(parseDate($elem.find('span').eq(-1).text().replaceAll(/[[\\]]/g, '').trim(), +8)),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n\r\n                const $ = load(detailResponse.data);\r\n                item.description = $('.content').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: 'IELTS雅思最新消息',\r\n        link: targetUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mgBAMA,MAAM,EAAY,6CAILA,EAAe,CACxB,KAAM,IACN,MAAO,CACH,CACI,OAAQ,CAAC,yBACT,OAAQ,KAGhB,KAAM,UACN,YAAa,CAAC,UACd,UACA,IAAK,yBAGT,eAAe,GAAU,CACrB,IAAM,EAAO,MAAMC,EAAM,OACrB,EACA,SAAY,CACR,IAAM,EAAU,MAAMC,IAChB,EAAO,MAAM,EAAQ,UAC3B,MAAM,EAAK,uBAAuB,IAClC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,YAAc,EAAQ,iBAAmB,SAAW,EAAQ,WAAa,EAAQ,UAEhH,MAAM,EAAK,KAAK,EAAW,CACvB,UAAW,qBAEf,MAAM,EAAK,gBAAgB,iBAE3B,IAAMC,EAAO,MAAM,EAAK,aAAe,SAAS,gBAAgB,WAEhE,OADA,MAAM,EAAQ,QACPA,GAEX,EAAO,MAAM,YACb,IAGE,EAAI,EAAK,GAET,EAAO,EAAE,kBACV,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GAChB,MAAO,CACH,MAAO,EAAM,KAAK,KAAK,OACvB,KAAM,EAAM,KAAK,KAAK,KAAK,QAC3B,QAAS,EAAS,EAAU,EAAM,KAAK,QAAQ,GAAG,IAAI,OAAO,WAAW,SAAU,IAAI,OAAQ,OAIpG,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNF,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMG,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGRC,EAAI,EAAK,EAAe,MAE9B,MADA,GAAK,YAAcA,EAAE,YAAY,OAC1B,MAKnB,MAAO,CACH,MAAO,cACP,KAAM,EACN,KAAM"}