{"version":3,"file":"convert-B6w2-gzd.js","names":["route: Route","queries: Record<string, string>","got"],"sources":["../../lib/routes/sse/convert.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/convert/:query?',\r\n    categories: ['finance'],\r\n    example: '/sse/convert/beginDate=2018-08-18&endDate=2019-08-18&companyCode=603283&title=股份',\r\n    parameters: { query: '筛选条件，见示例' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '可转换公司债券公告',\r\n    maintainers: ['kt286'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const query = ctx.req.param('query') ?? ''; // beginDate=2018-08-18&endDate=2019-08-18&companyCode=603283&title=股份\r\n    const pageUrl = 'https://bond.sse.com.cn/disclosure/announ/convertible/';\r\n    const host = 'https://www.sse.com.cn';\r\n    const queries: Record<string, string> = {};\r\n    if (query) {\r\n        const pairs = query.split('&');\r\n        for (const pair of pairs) {\r\n            const [key, value] = pair.split('=');\r\n            if (key) {\r\n                queries[key] = value;\r\n            }\r\n        }\r\n    }\r\n\r\n    const response = await got('https://query.sse.com.cn/infodisplay/queryBulletinKzzTipsNew.do', {\r\n        searchParams: {\r\n            isPagination: true,\r\n            'pageHelp.pageSize': 20,\r\n            flag: 0,\r\n            _: Date.now(),\r\n            ...queries,\r\n        },\r\n        headers: {\r\n            Referer: pageUrl,\r\n        },\r\n    });\r\n\r\n    const items = response.data.result.map((item) => ({\r\n        title: item.title,\r\n        description: `${host}${item.URL}`,\r\n        pubDate: parseDate(item.ADDDATE),\r\n        link: `${host}${item.URL}`,\r\n        author: item.security_Code,\r\n    }));\r\n\r\n    return {\r\n        title: '上证债券信息网 - 可转换公司债券公告',\r\n        link: pageUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"qRAIA,MAAaA,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,WACb,QAAS,mFACT,WAAY,CAAE,MAAO,YACrB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,YACN,YAAa,CAAC,SACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,UAAY,GAClC,EAAU,yDACV,EAAO,yBACPC,EAAkC,GACxC,GAAI,EAAO,CACP,IAAM,EAAQ,EAAM,MAAM,KAC1B,IAAK,IAAM,KAAQ,EAAO,CACtB,GAAM,CAAC,EAAK,GAAS,EAAK,MAAM,KAC5B,IACA,EAAQ,GAAO,IAK3B,IAAM,EAAW,MAAMC,EAAI,kEAAmE,CAC1F,aAAc,CACV,aAAc,GACd,oBAAqB,GACrB,KAAM,EACN,EAAG,KAAK,MACR,GAAG,GAEP,QAAS,CACL,QAAS,KAIX,EAAQ,EAAS,KAAK,OAAO,IAAK,IAAU,CAC9C,MAAO,EAAK,MACZ,YAAa,GAAG,IAAO,EAAK,MAC5B,QAAS,EAAU,EAAK,SACxB,KAAM,GAAG,IAAO,EAAK,MACrB,OAAQ,EAAK,iBAGjB,MAAO,CACH,MAAO,sBACP,KAAM,EACN,KAAM"}