{"version":3,"file":"vinyl-or-picture-lp-C8bd05Ve.js","names":["route: Route","puppeteer"],"sources":["../../lib/routes/hkushop/vinyl-or-picture-lp.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport puppeteer from '@/utils/puppeteer';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/vinyl/:cat?',\r\n    categories: ['shopping'],\r\n    example: '/hkushop/vinyl',\r\n    parameters: {\r\n        cat: '分类，见下表，默认不分类',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: true,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        supportRadar: true,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['hkushop.com/vinyl-or-picture-lp.html', 'hkushop.com/'],\r\n            target: '/vinyl',\r\n        },\r\n    ],\r\n    name: 'HKU Shop 黑胶专区',\r\n    maintainers: ['gideonsenku'],\r\n    handler,\r\n    description: `常见分类:\r\n| 華語音樂 | 經典復刻 | 古典跨界 | 爵士音樂 | 國際音樂 | 電影原聲帶 | 黑膠日本音樂 |\r\n| ---- | ---- | ---- | ---- | ---- | ---- | ---- |\r\n| 37 | 38 | 40 | 41 | 39 | 170 | 224 |`,\r\n    url: 'hkushop.com/vinyl-or-picture-lp.html',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://hkushop.com';\r\n    const cat = ctx.req.param('cat') ?? '';\r\n    const url = cat ? `${baseUrl}/vinyl-or-picture-lp.html?cat=${cat}` : `${baseUrl}/vinyl-or-picture-lp.html`;\r\n\r\n    const browser = await puppeteer();\r\n    const page = await browser.newPage();\r\n    await page.setRequestInterception(true);\r\n    page.on('request', (request) => {\r\n        request.resourceType() === 'document' || request.resourceType() === 'script' ? request.continue() : request.abort();\r\n    });\r\n    await page.goto(url, {\r\n        waitUntil: 'domcontentloaded',\r\n    });\r\n\r\n    const response = await page.content();\r\n    await page.close();\r\n    await browser.close();\r\n\r\n    const $ = load(response);\r\n\r\n    const list = $('.products.list.items.product-items .product-item')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            const $link = $item.find('.product-item-link');\r\n            const $price = $item.find('.price');\r\n            const $image = $item.find('.product-image-photo');\r\n            const $artist = $item.find('.artist a').text().trim();\r\n\r\n            return {\r\n                title: $link.text().trim(),\r\n                link: $link.attr('href'),\r\n                description: `\r\n                <img src=\"${$image.attr('src')}\" />\r\n                <p>作者: ${$artist}</p>\r\n                <p>价格: ${$price.text().trim()}</p>\r\n            `,\r\n                guid: $link.attr('href'),\r\n            };\r\n        });\r\n\r\n    const title = cat ? `黑胶\\\\彩胶系列 - ${$('.page-title').text().trim()}` : String.raw`黑胶\\\\彩胶系列 - HKU Shop 环球唱片网店`;\r\n\r\n    return {\r\n        title,\r\n        link: url,\r\n        description: 'HKU Shop 黑胶唱片最新商品信息',\r\n        item: list,\r\n    };\r\n}\r\n"],"mappings":"iLAIA,MAAaA,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,YACb,QAAS,iBACT,WAAY,CACR,IAAK,gBAET,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,aAAc,IAElB,MAAO,CACH,CACI,OAAQ,CAAC,uCAAwC,gBACjD,OAAQ,WAGhB,KAAM,gBACN,YAAa,CAAC,eACd,UACA,YAAa;;;wCAIb,IAAK,wCAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,sBACV,EAAM,EAAI,IAAI,MAAM,QAAU,GAC9B,EAAM,EAAM,GAAG,EAAQ,gCAAgC,IAAQ,GAAG,EAAQ,2BAE1E,EAAU,MAAMC,IAChB,EAAO,MAAM,EAAQ,UAC3B,MAAM,EAAK,uBAAuB,IAClC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,YAAc,EAAQ,iBAAmB,SAAW,EAAQ,WAAa,EAAQ,UAEhH,MAAM,EAAK,KAAK,EAAK,CACjB,UAAW,qBAGf,IAAM,EAAW,MAAM,EAAK,UAC5B,MAAM,EAAK,QACX,MAAM,EAAQ,QAEd,IAAM,EAAI,EAAK,GAET,EAAO,EAAE,oDACV,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GACV,EAAQ,EAAM,KAAK,sBACnB,EAAS,EAAM,KAAK,UACpB,EAAS,EAAM,KAAK,wBACpB,EAAU,EAAM,KAAK,aAAa,OAAO,OAE/C,MAAO,CACH,MAAO,EAAM,OAAO,OACpB,KAAM,EAAM,KAAK,QACjB,YAAa;4BACD,EAAO,KAAK,OAAO;yBACtB,EAAQ;yBACR,EAAO,OAAO,OAAO;cAE9B,KAAM,EAAM,KAAK,WAIvB,EAAQ,EAAM,cAAc,EAAE,eAAe,OAAO,SAAW,OAAO,GAAG,6BAE/E,MAAO,CACH,QACA,KAAM,EACN,YAAa,sBACb,KAAM"}