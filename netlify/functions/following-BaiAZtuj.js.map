{"version":3,"file":"following-BaiAZtuj.js","names":["route: Route","ConfigNotFoundError"],"sources":["../../lib/routes/medium/following.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { config } from '@/config';\r\n\r\nimport parseArticle from './parse-article.js';\r\nimport { getFollowingFeedQuery } from './graphql.js';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found.js';\r\n\r\nexport const route: Route = {\r\n    path: '/following/:user',\r\n    categories: ['blog'],\r\n    example: '/medium/following/imsingee',\r\n    parameters: { user: 'Username' },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'MEDIUM_COOKIE_*',\r\n                description: '',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Personalized Recommendations - Following',\r\n    maintainers: ['ImSingee'],\r\n    handler,\r\n    description: `::: warning\r\n  Personalized recommendations require the cookie value after logging in, so only self-hosting is supported. See the configuration module on the deployment page for details.\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const user = ctx.req.param('user');\r\n\r\n    const cookie = config.medium.cookies[user];\r\n    if (cookie === undefined) {\r\n        throw new ConfigNotFoundError(`缺少 Medium 用户 ${user} 登录后的 Cookie 值`);\r\n    }\r\n\r\n    const posts = await getFollowingFeedQuery(user, cookie);\r\n    ctx.set('json', posts);\r\n\r\n    if (!posts) {\r\n        // login failed\r\n        throw new ConfigNotFoundError(`Medium 用户 ${user} 的 Cookie 无效或已过期`);\r\n    }\r\n\r\n    const urls = posts.items.map((data) => data.post.mediumUrl);\r\n\r\n    const parsedArticles = await Promise.all(urls.map((url) => parseArticle(ctx, url)));\r\n\r\n    return {\r\n        title: `${user} Medium Following`,\r\n        link: 'https://medium.com/?feed=following',\r\n        item: parsedArticles,\r\n    };\r\n}\r\n"],"mappings":"iZAOA,MAAaA,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,QACb,QAAS,6BACT,WAAY,CAAE,KAAM,YACpB,SAAU,CACN,cAAe,CACX,CACI,KAAM,kBACN,YAAa,KAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,2CACN,YAAa,CAAC,YACd,UACA,YAAa;;MAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QAErB,EAAS,EAAO,OAAO,QAAQ,GACrC,GAAI,IAAW,IAAA,GACX,MAAM,IAAIC,EAAoB,gBAAgB,EAAK,iBAGvD,IAAM,EAAQ,MAAM,EAAsB,EAAM,GAGhD,GAFA,EAAI,IAAI,OAAQ,GAEZ,CAAC,EAED,MAAM,IAAIA,EAAoB,aAAa,EAAK,mBAGpD,IAAM,EAAO,EAAM,MAAM,IAAK,GAAS,EAAK,KAAK,WAE3C,EAAiB,MAAM,QAAQ,IAAI,EAAK,IAAK,GAAQ,EAAa,EAAK,KAE7E,MAAO,CACH,MAAO,GAAG,EAAK,mBACf,KAAM,qCACN,KAAM"}