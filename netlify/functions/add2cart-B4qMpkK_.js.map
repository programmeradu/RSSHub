{"version":3,"file":"add2cart-B4qMpkK_.js","names":["route: Route","got"],"sources":["../../lib/routes/xiaoheihe/add2cart.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/add2cart/:platform',\r\n    categories: ['game'],\r\n    example: '/xiaoheihe/add2cart/epic',\r\n    parameters: { platform: '平台名：epic、steam或gog' },\r\n    name: '喜加一',\r\n    maintainers: ['ladeng07'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const platform = ctx.req.param('platform');\r\n    const response = await got(`https://api.xiaoheihe.cn/mall/add_to_cart/?platform=${platform}`);\r\n    const data = response.data.result.games;\r\n\r\n    let items = data.map((item) => {\r\n        const title = `${item.type === 'dlc' ? '[DLC]' : ''}${item.name}${item.name_en ? '/' + item.name_en : ''}`;\r\n\r\n        let description = `<img src=\"${item.image}\"/> <br/>`;\r\n        description += item.type === 'dlc' ? '本体: ' + item.product_home_name + '<br/>' : '';\r\n        if (item.price) {\r\n            description += `原价: ${item.price.initial_amount}<br/>`;\r\n        }\r\n        if (item.score) {\r\n            description += `评分: ${item.score}<br/>`;\r\n        }\r\n\r\n        description += `支持中文: ${item.chinese_support ? '是' : '否'}<br/>`;\r\n\r\n        description += `截止时间: ${parseDate(item.end_time * 1000).toLocaleString('zh-CN')}<br/>`;\r\n        description += '<br/>';\r\n\r\n        let link = `https://api.xiaoheihe.cn/game/share_game_detail?appid=${item.steam_appid}`;\r\n        if (platform === 'steam') {\r\n            link = `https://store.steampowered.com/app/${item.steam_appid}`;\r\n        }\r\n        return {\r\n            title,\r\n            description,\r\n            link,\r\n            pubDate: parseDate(item.end_time * 1000),\r\n        };\r\n    });\r\n\r\n    if (items.length === 0) {\r\n        items = [\r\n            {\r\n                title: `${platform.toUpperCase()}最近没有喜加一(悲`,\r\n                pubDate: parseDate(response.data.result.weixindata.timestamp * 1000),\r\n            },\r\n        ];\r\n    }\r\n\r\n    return {\r\n        title: `小黑盒 ${platform.toUpperCase()} 喜加一`,\r\n        link: `https://xiaoheihe.cn`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"qRAIA,MAAaA,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,QACb,QAAS,2BACT,WAAY,CAAE,SAAU,sBACxB,KAAM,MACN,YAAa,CAAC,YACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAW,MAAMC,EAAI,uDAAuD,KAC5E,EAAO,EAAS,KAAK,OAAO,MAE9B,EAAQ,EAAK,IAAK,GAAS,CAC3B,IAAM,EAAQ,GAAG,EAAK,OAAS,MAAQ,QAAU,KAAK,EAAK,OAAO,EAAK,QAAU,IAAM,EAAK,QAAU,KAElG,EAAc,aAAa,EAAK,MAAM,WAC1C,GAAe,EAAK,OAAS,MAAQ,OAAS,EAAK,kBAAoB,QAAU,GAC7E,EAAK,QACL,GAAe,OAAO,EAAK,MAAM,eAAe,QAEhD,EAAK,QACL,GAAe,OAAO,EAAK,MAAM,QAGrC,GAAe,SAAS,EAAK,gBAAkB,IAAM,IAAI,OAEzD,GAAe,SAAS,EAAU,EAAK,SAAW,KAAM,eAAe,SAAS,OAChF,GAAe,QAEf,IAAI,EAAO,yDAAyD,EAAK,cAIzE,OAHI,IAAa,UACb,EAAO,sCAAsC,EAAK,eAE/C,CACH,QACA,cACA,OACA,QAAS,EAAU,EAAK,SAAW,QAa3C,OATI,EAAM,SAAW,IACjB,EAAQ,CACJ,CACI,MAAO,GAAG,EAAS,cAAc,WACjC,QAAS,EAAU,EAAS,KAAK,OAAO,WAAW,UAAY,QAKpE,CACH,MAAO,OAAO,EAAS,cAAc,MACrC,KAAM,uBACN,KAAM"}