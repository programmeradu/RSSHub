{"version":3,"file":"mydrivers-BgJJliCT.js","names":[],"sources":["../../lib/routes/mydrivers/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nimport { rootUrl, title, categories, convertToQueryString, getInfo, processItems } from './util';\r\n\r\nexport const route: Route = {\r\n    path: '/:category{.+}?',\r\n    name: '分类',\r\n    parameters: { category: '分类，见下表，默认为最新' },\r\n    example: '/mydrivers/bcid/801',\r\n    maintainers: ['kt286', 'nczitzk'],\r\n    handler,\r\n    radar: [\r\n        {\r\n            source: ['m.mydrivers.com/'],\r\n            target: '/zhibo',\r\n        },\r\n    ],\r\n    description: `\r\n#### 板块\r\n\r\n| 电脑     | 手机     | 汽车     | 业界     | 游戏     |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| bcid/801 | bcid/802 | bcid/807 | bcid/803 | bcid/806 |\r\n\r\n#### 话题\r\n\r\n| 科学     | 排行     | 评测     | 一图     |\r\n| -------- | -------- | -------- | -------- |\r\n| tid/1000 | tid/1001 | tid/1002 | tid/1003 |\r\n\r\n#### 品牌\r\n\r\n| 安卓     | 阿里     | 微软    | 百度    | PS5       | Xbox     | 华为     |\r\n| -------- | -------- | ------- | ------- | --------- | -------- | -------- |\r\n| icid/121 | icid/270 | icid/90 | icid/67 | icid/6950 | icid/194 | icid/136 |\r\n\r\n| 小米      | VIVO     | 三星     | 魅族     | 一加     | 比亚迪   | 小鹏      |\r\n| --------- | -------- | -------- | -------- | -------- | -------- | --------- |\r\n| icid/9355 | icid/288 | icid/154 | icid/140 | icid/385 | icid/770 | icid/7259 |\r\n\r\n| 蔚来      | 理想       | 奔驰     | 宝马     | 大众     |\r\n| --------- | ---------- | -------- | -------- | -------- |\r\n| icid/7318 | icid/12947 | icid/429 | icid/461 | icid/481 |\r\n`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let { category = 'new' } = ctx.req.param();\r\n\r\n    let newTitle = '';\r\n\r\n    if (!/^(\\w+\\/\\w+)$/.test(category)) {\r\n        newTitle = `${title} - ${Object.hasOwn(categories, category) ? categories[category] : categories[Object.keys(categories)[0]]}`;\r\n        category = `ac/${category}`;\r\n    }\r\n\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n\r\n    const queryString = convertToQueryString(category);\r\n    const currentUrl = new URL(`newsclass.aspx${queryString}`, rootUrl).href;\r\n\r\n    const apiUrl = new URL(`m/newslist.ashx${queryString}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(apiUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    let items = $('li[data-id]')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.find('div.news_title').text(),\r\n                link: new URL(item.find('div.news_title span.newst a').prop('href'), rootUrl).href,\r\n                description: art(path.join(__dirname, 'templates/description.art'), {\r\n                    image: item.find('a.newsimg img').prop('src'),\r\n                }),\r\n                author: item.find('p.tname').text(),\r\n                guid: item.prop('data-id'),\r\n                pubDate: timezone(parseDate(item.find('p.ttime').text()), +8),\r\n                comments: item.find('a.tpinglun').text() ? Number.parseInt(item.find('a.tpinglun').text(), 10) : 0,\r\n            };\r\n        });\r\n\r\n    items = await processItems(items);\r\n\r\n    return {\r\n        ...(await getInfo(currentUrl)),\r\n        ...(newTitle ? { title: newTitle } : {}),\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mnBAWA,MAAa,EAAe,CACxB,KAAM,kBACN,KAAM,KACN,WAAY,CAAE,SAAU,gBACxB,QAAS,sBACT,YAAa,CAAC,QAAS,WACvB,UACA,MAAO,CACH,CACI,OAAQ,CAAC,oBACT,OAAQ,WAGhB,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;GA6BjB,eAAe,EAAQ,EAAK,CACxB,GAAI,CAAE,WAAW,OAAU,EAAI,IAAI,QAE/B,EAAW,GAEV,eAAe,KAAK,KACrB,EAAW,GAAG,EAAM,KAAK,OAAO,OAAO,EAAY,GAAY,EAAW,GAAY,EAAW,OAAO,KAAK,GAAY,MACzH,EAAW,MAAM,KAGrB,IAAM,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAc,EAAqB,GACnC,EAAa,IAAI,IAAI,iBAAiB,IAAe,GAAS,KAE9D,EAAS,IAAI,IAAI,kBAAkB,IAAe,GAAS,KAE3D,CAAE,KAAM,GAAa,MAAM,EAAI,GAE/B,EAAI,EAAK,GAEX,EAAQ,EAAE,eACT,MAAM,EAAG,GACT,UACA,IAAK,IACF,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,KAAK,kBAAkB,OACnC,KAAM,IAAI,IAAI,EAAK,KAAK,+BAA+B,KAAK,QAAS,GAAS,KAC9E,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,MAAO,EAAK,KAAK,iBAAiB,KAAK,SAE3C,OAAQ,EAAK,KAAK,WAAW,OAC7B,KAAM,EAAK,KAAK,WAChB,QAAS,EAAS,EAAU,EAAK,KAAK,WAAW,QAAS,GAC1D,SAAU,EAAK,KAAK,cAAc,OAAS,OAAO,SAAS,EAAK,KAAK,cAAc,OAAQ,IAAM,KAM7G,MAFA,GAAQ,MAAM,EAAa,GAEpB,CACH,GAAI,MAAM,EAAQ,GAClB,GAAI,EAAW,CAAE,MAAO,GAAa,GACrC,KAAM"}