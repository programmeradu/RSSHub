{"version":3,"file":"zwfw-BNPTGufc.js","names":["selector"],"sources":["../../lib/routes/gov/hangzhou/zjzwfw.ts","../../lib/routes/gov/hangzhou/zwfw.ts"],"sourcesContent":["import logger from '@/utils/logger';\r\n\r\nexport async function crawler(item: any, browser: any): Promise<string> {\r\n    try {\r\n        let response = '';\r\n        const page = await browser.newPage();\r\n        await page.setRequestInterception(true);\r\n        page.on('request', (request) => {\r\n            const resourceType = request.resourceType();\r\n            if (['document', 'script', 'stylesheet', 'xhr'].includes(resourceType)) {\r\n                request.continue();\r\n            } else {\r\n                request.abort();\r\n            }\r\n        });\r\n        await page.goto(item.link, {\r\n            waitUntil: 'networkidle0',\r\n            timeout: 29000,\r\n        });\r\n        const selector = '.item-left .item .title .button';\r\n        await page.evaluate((selector) => document.querySelector(selector).click(), selector);\r\n        await page.waitForSelector('.item-left .item .bg_box div:nth-child(16)', { timeout: 5000 });\r\n        response = await page.content();\r\n        return response || '';\r\n    } catch (error) {\r\n        logger.error('Error when visiting /gov/hangzhou/zwfw:', error);\r\n        return '';\r\n    }\r\n}\r\n\r\nexport function analyzer(box: any): object {\r\n    return {\r\n        serviceInfo: {\r\n            serviceTarget: box.find('.row:nth(1)>div:nth(1)').find('.inner').children().first().attr('content'),\r\n            processingMethods: box.find('.row:nth(1)>div:nth(3)').find('.inner').text(),\r\n            processingLocation: box.find('.row:nth(2)>div:nth(1)').find('.inner').text(),\r\n            processingTime: box.find('.row:nth(3)>div:nth(1)').find('.inner').text(),\r\n        },\r\n        applicationInfo: {\r\n            acceptanceConditions: box.find('.row:nth(5)>div:nth(1)').find('.inner').text(),\r\n            prohibitedRequirements: box.find('.row:nth(6)>div:nth(1)').find('.inner').text(),\r\n            quantityRestrictions: box.find('.row:nth(7)>div:nth(1)').find('.inner').text(),\r\n        },\r\n        resultInfo: {\r\n            approvalResult: box.find('.row:nth(9)>div:nth(1)').find('.inner').text(),\r\n            approvalSample: box.find('.row:nth(10)>div:nth(1)').find('.inner').html(),\r\n            approvalResultType: box.find('.row:nth(10)>div:nth(3)').find('.inner').text(),\r\n        },\r\n        feeInfo: {\r\n            isThereAFee: box.find('.row:nth(12)>div:nth(1)').find('.inner').text(),\r\n            isOnlinePaymentSupported: box.find('.row:nth(12)>div:nth(3)').find('.inner').text(),\r\n        },\r\n        approvalInfo: {\r\n            authoritySource: box.find('.row:nth(14)>div:nth(1)').find('.inner').text(),\r\n            exerciseLevel: box.find('.row:nth(15)>div:nth(1)').find('.inner').text(),\r\n            implementingEntity: box.find('.row:nth(15)>div:nth(3)').find('.inner').text(),\r\n        },\r\n        deliveryInfo: {\r\n            isLogisticsSupported: box.find('.row:nth(17)>div:nth(1)').find('.inner').text(),\r\n            deliveryTimeframe: box.find('.row:nth(17)>div:nth(3)').find('.inner').text(),\r\n            deliveryMethods: box.find('.row:nth(18)>div:nth(1)').find('.inner').text(),\r\n        },\r\n        agentService: box.find('.row:nth(20)>div:nth(1)').find('.inner').text(),\r\n        otherInfo: {\r\n            departmentName: box.find('.row:nth(22)>div:nth(1)').find('.inner').text(),\r\n            matterType: box.find('.row:nth(22)>div:nth(3)').find('.inner').text(),\r\n            acceptingInstitution: box.find('.row:nth(23)>div:nth(1)').find('.inner').text(),\r\n            basicCode: box.find('.row:nth(24)>div:nth(1)').find('.inner').text(),\r\n            implementationCode: box.find('.row:nth(24)>div:nth(3)').find('.inner').text(),\r\n            scopeOfGeneralHandling: box.find('.row:nth(25)>div:nth(1)').find('.inner').text(),\r\n            documentType: box.find('.row:nth(25)>div:nth(3)').find('.inner').text(),\r\n            decisionMakingAuthority: box.find('.row:nth(26)>div:nth(1)').find('.inner').text(),\r\n            delegatedDepartment: box.find('.row:nth(26)>div:nth(3)').find('.inner').text(),\r\n            onlineProcessingDepth: box.find('.row:nth(27)>div:nth(1)').find('.inner').text(),\r\n            reviewType: box.find('.row:nth(27)>div:nth(3)').find('.inner').text(),\r\n            isItAvailableInTheGovernmentServiceHall: box.find('.row:nth(28)>div:nth(1)').find('.inner').text(),\r\n            isSelfServiceTerminalProcessingSupported: box.find('.row:nth(28)>div:nth(3)').find('.inner').text(),\r\n            isACommitmentSystemImplemented: box.find('.row:nth(29)>div:nth(1)').find('.inner').text(),\r\n            authorityAttribute: box.find('.row:nth(29)>div:nth(3)').find('.inner').text(),\r\n            isAppointmentBookingSupported: box.find('.row:nth(30)>div:nth(1)').find('.inner').text(),\r\n            isOnlineProcessingAvailable: box.find('.row:nth(30)>div:nth(3)').find('.inner').text(),\r\n            naturalPersonThemeClassification: box.find('.row:nth(31)>div:nth(1)').find('.inner').text(),\r\n            legalPersonThemeClassification: box.find('.row:nth(31)>div:nth(3)').find('.inner').text(),\r\n            rightsAndObligationsOfAdministrativeCounterparties: box.find('.row:nth(32)>div:nth(1)').find('.inner').text(),\r\n            applicableObjectDescription: box.find('.row:nth(33)>div:nth(1)').find('.inner').text(),\r\n            contentInvolved: box.find('.row:nth(34)>div:nth(1)').find('.inner').text(),\r\n        },\r\n    };\r\n}\r\n","import { Route } from '@/types';\r\nimport { load } from 'cheerio';\r\n\r\nimport puppeteer from '@/utils/puppeteer';\r\nimport ofetch from '@/utils/ofetch';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { crawler, analyzer } from './zjzwfw';\r\nimport timezone from '@/utils/timezone';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\n\r\nexport const route: Route = {\r\n    path: '/hangzhou/zwfw',\r\n    categories: ['government'],\r\n    example: '/gov/hangzhou/zwfw',\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: true,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['hangzhou.gov.cn/col/col1256349/index.html'],\r\n        },\r\n    ],\r\n    name: '政务服务公开',\r\n    maintainers: ['flynncao'],\r\n    handler,\r\n    url: 'hangzhou.gov.cn/col/col1256349/index.html',\r\n};\r\n\r\nasync function handler() {\r\n    const host = 'https://www.hangzhou.gov.cn/col/col1256349/index.html';\r\n    const response = await ofetch(host);\r\n\r\n    const browser = await puppeteer();\r\n    const link = host;\r\n    const formatted = response\r\n        .replace('<script type=\"text/xml\">', '')\r\n        .replace('</script>', '')\r\n        .replaceAll('<recordset>', '')\r\n        .replaceAll('</recordset>', '')\r\n        .replaceAll('<record>', '')\r\n        .replaceAll('</record>', '')\r\n        .replaceAll('<![CDATA[', '')\r\n        .replaceAll(']]>', '');\r\n    const $ = load(formatted);\r\n\r\n    const list = $('li.clearfix')\r\n        .toArray()\r\n        .map((item: any) => {\r\n            item = $(item);\r\n            const title = item.find('a').first().text();\r\n            const time = timezone(parseDate(item.find('span').first().text(), 'YYYY-MM-DD'), 8);\r\n            const a = item.find('a').first().attr('href');\r\n            const fullUrl = new URL(a, host).href;\r\n\r\n            return {\r\n                title,\r\n                link: fullUrl,\r\n                pubDate: time,\r\n            };\r\n        })\r\n        .filter((item) => !item.title.includes('置顶'));\r\n    const items: any = await Promise.all(\r\n        list.map((item: any) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const host = new URL(item.link).hostname;\r\n                if (host === 'www.zjzwfw.gov.cn') {\r\n                    // 来源为浙江政务服务网\r\n                    const content = await crawler(item, browser);\r\n                    const $ = load(content);\r\n                    item.description = art(path.resolve(__dirname, 'templates/jbxx.art'), analyzer($('.item-left .item .bg_box')));\r\n                    item.author = '浙江政务服务网';\r\n                    item.category = $('meta[name=\"ColumnType\"]').attr('content');\r\n                } else {\r\n                    // 其他正常抓取\r\n                    const response = await got(item.link);\r\n                    const $ = load(response.data);\r\n                    if (host === 'police.hangzhou.gov.cn') {\r\n                        // 来源为杭州市公安局\r\n                        item.description = $('.art-content .wz_con_content').html();\r\n                        item.author = $('meta[name=\"ContentSource\"]').attr('content');\r\n                        item.category = $('meta[name=\"ColumnType\"]').attr('content');\r\n                    } else {\r\n                        // 缺省：来源为杭州市政府网\r\n                        item.description = $('.article').html();\r\n                        item.author = $('meta[name=\"ContentSource\"]').attr('content');\r\n                        item.category = $('meta[name=\"ColumnType\"]').attr('content');\r\n                    }\r\n                }\r\n                item.pubDate = $('meta[name=\"PubDate\"]').length ? timezone(parseDate($('meta[name=\"PubDate\"]').attr('content') as string, 'YYYY-MM-DD HH:mm'), 8) : item.pubDate;\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    await browser.close();\r\n    return {\r\n        allowEmpty: true,\r\n        title: '杭州市人民政府-政务服务公开',\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"opBAEA,eAAA,EAAA,EAAA,EAAA,CACI,GAAA,8BAoBI,OAjBA,MAAA,EAAA,uBAAA,IACA,EAAA,GAAA,UAAA,GAAA,wBAEI,8EAMJ,MAAA,EAAA,KAAA,EAAA,KAAA,yCAKA,MAAA,EAAA,SAAA,GAAA,SAAA,cAAA,GAAA,QAAA,mCACA,MAAA,EAAA,gBAAA,6CAAA,CAAA,QAAA,MACA,EAAA,MAAA,EAAA,UACA,GAAA,YAGA,OADA,EAAA,MAAA,0CAAA,GACA,IAIR,SAAA,EAAA,EAAA,CACI,MAAA,stGClBJ,MAAa,EAAe,CACxB,KAAM,iBACN,WAAY,CAAC,cACb,QAAS,qBACT,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,+CAGjB,KAAM,SACN,YAAa,CAAC,YACd,UACA,IAAK,6CAGT,eAAe,GAAU,CACrB,IAAM,EAAO,wDACP,EAAW,MAAM,EAAO,GAExB,EAAU,MAAM,IAEhB,EAAY,EACb,QAAQ,2BAA4B,IACpC,QAAQ,aAAa,IACrB,WAAW,cAAe,IAC1B,WAAW,eAAgB,IAC3B,WAAW,WAAY,IACvB,WAAW,YAAa,IACxB,WAAW,YAAa,IACxB,WAAW,MAAO,IACjB,EAAI,EAAK,GAET,EAAO,EAAE,eACV,UACA,IAAK,GAAc,CAChB,EAAO,EAAE,GACT,IAAM,EAAQ,EAAK,KAAK,KAAK,QAAQ,OAC/B,EAAO,EAAS,EAAU,EAAK,KAAK,QAAQ,QAAQ,OAAQ,cAAe,GAC3E,EAAI,EAAK,KAAK,KAAK,QAAQ,KAAK,QAChC,EAAU,IAAI,IAAI,EAAG,GAAM,KAEjC,MAAO,CACH,QACA,KAAM,EACN,QAAS,KAGhB,OAAQ,GAAS,CAAC,EAAK,MAAM,SAAS,OACrC,EAAa,MAAM,QAAQ,IAC7B,EAAK,IAAK,GACN,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAO,IAAI,IAAI,EAAK,MAAM,SAChC,GAAI,IAAS,oBAAqB,CAE9B,IAAM,EAAU,MAAM,EAAQ,EAAM,GAC9B,EAAI,EAAK,GACf,EAAK,YAAc,EAAI,EAAA,QAAA,EAAA,+BAA+C,EAAS,EAAE,8BACjF,EAAK,OAAS,UACd,EAAK,SAAW,EAAE,2BAA2B,KAAK,eAC/C,CAEH,IAAM,EAAW,MAAM,EAAI,EAAK,MAC1B,EAAI,EAAK,EAAS,MACpB,IAAS,0BAET,EAAK,YAAc,EAAE,gCAAgC,OACrD,EAAK,OAAS,EAAE,8BAA8B,KAAK,WACnD,EAAK,SAAW,EAAE,2BAA2B,KAAK,aAGlD,EAAK,YAAc,EAAE,YAAY,OACjC,EAAK,OAAS,EAAE,8BAA8B,KAAK,WACnD,EAAK,SAAW,EAAE,2BAA2B,KAAK,YAI1D,MADA,GAAK,QAAU,EAAE,wBAAwB,OAAS,EAAS,EAAU,EAAE,wBAAwB,KAAK,WAAsB,oBAAqB,GAAK,EAAK,QAClJ,MAMnB,OADA,MAAM,EAAQ,QACP,CACH,WAAY,GACZ,MAAO,iBACP,6DACA,KAAM"}