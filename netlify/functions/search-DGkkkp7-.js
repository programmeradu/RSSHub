import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{art as n}from"./render-CxhTJIsl.js";import{invalid_parameter_default as r}from"./invalid-parameter-CUJdROXf.js";import i from"node:path";import a from"query-string";import{GenreNotation as o,NarouNovelFetch as s,R18Site as c,SearchBuilder as l,SearchBuilderR18 as u}from"narou";t();let d=function(e){return e.YOMOU=`yomou`,e.NOCTURNE=`noc`,e.MOONLIGHT=`mnlt`,e.MIDNIGHT=`mid`,e}({});const f={[d.YOMOU]:`小説を読もう`,[d.NOCTURNE]:`ノクターン`,[d.MOONLIGHT]:`ムーンライト`,[d.MIDNIGHT]:`ミッドナイト`},p={path:`/search/:sub/:query`,categories:[`reading`],example:`/syosetu/search/noc/word=ハーレム&notword=&type=r&mintime=&maxtime=&minlen=30000&maxlen=&min_globalpoint=&max_globalpoint=&minlastup=&maxlastup=&minfirstup=&maxfirstup=&isgl=1&notbl=1&order=new?limit=5`,parameters:{sub:{description:`The target Syosetu subsite.`,options:Object.entries(d).map(([,e])=>({value:e,label:f[e]}))},query:`Search parameters in Syosetu format.`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Search`,maintainers:[`SnowAgar25`],handler:v},m=e=>e??void 0;function h(e,t){let n=a.parse(e),r={gzip:5,lim:t};return r.word=m(n.word),r.notword=m(n.notword),r.title=m(n.title),r.ex=m(n.ex),r.keyword=m(n.keyword),r.wname=m(n.wname),r.sasie=m(n.sasie),r.iszankoku=m(n.iszankoku),r.isbl=m(n.isbl),r.isgl=m(n.isgl),r.istensei=m(n.istensei),r.istenni=m(n.istenni),r.stop=m(n.stop),r.notzankoku=m(n.notzankoku),r.notbl=m(n.notbl),r.notgl=m(n.notgl),r.nottensei=m(n.nottensei),r.nottenni=m(n.nottenni),r.minlen=m(n.minlen),r.maxlen=m(n.maxlen),r.type=m(n.type),r.order=m(n.order),r.genre=m(n.genre),r.nocgenre=m(n.nocgenre),(n.mintime||n.maxtime)&&(r.time=`${n.mintime||``}-${n.maxtime||``}`),r}const g=e=>e===d.YOMOU;function _(e,t){if(g(e))return new l(t,new s);let n={...t};switch(e){case d.NOCTURNE:n.nocgenre=c.Nocturne;break;case d.MOONLIGHT:n.nocgenre||(n.nocgenre=[c.MoonLight,c.MoonLightBL].join(`-`));break;case d.MIDNIGHT:n.nocgenre=c.Midnight;break;default:throw new r(`Invalid Syosetu subsite.
Valid subsites are: yomou, noc, mnlt, mid`)}return new u(n,new s)}async function v(t){let{sub:r,query:a}=t.req.param(),s=`https://${r}.syosetu.com/search/search/search.php?${a}`,c=Math.min(Number(t.req.query(`limit`)??40),40),l=h(a,c),u=_(r,l),d=await u.execute(),f=d.values.map(t=>({title:t.title,link:`https://${g(r)?`ncode`:`novel18`}.syosetu.com/${String(t.ncode).toLowerCase()}`,description:n(i.join(e,`templates/description-d8029fe4.art`),{novel:t,genreText:o[t.genre]}),author:t.writer,category:t.keyword.split(/[\s/\uFF0F]/).filter(Boolean)})),p=[];return l.word&&p.push(l.word),l.notword&&p.push(`-${l.notword}`),{title:p.length>0?`Syosetu Search: ${p.join(` `)}`:`Syosetu Search`,link:s,item:f}}export{p as route};
//# sourceMappingURL=search-DGkkkp7-.js.map