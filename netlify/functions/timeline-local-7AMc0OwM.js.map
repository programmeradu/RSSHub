{"version":3,"file":"timeline-local-7AMc0OwM.js","names":["route: Route","utils","ConfigNotFoundError","got"],"sources":["../../lib/routes/mastodon/timeline-local.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport got from '@/utils/got';\r\nimport utils from './utils';\r\nimport { config } from '@/config';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nexport const route: Route = {\r\n    path: '/timeline/:site/:only_media?',\r\n    categories: ['social-media'],\r\n    view: ViewType.SocialMedia,\r\n    example: '/mastodon/timeline/pawoo.net/true',\r\n    parameters: {\r\n        site: 'instance address, only domain, no `http://` or `https://` protocol header',\r\n        only_media: {\r\n            description: 'whether only display media content, default to false, any value to true',\r\n            options: [\r\n                { value: 'true', label: 'true' },\r\n                { value: 'false', label: 'false' },\r\n            ],\r\n            default: 'false',\r\n        },\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Instance timeline (local)',\r\n    maintainers: ['hoilc'],\r\n    handler,\r\n    description: `If the instance address is not \\`mastodon.social\\` or \\`pawoo.net\\`, then the route requires \\`ALLOW_USER_SUPPLY_UNSAFE_DOMAIN\\` to be \\`true\\`.`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const site = ctx.req.param('site');\r\n    const only_media = ctx.req.param('only_media') === 'true' ? 'true' : 'false';\r\n    if (!config.feature.allow_user_supply_unsafe_domain && !utils.allowSiteList.includes(site)) {\r\n        throw new ConfigNotFoundError(`This RSS is disabled unless 'ALLOW_USER_SUPPLY_UNSAFE_DOMAIN' is set to 'true'.`);\r\n    }\r\n\r\n    const url = `http://${site}/api/v1/timelines/public?local=true&only_media=${only_media}`;\r\n\r\n    const response = await got.get(url, { headers: utils.apiHeaders(site) });\r\n    const list = response.data;\r\n\r\n    return {\r\n        title: `Local Public${ctx.req.param('only_media') === 'true' ? ' Media' : ''} Timeline on ${site}`,\r\n        link: `https://${site}`,\r\n        item: utils.parseStatuses(list),\r\n    };\r\n}\r\n"],"mappings":"2dAMA,MAAaA,EAAe,CACxB,KAAM,+BACN,WAAY,CAAC,gBACb,KAAM,EAAS,YACf,QAAS,oCACT,WAAY,CACR,KAAM,4EACN,WAAY,CACR,YAAa,0EACb,QAAS,CACL,CAAE,MAAO,OAAQ,MAAO,QACxB,CAAE,MAAO,QAAS,MAAO,UAE7B,QAAS,UAGjB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,4BACN,YAAa,CAAC,SACd,UACA,YAAa,4IAGjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAa,EAAI,IAAI,MAAM,gBAAkB,OAAS,OAAS,QACrE,GAAI,CAAC,EAAO,QAAQ,iCAAmC,CAACC,EAAM,cAAc,SAAS,GACjF,MAAM,IAAIC,EAAoB,mFAGlC,IAAM,EAAM,UAAU,EAAK,iDAAiD,IAEtE,EAAW,MAAMC,EAAI,IAAI,EAAK,CAAE,QAASF,EAAM,WAAW,KAC1D,EAAO,EAAS,KAEtB,MAAO,CACH,MAAO,eAAe,EAAI,IAAI,MAAM,gBAAkB,OAAS,SAAW,GAAG,eAAe,IAC5F,KAAM,WAAW,IACjB,KAAMA,EAAM,cAAc"}