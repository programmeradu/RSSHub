{"version":3,"file":"top-BlE-84Lh.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/misskon/top.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { getPosts } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/top/:k',\r\n    categories: ['picture'],\r\n    example: '/misskon/top/60',\r\n    parameters: { k: 'Top k days, can be 3, 7, 30 or 60' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            title: 'Top 3 days',\r\n            source: ['misskon.com/top3/'],\r\n            target: '/top/3',\r\n        },\r\n        {\r\n            title: 'Top 7 days',\r\n            source: ['misskon.com/top7/'],\r\n            target: '/top/7',\r\n        },\r\n        {\r\n            title: 'Top 30 days',\r\n            source: ['misskon.com/top30/'],\r\n            target: '/top/30',\r\n        },\r\n        {\r\n            title: 'Top 60 days',\r\n            source: ['misskon.com/top60/'],\r\n            target: '/top/60',\r\n        },\r\n    ],\r\n    name: 'Top k days',\r\n    maintainers: ['Urabartin'],\r\n    handler: async (ctx) => {\r\n        const { k } = ctx.req.param();\r\n        if (!['3', '7', '30', '60'].includes(k)) {\r\n            throw new Error(`Invalid k: k=${k}`);\r\n        }\r\n        const topLink = `https://misskon.com/top${k}/`;\r\n        const response = await ofetch(topLink);\r\n        const $ = load(response);\r\n\r\n        const feedTitle = $('.page-title').text();\r\n        const feedDesc = $('.content > p').first().text();\r\n        const itemSlugs = $('#main-content article.item-list > h2 a')\r\n            .toArray()\r\n            .map((link) => new URL($(link).attr('href') || '').pathname.slice(1, -1));\r\n        const searchParams = new URLSearchParams();\r\n        searchParams.set('slug', itemSlugs.join(','));\r\n        searchParams.set('per_page', itemSlugs.length.toString());\r\n        return {\r\n            title: `MissKON - ${feedTitle}`,\r\n            link: topLink,\r\n            description: feedDesc,\r\n            item: await getPosts(searchParams),\r\n        };\r\n    },\r\n};\r\n"],"mappings":"yTAKA,MAAaA,EAAe,CACxB,KAAM,UACN,WAAY,CAAC,WACb,QAAS,kBACT,WAAY,CAAE,EAAG,qCACjB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,MAAO,aACP,OAAQ,CAAC,qBACT,OAAQ,UAEZ,CACI,MAAO,aACP,OAAQ,CAAC,qBACT,OAAQ,UAEZ,CACI,MAAO,cACP,OAAQ,CAAC,sBACT,OAAQ,WAEZ,CACI,MAAO,cACP,OAAQ,CAAC,sBACT,OAAQ,YAGhB,KAAM,aACN,YAAa,CAAC,aACd,QAAS,KAAO,IAAQ,CACpB,GAAM,CAAE,KAAM,EAAI,IAAI,QACtB,GAAI,CAAC,CAAC,IAAK,IAAK,KAAM,MAAM,SAAS,GACjC,MAAU,MAAM,gBAAgB,KAEpC,IAAM,EAAU,0BAA0B,EAAE,GACtC,EAAW,MAAMC,EAAO,GACxB,EAAI,EAAK,GAET,EAAY,EAAE,eAAe,OAC7B,EAAW,EAAE,gBAAgB,QAAQ,OACrC,EAAY,EAAE,0CACf,UACA,IAAK,GAAS,IAAI,IAAI,EAAE,GAAM,KAAK,SAAW,IAAI,SAAS,MAAM,EAAG,KACnE,EAAe,IAAI,gBAGzB,OAFA,EAAa,IAAI,OAAQ,EAAU,KAAK,MACxC,EAAa,IAAI,WAAY,EAAU,OAAO,YACvC,CACH,MAAO,aAAa,IACpB,KAAM,EACN,YAAa,EACb,KAAM,MAAM,EAAS"}