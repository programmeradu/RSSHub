{"version":3,"file":"post-DVSc3bsx.js","names":["route: Route","got"],"sources":["../../lib/routes/zhibo8/post.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/post/:id',\r\n    categories: ['bbs'],\r\n    example: '/zhibo8/post/3050708',\r\n    parameters: { id: '帖子 id，可在帖子 URL 找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '回帖',\r\n    maintainers: ['LogicJake'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const link = `https://bbs.zhibo8.cc/forum/topic?tid=${id}`;\r\n\r\n    const response = await got(link);\r\n    const $ = load(response.data);\r\n\r\n    const title = $('div.topic-title > h1').text();\r\n    const list = $('.topic-content .topic-table');\r\n\r\n    const out = list.toArray().map((item) => {\r\n        item = $(item);\r\n        const author = item.find('.topic-left > div > a').text();\r\n        const floor = item.find('p.topic-foot span:nth-child(2)').text();\r\n        const description = item.find('.detail_ent').html().replaceAll('src=\"', 'src=\"https:');\r\n        const pubDate = timezone(\r\n            parseDate(\r\n                item\r\n                    .find('p.topic-foot')\r\n                    .text()\r\n                    .match(/\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}/)[0],\r\n                'YYYY-MM-DD HH:mm'\r\n            ),\r\n            +8\r\n        );\r\n\r\n        const single = {\r\n            title: `${floor}：${author}发表了新回复`,\r\n            author,\r\n            description,\r\n            link,\r\n            pubDate,\r\n            guid: `zhibo8:post:${id}:${floor}`,\r\n        };\r\n\r\n        return single;\r\n    });\r\n\r\n    return {\r\n        title: `“${title}”的新回复—直播吧`,\r\n        link,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"sWAMA,MAAaA,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,OACb,QAAS,uBACT,WAAY,CAAE,GAAI,qBAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,aACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAO,yCAAyC,IAEhD,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAQ,EAAE,wBAAwB,OAClC,EAAO,EAAE,+BAET,EAAM,EAAK,UAAU,IAAK,GAAS,CACrC,EAAO,EAAE,GACT,IAAM,EAAS,EAAK,KAAK,yBAAyB,OAC5C,EAAQ,EAAK,KAAK,kCAAkC,OACpD,EAAc,EAAK,KAAK,eAAe,OAAO,WAAW,QAAS,eAClE,EAAU,EACZ,EACI,EACK,KAAK,gBACL,OACA,MAAM,iCAAiC,GAC5C,oBAEJ,GAGE,EAAS,CACX,MAAO,GAAG,EAAM,GAAG,EAAO,QAC1B,SACA,cACA,OACA,UACA,KAAM,eAAe,EAAG,GAAG,KAG/B,OAAO,IAGX,MAAO,CACH,MAAO,IAAI,EAAM,WACjB,OACA,KAAM"}