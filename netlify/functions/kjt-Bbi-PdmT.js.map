{"version":3,"file":"kjt-Bbi-PdmT.js","names":["got","cache","route: Route"],"sources":["../../lib/routes/gov/ah/kjt.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = 'kjzx/tzgg' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n\r\n    const rootUrl = 'https://kjt.ah.gov.cn';\r\n    const currentUrl = new URL(`${category.replace(/\\/$/, '').replace(/\\/index\\.html$/, '')}/`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('ul.doc_list li')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('a');\r\n\r\n            const title = a.prop('title') ?? a.text();\r\n\r\n            return {\r\n                title,\r\n                pubDate: parseDate(item.find('span.date').text()),\r\n                link: a.prop('href'),\r\n                language,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const description = $$('div.wzcon').html();\r\n\r\n                item.title = $$('meta[name=\"ArticleTitle\"]').prop('content');\r\n                item.description = description;\r\n                item.pubDate = timezone(parseDate($$('meta[name=\"PubDate\"]').prop('content')), +8);\r\n                item.category = [\r\n                    ...new Set([\r\n                        $$('meta[name=\"ColumnName\"]').prop('content'),\r\n                        $$('meta[name=\"ColumnType\"]').prop('content'),\r\n                        $$('meta[name=\"ColumnKeywords\"]').prop('content'),\r\n                        $$('meta[name=\"ContentSource\"]').prop('content'),\r\n                        $$('meta[name=\"ContentSource\"]').prop('content'),\r\n                    ]),\r\n                ].filter(Boolean);\r\n                item.author = $$('meta[name=\"Author\"]').prop('content');\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.wzcon').text(),\r\n                };\r\n                item.updated = timezone(parseDate($$('meta[name=\"HtmlGenerateTime\"]').prop('content')), +8);\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const author = $('meta[name=\"SiteName\"]').prop('content');\r\n    const image = $('span.img_title').first().prev().prop('src');\r\n\r\n    return {\r\n        title: `${author} - ${$('meta[name=\"ColumnName\"]').prop('content')}`,\r\n        description: $('meta[name=\"ColumnDescription\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author,\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/ah/kjt/:category{.+}?',\r\n    name: '安徽省科学技术厅',\r\n    url: 'kjt.ah.gov.cn',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/gov/ah/kjt',\r\n    parameters: { category: '分类，默认为 `kjzx/tzgg`，即通知公告，可在对应分类页 URL 中找到' },\r\n    description: `::: tip\r\n  若订阅 [通知公告](https://kjt.ah.gov.cn/kjzx/tzgg/)，网址为 \\`https://kjt.ah.gov.cn/kjzx/tzgg/\\`。截取 \\`https://kjt.ah.gov.cn/\\` 到末尾 \\`/\\` 的部分 \\`\\` 作为参数填入，此时路由为 [\\`/gov/ah/kjt/kjzx/tzgg\\`](https://rsshub.app/gov/ah/kjt/kjzx/tzgg)。\r\n:::\r\n\r\n#### [科技资讯](https://kjt.ah.gov.cn/kjzx/index.html)\r\n\r\n| [通知公告](https://kjt.ah.gov.cn/kjzx/tzgg/index.html) | [工作动态](https://kjt.ah.gov.cn/kjzx/gzdt/index.html) | [基层科技](https://kjt.ah.gov.cn/kjzx/jckj/index.html) | [媒体聚焦](https://kjt.ah.gov.cn/kjzx/mtjj/index.html) |\r\n| ------------------------------------------------------ | ------------------------------------------------------ | ------------------------------------------------------ | ------------------------------------------------------ |\r\n| [kjzx/tzgg](https://rsshub.app/gov/ah/kjt/kjzx/tzgg)   | [kjzx/gzdt](https://rsshub.app/gov/ah/kjt/kjzx/gzdt)   | [kjzx/jckj](https://rsshub.app/gov/ah/kjt/kjzx/jckj)   | [kjzx/mtjj](https://rsshub.app/gov/ah/kjt/kjzx/mtjj)   |\r\n  \r\n| [重要转载](https://kjt.ah.gov.cn/kjzx/zyzz/index.html) | [图片视频](https://kjt.ah.gov.cn/kjzx/tpsp/index.html) |\r\n| ------------------------------------------------------ | ------------------------------------------------------ |\r\n| [kjzx/zyzz](https://rsshub.app/gov/ah/kjt/kjzx/zyzz)   | [kjzx/tpsp](https://rsshub.app/gov/ah/kjt/kjzx/tpsp)   |\r\n\r\n#### [科技统计](https://kjt.ah.gov.cn/kjzy/kjtj/index.html)\r\n\r\n| [技术市场交易](https://kjt.ah.gov.cn/kjzy/kjtj/jsscjy/index.html)  | [科技成果公报](https://kjt.ah.gov.cn/kjzy/kjtj/kjcggb/index.html)  | [孵化载体发展](https://kjt.ah.gov.cn/kjzy/kjtj/cyfhfz/index.html)  |\r\n| ------------------------------------------------------------------ | ------------------------------------------------------------------ | ------------------------------------------------------------------ |\r\n| [kjzy/kjtj/jsscjy](https://rsshub.app/gov/ah/kjt/kjzy/kjtj/jsscjy) | [kjzy/kjtj/kjcggb](https://rsshub.app/gov/ah/kjt/kjzy/kjtj/kjcggb) | [kjzy/kjtj/cyfhfz](https://rsshub.app/gov/ah/kjt/kjzy/kjtj/cyfhfz) |\r\n\r\n#### [科技数据](https://kjt.ah.gov.cn/kjzy/kjsj/index.html)\r\n\r\n| [创新企业](https://kjt.ah.gov.cn/kjzy/kjsj/cxqy/index.html)    | [创新项目](https://kjt.ah.gov.cn/kjzy/kjsj/cxxm/index.html)    | [创新成果](https://kjt.ah.gov.cn/kjzy/kjsj/cxcg/index.html)    | [转化基金入库项目](https://kjt.ah.gov.cn/kjzy/kjsj/zhjjrkxm/index.html) |\r\n| -------------------------------------------------------------- | -------------------------------------------------------------- | -------------------------------------------------------------- | ----------------------------------------------------------------------- |\r\n| [kjzy/kjsj/cxqy](https://rsshub.app/gov/ah/kjt/kjzy/kjsj/cxqy) | [kjzy/kjsj/cxxm](https://rsshub.app/gov/ah/kjt/kjzy/kjsj/cxxm) | [kjzy/kjsj/cxcg](https://rsshub.app/gov/ah/kjt/kjzy/kjsj/cxcg) | [kjzy/kjsj/zhjjrkxm](https://rsshub.app/gov/ah/kjt/kjzy/kjsj/zhjjrkxm)  |\r\n\r\n| [创新平台](https://kjt.ah.gov.cn/kjzy/kjsj/cxpt/index.html)    | [创新园区](https://kjt.ah.gov.cn/kjzy/kjsj/cxyq/index.html)    | [创新许可](https://kjt.ah.gov.cn/kjzy/kjsj/cxxk/index.html)    |\r\n| -------------------------------------------------------------- | -------------------------------------------------------------- | -------------------------------------------------------------- |\r\n| [kjzy/kjsj/cxpt](https://rsshub.app/gov/ah/kjt/kjzy/kjsj/cxpt) | [kjzy/kjsj/cxyq](https://rsshub.app/gov/ah/kjt/kjzy/kjsj/cxyq) | [kjzy/kjsj/cxxk](https://rsshub.app/gov/ah/kjt/kjzy/kjsj/cxxk) |\r\n\r\n  `,\r\n    categories: ['government'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['kjt.ah.gov.cn/:category'],\r\n            target: (params) => {\r\n                const category = params.category;\r\n\r\n                return `/gov/ah/kjt${category ? `/${category}` : ''}`;\r\n            },\r\n        },\r\n        {\r\n            title: '科技资讯 - 通知公告',\r\n            source: ['kjt.ah.gov.cn/kjzx/tzgg/index.html'],\r\n            target: '/ah/kjt/kjzx/tzgg',\r\n        },\r\n        {\r\n            title: '科技资讯 - 工作动态',\r\n            source: ['kjt.ah.gov.cn/kjzx/gzdt/index.html'],\r\n            target: '/ah/kjt/kjzx/gzdt',\r\n        },\r\n        {\r\n            title: '科技资讯 - 基层科技',\r\n            source: ['kjt.ah.gov.cn/kjzx/jckj/index.html'],\r\n            target: '/ah/kjt/kjzx/jckj',\r\n        },\r\n        {\r\n            title: '科技资讯 - 媒体聚焦',\r\n            source: ['kjt.ah.gov.cn/kjzx/mtjj/index.html'],\r\n            target: '/ah/kjt/kjzx/mtjj',\r\n        },\r\n        {\r\n            title: '科技资讯 - 重要转载',\r\n            source: ['kjt.ah.gov.cn/kjzx/zyzz/index.html'],\r\n            target: '/ah/kjt/kjzx/zyzz',\r\n        },\r\n        {\r\n            title: '科技资讯 - 图片视频',\r\n            source: ['kjt.ah.gov.cn/kjzx/tpsp/index.html'],\r\n            target: '/ah/kjt/kjzx/tpsp',\r\n        },\r\n        {\r\n            title: '科技统计 - 技术市场交易',\r\n            source: ['kjt.ah.gov.cn/kjzy/kjtj/jsscjy/index.html'],\r\n            target: '/ah/kjt/kjzy/kjtj/jsscjy',\r\n        },\r\n        {\r\n            title: '科技统计 - 科技成果公报',\r\n            source: ['kjt.ah.gov.cn/kjzy/kjtj/kjcggb/index.html'],\r\n            target: '/ah/kjt/kjzy/kjtj/kjcggb',\r\n        },\r\n        {\r\n            title: '科技统计 - 孵化载体发展',\r\n            source: ['kjt.ah.gov.cn/kjzy/kjtj/cyfhfz/index.html'],\r\n            target: '/ah/kjt/kjzy/kjtj/cyfhfz',\r\n        },\r\n        {\r\n            title: '科技数据 - 创新企业',\r\n            source: ['kjt.ah.gov.cn/kjzy/kjsj/cxqy/index.html'],\r\n            target: '/ah/kjt/kjzy/kjsj/cxqy',\r\n        },\r\n        {\r\n            title: '科技数据 - 创新项目',\r\n            source: ['kjt.ah.gov.cn/kjzy/kjsj/cxxm/index.html'],\r\n            target: '/ah/kjt/kjzy/kjsj/cxxm',\r\n        },\r\n        {\r\n            title: '科技数据 - 创新成果',\r\n            source: ['kjt.ah.gov.cn/kjzy/kjsj/cxcg/index.html'],\r\n            target: '/ah/kjt/kjzy/kjsj/cxcg',\r\n        },\r\n        {\r\n            title: '科技数据 - 转化基金入库项目',\r\n            source: ['kjt.ah.gov.cn/kjzy/kjsj/zhjjrkxm/index.html'],\r\n            target: '/ah/kjt/kjzy/kjsj/zhjjrkxm',\r\n        },\r\n        {\r\n            title: '科技数据 - 创新平台',\r\n            source: ['kjt.ah.gov.cn/kjzy/kjsj/cxpt/index.html'],\r\n            target: '/ah/kjt/kjzy/kjsj/cxpt',\r\n        },\r\n        {\r\n            title: '科技数据 - 创新园区',\r\n            source: ['kjt.ah.gov.cn/kjzy/kjsj/cxyq/index.html'],\r\n            target: '/ah/kjt/kjzy/kjsj/cxyq',\r\n        },\r\n        {\r\n            title: '科技数据 - 创新许可',\r\n            source: ['kjt.ah.gov.cn/kjzy/kjsj/cxxk/index.html'],\r\n            target: '/ah/kjt/kjzy/kjsj/cxxk',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}