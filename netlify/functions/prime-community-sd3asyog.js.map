{"version":3,"file":"prime-community-sd3asyog.js","names":["route: Route","cache","ofetch","response"],"sources":["../../lib/routes/sspai/prime-community.ts"],"sourcesContent":["import { config } from '@/config';\r\nimport { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nexport const route: Route = {\r\n    path: '/prime/community',\r\n    categories: ['new-media'],\r\n    example: '/sspai/prime/community',\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'SSPAI_BEARERTOKEN',\r\n                optional: false,\r\n                description: `少数派会员账号认证 token。获取方式：登陆后打开少数派会员社区界面，打开浏览器开发者工具中 “网络”(Network) 选项卡，筛选 URL 找到任一个地址为 \\`sspai.com/api\\` 开头的请求，点击检查其 “消息头”，在 “请求头” 中找到Authorization字段，将其值复制填入配置即可。你的配置应该形如 \\`SSPAI_BEARERTOKEN: 'Bearer eyJxxxx......xx_U8'\\`。`,\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['sspai.com/community'],\r\n        },\r\n    ],\r\n    name: '会员社区',\r\n    maintainers: ['mintyfrankie'],\r\n    handler,\r\n};\r\n\r\nconst TOKEN = 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjcyNzU3NiIsInR5cGUiOiJ1c2VyIiwiZXhwIjoxNzQ4NTI2MDEzfQ.di8RB-lxHI_JMBQHFd2xhcpk6Zd_3bvfQlAti6HAuZA';\r\n\r\nasync function handler() {\r\n    let token;\r\n    const cacheIn = await cache.get('sspai:token');\r\n\r\n    if (cacheIn) {\r\n        token = cacheIn;\r\n    } else if (config.sspai.bearertoken) {\r\n        token = config.sspai.bearertoken;\r\n        cache.set('sspai:token', config.sspai.bearertoken);\r\n    } else {\r\n        token = TOKEN;\r\n    }\r\n\r\n    const feedEndpoint = 'https://sspai.com/api/v1/community/page/get';\r\n    const headers = {\r\n        Authorization: token,\r\n    };\r\n\r\n    const response = await ofetch(feedEndpoint, { headers });\r\n    const list = response.data.map((item) => ({\r\n        title: item.title,\r\n        link: `https://sspai.com/t/${item.id_hash}`,\r\n        pubDate: new Date(item.created_at * 1000),\r\n        author: item.author.nickname,\r\n        category: item.channel.title,\r\n        id_hash: item.id_hash,\r\n    }));\r\n\r\n    // FIXME: TypeError: Cannot read properties of null (reading 'body')\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const postEndpoint = `https://sspai.com/api/v1/community/topic/single/info/get?id_hash=${item.id_hash}`;\r\n                const response = await ofetch(postEndpoint, { headers });\r\n                item.description = response.data.body || 'No content';\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '少数派会员社区',\r\n        link: 'https://sspai.com/community',\r\n        lang: 'zh-CN',\r\n        description: '少数派会员社区',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"gPAKA,MAAaA,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,aACb,QAAS,yBACT,SAAU,CACN,cAAe,CACX,CACI,KAAM,oBACN,SAAU,GACV,YAAa,0NAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,yBAGjB,KAAM,OACN,YAAa,CAAC,gBACd,WAKJ,eAAe,GAAU,CACrB,IAAI,EACE,EAAU,MAAMC,EAAM,IAAI,eAE5B,EACA,EAAQ,EACD,EAAO,MAAM,aACpB,EAAQ,EAAO,MAAM,YACrB,EAAM,IAAI,cAAe,EAAO,MAAM,cAEtC,EAAQ,yJAGZ,IACM,EAAU,CACZ,cAAe,GAGb,EAAW,MAAMC,EAAO,8CAAc,CAAE,YACxC,EAAO,EAAS,KAAK,IAAK,IAAU,CACtC,MAAO,EAAK,MACZ,KAAM,uBAAuB,EAAK,UAClC,QAAS,IAAI,KAAK,EAAK,WAAa,KACpC,OAAQ,EAAK,OAAO,SACpB,SAAU,EAAK,QAAQ,MACvB,QAAS,EAAK,WAIZ,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACND,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAe,oEAAoE,EAAK,UACxFE,EAAW,MAAMD,EAAO,EAAc,CAAE,YAE9C,MADA,GAAK,YAAcC,EAAS,KAAK,MAAQ,aAClC,MAKnB,MAAO,CACH,MAAO,UACP,KAAM,8BACN,KAAM,QACN,YAAa,UACb,KAAM"}