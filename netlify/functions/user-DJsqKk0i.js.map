{"version":3,"file":"user-DJsqKk0i.js","names":["got","route: Route","ConfigNotFoundError","cache","pixivUtils"],"sources":["../../lib/routes/pixiv/api/get-illusts.ts","../../lib/routes/pixiv/user.ts"],"sourcesContent":["import got from '../pixiv-got';\r\nimport { maskHeader } from '../constants';\r\nimport queryString from 'query-string';\r\n\r\n/**\r\n * 获取用户插画作品\r\n * @param {string} user_id 目标用户id\r\n * @param {string} token pixiv oauth token\r\n * @returns {Promise<got.AxiosResponse<{illusts: illust[]}>>}\r\n */\r\nexport default function getIllusts(user_id, token) {\r\n    return got('https://app-api.pixiv.net/v1/user/illusts', {\r\n        headers: {\r\n            ...maskHeader,\r\n            Authorization: 'Bearer ' + token,\r\n        },\r\n        searchParams: queryString.stringify({\r\n            user_id,\r\n            filter: 'for_ios',\r\n        }),\r\n    });\r\n}\r\n","import { Route, ViewType } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { getToken } from './token';\r\nimport getIllusts from './api/get-illusts';\r\nimport { config } from '@/config';\r\nimport pixivUtils from './utils';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nexport const route: Route = {\r\n    path: '/user/:id',\r\n    categories: ['social-media'],\r\n    view: ViewType.Pictures,\r\n    example: '/pixiv/user/15288095',\r\n    parameters: { id: \"user id, available in user's homepage URL\" },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.pixiv.net/users/:id', 'www.pixiv.net/en/users/:id'],\r\n        },\r\n    ],\r\n    name: 'User Activity',\r\n    maintainers: ['DIYgod'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    if (!config.pixiv || !config.pixiv.refreshToken) {\r\n        throw new ConfigNotFoundError('pixiv RSS is disabled due to the lack of <a href=\"https://docs.rsshub.app/deploy/config#route-specific-configurations\">relevant config</a>');\r\n    }\r\n\r\n    const id = ctx.req.param('id');\r\n    const token = await getToken(cache.tryGet);\r\n    if (!token) {\r\n        throw new ConfigNotFoundError('pixiv not login');\r\n    }\r\n\r\n    const response = await getIllusts(id, token);\r\n\r\n    const illusts = response.data.illusts;\r\n    const username = illusts[0].user.name;\r\n\r\n    return {\r\n        title: `${username} 的 pixiv 动态`,\r\n        link: `https://www.pixiv.net/users/${id}`,\r\n        image: pixivUtils.getProxiedImageUrl(illusts[0].user.profile_image_urls.medium),\r\n        description: `${username} 的 pixiv 最新动态`,\r\n        item: illusts.map((illust) => {\r\n            const images = pixivUtils.getImgs(illust);\r\n            return {\r\n                title: illust.title,\r\n                author: username,\r\n                pubDate: parseDate(illust.create_date),\r\n                description: `${illust.caption}<br><p>画师：${username} - 阅览数：${illust.total_view} - 收藏数：${illust.total_bookmarks}</p>${images.join('')}`,\r\n                link: `https://www.pixiv.net/artworks/${illust.id}`,\r\n                category: illust.tags.map((t) => t.name),\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"kkBAUA,SAAwB,EAAW,EAAS,EAAO,CAC/C,OAAOA,EAAI,4CAA6C,CACpD,QAAS,CACL,GAAG,EACH,cAAe,UAAY,GAE/B,aAAc,EAAY,UAAU,CAChC,UACA,OAAQ,cCTpB,MAAaC,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,gBACb,KAAM,EAAS,SACf,QAAS,uBACT,WAAY,CAAE,GAAI,6CAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,0BAA2B,gCAG5C,KAAM,gBACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAI,CAAC,EAAO,OAAS,CAAC,EAAO,MAAM,aAC/B,MAAM,IAAIC,EAAoB,8IAGlC,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAQ,MAAM,EAASC,EAAM,QACnC,GAAI,CAAC,EACD,MAAM,IAAID,EAAoB,mBAGlC,IAAM,EAAW,MAAM,EAAW,EAAI,GAEhC,EAAU,EAAS,KAAK,QACxB,EAAW,EAAQ,GAAG,KAAK,KAEjC,MAAO,CACH,MAAO,GAAG,EAAS,aACnB,KAAM,+BAA+B,IACrC,MAAOE,EAAW,mBAAmB,EAAQ,GAAG,KAAK,mBAAmB,QACxE,YAAa,GAAG,EAAS,eACzB,KAAM,EAAQ,IAAK,GAAW,CAC1B,IAAM,EAASA,EAAW,QAAQ,GAClC,MAAO,CACH,MAAO,EAAO,MACd,OAAQ,EACR,QAAS,EAAU,EAAO,aAC1B,YAAa,GAAG,EAAO,QAAQ,YAAY,EAAS,SAAS,EAAO,WAAW,SAAS,EAAO,gBAAgB,MAAM,EAAO,KAAK,MACjI,KAAM,kCAAkC,EAAO,KAC/C,SAAU,EAAO,KAAK,IAAK,GAAM,EAAE"}