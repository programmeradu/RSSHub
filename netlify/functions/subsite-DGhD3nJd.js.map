{"version":3,"file":"subsite-DGhD3nJd.js","names":["route: Route","parser","cache","got","description","utils"],"sources":["../../lib/routes/9to5/utils.ts","../../lib/routes/9to5/subsite.ts"],"sourcesContent":["import { load } from 'cheerio';\r\n\r\nconst ProcessFeed = (data) => {\r\n    const $ = load(data);\r\n    const content = $('div.post-content');\r\n\r\n    const cover = $('meta[property=\"og:image\"]');\r\n    if (cover.length > 0) {\r\n        $(`<img src=${cover[0].attribs.content}>`).insertBefore(content[0].firstChild);\r\n    }\r\n\r\n    // remove useless DOMs\r\n    content.find('hr').nextAll().remove();\r\n\r\n    content.find('hr, ins.adsbygoogle, script').each((i, e) => {\r\n        $(e).remove();\r\n    });\r\n\r\n    // remove ad\r\n    content.find('div.ad-disclaimer-container').remove();\r\n\r\n    content.find('div').each((i, e) => {\r\n        if ($(e)[0].attribs.class) {\r\n            const classes = $(e)[0].attribs.class;\r\n            if (/\\w{10}\\s\\w{10}/g.test(classes)) {\r\n                $(e).remove();\r\n            }\r\n        }\r\n    });\r\n\r\n    return content.html();\r\n};\r\n\r\nexport default { ProcessFeed };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport parser from '@/utils/rss-parser';\r\nimport utils from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/:subsite/:tag?',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let title = '9To5',\r\n        link,\r\n        description;\r\n\r\n    switch (ctx.req.param('subsite')) {\r\n        case 'mac':\r\n            link = 'https://9to5mac.com';\r\n            title += 'Mac';\r\n            description = 'Apple News & Mac Rumors Breaking All Day';\r\n            break;\r\n\r\n        case 'google':\r\n            link = 'https://9to5google.com';\r\n            title += 'Google';\r\n            description = 'Google, Pixel news, Android, Home, Chrome OS, apps, more';\r\n            break;\r\n\r\n        case 'toys':\r\n            link = 'https://9to5toys.com';\r\n            title += 'Toys';\r\n            description = 'New Gear, reviews and deals';\r\n            break;\r\n\r\n        default:\r\n            break;\r\n    }\r\n\r\n    if (ctx.req.param('tag')) {\r\n        link = `${link}/guides/${ctx.req.param('tag')}/feed/`;\r\n        title = `${ctx.req.param('tag')} | ${title}`;\r\n    } else {\r\n        link = `${link}/feed/`;\r\n    }\r\n\r\n    const feed = await parser.parseURL(link);\r\n\r\n    const items = await Promise.all(\r\n        feed.items.splice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 10).map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n                const description = utils.ProcessFeed(response.data);\r\n\r\n                const single = {\r\n                    title: item.title,\r\n                    description,\r\n                    pubDate: item.pubDate,\r\n                    link: item.link,\r\n                    author: item['dc:creator'],\r\n                };\r\n\r\n                return single;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        description,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"iXAEA,MAAM,EAAe,GAAS,CAC1B,IAAM,EAAI,EAAK,GACT,EAAU,EAAE,oBAEZ,EAAQ,EAAE,6BAwBhB,OAvBI,EAAM,OAAS,GACf,EAAE,YAAY,EAAM,GAAG,QAAQ,QAAQ,IAAI,aAAa,EAAQ,GAAG,YAIvE,EAAQ,KAAK,MAAM,UAAU,SAE7B,EAAQ,KAAK,+BAA+B,MAAM,EAAG,IAAM,CACvD,EAAE,GAAG,WAIT,EAAQ,KAAK,+BAA+B,SAE5C,EAAQ,KAAK,OAAO,MAAM,EAAG,IAAM,CAC/B,GAAI,EAAE,GAAG,GAAG,QAAQ,MAAO,CACvB,IAAM,EAAU,EAAE,GAAG,GAAG,QAAQ,MAC5B,kBAAkB,KAAK,IACvB,EAAE,GAAG,YAKV,EAAQ,QAGnB,IAAA,EAAe,CAAE,eC3BjB,MAAaA,EAAe,CACxB,KAAM,kBACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAI,EAAQ,OACR,EACA,EAEJ,OAAQ,EAAI,IAAI,MAAM,WAAtB,CACI,IAAK,MACD,EAAO,sBACP,GAAS,MACT,EAAc,2CACd,MAEJ,IAAK,SACD,EAAO,yBACP,GAAS,SACT,EAAc,2DACd,MAEJ,IAAK,OACD,EAAO,uBACP,GAAS,OACT,EAAc,8BACd,MAEJ,QACI,MAGJ,EAAI,IAAI,MAAM,QACd,EAAO,GAAG,EAAK,UAAU,EAAI,IAAI,MAAM,OAAO,QAC9C,EAAQ,GAAG,EAAI,IAAI,MAAM,OAAO,KAAK,KAErC,EAAO,GAAG,EAAK,QAGnB,IAAM,EAAO,MAAMC,EAAO,SAAS,GAE7B,EAAQ,MAAM,QAAQ,IACxB,EAAK,MAAM,OAAO,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAAI,IAAK,GAC7FC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,EAAK,OAERC,EAAcC,EAAM,YAAY,EAAS,MAEzC,EAAS,CACX,MAAO,EAAK,MACZ,YAAA,EACA,QAAS,EAAK,QACd,KAAM,EAAK,KACX,OAAQ,EAAK,eAGjB,OAAO,MAKnB,MAAO,CACH,QACA,OACA,cACA,KAAM"}