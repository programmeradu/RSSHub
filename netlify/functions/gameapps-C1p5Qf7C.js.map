{"version":3,"file":"gameapps-C1p5Qf7C.js","names":[],"sources":["../../lib/routes/gameapps/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport parser from '@/utils/rss-parser';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    example: '/gameapps',\r\n    radar: [\r\n        {\r\n            source: ['gameapps.hk/'],\r\n        },\r\n    ],\r\n    name: '最新消息',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'gameapps.hk/',\r\n};\r\n\r\nasync function handler() {\r\n    const baseUrl = 'https://www.gameapps.hk';\r\n    const feed = await parser.parseURL(`${baseUrl}/rss`);\r\n\r\n    const items = await Promise.all(\r\n        feed.items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await ofetch(item.link, {\r\n                    headers: {\r\n                        Referer: baseUrl,\r\n                    },\r\n                });\r\n                const $ = load(response);\r\n\r\n                item.title = $('meta[property=\"og:title\"]').attr('content') ?? $('.news-title h1').text();\r\n\r\n                const nextPages = $('.pagination li')\r\n                    .not('.disabled')\r\n                    .not('.active')\r\n                    .find('a')\r\n                    .toArray()\r\n                    .map((a) => `${baseUrl}${a.attribs.href}`);\r\n\r\n                $('.pages').remove();\r\n\r\n                const content = $('.news-content');\r\n\r\n                // remove unwanted key value\r\n                delete item.content;\r\n                delete item.contentSnippet;\r\n                delete item.isoDate;\r\n\r\n                if (nextPages.length) {\r\n                    const pages = await Promise.all(\r\n                        nextPages.map(async (url) => {\r\n                            const response = await ofetch(url, {\r\n                                headers: {\r\n                                    referer: item.link,\r\n                                },\r\n                            });\r\n                            const $ = load(response);\r\n                            $('.pages').remove();\r\n                            return $('.news-content').html();\r\n                        })\r\n                    );\r\n                    content.append(pages);\r\n                }\r\n\r\n                item.description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    intro: $('div.introduction.media.news-intro div.media-body').html()?.trim(),\r\n                    desc: content.html()?.trim(),\r\n                });\r\n                item.guid = item.guid.slice(0, item.link.lastIndexOf('/'));\r\n                item.pubDate = parseDate(item.pubDate);\r\n                item.enclosure_url = $('div.introduction.media.news-intro div.media-left').find('img').attr('src');\r\n                item.enclosure_type = 'image/jpeg';\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: feed.title,\r\n        link: feed.link,\r\n        description: feed.description,\r\n        image: `${baseUrl}/static/favicon/apple-touch-icon.png`,\r\n        item: items,\r\n        language: feed.language,\r\n    };\r\n}\r\n"],"mappings":"ieAUA,MAAa,EAAe,CACxB,KAAM,IACN,QAAS,YACT,MAAO,CACH,CACI,OAAQ,CAAC,kBAGjB,KAAM,OACN,YAAa,CAAC,UACd,UACA,IAAK,gBAGT,eAAe,GAAU,CACrB,IAAM,EAAU,0BACV,EAAO,MAAM,EAAO,SAAS,GAAG,EAAQ,OAExC,EAAQ,MAAM,QAAQ,IACxB,EAAK,MAAM,IAAK,GACZ,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAW,MAAM,EAAO,EAAK,KAAM,CACrC,QAAS,CACL,QAAS,KAGX,EAAI,EAAK,GAEf,EAAK,MAAQ,EAAE,6BAA6B,KAAK,YAAc,EAAE,kBAAkB,OAEnF,IAAM,EAAY,EAAE,kBACf,IAAI,aACJ,IAAI,WACJ,KAAK,KACL,UACA,IAAK,GAAM,GAAG,IAAU,EAAE,QAAQ,QAEvC,EAAE,UAAU,SAEZ,IAAM,EAAU,EAAE,iBAOlB,GAJA,OAAO,EAAK,QACZ,OAAO,EAAK,eACZ,OAAO,EAAK,QAER,EAAU,OAAQ,CAClB,IAAM,EAAQ,MAAM,QAAQ,IACxB,EAAU,IAAI,KAAO,IAAQ,CACzB,IAAM,EAAW,MAAM,EAAO,EAAK,CAC/B,QAAS,CACL,QAAS,EAAK,QAGhB,EAAI,EAAK,GAEf,OADA,EAAE,UAAU,SACL,EAAE,iBAAiB,UAGlC,EAAQ,OAAO,GAYnB,MATA,GAAK,YAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACtE,MAAO,EAAE,oDAAoD,QAAQ,OACrE,KAAM,EAAQ,QAAQ,SAE1B,EAAK,KAAO,EAAK,KAAK,MAAM,EAAG,EAAK,KAAK,YAAY,MACrD,EAAK,QAAU,EAAU,EAAK,SAC9B,EAAK,cAAgB,EAAE,oDAAoD,KAAK,OAAO,KAAK,OAC5F,EAAK,eAAiB,aAEf,MAKnB,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EAAK,KACX,YAAa,EAAK,YAClB,MAAO,GAAG,EAAQ,sCAClB,KAAM,EACN,SAAU,EAAK"}