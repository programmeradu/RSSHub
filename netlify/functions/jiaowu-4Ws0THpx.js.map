{"version":3,"file":"jiaowu-4Ws0THpx.js","names":["ofetch","route: Route","cache","$"],"sources":["../../lib/routes/sicau/jiaowu.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { Language } from '@/routes/kurogames/wutheringwaves/constants';\r\n\r\nconst $get = async (url: string, encoding = 'gb2312') => new TextDecoder(encoding).decode(await ofetch(url, { responseType: 'arrayBuffer' }));\r\nconst $trim = (str: string) => {\r\n    let s = str.trim();\r\n    s = s.startsWith('&nbsp;&nbsp;') ? s.slice(12) : s;\r\n    s = s.endsWith('<br>') ? s.slice(0, Math.max(0, s.length - 4)) : s;\r\n    return s.trim();\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/jiaowu/jxtz/:detail?',\r\n    categories: ['university'],\r\n    example: '/sicau/jiaowu/jxtz/detail',\r\n    parameters: { detail: '是否抓取全文，该值只要不为空就抓取全文返回，否则只返回标题' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['jiaowu.sicau.edu.cn/web/web/web/index.asp'],\r\n            target: '/jiaowu/jxtz',\r\n        },\r\n    ],\r\n    name: '教务处',\r\n    maintainers: ['hualiong'],\r\n    description: `\r\n::: tip\r\n抓取全文返回会导致更长的响应时间，可以尝试使用 \\`/sicau/jiaowu/jxtz\\` 路径，这将只返回标题，然后再在应用内抓取全文内容。\r\n:::\r\n`,\r\n    url: 'jiaowu.sicau.edu.cn/',\r\n    handler: async (ctx) => {\r\n        const baseUrl = 'https://jiaowu.sicau.edu.cn/web/web/web';\r\n        const { detail = null } = ctx.req.param();\r\n\r\n        const response = await $get(`${baseUrl}/gwmore.asp`);\r\n        const $ = load(response);\r\n\r\n        let items = $('tbody > .text-c:nth-child(-n+10)')\r\n            .toArray()\r\n            .map((item) => {\r\n                const children = $(item).children();\r\n                const a = children.eq(2).find('a');\r\n                return {\r\n                    category: [children.eq(1).text()],\r\n                    link: `${baseUrl}/${a.attr('href')!}`,\r\n                    title: a.children().first().text(),\r\n                    pubDate: timezone(parseDate(children.eq(3).text(), 'YYYY-M-D'), +8),\r\n                    author: children.eq(4).text(),\r\n                    description: '请在应用内抓取全文内容',\r\n                } as DataItem;\r\n            });\r\n\r\n        if (detail) {\r\n            items = await Promise.all(\r\n                items.map((item) =>\r\n                    cache.tryGet(item.link!, async () => {\r\n                        const $ = load(await $get(item.link!));\r\n                        item.description = $trim($('.text1[width=\"95%\"] b').html()!);\r\n                        return item;\r\n                    })\r\n                )\r\n            );\r\n        }\r\n\r\n        return {\r\n            title: '教学通知 - 四川农业大学教务处',\r\n            link: 'https://jiaowu.sicau.edu.cn/web/web/web/gwmore.asp',\r\n            language: Language.Chinese,\r\n            item: items,\r\n        };\r\n    },\r\n};\r\n"],"mappings":"wZAQA,MAAM,EAAO,MAAO,EAAa,EAAW,WAAa,IAAI,YAAY,GAAU,OAAO,MAAMA,EAAO,EAAK,CAAE,aAAc,iBACtH,EAAS,GAAgB,CAC3B,IAAI,EAAI,EAAI,OAGZ,MAFA,GAAI,EAAE,WAAW,gBAAkB,EAAE,MAAM,IAAM,EACjD,EAAI,EAAE,SAAS,QAAU,EAAE,MAAM,EAAG,KAAK,IAAI,EAAG,EAAE,OAAS,IAAM,EAC1D,EAAE,QAGAC,EAAe,CACxB,KAAM,wBACN,WAAY,CAAC,cACb,QAAS,4BACT,WAAY,CAAE,OAAQ,iCACtB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,6CACT,OAAQ,iBAGhB,KAAM,MACN,YAAa,CAAC,YACd,YAAa;;;;EAKb,IAAK,uBACL,QAAS,KAAO,IAAQ,CACpB,IAAM,EAAU,0CACV,CAAE,SAAS,MAAS,EAAI,IAAI,QAE5B,EAAW,MAAM,EAAK,GAAG,EAAQ,cACjC,EAAI,EAAK,GAEX,EAAQ,EAAE,oCACT,UACA,IAAK,GAAS,CACX,IAAM,EAAW,EAAE,GAAM,WACnB,EAAI,EAAS,GAAG,GAAG,KAAK,KAC9B,MAAO,CACH,SAAU,CAAC,EAAS,GAAG,GAAG,QAC1B,KAAM,GAAG,EAAQ,GAAG,EAAE,KAAK,UAC3B,MAAO,EAAE,WAAW,QAAQ,OAC5B,QAAS,EAAS,EAAU,EAAS,GAAG,GAAG,OAAQ,YAAa,GAChE,OAAQ,EAAS,GAAG,GAAG,OACvB,YAAa,iBAgBzB,OAZI,IACA,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAO,SAAY,CACjC,IAAMC,EAAI,EAAK,MAAM,EAAK,EAAK,OAE/B,MADA,GAAK,YAAc,EAAMA,EAAE,yBAAyB,QAC7C,OAMhB,CACH,MAAO,mBACP,KAAM,qDACN,SAAU,EAAS,QACnB,KAAM"}