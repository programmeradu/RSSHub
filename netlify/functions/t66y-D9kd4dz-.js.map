{"version":3,"file":"t66y-D9kd4dz-.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/t66y/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport * as cheerio from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { baseUrl, parseContent } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/:id/:type?/:search?',\r\n    categories: ['multimedia'],\r\n    example: '/t66y/20/2',\r\n    parameters: { id: '分区 id, 可在分区页 URL 中找到', type: '类型 id, 可在分区类型过滤后的 URL 中找到', search: '主题类型筛选，可在分区主题类型筛选后的 URL 中找到，默认为 `today`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        nsfw: true,\r\n    },\r\n    name: '分区帖子',\r\n    maintainers: ['zhboner'],\r\n    handler,\r\n    description: `> 注意：并非所有的分区都有子类型，可以参考成人文学交流区的 \\`古典武侠\\` 这一子类型。\r\n\r\n| 亚洲无码原创区 | 亚洲有码原创区 | 欧美原创区 | 动漫原创区 | 国产原创区 |\r\n| -------------- | -------------- | ---------- | ---------- | ---------- |\r\n| 2              | 15             | 4          | 5          | 25         |\r\n\r\n| 中字原创区 | 转帖交流区 | HTTP 下载区 | 在线成人区 |\r\n| ---------- | ---------- | ----------- | ---------- |\r\n| 26         | 27         | 21          | 22         |\r\n\r\n| 技术讨论区 | 新时代的我们 | 达盖尔的旗帜 | 成人文学交流 |\r\n| ---------- | ------------ | ------------ | ------------ |\r\n| 7          | 8            | 16           | 20           |\r\n\r\n  **主题过滤**\r\n\r\n  > 因为该类型无法搭配子类型使用，所以使用时 \\`type\\` 子类型需使用 \\`-999\\` 占位\r\n\r\n| 今日主题 | 热门主题 | 精华主题 | 原创主题 | 今日新作  |\r\n| ------- | ------- | ------- | ------- | ------ |\r\n| today   | hot     | digest  | 1       | 2      |`,\r\n};\r\n\r\nconst SEARCH_NAMES = {\r\n    today: '今日主题',\r\n    hot: '热门主题',\r\n    digest: '精华主题',\r\n    1: '原创主题',\r\n    2: '今日新作',\r\n};\r\n\r\nconst DEFAULT_SEARCH_TYPE = 'today';\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const type = (Number.parseInt(ctx.req.param('type')) || -999).toString();\r\n    const isValidType = type !== '-999';\r\n    const search = isValidType ? DEFAULT_SEARCH_TYPE : (ctx.req.param('search') ?? DEFAULT_SEARCH_TYPE);\r\n\r\n    const url = new URL(`thread0806.php?fid=${id}&search=${search}`, baseUrl);\r\n    isValidType && url.searchParams.set('type', type);\r\n\r\n    const { data: res } = await got(url);\r\n    const $ = cheerio.load(res);\r\n    const list = $('#ajaxtable > tbody:nth-child(2) .tr3')\r\n        .not('.tr2.tac')\r\n        .toArray()\r\n        .map((item) => {\r\n            const element = $(item);\r\n\r\n            const tal = element.find('.tal');\r\n            const catalog = tal\r\n                .contents()\r\n                .filter((_, node) => node.type === 'text')\r\n                .text()\r\n                .trim();\r\n            const a = tal.find('h3 a');\r\n            const td3 = element.find('td:nth-child(3)');\r\n\r\n            return {\r\n                title: `${catalog} ${a.text()}`,\r\n                link: `${baseUrl}/${a.attr('href')}`,\r\n                author: td3.find('a').text(),\r\n                pubDate: parseDate(String(td3.find('span[data-timestamp]').data('timestamp')).slice(0, -1), 'X'),\r\n            };\r\n        });\r\n\r\n    const out = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n\r\n                item.description = parseContent(response);\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: (isValidType ? `[${$('.t .fn b').text()}] ` : '') + (search ? `[${SEARCH_NAMES[search]}] ` : '') + $('head title').text(),\r\n        link: url.href,\r\n        item: out,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"maAOA,MAAaA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,cACb,QAAS,aACT,WAAY,CAAE,GAAI,uBAAwB,KAAM,4BAA6B,OAAQ,2CACrF,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,KAAM,IAEV,KAAM,OACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;qDAuBX,EAAe,CACjB,MAAO,OACP,IAAK,OACL,OAAQ,OACR,EAAG,OACH,EAAG,QAGD,EAAsB,QAE5B,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,GAAQ,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,MAAM,WACxD,EAAc,IAAS,OACvB,EAAS,EAAc,EAAuB,EAAI,IAAI,MAAM,WAAa,EAEzE,EAAM,IAAI,IAAI,sBAAsB,EAAG,UAAU,IAAU,GACjE,GAAe,EAAI,aAAa,IAAI,OAAQ,GAE5C,GAAM,CAAE,KAAM,GAAQ,MAAMC,EAAI,GAC1B,EAAI,EAAQ,KAAK,GACjB,EAAO,EAAE,wCACV,IAAI,YACJ,UACA,IAAK,GAAS,CACX,IAAM,EAAU,EAAE,GAEZ,EAAM,EAAQ,KAAK,QACnB,EAAU,EACX,WACA,QAAQ,EAAG,IAAS,EAAK,OAAS,QAClC,OACA,OACC,EAAI,EAAI,KAAK,QACb,EAAM,EAAQ,KAAK,mBAEzB,MAAO,CACH,MAAO,GAAG,EAAQ,GAAG,EAAE,SACvB,KAAM,GAAG,EAAQ,GAAG,EAAE,KAAK,UAC3B,OAAQ,EAAI,KAAK,KAAK,OACtB,QAAS,EAAU,OAAO,EAAI,KAAK,wBAAwB,KAAK,cAAc,MAAM,EAAG,IAAK,QAIlG,EAAM,MAAM,QAAQ,IACtB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAa,MAAMD,EAAI,EAAK,MAI1C,MAFA,GAAK,YAAc,EAAa,GAEzB,MAKnB,MAAO,CACH,OAAQ,EAAc,IAAI,EAAE,YAAY,OAAO,IAAM,KAAO,EAAS,IAAI,EAAa,GAAQ,IAAM,IAAM,EAAE,cAAc,OAC1H,KAAM,EAAI,KACV,KAAM,EACN,WAAY"}