{"version":3,"file":"jandan-BPKeCdKy.js","names":["route: Route","parser","cache","ofetch","single: DataItem","items"],"sources":["../../lib/routes/jandan/index.ts"],"sourcesContent":["import { Route, DataItem } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport parser from '@/utils/rss-parser';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    example: '/jandan',\r\n    name: 'Feed',\r\n    maintainers: ['nczitzk', 'bigfei', 'pseudoyu'],\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['i.jandan.net'],\r\n            target: '/jandan',\r\n        },\r\n    ],\r\n    handler,\r\n};\r\n\r\nasync function handler(): Promise<{\r\n    title: string;\r\n    link: string;\r\n    item: DataItem[];\r\n}> {\r\n    const rootUrl = 'http://i.jandan.net';\r\n    const feed = await parser.parseURL(`${rootUrl}/feed/`);\r\n    const items = await Promise.all(\r\n        feed.items.map((item) =>\r\n            cache.tryGet(item.link || '', async () => {\r\n                if (!item.link) {\r\n                    return undefined as unknown as DataItem;\r\n                }\r\n                const response = await ofetch(item.link);\r\n                const $ = load(response);\r\n                $('.wechat-hide').prev().nextAll().remove();\r\n                $('img').replaceWith((i, e) => {\r\n                    const src = $(e).attr('src');\r\n                    const alt = $(e).attr('alt');\r\n                    const newSrc = src?.replace(/https?:\\/\\/(\\w+)\\.moyu\\.im/, 'https://$1.sinaimg.cn');\r\n                    return `<img src=\"${newSrc}\" alt=\"${alt}\">`;\r\n                });\r\n                const single: DataItem = {\r\n                    title: item.title || '',\r\n                    description: $('.entry').html() || '',\r\n                    pubDate: item.pubDate,\r\n                    link: item.link,\r\n                    author: item['dc:creator'],\r\n                    category: item.categories,\r\n                };\r\n                return single;\r\n            })\r\n        )\r\n    ).then((items) => items.filter((item): item is DataItem => item !== undefined));\r\n\r\n    return {\r\n        title: '煎蛋',\r\n        link: rootUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"4TAMA,MAAaA,EAAe,CACxB,KAAM,IACN,QAAS,UACT,KAAM,OACN,YAAa,CAAC,UAAW,SAAU,YACnC,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,gBACT,OAAQ,YAGhB,WAGJ,eAAe,GAIZ,CACC,IAAM,EAAU,sBACV,EAAO,MAAMC,EAAO,SAAS,GAAG,EAAQ,SACxC,EAAQ,MAAM,QAAQ,IACxB,EAAK,MAAM,IAAK,GACZC,EAAM,OAAO,EAAK,MAAQ,GAAI,SAAY,CACtC,GAAI,CAAC,EAAK,KACN,OAEJ,IAAM,EAAW,MAAMC,EAAO,EAAK,MAC7B,EAAI,EAAK,GACf,EAAE,gBAAgB,OAAO,UAAU,SACnC,EAAE,OAAO,aAAa,EAAG,IAAM,CAC3B,IAAM,EAAM,EAAE,GAAG,KAAK,OAChB,EAAM,EAAE,GAAG,KAAK,OAChB,EAAS,GAAK,QAAQ,6BAA8B,yBAC1D,MAAO,aAAa,EAAO,SAAS,EAAI,MAE5C,IAAMC,EAAmB,CACrB,MAAO,EAAK,OAAS,GACrB,YAAa,EAAE,UAAU,QAAU,GACnC,QAAS,EAAK,QACd,KAAM,EAAK,KACX,OAAQ,EAAK,cACb,SAAU,EAAK,YAEnB,OAAO,MAGjB,KAAM,GAAUC,EAAM,OAAQ,GAA2B,IAAS,IAAA,KAEpE,MAAO,CACH,MAAO,KACP,KAAM,EACN,KAAM"}