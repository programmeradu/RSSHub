{"version":3,"file":"trading-BFhV8gjT.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/dcfever/trading.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\n// import { parseRelativeDate } from '@/utils/parse-date';\r\nimport { baseUrl, parseTradeItem } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/trading/:id',\r\n    categories: ['new-media'],\r\n    example: '/dcfever/trading/1',\r\n    parameters: { id: '分類 ID，見下表' },\r\n    name: '二手市集',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    description: `[所有物品分類](https://www.dcfever.com/trading/index.php#all_cats)\r\n\r\n| 攝影產品 | 電腦 | 手機通訊 | 影音產品 | 遊戲機、模型 | 電器傢俱 | 潮流服飾 | 手錶 | 單車及運動 | 其它 |\r\n| -------- | ---- | -------- | -------- | ------------ | -------- | -------- | ---- | ---------- | ---- |\r\n| 1        | 2    | 3        | 44       | 43           | 104      | 45       | 99   | 109        | 4    |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { id, order = 'new' } = ctx.req.param();\r\n\r\n    const link = new URL(`${baseUrl}/trading/listing.php`, baseUrl);\r\n    link.searchParams.append('id', id);\r\n    link.searchParams.append('order', order);\r\n    link.searchParams.append('type', 'all');\r\n    const response = await ofetch(link.href);\r\n    const $ = load(response);\r\n\r\n    const list = $('.item_grid_wrap div a')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item.find('.lazyloadx').attr('alt'),\r\n                link: new URL(item.attr('href'), link.href).href,\r\n                author: item.find('.trade_info div span').eq(1).text(),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(list.map((item) => parseTradeItem(item)));\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        link: link.href,\r\n        image: 'https://cdn10.dcfever.com/images/android_192.png',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"sWAMA,MAAaA,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,aACb,QAAS,qBACT,WAAY,CAAE,GAAI,aAClB,KAAM,OACN,YAAa,CAAC,UACd,UACA,YAAa;;;;4GAOjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,KAAI,QAAQ,OAAU,EAAI,IAAI,QAEhC,EAAO,IAAI,IAAI,GAAG,EAAQ,sBAAuB,GACvD,EAAK,aAAa,OAAO,KAAM,GAC/B,EAAK,aAAa,OAAO,QAAS,GAClC,EAAK,aAAa,OAAO,OAAQ,OACjC,IAAM,EAAW,MAAMC,EAAO,EAAK,MAC7B,EAAI,EAAK,GAET,EAAO,EAAE,yBACV,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,cAAc,KAAK,OACpC,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,EAAK,MAAM,KAC5C,OAAQ,EAAK,KAAK,wBAAwB,GAAG,GAAG,UAItD,EAAQ,MAAM,QAAQ,IAAI,EAAK,IAAK,GAAS,EAAe,KAElE,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,KAAM,EAAK,KACX,MAAO,mDACP,KAAM"}