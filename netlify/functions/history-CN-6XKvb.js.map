{"version":3,"file":"history-CN-6XKvb.js","names":["limit: number","validIds: Set<string>","validLanguages: Set<string>","baseUrl: string","targetUrl: string","ofetch","$: CheerioAPI","author: string | undefined","items: DataItem[]","$el: Cheerio<Element>","version: string | undefined","pubDateStr: string | undefined","title: string","description: string | undefined","linkUrl: string","guid: string","upDatedStr: string | undefined","processedItem: DataItem","route: Route","id: string"],"sources":["../../lib/routes/bandisoft/history.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { type CheerioAPI, type Cheerio, load } from 'cheerio';\r\nimport type { Element } from 'domhandler';\r\nimport { type Context } from 'hono';\r\n\r\nconst idOptions = [\r\n    {\r\n        label: 'Bandizip',\r\n        value: 'bandizip',\r\n    },\r\n    {\r\n        label: 'Bandizip for Mac',\r\n        value: 'bandizip.mac',\r\n    },\r\n    {\r\n        label: 'BandiView',\r\n        value: 'bandiview',\r\n    },\r\n    {\r\n        label: 'Honeycam',\r\n        value: 'honeycam',\r\n    },\r\n];\r\n\r\nconst languageOptions = [\r\n    {\r\n        label: 'English',\r\n        value: 'en',\r\n    },\r\n    {\r\n        label: '中文(简体)',\r\n        value: 'cn',\r\n    },\r\n    {\r\n        label: '中文(繁體)',\r\n        value: 'tw',\r\n    },\r\n    {\r\n        label: '日本語',\r\n        value: 'jp',\r\n    },\r\n    {\r\n        label: 'Русский',\r\n        value: 'ru',\r\n    },\r\n    {\r\n        label: 'Español',\r\n        value: 'es',\r\n    },\r\n    {\r\n        label: 'Français',\r\n        value: 'fr',\r\n    },\r\n    {\r\n        label: 'Deutsch',\r\n        value: 'de',\r\n    },\r\n    {\r\n        label: 'Italiano',\r\n        value: 'it',\r\n    },\r\n    {\r\n        label: 'Slovenčina',\r\n        value: 'sk',\r\n    },\r\n    {\r\n        label: 'Українська',\r\n        value: 'uk',\r\n    },\r\n    {\r\n        label: 'Беларуская',\r\n        value: 'be',\r\n    },\r\n    {\r\n        label: 'Dansk',\r\n        value: 'da',\r\n    },\r\n    {\r\n        label: 'Polski',\r\n        value: 'pl',\r\n    },\r\n    {\r\n        label: 'Português Brasileiro',\r\n        value: 'br',\r\n    },\r\n    {\r\n        label: 'Čeština',\r\n        value: 'cs',\r\n    },\r\n    {\r\n        label: 'Nederlands',\r\n        value: 'nl',\r\n    },\r\n    {\r\n        label: 'Slovenščina',\r\n        value: 'sl',\r\n    },\r\n    {\r\n        label: 'Türkçe',\r\n        value: 'tr',\r\n    },\r\n    {\r\n        label: 'ภาษาไทย',\r\n        value: 'th',\r\n    },\r\n    {\r\n        label: 'Ελληνικά',\r\n        value: 'gr',\r\n    },\r\n    {\r\n        label: \"O'zbek\",\r\n        value: 'uz',\r\n    },\r\n    {\r\n        label: 'Romanian',\r\n        value: 'ro',\r\n    },\r\n    {\r\n        label: '한국어',\r\n        value: 'kr',\r\n    },\r\n];\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const { id = 'bandizip', language = 'en' } = ctx.req.param();\r\n    const limit: number = Number.parseInt(ctx.req.query('limit') ?? '500', 10);\r\n\r\n    const validIds: Set<string> = new Set(idOptions.map((option) => option.value));\r\n\r\n    if (!validIds.has(id)) {\r\n        throw new Error(`Invalid id: ${id}. Allowed values are: ${[...validIds].join(', ')}`);\r\n    }\r\n\r\n    const validLanguages: Set<string> = new Set(languageOptions.map((option) => option.value));\r\n\r\n    if (!validLanguages.has(language)) {\r\n        throw new Error(`Invalid language: ${language}. Allowed values are: ${[...validLanguages].join(', ')}`);\r\n    }\r\n\r\n    const baseUrl: string = `https://${language}.bandisoft.com`;\r\n    const targetUrl: string = new URL(`${id}/history/`, baseUrl).href;\r\n\r\n    const response = await ofetch(targetUrl);\r\n    const $: CheerioAPI = load(response);\r\n    const lang = $('html').attr('lang') ?? 'en';\r\n    const author: string | undefined = $('meta[name=\"author\"]').attr('content');\r\n\r\n    const items: DataItem[] = $('div.row')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((el): Element => {\r\n            const $el: Cheerio<Element> = $(el);\r\n\r\n            const version: string | undefined = $el.find('div.cell1').text();\r\n            const pubDateStr: string | undefined = $el.find('div.cell2').text();\r\n\r\n            const title: string = version;\r\n            const description: string | undefined = $el.find('ul.cell3').html() ?? undefined;\r\n\r\n            const linkUrl: string = targetUrl;\r\n            const guid: string = `bandisoft-${id}-${language}-${version}`;\r\n            const upDatedStr: string | undefined = pubDateStr;\r\n\r\n            const processedItem: DataItem = {\r\n                title,\r\n                description,\r\n                pubDate: pubDateStr ? parseDate(pubDateStr) : undefined,\r\n                link: linkUrl,\r\n                author,\r\n                guid,\r\n                id: guid,\r\n                content: {\r\n                    html: description,\r\n                    text: description,\r\n                },\r\n                updated: upDatedStr ? parseDate(upDatedStr) : undefined,\r\n                language: lang,\r\n            };\r\n\r\n            return processedItem;\r\n        });\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        description: $('meta[name=\"description\"]').attr('content'),\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: $('img#logo_light').attr('src'),\r\n        author,\r\n        language: lang,\r\n        id: targetUrl,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/history/:id?/:language?',\r\n    name: 'History',\r\n    url: 'www.bandisoft.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/bandisoft/history/bandizip',\r\n    parameters: {\r\n        id: {\r\n            description: 'ID, `bandizip` by default',\r\n            options: idOptions,\r\n        },\r\n        language: {\r\n            description: 'Language, `en` by default',\r\n            options: languageOptions,\r\n        },\r\n    },\r\n    description: `:::tip\r\nTo subscribe to [Bandizip Version History](https://www.bandisoft.com/bandizip/history/), where the source URL is \\`https://www.bandisoft.com/bandizip/history/\\`, extract the certain parts from this URL to be used as parameters, resulting in the route as [\\`/bandisoft/history/bandizip\\`](https://rsshub.app/bandisoft/history/bandizip).\r\n:::\r\n\r\n<details>\r\n  <summary>More languages</summary>\r\n\r\n| Language             | ID  |\r\n| -------------------- | --- |\r\n| English              | en  |\r\n| 中文(简体)           | cn  |\r\n| 中文(繁體)           | tw  |\r\n| 日本語               | jp  |\r\n| Русский              | ru  |\r\n| Español              | es  |\r\n| Français             | fr  |\r\n| Deutsch              | de  |\r\n| Italiano             | it  |\r\n| Slovenčina           | sk  |\r\n| Українська           | uk  |\r\n| Беларуская           | be  |\r\n| Dansk                | da  |\r\n| Polski               | pl  |\r\n| Português Brasileiro | br  |\r\n| Čeština              | cs  |\r\n| Nederlands           | nl  |\r\n| Slovenščina          | sl  |\r\n| Türkçe               | tr  |\r\n| ภาษาไทย              | th  |\r\n| Ελληνικά             | gr  |\r\n| Oʻzbek               | uz  |\r\n| Romanian             | ro  |\r\n| 한국어               | kr  |\r\n\r\n</details>\r\n`,\r\n    categories: ['program-update'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.bandisoft.com/:id/history'],\r\n            target: (params) => {\r\n                const id: string = params.id;\r\n\r\n                return `/bandisoft/history${id ? `/${id}` : ''}`;\r\n            },\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n\r\n    zh: {\r\n        path: '/history/:id?/:language?',\r\n        name: '更新记录',\r\n        url: 'www.bandisoft.com',\r\n        maintainers: ['nczitzk'],\r\n        handler,\r\n        example: '/bandisoft/history/bandizip',\r\n        parameters: {\r\n            id: {\r\n                description: 'ID, 默认为 `bandizip`，可在对应产品页 URL 中找到',\r\n                options: idOptions,\r\n            },\r\n            language: {\r\n                description: '地区, 默认为 `en`',\r\n                options: languageOptions,\r\n            },\r\n        },\r\n        description: `:::tip\r\n若订阅 [Bandizip 更新记录](https://cn.bandisoft.com/bandizip/history/)，网址为 \\`https://cn.bandisoft.com/bandizip/history/\\`，请截取 \\`cn\\` 作为 \\`category\\` 参数填入，此时目标路由为 [\\`/bandisoft/:language?/:id?\\`](https://rsshub.app/bandisoft/:language?/:id?)。\r\n:::\r\n\r\n<details>\r\n  <summary>更多语言</summary>\r\n\r\n| Language             | ID  |\r\n| -------------------- | --- |\r\n| English              | en  |\r\n| 中文(简体)           | cn  |\r\n| 中文(繁體)           | tw  |\r\n| 日本語               | jp  |\r\n| Русский              | ru  |\r\n| Español              | es  |\r\n| Français             | fr  |\r\n| Deutsch              | de  |\r\n| Italiano             | it  |\r\n| Slovenčina           | sk  |\r\n| Українська           | uk  |\r\n| Беларуская           | be  |\r\n| Dansk                | da  |\r\n| Polski               | pl  |\r\n| Português Brasileiro | br  |\r\n| Čeština              | cs  |\r\n| Nederlands           | nl  |\r\n| Slovenščina          | sl  |\r\n| Türkçe               | tr  |\r\n| ภาษาไทย              | th  |\r\n| Ελληνικά             | gr  |\r\n| Oʻzbek               | uz  |\r\n| Romanian             | ro  |\r\n| 한국어               | kr  |\r\n\r\n</details>\r\n`,\r\n    },\r\n};\r\n"],"mappings":"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"}