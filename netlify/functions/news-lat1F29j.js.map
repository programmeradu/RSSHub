{"version":3,"file":"news-lat1F29j.js","names":["route: Route","got","items: DataItem[]","cache","$"],"sources":["../../lib/routes/samrdprc/news.ts"],"sourcesContent":["import { Route, DataItem } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:type1/:type2',\r\n    categories: ['government'],\r\n    example: '/samrdprc/news/xfpzh/xfpgnzh',\r\n    parameters: {\r\n        type1: '召回类型ID1，见下表',\r\n        type2: '召回类型ID2，见下表',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    description: `\r\n| 类型中文 | 召回类型ID1 | 召回类型ID2 |\r\n| --- | --- | --- |\r\n| 消费品召回 | xfpzh | xfpgnzh |\r\n| 汽车召回 | qczh | gnzhqc |\r\n`,\r\n    name: '召回信息',\r\n    maintainers: ['a180285'],\r\n    radar: [\r\n        {\r\n            source: ['www.samrdprc.org.cn/:type1/:type2'],\r\n            target: '/news/:type1/:type2',\r\n        },\r\n    ],\r\n    handler: async (ctx) => {\r\n        const baseURL = 'https://www.samrdprc.org.cn';\r\n        const type1 = ctx.req.param('type1');\r\n        const type2 = ctx.req.param('type2');\r\n\r\n        const url = `${baseURL}/${type1}/${type2}`;\r\n        const response = await got(url);\r\n        const $ = load(response.body);\r\n\r\n        const typeName = $('div.box_main > div.boxl.fl > div.boxl_tit > div > span.fl').text();\r\n\r\n        const listSelector = $('div.main > div.box1 > div.box_main > div.boxl.fl > div.boxl_ul > ul > li');\r\n        const items: DataItem[] = await Promise.all(\r\n            listSelector.toArray().map((el) => {\r\n                const item = $(el);\r\n\r\n                const title = item.find('a').text();\r\n                const link = url + '/' + item.find('a').attr('href');\r\n                const pubDate = parseDate(item.find('span').text().trim());\r\n\r\n                return cache.tryGet(link, async () => {\r\n                    const detail = await got(link);\r\n                    const $ = load(detail.body);\r\n\r\n                    const articleHTML = $('div.main > div.box1 > div.box_main > div.boxl.fl > div.show_txt > div.TRS_Editor > div').html() || '';\r\n\r\n                    return {\r\n                        title,\r\n                        link,\r\n                        pubDate,\r\n                        description: articleHTML,\r\n                    };\r\n                });\r\n            })\r\n        );\r\n\r\n        return {\r\n            title: `${typeName} - 国家市场监督管理总局`,\r\n            link: url,\r\n            item: items as DataItem[],\r\n        };\r\n    },\r\n};\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,cACb,QAAS,+BACT,WAAY,CACR,MAAO,cACP,MAAO,eAEX,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,YAAa;;;;;EAMb,KAAM,OACN,YAAa,CAAC,WACd,MAAO,CACH,CACI,OAAQ,CAAC,qCACT,OAAQ,wBAGhB,QAAS,KAAO,IAAQ,CACpB,IACM,EAAQ,EAAI,IAAI,MAAM,SACtB,EAAQ,EAAI,IAAI,MAAM,SAEtB,EAAM,+BAAc,EAAM,GAAG,IAC7B,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAW,EAAE,6DAA6D,OAE1E,EAAe,EAAE,4EACjBC,EAAoB,MAAM,QAAQ,IACpC,EAAa,UAAU,IAAK,GAAO,CAC/B,IAAM,EAAO,EAAE,GAET,EAAQ,EAAK,KAAK,KAAK,OACvB,EAAO,EAAM,IAAM,EAAK,KAAK,KAAK,KAAK,QACvC,EAAU,EAAU,EAAK,KAAK,QAAQ,OAAO,QAEnD,OAAOC,EAAM,OAAO,EAAM,SAAY,CAClC,IAAM,EAAS,MAAMF,EAAI,GACnBG,EAAI,EAAK,EAAO,MAEhB,EAAcA,EAAE,0FAA0F,QAAU,GAE1H,MAAO,CACH,QACA,OACA,UACA,YAAa,QAM7B,MAAO,CACH,MAAO,GAAG,EAAS,eACnB,KAAM,EACN,KAAM"}