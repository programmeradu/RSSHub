{"version":3,"file":"douyin-DXAaBake.js","names":["route: Route","ConfigNotFoundError","utils","got"],"sources":["../../lib/routes/newrank/douyin.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport utils from './utils';\r\nimport { config } from '@/config';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nexport const route: Route = {\r\n    path: '/douyin/:dyid',\r\n    categories: ['social-media'],\r\n    example: '/newrank/douyin/110266463747',\r\n    parameters: { dyid: '抖音ID，可在新榜账号详情 URL 中找到' },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'NEWRANK_COOKIE',\r\n                description: '',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '抖音短视频',\r\n    maintainers: ['lessmoe'],\r\n    handler,\r\n    description: `::: warning\r\n免费版账户抖音每天查询次数 20 次，如需增加次数可购买新榜会员或等待未来多账户支持\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    if (!config.newrank || !config.newrank.cookie) {\r\n        throw new ConfigNotFoundError('newrank RSS is disabled due to the lack of <a href=\"https://docs.rsshub.app/deploy/config#route-specific-configurations\">relevant config</a>');\r\n    }\r\n    const uid = ctx.req.param('dyid');\r\n    const nonce = utils.random_nonce(9);\r\n    const url_detail = 'https://xd.newrank.cn/xdnphb/nr/cloud/douyin/detail/aweme?xyz=' + utils.decrypt_douyin_detail_xyz(nonce) + '&nonce=' + nonce;\r\n    const cookie = config.newrank.cookie;\r\n    const response_detail = await got({\r\n        method: 'post',\r\n        url: url_detail,\r\n        headers: {\r\n            Connection: 'keep-alive',\r\n            Cookie: cookie,\r\n            'Content-Type': 'application/json',\r\n        },\r\n        data: JSON.stringify({\r\n            create_time_end: '',\r\n            create_time_start: '',\r\n            date_type: '',\r\n            is_promotion: '0',\r\n            is_seed: '0',\r\n            keyword: '',\r\n            size: 20,\r\n            sort: 'create_time',\r\n            start: 1,\r\n            uid,\r\n        }),\r\n    });\r\n    const url_account = 'https://xd.newrank.cn/xdnphb/nr/cloud/douyin/detail/accountInfoAll?nonce=' + nonce + '&xyz=' + utils.decrypt_douyin_account_xyz(nonce);\r\n    const response_account = await got({\r\n        method: 'post',\r\n        url: url_account,\r\n        headers: {\r\n            Connection: 'keep-alive',\r\n            Cookie: cookie,\r\n            'Content-Type': 'application/json',\r\n        },\r\n        data: JSON.stringify({\r\n            uid,\r\n        }),\r\n    });\r\n    const name = response_account.data.data.nickname;\r\n    const description = response_account.data.data.signature;\r\n    const articles = utils.flatten(response_detail.data.data.list);\r\n    const items = articles.map((item) => ({\r\n        title: item.aweme_desc,\r\n        description: '',\r\n        link: item.share_url,\r\n        pubDate: item.create_time,\r\n    }));\r\n\r\n    return {\r\n        title: name + ' - 抖音',\r\n        description,\r\n        link: 'https://xd.newrank.cn/data/d/account/workList/' + uid,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"qaAMA,MAAaA,EAAe,CACxB,KAAM,gBACN,WAAY,CAAC,gBACb,QAAS,+BACT,WAAY,CAAE,KAAM,yBACpB,SAAU,CACN,cAAe,CACX,CACI,KAAM,iBACN,YAAa,KAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,QACN,YAAa,CAAC,WACd,UACA,YAAa;;MAKjB,eAAe,EAAQ,EAAK,CACxB,GAAI,CAAC,EAAO,SAAW,CAAC,EAAO,QAAQ,OACnC,MAAM,IAAIC,EAAoB,gJAElC,IAAM,EAAM,EAAI,IAAI,MAAM,QACpB,EAAQC,EAAM,aAAa,GAC3B,EAAa,iEAAmEA,EAAM,0BAA0B,GAAS,UAAY,EACrI,EAAS,EAAO,QAAQ,OACxB,EAAkB,MAAMC,EAAI,CAC9B,OAAQ,OACR,IAAK,EACL,QAAS,CACL,WAAY,aACZ,OAAQ,EACR,eAAgB,oBAEpB,KAAM,KAAK,UAAU,CACjB,gBAAiB,GACjB,kBAAmB,GACnB,UAAW,GACX,aAAc,IACd,QAAS,IACT,QAAS,GACT,KAAM,GACN,KAAM,cACN,MAAO,EACP,UAGF,EAAc,4EAA8E,EAAQ,QAAUD,EAAM,2BAA2B,GAC/I,EAAmB,MAAMC,EAAI,CAC/B,OAAQ,OACR,IAAK,EACL,QAAS,CACL,WAAY,aACZ,OAAQ,EACR,eAAgB,oBAEpB,KAAM,KAAK,UAAU,CACjB,UAGF,EAAO,EAAiB,KAAK,KAAK,SAClC,EAAc,EAAiB,KAAK,KAAK,UACzC,EAAWD,EAAM,QAAQ,EAAgB,KAAK,KAAK,MACnD,EAAQ,EAAS,IAAK,IAAU,CAClC,MAAO,EAAK,WACZ,YAAa,GACb,KAAM,EAAK,UACX,QAAS,EAAK,eAGlB,MAAO,CACH,MAAO,EAAO,QACd,cACA,KAAM,iDAAmD,EACzD,KAAM"}