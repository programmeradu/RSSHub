{"version":3,"file":"straitstimes-A5Uv9xcT.js","names":[],"sources":["../../lib/routes/straitstimes/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport path from 'node:path';\r\nimport { art } from '@/utils/render';\r\n\r\nexport const route: Route = {\r\n    path: '/:category?/:section?',\r\n    categories: ['traditional-media'],\r\n    example: '/straitstimes/singapore',\r\n    parameters: {\r\n        category: 'Category, see below for more information',\r\n        section: 'Section, see below for more information',\r\n    },\r\n    features: {\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        requireConfig: false,\r\n    },\r\n    name: 'News',\r\n    maintainers: ['quiniapiezoelectricity'],\r\n    handler,\r\n    description: `\r\n| Category               | \\`:category\\`               |\r\n| ---------------------- | --------------------------- |\r\n| Singapore              | \\`singapore\\`               |\r\n| Asia                   | \\`asia\\`                    |\r\n| World                  | \\`world\\`                   |\r\n| Opinion                | \\`opinion\\`                 |\r\n| Life                   | \\`life\\`                    |\r\n| Business               | \\`business\\`                |\r\n| Jobs                   | \\`jobs\\`                    |\r\n| Parenting & Education  | \\`parenting-and-education\\` |\r\n| Food                   | \\`food\\`                    |\r\n| Tech                   | \\`tech\\`                    |\r\n| Sport                  | \\`sport\\`                   |\r\n| Podcasts               | \\`podcasts\\`                |,\r\n\r\n| Section                | \\`:section\\`                |\r\n| ---------------------- | --------------------------- |\r\n| Top Stories            | \\`top-stories\\`             |\r\n| Latest                 | \\`latest\\`                  |`,\r\n    radar: [\r\n        {\r\n            source: ['www.straitstimes.com/:category'],\r\n            target: '/:category',\r\n        },\r\n        {\r\n            source: ['www.straitstimes.com'],\r\n            target: '/',\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ? ctx.req.param('category').toLowerCase() : 'singapore';\r\n    const section = ctx.req.param('section') ? ctx.req.param('section').toLowerCase() : undefined;\r\n    const apiKey = 'T9XUJM9rAZoLOd2CAx2wCBSTrm3xoyPw';\r\n    const platform = 'iosflex';\r\n    let feed;\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `https://newsapi.sphdigital.com/v2/feed/section/st?page=1&platform=${platform}&section=${category}/star&subscribed=false&version=4.0`,\r\n        headers: {\r\n            'x-api-key': apiKey,\r\n        },\r\n    });\r\n    feed = response.data.data;\r\n    const sections = new Set(feed.filter((item) => item.items[0].itemType === 'SectionFooter').map((items) => items.items[0].sectionFooterData.link.id));\r\n    let slug = section && sections.has(`${category}-${section}-more/star`) ? `${category}-${section}-more/star` : undefined;\r\n    if (section === undefined) {\r\n        for (const section of ['latest', 'top-picks', 'top-stories']) {\r\n            if (sections.has(`${category}-${section}-more/star`)) {\r\n                slug = `${category}-${section}-more/star`;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    if (slug) {\r\n        const response = await got({\r\n            method: 'get',\r\n            url: `https://newsapi.sphdigital.com/v2/feed/section/st?page=1&platform=${platform}&section=${slug}&subscribed=false&version=4.0`,\r\n            headers: {\r\n                'x-api-key': apiKey,\r\n            },\r\n        });\r\n        feed = response.data.data;\r\n    }\r\n    const articles = feed.filter((item) => item.items[0].itemType === 'Article');\r\n    const items = await Promise.all(\r\n        articles.map((item) =>\r\n            cache.tryGet(item.items[0].articleData.url, async () => {\r\n                const article = item.items[0].articleData;\r\n                if (article.authors) {\r\n                    item.author = article.authors.map((author) => author.name).join(', ');\r\n                }\r\n                if (article.keywords) {\r\n                    item.category = article.keywords.map((keyword) => keyword.name);\r\n                }\r\n                item.title = article.headline;\r\n                item.pubDate = parseDate(article.publicationTime, 'X');\r\n                item.updated = parseDate(article.updatedTime, 'X');\r\n                item.link = article.url;\r\n                let content = article.teaser;\r\n                if (article.documentId) {\r\n                    const response = await got({\r\n                        method: 'get',\r\n                        url: `https://newsapi.sphdigital.com/v2/feed/article/st/${article.documentId}?platform=${platform}&version=4.0`,\r\n                        headers: {\r\n                            'x-api-key': apiKey,\r\n                        },\r\n                    });\r\n                    content = response.data.data.body;\r\n                }\r\n                item.description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    images: article.images ?? [],\r\n                    article: content,\r\n                });\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `The Strait Times - ${category.replaceAll('-', ' ').toUpperCase()}`,\r\n        link: `https://www.straitstimes.com/${category.toLowerCase()}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"ybAOA,MAAa,EAAe,CACxB,KAAM,wBACN,WAAY,CAAC,qBACb,QAAS,0BACT,WAAY,CACR,SAAU,2CACV,QAAS,2CAEb,SAAU,CACN,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,0BACd,UACA,YAAa,0/BAoBb,MAAO,CACH,CACI,OAAQ,CAAC,kCACT,OAAQ,cAEZ,CACI,OAAQ,CAAC,wBACT,OAAQ,OAKpB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YAAc,EAAI,IAAI,MAAM,YAAY,cAAgB,YACjF,EAAU,EAAI,IAAI,MAAM,WAAa,EAAI,IAAI,MAAM,WAAW,cAAgB,IAAA,GAC9E,EAAS,mCACT,EAAW,UACb,EACE,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,qEAAqE,EAAS,WAAW,EAAS,oCACvG,QAAS,CACL,YAAa,KAGrB,EAAO,EAAS,KAAK,KACrB,IAAM,EAAW,IAAI,IAAI,EAAK,OAAQ,GAAS,EAAK,MAAM,GAAG,WAAa,iBAAiB,IAAK,GAAU,EAAM,MAAM,GAAG,kBAAkB,KAAK,KAC5I,EAAO,GAAW,EAAS,IAAI,GAAG,EAAS,GAAG,EAAQ,aAAe,GAAG,EAAS,GAAG,EAAQ,YAAc,IAAA,GAC9G,GAAI,IAAY,IAAA,QACP,IAAM,IAAW,CAAC,SAAU,YAAa,eAC1C,GAAI,EAAS,IAAI,GAAG,EAAS,GAAG,EAAQ,aAAc,CAClD,EAAO,GAAG,EAAS,GAAG,EAAQ,YAC9B,OAIZ,GAAI,EAAM,CACN,IAAM,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,qEAAqE,EAAS,WAAW,EAAK,+BACnG,QAAS,CACL,YAAa,KAGrB,EAAO,EAAS,KAAK,KAEzB,IAAM,EAAW,EAAK,OAAQ,GAAS,EAAK,MAAM,GAAG,WAAa,WAC5D,EAAQ,MAAM,QAAQ,IACxB,EAAS,IAAK,GACV,EAAM,OAAO,EAAK,MAAM,GAAG,YAAY,IAAK,SAAY,CACpD,IAAM,EAAU,EAAK,MAAM,GAAG,YAC1B,EAAQ,UACR,EAAK,OAAS,EAAQ,QAAQ,IAAK,GAAW,EAAO,MAAM,KAAK,OAEhE,EAAQ,WACR,EAAK,SAAW,EAAQ,SAAS,IAAK,GAAY,EAAQ,OAE9D,EAAK,MAAQ,EAAQ,SACrB,EAAK,QAAU,EAAU,EAAQ,gBAAiB,KAClD,EAAK,QAAU,EAAU,EAAQ,YAAa,KAC9C,EAAK,KAAO,EAAQ,IACpB,IAAI,EAAU,EAAQ,OACtB,GAAI,EAAQ,WAAY,CACpB,IAAM,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,qDAAqD,EAAQ,WAAW,YAAY,EAAS,cAClG,QAAS,CACL,YAAa,KAGrB,EAAU,EAAS,KAAK,KAAK,KAMjC,MAJA,GAAK,YAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACtE,OAAQ,EAAQ,QAAU,GAC1B,QAAS,IAEN,MAKnB,MAAO,CACH,MAAO,sBAAsB,EAAS,WAAW,IAAK,KAAK,gBAC3D,KAAM,gCAAgC,EAAS,gBAC/C,KAAM"}