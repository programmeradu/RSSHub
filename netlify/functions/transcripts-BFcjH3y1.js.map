{"version":3,"file":"transcripts-BFcjH3y1.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/reactiflux/transcripts.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/transcripts',\r\n    name: 'Transcripts',\r\n    url: 'reactiflux.com/transcripts',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/reactiflux/transcripts',\r\n    categories: ['programming'],\r\n    radar: [\r\n        {\r\n            source: ['www.reactiflux.com/transcripts'],\r\n            target: '/transcripts',\r\n        },\r\n    ],\r\n};\r\n\r\nexport async function handler(ctx) {\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 30;\r\n\r\n    const rootUrl = 'https://www.reactiflux.com';\r\n    const currentUrl = new URL(`transcripts`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const author = 'Reactiflux';\r\n    const language = 'en';\r\n    const image = $('meta[property=\"og:image\"]').prop('content');\r\n\r\n    let items =\r\n        JSON.parse(response.match(/__NEXT_DATA__\" type=\"application\\/json\">(.*?)<\\/script>/)?.[1] ?? '{}')\r\n            ?.props.pageProps.all.slice(0, limit)\r\n            .map((item) => {\r\n                const title = item.title;\r\n                const guid = `reactiflux-${item.path.replace(/\\/transcripts\\//, '')}`;\r\n\r\n                return {\r\n                    title,\r\n                    link: new URL(item.path, rootUrl).href,\r\n                    author,\r\n                    guid,\r\n                    id: guid,\r\n                    image,\r\n                    banner: image,\r\n                    language,\r\n                };\r\n            }) ?? [];\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const data = JSON.parse(detailResponse.match(/__NEXT_DATA__\" type=\"application\\/json\">(.*)<\\/script>/)?.[1] ?? '{}');\r\n\r\n                if (!data.props) {\r\n                    return item;\r\n                }\r\n\r\n                const props = data.props.pageProps;\r\n\r\n                const title = props.title;\r\n                const description = props.html;\r\n                const guid = `reactiflux-${data.query.slug}`;\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = parseDate(props.date);\r\n                item.link = new URL(`transcripts/${data.query.slug}`, rootUrl).href;\r\n                item.author = author;\r\n                item.guid = guid;\r\n                item.id = guid;\r\n                item.content = {\r\n                    html: description,\r\n                    text: props.description,\r\n                };\r\n                item.image = image;\r\n                item.banner = image;\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${author} - ${$('title').text()}`,\r\n        description: $('meta[property=\"og:description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author,\r\n        language,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,eACN,KAAM,cACN,IAAK,6BACL,YAAa,CAAC,WACd,UACA,QAAS,0BACT,WAAY,CAAC,eACb,MAAO,CACH,CACI,OAAQ,CAAC,kCACT,OAAQ,kBAKpB,eAAsB,EAAQ,EAAK,CAC/B,IAAM,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,6BACV,EAAa,IAAI,IAAI,cAAe,GAAS,KAE7C,CAAE,KAAM,GAAa,MAAMC,EAAI,GAE/B,EAAI,EAAK,GAET,EAAS,aAET,EAAQ,EAAE,6BAA6B,KAAK,WAE9C,EACA,KAAK,MAAM,EAAS,MAAM,6DAA6D,IAAM,OACvF,MAAM,UAAU,IAAI,MAAM,EAAG,GAC9B,IAAK,GAAS,CACX,IAAM,EAAQ,EAAK,MACb,EAAO,cAAc,EAAK,KAAK,QAAQ,kBAAmB,MAEhE,MAAO,CACH,QACA,KAAM,IAAI,IAAI,EAAK,KAAM,GAAS,KAClC,SACA,OACA,GAAI,EACJ,QACA,OAAQ,EACR,kBAEF,GAuCd,MArCA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAMD,EAAI,EAAK,MAE1C,EAAO,KAAK,MAAM,EAAe,MAAM,4DAA4D,IAAM,MAE/G,GAAI,CAAC,EAAK,MACN,OAAO,EAGX,IAAM,EAAQ,EAAK,MAAM,UAEnB,EAAQ,EAAM,MACd,EAAc,EAAM,KACpB,EAAO,cAAc,EAAK,MAAM,OAiBtC,MAfA,GAAK,MAAQ,EACb,EAAK,YAAc,EACnB,EAAK,QAAU,EAAU,EAAM,MAC/B,EAAK,KAAO,IAAI,IAAI,eAAe,EAAK,MAAM,OAAQ,GAAS,KAC/D,EAAK,OAAS,EACd,EAAK,KAAO,EACZ,EAAK,GAAK,EACV,EAAK,QAAU,CACX,KAAM,EACN,KAAM,EAAM,aAEhB,EAAK,MAAQ,EACb,EAAK,OAAS,EACd,EAAK,SAAW,KAET,MAKZ,CACH,MAAO,GAAG,EAAO,KAAK,EAAE,SAAS,SACjC,YAAa,EAAE,mCAAmC,KAAK,WACvD,KAAM,EACN,KAAM,EACN,WAAY,GACZ,QACA,SACA"}