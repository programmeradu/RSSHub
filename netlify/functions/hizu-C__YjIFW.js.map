{"version":3,"file":"hizu-C__YjIFW.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/hizu/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst titles = {\r\n    '5dd92265e4b0bf88dd8c1175': '热点',\r\n    '5dd921a7e4b0bf88dd8c116f': '订阅',\r\n    '604f1cbbe4b0cf5c2234d470': '学党史',\r\n    '5dd92242e4b0bf88dd8c1174': '政经',\r\n    '61259fd6e4b0d294f7f9786d': '合作区',\r\n    '61dfe511e4b0248b60d1c568': '名记名播',\r\n    '5dd9222ce4b0bf88dd8c1173': '大湾区',\r\n    '617805e4e4b037abacfd4820': '网评',\r\n    '5dd9220de4b0bf88dd8c1172': 'TV新闻',\r\n    '5e6edd50e4b02ebde0ab061e': '音频',\r\n    '600e8ad4e4b02c3a6af6aaa8': '澳门',\r\n    '600f760fe4b0e33cf6f8e68e': '政务',\r\n    '5ff7c0fde4b0e2f210d05e20': '教育',\r\n    '5fc88615e4b0e3055e693e0a': '深圳',\r\n    '600e8a93e4b02c3a6af6aa80': '中山',\r\n    '5dd921ece4b0bf88dd8c1170': '民生',\r\n    '61148184e4b08d3215364396': '社区',\r\n    '5dd9215fe4b0bf88dd8c116b': '专题',\r\n    '5e2e5107e4b0c14b5d0e3d04': '战疫',\r\n    '5f88eaf2e4b0a27cd404e09e': '横琴',\r\n    '5f86a3f5e4b09d75f99dde7d': '香洲',\r\n    '5e8c42b4e4b0347c7e5836e0': '金湾',\r\n    '5ee70534e4b07b8a779a1ad6': '斗门',\r\n    '607d37ade4b05c59ac2f3d40': '高新',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:column?',\r\n    categories: ['new-media'],\r\n    example: '/hizu',\r\n    parameters: { column: '栏目，见下表，默认为热点' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['hizh.cn/'],\r\n        },\r\n    ],\r\n    name: '栏目',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    url: 'hizh.cn/',\r\n    description: `| 分类     | 编号                     |\r\n| -------- | ------------------------ |\r\n| 热点     | 5dd92265e4b0bf88dd8c1175 |\r\n| 订阅     | 5dd921a7e4b0bf88dd8c116f |\r\n| 学党史   | 604f1cbbe4b0cf5c2234d470 |\r\n| 政经     | 5dd92242e4b0bf88dd8c1174 |\r\n| 合作区   | 61259fd6e4b0d294f7f9786d |\r\n| 名记名播 | 61dfe511e4b0248b60d1c568 |\r\n| 大湾区   | 5dd9222ce4b0bf88dd8c1173 |\r\n| 网评     | 617805e4e4b037abacfd4820 |\r\n| TV 新闻  | 5dd9220de4b0bf88dd8c1172 |\r\n| 音频     | 5e6edd50e4b02ebde0ab061e |\r\n| 澳门     | 600e8ad4e4b02c3a6af6aaa8 |\r\n| 政务     | 600f760fe4b0e33cf6f8e68e |\r\n| 教育     | 5ff7c0fde4b0e2f210d05e20 |\r\n| 深圳     | 5fc88615e4b0e3055e693e0a |\r\n| 中山     | 600e8a93e4b02c3a6af6aa80 |\r\n| 民生     | 5dd921ece4b0bf88dd8c1170 |\r\n| 社区     | 61148184e4b08d3215364396 |\r\n| 专题     | 5dd9215fe4b0bf88dd8c116b |\r\n| 战疫     | 5e2e5107e4b0c14b5d0e3d04 |\r\n| 横琴     | 5f88eaf2e4b0a27cd404e09e |\r\n| 香洲     | 5f86a3f5e4b09d75f99dde7d |\r\n| 金湾     | 5e8c42b4e4b0347c7e5836e0 |\r\n| 斗门     | 5ee70534e4b07b8a779a1ad6 |\r\n| 高新     | 607d37ade4b05c59ac2f3d40 |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const column = ctx.req.param('column') ?? '5dd92265e4b0bf88dd8c1175';\r\n\r\n    const rootUrl = 'https://www.hizh.cn';\r\n    const currentUrl = `${rootUrl}/channels/zjyapp/columns/${column}/stories.json`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    let items = response.data.stories.slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 50).map((item) => ({\r\n        title: item.title,\r\n        author: item.author,\r\n        link: item.jsonUrl,\r\n        category: item.columnName,\r\n        pubDate: parseDate(item.published),\r\n    }));\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n\r\n                const content = load(detailResponse.data.content);\r\n\r\n                content('figure').last().remove();\r\n\r\n                item.description = content.html();\r\n                item.link = `${rootUrl}/content.html?jsonUrl=${item.link}`;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${titles[column]} - 珠海网`,\r\n        link: rootUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAM,EAAS,CACX,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,MAC5B,2BAA4B,KAC5B,2BAA4B,MAC5B,2BAA4B,OAC5B,2BAA4B,MAC5B,2BAA4B,KAC5B,2BAA4B,OAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,KAC5B,2BAA4B,MAGnBA,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,aACb,QAAS,QACT,WAAY,CAAE,OAAQ,gBACtB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,cAGjB,KAAM,KACN,YAAa,CAAC,WACd,UACA,IAAK,WACL,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;wCA4BjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,EAAI,IAAI,MAAM,WAAa,2BAEpC,EAAU,sBACV,EAAa,GAAG,EAAQ,2BAA2B,EAAO,eAE1D,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGL,EAAQ,EAAS,KAAK,QAAQ,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAAI,IAAK,IAAU,CAC7H,MAAO,EAAK,MACZ,OAAQ,EAAK,OACb,KAAM,EAAK,QACX,SAAU,EAAK,WACf,QAAS,EAAU,EAAK,cAuB5B,MApBA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGR,EAAU,EAAK,EAAe,KAAK,SAOzC,OALA,EAAQ,UAAU,OAAO,SAEzB,EAAK,YAAc,EAAQ,OAC3B,EAAK,KAAO,GAAG,EAAQ,wBAAwB,EAAK,OAE7C,MAKZ,CACH,MAAO,GAAG,EAAO,GAAQ,QACzB,KAAM,EACN,KAAM"}