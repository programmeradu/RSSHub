{"version":3,"file":"news-KjkhUh4g.js","names":["NEWS_TYPES: Record<string, NewsCategory>","handler: Route['handler']","got","cache","route: Route"],"sources":["../../lib/routes/catti/news.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\n\r\ntype NewsCategory = {\r\n    title: string;\r\n    description: string;\r\n};\r\n\r\nconst NEWS_TYPES: Record<string, NewsCategory> = {\r\n    ggl: {\r\n        title: '通知公告',\r\n        description: 'CATTI 考试通知和公告',\r\n    },\r\n    ywdt: {\r\n        title: '要闻动态',\r\n        description: 'CATTI 考试要闻动态',\r\n    },\r\n    zxzc: {\r\n        title: '最新政策',\r\n        description: 'CATTI 考试最新政策',\r\n    },\r\n};\r\n\r\nconst handler: Route['handler'] = async (ctx) => {\r\n    const category = ctx.req.param('category');\r\n\r\n    const BASE_URL = `https://www.catticenter.com/${category}`;\r\n\r\n    // Fetch the index page\r\n    const { data: listPage } = await got(BASE_URL);\r\n    const $ = load(listPage);\r\n\r\n    // Select all list items containing news information\r\n    const ITEM_SELECTOR = 'ul.ui-card.ui-card-a > li';\r\n    const listItems = $(ITEM_SELECTOR);\r\n\r\n    // Map through each list item to extract details\r\n    const contentLinkList = listItems.toArray().map((element) => {\r\n        const date = $(element).find('span.ui-right-time').text();\r\n        const title = $(element).find('a').attr('title')!;\r\n        const relativeLink = $(element).find('a').attr('href')!;\r\n        const absoluteLink = `https://www.catticenter.com${relativeLink}`;\r\n        const formattedDate = parseDate(date);\r\n        return {\r\n            date: formattedDate,\r\n            title,\r\n            link: absoluteLink,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: NEWS_TYPES[category].title,\r\n        description: NEWS_TYPES[category].description,\r\n        link: BASE_URL,\r\n        image: 'https://www.catticenter.com/img/applogo.png',\r\n        item: (await Promise.all(\r\n            contentLinkList.map((item) =>\r\n                cache.tryGet(item.link, async () => {\r\n                    const CONTENT_SELECTOR = 'div.ui-article-cont';\r\n                    const { data: contentResponse } = await got(item.link);\r\n                    const contentPage = load(contentResponse);\r\n                    const content = contentPage(CONTENT_SELECTOR).html() || '';\r\n                    return {\r\n                        title: item.title,\r\n                        pubDate: item.date,\r\n                        link: item.link,\r\n                        description: content,\r\n                        category: ['study'],\r\n                        guid: item.link,\r\n                        id: item.link,\r\n                        image: 'https://www.catticenter.com/img/applogo.png',\r\n                        content,\r\n                        updated: item.date,\r\n                        language: 'zh-cn',\r\n                    };\r\n                })\r\n            )\r\n        )) as DataItem[],\r\n        allowEmpty: true,\r\n        language: 'zh-cn',\r\n        feedLink: 'https://rsshub.app/ruankao/news',\r\n        id: 'https://rsshub.app/ruankao/news',\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/news/:category',\r\n    name: 'CATTI 考试消息',\r\n    maintainers: ['PrinOrange'],\r\n    description: `\r\n| Category  | 标题       | 描述                |\r\n|-----------|------------|--------------------|\r\n| ggl       | 通知公告   | CATTI 考试通知和公告 |\r\n| ywdt      | 要闻动态   | CATTI 考试要闻动态   |\r\n| zxzc      | 最新政策   | CATTI 考试最新政策   |\r\n`,\r\n    handler,\r\n    categories: ['study'],\r\n    parameters: {\r\n        category: '消息分类名，可在下面的描述中找到。',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        supportRadar: true,\r\n    },\r\n    example: '/catti/news/zxzc',\r\n    radar: [\r\n        {\r\n            source: ['www.catticenter.com/:category'],\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"wWAWA,MAAMA,EAA2C,CAC7C,IAAK,CACD,MAAO,OACP,YAAa,iBAEjB,KAAM,CACF,MAAO,OACP,YAAa,gBAEjB,KAAM,CACF,MAAO,OACP,YAAa,iBAIfC,EAA4B,KAAO,IAAQ,CAC7C,IAAM,EAAW,EAAI,IAAI,MAAM,YAEzB,EAAW,+BAA+B,IAG1C,CAAE,KAAM,GAAa,MAAMC,EAAI,GAC/B,EAAI,EAAK,GAIT,EAAY,EAAE,6BAGd,EAAkB,EAAU,UAAU,IAAK,GAAY,CACzD,IAAM,EAAO,EAAE,GAAS,KAAK,sBAAsB,OAC7C,EAAQ,EAAE,GAAS,KAAK,KAAK,KAAK,SAClC,EAAe,EAAE,GAAS,KAAK,KAAK,KAAK,QACzC,EAAe,8BAA8B,IAC7C,EAAgB,EAAU,GAChC,MAAO,CACH,KAAM,EACN,QACA,KAAM,KAId,MAAO,CACH,MAAO,EAAW,GAAU,MAC5B,YAAa,EAAW,GAAU,YAClC,KAAM,EACN,MAAO,8CACP,KAAO,MAAM,QAAQ,IACjB,EAAgB,IAAK,GACjBC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GACM,CAAE,KAAM,GAAoB,MAAMD,EAAI,EAAK,MAC3C,EAAc,EAAK,GACnB,EAAU,EAAY,uBAAkB,QAAU,GACxD,MAAO,CACH,MAAO,EAAK,MACZ,QAAS,EAAK,KACd,KAAM,EAAK,KACX,YAAa,EACb,SAAU,CAAC,SACX,KAAM,EAAK,KACX,GAAI,EAAK,KACT,MAAO,8CACP,UACA,QAAS,EAAK,KACd,SAAU,aAK1B,WAAY,GACZ,SAAU,QACV,SAAU,kCACV,GAAI,oCAICE,EAAe,CACxB,KAAM,kBACN,KAAM,aACN,YAAa,CAAC,cACd,YAAa;;;;;;EAOb,UACA,WAAY,CAAC,SACb,WAAY,CACR,SAAU,qBAEd,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,aAAc,IAElB,QAAS,mBACT,MAAO,CACH,CACI,OAAQ,CAAC"}