import{cache_default as e}from"./cache-kimkMTWJ.js";import{got_default as t}from"./got-CdvI2yKX.js";import{fallback as n,queryToBoolean as r,queryToInteger as i}from"./readable-social-D7TWDGpz.js";import{load as a}from"cheerio";import o from"node:querystring";const s={formatTitle:e=>e.replaceAll(/<span class=["']url-icon["']><img\s[^>]*?alt=["']?([^>]+?)["']?\s[^>]*?\/?><\/span>/g,`$1`).replaceAll(/<span class=["']url-icon["']>(<img\s[^>]*>)<\/span>/g,``).replaceAll(/<img\s[^<]*>/g,`[å›¾ç‰‡]`).replaceAll(/<[^<]*>/g,``).replaceAll(`
`,` `).trim(),formatExtended:(e,t,a,c={},l=[])=>{let u=o.parse(e.req.param(`routeParams`)),d={readable:n(c.readable,r(u.readable),!1),authorNameBold:n(c.authorNameBold,r(u.authorNameBold),!1),showAuthorInTitle:n(c.showAuthorInTitle,r(u.showAuthorInTitle),!1),showAuthorInDesc:n(c.showAuthorInDesc,r(u.showAuthorInDesc),!1),showAuthorAvatarInDesc:n(c.showAuthorAvatarInDesc,r(u.showAuthorAvatarInDesc),!1),showAtBeforeAuthor:n(c.showAtBeforeAuthor,null,!1),showEmojiForRetweet:n(c.showEmojiForRetweet,r(u.showEmojiForRetweet),!1),showRetweetTextInTitle:n(c.showRetweetTextInTitle,r(u.showRetweetTextInTitle),!0),addLinkForPics:n(c.addLinkForPics,r(u.addLinkForPics),!1),showTimestampInDescription:n(c.showTimestampInDescription,r(u.showTimestampInDescription),!1),widthOfPics:n(c.widthOfPics,i(u.widthOfPics),-1),heightOfPics:n(c.heightOfPics,i(u.heightOfPics),-1),sizeOfAuthorAvatar:n(c.sizeOfAuthorAvatar,i(u.sizeOfAuthorAvatar),48),showEmojiInDescription:n(c.showEmojiInDescription,i(u.showEmojiInDescription),!0),showLinkIconInDescription:n(c.showLinkIconInDescription,i(u.showLinkIconInDescription),!0),preferMobileLink:n(c.preferMobileLink,r(u.preferMobileLink),!1)};c=d;let{readable:f,authorNameBold:p,showAuthorInTitle:m,showAuthorInDesc:h,showAuthorAvatarInDesc:g,showAtBeforeAuthor:_,showEmojiForRetweet:v,showRetweetTextInTitle:y,addLinkForPics:b,showTimestampInDescription:x,widthOfPics:S,heightOfPics:C,sizeOfAuthorAvatar:w,showEmojiInDescription:T,showLinkIconInDescription:E,preferMobileLink:D}=c,O=``,k=t.longText&&t.longText.longTextContent||t.text||``;T||(k=k.replaceAll(/<span class=["']?url-icon["']?><img\s[^>]*?alt=["']?([^>]+?)["']?\s[^>]*?\/><\/span>/g,`$1`)),E||(k=k.replaceAll(/(<a\s[^>]*>)<span class=["']?url-icon["']?><img\s[^>]*><\/span>[^<>]*?<span class=["']?surl-text["']?>([^<>]*?)<\/span><\/a>/g,`$1$2</a>`));let A=k.match(/<span class=["']?surl-text["']?>#([^<>]*?)#<\/span>/g)?.map(e=>e?.match(/#([^#]+)#/)?.[1]);k=k.replaceAll(`å…¨æ–‡<br>`,`<br>`),k=k.replaceAll(/<a href="(.*?)">å…¨æ–‡<\/a>/g,``),k=k.replaceAll(/"https:\/\/weibo\.cn\/sinaurl.*?[&?]u=(http.*?)"/g,(e,t)=>`"${decodeURIComponent(t)}"`),k=k.replaceAll(/<a\s+href="https?:\/\/[^"]+\.(jpg|png|gif)"/g,e=>`${e} data-rsshub-image="href"`);let j=k.replaceAll(`
`,`<br>`);if(h){let e=`<a href="https://weibo.com/${t.user.id}" target="_blank">`;g&&(e+=`<img width="${w}" height="${w}" src="${t.user.profile_image_url}" ${f?`hspace="8" vspace="8" align="left"`:``} />`);let n=t.user.screen_name;_&&(n=`@`+n),e+=p?`<strong>${n}</strong></a>:&ensp;`:`${n}</a>:&ensp;`,j=e+j}if(t.pics&&!Array.isArray(t.pics)&&typeof t.pics==`object`&&(t.pics=Object.values(t.pics)),t.page_info&&t.page_info.type===`article`&&t.page_info.page_pic&&t.page_info.page_pic.url){let e={large:{url:t.page_info.page_pic.url}};t.pics?t.pics.push(e):t.pics=[e]}let M=t.pics?t.pics.filter(e=>e.type===`livephoto`).length:0,N=t.pics&&t.pics.filter(e=>e.type!==`livephoto`);if(N){f&&(j+=`<br clear="both" /><div style="clear: both"></div>`);let e=``;for(let t of N)e+=`<img width="0" height="0" hidden="true" src="${t.large.url}">`;l.push(e);for(let e of N){b&&(j+=`<a href="`+e.large.url+`">`);let t=``;j+=`<img `,j+=f?`vspace="8" hspace="4"`:``,S>=0&&(j+=` width="${S}"`,t+=`width: ${S}px;`),C>=0&&(j+=` height="${C}"`,t+=`height: ${C}px;`),j+=` style="${t}" src="`+e.large.url+`">`,b&&(j+=`</a>`),k+=`<img src="" />`}}if(t.retweeted_status){j+=f?`<br clear="both" /><div style="clear: both"></div><blockquote style="background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;">`:`<br><blockquote> - è½¬å‘ `,t.retweeted_status.user||(t.retweeted_status.user={profile_image_url:``,screen_name:`[åŸå¾®åšä¸å¯è®¿é—®]`,id:`sorry`});let n=Object.assign({},c);n.showAuthorInDesc=!0,n.showAuthorAvatarInDesc=!1,n.showAtBeforeAuthor=!0,O+=s.formatExtended(e,t.retweeted_status,void 0,n,l).description,j+=O,f&&(j+=`<br><small>åŸåšï¼š<a href="https://weibo.com/${t.retweeted_status.user.id}/${t.retweeted_status.bid}" target="_blank" rel="noopener noreferrer">https://weibo.com/${t.retweeted_status.user.id}/${t.retweeted_status.bid}</a></small>`),x&&(j+=`<br><small>`+new Date(t.retweeted_status.created_at).toLocaleString()+`</small>`),f&&(j+=`<br clear="both" /><div style="clear: both"></div>`),j+=`</blockquote>`}h&&g&&(j=l.join(``)+j);let P=``;m&&(P+=t.user.screen_name+`: `),(!t.retweeted_status||y)&&(P+=s.formatTitle(k)),t.retweeted_status&&(P+=v?`ğŸ” `:` - è½¬å‘ `,P+=s.formatTitle(O)),M>0&&(P+=` `,P+=Array.from({length:M+1}).join(`[Live Photo]`)),t.page_info&&t.page_info===`video`&&(P+=` [è§†é¢‘]`),a=a||t.user?.id;let F=t.bid||t.id,I=a?`https://weibo.com/${a}/${F}`:`https://m.weibo.cn/status/${F}`,L=D?`https://m.weibo.cn/status/${F}`:I,R=[{name:t.user?.screen_name,url:`https://weibo.com/${a}`,avatar:t.user?.avatar_hd}],z=t.created_at;return{description:j,title:P,link:L,guid:I,author:R,pubDate:z,category:A}},getShowData:async(e,n)=>{let r=`https://m.weibo.cn/statuses/show?id=${n}`,i=await t.get(r,{headers:{Referer:`https://m.weibo.cn/u/${e}`,"MWeibo-Pwa":1,"X-Requested-With":`XMLHttpRequest`,"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`}});return i.data.data},formatVideo:(e,t)=>{let n=t.page_info,r=t.pics&&t.pics.filter(e=>e.type===`livephoto`&&e.videoSrc),i=`<br clear="both" /><div style="clear: both"></div>`,a=!1;if(r)for(let e of r)i+=`<video controls="controls" poster="${e.large&&e.large.url||e.url}" src="${e.videoSrc}" style="width: 100%"></video>`,a=!0;if(n&&n.type===`video`){let e=n.page_pic,t=e?e.url:``,r=n.page_url,o=n.media_info||{},s=n.urls||{},c=s.mp4_720p_mp4||o.mp4_720p_mp4||``,l=s.mp4_hd_mp4||o.mp4_hd_url||o.stream_url_hd||``,u=s.hevc_mp4_hd||``,d=s.mp4_ld_mp4||o.mp4_sd_url||o.stream_url||``,f=c||l||u||d;f&&(i+=`<video controls="controls" poster="${t}" style="width: 100%">`,c&&(i+=`<source src="${c}">`),l&&(i+=`<source src="${l}">`),u&&(i+=`<source src="${u}">`),d&&(i+=`<source src="${d}">`),r&&(i+=`<p>è§†é¢‘æ— æ³•æ˜¾ç¤ºï¼Œè¯·å‰å¾€<a href="${r}" target="_blank" rel="noopener noreferrer">å¾®åšè§†é¢‘</a>è§‚çœ‹ã€‚</p>`),i+=`</video>`,a=!0)}return a&&(e+=i),e},formatArticle:async(n,r,i)=>{let o=i.page_info;if(o&&o.type===`article`&&o.page_url){let n=o.page_url,i=n.match(/id=(\d+)/);if(!i)return r;let s=i[1],c=`https://card.weibo.com/article/m/aj/detail?id=${s}`,l=await e.tryGet(c,async()=>{let e=await t.get(c,{headers:{Referer:`https://card.weibo.com/article/m/show/id/${s}`,"MWeibo-Pwa":1,"X-Requested-With":`XMLHttpRequest`,"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`}});return e.data}),u=l.data;if(u&&u.title&&u.content){let e=u.title,t=u.content,n=u.summary,i=u.create_at,o=u.read_count,s=u.is_original,c=u.is_article_free,l=`<br clear="both" /><br clear="both" />`;l+=`<div style="clear: both"></div><div style="background: #fff;border:5px solid #80808030;margin:0;padding:3% 5%;overflow-wrap: break-word">`,l+=`<h1 style="font-size: 1.5rem;line-height: 1.25;color: #333;">${e}</h1>`;let d=`display: inline-block;margin-inline: 0.25rem;width: 2.25rem; height: 1.125rem; background: #eee; border-radius: 2px; box-sizing: border-box; text-align: center; line-height: 1.0625rem; font-size: 0.75rem; color: #aaa;`,f=`<p style="line-height: 1.66; color: #999;margin: 0 0 0.75rem;font-size: 0.75rem;padding: 0">`;c&&(f+=`<span style="${d}">è¯•è¯»</span> `),s&&(f+=`<span style="${d}">åŸåˆ›</span> `),f+=`<span style="margin-inline: 0.25rem;">å‘å¸ƒæ—¶é—´: ${i}</span> `,f+=`<span style="margin-inline: 0.25rem;">é˜…è¯»é‡: ${o}</span> `,f+=`</p>`,l+=f,n&&(l+=`<p style="color: #999;line-height: 1.5rem;padding: 0.0625rem 0 0.875rem;margin: 0">${n}</p>`),l+=`<div style="height: 0;border-bottom: 1px dashed #999;margin-bottom: 0.75rem;"></div>`;let p=a(t);p(`p`).each((e,t)=>{t=p(t);let n=t.attr(`style`)||``;n=`margin: 0;padding: 0;border: 0;`+n,t.attr(`style`,n)}),p(`.image`).each((e,t)=>{t=p(t);let n=t.attr(`style`)||``;n=`display: table;text-align: center;margin-left: auto;margin-right: auto;clear: both;min-width: 50px;`+n,t.attr(`style`,n)}),p(`img`).each((e,t)=>{t=p(t);let n=t.attr(`style`)||``;n=`display: block;max-width: 100%;margin-left: auto;margin-right: auto;min-width: 50px;`+n,t.attr(`style`,n)});let m=p.html();l+=`<div style="line-height: 1.59;text-align: justify;font-size: 1.0625rem;color: #333;">${m}</div>`,l+=`</div>`,r+=l}}return r},formatComments:async(n,r,i,a)=>{if(i&&i.comments_count&&i.id&&i.mid){let n=i.id,o=i.mid,s=`https://m.weibo.cn/comments/hotflow?id=${n}&mid=${o}&max_id_type=0`,c=await e.tryGet(s,async()=>{let e=await t.get(s,{headers:{Referer:`https://m.weibo.cn/detail/${n}`,"MWeibo-Pwa":1,"X-Requested-With":`XMLHttpRequest`,"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`}});return e.data});if(c.data&&c.data.data){let e=c.data.data;r+=`<br clear="both" /><div style="clear: both"></div><div style="background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;">`,r+=`<h3>çƒ­é—¨è¯„è®º</h3>`;for(let t of e){r+=`<p style="margin-bottom: 0.5em;margin-top: 0.5em">`;let e=t.user.screen_name;if(a===`1`&&t.blogger_icons&&(e+=t.blogger_icons[0].name),r+=`<a href="https://weibo.com/${t.user.id}" target="_blank">${e}</a>: ${t.text}`,`pic`in t&&(r+=`<br><img src="${t.pic.url}">`),t.comments){r+=`<blockquote style="border-left:0.2em solid #80808080; margin-left: 0.3em; padding-left: 0.5em; margin-bottom: 0.5em; margin-top: 0.25em">`;for(let e of t.comments){let t=/<a\s+href="https:\/\/weibo\.cn\/sinaurl\?u=([^"]+)"[^>]*><span class='url-icon'><img[^>]*><\/span><span class="surl-text">(æŸ¥çœ‹å›¾ç‰‡|è¯„è®ºé…å›¾|æŸ¥çœ‹åŠ¨å›¾)<\/span><\/a>/g,n=e.text.match(t);if(n)for(let t of n){let n=t.match(/href="https:\/\/weibo\.cn\/sinaurl\?u=([^"]+)"/);if(n){let r=decodeURIComponent(n[1]),i=`<img src="${r}" style="width: 1rem; height: 1rem;">`;e.text=e.text.replaceAll(t,i)}}r+=`<div style="font-size: 0.9em">`;let i=e.user.screen_name;a===`1`&&e.blogger_icons&&(i+=e.blogger_icons[0].name),r+=`<a href="https://weibo.com/${e.user.id}" target="_blank">${i}</a>: ${e.text}`,r+=`</div>`}r+=`</blockquote>`}r+=`</p>`}r+=`</div>`}}return r},sinaimgTvax:(()=>{let e=/(?<=\/\/)wx(?=[1-4]\.sinaimg\.cn\/)/gi,t=t=>t.replaceAll(e,`tvax`),n=(e,n)=>{for(let r of n)e[r]&&(e[r]=t(e[r]))},r=[`description`,`image`],i=[`description`];return e=>{if(e&&(n(e,r),e.item))for(let t of e.item)n(t,i);return e}})()};var c=s;export{c as utils_default};
//# sourceMappingURL=utils-ClHazoih.js.map