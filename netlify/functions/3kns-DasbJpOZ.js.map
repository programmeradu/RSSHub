{"version":3,"file":"3kns-DasbJpOZ.js","names":[],"sources":["../../lib/routes/3kns/index.ts"],"sourcesContent":["import { Data, DataItem, Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport { load } from 'cheerio';\r\nimport { Context } from 'hono';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/:filters?/:order?',\r\n    categories: ['game'],\r\n    example: '/3kns/category=all&lang=all',\r\n    parameters: {\r\n        filters: '过滤器，可用参数见下表',\r\n        order: '排序，按高分排序:desc;按低分排序:asc',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '3k-Switch游戏库',\r\n    maintainers: ['xzzpig'],\r\n    handler,\r\n    url: 'www.3kns.com/',\r\n    description: `游戏类型(category)\r\n\r\n| 不限 | 角色扮演 | 动作冒险 | 策略游戏 | 模拟经营 | 即时战略 | 格斗类 | 射击游戏 | 休闲益智 | 体育运动 | 街机格斗 | 无双类 | 其他游戏 | 赛车竞速 |\r\n| ---- | -------- | -------- | -------- | -------- | -------- | ------ | -------- | -------- | -------- | -------- | ------ | -------- | -------- |\r\n| all  | 1        | 2        | 3        | 4        | 5        | 6      | 7        | 8        | 9        | 10       | 11     | 12       | 13       |\r\n\r\n  游戏语言(language)\r\n\r\n| 不限 | 中文 | 英语 | 日语 | 其他 | 中文汉化 | 德语 |\r\n| ---- | ---- | ---- | ---- | ---- | -------- | ---- |\r\n| all  | 1    | 2    | 3    | 4    | 5        | 6    |\r\n\r\n  游戏标签(tag)\r\n\r\n| 不限 | 热门 | 多人聚会 | 僵尸 | 体感 | 大作 | 音乐 | 三国 | RPG | 格斗 | 闯关 | 横版 | 科幻 | 棋牌 | 运输 | 无双 | 卡通动漫 | 日系 | 养成 | 恐怖 | 运动 | 乙女 | 街机 | 飞行模拟 | 解谜 | 海战 | 战争 | 跑酷 | 即时策略 | 射击 | 经营 | 益智 | 沙盒 | 模拟 | 冒险 | 竞速 | 休闲 | 动作 | 生存 | 独立 | 拼图 | 魔改 xci | 卡牌 | 塔防 |\r\n| ---- | ---- | -------- | ---- | ---- | ---- | ---- | ---- | --- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | -------- | ---- | ---- | ---- | ---- | ---- | ---- | -------- | ---- | ---- | ---- | ---- | -------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | -------- | ---- | ---- |\r\n| all  | 1    | 2        | 3    | 4    | 5    | 6    | 7    | 8   | 9    | 10   | 11   | 12   | 13   | 14   | 15   | 16       | 17   | 18   | 19   | 20   | 21   | 22   | 23       | 24   | 25   | 26   | 27   | 28       | 29   | 30   | 31   | 32   | 33   | 34   | 35   | 36   | 37   | 38   | 39   | 40   | 41       | 42   | 43   |\r\n\r\n  发售时间(pubDate)\r\n\r\n| 不限 | 2017 年 | 2018 年 | 2019 年 | 2020 年 | 2021 年 | 2022 年 | 2023 年 | 2024 年 |\r\n| ---- | ------- | ------- | ------- | ------- | ------- | ------- | ------- | ------- |\r\n| all  | 1       | 2       | 3       | 4       | 5       | 6       | 7       | 8       |\r\n\r\n  游戏集合(collection)\r\n\r\n| 不限 | 舞力全开 | 马里奥 | 生化危机 | 炼金工房 | 最终幻想 | 塞尔达 | 宝可梦 | 勇者斗恶龙 | 模拟器 | 秋之回忆 | 第一方 | 体感健身 | 开放世界 | 儿童乐园 |\r\n| ---- | -------- | ------ | -------- | -------- | -------- | ------ | ------ | ---------- | ------ | -------- | ------ | -------- | -------- | -------- |\r\n| all  | 1        | 2      | 3        | 4        | 5        | 6      | 7      | 8          | 9      | 10       | 11     | 12       | 13       | 14       |`,\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const filters = new URLSearchParams(ctx.req.param('filters'));\r\n    const order = ctx.req.param('order');\r\n\r\n    const category = filters.get('category') ?? 'all';\r\n    const language = filters.get('language') ?? 'all';\r\n    const tag = filters.get('tag') ?? 'all';\r\n    const pubDate = filters.get('pubDate') ?? 'all';\r\n    const collection = filters.get('collection') ?? 'all';\r\n\r\n    const baseUrl = 'https://www.3kns.com/';\r\n    const currentUrl = new URL(`${baseUrl}forum.php?mod=forumdisplay&fid=2&filter=sortid&typeid=0&sortid=1&searchsort=1&orderbystr=0`);\r\n    currentUrl.searchParams.set('dztgeshi', category);\r\n    currentUrl.searchParams.set('dztfenlei', language);\r\n    currentUrl.searchParams.set('nex_sg_tags', tag);\r\n    currentUrl.searchParams.set('deanbgbs', pubDate);\r\n    currentUrl.searchParams.set('nex_sg_stars', collection);\r\n    if (order !== undefined) {\r\n        currentUrl.searchParams.set('ascdescstr', order);\r\n        currentUrl.searchParams.set('orderbystr', 'nex_sg_score');\r\n    }\r\n\r\n    const response = await got(currentUrl);\r\n    const $ = load(response.data as any);\r\n\r\n    const selector = `form .newItem`;\r\n    const items: DataItem[] = $(selector)\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            const title = $item.find('.showname a').text().trim();\r\n            const category = $item.find('.showtype').text().trim();\r\n            const pubDate = ($item.find('.showdate').contents()[0] as any).data.trim();\r\n            return {\r\n                title,\r\n                link: baseUrl + $item.find('.entry-media a').attr('href')!,\r\n                pubDate: parseDate(pubDate ?? ''),\r\n                category: [category],\r\n                description:\r\n                    art(path.join(__dirname, 'templates/description.art'), {\r\n                        cover: $item.find('.entry-media img').attr('src')?.trim().replace('.', baseUrl),\r\n                        title,\r\n                        tid: $item.find('.jb-chakan').text().trim(),\r\n                        category,\r\n                        language: $item.find('.jb-new').text().trim(),\r\n                        pubDate,\r\n                        system: $item.find('.jb-youxxx').text().trim(),\r\n                        score: $item.find('.shownamep').text().trim(),\r\n                        version: $item.find('.jb-youxbb').text().trim(),\r\n                    }) ?? '',\r\n            };\r\n        });\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link: currentUrl.toString(),\r\n        allowEmpty: true,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"oaAQA,MAAa,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,QACb,QAAS,8BACT,WAAY,CACR,QAAS,cACT,MAAO,2BAEX,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,eACN,YAAa,CAAC,UACd,UACA,IAAK,gBACL,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;6JA+BjB,eAAe,EAAQ,EAA6B,CAChD,IAAM,EAAU,IAAI,gBAAgB,EAAI,IAAI,MAAM,YAC5C,EAAQ,EAAI,IAAI,MAAM,SAEtB,EAAW,EAAQ,IAAI,aAAe,MACtC,EAAW,EAAQ,IAAI,aAAe,MACtC,EAAM,EAAQ,IAAI,QAAU,MAC5B,EAAU,EAAQ,IAAI,YAAc,MACpC,EAAa,EAAQ,IAAI,eAAiB,MAE1C,EAAU,wBACV,EAAa,IAAI,IAAI,GAAG,EAAQ,6FACtC,EAAW,aAAa,IAAI,WAAY,GACxC,EAAW,aAAa,IAAI,YAAa,GACzC,EAAW,aAAa,IAAI,cAAe,GAC3C,EAAW,aAAa,IAAI,WAAY,GACxC,EAAW,aAAa,IAAI,eAAgB,GACxC,IAAU,IAAA,KACV,EAAW,aAAa,IAAI,aAAc,GAC1C,EAAW,aAAa,IAAI,aAAc,iBAG9C,IAAM,EAAW,MAAM,EAAI,GACrB,EAAI,EAAK,EAAS,MAGlB,EAAoB,EAAE,iBACvB,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GACV,EAAQ,EAAM,KAAK,eAAe,OAAO,OACzC,EAAW,EAAM,KAAK,aAAa,OAAO,OAC1C,EAAW,EAAM,KAAK,aAAa,WAAW,GAAW,KAAK,OACpE,MAAO,CACH,QACA,KAAM,EAAU,EAAM,KAAK,kBAAkB,KAAK,QAClD,QAAS,EAAU,GAAW,IAC9B,SAAU,CAAC,GACX,YACI,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACnD,MAAO,EAAM,KAAK,oBAAoB,KAAK,QAAQ,OAAO,QAAQ,IAAK,GACvE,QACA,IAAK,EAAM,KAAK,cAAc,OAAO,OACrC,SAAA,EACA,SAAU,EAAM,KAAK,WAAW,OAAO,OACvC,QAAA,EACA,OAAQ,EAAM,KAAK,cAAc,OAAO,OACxC,MAAO,EAAM,KAAK,cAAc,OAAO,OACvC,QAAS,EAAM,KAAK,cAAc,OAAO,UACvC,MAItB,MAAO,CACH,MAAO,EAAE,SAAS,OAClB,KAAM,EAAW,WACjB,WAAY,GACZ,KAAM"}