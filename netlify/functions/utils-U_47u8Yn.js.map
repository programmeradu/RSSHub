{"version":3,"file":"utils-U_47u8Yn.js","names":[],"sources":["../../lib/routes/science/utils.ts"],"sourcesContent":["import { load } from 'cheerio';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst baseUrl = 'https://www.science.org';\r\n\r\nconst fetchDesc = (list, browser, tryGet) =>\r\n    Promise.all(\r\n        list.map((item) =>\r\n            tryGet(item.link, async () => {\r\n                const page = await browser.newPage();\r\n                await page.setRequestInterception(true);\r\n                page.on('request', (request) => {\r\n                    request.resourceType() === 'document' || request.resourceType() === 'script' ? request.continue() : request.abort();\r\n                });\r\n\r\n                await page.goto(item.link, {\r\n                    waitUntil: 'domcontentloaded',\r\n                });\r\n                await page.waitForSelector('section#bodymatter, .news-article-content, .news-article-content--featured');\r\n                const res = await page.evaluate(() => document.documentElement.innerHTML);\r\n                await page.close();\r\n\r\n                const $ = load(res);\r\n                const abstract = $('div#abstracts').html();\r\n                const content = $('.news-article-content--featured').length\r\n                    ? $('.news-article-content--featured').html()\r\n                    : $('.news-article-content').length\r\n                      ? $('.news-article-content').html()\r\n                      : $('.info-panel__formats a.btn__request-access').length || $('.info-panel__formats a.btn--access').length\r\n                        ? ''\r\n                        : $('section#bodymatter').html();\r\n\r\n                item.description = art(path.join(__dirname, 'templates/article.art'), {\r\n                    abs: abstract,\r\n                    content,\r\n                });\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\nconst getItem = (item, $) => {\r\n    item = $(item);\r\n    return {\r\n        title: item.find('.article-title a').attr('title'),\r\n        link: `${baseUrl}${item.find('.article-title a').attr('href')}`,\r\n        doi: item.find('.article-title a').attr('href').replace('/doi/', ''),\r\n        pubDate: parseDate(item.find('.card-meta__item time').text()),\r\n        author: item\r\n            .find('.card-meta ul[title=\"list of authors\"] li')\r\n            .toArray()\r\n            .map((author) => $(author).text())\r\n            .join(', '),\r\n    };\r\n};\r\n\r\nexport { baseUrl, fetchDesc, getItem };\r\n"],"mappings":"oOAKA,MAAM,EAAU,0BAEV,GAAa,EAAM,EAAS,IAC9B,QAAQ,IACJ,EAAK,IAAK,GACN,EAAO,EAAK,KAAM,SAAY,CAC1B,IAAM,EAAO,MAAM,EAAQ,UAC3B,MAAM,EAAK,uBAAuB,IAClC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,YAAc,EAAQ,iBAAmB,SAAW,EAAQ,WAAa,EAAQ,UAGhH,MAAM,EAAK,KAAK,EAAK,KAAM,CACvB,UAAW,qBAEf,MAAM,EAAK,gBAAgB,8EAC3B,IAAM,EAAM,MAAM,EAAK,aAAe,SAAS,gBAAgB,WAC/D,MAAM,EAAK,QAEX,IAAM,EAAI,EAAK,GACT,EAAW,EAAE,iBAAiB,OAC9B,EAAU,EAAE,mCAAmC,OAC/C,EAAE,mCAAmC,OACrC,EAAE,yBAAyB,OACzB,EAAE,yBAAyB,OAC3B,EAAE,8CAA8C,QAAU,EAAE,sCAAsC,OAChG,GACA,EAAE,sBAAsB,OAOlC,MALA,GAAK,YAAc,EAAI,EAAA,KAAA,EAAA,kCAA+C,CAClE,IAAK,EACL,YAGG,MAKjB,GAAW,EAAM,KACnB,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,oBAAoB,KAAK,SAC1C,KAAM,GAAG,IAAU,EAAK,KAAK,oBAAoB,KAAK,UACtD,IAAK,EAAK,KAAK,oBAAoB,KAAK,QAAQ,QAAQ,QAAS,IACjE,QAAS,EAAU,EAAK,KAAK,yBAAyB,QACtD,OAAQ,EACH,KAAK,6CACL,UACA,IAAK,GAAW,EAAE,GAAQ,QAC1B,KAAK"}