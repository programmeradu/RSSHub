import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{config as n}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as r}from"./cache-kimkMTWJ.js";import{art as i}from"./render-CxhTJIsl.js";import{parseDate as a}from"./parse-date-Bgabdhlb.js";import{md5 as o}from"./md5-4BNsOP-F.js";import"./ofetch-Bzt0BXUH.js";import{got_default as s}from"./got-CdvI2yKX.js";import{ViewType as c}from"./types-A5bA50Mg.js";import l from"node:path";t();const u=e=>{let t=``,n=()=>{let e=Math.floor(62*Math.random());return e<10?e:e<36?String.fromCharCode(e+55):String.fromCharCode(e+61)};for(;t.length<e;)t+=n();return`h5_${t}`},d=e=>{let t=new URLSearchParams(e);return t.sort(),o(`${t.toString()}_1Ftjv0bfpVmqbE38`)},f={path:`/program/:programId`,categories:[`multimedia`],view:c.Audios,example:`/tingtingfm/program/M7VJv6Jj4R`,parameters:{programId:`节目 ID，可以在 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!0,supportScihub:!1},radar:[{source:[`mobile.tingtingfm.com/v3/program/:programId`]}],name:`节目`,maintainers:[`TonyRL`],handler:p};async function p(t){let o=t.req.param(`programId`),c=`https://api-v3.tingtingfm.com`,f=`https://mobile.tingtingfm.com`,p={version:`h5_5.16`,client:u(30),h_program_id:o},m=await r.tryGet(`tingtingfm:program:${o}`,async()=>{let{data:e}=await s.post(`${c}//broadcast/get_program_v3_8`,{searchParams:{...p,api_sign:d(p)}});if(e.errno!==0)throw Error(e.error);return e.data.info}),h=await r.tryGet(`tingtingfm:audio_list:${o}`,async()=>{let{data:e}=await s.post(`${c}//broadcast/get_program_audio_list`,{searchParams:{...p,api_sign:d(p)}});if(e.errno!==0)throw Error(e.error);return e.data[0]},n.cache.routeExpire,!1),g=await r.tryGet(`tingtingfm:play_audio:${o}`,async()=>{let e={...Object.fromEntries(Object.entries(p).filter(([e])=>e!==`h_program_id`)),type:``,sort:`-1`,audio_id:h.h_audio_id},{data:t}=await s.post(`${c}//albumaudio/play_audio`,{searchParams:{...e,api_sign:d(e)}});if(t.errno!==0)throw Error(t.error);return{radioCover:t.data.info.radio_cover,list:t.data.list}},n.cache.routeExpire,!1),{radioCover:_,list:v}=g,y=v.map(t=>({title:t.title,link:`${f}/v3/vod/2/${t.h_audio_id}`,description:i(l.join(e,`templates/audio-b9ec9fdd.art`),{url:t.play_url}),pubDate:a(t.add_time,`X`),itunes_item_image:_,itunes_duration:t.duration,enclosure_url:t.play_url,enclosure_type:`audio/x-m4a`}));return{title:`${m.title} - ${m.belong_radio}${m.belong_fm}`,description:m.description,link:`${f}/v3/program/${o}`,image:m.cover.split(`?x-oss`)[0],itunes_author:m.anchor.join(`, `),itunes_category:m.category,itunes_explicit:!1,item:y}}export{f as route};
//# sourceMappingURL=program-Li8-0mA_.js.map