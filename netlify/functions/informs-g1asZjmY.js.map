{"version":3,"file":"informs-g1asZjmY.js","names":[],"sources":["../../lib/routes/informs/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport { config } from '@/config';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst rootUrl = 'https://pubsonline.informs.org';\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    categories: ['journal'],\r\n    example: '/informs/mnsc',\r\n    parameters: { category: 'Category, can be found in the url of the page, `orsc` by default' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Category',\r\n    maintainers: ['Fatpandac'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? 'orsc';\r\n    const cateUrl = `${rootUrl}/toc/${category}/0/0`;\r\n\r\n    const getCookie = () =>\r\n        cache.tryGet(cateUrl, async () => {\r\n            const setCookiesUrl = `${cateUrl}?cookieSet=1`;\r\n\r\n            const response = await got.extend({ followRedirect: false }).get(setCookiesUrl, {\r\n                headers: {\r\n                    Referer: cateUrl,\r\n                },\r\n            });\r\n            const cookie = response.headers['set-cookie']\r\n                .slice(1)\r\n                .map((item) => item.split(';')[0])\r\n                .join('; ');\r\n\r\n            return cookie;\r\n        });\r\n\r\n    const response = await got.get(cateUrl, {\r\n        headers: {\r\n            referer: cateUrl,\r\n            'User-Agent': config.ua,\r\n            cookie: await getCookie(),\r\n        },\r\n    });\r\n    const $ = load(response.data);\r\n    const list = $('div.issue-item')\r\n        .slice(0, 10)\r\n        .toArray()\r\n        .map((item) => ({\r\n            title: $(item).find('h5.issue-item__title').text(),\r\n            link: `${rootUrl}${$(item).find('h5.issue-item__title > a').attr('href')}`,\r\n            pubDate: parseDate($(item).find('div.rlist--inline.separator.toc-item__detail > p').remove('span').text()),\r\n        }));\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got.get(item.link, {\r\n                    headers: {\r\n                        referer: cateUrl,\r\n                        'User-Agent': config.ua,\r\n                        cookie: await getCookie(),\r\n                    },\r\n                });\r\n                const detail = load(detailResponse.data);\r\n                item.description = art(path.join(__dirname, 'templates/content.art'), {\r\n                    author: detail('div.accordion-tabbed.loa-accordion').text(),\r\n                    content: detail('div.hlFld-Abstract').find('h2').replaceWith($('<h2>Abstract </h2>')).end().html(),\r\n                });\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `INFORMS - ${category}`,\r\n        link: cateUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"yeAUA,MAAM,EAAU,iCAEH,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,WACb,QAAS,gBACT,WAAY,CAAE,SAAU,oEACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,WACN,YAAa,CAAC,aACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,OACxC,EAAU,GAAG,EAAQ,OAAO,EAAS,MAErC,MACF,EAAM,OAAO,EAAS,SAAY,CAC9B,IAAM,EAAgB,GAAG,EAAQ,cAE3B,EAAW,MAAM,EAAI,OAAO,CAAE,eAAgB,KAAS,IAAI,EAAe,CAC5E,QAAS,CACL,QAAS,KAGX,EAAS,EAAS,QAAQ,cAC3B,MAAM,GACN,IAAK,GAAS,EAAK,MAAM,KAAK,IAC9B,KAAK,MAEV,OAAO,IAGT,EAAW,MAAM,EAAI,IAAI,EAAS,CACpC,QAAS,CACL,QAAS,EACT,aAAc,EAAO,GACrB,OAAQ,MAAM,OAGhB,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,kBACV,MAAM,EAAG,IACT,UACA,IAAK,IAAU,CACZ,MAAO,EAAE,GAAM,KAAK,wBAAwB,OAC5C,KAAM,GAAG,IAAU,EAAE,GAAM,KAAK,4BAA4B,KAAK,UACjE,QAAS,EAAU,EAAE,GAAM,KAAK,oDAAoD,OAAO,QAAQ,WAErG,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACN,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAM,EAAI,IAAI,EAAK,KAAM,CAC5C,QAAS,CACL,QAAS,EACT,aAAc,EAAO,GACrB,OAAQ,MAAM,OAGhB,EAAS,EAAK,EAAe,MAMnC,MALA,GAAK,YAAc,EAAI,EAAA,KAAA,EAAA,kCAA+C,CAClE,OAAQ,EAAO,sCAAsC,OACrD,QAAS,EAAO,sBAAsB,KAAK,MAAM,YAAY,EAAE,uBAAuB,MAAM,SAGzF,MAKnB,MAAO,CACH,MAAO,aAAa,IACpB,KAAM,EACN,KAAM"}