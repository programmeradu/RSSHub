{"version":3,"file":"level-fc4cWFFC.js","names":["route: Route","got"],"sources":["../../lib/routes/yomujp/level.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport md5 from '@/utils/md5';\r\n\r\nexport const route: Route = {\r\n    path: '/:level?',\r\n    categories: ['reading'],\r\n    example: '/yomujp/n1',\r\n    parameters: { level: '等级，n1~n6，为空默认全部' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['yomujp.com/', 'yomujp.com/:level'],\r\n            target: '/:level',\r\n        },\r\n    ],\r\n    name: '等级',\r\n    maintainers: ['eternasuno'],\r\n    handler,\r\n    url: 'yomujp.com/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const level = formatLevel(ctx.req.param('level'));\r\n    const url = new URL('https://yomujp.com/wp-json/wp/v2/posts');\r\n    url.searchParams.append('categories', getLevel(level));\r\n    url.searchParams.append('per_page', Number.parseInt(ctx.req.query('limit')) || 10);\r\n    const posts = await get(url);\r\n\r\n    const item = posts.map((post) => {\r\n        const $ = load(post.content.rendered.replaceAll(/[\\t\\n\\r]/g, ''));\r\n        const audio = $('audio.vapfem_audio>source');\r\n        const description = $('section')\r\n            .slice(2, -2)\r\n            .find('.elementor-widget-text-editor>div,.elementor-widget-image>div>img')\r\n            .toArray()\r\n            .map((el) => {\r\n                if (el.tagName === 'img') {\r\n                    return `<img src=${el.attribs.src} />`;\r\n                } else if (el.firstChild.tagName === 'p') {\r\n                    return `<p>${$(el.firstChild).html()}</p>`;\r\n                } else {\r\n                    return `<p>${$(el).html()}</p>`;\r\n                }\r\n            })\r\n            .join('');\r\n\r\n        return {\r\n            title: post.title.rendered,\r\n            author: $('section:last-of-type p:first-of-type').text().replace(/^.+：/, ''),\r\n            description,\r\n            pubDate: parseDate(post.date_gmt),\r\n            updated: parseDate(post.modified_gmt),\r\n            guid: md5(post.guid.rendered),\r\n            link: post.link,\r\n            itunes_item_image: $('section:nth-of-type(2) img').attr('src'),\r\n            enclosure_url: audio.attr('src'),\r\n            enclosure_type: audio.attr('type'),\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: level ? `${level.toUpperCase()} | 日本語多読道場` : '日本語多読道場',\r\n        link: `https://yomujp.com/${level}`,\r\n        description: 'みなさん、こんにちは。 「 日本語多読道場(にほんごたどくどうじょう) Yomujp」は日本語を勉強する人のための読みものサイト（website）です。 日本の地理、食べもの、動物、植物、文化や歴史などを紹介します。',\r\n        language: 'ja-jp',\r\n        itunes_author: 'Yomujp',\r\n        image: 'https://yomujp.com/wp-content/uploads/2023/08/top1-2-300x99-1.png',\r\n        item,\r\n    };\r\n}\r\n\r\nconst formatLevel = (level) => {\r\n    const lowerCaseLevel = level?.toLowerCase();\r\n\r\n    switch (lowerCaseLevel) {\r\n        case 'n6':\r\n            return 'n5l';\r\n\r\n        case 'n5l':\r\n        case 'n5':\r\n        case 'n4':\r\n        case 'n3':\r\n        case 'n2':\r\n        case 'n1':\r\n            return lowerCaseLevel;\r\n\r\n        default:\r\n            return '';\r\n    }\r\n};\r\n\r\nconst getLevel = (level) => {\r\n    switch (level) {\r\n        case 'n6':\r\n        case 'n5l':\r\n            return '27';\r\n        case 'n5':\r\n            return '26';\r\n        case 'n4':\r\n            return '21';\r\n        case 'n3':\r\n            return '20';\r\n        case 'n2':\r\n            return '19';\r\n        case 'n1':\r\n            return '17';\r\n\r\n        default:\r\n            return '17,19,20,21,26,27';\r\n    }\r\n};\r\n\r\nconst get = async (url) => {\r\n    const response = await got({ method: 'get', url });\r\n\r\n    return response.data;\r\n};\r\n"],"mappings":"4VAMA,MAAaA,EAAe,CACxB,KAAM,WACN,WAAY,CAAC,WACb,QAAS,aACT,WAAY,CAAE,MAAO,mBACrB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,cAAe,qBACxB,OAAQ,YAGhB,KAAM,KACN,YAAa,CAAC,cACd,UACA,IAAK,eAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAY,EAAI,IAAI,MAAM,UAClC,EAAM,IAAI,IAAI,0CACpB,EAAI,aAAa,OAAO,aAAc,EAAS,IAC/C,EAAI,aAAa,OAAO,WAAY,OAAO,SAAS,EAAI,IAAI,MAAM,WAAa,IAC/E,IAAM,EAAQ,MAAM,EAAI,GAElB,EAAO,EAAM,IAAK,GAAS,CAC7B,IAAM,EAAI,EAAK,EAAK,QAAQ,SAAS,WAAW,YAAa,KACvD,EAAQ,EAAE,6BACV,EAAc,EAAE,WACjB,MAAM,EAAG,IACT,KAAK,qEACL,UACA,IAAK,GACE,EAAG,UAAY,MACR,YAAY,EAAG,QAAQ,IAAI,KAC3B,EAAG,WAAW,UAAY,IAC1B,MAAM,EAAE,EAAG,YAAY,OAAO,MAE9B,MAAM,EAAE,GAAI,OAAO,OAGjC,KAAK,IAEV,MAAO,CACH,MAAO,EAAK,MAAM,SAClB,OAAQ,EAAE,wCAAwC,OAAO,QAAQ,OAAQ,IACzE,cACA,QAAS,EAAU,EAAK,UACxB,QAAS,EAAU,EAAK,cACxB,KAAM,EAAI,EAAK,KAAK,UACpB,KAAM,EAAK,KACX,kBAAmB,EAAE,8BAA8B,KAAK,OACxD,cAAe,EAAM,KAAK,OAC1B,eAAgB,EAAM,KAAK,WAInC,MAAO,CACH,MAAO,EAAQ,GAAG,EAAM,cAAc,YAAc,UACpD,KAAM,sBAAsB,IAC5B,YAAa,+GACb,SAAU,QACV,cAAe,SACf,MAAO,oEACP,QAIR,MAAM,EAAe,GAAU,CAC3B,IAAM,EAAiB,GAAO,cAE9B,OAAQ,EAAR,CACI,IAAK,KACD,MAAO,MAEX,IAAK,MACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACD,OAAO,EAEX,QACI,MAAO,KAIb,EAAY,GAAU,CACxB,OAAQ,EAAR,CACI,IAAK,KACL,IAAK,MACD,MAAO,KACX,IAAK,KACD,MAAO,KACX,IAAK,KACD,MAAO,KACX,IAAK,KACD,MAAO,KACX,IAAK,KACD,MAAO,KACX,IAAK,KACD,MAAO,KAEX,QACI,MAAO,sBAIb,EAAM,KAAO,IAAQ,CACvB,IAAM,EAAW,MAAMC,EAAI,CAAE,OAAQ,MAAO,QAE5C,OAAO,EAAS"}