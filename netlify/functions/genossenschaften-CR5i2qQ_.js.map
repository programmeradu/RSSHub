{"version":3,"file":"genossenschaften-CR5i2qQ_.js","names":["route: Route","ofetch","el"],"sources":["../../lib/routes/genossenschaften/index.ts"],"sourcesContent":["import { load } from 'cheerio';\r\nimport ofetch from '@/utils/ofetch';\r\nimport type { Data, DataItem, Route } from '@/types';\r\n\r\nconst FEED_TITLE = 'Genossenschaften.immo' as const;\r\nconst FEED_LOGO = 'https://genossenschaften.immo/static/gimmo/img/favicon/favicon-128x128.png' as const;\r\nconst FEED_LANGUAGE = 'de' as const;\r\nconst BASE_URL = 'https://genossenschaften.immo' as const;\r\nconst PATH_PREFIX = '/genossenschaften/' as const;\r\n\r\nexport const route: Route = {\r\n    name: 'Immobiliensuche',\r\n    path: '*',\r\n    maintainers: ['sk22'],\r\n    categories: ['other'],\r\n    description: `\r\nNote that all parameters are optional and many can be specified multiple times\r\n(e.g. \\`district=wien-1-innere-stadt&district=wien-2-leopoldstadt\\`).\r\n\r\nOnly returns the first page of search results, allowing you to keep track of\r\nnewly added apartments. If you're looking for an apartment, make sure to also\r\nlook through the other pages on the website.\r\n\r\n:::tip\r\nTo get your query URL, go to https://genossenschaften.immo and apply all\r\ndesired filters. If you want to filter by (all districts of a) federal state\r\n(e.g. \\`/immobilien/regionen/wien/\\`), please open the district selector and\r\nde- and re-select any district, so that the region in the URL gets replaced\r\nwith a number of \\`district\\` parameters. Once you've set up all desired\r\nfilters, copy the part of the URL after the \\`?\\`.\r\n:::\r\n`,\r\n    example:\r\n        PATH_PREFIX +\r\n        'district=wien-1-innere-stadt&district=wien-2-leopoldstadt&district=wien-3-landstrasse&district=wien-4-wieden&district=wien-5-margareten&district=wien-6-mariahilf&district=wien-7-neubau&district=wien-8-josefstadt&district=wien-9-alsergrund&district=wien-10-favoriten&district=wien-11-simmering&district=wien-12-meidling&district=wien-13-hietzing&district=wien-14-penzing&district=wien-15-rudolfsheim-fuenfhaus&district=wien-16-ottakring&district=wien-17-hernals&district=wien-18-waehring&district=wien-19-doebling&district=wien-20-brigittenau&district=wien-21-floridsdorf&district=wien-22-donaustadt&district=wien-23-liesing' +\r\n        '&has_rent=on&has_rent_option=on' +\r\n        '&status=available&status=construction' +\r\n        '&cost=1000&room=2&size=50' +\r\n        '&has_property=off&has_rent=on&has_rent_option=on' +\r\n        '&status=available&status=construction&status=planned' +\r\n        '&type=residence&type=project',\r\n    parameters: {\r\n        // labels are in german language because it's the same on the website\r\n        cost: 'Miete bis (in €, number)',\r\n        district: 'Bezirk (string, multiple)',\r\n        size: 'Größe ab (in m², number)',\r\n        room: 'Zimmer ab (number)',\r\n        genossenschaft: 'Bauvereinigung (string, multiple)',\r\n        own_funds: 'Eigenkapital bis',\r\n        has_property: 'Eigentum (`on` | `off`)',\r\n        has_rent: 'Miete (`on` | `off`)',\r\n        has_rent_option: 'Miete mit Kaufoption (`on` | `off`)',\r\n        status: 'multiple, `available` | `construction` | `planned`',\r\n        type: 'multiple, `residence` | `project`',\r\n        keywords: 'Keyword search',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    async handler(ctx) {\r\n        let path = ctx.req.path.slice(PATH_PREFIX.length);\r\n        if (path.startsWith('&')) {\r\n            // in case request url is something like `/genossenschaften/&cost=…`\r\n            path = path.slice(1);\r\n        }\r\n\r\n        const link = `${BASE_URL}/?${path}`;\r\n        const response = await ofetch(link);\r\n        const $ = load(response);\r\n\r\n        const items = $('[itemtype=\"https://schema.org/Apartment\"]')\r\n            .toArray()\r\n            .map((el) => {\r\n                const $el = $(el);\r\n                const name = $el.find('[itemprop=name]').text();\r\n                const body = $el.find('.card-body').text().trim();\r\n                // UTC timestamp: <time datetime=\"2025-01-07T15:48:07.089153\">\r\n                const dateTime = $el.find('time').attr('datetime');\r\n                const itemPubDate = dateTime ? new Date(dateTime + 'Z') : undefined;\r\n                const itemLink = BASE_URL + $el.find('[itemprop=url]').attr('href');\r\n                const itemImage = $el.find('[itemprop=image]').attr('href');\r\n\r\n                // e.g. ['2', '60,00 m²', '500,00 €', '10.000,00 €']\r\n                const numbers = $el\r\n                    .find('.card-body .fs-5')\r\n                    .toArray()\r\n                    .map((el) => $(el).text().trim());\r\n\r\n                // e.g. ['Verfügbar', 'OEVW', 'Miete', 'Wohneinheit']\r\n                const itemCategories = $el\r\n                    .find('.badge')\r\n                    .toArray()\r\n                    .map((el) => $(el).text().trim());\r\n\r\n                const titleAppendix = numbers.length ? ` | ${numbers.join(' · ')}` : '';\r\n                const itemTitle = name + titleAppendix;\r\n                const itemDescription = itemCategories.join(' · ') + (body.length ? ` / ${body}` : '');\r\n\r\n                return {\r\n                    title: itemTitle,\r\n                    link: itemLink,\r\n                    pubDate: itemPubDate,\r\n                    description: itemDescription,\r\n                    category: itemCategories,\r\n                    image: itemImage,\r\n                } satisfies DataItem;\r\n            });\r\n\r\n        return {\r\n            title: FEED_TITLE,\r\n            language: FEED_LANGUAGE,\r\n            logo: FEED_LOGO,\r\n            allowEmpty: true,\r\n            item: items,\r\n            link,\r\n        } satisfies Data;\r\n    },\r\n};\r\n"],"mappings":"0MAIA,MAGM,EAAW,gCAGJA,EAAe,CACxB,KAAM,kBACN,KAAM,IACN,YAAa,CAAC,QACd,WAAY,CAAC,SACb,YAAa;;;;;;;;;;;;;;;;EAiBb,QACI,i2BAQJ,WAAY,CAER,KAAM,2BACN,SAAU,4BACV,KAAM,2BACN,KAAM,qBACN,eAAgB,oCAChB,UAAW,mBACX,aAAc,0BACd,SAAU,uBACV,gBAAiB,sCACjB,OAAQ,qDACR,KAAM,oCACN,SAAU,kBAEd,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAM,QAAQ,EAAK,CACf,IAAI,EAAO,EAAI,IAAI,KAAK,MAAM,IAC1B,EAAK,WAAW,OAEhB,EAAO,EAAK,MAAM,IAGtB,IAAM,EAAO,GAAG,EAAS,IAAI,IACvB,EAAW,MAAMC,EAAO,GACxB,EAAI,EAAK,GAET,EAAQ,EAAE,6CACX,UACA,IAAK,GAAO,CACT,IAAM,EAAM,EAAE,GACR,EAAO,EAAI,KAAK,mBAAmB,OACnC,EAAO,EAAI,KAAK,cAAc,OAAO,OAErC,EAAW,EAAI,KAAK,QAAQ,KAAK,YACjC,EAAc,EAAW,IAAI,KAAK,EAAW,KAAO,IAAA,GACpD,EAAW,EAAW,EAAI,KAAK,kBAAkB,KAAK,QACtD,EAAY,EAAI,KAAK,oBAAoB,KAAK,QAG9C,EAAU,EACX,KAAK,oBACL,UACA,IAAK,GAAO,EAAEC,GAAI,OAAO,QAGxB,EAAiB,EAClB,KAAK,UACL,UACA,IAAK,GAAO,EAAEA,GAAI,OAAO,QAExB,EAAgB,EAAQ,OAAS,MAAM,EAAQ,KAAK,SAAW,GAC/D,EAAY,EAAO,EACnB,EAAkB,EAAe,KAAK,QAAU,EAAK,OAAS,MAAM,IAAS,IAEnF,MAAO,CACH,MAAO,EACP,KAAM,EACN,QAAS,EACT,YAAa,EACb,SAAU,EACV,MAAO,KAInB,MAAO,CACH,MAAO,wBACP,SAAU,KACV,KAAM,6EACN,WAAY,GACZ,KAAM,EACN"}