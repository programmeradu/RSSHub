{"version":3,"file":"utils-Cwjm0V9b.js","names":["cache","got"],"sources":["../../lib/routes/guokr/utils.ts"],"sourcesContent":["import { parseDate } from '@/utils/parse-date';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport * as cheerio from 'cheerio';\r\n\r\nexport const parseList = (result) =>\r\n    result.map((item) => ({\r\n        title: item.title,\r\n        description: item.summary,\r\n        pubDate: parseDate(item.date_published),\r\n        link: `https://www.guokr.com/article/${item.id}/`,\r\n        author: item.author.nickname,\r\n        category: item.subject?.name,\r\n        id: item.id,\r\n        channels: item.channels,\r\n    }));\r\n\r\nexport const parseItem = (item) =>\r\n    cache.tryGet(item.link, async () => {\r\n        const { data: res } = await got(`https://apis.guokr.com/minisite/article/${item.id}.json`);\r\n        const $ = cheerio.load(res.result.content);\r\n\r\n        $('#meta_content').remove();\r\n        $('div').each((_, elem) => {\r\n            const $elem = $(elem);\r\n            $elem.attr('style', $elem.attr('style')?.replaceAll(/(?:display:\\s*none|visibility:\\s*hidden|opacity:\\s*0);?/g, ''));\r\n        });\r\n        $('img').each((_, elem) => {\r\n            const $elem = $(elem);\r\n            if ($elem.attr('data-src')) {\r\n                $elem.attr('src', $elem.attr('data-src'));\r\n            }\r\n        });\r\n        item.description = $.html();\r\n\r\n        return item;\r\n    });\r\n"],"mappings":"mLAKA,MAAa,EAAa,GACtB,EAAO,IAAK,IAAU,CAClB,MAAO,EAAK,MACZ,YAAa,EAAK,QAClB,QAAS,EAAU,EAAK,gBACxB,KAAM,iCAAiC,EAAK,GAAG,GAC/C,OAAQ,EAAK,OAAO,SACpB,SAAU,EAAK,SAAS,KACxB,GAAI,EAAK,GACT,SAAU,EAAK,YAGV,EAAa,GACtBA,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAQ,MAAMC,EAAI,2CAA2C,EAAK,GAAG,QAC7E,EAAI,EAAQ,KAAK,EAAI,OAAO,SAelC,OAbA,EAAE,iBAAiB,SACnB,EAAE,OAAO,MAAM,EAAG,IAAS,CACvB,IAAM,EAAQ,EAAE,GAChB,EAAM,KAAK,QAAS,EAAM,KAAK,UAAU,WAAW,2DAA4D,OAEpH,EAAE,OAAO,MAAM,EAAG,IAAS,CACvB,IAAM,EAAQ,EAAE,GACZ,EAAM,KAAK,aACX,EAAM,KAAK,MAAO,EAAM,KAAK,eAGrC,EAAK,YAAc,EAAE,OAEd"}