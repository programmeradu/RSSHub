{"version":3,"file":"weekly-CVz_8FVz.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/docschina/weekly.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport markdownit from 'markdown-it';\r\n\r\nconst md = markdownit({\r\n    html: true,\r\n    breaks: true,\r\n});\r\n\r\nexport const route: Route = {\r\n    path: '/weekly/:category?',\r\n    categories: ['programming'],\r\n    example: '/docschina/weekly',\r\n    parameters: { category: '周刊分类，见下表，默认为js' },\r\n    name: '周刊 - JavaScript',\r\n    maintainers: ['daijinru', 'hestudy'],\r\n    handler,\r\n    description: `| javascript | node | react |\r\n| ---------- | ---- | ----- |\r\n| js         | node | react |`,\r\n    radar: [\r\n        {\r\n            source: ['docschina.org/news/weekly/js/*', 'docschina.org/news/weekly/js', 'docschina.org/'],\r\n            target: '/jsweekly',\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'js' } = ctx.req.param();\r\n\r\n    const baseURL = 'https://docschina.org';\r\n    const path = `/news/weekly/${category}`;\r\n    const url = `${baseURL}${path}`;\r\n    const { data: res } = await got(url);\r\n    // @ts-ignore\r\n    const $ = load(res);\r\n\r\n    const title = $('head title').text();\r\n    const dataEl = $('#__NEXT_DATA__');\r\n    const dataText = dataEl.text();\r\n    const data = JSON.parse(dataText);\r\n    const items = await Promise.all(\r\n        data?.props?.pageProps?.data?.slice(0, 10).map((item) => {\r\n            const link = `${url}/${item.issue}`;\r\n            return cache.tryGet(link, async () => {\r\n                const { data: response } = await got(`${baseURL}/_next/data/${data.buildId}/news/weekly/js/${item.issue}.json`);\r\n                return {\r\n                    title: item.title,\r\n                    description: md.render(response.pageProps.content),\r\n                    link,\r\n                    author: item.editors?.join(','),\r\n                    itunes_item_image: item.imageUrl,\r\n                };\r\n            });\r\n        }) || {}\r\n    );\r\n\r\n    return {\r\n        title,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"8UAMA,MAAM,EAAK,EAAW,CAClB,KAAM,GACN,OAAQ,KAGCA,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,eACb,QAAS,oBACT,WAAY,CAAE,SAAU,kBACxB,KAAM,kBACN,YAAa,CAAC,WAAY,WAC1B,UACA,YAAa;;+BAGb,MAAO,CACH,CACI,OAAQ,CAAC,iCAAkC,+BAAgC,kBAC3E,OAAQ,eAKpB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,MAAS,EAAI,IAAI,QAE9B,EAAU,wBACV,EAAO,gBAAgB,IACvB,EAAM,GAAG,IAAU,IACnB,CAAE,KAAM,GAAQ,MAAMC,EAAI,GAE1B,EAAI,EAAK,GAET,EAAQ,EAAE,cAAc,OACxB,EAAS,EAAE,kBACX,EAAW,EAAO,OAClB,EAAO,KAAK,MAAM,GAClB,EAAQ,MAAM,QAAQ,IACxB,GAAM,OAAO,WAAW,MAAM,MAAM,EAAG,IAAI,IAAK,GAAS,CACrD,IAAM,EAAO,GAAG,EAAI,GAAG,EAAK,QAC5B,OAAOC,EAAM,OAAO,EAAM,SAAY,CAClC,GAAM,CAAE,KAAM,GAAa,MAAMD,EAAI,GAAG,EAAQ,cAAc,EAAK,QAAQ,kBAAkB,EAAK,MAAM,QACxG,MAAO,CACH,MAAO,EAAK,MACZ,YAAa,EAAG,OAAO,EAAS,UAAU,SAC1C,OACA,OAAQ,EAAK,SAAS,KAAK,KAC3B,kBAAmB,EAAK,eAG9B,IAGV,MAAO,CACH,QACA,KAAM,EACN,KAAM"}