{"version":3,"file":"news-p62UJhuB.js","names":["route: Route","$","got","cache","response"],"sources":["../../lib/routes/priconne-redive/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport got from '@/utils/got';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:server?',\r\n    categories: ['game'],\r\n    example: '/priconne-redive/news',\r\n    parameters: { server: '服务器，默认日服' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['priconne-redive.jp/news'],\r\n            target: '/news/jp',\r\n        },\r\n        {\r\n            source: ['princessconnect.so-net.tw/news'],\r\n            target: '/news/zh-tw',\r\n        },\r\n        {\r\n            source: ['game.bilibili.com/pcr/news.html'],\r\n            target: '/news/zh-cn',\r\n        },\r\n    ],\r\n    name: '最新公告',\r\n    maintainers: ['SayaSS', 'frankcwl'],\r\n    handler,\r\n    url: 'priconne-redive.jp/news',\r\n    description: `服务器\r\n\r\n| 国服  | 台服  | 日服  |\r\n| ----- | ----- | ---- |\r\n| zh-cn | zh-tw | jp   |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { server = 'jp' } = ctx.req.param();\r\n\r\n    switch (server) {\r\n        case 'jp': {\r\n            const parseContent = (htmlString) => {\r\n                const $ = load(htmlString);\r\n                $('.contents-body h3').remove();\r\n                const time = $('.meta-info .time').text().trim();\r\n                $('.meta-info').remove();\r\n                const content = $('.contents-body');\r\n\r\n                return {\r\n                    description: content.html(),\r\n                    pubDate: parseDate(time),\r\n                };\r\n            };\r\n\r\n            const response = await got({\r\n                method: 'get',\r\n                url: 'https://priconne-redive.jp/news/',\r\n            });\r\n            const data = response.data;\r\n            const $ = load(data);\r\n            const list = $('.article_box');\r\n\r\n            const out = await Promise.all(\r\n                list.map((index, item) => {\r\n                    item = $(item);\r\n                    const link = item.find('a').first().attr('href');\r\n                    return cache.tryGet(link, async () => {\r\n                        const rssitem = {\r\n                            title: item.find('h4').text(),\r\n                            link,\r\n                        };\r\n\r\n                        const response = await got(link);\r\n                        const result = parseContent(response.data);\r\n\r\n                        rssitem.description = result.description;\r\n                        rssitem.pubDate = result.pubDate;\r\n\r\n                        return rssitem;\r\n                    });\r\n                })\r\n            );\r\n\r\n            return {\r\n                title: '公主链接日服-新闻',\r\n                link: 'https://priconne-redive.jp/news/',\r\n                language: 'ja',\r\n                item: out,\r\n            };\r\n        }\r\n        case 'zh-tw': {\r\n            const parseContent = (htmlString) => {\r\n                const $ = load(htmlString);\r\n                $('.news_con h2 > span').remove();\r\n                const time = $('.news_con h2').text().trim();\r\n                $('.news_con section h4').first().remove();\r\n                const content = $('.news_con section');\r\n\r\n                return {\r\n                    description: content.html(),\r\n                    pubDate: parseDate(time),\r\n                };\r\n            };\r\n\r\n            const response = await got({\r\n                method: 'get',\r\n                url: 'http://www.princessconnect.so-net.tw/news',\r\n            });\r\n            const $ = load(response.data);\r\n            const list = $('.news_con dl dd').toArray();\r\n\r\n            const items = await Promise.all(\r\n                list.map((item) => {\r\n                    const $ = load(item);\r\n                    const title = $('a');\r\n                    const link = `http://www.princessconnect.so-net.tw${title.attr('href')}`;\r\n\r\n                    return cache.tryGet(link, async () => {\r\n                        const rssitem = {\r\n                            title: title.text().trim(),\r\n                            link,\r\n                        };\r\n\r\n                        const response = await got(link);\r\n                        const result = parseContent(response.data);\r\n\r\n                        rssitem.description = result.description;\r\n                        rssitem.pubDate = result.pubDate;\r\n\r\n                        return rssitem;\r\n                    });\r\n                })\r\n            );\r\n\r\n            return {\r\n                title: '公主连结台服-最新公告',\r\n                link: 'http://www.princessconnect.so-net.tw/news',\r\n                item: items,\r\n            };\r\n        }\r\n        case 'zh-cn': {\r\n            const response = await got({\r\n                method: 'get',\r\n                url: 'https://api.biligame.com/news/list?gameExtensionId=267&positionId=2&typeId=&pageNum=1&pageSize=5',\r\n            });\r\n            const list = response.data;\r\n            const items = await Promise.all(\r\n                list.data.map((item) => {\r\n                    const link = `https://game.bilibili.com/pcr/news.html#detail=${item.id}`;\r\n\r\n                    return cache.tryGet(link, async () => {\r\n                        const rssitem = {\r\n                            title: item.title,\r\n                            link,\r\n                            pubDate: parseDate(item.ctime),\r\n                        };\r\n                        const resp = await got({ method: 'get', url: `https://api.biligame.com/news/${item.id}` });\r\n                        rssitem.description = resp.data.data.content;\r\n                        return rssitem;\r\n                    });\r\n                })\r\n            );\r\n\r\n            return {\r\n                title: '公主连结国服-最新公告',\r\n                link: 'https://game.bilibili.com/pcr/news.html',\r\n                item: items,\r\n            };\r\n        }\r\n        default:\r\n        // Do nothing\r\n    }\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,iBACN,WAAY,CAAC,QACb,QAAS,wBACT,WAAY,CAAE,OAAQ,YACtB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,2BACT,OAAQ,YAEZ,CACI,OAAQ,CAAC,kCACT,OAAQ,eAEZ,CACI,OAAQ,CAAC,mCACT,OAAQ,gBAGhB,KAAM,OACN,YAAa,CAAC,SAAU,YACxB,UACA,IAAK,0BACL,YAAa;;;;2BAOjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,SAAS,MAAS,EAAI,IAAI,QAElC,OAAQ,EAAR,CACI,IAAK,KAAM,CACP,IAAM,EAAgB,GAAe,CACjC,IAAMC,EAAI,EAAK,GACf,EAAE,qBAAqB,SACvB,IAAM,EAAOA,EAAE,oBAAoB,OAAO,OAC1C,EAAE,cAAc,SAChB,IAAM,EAAUA,EAAE,kBAElB,MAAO,CACH,YAAa,EAAQ,OACrB,QAAS,EAAU,KAIrB,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,qCAEH,EAAO,EAAS,KAChB,EAAI,EAAK,GACT,EAAO,EAAE,gBAET,EAAM,MAAM,QAAQ,IACtB,EAAK,KAAK,EAAO,IAAS,CACtB,EAAO,EAAE,GACT,IAAM,EAAO,EAAK,KAAK,KAAK,QAAQ,KAAK,QACzC,OAAOC,EAAM,OAAO,EAAM,SAAY,CAClC,IAAM,EAAU,CACZ,MAAO,EAAK,KAAK,MAAM,OACvB,QAGEC,EAAW,MAAMF,EAAI,GACrB,EAAS,EAAaE,EAAS,MAKrC,MAHA,GAAQ,YAAc,EAAO,YAC7B,EAAQ,QAAU,EAAO,QAElB,OAKnB,MAAO,CACH,MAAO,YACP,KAAM,mCACN,SAAU,KACV,KAAM,GAGd,IAAK,QAAS,CACV,IAAM,EAAgB,GAAe,CACjC,IAAMH,EAAI,EAAK,GACf,EAAE,uBAAuB,SACzB,IAAM,EAAOA,EAAE,gBAAgB,OAAO,OACtC,EAAE,wBAAwB,QAAQ,SAClC,IAAM,EAAUA,EAAE,qBAElB,MAAO,CACH,YAAa,EAAQ,OACrB,QAAS,EAAU,KAIrB,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,8CAEH,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,mBAAmB,UAE5B,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GAAS,CACf,IAAMD,EAAI,EAAK,GACT,EAAQA,EAAE,KACV,EAAO,uCAAuC,EAAM,KAAK,UAE/D,OAAOE,EAAM,OAAO,EAAM,SAAY,CAClC,IAAM,EAAU,CACZ,MAAO,EAAM,OAAO,OACpB,QAGEC,EAAW,MAAMF,EAAI,GACrB,EAAS,EAAaE,EAAS,MAKrC,MAHA,GAAQ,YAAc,EAAO,YAC7B,EAAQ,QAAU,EAAO,QAElB,OAKnB,MAAO,CACH,MAAO,cACP,KAAM,4CACN,KAAM,GAGd,IAAK,QAAS,CACV,IAAM,EAAW,MAAMF,EAAI,CACvB,OAAQ,MACR,IAAK,qGAEH,EAAO,EAAS,KAChB,EAAQ,MAAM,QAAQ,IACxB,EAAK,KAAK,IAAK,GAAS,CACpB,IAAM,EAAO,kDAAkD,EAAK,KAEpE,OAAOC,EAAM,OAAO,EAAM,SAAY,CAClC,IAAM,EAAU,CACZ,MAAO,EAAK,MACZ,OACA,QAAS,EAAU,EAAK,QAEtB,EAAO,MAAMD,EAAI,CAAE,OAAQ,MAAO,IAAK,iCAAiC,EAAK,OAEnF,MADA,GAAQ,YAAc,EAAK,KAAK,KAAK,QAC9B,OAKnB,MAAO,CACH,MAAO,cACP,KAAM,0CACN,KAAM,GAGd"}