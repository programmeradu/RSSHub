{"version":3,"file":"cngold-D3s2ldPr.js","names":["got","cache","route: Route"],"sources":["../../lib/routes/cngold/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = 'news-325' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 12;\r\n\r\n    const rootUrl = 'https://www.cngold.org.cn';\r\n    const currentUrl = new URL(`${category}.html`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('ul.newsList li')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.find('t1').text(),\r\n                pubDate: parseDate(item.find('div.min, div.day').text(), ['YYYY-MM-DD', 'MM-DD']),\r\n                link: new URL(item.find('a').prop('href'), rootUrl).href,\r\n                language,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const title = $$('div.details_top div.t1').text();\r\n                const description = $$('div.details_con').html();\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = parseDate($$('div.details_top div.min span').first().text());\r\n                item.author = $$('div.details_top div.min span').last().text().split(/：/).pop();\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.details_con').text(),\r\n                };\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('div.logo img').prop('src'), rootUrl).href;\r\n\r\n    return {\r\n        title: `${$('title').text()} - ${$('div.tab a.current').text()}`,\r\n        description: $('meta[name=\"description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: $('meta[name=\"keywords\"]').prop('content'),\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    name: '分类',\r\n    url: 'www.cngold.org.cn',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/cngold/news-325',\r\n    parameters: { category: '分类，默认为 `news-325`，即行业资讯，可在对应分类页 URL 中找到, Category, `news-325`，即行业资讯by default' },\r\n    description: `::: tip\r\n  若订阅 [行业资讯](https://www.cngold.org.cn/news-325.html)，网址为 \\`https://www.cngold.org.cn/news-325.html\\`。截取 \\`https://www.cngold.org.cn/\\` 到末尾 \\`.html\\` 的部分 \\`news-325\\` 作为参数填入，此时路由为 [\\`/cngold/news-325\\`](https://rsshub.app/cngold/news-325)。\r\n:::\r\n\r\n#### 资讯中心\r\n\r\n| [图片新闻](https://www.cngold.org.cn/news-323.html) | [通知公告](https://www.cngold.org.cn/news-324.html) | [党建工作](https://www.cngold.org.cn/news-326.html) | [行业资讯](https://www.cngold.org.cn/news-325.html) | [黄金矿业](https://www.cngold.org.cn/news-327.html) | [黄金消费](https://www.cngold.org.cn/news-328.html) |\r\n| --------------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- |\r\n| [news-323](https://rsshub.app/cngold/news-323)      | [news-324](https://rsshub.app/cngold/news-324)      | [news-326](https://rsshub.app/cngold/news-326)      | [news-325](https://rsshub.app/cngold/news-325)      | [news-327](https://rsshub.app/cngold/news-327)      | [news-328](https://rsshub.app/cngold/news-328)      |\r\n\r\n| [黄金市场](https://www.cngold.org.cn/news-329.html) | [社会责任](https://www.cngold.org.cn/news-330.html) | [黄金书屋](https://www.cngold.org.cn/news-331.html) | [工作交流](https://www.cngold.org.cn/news-332.html) | [黄金统计](https://www.cngold.org.cn/news-333.html) | [协会动态](https://www.cngold.org.cn/news-334.html) |\r\n| --------------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- | --------------------------------------------------- |\r\n| [news-329](https://rsshub.app/cngold/news-329)      | [news-330](https://rsshub.app/cngold/news-330)      | [news-331](https://rsshub.app/cngold/news-331)      | [news-332](https://rsshub.app/cngold/news-332)      | [news-333](https://rsshub.app/cngold/news-333)      | [news-334](https://rsshub.app/cngold/news-334)      |\r\n\r\n<details>\r\n<summary>更多分类</summary>\r\n\r\n#### [政策法规](https://www.cngold.org.cn/policies.html)\r\n\r\n| [法律法规](https://www.cngold.org.cn/policies-245.html) | [产业政策](https://www.cngold.org.cn/policies-262.html) | [黄金标准](https://www.cngold.org.cn/policies-281.html) |\r\n| ------------------------------------------------------- | ------------------------------------------------------- | ------------------------------------------------------- |\r\n| [policies-245](https://rsshub.app/cngold/policies-245)  | [policies-262](https://rsshub.app/cngold/policies-262)  | [policies-281](https://rsshub.app/cngold/policies-281)  |\r\n\r\n#### [行业培训](https://www.cngold.org.cn/training.html)\r\n\r\n| [黄金投资分析师](https://www.cngold.org.cn/training-242.html) | [教育部1+X](https://www.cngold.org.cn/training-246.html) | [矿业权评估师](https://www.cngold.org.cn/training-338.html) | [其他培训](https://www.cngold.org.cn/training-247.html) |\r\n| ------------------------------------------------------------- | -------------------------------------------------------- | ----------------------------------------------------------- | ------------------------------------------------------- |\r\n| [training-242](https://rsshub.app/cngold/training-242)        | [training-246](https://rsshub.app/cngold/training-246)   | [training-338](https://rsshub.app/cngold/training-338)      | [training-247](https://rsshub.app/cngold/training-247)  |\r\n\r\n#### [黄金科技](https://www.cngold.org.cn/technology.html)\r\n\r\n| [黄金协会科学技术奖](https://www.cngold.org.cn/technology-318.html) | [科学成果评价](https://www.cngold.org.cn/technology-319.html) | [新技术推广](https://www.cngold.org.cn/technology-320.html) | [黄金技术大会](https://www.cngold.org.cn/technology-350.html) |\r\n| ------------------------------------------------------------------- | ------------------------------------------------------------- | ----------------------------------------------------------- | ------------------------------------------------------------- |\r\n| [technology-318](https://rsshub.app/cngold/technology-318)          | [technology-319](https://rsshub.app/cngold/technology-319)    | [technology-320](https://rsshub.app/cngold/technology-320)  | [technology-350](https://rsshub.app/cngold/technology-350)    |\r\n\r\n</details>\r\n    `,\r\n    categories: ['new-media'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.cngold.org.cn/:category?'],\r\n            target: (params) => {\r\n                const category = params.category;\r\n\r\n                return category ? `/${category}` : '';\r\n            },\r\n        },\r\n        {\r\n            title: '政策法规 - 法律法规',\r\n            source: ['www.cngold.org.cn/policies-245.html'],\r\n            target: '/policies-245',\r\n        },\r\n        {\r\n            title: '政策法规 - 产业政策',\r\n            source: ['www.cngold.org.cn/policies-262.html'],\r\n            target: '/policies-262',\r\n        },\r\n        {\r\n            title: '政策法规 - 黄金标准',\r\n            source: ['www.cngold.org.cn/policies-281.html'],\r\n            target: '/policies-281',\r\n        },\r\n        {\r\n            title: '行业培训 - 黄金投资分析师',\r\n            source: ['www.cngold.org.cn/training-242.html'],\r\n            target: '/training-242',\r\n        },\r\n        {\r\n            title: '行业培训 - 教育部1+X',\r\n            source: ['www.cngold.org.cn/training-246.html'],\r\n            target: '/training-246',\r\n        },\r\n        {\r\n            title: '行业培训 - 矿业权评估师',\r\n            source: ['www.cngold.org.cn/training-338.html'],\r\n            target: '/training-338',\r\n        },\r\n        {\r\n            title: '行业培训 - 其他培训',\r\n            source: ['www.cngold.org.cn/training-247.html'],\r\n            target: '/training-247',\r\n        },\r\n        {\r\n            title: '黄金科技 - 黄金协会科学技术奖',\r\n            source: ['www.cngold.org.cn/technology-318.html'],\r\n            target: '/technology-318',\r\n        },\r\n        {\r\n            title: '黄金科技 - 科学成果评价',\r\n            source: ['www.cngold.org.cn/technology-319.html'],\r\n            target: '/technology-319',\r\n        },\r\n        {\r\n            title: '黄金科技 - 新技术推广',\r\n            source: ['www.cngold.org.cn/technology-320.html'],\r\n            target: '/technology-320',\r\n        },\r\n        {\r\n            title: '黄金科技 - 黄金技术大会',\r\n            source: ['www.cngold.org.cn/technology-350.html'],\r\n            target: '/technology-350',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"wWAOA,MAAa,EAAU,KAAO,IAAQ,CAClC,GAAM,CAAE,WAAW,YAAe,EAAI,IAAI,QACpC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,4BACV,EAAa,IAAI,IAAI,GAAG,EAAS,OAAQ,GAAS,KAElD,CAAE,KAAM,GAAa,MAAMA,EAAI,GAE/B,EAAI,EAAK,GAET,EAAW,EAAE,QAAQ,KAAK,QAE5B,EAAQ,EAAE,kBACT,MAAM,EAAG,GACT,UACA,IAAK,IACF,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,KAAK,MAAM,OACvB,QAAS,EAAU,EAAK,KAAK,oBAAoB,OAAQ,CAAC,aAAc,UACxE,KAAM,IAAI,IAAI,EAAK,KAAK,KAAK,KAAK,QAAS,GAAS,KACpD,cAIZ,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAMD,EAAI,EAAK,MAE1C,EAAK,EAAK,GAEV,EAAQ,EAAG,0BAA0B,OACrC,EAAc,EAAG,mBAAmB,OAY1C,MAVA,GAAK,MAAQ,EACb,EAAK,YAAc,EACnB,EAAK,QAAU,EAAU,EAAG,gCAAgC,QAAQ,QACpE,EAAK,OAAS,EAAG,gCAAgC,OAAO,OAAO,MAAM,KAAK,MAC1E,EAAK,QAAU,CACX,KAAM,EACN,KAAM,EAAG,mBAAmB,QAEhC,EAAK,SAAW,EAET,MAKnB,IAAM,EAAQ,IAAI,IAAI,EAAE,gBAAgB,KAAK,OAAQ,GAAS,KAE9D,MAAO,CACH,MAAO,GAAG,EAAE,SAAS,OAAO,KAAK,EAAE,qBAAqB,SACxD,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,EACN,KAAM,EACN,WAAY,GACZ,QACA,OAAQ,EAAE,yBAAyB,KAAK,WACxC,aAIKE,EAAe,CACxB,KAAM,cACN,KAAM,KACN,IAAK,oBACL,YAAa,CAAC,WACd,UACA,QAAS,mBACT,WAAY,CAAE,SAAU,iFACxB,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAqCb,WAAY,CAAC,aAEb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,gCACT,OAAS,GAAW,CAChB,IAAM,EAAW,EAAO,SAExB,OAAO,EAAW,IAAI,IAAa,KAG3C,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,iBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,iBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,iBAEZ,CACI,MAAO,iBACP,OAAQ,CAAC,uCACT,OAAQ,iBAEZ,CACI,MAAO,gBACP,OAAQ,CAAC,uCACT,OAAQ,iBAEZ,CACI,MAAO,gBACP,OAAQ,CAAC,uCACT,OAAQ,iBAEZ,CACI,MAAO,cACP,OAAQ,CAAC,uCACT,OAAQ,iBAEZ,CACI,MAAO,mBACP,OAAQ,CAAC,yCACT,OAAQ,mBAEZ,CACI,MAAO,gBACP,OAAQ,CAAC,yCACT,OAAQ,mBAEZ,CACI,MAAO,eACP,OAAQ,CAAC,yCACT,OAAQ,mBAEZ,CACI,MAAO,gBACP,OAAQ,CAAC,yCACT,OAAQ"}