{"version":3,"file":"today-BWNV5UuS.js","names":["route: Route","rootUrl","got"],"sources":["../../lib/routes/line/today.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { baseUrl as rootUrl, parseList, parseItems } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/today/:edition?/:tab?',\r\n    categories: ['new-media'],\r\n    example: '/line/today',\r\n    parameters: { edition: 'Edition, see below, Taiwan by default', tab: 'Tag, can be found in URL, `top` by default' },\r\n    radar: [\r\n        {\r\n            source: ['today.line.me/'],\r\n        },\r\n    ],\r\n    name: 'TODAY',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    url: 'today.line.me/',\r\n    description: `Edition\r\n\r\n| Taiwan | Thailand | Hong Kong |\r\n| ------ | -------- | --------- |\r\n| tw     | th       | hk        |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const edition = ctx.req.param('edition') || 'tw';\r\n    const tab = ctx.req.param('tab') || 'top';\r\n\r\n    const tabUrl = `${rootUrl}/webapi/portal/page/${tab}?country=${edition}`;\r\n    const recommendationUrl = `${rootUrl}/webapi/api/v6/recommendation/articles/listings/mytoday_rec:id?offset=0&length=50&country=${edition}&gender=&age=&excludeNoThumbnail=0&containMainSnapshot=0`;\r\n    const currentUrl = `${rootUrl}/${edition}/v2/tab/${tab}`;\r\n\r\n    let title = 'Recommendation',\r\n        moduleUrl;\r\n\r\n    if (tab !== 'recommendation') {\r\n        const moduleResponse = await got({\r\n            method: 'get',\r\n            url: tabUrl,\r\n        });\r\n\r\n        const listing = moduleResponse.data.modules.findLast((item) => item.source === 'CATEGORY_MOST_VIEW').listings[0];\r\n\r\n        title = moduleResponse.data.name;\r\n        moduleUrl =\r\n            `${rootUrl}/webapi/trending/category/mostView/listings/${listing.id}?` +\r\n            `offset=0&length=50&country=${edition}&targetContent=${listing.params.targetContent}` +\r\n            `&categories=${listing.params.categories}&trendingEventPeriod=${listing.params.trendingEventPeriod}`;\r\n    }\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: tab === 'recommendation' ? recommendationUrl : moduleUrl,\r\n    });\r\n\r\n    const list = parseList(response.data.items);\r\n\r\n    const items = await parseItems(list);\r\n\r\n    return {\r\n        title: `${title} - Line Today`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0WAIA,MAAaA,EAAe,CACxB,KAAM,yBACN,WAAY,CAAC,aACb,QAAS,cACT,WAAY,CAAE,QAAS,wCAAyC,IAAK,8CACrE,MAAO,CACH,CACI,OAAQ,CAAC,oBAGjB,KAAM,QACN,YAAa,CAAC,WACd,UACA,IAAK,iBACL,YAAa;;;;oCAOjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,EAAI,IAAI,MAAM,YAAc,KACtC,EAAM,EAAI,IAAI,MAAM,QAAU,MAE9B,EAAS,GAAGC,EAAQ,sBAAsB,EAAI,WAAW,IACzD,EAAoB,GAAGA,EAAQ,4FAA4F,EAAQ,0DACnI,EAAa,GAAGA,EAAQ,GAAG,EAAQ,UAAU,IAE/C,EAAQ,iBACR,EAEJ,GAAI,IAAQ,iBAAkB,CAC1B,IAAM,EAAiB,MAAMC,EAAI,CAC7B,OAAQ,MACR,IAAK,IAGH,EAAU,EAAe,KAAK,QAAQ,SAAU,GAAS,EAAK,SAAW,sBAAsB,SAAS,GAE9G,EAAQ,EAAe,KAAK,KAC5B,EACI,GAAGD,EAAQ,8CAA8C,EAAQ,GAAG,8BACtC,EAAQ,iBAAiB,EAAQ,OAAO,cAAA,cACvD,EAAQ,OAAO,WAAW,uBAAuB,EAAQ,OAAO,sBAGvF,IAAM,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAAQ,iBAAmB,EAAoB,IAGlD,EAAO,EAAU,EAAS,KAAK,OAE/B,EAAQ,MAAM,EAAW,GAE/B,MAAO,CACH,MAAO,GAAG,EAAM,eAChB,KAAM,EACN,KAAM"}