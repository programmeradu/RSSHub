{"version":3,"file":"home-Ro1YrhBP.js","names":["route: Route","ofetch","cache"],"sources":["../../lib/routes/jumeili/home.ts"],"sourcesContent":["import { config } from '@/config';\r\nimport { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/home/:column?',\r\n    categories: ['new-media'],\r\n    example: '/jumeili/home',\r\n    parameters: {\r\n        column: '内容栏, 默认为 `0`（最新）。其他可选：`-1`（头条）、`62073`（精选）、`13243`（年度大会）等。详细可以在开发者工具 Network 面板中找到，如：`https://www.jumeili.cn/ws/AjaxService.ashx?act=index_article&page=1&pageSize=20&column=0`最后的 `column=0` 即为`column` 参数',\r\n    },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'JUMEILI_COOKIE',\r\n                optional: true,\r\n                description: '用户登录后，可以从浏览器开发者工具 Network 面板中的 jumeili 页面请求获取 Cookie，如：`ASP.NET_SessionId=xxx;jmlweb4=xxx`全部复制并设置为环境变量',\r\n            },\r\n        ],\r\n        antiCrawler: true,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.jumeili.cn/', 'jumeili.cn/'],\r\n            target: '/home/:column?',\r\n        },\r\n    ],\r\n    name: '首页资讯',\r\n    maintainers: ['kjasn'],\r\n    handler,\r\n    description: `:::Warning\r\n未登录用户无法获取完整文章内容，只能看到预览内容。想要获取完整文章内容，需要设置\\`JUMEILI_COOKIE\\`环境变量。\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://www.jumeili.cn';\r\n    const column = ctx.req.param('column') ?? 0;\r\n\r\n    const link = `${baseUrl}/ws/AjaxService.ashx?act=index_article&page=1&pageSize=20&column=${column}`;\r\n\r\n    const cookie = config.jumeili.cookie;\r\n    const response = await ofetch(link, {\r\n        headers: {\r\n            referer: baseUrl,\r\n            'user-agent': config.trueUA,\r\n            accept: 'application/json, text/javascript, */*; q=0.01',\r\n            cookie,\r\n        },\r\n    });\r\n\r\n    // parse 两次\r\n    let data = JSON.parse(response);\r\n    if (data && typeof data === 'string') {\r\n        data = JSON.parse(data);\r\n    }\r\n\r\n    let items = data.items.map((item) => ({\r\n        title: item.title,\r\n        link: baseUrl + item.url,\r\n        description: item.subject, // 预览内容\r\n        image: item.imgurl,\r\n        author: item.author,\r\n        // pubDate: parseDate(item.pubTime),\r\n    }));\r\n\r\n    if (cookie) {\r\n        items = await Promise.all(\r\n            items.map((item) =>\r\n                cache.tryGet(item.link, async () => {\r\n                    const article = await ofetch(item.link, {\r\n                        headers: {\r\n                            referer: baseUrl,\r\n                            'user-agent': config.trueUA,\r\n                            accept: 'application/json, text/javascript, */*; q=0.01',\r\n                            cookie,\r\n                        },\r\n                    });\r\n                    const $ = load(article);\r\n\r\n                    const content = $('#Cnt-Main-Article-JML').html();\r\n                    if (content) {\r\n                        item.description = content; // 替换为完整正文\r\n                    }\r\n\r\n                    return item;\r\n                })\r\n            )\r\n        );\r\n    }\r\n\r\n    return {\r\n        title: '聚美丽 - 首页资讯',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"+QAMA,MAAaA,EAAe,CACxB,KAAM,iBACN,WAAY,CAAC,aACb,QAAS,gBACT,WAAY,CACR,OAAQ,+MAEZ,SAAU,CACN,cAAe,CACX,CACI,KAAM,iBACN,SAAU,GACV,YAAa,2GAGrB,YAAa,IAEjB,MAAO,CACH,CACI,OAAQ,CAAC,kBAAmB,eAC5B,OAAQ,mBAGhB,KAAM,OACN,YAAa,CAAC,SACd,UACA,YAAa;;MAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,yBACV,EAAS,EAAI,IAAI,MAAM,WAAa,EAEpC,EAAO,GAAG,EAAQ,mEAAmE,IAErF,EAAS,EAAO,QAAQ,OACxB,EAAW,MAAMC,EAAO,EAAM,CAChC,QAAS,CACL,QAAS,EACT,aAAc,EAAO,OACrB,OAAQ,iDACR,YAKJ,EAAO,KAAK,MAAM,GAClB,GAAQ,OAAO,GAAS,WACxB,EAAO,KAAK,MAAM,IAGtB,IAAI,EAAQ,EAAK,MAAM,IAAK,IAAU,CAClC,MAAO,EAAK,MACZ,KAAM,EAAU,EAAK,IACrB,YAAa,EAAK,QAClB,MAAO,EAAK,OACZ,OAAQ,EAAK,UA6BjB,OAzBI,IACA,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAU,MAAMD,EAAO,EAAK,KAAM,CACpC,QAAS,CACL,QAAS,EACT,aAAc,EAAO,OACrB,OAAQ,iDACR,YAGF,EAAI,EAAK,GAET,EAAU,EAAE,yBAAyB,OAK3C,OAJI,IACA,EAAK,YAAc,GAGhB,OAMhB,CACH,MAAO,aACP,KAAM"}