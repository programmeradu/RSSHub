{"version":3,"file":"cache-CIkWqAo6.js","names":["key","utils","cache","waitForRequest: Promise<string>","cookieString","got"],"sources":["../../lib/routes/bilibili/cache.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport utils from './utils';\r\nimport { load } from 'cheerio';\r\nimport { config } from '@/config';\r\nimport logger from '@/utils/logger';\r\nimport { getPuppeteerPage } from '@/utils/puppeteer';\r\nimport { JSDOM } from 'jsdom';\r\n\r\nconst getCookie = (disableConfig = false) => {\r\n    if (Object.keys(config.bilibili.cookies).length > 0 && !disableConfig) {\r\n        // Update b_lsid in cookies\r\n        for (const key of Object.keys(config.bilibili.cookies)) {\r\n            const cookie = config.bilibili.cookies[key];\r\n            if (cookie) {\r\n                const updatedCookie = cookie.replace(/b_lsid=[0-9A-F]+_[0-9A-F]+/, `b_lsid=${utils.lsid()}`);\r\n                config.bilibili.cookies[key] = updatedCookie;\r\n            }\r\n        }\r\n\r\n        return config.bilibili.cookies[Object.keys(config.bilibili.cookies)[Math.floor(Math.random() * Object.keys(config.bilibili.cookies).length)]];\r\n    }\r\n    const key = 'bili-cookie';\r\n    return cache.tryGet(key, async () => {\r\n        let waitForRequest: Promise<string> = new Promise((resolve) => {\r\n            resolve('');\r\n        });\r\n        const { destory } = await getPuppeteerPage('https://space.bilibili.com/1/dynamic', {\r\n            onBeforeLoad: (page) => {\r\n                waitForRequest = new Promise<string>((resolve) => {\r\n                    page.on('requestfinished', async (request) => {\r\n                        if (request.url() === 'https://api.bilibili.com/x/internal/gaia-gateway/ExClimbWuzhi') {\r\n                            const cookies = await page.cookies();\r\n                            let cookieString = cookies.map((cookie) => `${cookie.name}=${cookie.value}`).join('; ');\r\n                            cookieString = cookieString.replace(/b_lsid=[0-9A-F]+_[0-9A-F]+/, `b_lsid=${utils.lsid()}`);\r\n                            resolve(cookieString);\r\n                        }\r\n                    });\r\n                });\r\n            },\r\n        });\r\n        const cookieString = await waitForRequest;\r\n        logger.debug(`Got bilibili cookie: ${cookieString}`);\r\n        await destory();\r\n        return cookieString;\r\n    });\r\n};\r\n\r\nconst getRenderData = (uid) => {\r\n    const key = 'bili-web-render-data';\r\n    return cache.tryGet(key, async () => {\r\n        const cookie = await getCookie();\r\n        const { data: response } = await got(`https://space.bilibili.com/${uid}`, {\r\n            headers: {\r\n                Referer: 'https://www.bilibili.com/',\r\n                Cookie: cookie,\r\n            },\r\n        });\r\n        const dom = new JSDOM(response);\r\n        const document = dom.window.document;\r\n        const scriptElement = document.querySelector('#__RENDER_DATA__');\r\n        const innerText = scriptElement ? scriptElement.textContent || '{}' : '{}';\r\n        const renderData = JSON.parse(decodeURIComponent(innerText));\r\n        const accessId = renderData.access_id;\r\n        return accessId;\r\n    });\r\n};\r\n\r\nconst getWbiVerifyString = () => {\r\n    const key = 'bili-wbi-verify-string';\r\n    return cache.tryGet(key, async () => {\r\n        const cookie = await getCookie();\r\n        const { data: navResponse } = await got('https://api.bilibili.com/x/web-interface/nav', {\r\n            headers: {\r\n                Referer: 'https://www.bilibili.com/',\r\n                Cookie: cookie,\r\n            },\r\n        });\r\n        const imgUrl = navResponse.data.wbi_img.img_url;\r\n        const subUrl = navResponse.data.wbi_img.sub_url;\r\n        const r = imgUrl.substring(imgUrl.lastIndexOf('/') + 1, imgUrl.length).split('.')[0] + subUrl.substring(subUrl.lastIndexOf('/') + 1, subUrl.length).split('.')[0];\r\n        // const { body: spaceResponse } = await got('https://space.bilibili.com/1', {\r\n        //     headers: {\r\n        //         Referer: 'https://www.bilibili.com/',\r\n        //         Cookie: cookie,\r\n        //     },\r\n        // });\r\n        // const jsUrl = 'https:' + spaceResponse.match(/[^\"]*9.space[^\"]*/);\r\n        const jsUrl = 'https://s1.hdslb.com/bfs/seed/laputa-header/bili-header.umd.js';\r\n        const { body: jsResponse } = await got(jsUrl, {\r\n            headers: {\r\n                Referer: 'https://space.bilibili.com/1',\r\n            },\r\n        });\r\n        // const array = [\r\n        //     46, 47, 18, 2, 53, 8, 23, 32, 15, 50, 10, 31, 58, 3, 45, 35, 27, 43, 5, 49, 33, 9, 42, 19, 29, 28, 14, 39, 12, 38, 41, 13, 37, 48, 7, 16, 24, 55, 40, 61, 26, 17, 0, 1, 60, 51, 30, 4, 22, 25, 54, 21, 56, 59, 6, 63, 57,\r\n        //     62, 11, 36, 20, 34, 44, 52,\r\n        // ];\r\n        const array = JSON.parse(jsResponse.match(/\\[(?:\\d+,){63}\\d+]/));\r\n        const o = [];\r\n        for (const t of array) {\r\n            r.charAt(t) && o.push(r.charAt(t));\r\n        }\r\n        return o.join('').slice(0, 32);\r\n    });\r\n};\r\n\r\nconst getUsernameFromUID = (uid) => {\r\n    const key = 'bili-username-from-uid-' + uid;\r\n    return cache.tryGet(key, async () => {\r\n        const cookie = await getCookie();\r\n        const wbiVerifyString = await getWbiVerifyString();\r\n        // await got(`https://space.bilibili.com/${uid}/`, {\r\n        //     headers: {\r\n        //         Referer: 'https://www.bilibili.com/',\r\n        //         Cookie: cookie,\r\n        //     },\r\n        // });\r\n        const params = utils.addWbiVerifyInfo(`mid=${uid}&token=&platform=web&web_location=1550101`, wbiVerifyString);\r\n        const { data: nameResponse } = await got(`https://api.bilibili.com/x/space/wbi/acc/info?${params}`, {\r\n            headers: {\r\n                Referer: `https://space.bilibili.com/${uid}/`,\r\n                Cookie: cookie,\r\n            },\r\n        });\r\n        return nameResponse.data ? nameResponse.data.name : undefined;\r\n    });\r\n};\r\n\r\nconst getUsernameAndFaceFromUID = async (uid) => {\r\n    const nameKey = 'bili-username-from-uid-' + uid;\r\n    const faceKey = 'bili-userface-from-uid-' + uid;\r\n    let name = await cache.get(nameKey);\r\n    let face = await cache.get(faceKey);\r\n    if (!name || !face) {\r\n        const cookie = await getCookie();\r\n        const wbiVerifyString = await getWbiVerifyString();\r\n        const dmImgList = utils.getDmImgList();\r\n        const renderData = await getRenderData(uid);\r\n        const params = utils.addWbiVerifyInfo(utils.addRenderData(utils.addDmVerifyInfo(`mid=${uid}&token=&platform=web&web_location=1550101`, dmImgList), renderData), wbiVerifyString);\r\n        const { data: nameResponse } = await got(`https://api.bilibili.com/x/space/wbi/acc/info?${params}`, {\r\n            headers: {\r\n                Referer: `https://space.bilibili.com/${uid}/`,\r\n                Cookie: cookie,\r\n            },\r\n        });\r\n        if (nameResponse.data.name) {\r\n            name = nameResponse.data.name;\r\n            face = nameResponse.data.face;\r\n            cache.set(nameKey, nameResponse.data.name);\r\n            cache.set(faceKey, nameResponse.data.face);\r\n        } else {\r\n            logger.error(`Error when visiting /x/space/wbi/acc/info: ${JSON.stringify(nameResponse)}`);\r\n        }\r\n    }\r\n    return [name, face];\r\n};\r\n\r\nconst getLiveIDFromShortID = (shortID) => {\r\n    const key = `bili-liveID-from-shortID-${shortID}`;\r\n    return cache.tryGet(key, async () => {\r\n        const { data: liveIDResponse } = await got(`https://api.live.bilibili.com/room/v1/Room/room_init?id=${shortID}`, {\r\n            headers: {\r\n                Referer: `https://live.bilibili.com/${shortID}`,\r\n            },\r\n        });\r\n        return liveIDResponse.data.room_id;\r\n    });\r\n};\r\n\r\nconst getUserInfoFromLiveID = (liveID) => {\r\n    const key = `bili-userinfo-from-liveID-${liveID}`;\r\n    return cache.tryGet(key, async () => {\r\n        const { data: nameResponse } = await got(`https://api.live.bilibili.com/live_user/v1/UserInfo/get_anchor_in_room?roomid=${liveID}`, {\r\n            headers: {\r\n                Referer: `https://live.bilibili.com/${liveID}`,\r\n            },\r\n        });\r\n        return nameResponse.data.info;\r\n    });\r\n};\r\n\r\nconst getVideoNameFromId = (aid, bvid) => {\r\n    const key = `bili-videoname-from-id-${bvid || aid}`;\r\n    return cache.tryGet(key, async () => {\r\n        const { data } = await got(`https://api.bilibili.com/x/web-interface/view`, {\r\n            searchParams: {\r\n                aid: aid || undefined,\r\n                bvid: bvid || undefined,\r\n            },\r\n            referer: `https://www.bilibili.com/video/${bvid || `av${aid}`}`,\r\n        });\r\n        return data.data.title;\r\n    });\r\n};\r\n\r\nconst getCidFromId = (aid, pid, bvid) => {\r\n    const key = `bili-cid-from-id-${bvid || aid}-${pid}`;\r\n    return cache.tryGet(key, async () => {\r\n        const { data } = await got(`https://api.bilibili.com/x/web-interface/view?${bvid ? `bvid=${bvid}` : `aid=${aid}`}`, {\r\n            referer: `https://www.bilibili.com/video/${bvid || `av${aid}`}`,\r\n        });\r\n        return data.data.pages[pid - 1].cid;\r\n    });\r\n};\r\n\r\ninterface SubtitleEntry {\r\n    from: number;\r\n    to: number;\r\n    sid: number;\r\n    content: string;\r\n    music: number;\r\n}\r\n\r\nfunction secondsToSrtTime(seconds: number): string {\r\n    const date = new Date(seconds * 1000);\r\n    const hh = String(date.getUTCHours()).padStart(2, '0');\r\n    const mm = String(date.getUTCMinutes()).padStart(2, '0');\r\n    const ss = String(date.getUTCSeconds()).padStart(2, '0');\r\n    const ms = String(date.getUTCMilliseconds()).padStart(3, '0');\r\n    return `${hh}:${mm}:${ss},${ms}`;\r\n}\r\n\r\nfunction convertJsonToSrt(body: SubtitleEntry[]): string {\r\n    return body\r\n        .map((item, index) => {\r\n            const start = secondsToSrtTime(item.from);\r\n            const end = secondsToSrtTime(item.to);\r\n            return `${index + 1}\\n${start} --> ${end}\\n${item.content}\\n`;\r\n        })\r\n        .join('\\n');\r\n}\r\n\r\nconst getVideoSubtitle = async (\r\n    bvid: string\r\n): Promise<\r\n    Array<{\r\n        content: string;\r\n        lan_doc: string;\r\n    }>\r\n> => {\r\n    if (!bvid) {\r\n        return [];\r\n    }\r\n\r\n    const cid = await getCidFromId(undefined, 1, bvid);\r\n    const cookie = await getCookie();\r\n    return cache.tryGet(`bili-video-subtitle-${bvid}`, async () => {\r\n        const response = await got(`https://api.bilibili.com/x/player/wbi/v2?bvid=${bvid}&cid=${cid}`, {\r\n            headers: {\r\n                Referer: `https://www.bilibili.com/video/${bvid}`,\r\n                Cookie: cookie,\r\n            },\r\n        });\r\n\r\n        const subtitles = response?.data?.data?.subtitle?.subtitles || [];\r\n\r\n        return await Promise.all(\r\n            subtitles.map(async (subtitle) => {\r\n                const url = `https:${subtitle.subtitle_url}`;\r\n                const subtitleData = await cache.tryGet(url, async () => {\r\n                    const subtitleResponse = await got(url);\r\n                    return convertJsonToSrt(subtitleResponse?.data?.body || []);\r\n                });\r\n                return {\r\n                    content: subtitleData,\r\n                    lan_doc: subtitle.lan_doc,\r\n                };\r\n            })\r\n        );\r\n    });\r\n};\r\n\r\nconst getVideoSubtitleAttachment = async (bvid: string) => {\r\n    const subtitles = await getVideoSubtitle(bvid);\r\n    return subtitles.map((subtitle) => ({\r\n        url: `data:text/plain;charset=utf-8,${subtitle.content}`,\r\n        mime_type: 'text/srt',\r\n        title: `字幕 - ${subtitle.lan_doc}`,\r\n    }));\r\n};\r\n\r\nconst getAidFromBvid = async (bvid) => {\r\n    const key = `bili-cid-from-bvid-${bvid}`;\r\n    let aid = await cache.get(key);\r\n    if (!aid) {\r\n        const response = await got(`https://api.bilibili.com/x/web-interface/view?bvid=${bvid}`, {\r\n            headers: {\r\n                Referer: `https://www.bilibili.com/video/${bvid}`,\r\n            },\r\n        });\r\n        if (response.data && response.data.data && response.data.data.aid) {\r\n            aid = response.data.data.aid;\r\n        }\r\n        cache.set(key, aid);\r\n    }\r\n    return aid;\r\n};\r\n\r\nconst getArticleDataFromCvid = async (cvid, uid) => {\r\n    const url = `https://www.bilibili.com/read/cv${cvid}/`;\r\n    const data = await cache.tryGet(\r\n        url,\r\n        async () =>\r\n            (\r\n                await got({\r\n                    method: 'get',\r\n                    url,\r\n                    headers: {\r\n                        Referer: `https://space.bilibili.com/${uid}/`,\r\n                    },\r\n                })\r\n            ).data\r\n    );\r\n    const $ = load(data);\r\n    let description = $('#read-article-holder').html();\r\n    if (!description) {\r\n        try {\r\n            const newFormatData = JSON.parse(\r\n                $('script:contains(\"window.__INITIAL_STATE__\")')\r\n                    .text()\r\n                    .match(/window\\.__INITIAL_STATE__\\s*=\\s*(.*?);\\(/)[1]\r\n            );\r\n\r\n            if (newFormatData?.readInfo?.opus?.content?.paragraphs) {\r\n                description = '';\r\n                for (const element of newFormatData.readInfo.opus.content.paragraphs) {\r\n                    if (element.para_type === 1) {\r\n                        for (const text of element.text.nodes) {\r\n                            if (text?.word?.words) {\r\n                                description += `<p>${text.word.words}</p>`;\r\n                            }\r\n                        }\r\n                    }\r\n                    if (element.para_type === 2) {\r\n                        for (const image of element.pic.pics) {\r\n                            description += `<p ><img src=\"${image.url}@progressive.webp\"></p>`;\r\n                        }\r\n                    }\r\n                    if (element.para_type === 3 && element.line?.pic?.url) {\r\n                        description += `<figure><img src=\"${element.line.pic.url}\"></figure>`;\r\n                    }\r\n                }\r\n            }\r\n        } catch {\r\n            /* empty */\r\n        }\r\n    }\r\n    return { url, description };\r\n};\r\n\r\nexport default {\r\n    getCookie,\r\n    getWbiVerifyString,\r\n    getUsernameFromUID,\r\n    getUsernameAndFaceFromUID,\r\n    getLiveIDFromShortID,\r\n    getUserInfoFromLiveID,\r\n    getVideoNameFromId,\r\n    getCidFromId,\r\n    getAidFromBvid,\r\n    getArticleDataFromCvid,\r\n    getRenderData,\r\n    getVideoSubtitle,\r\n    getVideoSubtitleAttachment,\r\n};\r\n"],"mappings":"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"}