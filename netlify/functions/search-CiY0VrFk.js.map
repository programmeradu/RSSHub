{"version":3,"file":"search-CiY0VrFk.js","names":["route: Route","got"],"sources":["../../lib/routes/fantia/search.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { config } from '@/config';\r\n\r\nexport const route: Route = {\r\n    path: '/search/:type?/:caty?/:period?/:order?/:rating?/:keyword?',\r\n    categories: ['picture'],\r\n    view: ViewType.Pictures,\r\n    example: '/fantia/search/posts/all/daily',\r\n    parameters: {\r\n        type: {\r\n            description: 'Type, see the table below, `posts` by default',\r\n            options: [\r\n                { value: 'fanclubs', label: 'クリエイター' },\r\n                { value: 'posts', label: '投稿' },\r\n                { value: 'products', label: '商品' },\r\n                { value: 'commissions', label: 'コミッション' },\r\n            ],\r\n            default: 'posts',\r\n        },\r\n        caty: {\r\n            description: 'Category, see the table below, can also be found in search page URL, `すべてのクリエイター` by default',\r\n            options: [\r\n                { value: 'all', label: 'すべてのクリエイター' },\r\n                { value: 'illust', label: 'イラスト' },\r\n                { value: 'comic', label: '漫画' },\r\n                { value: 'cosplay', label: 'コスプレ' },\r\n                { value: 'youtuber', label: 'YouTuber・配信者' },\r\n                { value: 'vtuber', label: 'Vtuber' },\r\n                { value: 'voice', label: '音声作品・ASMR' },\r\n                { value: 'voiceactor', label: '声優・歌い手' },\r\n                { value: 'idol', label: 'アイドル' },\r\n                { value: 'anime', label: 'アニメ・映像・写真' },\r\n                { value: '3d', label: '3D' },\r\n                { value: 'game', label: 'ゲーム制作' },\r\n                { value: 'music', label: '音楽' },\r\n                { value: 'novel', label: '小説' },\r\n                { value: 'doll', label: 'ドール' },\r\n                { value: 'art', label: 'アート・デザイン' },\r\n                { value: 'program', label: 'プログラム' },\r\n                { value: 'handmade', label: '創作・ハンドメイド' },\r\n                { value: 'history', label: '歴史・評論・情報' },\r\n                { value: 'railroad', label: '鉄道・旅行・ミリタリー' },\r\n                { value: 'shop', label: 'ショップ' },\r\n                { value: 'other', label: 'その他' },\r\n            ],\r\n            default: 'all',\r\n        },\r\n        period: {\r\n            description: 'Ranking period, see the table below, empty by default',\r\n            options: [\r\n                { value: 'daily', label: 'デイリー' },\r\n                { value: 'weekly', label: 'ウィークリー' },\r\n                { value: 'monthly', label: 'マンスリー' },\r\n                { value: 'all', label: '全期間' },\r\n            ],\r\n            default: '',\r\n        },\r\n        order: {\r\n            description: 'Sorting, see the table below, `更新の新しい順` by default',\r\n            options: [\r\n                { value: 'updater', label: '更新の新しい順' },\r\n                { value: 'update_old', label: '更新の古い順' },\r\n                { value: 'newer', label: '投稿の新しい順' },\r\n                { value: 'create_old', label: '投稿の古い順' },\r\n                { value: 'popular', label: 'お気に入り数順' },\r\n            ],\r\n            default: 'updater',\r\n        },\r\n        rating: {\r\n            description: 'Rating, see the table below, `すべて` by default',\r\n            options: [\r\n                { value: 'all', label: 'すべて' },\r\n                { value: 'general', label: '一般のみ' },\r\n                { value: 'adult', label: 'R18 のみ' },\r\n            ],\r\n            default: 'all',\r\n        },\r\n        keyword: 'Keyword, empty by default',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Search',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `Type\r\n\r\n| クリエイター | 投稿  | 商品     | コミッション |\r\n| ------------ | ----- | -------- | ------------ |\r\n| fanclubs     | posts | products | commissions  |\r\n\r\n  Category\r\n\r\n| 分类                   | 分类名     |\r\n| ---------------------- | ---------- |\r\n| イラスト               | illust     |\r\n| 漫画                   | comic      |\r\n| コスプレ               | cosplay    |\r\n| YouTuber・配信者       | youtuber   |\r\n| Vtuber                 | vtuber     |\r\n| 音声作品・ASMR         | voice      |\r\n| 声優・歌い手           | voiceactor |\r\n| アイドル               | idol       |\r\n| アニメ・映像・写真     | anime      |\r\n| 3D                     | 3d         |\r\n| ゲーム制作             | game       |\r\n| 音楽                   | music      |\r\n| 小説                   | novel      |\r\n| ドール                 | doll       |\r\n| アート・デザイン       | art        |\r\n| プログラム             | program    |\r\n| 創作・ハンドメイド     | handmade   |\r\n| 歴史・評論・情報       | history    |\r\n| 鉄道・旅行・ミリタリー | railroad   |\r\n| ショップ               | shop       |\r\n| その他                 | other      |\r\n\r\n  Ranking period\r\n\r\n| デイリー | ウィークリー | マンスリー | 全期間 |\r\n| -------- | ------------ | ---------- | ------ |\r\n| daily    | weekly       | monthly    | all    |\r\n\r\n  Sorting\r\n\r\n| 更新の新しい順 | 更新の古い順 | 投稿の新しい順 | 投稿の古い順 | お気に入り数順 |\r\n| -------------- | ------------ | -------------- | ------------ | -------------- |\r\n| updater        | update\\_old  | newer          | create\\_old  | popular        |\r\n\r\n  Rating\r\n\r\n| すべて | 一般のみ | R18 のみ |\r\n| ------ | -------- | -------- |\r\n| all    | general  | adult    |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type') || 'posts';\r\n    const caty = ctx.req.param('caty') || '';\r\n    const order = ctx.req.param('order') || 'updater';\r\n    const rating = ctx.req.param('rating') || 'all';\r\n    const keyword = ctx.req.param('keyword') || '';\r\n    const period = ctx.req.param('period') || '';\r\n\r\n    const rootUrl = 'https://fantia.jp';\r\n    const apiUrl = `${rootUrl}/api/v1/search/${type}?keyword=${keyword}&peroid=${period}&brand_type=0&category=${caty === 'all' ? '' : caty}&order=${order}${\r\n        rating === 'all' ? '' : rating === 'general' ? '&rating=general' : '&adult=1'\r\n    }&per_page=30`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url: apiUrl,\r\n        headers: {\r\n            Cookie: config.fantia.cookies ?? '',\r\n        },\r\n    });\r\n\r\n    let items = {};\r\n\r\n    switch (type) {\r\n        case 'fanclubs':\r\n            items = response.data.fanclubs.map((item) => ({\r\n                title: item.fanclub_name_with_creator_name,\r\n                link: `${rootUrl}/fanclubs/${item.id}`,\r\n                description: `${item.icon ? `<img src=\"${item.icon.main}\">` : ''}\"><p>${item.title}</p>`,\r\n            }));\r\n            break;\r\n\r\n        case 'posts':\r\n            items = response.data.posts.map((item) => ({\r\n                title: item.title,\r\n                link: `${rootUrl}/posts/${item.id}`,\r\n                pubDate: parseDate(item.posted_at),\r\n                author: item.fanclub.fanclub_name_with_creator_name,\r\n                description: `${item.comment ? `<p>${item.comment}</p>` : ''}<img src=\"${item.thumb ? item.thumb.main : item.thumb_micro}\">`,\r\n            }));\r\n            break;\r\n\r\n        case 'products':\r\n            items = response.data.products.map((item) => ({\r\n                title: item.name,\r\n                link: `${rootUrl}/products/${item.id}`,\r\n                author: item.fanclub.fanclub_name_with_creator_name,\r\n                description: `${item.buyable_lowest_plan.description ? `<p>${item.buyable_lowest_plan.description}</p>` : ''}<img src=\"${item.thumb ? item.thumb.main : item.thumb_micro}\">`,\r\n            }));\r\n            break;\r\n\r\n        case 'commissions':\r\n            items = response.data.commissions.map((item) => ({\r\n                title: item.name,\r\n                link: `${rootUrl}/commissions/${item.id}`,\r\n                author: item.fanclub.fanclub_name_with_creator_name,\r\n                description: `${item.buyable_lowest_plan.description ? `<p>${item.buyable_lowest_plan.description}</p>` : ''}<img src=\"${item.thumb ? item.thumb.main : item.thumb_micro}\">`,\r\n            }));\r\n            break;\r\n    }\r\n\r\n    return {\r\n        title: `Fantia - Search ${type}`,\r\n        link: apiUrl.replace('api/v1/search/', ''),\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"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"}