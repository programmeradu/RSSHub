{"version":3,"file":"jrj-DdOuEk5A.js","names":["route: Route","cache","response"],"sources":["../../lib/routes/jrj/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { ofetch } from 'ofetch';\r\n\r\nconst options = {\r\n    '103': '财经资讯',\r\n    '508': '科技资讯',\r\n    '106': '商业资讯',\r\n    '632': '消费资讯',\r\n    '630': '医疗资讯',\r\n    '119': '康养资讯',\r\n    '004': '汽车资讯',\r\n    '009': '房产资讯',\r\n    '629': 'ESG 资讯',\r\n    '010': 'A股资讯',\r\n    '001': '港股资讯',\r\n    '102': '美股资讯',\r\n    '113': '银行资讯',\r\n    '115': '保险资讯',\r\n    '104': '基金资讯',\r\n    '503': '私募资讯',\r\n    '112': '信托资讯',\r\n    '007': '外汇资讯',\r\n    '107': '期货资讯',\r\n    '118': '债券资讯',\r\n    '603': '券商资讯',\r\n    '105': '观点',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:channelNum',\r\n    categories: ['finance'],\r\n    example: '/jrj/103',\r\n    parameters: {\r\n        channelNum: {\r\n            description: '栏目编号',\r\n            options: Object.entries(options).map(([value, label]) => ({ value, label })),\r\n        },\r\n    },\r\n    url: 'www.jrj.com.cn',\r\n    name: '资讯',\r\n    description: `\r\n| column | Description |\r\n| ---   | ---   |\r\n| 103   | 财经资讯 |\r\n| 508   | 科技资讯 |\r\n| 106   | 商业资讯 |\r\n| 632   | 消费资讯 |\r\n| 630   | 医疗资讯 |\r\n| 119   | 康养资讯 |\r\n| 004   | 汽车资讯 |\r\n| 009   | 房产资讯 |\r\n| 629   | ESG 资讯 |\r\n| 001   | 港股资讯 |\r\n| 102   | 美股资讯 |\r\n| 113   | 银行资讯 |\r\n| 115   | 保险资讯 |\r\n| 104   | 基金资讯 |\r\n| 503   | 私募资讯 |\r\n| 112   | 信托资讯 |\r\n| 007   | 外汇资讯 |\r\n| 107   | 期货资讯 |\r\n| 118   | 债券资讯 |\r\n| 603   | 券商资讯 |\r\n| 105   | 观点 |\r\n    `,\r\n    maintainers: ['p3psi-boo'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const channelNum = ctx.req.param('channelNum');\r\n\r\n    const url = 'https://gateway.jrj.com/jrj-news/news/queryNewsList';\r\n\r\n    const response = await ofetch(url, {\r\n        method: 'post',\r\n        body: {\r\n            sortBy: 1,\r\n            pageSize: 20,\r\n            makeDate: '',\r\n            channelNum,\r\n            infoCls: '',\r\n        },\r\n    });\r\n\r\n    const alist = response.data.data;\r\n\r\n    const list = alist.map((item) => {\r\n        const link = item.pcInfoUrl;\r\n        const title = item.title;\r\n        const author = item.paperMediaSource;\r\n        const pubDate = parseDate(item.makeDate);\r\n\r\n        return {\r\n            title,\r\n            link,\r\n            author,\r\n            pubDate,\r\n        };\r\n    });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const articleUrl = item.link;\r\n                const response = await ofetch(articleUrl);\r\n\r\n                const $ = load(response);\r\n\r\n                const content = $('.article_content').html();\r\n\r\n                item.description = content;\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${options[channelNum]} - 金融界`,\r\n        link: 'https://jrj.com',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"kOAOA,MAAM,EAAU,CACZ,IAAO,OACP,IAAO,OACP,IAAO,OACP,IAAO,OACP,IAAO,OACP,IAAO,OACP,MAAO,OACP,MAAO,OACP,IAAO,SACP,MAAO,OACP,MAAO,OACP,IAAO,OACP,IAAO,OACP,IAAO,OACP,IAAO,OACP,IAAO,OACP,IAAO,OACP,MAAO,OACP,IAAO,OACP,IAAO,OACP,IAAO,OACP,IAAO,MAGEA,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,WACb,QAAS,WACT,WAAY,CACR,WAAY,CACR,YAAa,OACb,QAAS,OAAO,QAAQ,GAAS,KAAK,CAAC,EAAO,MAAY,CAAE,QAAO,aAG3E,IAAK,iBACL,KAAM,KACN,YAAa;;;;;;;;;;;;;;;;;;;;;;;;MAyBb,YAAa,CAAC,aACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAa,EAAI,IAAI,MAAM,cAI3B,EAAW,MAAM,EAAO,sDAAK,CAC/B,OAAQ,OACR,KAAM,CACF,OAAQ,EACR,SAAU,GACV,SAAU,GACV,aACA,QAAS,MAIX,EAAQ,EAAS,KAAK,KAEtB,EAAO,EAAM,IAAK,GAAS,CAC7B,IAAM,EAAO,EAAK,UACZ,EAAQ,EAAK,MACb,EAAS,EAAK,iBACd,EAAU,EAAU,EAAK,UAE/B,MAAO,CACH,QACA,OACA,SACA,aAIF,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAa,EAAK,KAClBC,EAAW,MAAM,EAAO,GAExB,EAAI,EAAKA,GAET,EAAU,EAAE,oBAAoB,OAGtC,MADA,GAAK,YAAc,EACZ,MAKnB,MAAO,CACH,MAAO,GAAG,EAAQ,GAAY,QAC9B,KAAM,kBACN,KAAM"}