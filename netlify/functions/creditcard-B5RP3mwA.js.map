{"version":3,"file":"creditcard-B5RP3mwA.js","names":["gbk2utf8","wait","got","host","route: Route","got","util","cache"],"sources":["../../lib/routes/flyert/utils.ts","../../lib/routes/flyert/creditcard.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport iconv from 'iconv-lite';\r\nimport pMap from 'p-map';\r\nimport wait from '@/utils/wait';\r\n\r\nconst gbk2utf8 = (s) => iconv.decode(s, 'gbk');\r\n\r\nasync function loadContent(link) {\r\n    // 添加随机延迟，假设延迟时间在1000毫秒到3000毫秒之间\r\n    const randomDelay = Math.floor(Math.random() * (3000 - 1000 + 1)) + 1000;\r\n    await wait(randomDelay);\r\n\r\n    const response = await got.get(link, {\r\n        responseType: 'buffer',\r\n    });\r\n    const $ = load(gbk2utf8(response.data));\r\n\r\n    // 去除全文末尾多余内容\r\n    $('.lookMore').remove();\r\n    $('script, style').remove();\r\n    $('#loginDialog').remove();\r\n\r\n    // 获取第一个帖子对象\r\n    const firstpost = $('.firstpost');\r\n\r\n    // 修改图片中的链接\r\n    firstpost.find('ignore_js_op img').each(function () {\r\n        $(this).attr('src', $(this).attr('file'));\r\n        // 移除无用属性\r\n        for (const attr of ['id', 'aid', 'zoomfile', 'file', 'zoomfile', 'class', 'onclick', 'title', 'inpost', 'alt', 'onmouseover']) {\r\n            $(this).removeAttr(attr);\r\n        }\r\n    });\r\n\r\n    // 去除全文中图片的多余标签\r\n    const images = firstpost.find('ignore_js_op img');\r\n    firstpost.find('ignore_js_op').remove();\r\n    firstpost.append(images);\r\n\r\n    // 提取内容\r\n    const description = firstpost.html();\r\n\r\n    return { description };\r\n}\r\n\r\nconst ProcessFeed = (list, caches) => {\r\n    const host = 'https://www.flyert.com.cn';\r\n\r\n    return pMap(\r\n        list,\r\n        async (item) => {\r\n            const $ = load(item);\r\n\r\n            const $label = $(\".comiis_common a[data-track='版块页主题分类']\");\r\n            const $title = $(\".comiis_common a[data-track='版块页文章']\");\r\n            // 还原相对链接为绝对链接\r\n            const itemUrl = new URL($title.attr('href'), host).href;\r\n\r\n            // 列表上提取到的信息\r\n            const single = {\r\n                title: $label.text() + '-' + $title.text(),\r\n                link: itemUrl,\r\n                guid: itemUrl,\r\n            };\r\n\r\n            // 使用tryGet方法从缓存获取内容。\r\n            // 当缓存中无法获取到链接内容的时候，则使用load方法加载文章内容。\r\n            const other = await caches.tryGet(itemUrl, () => loadContent(itemUrl));\r\n\r\n            // 合并解析后的结果集作为该篇文章最终的输出结果\r\n            return Object.assign({}, single, other);\r\n        },\r\n        { concurrency: 2 }\r\n    ); // 设置并发请求数量为 2\r\n};\r\n\r\nexport default { ProcessFeed };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport util from './utils';\r\nimport iconv from 'iconv-lite';\r\n\r\nconst gbk2utf8 = (s) => iconv.decode(s, 'gbk');\r\nconst host = 'https://www.flyert.com.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/creditcard/:bank',\r\n    categories: ['travel'],\r\n    example: '/flyert/creditcard/zhongxin',\r\n    parameters: { bank: '信用卡板块各银行的拼音简称' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['flyert.com.cn/'],\r\n        },\r\n    ],\r\n    name: '信用卡',\r\n    maintainers: ['nicolaszf'],\r\n    handler,\r\n    url: 'flyert.com/',\r\n    description: `| 信用卡模块 | bank          |\r\n| ---------- | ------------- |\r\n| 国内信用卡 | creditcard    |\r\n| 浦发银行   | pufa          |\r\n| 招商银行   | zhaoshang     |\r\n| 中信银行   | zhongxin      |\r\n| 交通银行   | jiaotong      |\r\n| 中国银行   | zhonghang     |\r\n| 工商银行   | gongshang     |\r\n| 广发银行   | guangfa       |\r\n| 农业银行   | nongye        |\r\n| 建设银行   | jianshe       |\r\n| 汇丰银行   | huifeng       |\r\n| 民生银行   | mingsheng     |\r\n| 兴业银行   | xingye        |\r\n| 花旗银行   | huaqi         |\r\n| 上海银行   | shanghai      |\r\n| 无卡支付   | wuka          |\r\n| 投资理财   | 137           |\r\n| 网站权益汇 | 145           |\r\n| 境外信用卡 | intcreditcard |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const bank = ctx.req.param('bank');\r\n    const target = `${host}/forum-${bank}-1.html`;\r\n    let bankname = '';\r\n\r\n    switch (bank) {\r\n        case 'creditcard':\r\n            bankname = '国内信用卡';\r\n            break;\r\n        case 'pufa':\r\n            bankname = '浦发银行';\r\n            break;\r\n        case 'zhaoshang':\r\n            bankname = '招商银行';\r\n            break;\r\n        case 'zhongxin':\r\n            bankname = '中信银行';\r\n            break;\r\n        case 'jiaotong':\r\n            bankname = '交通银行';\r\n            break;\r\n        case 'zhonghang':\r\n            bankname = '中国银行';\r\n            break;\r\n        case 'gongshang':\r\n            bankname = '工商银行';\r\n            break;\r\n        case 'guangfa':\r\n            bankname = '广发银行';\r\n            break;\r\n        case 'nongye':\r\n            bankname = '农业银行';\r\n            break;\r\n        case 'jianshe':\r\n            bankname = '建设银行';\r\n            break;\r\n        case 'huifeng':\r\n            bankname = '汇丰银行';\r\n            break;\r\n        case 'mingsheng':\r\n            bankname = '民生银行';\r\n            break;\r\n        case 'xingye':\r\n            bankname = '兴业银行';\r\n            break;\r\n        case 'huaqi':\r\n            bankname = '花旗银行';\r\n            break;\r\n        case 'shanghai':\r\n            bankname = '上海银行';\r\n            break;\r\n        case 'wuka':\r\n            bankname = '无卡支付';\r\n            break;\r\n        case '137':\r\n            bankname = '投资理财';\r\n            break;\r\n        case '145':\r\n            bankname = '网站权益汇';\r\n            break;\r\n        case 'intcreditcard':\r\n            bankname = '境外信用卡';\r\n    }\r\n\r\n    const response = await got.get(target, {\r\n        responseType: 'buffer',\r\n    });\r\n\r\n    const $ = load(gbk2utf8(response.data));\r\n\r\n    const list = $(\"[id*='normalthread']\").toArray();\r\n\r\n    const result = await util.ProcessFeed(list, cache);\r\n\r\n    return {\r\n        title: `飞客茶馆信用卡 - ${bankname}`,\r\n        link: 'https://www.flyert.com.cn/',\r\n        description: `飞客茶馆信用卡 - ${bankname}`,\r\n        item: result,\r\n    };\r\n}\r\n"],"mappings":"oZAMA,MAAMA,EAAY,GAAM,EAAM,OAAO,EAAG,OAExC,eAAe,EAAY,EAAM,CAE7B,IAAM,EAAc,KAAK,MAAM,KAAK,SAAY,MAAoB,IACpE,MAAMC,EAAK,GAEX,IAAM,EAAW,MAAMI,EAAI,IAAI,EAAM,CACjC,aAAc,WAEZ,EAAI,EAAKL,EAAS,EAAS,OAGjC,EAAE,aAAa,SACf,EAAE,iBAAiB,SACnB,EAAE,gBAAgB,SAGlB,IAAM,EAAY,EAAE,cAGpB,EAAU,KAAK,oBAAoB,KAAK,UAAY,CAChD,EAAE,MAAM,KAAK,MAAO,EAAE,MAAM,KAAK,SAEjC,IAAK,IAAM,IAAQ,CAAC,KAAM,MAAO,WAAY,OAAQ,WAAY,QAAS,UAAW,QAAS,SAAU,MAAO,eAC3G,EAAE,MAAM,WAAW,KAK3B,IAAM,EAAS,EAAU,KAAK,oBAC9B,EAAU,KAAK,gBAAgB,SAC/B,EAAU,OAAO,GAGjB,IAAM,EAAc,EAAU,OAE9B,MAAO,CAAE,eAGb,MAAM,GAAe,EAAM,IAGhB,EACH,EACA,KAAO,IAAS,CACZ,IAAM,EAAI,EAAK,GAET,EAAS,EAAE,0CACX,EAAS,EAAE,wCAEX,EAAU,IAAI,IAAI,EAAO,KAAK,QAASG,6BAAM,KAG7C,EAAS,CACX,MAAO,EAAO,OAAS,IAAM,EAAO,OACpC,KAAM,EACN,KAAM,GAKJ,EAAQ,MAAM,EAAO,OAAO,MAAe,EAAY,IAG7D,OAAO,OAAO,OAAO,GAAI,EAAQ,IAErC,CAAE,YAAa,IAIvB,IAAA,EAAe,CAAE,eCtEjB,MAAM,EAAY,GAAM,EAAM,OAAO,EAAG,OAG3BC,EAAe,CACxB,KAAM,oBACN,WAAY,CAAC,UACb,QAAS,8BACT,WAAY,CAAE,KAAM,iBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,oBAGjB,KAAM,MACN,YAAa,CAAC,aACd,UACA,IAAK,cACL,YAAa;;;;;;;;;;;;;;;;;;;;4BAuBjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAS,mCAAiB,EAAK,SACjC,EAAW,GAEf,OAAQ,EAAR,CACI,IAAK,aACD,EAAW,QACX,MACJ,IAAK,OACD,EAAW,OACX,MACJ,IAAK,YACD,EAAW,OACX,MACJ,IAAK,WACD,EAAW,OACX,MACJ,IAAK,WACD,EAAW,OACX,MACJ,IAAK,YACD,EAAW,OACX,MACJ,IAAK,YACD,EAAW,OACX,MACJ,IAAK,UACD,EAAW,OACX,MACJ,IAAK,SACD,EAAW,OACX,MACJ,IAAK,UACD,EAAW,OACX,MACJ,IAAK,UACD,EAAW,OACX,MACJ,IAAK,YACD,EAAW,OACX,MACJ,IAAK,SACD,EAAW,OACX,MACJ,IAAK,QACD,EAAW,OACX,MACJ,IAAK,WACD,EAAW,OACX,MACJ,IAAK,OACD,EAAW,OACX,MACJ,IAAK,MACD,EAAW,OACX,MACJ,IAAK,MACD,EAAW,QACX,MACJ,IAAK,gBACD,EAAW,QAGnB,IAAM,EAAW,MAAMC,EAAI,IAAI,EAAQ,CACnC,aAAc,WAGZ,EAAI,EAAK,EAAS,EAAS,OAE3B,EAAO,EAAE,wBAAwB,UAEjC,EAAS,MAAMC,EAAK,YAAY,EAAMC,GAE5C,MAAO,CACH,MAAO,aAAa,IACpB,KAAM,6BACN,YAAa,aAAa,IAC1B,KAAM"}