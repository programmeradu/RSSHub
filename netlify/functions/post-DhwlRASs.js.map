{"version":3,"file":"post-DhwlRASs.js","names":["route: Route","got","mime: Record<string, string>","result: string[]"],"sources":["../../lib/routes/konachan/post.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport got from '@/utils/got';\r\nimport queryString from 'query-string';\r\n\r\nexport const route: Route = {\r\n    path: [\r\n        '/post/popular_recent/:period?', // 对应 konachan.com\r\n        '/sfw/post/popular_recent/:period?', // 对应 konachan.net（SFW）\r\n    ],\r\n    categories: ['picture'],\r\n    view: ViewType.Pictures,\r\n    example: '/konachan/post/popular_recent/1d',\r\n    parameters: {\r\n        period: {\r\n            description: '展示时间',\r\n            options: [\r\n                { value: '1d', label: '最近 24 小时' },\r\n                { value: '1w', label: '最近一周' },\r\n                { value: '1m', label: '最近一月' },\r\n                { value: '1y', label: '最近一年' },\r\n            ],\r\n            default: '1d',\r\n        },\r\n        safe_search: {\r\n            description: '是否使用无r18的站点konachan.net，若是,则在路径前加上 `/sfw`，如`/konachan/sfw/post/popular_recent/1d`，若否则默认使用 konachan.com',\r\n            default: 'false',\r\n        },\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['konachan.com/post', 'konachan.net/post'],\r\n        },\r\n    ],\r\n    name: 'Popular Recent Posts',\r\n    maintainers: ['magic-akari', 'NekoAria', 'sineeeee'],\r\n    description: `| 最近 24 小时    | 最近一周     | 最近一月    | 最近一年     |\r\n| ------- | -------- | ------- | -------- |\r\n| 1d | 1w | 1m | 1y |`,\r\n    handler,\r\n    features: {\r\n        nsfw: true,\r\n    },\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { period = '1d' } = ctx.req.param();\r\n    const isSfw = ctx.req.path.includes('/sfw');\r\n    const baseUrl = isSfw ? 'https://konachan.net' : 'https://konachan.com';\r\n\r\n    const response = await got({\r\n        url: `${baseUrl}/post/popular_recent.json`,\r\n        searchParams: queryString.stringify({\r\n            period,\r\n        }),\r\n    });\r\n\r\n    const posts = response.data;\r\n\r\n    const titles = {\r\n        '1d': 'Last 24 hours',\r\n        '1w': 'Last week',\r\n        '1m': 'Last month',\r\n        '1y': 'Last year',\r\n    };\r\n\r\n    const mime: Record<string, string> = {\r\n        jpg: 'jpeg',\r\n        png: 'png',\r\n    };\r\n\r\n    const title = titles[period];\r\n\r\n    return {\r\n        title: `${title} - ${isSfw ? 'konachan.net' : 'konachan.com'}`,\r\n        link: `${baseUrl}/post/popular_recent?period=${period}`,\r\n        item: posts.map((post) => ({\r\n            title: post.tags,\r\n            id: `${ctx.req.path}#${post.id}`,\r\n            guid: `${ctx.req.path}#${post.id}`,\r\n            link: `${baseUrl}/post/show/${post.id}`,\r\n            author: post.author,\r\n            pubDate: new Date(post.created_at * 1e3).toUTCString(),\r\n            description: (() => {\r\n                const result: string[] = [];\r\n                result.push(\r\n                    `<img src=\"${post.sample_url}\" />`,\r\n                    `<p>Rating: ${post.rating}</p><p>Score: ${post.score}</p>`,\r\n                    ...(post.source ? [`<a href=\"${post.source}\">Source</a>`] : []),\r\n                    ...(post.parent_id ? [`<a href=\"${baseUrl}/post/show/${post.parent_id}\">Parent</a>`] : [])\r\n                );\r\n                return result.join('');\r\n            })(),\r\n            media: {\r\n                content: {\r\n                    url: post.file_url,\r\n                    type: `image/${mime[post.file_ext]}`,\r\n                },\r\n                thumbnail: {\r\n                    url: post.preview_url,\r\n                },\r\n            },\r\n            category: post.tags.split(/\\s+/),\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"2SAIA,MAAaA,EAAe,CACxB,KAAM,CACF,gCACA,qCAEJ,WAAY,CAAC,WACb,KAAM,EAAS,SACf,QAAS,mCACT,WAAY,CACR,OAAQ,CACJ,YAAa,OACb,QAAS,CACL,CAAE,MAAO,KAAM,MAAO,YACtB,CAAE,MAAO,KAAM,MAAO,QACtB,CAAE,MAAO,KAAM,MAAO,QACtB,CAAE,MAAO,KAAM,MAAO,SAE1B,QAAS,MAEb,YAAa,CACT,YAAa,yGACb,QAAS,UAGjB,MAAO,CACH,CACI,OAAQ,CAAC,oBAAqB,uBAGtC,KAAM,uBACN,YAAa,CAAC,cAAe,WAAY,YACzC,YAAa;;uBAGb,UACA,SAAU,CACN,KAAM,KAId,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,SAAS,MAAS,EAAI,IAAI,QAC5B,EAAQ,EAAI,IAAI,KAAK,SAAS,QAC9B,EAAU,EAAQ,uBAAyB,uBAE3C,EAAW,MAAMC,EAAI,CACvB,IAAK,GAAG,EAAQ,2BAChB,aAAc,EAAY,UAAU,CAChC,aAIF,EAAQ,EAAS,KAEjB,EAAS,CACX,KAAM,gBACN,KAAM,YACN,KAAM,aACN,KAAM,aAGJC,EAA+B,CACjC,IAAK,OACL,IAAK,OAGH,EAAQ,EAAO,GAErB,MAAO,CACH,MAAO,GAAG,EAAM,KAAK,EAAQ,eAAiB,iBAC9C,KAAM,GAAG,EAAQ,8BAA8B,IAC/C,KAAM,EAAM,IAAK,IAAU,CACvB,MAAO,EAAK,KACZ,GAAI,GAAG,EAAI,IAAI,KAAK,GAAG,EAAK,KAC5B,KAAM,GAAG,EAAI,IAAI,KAAK,GAAG,EAAK,KAC9B,KAAM,GAAG,EAAQ,aAAa,EAAK,KACnC,OAAQ,EAAK,OACb,QAAS,IAAI,KAAK,EAAK,WAAa,KAAK,cACzC,iBAAoB,CAChB,IAAMC,EAAmB,GAOzB,OANA,EAAO,KACH,aAAa,EAAK,WAAW,MAC7B,cAAc,EAAK,OAAO,gBAAgB,EAAK,MAAM,MACrD,GAAI,EAAK,OAAS,CAAC,YAAY,EAAK,OAAO,eAAiB,GAC5D,GAAI,EAAK,UAAY,CAAC,YAAY,EAAQ,aAAa,EAAK,UAAU,eAAiB,IAEpF,EAAO,KAAK,QAEvB,MAAO,CACH,QAAS,CACL,IAAK,EAAK,SACV,KAAM,SAAS,EAAK,EAAK,aAE7B,UAAW,CACP,IAAK,EAAK,cAGlB,SAAU,EAAK,KAAK,MAAM"}