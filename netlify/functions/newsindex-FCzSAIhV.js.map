{"version":3,"file":"newsindex-FCzSAIhV.js","names":["got","route: Route"],"sources":["../../lib/routes/tencent/pvp/newsindex.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nconst map = new Map([\r\n    ['rm', { name: '热门', channelid: 1760 }],\r\n    ['xw', { name: '新闻', channelid: 1761 }],\r\n    ['gg', { name: '公告', channelid: 1762 }],\r\n    ['hd', { name: '活动', channelid: 1763 }],\r\n    ['ss', { name: '赛事', channelid: 1764 }],\r\n    ['yh', { name: '优化', channelid: 1769 }],\r\n    ['all', { name: '全部', channelid: 0 }],\r\n]);\r\nconst link = 'https://pvp.qq.com/web201706/newsindex.shtml';\r\nconst apiUrl = 'https://apps.game.qq.com/wmp/v3.1/?p0=18&p1=searchNewsKeywordsList&order=sIdxTime&r0=cors&type=iTarget&source=app_news_search&pagesize=12&page=1&id=';\r\nconst pageUrl = `https://pvp.qq.com/web201706/newsdetail.shtml?tid=`;\r\n\r\nconst getPage = async (id, typeName) => {\r\n    const response = await got(apiUrl + id, {\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n\r\n    return Promise.all(\r\n        response.data.msg.result.map(async (item) => {\r\n            let description = await got(`https://apps.game.qq.com/wmp/v3.1/public/searchNews.php?p0=18&source=web_pc&id=${item.iNewsId}`);\r\n\r\n            description = JSON.parse(description.data.match(/(?<=var searchObj=).*(?<!;)/g));\r\n\r\n            return {\r\n                title: `【${typeName}】` + item.sTitle,\r\n                link: pageUrl + item.iNewsId,\r\n                pubDate: parseDate(item.sTargetIdxTime),\r\n                description: description.msg.sContent,\r\n            };\r\n        })\r\n    );\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/pvp/newsindex/:type',\r\n    categories: ['game'],\r\n    example: '/tencent/pvp/newsindex/all',\r\n    parameters: { type: '栏目分类，见下表' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '新闻中心',\r\n    maintainers: ['Jeason0228', 'HenryQW'],\r\n    handler,\r\n    description: `| 全部 | 热门 | 新闻 | 公告 | 活动 | 赛事 | 优化 |\r\n| ---- | ---- | ---- | ---- | ---- | ---- | ---- |\r\n| all  | rm   | xw   | gg   | hd   | ss   | yh   |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type');\r\n    const OutName = map.get(type).name;\r\n    const OutId = map.get(type).channelid;\r\n\r\n    let item = [];\r\n\r\n    if (type === 'all') {\r\n        const results = await Promise.all(\r\n            [...map].map(async (value) => {\r\n                const res = await getPage(value[1].channelid, value[1].name);\r\n                return res;\r\n            })\r\n        );\r\n        for (const result of results) {\r\n            item = [...item, ...result];\r\n        }\r\n    } else {\r\n        item = await getPage(OutId, OutName);\r\n    }\r\n\r\n    return {\r\n        title: `【${OutName}】 - 王者荣耀 - 新闻列表`,\r\n        link,\r\n        description: `《王者荣耀》是腾讯天美工作室历时3年推出的东方英雄即时对战手游大作，抗塔强杀、团灭超神，领略爽热血竞技的酣畅淋漓！1v1、3v3、闯关等丰富游戏模式，随时战，更自由！跨服匹配秒开局，好友组队战排位，不靠装备、没有等级，更公平、更爽快的无差异对战！`,\r\n        item,\r\n    };\r\n}\r\n"],"mappings":"qRAGA,MAAM,EAAM,IAAI,IAAI,CAChB,CAAC,KAAM,CAAE,KAAM,KAAM,UAAW,OAChC,CAAC,KAAM,CAAE,KAAM,KAAM,UAAW,OAChC,CAAC,KAAM,CAAE,KAAM,KAAM,UAAW,OAChC,CAAC,KAAM,CAAE,KAAM,KAAM,UAAW,OAChC,CAAC,KAAM,CAAE,KAAM,KAAM,UAAW,OAChC,CAAC,KAAM,CAAE,KAAM,KAAM,UAAW,OAChC,CAAC,MAAO,CAAE,KAAM,KAAM,UAAW,MAE/B,EAAO,+CAIP,EAAU,MAAO,EAAI,IAAa,CACpC,IAAM,EAAW,MAAMA,EAAI,uJAAS,EAAI,CACpC,QAAS,CACL,QAAS,KAIjB,OAAO,QAAQ,IACX,EAAS,KAAK,IAAI,OAAO,IAAI,KAAO,IAAS,CACzC,IAAI,EAAc,MAAMA,EAAI,kFAAkF,EAAK,WAInH,MAFA,GAAc,KAAK,MAAM,EAAY,KAAK,MAAM,iCAEzC,CACH,MAAO,IAAI,EAAS,GAAK,EAAK,OAC9B,KAAM,qDAAU,EAAK,QACrB,QAAS,EAAU,EAAK,gBACxB,YAAa,EAAY,IAAI,cAMhCC,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,QACb,QAAS,6BACT,WAAY,CAAE,KAAM,YACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,aAAc,WAC5B,UACA,YAAa;;qDAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAU,EAAI,IAAI,GAAM,KACxB,EAAQ,EAAI,IAAI,GAAM,UAExB,EAAO,GAEX,GAAI,IAAS,MAAO,CAChB,IAAM,EAAU,MAAM,QAAQ,IAC1B,CAAC,GAAG,GAAK,IAAI,KAAO,IAAU,CAC1B,IAAM,EAAM,MAAM,EAAQ,EAAM,GAAG,UAAW,EAAM,GAAG,MACvD,OAAO,KAGf,IAAK,IAAM,KAAU,EACjB,EAAO,CAAC,GAAG,EAAM,GAAG,QAGxB,EAAO,MAAM,EAAQ,EAAO,GAGhC,MAAO,CACH,MAAO,IAAI,EAAQ,iBACnB,OACA,YAAa,8HACb"}