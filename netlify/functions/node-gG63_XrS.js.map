{"version":3,"file":"node-gG63_XrS.js","names":["ofetch","cache","$","route: Route"],"sources":["../../lib/routes/psnine/node.ts"],"sourcesContent":["import type { Route } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport * as cheerio from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport cache from '@/utils/cache';\r\n\r\nconst handler = async (ctx) => {\r\n    const { id = 'news', order = 'obdate' } = ctx.req.param();\r\n\r\n    const rootUrl = 'https://www.psnine.com';\r\n    const currentUrl = `${rootUrl}/node/${id}?ob=${order}`;\r\n    const response = await ofetch(currentUrl);\r\n\r\n    const $ = cheerio.load(response);\r\n\r\n    $('.psnnode, .node').remove();\r\n\r\n    const list = $('.title a')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            const meta = $item.parent().next();\r\n            return {\r\n                title: $item.text(),\r\n                link: $item.attr('href'),\r\n                pubDate: timezone(\r\n                    parseDate(\r\n                        meta\r\n                            .contents()\r\n                            .filter((_, i) => i.nodeType === 3)\r\n                            .text()\r\n                            .trim()\r\n                            .split(/\\s{2,}/)[0],\r\n                        ['YYYY-MM-DD HH:mm', 'MM-DD HH:mm']\r\n                    ),\r\n                    8\r\n                ),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await ofetch(item.link);\r\n                const $ = cheerio.load(detailResponse);\r\n\r\n                item.author = $('a[itemprop=\"author\"]').eq(0).text();\r\n                item.description = $('div[itemprop=\"articleBody\"]').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${$('title').text()} - PSN中文站`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/node/:id?/:order?',\r\n    parameters: {\r\n        id: '节点 id，见下表，默认为 news',\r\n        order: '排序，`date` 即最新，默认为 `obdate` 即综合排序',\r\n    },\r\n    categories: ['game'],\r\n    example: '/psnine/node/news',\r\n    name: '节点',\r\n    maintainers: ['betta-cyber', 'nczitzk'],\r\n    handler,\r\n    radar: [\r\n        {\r\n            source: ['psnine.com/node/:id'],\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"gWAQA,MAAM,EAAU,KAAO,IAAQ,CAC3B,GAAM,CAAE,KAAK,OAAQ,QAAQ,UAAa,EAAI,IAAI,QAG5C,EAAa,+BAAmB,EAAG,MAAM,IACzC,EAAW,MAAMA,EAAO,GAExB,EAAI,EAAQ,KAAK,GAEvB,EAAE,mBAAmB,SAErB,IAAM,EAAO,EAAE,YACV,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GACV,EAAO,EAAM,SAAS,OAC5B,MAAO,CACH,MAAO,EAAM,OACb,KAAM,EAAM,KAAK,QACjB,QAAS,EACL,EACI,EACK,WACA,QAAQ,EAAG,IAAM,EAAE,WAAa,GAChC,OACA,OACA,MAAM,UAAU,GACrB,CAAC,mBAAoB,gBAEzB,MAKV,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAO,EAAK,MACnCE,EAAI,EAAQ,KAAK,GAKvB,MAHA,GAAK,OAASA,EAAE,wBAAwB,GAAG,GAAG,OAC9C,EAAK,YAAcA,EAAE,+BAA+B,OAE7C,MAKnB,MAAO,CACH,MAAO,GAAG,EAAE,SAAS,OAAO,WAC5B,KAAM,EACN,KAAM,IAIDC,EAAe,CACxB,KAAM,qBACN,WAAY,CACR,GAAI,qBACJ,MAAO,oCAEX,WAAY,CAAC,QACb,QAAS,oBACT,KAAM,KACN,YAAa,CAAC,cAAe,WAC7B,UACA,MAAO,CACH,CACI,OAAQ,CAAC"}