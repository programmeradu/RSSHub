{"version":3,"file":"news-CEnX_IOC.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/gov/cn/news/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport logger from '@/utils/logger';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/cn/news/:uid',\r\n    categories: ['government'],\r\n    example: '/gov/cn/news/bm',\r\n    parameters: { uid: '分类名' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '政府新闻',\r\n    maintainers: ['EsuRt', 'howfool'],\r\n    handler,\r\n    description: `| 政务部门 | 滚动新闻 | 新闻要闻 | 国务院新闻 | 国务院工作会议 | 政策文件 |\r\n| :------: | :------: | :------: | :--------: | :------------: | :------: |\r\n|    bm    |    gd    |    yw    |     gwy    |     gwyzzjg    |  zhengce |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const uid = ctx.req.param('uid');\r\n    const originDomain = 'https://www.gov.cn';\r\n    let url = '';\r\n    let title = '';\r\n    let list = '';\r\n    switch (uid) {\r\n        case 'bm':\r\n            url = `${originDomain}/lianbo/bumen/index.htm`;\r\n            title = '中国政府网 - 部门政务';\r\n            break;\r\n        case 'yw':\r\n            url = `${originDomain}/yaowen/index.htm`;\r\n            title = '中国政府网 - 新闻要闻';\r\n            break;\r\n        case 'gd':\r\n            // 因 /xinwen/gundong.htm 被重定向到 /yaowen/index.htm, 所以这里直接用要闻的代替了\r\n            url = `${originDomain}/yaowen/index.htm`;\r\n            title = '中国政府网 - 滚动新闻';\r\n            break;\r\n        case 'gwy':\r\n            url = `${originDomain}/pushinfo/v150203/`;\r\n            title = '中国政府网 - 国务院信息';\r\n            break;\r\n        case 'zhengce':\r\n            url = 'http://sousuo.gov.cn/s.htm?t=zhengcelibrary';\r\n            title = '中国政府网 - 政策文件';\r\n            break;\r\n        case 'gwyzzjg':\r\n            url = `${originDomain}/gwyzzjg/huiyi/`;\r\n            title = '中国政府网 - 国务院工作会议';\r\n            break;\r\n        default:\r\n            logger.error('pattern not matched');\r\n    }\r\n    const listData = await got.get(url);\r\n    const $ = load(listData.data);\r\n    if (url.includes('zhengcelibrary')) {\r\n        list = $('.dys_middle_result_content_item');\r\n    } else if (url.includes('bumen')) {\r\n        list = $('.infolist li');\r\n    } else {\r\n        list = $('.news_box .list li:not(.line)');\r\n    }\r\n\r\n    return {\r\n        title,\r\n        link: url,\r\n        item: await Promise.all(\r\n            list.toArray().map((item) => {\r\n                item = $(item);\r\n                let contentUrl = item.find('a').attr('href');\r\n                contentUrl = contentUrl.startsWith('http') ? contentUrl : new URL(contentUrl, url).href;\r\n                return cache.tryGet(contentUrl, async () => {\r\n                    let description;\r\n                    let fullTextData;\r\n                    let fullTextGet;\r\n                    let pubDate;\r\n                    let author;\r\n                    let category;\r\n                    if (/dysMiddleResultConItemTitle/g.test(item.html())) {\r\n                        if (contentUrl.includes('content')) {\r\n                            fullTextGet = await got.get(contentUrl);\r\n                            fullTextData = load(fullTextGet.data);\r\n                            fullTextData('.shuzi').remove(); // 移除videobg的图片\r\n                            fullTextData('#myFlash').remove(); // 移除flash\r\n                            description = /pages_content/g.test(fullTextData.html()) ? fullTextData('.pages_content').html() : fullTextData('#UCAP-CONTENT').html();\r\n                        } else {\r\n                            description = item.find('a').text(); // 忽略获取吹风会的全文\r\n                        }\r\n                    } else {\r\n                        if (contentUrl.includes('content')) {\r\n                            fullTextGet = await got.get(contentUrl);\r\n                            fullTextData = load(fullTextGet.data);\r\n                            const $1 = fullTextData.html();\r\n                            pubDate = timezone(parseDate(fullTextData('meta[name=\"firstpublishedtime\"]').attr('content'), 'YYYY-MM-DD HH:mm:ss'), 8);\r\n                            author = fullTextData('meta[name=\"author\"]').attr('content');\r\n                            category = fullTextData('meta[name=\"keywords\"]').attr('content').split(/[,;]/);\r\n                            if (/zhengceku/g.test(contentUrl)) {\r\n                                // 政策文件库\r\n                                description = fullTextData('.pages_content').html();\r\n                            } else {\r\n                                fullTextData('.shuzi').remove(); // 移除videobg的图片\r\n                                fullTextData('#myFlash').remove(); // 移除flash\r\n                                description = /UCAP-CONTENT/g.test($1) ? fullTextData('#UCAP-CONTENT').html() : fullTextData('body').html();\r\n                            }\r\n                        } else {\r\n                            description = item.find('a').text(); // 忽略获取吹风会的全文\r\n                        }\r\n                    }\r\n                    return {\r\n                        title: item.find('a').text(),\r\n                        description,\r\n                        link: contentUrl,\r\n                        pubDate,\r\n                        author,\r\n                        category: category.filter(Boolean),\r\n                    };\r\n                });\r\n            })\r\n        ),\r\n    };\r\n}\r\n"],"mappings":"mbAQA,MAAaA,EAAe,CACxB,KAAM,gBACN,WAAY,CAAC,cACb,QAAS,kBACT,WAAY,CAAE,IAAK,OACnB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,QAAS,WACvB,UACA,YAAa;;8EAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAM,EAAI,IAAI,MAAM,OACpB,EAAe,qBACjB,EAAM,GACN,EAAQ,GACR,EAAO,GACX,OAAQ,EAAR,CACI,IAAK,KACD,EAAM,GAAG,EAAa,yBACtB,EAAQ,eACR,MACJ,IAAK,KACD,EAAM,GAAG,EAAa,mBACtB,EAAQ,eACR,MACJ,IAAK,KAED,EAAM,GAAG,EAAa,mBACtB,EAAQ,eACR,MACJ,IAAK,MACD,EAAM,GAAG,EAAa,oBACtB,EAAQ,gBACR,MACJ,IAAK,UACD,EAAM,8CACN,EAAQ,eACR,MACJ,IAAK,UACD,EAAM,GAAG,EAAa,iBACtB,EAAQ,kBACR,MACJ,QACI,EAAO,MAAM,uBAErB,IAAM,EAAW,MAAMC,EAAI,IAAI,GACzB,EAAI,EAAK,EAAS,MASxB,MARA,CAKI,EALA,EAAI,SAAS,kBACN,EAAE,mCACF,EAAI,SAAS,SACb,EAAE,gBAEF,EAAE,iCAGN,CACH,QACA,KAAM,EACN,KAAM,MAAM,QAAQ,IAChB,EAAK,UAAU,IAAK,GAAS,CACzB,EAAO,EAAE,GACT,IAAI,EAAa,EAAK,KAAK,KAAK,KAAK,QAErC,MADA,GAAa,EAAW,WAAW,QAAU,EAAa,IAAI,IAAI,EAAY,GAAK,KAC5EC,EAAM,OAAO,EAAY,SAAY,CACxC,IAAI,EACA,EACA,EACA,EACA,EACA,EACJ,GAAI,+BAA+B,KAAK,EAAK,QACrC,EAAW,SAAS,YACpB,EAAc,MAAMD,EAAI,IAAI,GAC5B,EAAe,EAAK,EAAY,MAChC,EAAa,UAAU,SACvB,EAAa,YAAY,SACzB,EAAc,iBAAiB,KAAK,EAAa,QAAU,EAAa,kBAAkB,OAAS,EAAa,iBAAiB,QAEjI,EAAc,EAAK,KAAK,KAAK,eAG7B,EAAW,SAAS,WAAY,CAChC,EAAc,MAAMA,EAAI,IAAI,GAC5B,EAAe,EAAK,EAAY,MAChC,IAAM,EAAK,EAAa,OACxB,EAAU,EAAS,EAAU,EAAa,mCAAmC,KAAK,WAAY,uBAAwB,GACtH,EAAS,EAAa,uBAAuB,KAAK,WAClD,EAAW,EAAa,yBAAyB,KAAK,WAAW,MAAM,QACnE,aAAa,KAAK,GAElB,EAAc,EAAa,kBAAkB,QAE7C,EAAa,UAAU,SACvB,EAAa,YAAY,SACzB,EAAc,gBAAgB,KAAK,GAAM,EAAa,iBAAiB,OAAS,EAAa,QAAQ,aAGzG,EAAc,EAAK,KAAK,KAAK,OAGrC,MAAO,CACH,MAAO,EAAK,KAAK,KAAK,OACtB,cACA,KAAM,EACN,UACA,SACA,SAAU,EAAS,OAAO"}