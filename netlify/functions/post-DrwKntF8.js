import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{config as n}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{ViewType as o}from"./types-A5bA50Mg.js";import s from"node:path";import c from"query-string";t();function l(t,n,i){let{id:a,source:o,owner:c,file_url:l,tags:u,score:d}=t,f=/^https?:\/\//.test(o),p=f?new URL(o).host:o||`unknown`,m={sample:`sample_url`,orig:`file_url`},h=[`mp4`,`webm`],g=l.slice(l.lastIndexOf(`.`)+1),_=h.includes(g),v=t[m[i]]||l;return _&&(v=l),r(s.join(e,`templates/description-39b85a63.art`),{id:a,source:o,owner:c,tags:u,link:n,isHttp:f,sourceHost:p,contentURL:v,isVideo:_,score:d||0})}function u(){return{apiKey:n.gelbooru.apiKey||``,userId:n.gelbooru.userId||``}}const d={path:`/post/:tags?/:quality?`,categories:[`picture`],view:o.Pictures,example:`/gelbooru/post/1girl rating:general`,parameters:{tags:"要搜索的标签，多个标签用 ` `（空格）隔开",quality:{description:"图片质量，可选值为 `sample`（压缩后的图片，推荐值） 或 `orig`（原图），默认为 `sample`",default:`sample`}},features:{requireConfig:[{name:`GELBOORU_API_KEY`,description:"Gelbooru 偶尔会开启 API 认证，需配合 `GELBOORU_USER_ID`，从 `https://gelbooru.com/index.php?page=account&s=options` 获取",optional:!0},{name:`GELBOORU_USER_ID`,description:"参见 `GELBOORU_API_KEY`",optional:!0}],requirePuppeteer:!1,antiCrawler:!1,supportRadar:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`gelbooru.com/index.php`]}],name:`标签查询`,maintainers:[`magicFeirl`],description:"\n- 默认查询: `/gelbooru/post` 功能等同查询 Gelbooru 网站最新的投稿\n- 单标签查询: `/gelbooru/post/1girl` 查询 `1girl` 的最新投稿\n- 多标签查询: `/gelbooru/post/1girl school_uniform rating:general`\n- 指定为原图: `/gelbooru/post/1girl school_uniform rating:general/orig`\n- 更多例子: 请参考 Gelbooru 官方 wiki https://gelbooru.com/index.php?page=wiki&s=&s=view&id=25921\n\n**可选的 URL 参数**\n- limit 页面返回数据量，默认 40，可选 1 ~ 100\n\ne.g.: `/gelbooru/post?limit=20&`\n",handler:f};async function f(e){let{tags:t=``,quality:n=`sample`}=e.req.param(),r=decodeURIComponent(t).trim(),{limit:o=40}=e.req.query(),{apiKey:s,useId:d}=u(),f=await a({url:`https://gelbooru.com/index.php`,searchParams:c.stringify({page:`dapi`,s:`post`,q:`index`,tags:r,api_key:s,user_id:d,limit:o<=0||o>100?40:o,json:1})}),p=f.data.post;return{title:r?`${r} - gelbooru.com`:`gelbooru.com post list`,link:`https://gelbooru.com/index.php?page=post&s=list&tags=${r}`,icon:`https://gelbooru.com/favicon.png`,logo:`https://gelbooru.com/favicon.png`,description:`Gelbooru post list`,item:p.map(e=>({title:e.id,id:e.id,link:`https://gelbooru.com/index.php?page=post&s=view&id=${e.id}`,author:e.owner,pubDate:i(e.created_at),description:l(e,`https://gelbooru.com/index.php?page=post&s=view&id=${e.id}`,n),upvotes:e.score,updated:i(e.change),media:{content:{url:e.file_url},thumbnail:{url:e.preview_url}},category:e.tags.split(/\s+/g)}))}}export{d as route};
//# sourceMappingURL=post-DrwKntF8.js.map