{"version":3,"file":"apex-news-Bq1DTmDk.js","names":["MarkdownIt","InvalidParameterError","ofetch","allItems: NewsItem[]","cache","route: Route"],"sources":["../../lib/routes/ea/apex-news.ts"],"sourcesContent":["import { parseDate } from '@/utils/parse-date';\r\nimport { ViewType, type Route, type DataItem } from '@/types';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport MarkdownIt from 'markdown-it';\r\n\r\nconst md = MarkdownIt({\r\n    html: true,\r\n    breaks: true,\r\n});\r\n\r\nconst langEnum = new Set(['zh-hant', 'en']);\r\nconst typeEnum = new Set(['latest', 'game-updates', 'news-article']);\r\n\r\nasync function handler(ctx) {\r\n    const { lang = 'en', type = 'latest' } = ctx.req.param();\r\n    const apiParams = new URLSearchParams({\r\n        limit: '13',\r\n        gameSlug: 'apex-legends',\r\n        offset: '0',\r\n    });\r\n    if (!langEnum.has(lang)) {\r\n        throw new InvalidParameterError(`Invalid language: ${lang}`);\r\n    }\r\n    if (!typeEnum.has(type)) {\r\n        throw new InvalidParameterError(`Invalid type: ${type}`);\r\n    }\r\n    if (type !== 'latest') {\r\n        apiParams.append('typeSlug', type);\r\n    }\r\n    if (lang !== 'en') {\r\n        apiParams.append('locale', lang);\r\n    }\r\n    const apiUrl = `https://drop-api.ea.com/news-articles/pagination?${apiParams}`;\r\n    const newsItems = await ofetch(apiUrl);\r\n\r\n    type NewsItem = DataItem & {\r\n        slug: string;\r\n    };\r\n    const allItems: NewsItem[] = [newsItems.featured, ...newsItems.items].filter(Boolean).map((item) => ({\r\n        title: item.title,\r\n        description: item.summary,\r\n        link: `https://www.ea.com${lang === 'en' ? '/' : '/' + lang + '/'}games/apex-legends/apex-legends/news/${item.slug}`,\r\n        pubDate: parseDate(item.publishingDate),\r\n        slug: item.slug,\r\n    }));\r\n    const items = await Promise.all(\r\n        allItems.map((item) =>\r\n            cache.tryGet(item.link ?? '', async () => {\r\n                const response = await ofetch(`https://drop-api.ea.com/news-articles/${item.slug}${lang === 'en' ? '' : '?locale=' + lang}`);\r\n                item.description = md.render(response.body);\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n    return {\r\n        title: `Apex Legends 官网资讯${type === 'latest' ? '' : `（${type === 'news-article' ? '最新消息' : '游戏更新'}）`}`,\r\n        link: `https://www.ea.com${lang === 'en' ? '/' : '/' + lang + '/'}games/apex-legends/apex-legends/news${type === 'latest' ? '' : `?type=${type}`}`,\r\n        item: items.map((item) => ({\r\n            title: item.title,\r\n            description: item.description,\r\n            link: item.link,\r\n            pubDate: item.pubDate,\r\n        })),\r\n        image: 'https://drop-assets.ea.com/images/F1GeiHWipvvKj7GtUVP3U/31bb122451e2dea6d14c9b497f8e09d4/apex-white-nav-logo.svg',\r\n    };\r\n}\r\nexport const route: Route = {\r\n    path: '/apex-news/:lang?/:type?',\r\n    categories: ['game'],\r\n    example: '/ea/apex-news/zh-hant/game-updates',\r\n    parameters: {\r\n        lang: {\r\n            description: '语言',\r\n            options: [\r\n                { value: 'zh-hant', label: '中文(繁体)' },\r\n                { value: 'en', label: 'English' },\r\n            ],\r\n            default: 'en',\r\n        },\r\n        type: {\r\n            description: '资讯类型（可选）',\r\n            options: [\r\n                { value: 'news-article', label: '最新消息' },\r\n                { value: 'game-updates', label: '游戏更新' },\r\n                { value: 'latest', label: '全部' },\r\n            ],\r\n            default: 'latest',\r\n        },\r\n    },\r\n    name: 'APEX Legends 官网资讯',\r\n    maintainers: ['IceChestnut'],\r\n    handler,\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    view: ViewType.Articles,\r\n};\r\n"],"mappings":"0aAOA,MAAM,EAAKA,EAAW,CAClB,KAAM,GACN,OAAQ,KAGN,EAAW,IAAI,IAAI,CAAC,UAAW,OAC/B,EAAW,IAAI,IAAI,CAAC,SAAU,eAAgB,iBAEpD,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAO,KAAM,OAAO,UAAa,EAAI,IAAI,QAC3C,EAAY,IAAI,gBAAgB,CAClC,MAAO,KACP,SAAU,eACV,OAAQ,MAEZ,GAAI,CAAC,EAAS,IAAI,GACd,MAAM,IAAIC,EAAsB,qBAAqB,KAEzD,GAAI,CAAC,EAAS,IAAI,GACd,MAAM,IAAIA,EAAsB,iBAAiB,KAEjD,IAAS,UACT,EAAU,OAAO,WAAY,GAE7B,IAAS,MACT,EAAU,OAAO,SAAU,GAE/B,IAAM,EAAS,oDAAoD,IAC7D,EAAY,MAAMC,EAAO,GAKzBC,EAAuB,CAAC,EAAU,SAAU,GAAG,EAAU,OAAO,OAAO,SAAS,IAAK,IAAU,CACjG,MAAO,EAAK,MACZ,YAAa,EAAK,QAClB,KAAM,qBAAqB,IAAS,KAAO,IAAM,IAAM,EAAO,IAAI,uCAAuC,EAAK,OAC9G,QAAS,EAAU,EAAK,gBACxB,KAAM,EAAK,QAET,EAAQ,MAAM,QAAQ,IACxB,EAAS,IAAK,GACVC,EAAM,OAAO,EAAK,MAAQ,GAAI,SAAY,CACtC,IAAM,EAAW,MAAMF,EAAO,yCAAyC,EAAK,OAAO,IAAS,KAAO,GAAK,WAAa,KAErH,MADA,GAAK,YAAc,EAAG,OAAO,EAAS,MAC/B,MAInB,MAAO,CACH,MAAO,oBAAoB,IAAS,SAAW,GAAK,IAAI,IAAS,eAAiB,OAAS,OAAO,KAClG,KAAM,qBAAqB,IAAS,KAAO,IAAM,IAAM,EAAO,IAAI,sCAAsC,IAAS,SAAW,GAAK,SAAS,MAC1I,KAAM,EAAM,IAAK,IAAU,CACvB,MAAO,EAAK,MACZ,YAAa,EAAK,YAClB,KAAM,EAAK,KACX,QAAS,EAAK,WAElB,MAAO,oHAGf,MAAaG,EAAe,CACxB,KAAM,2BACN,WAAY,CAAC,QACb,QAAS,qCACT,WAAY,CACR,KAAM,CACF,YAAa,KACb,QAAS,CACL,CAAE,MAAO,UAAW,MAAO,UAC3B,CAAE,MAAO,KAAM,MAAO,YAE1B,QAAS,MAEb,KAAM,CACF,YAAa,WACb,QAAS,CACL,CAAE,MAAO,eAAgB,MAAO,QAChC,CAAE,MAAO,eAAgB,MAAO,QAChC,CAAE,MAAO,SAAU,MAAO,OAE9B,QAAS,WAGjB,KAAM,oBACN,YAAa,CAAC,eACd,UACA,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,EAAS"}