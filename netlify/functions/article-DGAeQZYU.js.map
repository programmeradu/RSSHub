{"version":3,"file":"article-DGAeQZYU.js","names":["route: Route","got","cache","$","res"],"sources":["../../lib/routes/gov/mofcom/article.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst host = 'http://www.mofcom.gov.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/mofcom/article/:suffix{.+}',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const suffix = ctx.req.param('suffix');\r\n    const url = `http://www.mofcom.gov.cn/article/${suffix}/`;\r\n    const { data: res } = await got(url);\r\n    const $ = load(res);\r\n    $('.listline').remove();\r\n    const list = $('.txtList_01 li')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const date =\r\n                item.find('span').length === 0\r\n                    ? item\r\n                          .find('a')\r\n                          .attr('title')\r\n                          .match(/(\\d{4}年\\d{1,2}月\\d{1,2})/)[1]\r\n                    : item\r\n                          .find('span')\r\n                          .text()\r\n                          .match(/((\\d{4}-\\d{2}-\\d{2})(\\s\\d{2}:\\d{2}:\\d{2})?)/)[1];\r\n            return {\r\n                title: item.find('a').attr('title'),\r\n                link: host + item.find('a').attr('href'),\r\n                pubDate: timezone(parseDate(date, ['YYYY-MM-DD HH:mm:ss', 'YYYY-MM-DD', 'YYYY年M月D']), 8),\r\n            };\r\n        });\r\n\r\n    await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                let responses = await got(item.link);\r\n                // xwfb/xwlxfbh || xwfb/xwztfbh\r\n                const redirect = responses.data.match(/_cofing1={href:\"(.*)\",type/) || responses.data.match(/window\\.location\\.href='(.*)'/);\r\n                if (redirect) {\r\n                    responses = await got(redirect[1], {\r\n                        headers: {\r\n                            Referer: item.link,\r\n                        },\r\n                    });\r\n                }\r\n                const $ = load(responses.data);\r\n                const iframe = $('.art-con iframe').attr('src');\r\n                if ($('.art-con iframe').attr('src')) {\r\n                    const { data: res } = await got(iframe);\r\n                    item.description = load(res)('tbody').html();\r\n                } else {\r\n                    item.description = $('.art-con').html() || /* xwfb/xwztfbh */ $('.textlive').html();\r\n                }\r\n                item.pubDate = $('meta[name=\"PubDate\"]').length ? timezone(parseDate($('meta[name=\"PubDate\"]').attr('content'), 'YYYY-MM-DD HH:mm'), 8) : item.pubDate;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n    return {\r\n        title: $('head > title').text(),\r\n        description: $('meta[name=description]').attr('content'),\r\n        link: url,\r\n        item: list,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAEaA,EAAe,CACxB,KAAM,8BACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,EAAI,IAAI,MAAM,UACvB,EAAM,oCAAoC,EAAO,GACjD,CAAE,KAAM,GAAQ,MAAMC,EAAI,GAC1B,EAAI,EAAK,GACf,EAAE,aAAa,SACf,IAAM,EAAO,EAAE,kBACV,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EACF,EAAK,KAAK,QAAQ,SAAW,EACvB,EACK,KAAK,KACL,KAAK,SACL,MAAM,2BAA2B,GACtC,EACK,KAAK,QACL,OACA,MAAM,+CAA+C,GACpE,MAAO,CACH,MAAO,EAAK,KAAK,KAAK,KAAK,SAC3B,KAAM,2BAAO,EAAK,KAAK,KAAK,KAAK,QACjC,QAAS,EAAS,EAAU,EAAM,CAAC,sBAAuB,aAAc,aAAc,MA+BlG,OA3BA,MAAM,QAAQ,IACV,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAI,EAAY,MAAMD,EAAI,EAAK,MAEzB,EAAW,EAAU,KAAK,MAAM,+BAAiC,EAAU,KAAK,MAAM,iCACxF,IACA,EAAY,MAAMA,EAAI,EAAS,GAAI,CAC/B,QAAS,CACL,QAAS,EAAK,SAI1B,IAAME,EAAI,EAAK,EAAU,MACnB,EAASA,EAAE,mBAAmB,KAAK,OACzC,GAAIA,EAAE,mBAAmB,KAAK,OAAQ,CAClC,GAAM,CAAE,KAAMC,GAAQ,MAAMH,EAAI,GAChC,EAAK,YAAc,EAAKG,GAAK,SAAS,YAEtC,EAAK,YAAcD,EAAE,YAAY,QAA6BA,EAAE,aAAa,OAIjF,MAFA,GAAK,QAAUA,EAAE,wBAAwB,OAAS,EAAS,EAAUA,EAAE,wBAAwB,KAAK,WAAY,oBAAqB,GAAK,EAAK,QAExI,MAIZ,CACH,MAAO,EAAE,gBAAgB,OACzB,YAAa,EAAE,0BAA0B,KAAK,WAC9C,KAAM,EACN,KAAM"}