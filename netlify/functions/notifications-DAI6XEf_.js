import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{ofetch_default as n}from"./ofetch-Bzt0BXUH.js";import"./config-not-found-BVqhRP9D.js";import{getConfig as r}from"./utils-5frMQMqH.js";const i={path:`/:configId/notifications/:fulltext?`,categories:[`bbs`],example:`/discourse/0/notifications`,parameters:{configId:`Environment variable configuration id, see above`,fulltext:"Fetch the content if the notification points to a post. This is disabled by default, set it to `1` to enable it."},features:{requireConfig:[{name:`DISCOURSE_CONFIG_*`,description:``}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Notifications`,maintainers:[],handler:a,description:"::: warning\nIf you opt to enable `fulltext` feature, consider adding `limit` parameter to your query to avoid sending too many request.\n:::"};async function a(i){let{link:a,key:o}=r(i),s=await n(`${a}/notifications.json`,{headers:{"User-Api-Key":o}}),c=s.notifications.slice(0,i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`)):10).map(e=>({title:e.fancy_title??e.data.badge_name,link:`${a}/${Object.hasOwn(e.data,`badge_id`)?`badges/${e.data.badge_id}/${e.data.badge_slug}?username=${e.data.username}`:`t/topic/${e.topic_id}/${e.post_number}`}`,pubDate:new Date(e.created_at),author:e.data.display_username??e.data.username,category:[`notification_type:${e.notification_type}`,`read:${e.read}`,`high_priority:${e.high_priority}`],original_post_id:e.data.original_post_id}));i.req.param(`fulltext`)===`1`&&(c=await Promise.all(c.map(e=>{if(e.original_post_id){let r=`${a}/posts/${e.original_post_id}.json`;return t.tryGet(r,async()=>{let{cooked:t}=await n(r,{headers:{"User-Api-Key":o}});return{...e,description:t}})}else return e})));let{about:l}=await t.tryGet(a,async()=>await n(`${a}/about.json`,{headers:{"User-Api-Key":o}}),e.cache.routeExpire,!1);return{title:`${l.title} - Notifications`,description:l.description,item:c,allowEmpty:!0}}export{i as route};
//# sourceMappingURL=notifications-DAI6XEf_.js.map