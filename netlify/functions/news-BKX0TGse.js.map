{"version":3,"file":"news-BKX0TGse.js","names":["got","route: Route","$","cache"],"sources":["../../lib/routes/wfu/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\n// 参考 whu/news 武汉大学页面写成\r\n\r\nconst baseUrl = 'https://www.wfu.edu.cn';\r\nconst sizeTitle = '--潍坊学院新闻';\r\n\r\nconst catrgoryMap = {\r\n    wyyw: ['/50/list.htm', '潍院要闻'],\r\n    zhxw: ['/52/list.htm', '综合新闻'],\r\n    xszh: ['/xszh/list.htm', '学术纵横'],\r\n};\r\n\r\n// 专门定义一个function用于加载文章内容\r\nasync function loadContent(link) {\r\n    let description = '';\r\n\r\n    let response;\r\n    // 如果不是 大学的站点, 直接返回简单的标题即可\r\n    // 判断 是否外站链接,如果是 则直接返回页面 不做单独的解析\r\n    const https_reg = /^https:\\/\\/www.wfu.edu.cn(.*)/;\r\n    if (!https_reg.test(link)) {\r\n        return { description };\r\n    }\r\n    try {\r\n        // 异步请求文章\r\n        response = await got.get(link);\r\n    } catch (error) {\r\n        // 如果网络问题 直接出错\r\n        if (error.name && (error.name === 'HTTPError' || error.name === 'RequestError' || error.name === 'FetchError')) {\r\n            description = 'Page 404 Please Check!';\r\n        }\r\n        return { description };\r\n    }\r\n    // 加载文章内容\r\n    const $ = load(response.data);\r\n\r\n    // 提取文章内容\r\n    description = $('div.wp_articlecontent').html();\r\n    // 返回解析的结果\r\n    return { description };\r\n}\r\n\r\nexport const route: Route = {\r\n    path: '/news/:type?',\r\n    categories: ['university'],\r\n    example: '/wfu/news/wyyw',\r\n    parameters: { type: '分类，默认为 `wyyw`，具体参数见下表' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['news.wfu.edu.cn/'],\r\n            target: '/news',\r\n        },\r\n    ],\r\n    name: '新闻',\r\n    maintainers: ['cccht'],\r\n    handler,\r\n    url: 'news.wfu.edu.cn/',\r\n    description: `| **内容** | **参数** |\r\n| :------: | :------: |\r\n| 潍院要闻 |   wyyw   |\r\n| 综合新闻 |   zhxw   |\r\n| 学术纵横 |   xszh   |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    // 默认 潍院要闻 然后获取列表页面\r\n    const type = ctx.req.param('type') ?? 'wyyw';\r\n    const listPageUrl = baseUrl + catrgoryMap[type][0];\r\n    const response = await got({\r\n        method: 'get',\r\n        url: listPageUrl,\r\n        headers: {\r\n            Referer: baseUrl,\r\n        },\r\n    });\r\n    const $ = load(response.data);\r\n\r\n    // 获取当前页面的 list\r\n    const list = $('div[frag=窗口1]>ul>li');\r\n\r\n    const result = await Promise.all(\r\n        // 遍历每一篇文章\r\n        list.toArray().map(async (item) => {\r\n            const $ = load(item); // 将列表项加载成 html\r\n            const $item_url = 'https://www.wfu.edu.cn' + $('a').attr('href'); // 获取 每一项的url\r\n            const $title = $('a>div.txt>h1').text(); // 获取每个的标题\r\n            const $pubdate = timezone(parseDate($('a>div.txt>span.date').text().split('：')[1]), +8); // 获取发布时间\r\n\r\n            // 列表上提取到的信息\r\n            // 标题 链接\r\n            const single = {\r\n                title: $title,\r\n                pubDate: $pubdate,\r\n                link: $item_url,\r\n                guid: $item_url,\r\n            };\r\n\r\n            // 对于列表的每一项, 单独获取 时间与详细内容\r\n\r\n            const other = await cache.tryGet($item_url, () => loadContent($item_url));\r\n            // 合并解析后的结果集作为该篇文章最终的输出结果\r\n            return { ...single, ...other };\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: catrgoryMap[type][1] + sizeTitle,\r\n        link: baseUrl,\r\n        description: catrgoryMap[type][1] + sizeTitle,\r\n        item: result,\r\n    };\r\n}\r\n"],"mappings":"0ZASA,MAAM,EAAU,yBACV,EAAY,WAEZ,EAAc,CAChB,KAAM,CAAC,eAAgB,QACvB,KAAM,CAAC,eAAgB,QACvB,KAAM,CAAC,iBAAkB,SAI7B,eAAe,EAAY,EAAM,CAC7B,IAAI,EAAc,GAEd,EAGE,EAAY,gCAClB,GAAI,CAAC,EAAU,KAAK,GAChB,MAAO,CAAE,eAEb,GAAI,CAEA,EAAW,MAAMA,EAAI,IAAI,SACpB,EAAO,CAKZ,OAHI,EAAM,OAAS,EAAM,OAAS,aAAe,EAAM,OAAS,gBAAkB,EAAM,OAAS,gBAC7F,EAAc,0BAEX,CAAE,eAGb,IAAM,EAAI,EAAK,EAAS,MAKxB,MAFA,GAAc,EAAE,yBAAyB,OAElC,CAAE,eAGb,MAAaC,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,cACb,QAAS,iBACT,WAAY,CAAE,KAAM,yBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,oBACT,OAAQ,UAGhB,KAAM,KACN,YAAa,CAAC,SACd,UACA,IAAK,mBACL,YAAa;;;;sBAOjB,eAAe,EAAQ,EAAK,CAExB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,OAChC,EAAc,EAAU,EAAY,GAAM,GAC1C,EAAW,MAAMD,EAAI,CACvB,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,KAGX,EAAI,EAAK,EAAS,MAGlB,EAAO,EAAE,uBAET,EAAS,MAAM,QAAQ,IAEzB,EAAK,UAAU,IAAI,KAAO,IAAS,CAC/B,IAAME,EAAI,EAAK,GACT,EAAY,yBAA2BA,EAAE,KAAK,KAAK,QACnD,EAASA,EAAE,gBAAgB,OAC3B,EAAW,EAAS,EAAUA,EAAE,uBAAuB,OAAO,MAAM,KAAK,IAAK,GAI9E,EAAS,CACX,MAAO,EACP,QAAS,EACT,KAAM,EACN,KAAM,GAKJ,EAAQ,MAAMC,EAAM,OAAO,MAAiB,EAAY,IAE9D,MAAO,CAAE,GAAG,EAAQ,GAAG,MAI/B,MAAO,CACH,MAAO,EAAY,GAAM,GAAK,EAC9B,KAAM,EACN,YAAa,EAAY,GAAM,GAAK,EACpC,KAAM"}