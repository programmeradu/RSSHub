{"version":3,"file":"manga-C7EtGE6T.js","names":["route: Route","puppeteer"],"sources":["../../lib/routes/colamanga/manga.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport puppeteer from '@/utils/puppeteer';\r\n\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { Context } from 'hono';\r\nimport logger from '@/utils/logger';\r\n\r\nconst domain = 'www.colamanga.com';\r\n\r\nexport const route: Route = {\r\n    path: '/:id',\r\n    parameters: { id: '漫画id' },\r\n    name: 'Manga',\r\n    maintainers: ['machsix'],\r\n    example: '/colamanga/manga-qq978758',\r\n    categories: ['anime'],\r\n    radar: [\r\n        {\r\n            source: [`${domain}/:id/`],\r\n            target: '/:id',\r\n        },\r\n    ],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: true,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    handler,\r\n};\r\n\r\nfunction shift_date(date, days) {\r\n    const result = new Date(date);\r\n    result.setDate(result.getDate() + days);\r\n    return result;\r\n}\r\n\r\nasync function handler(ctx: Context) {\r\n    const id = ctx.req.param('id');\r\n    const url = `https://${domain}/${id}`;\r\n\r\n    const browser = await puppeteer();\r\n\r\n    const page = await browser.newPage();\r\n\r\n    await page.setRequestInterception(true);\r\n\r\n    page.on('request', (request) => {\r\n        request.resourceType() === 'document' ? request.continue() : request.abort();\r\n    });\r\n\r\n    logger.http(`Requesting ${url}`);\r\n    await page.goto(url, {\r\n        // 指定页面等待载入的时间\r\n        waitUntil: 'domcontentloaded',\r\n    });\r\n\r\n    const response = await page.content();\r\n    await browser.close();\r\n\r\n    const $ = load(response);\r\n\r\n    const book_name = $(\"meta[property='og:comic:book_name']\").attr('content');\r\n    const updateDateAttr = $(\"meta[property='og:comic:update_time']\").attr('content');\r\n    const updateDate = updateDateAttr ? timezone(parseDate(updateDateAttr)) : timezone(new Date());\r\n\r\n    const author = $(\"span:contains('作者')\").parent().contents().eq(1).text();\r\n    // const cover = $(\".fed-deta-images a\").attr('data-original');\r\n    const items = $('.all_data_list >ul>li>a')\r\n        .toArray()\r\n        .map((elem, i) => ({\r\n            title: `${book_name} ${$(elem).text()}`,\r\n            link: elem.attribs.href,\r\n            description: $('.fed-part-esan').text(),\r\n            author,\r\n            pubDate: shift_date(updateDate, -7 * i),\r\n        }));\r\n\r\n    return {\r\n        title: book_name || 'Unknown Manga',\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"iTASA,MAAM,EAAS,oBAEFA,EAAe,CACxB,KAAM,OACN,WAAY,CAAE,GAAI,QAClB,KAAM,QACN,YAAa,CAAC,WACd,QAAS,4BACT,WAAY,CAAC,SACb,MAAO,CACH,CACI,OAAQ,CAAC,GAAG,EAAO,QACnB,OAAQ,SAGhB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,WAGJ,SAAS,EAAW,EAAM,EAAM,CAC5B,IAAM,EAAS,IAAI,KAAK,GAExB,OADA,EAAO,QAAQ,EAAO,UAAY,GAC3B,EAGX,eAAe,EAAQ,EAAc,CACjC,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAM,WAAW,EAAO,GAAG,IAE3B,EAAU,MAAMC,IAEhB,EAAO,MAAM,EAAQ,UAE3B,MAAM,EAAK,uBAAuB,IAElC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,WAAa,EAAQ,WAAa,EAAQ,UAGzE,EAAO,KAAK,cAAc,KAC1B,MAAM,EAAK,KAAK,EAAK,CAEjB,UAAW,qBAGf,IAAM,EAAW,MAAM,EAAK,UAC5B,MAAM,EAAQ,QAEd,IAAM,EAAI,EAAK,GAET,EAAY,EAAE,uCAAuC,KAAK,WAC1D,EAAiB,EAAE,yCAAyC,KAAK,WACjE,EAA8B,EAAjB,EAA0B,EAAU,GAA4B,IAAI,MAEjF,EAAS,EAAE,uBAAuB,SAAS,WAAW,GAAG,GAAG,OAE5D,EAAQ,EAAE,2BACX,UACA,KAAK,EAAM,KAAO,CACf,MAAO,GAAG,EAAU,GAAG,EAAE,GAAM,SAC/B,KAAM,EAAK,QAAQ,KACnB,YAAa,EAAE,kBAAkB,OACjC,SACA,QAAS,EAAW,EAAY,GAAK,MAG7C,MAAO,CACH,MAAO,GAAa,gBACpB,KAAM,EACN,KAAM"}