{"version":3,"file":"wenjian-CMZ7ZH1G.js","names":["route: Route","got","cache","$"],"sources":["../../lib/routes/gov/zhengce/wenjian.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/zhengce/wenjian/:pcodeJiguan?',\r\n    categories: ['government'],\r\n    example: '/gov/zhengce/wenjian',\r\n    parameters: { pcodeJiguan: '文种分类。国令、国发、国函、国发明电、国办发、国办函、国办发明电、其他' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.gov.cn/'],\r\n            target: '/zhengce/wenjian',\r\n        },\r\n    ],\r\n    name: '最新文件',\r\n    maintainers: ['ciaranchen'],\r\n    handler,\r\n    url: 'www.gov.cn/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const pcodeJiguan = ctx.req.param('pcodeJiguan');\r\n    const link = 'http://sousuo.gov.cn/list.htm';\r\n    const res = await got(link, {\r\n        searchParams: {\r\n            n: ctx.req.query('limit') ? Number(ctx.req.query('limit')) : 20,\r\n            sort: 'pubtime',\r\n            t: 'paper',\r\n            pcodeJiguan: pcodeJiguan ?? '',\r\n        },\r\n    });\r\n    const $ = load(res.data);\r\n\r\n    const list = $('body > div.dataBox > table > tbody > tr')\r\n        .slice(1)\r\n        .toArray()\r\n        .map((elem) => {\r\n            elem = $(elem);\r\n            return {\r\n                title: elem.find('td:nth-child(2) > a').text(),\r\n                link: elem.find('td:nth-child(2) > a').attr('href'),\r\n                pubDate: timezone(parseDate(elem.find('td:nth-child(5)').text()), 8),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const contentData = await got(item.link);\r\n                const $ = load(contentData.data);\r\n                item.description = $('#UCAP-CONTENT').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '最新文件 - 中国政府网',\r\n        link: res.url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAaA,EAAe,CACxB,KAAM,iCACN,WAAY,CAAC,cACb,QAAS,uBACT,WAAY,CAAE,YAAa,uCAC3B,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,eACT,OAAQ,qBAGhB,KAAM,OACN,YAAa,CAAC,cACd,UACA,IAAK,eAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAc,EAAI,IAAI,MAAM,eAE5B,EAAM,MAAMC,EAAI,gCAAM,CACxB,aAAc,CACV,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,EAAI,IAAI,MAAM,UAAY,GAC7D,KAAM,UACN,EAAG,QACH,YAAa,GAAe,MAG9B,EAAI,EAAK,EAAI,MAEb,EAAO,EAAE,2CACV,MAAM,GACN,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,uBAAuB,OACxC,KAAM,EAAK,KAAK,uBAAuB,KAAK,QAC5C,QAAS,EAAS,EAAU,EAAK,KAAK,mBAAmB,QAAS,MAIxE,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAc,MAAMD,EAAI,EAAK,MAC7BE,EAAI,EAAK,EAAY,MAE3B,MADA,GAAK,YAAcA,EAAE,iBAAiB,OAC/B,MAKnB,MAAO,CACH,MAAO,eACP,KAAM,EAAI,IACV,KAAM"}