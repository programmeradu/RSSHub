{"version":3,"file":"ceai-BvalWBpP.js","names":["got","route: Route","got","util","cache"],"sources":["../../lib/routes/njnu/ceai/utils.ts","../../lib/routes/njnu/ceai/ceai.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\n// 专门定义一个function用于加载文章内容\r\nasync function loadContent(link) {\r\n    // 异步请求文章\r\n    const response = await got.get(link, {\r\n        https: {\r\n            rejectUnauthorized: false,\r\n        },\r\n    });\r\n    // 加载文章内容\r\n    const $ = load(response.data);\r\n    const dateStr = $('#xw_xinxi span:nth-child(1)').text();\r\n    // 解析日期\r\n    const pubDate = timezone(parseDate(dateStr, 'YYYY-MM-DD', 'zh-cn'), +8);\r\n    // 提取内容\r\n    const description = $('#xw_content').html();\r\n\r\n    // 返回解析的结果\r\n    return { description, pubDate };\r\n}\r\n\r\nconst ProcessFeed = (list, caches) =>\r\n    Promise.all(\r\n        // 遍历每一篇文章\r\n        list.map(async (item) => {\r\n            const $ = load(item);\r\n\r\n            const $title = $('a');\r\n            // 还原相对链接为绝对链接\r\n            const itemUrl = $title.attr('href');\r\n\r\n            // 列表上提取到的信息\r\n            const single = {\r\n                title: $title.text(),\r\n                link: itemUrl,\r\n                author: '计算机与电子信息学院-人工智能学院',\r\n                guid: itemUrl,\r\n            };\r\n\r\n            // 使用tryGet方法从缓存获取内容。\r\n            // 当缓存中无法获取到链接内容的时候，则使用load方法加载文章内容。\r\n            const other = await caches.tryGet(itemUrl, () => loadContent(itemUrl));\r\n\r\n            // 合并解析后的结果集作为该篇文章最终的输出结果\r\n            return { ...single, ...other };\r\n        })\r\n    );\r\n\r\nexport default { ProcessFeed };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport util from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/ceai/:type',\r\n    categories: ['university'],\r\n    example: '/njnu/ceai/xszx',\r\n    parameters: { type: '分类名' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '计算机与电子信息学院 - 人工智能学院',\r\n    maintainers: ['Shujakuinkuraudo'],\r\n    handler,\r\n    description: `| 学院公告 | 学院新闻 | 学生资讯 |\r\n| -------- | -------- | -------- |\r\n| xygg     | xyxw     | xszx     |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type');\r\n    let title, path;\r\n    switch (type) {\r\n        case 'xygg':\r\n            title = '学院公告';\r\n            path = '1651';\r\n            break;\r\n        case 'xyxw':\r\n            title = '学院新闻';\r\n            path = '1652';\r\n            break;\r\n        case 'xszx':\r\n            title = '学生资讯';\r\n            path = '1659';\r\n            break;\r\n    }\r\n    const base = 'http://ceai.njnu.edu.cn/Item/List.asp?ID=' + path;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: base,\r\n        https: {\r\n            rejectUnauthorized: false,\r\n        },\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    const list = $('span a').toArray();\r\n\r\n    const result = await util.ProcessFeed(list, cache);\r\n\r\n    return {\r\n        title: '南京师范大学计电人院 - ' + title,\r\n        link: 'http://ceai.njnu.edu.cn/',\r\n        description: '南京师范大学计电人院',\r\n        item: result,\r\n    };\r\n}\r\n"],"mappings":"0ZAMA,eAAe,EAAY,EAAM,CAE7B,IAAM,EAAW,MAAME,EAAI,IAAI,EAAM,CACjC,MAAO,CACH,mBAAoB,MAItB,EAAI,EAAK,EAAS,MAClB,EAAU,EAAE,+BAA+B,OAE3C,EAAU,EAAS,EAAU,EAAS,aAAc,SAAU,GAE9D,EAAc,EAAE,eAAe,OAGrC,MAAO,CAAE,cAAa,WAG1B,MAAM,GAAe,EAAM,IACvB,QAAQ,IAEJ,EAAK,IAAI,KAAO,IAAS,CACrB,IAAM,EAAI,EAAK,GAET,EAAS,EAAE,KAEX,EAAU,EAAO,KAAK,QAGtB,EAAS,CACX,MAAO,EAAO,OACd,KAAM,EACN,OAAQ,oBACR,KAAM,GAKJ,EAAQ,MAAM,EAAO,OAAO,MAAe,EAAY,IAG7D,MAAO,CAAE,GAAG,EAAQ,GAAG,MAInC,IAAA,EAAe,CAAE,eC9CjB,MAAaD,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,cACb,QAAS,kBACT,WAAY,CAAE,KAAM,OACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,sBACN,YAAa,CAAC,oBACd,UACA,YAAa;;qCAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACvB,EAAO,EACX,OAAQ,EAAR,CACI,IAAK,OACD,EAAQ,OACR,EAAO,OACP,MACJ,IAAK,OACD,EAAQ,OACR,EAAO,OACP,MACJ,IAAK,OACD,EAAQ,OACR,EAAO,OACP,MAER,IAAM,EAAO,4CAA8C,EAErD,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,EACL,MAAO,CACH,mBAAoB,MAItB,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,UAAU,UAEnB,EAAS,MAAMC,EAAK,YAAY,EAAMC,GAE5C,MAAO,CACH,MAAO,gBAAkB,EACzB,KAAM,2BACN,YAAa,aACb,KAAM"}