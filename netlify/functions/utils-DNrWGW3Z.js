import{config as e}from"./config-Dl8a1sIg.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{md5 as n}from"./md5-4BNsOP-F.js";import{ofetch_default as r}from"./ofetch-Bzt0BXUH.js";import{load as i}from"cheerio";function a(e,t,n){t[n]=255&e>>>24,t[n+1]=255&e>>>16,t[n+2]=255&e>>>8,t[n+3]=255&e}function o(e,t){return(255&e[t])<<24|(255&e[t+1])<<16|(255&e[t+2])<<8|255&e[t+3]}function s(e,t){return(4294967295&e)<<t|e>>>32-t}function c(e){let t=Array.from({length:4}),n=Array.from({length:4});a(e,t,0),n[0]=u.zb[255&t[0]],n[1]=u.zb[255&t[1]],n[2]=u.zb[255&t[2]],n[3]=u.zb[255&t[3]];let r=o(n,0);return r^s(r,2)^s(r,10)^s(r,18)^s(r,24)}const l={x(e,t){let n=[];for(let r=e.length,i=0;0<r;r-=16){let r=Array.from({length:16});for(let n=e.slice(16*i,16*(i+1)),a=0;a<16;a++)r[a]=n[a]^t[a];t=l.r(r),n=n.concat(t),i++}return n},r(e){let t=Array.from({length:16}),n=Array.from({length:36});n[0]=o(e,0),n[1]=o(e,4),n[2]=o(e,8),n[3]=o(e,12);for(let e=0;e<32;e++){let t=c(n[e+1]^n[e+2]^n[e+3]^u.zk[e]);n[e+4]=n[e]^t}return a(n[35],t,0),a(n[34],t,4),a(n[33],t,8),a(n[32],t,12),t}},u={zk:[1170614578,1024848638,1413669199,-343334464,-766094290,-1373058082,-143119608,-297228157,1933479194,-971186181,-406453910,460404854,-547427574,-1891326262,-1679095901,2119585428,-2029270069,2035090028,-1521520070,-5587175,-77751101,-2094365853,-1243052806,1579901135,1321810770,456816404,-1391643889,-229302305,330002838,-788960546,363569021,-1947871109],zb:[20,223,245,7,248,2,194,209,87,6,227,253,240,128,222,91,237,9,125,157,230,93,252,205,90,79,144,199,159,197,186,167,39,37,156,198,38,42,43,168,217,153,15,103,80,189,71,191,97,84,247,95,36,69,14,35,12,171,28,114,178,148,86,182,32,83,158,109,22,255,94,238,151,85,77,124,254,18,4,26,123,176,232,193,131,172,143,142,150,30,10,146,162,62,224,218,196,229,1,192,213,27,110,56,231,180,138,107,242,187,54,120,19,44,117,228,215,203,53,239,251,127,81,11,133,96,204,132,41,115,73,55,249,147,102,48,122,145,106,118,74,190,29,16,174,5,177,129,63,113,99,31,161,76,246,34,211,13,60,68,207,160,65,111,82,165,67,169,225,57,112,244,155,51,236,200,233,58,61,47,100,137,185,64,17,70,234,163,219,108,170,166,59,149,52,105,24,212,78,173,45,0,116,226,119,136,206,135,175,195,25,92,121,208,126,139,3,75,141,21,130,98,241,40,154,66,184,49,181,46,243,88,101,183,8,23,72,188,104,179,210,134,250,201,164,89,216,202,220,50,221,152,140,33,235,214]},d=e=>{let t=``;for(let n of[0,6,12,18]){let r=e>>>n,i=r&63,a=`6fpLRqJO8M/c3jnYxFkUVC4ZIG12SiH=5v0mXDazWBTsuw7QetbKdoPyAl+hN9rgE`.charAt(i);t+=a}return t},f=e=>{let t=[];for(let n=0;n<e.length;n++)t.push(e.charCodeAt(n));t.unshift(0),t.unshift(Math.random()*127);for(let e=0;e<15;e++)t.push(14);let n=t.slice(0,16),r=[48,53,57,48,53,51,102,55,100,49,53,101,48,49,100,55],i=[];for(let[e,t]of n.entries())i.push(t^r[e]^42);let a=l.r(i),o=t.slice(16,48),s=l.x(o,a);return a.concat(s)},p=e=>{let t=f(e),n=0,r=``;for(let e=0;e<t.length;e++){let i=t[t.length-e-1],a=e%4,o=e%3,s=8*a,c=58>>>s,l=c&255,u=i^l,f=u<<8*o;n|=f,o===2&&(r+=d(n),n=0)}return r};var m=p;const h={"x-api-version":`3.0.91`},g=e=>e.split(`?`)[0].replace(`_b.jpg`,`.jpg`).replace(`_r.jpg`,`.jpg`).replace(`_720w.jpg`,`.jpg`),_=e=>{let t=i(e,null,!1);return t(`noscript, a[data-draft-type="mcn-link-card"]`).remove(),t(`a`).each((e,n)=>{let r=t(n).attr(`href`);if(r?.startsWith(`http://link.zhihu.com/?target=`)||r?.startsWith(`https://link.zhihu.com/?target=`)){let e=new URL(r),i=e.searchParams.get(`target`)||``;try{t(n).attr(`href`,decodeURIComponent(i))}catch{}}}),t(`img.content_image, img.origin_image, img.content-image, img.data-actualsrc, figure>img`).each((e,n)=>{n.attribs[`data-actualsrc`]?(t(n).attr({src:g(n.attribs[`data-actualsrc`]),width:null,height:null}),t(n).removeAttr(`data-actualsrc`)):n.attribs[`data-original`]?(t(n).attr({src:g(n.attribs[`data-original`]),width:null,height:null}),t(n).removeAttr(`data-original`)):t(n).attr({src:g(n.attribs.src),width:null,height:null})}),t.html()},v=t=>e.zhihu.cookies?.split(`;`).map(e=>e.trim()).find(e=>e.startsWith(t+`=`))?.slice(t.length+1)||``,y=async(e,i)=>{let{dc0:a,zseCk:o}=await t.tryGet(`zhihu:cookies:d_c0`,async()=>{if(v(`d_c0`)&&v(`__zse_ck`))return{dc0:v(`d_c0`),zseCk:v(`__zse_ck`)};let t=await r.raw(`https://static.zhihu.com/zse-ck/v3.js`),n=await t._data.text(),i=n.match(/__g\.ck\|\|"([\w+/=\\]*?)",_=/)?.[1],a=i?await r.raw(e,{headers:{cookie:`${t.headers.getSetCookie().map(e=>e.split(`;`)[0]).join(`; `)}; __zse_ck=${i}`}}):null,o=(a||t).headers.getSetCookie().find(e=>e.startsWith(`d_c0=`))?.split(`;`)[0].trim().slice(5)||``;return{dc0:o,zseCk:i}}),s=`101_3_3.0`,c=`${s}+${i}+${a}`,l=`2.0_`+m(n(c)),u=v(`z_c0`);return{cookie:`__zse_ck=${o}; d_c0=${a}${u?`;z_c0=${u}`:``}`,"x-zse-96":l,"x-app-za":`OS=Web`,"x-zse-93":s}};export{y as getSignedHeader,h as header,_ as processImage};
//# sourceMappingURL=utils-DNrWGW3Z.js.map