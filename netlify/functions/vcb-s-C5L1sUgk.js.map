{"version":3,"file":"vcb-s-C5L1sUgk.js","names":[],"sources":["../../lib/routes/vcb-s/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst rootUrl = 'https://vcb-s.com';\r\nconst postsAPIUrl = `${rootUrl}/wp-json/wp/v2/posts`;\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    radar: [\r\n        {\r\n            source: ['vcb-s.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['cxfksword'],\r\n    handler,\r\n    url: 'vcb-s.com/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const limit = ctx.req.query('limit') ?? 7;\r\n    const url = `${postsAPIUrl}?per_page=${limit}&_embed`;\r\n\r\n    const response = await got.get(url);\r\n    if (typeof response.data === 'string') {\r\n        response.data = JSON.parse(response.body.trim());\r\n    }\r\n    const data = response.data;\r\n\r\n    const items = data.map((item) => {\r\n        const description = art(path.join(__dirname, 'templates/post.art'), {\r\n            post: item.content.rendered.replaceAll(/<pre class=\"js-medie-info-detail.*?>(.*?)<\\/pre>/gs, '<pre><code>$1</code></pre>').replaceAll(/<div.+?dw-box-download.+?>(.*?)<\\/div>/gs, '<pre>$1</pre>'),\r\n            medias: item._embedded['wp:featuredmedia'],\r\n        });\r\n\r\n        return {\r\n            title: item.title.rendered,\r\n            link: item.link,\r\n            description,\r\n            pubDate: parseDate(item.date_gmt),\r\n            author: item._embedded.author[0].name,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: 'VCB-Studio - 大家一起实现的故事！',\r\n        link: rootUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"qYAOA,MAAM,EAAU,oBACV,EAAc,GAAG,EAAQ,sBAElB,EAAe,CACxB,KAAM,IACN,MAAO,CACH,CACI,OAAQ,CAAC,cACT,OAAQ,KAGhB,KAAM,UACN,YAAa,CAAC,aACd,UACA,IAAK,cAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,UAAY,EAClC,EAAM,GAAG,EAAY,YAAY,EAAM,SAEvC,EAAW,MAAM,EAAI,IAAI,GAC3B,OAAO,EAAS,MAAS,WACzB,EAAS,KAAO,KAAK,MAAM,EAAS,KAAK,SAE7C,IAAM,EAAO,EAAS,KAEhB,EAAQ,EAAK,IAAK,GAAS,CAC7B,IAAM,EAAc,EAAI,EAAA,KAAA,EAAA,+BAA4C,CAChE,KAAM,EAAK,QAAQ,SAAS,WAAW,qDAAsD,8BAA8B,WAAW,2CAA4C,iBAClL,OAAQ,EAAK,UAAU,sBAG3B,MAAO,CACH,MAAO,EAAK,MAAM,SAClB,KAAM,EAAK,KACX,cACA,QAAS,EAAU,EAAK,UACxB,OAAQ,EAAK,UAAU,OAAO,GAAG,QAIzC,MAAO,CACH,MAAO,0BACP,KAAM,EACN,KAAM"}