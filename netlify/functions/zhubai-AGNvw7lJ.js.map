{"version":3,"file":"zhubai-AGNvw7lJ.js","names":["route: Route","InvalidParameterError","got"],"sources":["../../lib/routes/zhubai/index.ts"],"sourcesContent":["import InvalidParameterError from '@/errors/types/invalid-parameter';\r\nimport { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { isValidHost } from '@/utils/valid-host';\r\n\r\nexport const route: Route = {\r\n    path: '/posts/:id',\r\n    categories: ['blog'],\r\n    example: '/zhubai/posts/via',\r\n    parameters: { id: '`id` 为竹白主页 url 中的三级域名，如 via.zhubai.love 的 `id` 为 `via`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '文章',\r\n    maintainers: ['naixy28'],\r\n    handler,\r\n    description: `::: tip\r\n  在路由末尾处加上 \\`?limit=限制获取数目\\` 来限制获取条目数量，默认值为\\`20\\`\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 20;\r\n    if (!isValidHost(id)) {\r\n        throw new InvalidParameterError('Invalid id');\r\n    }\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `https://${id}.zhubai.love/api/publications/${id}/posts?publication_id_type=token&limit=${limit}`,\r\n        headers: {\r\n            Referer: `https://${id}.zhubai.love/`,\r\n        },\r\n    });\r\n    const data = response.data.data;\r\n    const { name, description } = data[0].publication;\r\n\r\n    return {\r\n        title: name,\r\n        link: `https://${id}.zhubai.love/`,\r\n        description,\r\n        item: data.map((item) => ({\r\n            title: item.title,\r\n            pubDate: parseDate(item.created_at),\r\n            link: `https://${id}.zhubai.love/posts/${item.id}`,\r\n            author: name,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"wZAMA,MAAaA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,QACb,QAAS,oBACT,WAAY,CAAE,GAAI,0DAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa,+DAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GACjF,GAAI,CAAC,EAAY,GACb,MAAM,IAAIC,EAAsB,cAGpC,IAAM,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,WAAW,EAAG,gCAAgC,EAAG,yCAAyC,IAC/F,QAAS,CACL,QAAS,WAAW,EAAG,kBAGzB,EAAO,EAAS,KAAK,KACrB,CAAE,OAAM,eAAgB,EAAK,GAAG,YAEtC,MAAO,CACH,MAAO,EACP,KAAM,WAAW,EAAG,eACpB,cACA,KAAM,EAAK,IAAK,IAAU,CACtB,MAAO,EAAK,MACZ,QAAS,EAAU,EAAK,YACxB,KAAM,WAAW,EAAG,qBAAqB,EAAK,KAC9C,OAAQ"}