{"version":3,"file":"cpcaauto-DB63qVgY.js","names":["got","cache","route: Route"],"sources":["../../lib/routes/cpcaauto/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { type = 'news', id } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n\r\n    const rootUrl = 'http://cpcaauto.com';\r\n    const currentUrl = new URL(`news.php${type ? `?types=${type}${id ? `&anid=${id}` : ''}` : ''}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const language = 'zh';\r\n\r\n    let items = $('div.list_d ul li.q')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.find('a').text(),\r\n                pubDate: parseDate(item.find('span').text().trim()),\r\n                link: new URL(item.find('a').prop('href'), rootUrl).href,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const title = $$('div.tit').text();\r\n                const description = $$('div.text').html();\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = timezone(parseDate($$('div.view span').first().text().split(/：/).pop()), +8);\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.text').text(),\r\n                };\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('meta[property=\"og:image\"]').prop('content'), rootUrl).href;\r\n\r\n    return {\r\n        title: `${$('title').text()} - ${$('span.main_color')\r\n            .toArray()\r\n            .map((a) => $(a).text())\r\n            .join(' - ')}`,\r\n        description: $('META[name=\"description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: $('meta[name=\"keywords\"]').prop('content'),\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/news/:type?/:id?',\r\n    name: '文章',\r\n    url: 'cpcaauto.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/cpcaauto/news/news',\r\n    parameters: { type: '分类，默认为 news，可在对应分类页 URL 中找到', id: 'id，默认为 news，可在对应分类页 URL 中找到' },\r\n    description: `::: tip\r\n  若订阅 [行业新闻 > 国内乘用车](http://cpcaauto.com/news.php?types=news&anid=10)，网址为 \\`http://cpcaauto.com/news.php?types=news&anid=10\\`。截取 \\`types\\` 和 \\`anid\\` 的部分 \\`\\` 作为参数填入，此时路由为 [\\`/cpcaauto/news/news/10\\`](https://rsshub.app/cpcaauto/news/news/10)。\r\n:::\r\n\r\n#### [行业新闻](http://cpcaauto.com/news.php?types=news)\r\n\r\n| [国内乘用车](http://cpcaauto.com/news.php?types=news&anid=10) | [进口及国外乘用车](http://cpcaauto.com/news.php?types=news&anid=64) | [后市场](http://cpcaauto.com/news.php?types=news&anid=44) | [商用车](http://cpcaauto.com/news.php?types=news&anid=62) |\r\n| ----------------------------------------------------------------- | ----------------------------------------------------------------------- | ------------------------------------------------------------- | ------------------------------------------------------------- |\r\n| [news/10](https://rsshub.app/cpcaauto/news/news/10)              | [news/64](https://rsshub.app/cpcaauto/news/news/64)                    | [news/44](https://rsshub.app/cpcaauto/news/news/44)          | [news/62](https://rsshub.app/cpcaauto/news/news/62)          |\r\n\r\n#### [车市解读](http://cpcaauto.com/news.php?types=csjd)\r\n\r\n| [周度](http://cpcaauto.com/news.php?types=csjd&anid=128) | [月度](http://cpcaauto.com/news.php?types=csjd&anid=129) | [指数](http://cpcaauto.com/news.php?types=csjd&anid=130) | [预测](http://cpcaauto.com/news.php?types=csjd&anid=131) |\r\n| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |\r\n| [csjd/128](https://rsshub.app/cpcaauto/news/csjd/128)       | [csjd/129](https://rsshub.app/cpcaauto/news/csjd/129)       | [csjd/130](https://rsshub.app/cpcaauto/news/csjd/130)       | [csjd/131](https://rsshub.app/cpcaauto/news/csjd/131)       |\r\n\r\n#### [发布会报告](http://cpcaauto.com/news.php?types=bgzl)\r\n\r\n| [上海市场上牌数](http://cpcaauto.com/news.php?types=bgzl&anid=119) | [京城车市](http://cpcaauto.com/news.php?types=bgzl&anid=122) | [进口车市场分析](http://cpcaauto.com/news.php?types=bgzl&anid=120) | [二手车市场分析](http://cpcaauto.com/news.php?types=bgzl&anid=121) | [价格指数](http://cpcaauto.com/news.php?types=bgzl&anid=124) |\r\n| ---------------------------------------------------------------------- | ---------------------------------------------------------------- | ---------------------------------------------------------------------- | ---------------------------------------------------------------------- | ---------------------------------------------------------------- |\r\n| [bgzl/119](https://rsshub.app/cpcaauto/news/bgzl/119)                 | [bgzl/122](https://rsshub.app/cpcaauto/news/bgzl/122)           | [bgzl/120](https://rsshub.app/cpcaauto/news/bgzl/120)                 | [bgzl/121](https://rsshub.app/cpcaauto/news/bgzl/121)                 | [bgzl/124](https://rsshub.app/cpcaauto/news/bgzl/124)           |\r\n\r\n| [热点评述](http://cpcaauto.com/news.php?types=bgzl&anid=125) | [新能源月报](http://cpcaauto.com/news.php?types=bgzl&anid=126) | [商用车月报](http://cpcaauto.com/news.php?types=bgzl&anid=127) | [政策分析](http://cpcaauto.com/news.php?types=bgzl&anid=123) |\r\n| ---------------------------------------------------------------- | ------------------------------------------------------------------ | ------------------------------------------------------------------ | ---------------------------------------------------------------- |\r\n| [bgzl/125](https://rsshub.app/cpcaauto/news/bgzl/125)           | [bgzl/126](https://rsshub.app/cpcaauto/news/bgzl/126)             | [bgzl/127](https://rsshub.app/cpcaauto/news/bgzl/127)             | [bgzl/123](https://rsshub.app/cpcaauto/news/bgzl/123)           |\r\n\r\n#### [经济与政策](http://cpcaauto.com/news.php?types=meeting)\r\n\r\n| [一周经济](http://cpcaauto.com/news.php?types=meeting&anid=46) | [一周政策](http://cpcaauto.com/news.php?types=meeting&anid=47) |\r\n| ------------------------------------------------------------------ | ------------------------------------------------------------------ |\r\n| [meeting/46](https://rsshub.app/cpcaauto/news/meeting/46)         | [meeting/47](https://rsshub.app/cpcaauto/news/meeting/47)         |\r\n\r\n#### [乘联会论坛](http://cpcaauto.com/news.php?types=yjsy)\r\n\r\n| [论坛文章](http://cpcaauto.com/news.php?types=yjsy&anid=49) | [两会](http://cpcaauto.com/news.php?types=yjsy&anid=111) | [车展看点](http://cpcaauto.com/news.php?types=yjsy&anid=113) |\r\n| --------------------------------------------------------------- | ------------------------------------------------------------ | ---------------------------------------------------------------- |\r\n| [yjsy/49](https://rsshub.app/cpcaauto/news/yjsy/49)            | [yjsy/111](https://rsshub.app/cpcaauto/news/yjsy/111)       | [yjsy/113](https://rsshub.app/cpcaauto/news/yjsy/113)           |\r\n  `,\r\n    categories: ['new-media'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: (_, url) => {\r\n                url = new URL(url);\r\n                const types = url.searchParams.get('types');\r\n                const id = url.searchParams.get('id');\r\n\r\n                return types ? `/${types}${id ? `/${id}` : ''}` : '';\r\n            },\r\n        },\r\n        {\r\n            title: '行业新闻 - 国内乘用车',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/news/10',\r\n        },\r\n        {\r\n            title: '行业新闻 - 进口及国外乘用车',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/news/64',\r\n        },\r\n        {\r\n            title: '行业新闻 - 后市场',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/news/44',\r\n        },\r\n        {\r\n            title: '行业新闻 - 商用车',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/news/62',\r\n        },\r\n        {\r\n            title: '车市解读 - 周度',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/csjd/128',\r\n        },\r\n        {\r\n            title: '车市解读 - 月度',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/csjd/129',\r\n        },\r\n        {\r\n            title: '车市解读 - 指数',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/csjd/130',\r\n        },\r\n        {\r\n            title: '车市解读 - 预测',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/csjd/131',\r\n        },\r\n        {\r\n            title: '发布会报告 - 上海市场上牌数',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/bgzl/119',\r\n        },\r\n        {\r\n            title: '发布会报告 - 京城车市',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/bgzl/122',\r\n        },\r\n        {\r\n            title: '发布会报告 - 进口车市场分析',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/bgzl/120',\r\n        },\r\n        {\r\n            title: '发布会报告 - 二手车市场分析',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/bgzl/121',\r\n        },\r\n        {\r\n            title: '发布会报告 - 价格指数',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/bgzl/124',\r\n        },\r\n        {\r\n            title: '发布会报告 - 热点评述',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/bgzl/125',\r\n        },\r\n        {\r\n            title: '发布会报告 - 新能源月报',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/bgzl/126',\r\n        },\r\n        {\r\n            title: '发布会报告 - 商用车月报',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/bgzl/127',\r\n        },\r\n        {\r\n            title: '发布会报告 - 政策分析',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/bgzl/123',\r\n        },\r\n        {\r\n            title: '经济与政策 - 一周经济',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/meeting/46',\r\n        },\r\n        {\r\n            title: '经济与政策 - 一周政策',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/meeting/47',\r\n        },\r\n        {\r\n            title: '乘联会论坛 - 论坛文章',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/yjsy/49',\r\n        },\r\n        {\r\n            title: '乘联会论坛 - 两会',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/yjsy/111',\r\n        },\r\n        {\r\n            title: '乘联会论坛 - 车展看点',\r\n            source: ['cpcaauto.com/news.php'],\r\n            target: '/news/yjsy/113',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}