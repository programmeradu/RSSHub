{"version":3,"file":"worldjournal-a0ak6yg2.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/worldjournal/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst baseUrl = 'https://www.worldjournal.com';\r\n\r\nexport const route: Route = {\r\n    path: '/:path{.+}?',\r\n    radar: [\r\n        {\r\n            source: ['worldjournal.com/wj/*path'],\r\n            target: '/:path',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n    url: 'worldjournal.com/wj/*path',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { path = 'cate/breaking' } = ctx.req.param();\r\n    const { data: response } = await got(`${baseUrl}/wj/${path}`);\r\n\r\n    const $ = load(response);\r\n\r\n    const list = $('.subcate-list__wrapper .subcate-list__link__text')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const url = item.find('a').first().attr('href');\r\n            return {\r\n                title: item.find('h3').text(),\r\n                description: item.find('p').html(),\r\n                link: url.includes('?from=') ? url.split('?from=')[0] : url,\r\n                pubDate: timezone(parseDate(item.find('.subcate-list__time--roc').text(), 'YYYY-MM-DD HH:mm'), 8),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n\r\n                $('[id^=div-gpt-ad], [class^=udn-ads-], .keywords, .next-page, .udn-ads, .article-content__ads--bd').remove();\r\n\r\n                $('img').each((_, img) => {\r\n                    if (img.attribs['data-src']) {\r\n                        const url = new URL(img.attribs['data-src']);\r\n                        if (url.pathname === '/gw/photo.php') {\r\n                            img.attribs.src = url.searchParams.get('u');\r\n                            delete img.attribs['data-src'];\r\n                        }\r\n                    }\r\n                });\r\n\r\n                item.description = $('.article-content__paragraph').html();\r\n                item.categories = $('meta[name=news_keywords]').attr('content')?.split(',');\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        description: $('head meta[name=\"description\"]').attr('content'),\r\n        image: 'https://www.worldjournal.com/static/img/icons/icon-144x144.png',\r\n        link: `${baseUrl}/wj/${path}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAM,EAAU,+BAEHA,EAAe,CACxB,KAAM,cACN,MAAO,CACH,CACI,OAAQ,CAAC,6BACT,OAAQ,WAGhB,KAAM,UACN,YAAa,GACb,UACA,IAAK,6BAGT,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAO,iBAAoB,EAAI,IAAI,QACrC,CAAE,KAAM,GAAa,MAAMC,EAAI,GAAG,EAAQ,MAAM,KAEhD,EAAI,EAAK,GAET,EAAO,EAAE,oDACV,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAM,EAAK,KAAK,KAAK,QAAQ,KAAK,QACxC,MAAO,CACH,MAAO,EAAK,KAAK,MAAM,OACvB,YAAa,EAAK,KAAK,KAAK,OAC5B,KAAM,EAAI,SAAS,UAAY,EAAI,MAAM,UAAU,GAAK,EACxD,QAAS,EAAS,EAAU,EAAK,KAAK,4BAA4B,OAAQ,oBAAqB,MAIrG,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GAiBf,OAfA,EAAE,mGAAmG,SAErG,EAAE,OAAO,MAAM,EAAG,IAAQ,CACtB,GAAI,EAAI,QAAQ,YAAa,CACzB,IAAM,EAAM,IAAI,IAAI,EAAI,QAAQ,aAC5B,EAAI,WAAa,kBACjB,EAAI,QAAQ,IAAM,EAAI,aAAa,IAAI,KACvC,OAAO,EAAI,QAAQ,gBAK/B,EAAK,YAAcC,EAAE,+BAA+B,OACpD,EAAK,WAAaA,EAAE,4BAA4B,KAAK,YAAY,MAAM,KAEhE,MAKnB,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,YAAa,EAAE,iCAAiC,KAAK,WACrD,MAAO,iEACP,KAAM,GAAG,EAAQ,MAAM,IACvB,KAAM"}