{"version":3,"file":"nsfc-4sjA6FYO.js","names":["route: Route","shortcuts","got","cache"],"sources":["../../lib/routes/gov/nsfc/shortcuts.ts","../../lib/routes/gov/nsfc/index.ts"],"sourcesContent":["export default {\r\n    // 基金要闻 - 基金要闻 https://www.nsfc.gov.cn/publish/portal0/tab440/\r\n    jjyw: '/publish/portal0/tab440/',\r\n\r\n    // 基金要闻 - 通知公告 https://www.nsfc.gov.cn/publish/portal0/tab442/\r\n    tzgg: '/publish/portal0/tab442/',\r\n\r\n    // 基金要闻 - 部门动态 https://www.nsfc.gov.cn/publish/portal0/tab445/\r\n    bmdt: '/publish/portal0/tab445/',\r\n\r\n    // 基金要闻 - 科普快讯 https://www.nsfc.gov.cn/publish/portal0/tab446/\r\n    kpkx: '/publish/portal0/tab446/',\r\n\r\n    // 基金要闻 - 资助成果 https://www.nsfc.gov.cn/publish/portal0/tab448/\r\n    zzcg: '/publish/portal0/tab448/',\r\n\r\n    // 政策法规 - 国家自然科学基金条例 https://www.nsfc.gov.cn/publish/portal0/tab471/\r\n    'zcfg-jjtl': '/publish/portal0/tab471/',\r\n\r\n    // 政策法规 - 国家自然科学基金发展规划 https://www.nsfc.gov.cn/publish/portal0/tab473/\r\n    'zcfg-fzgh': '/publish/portal0/tab473/',\r\n\r\n    // 政策法规 - 国家自然科学基金规章制度 https://www.nsfc.gov.cn/publish/portal0/tab475/\r\n    'zcfg-gzzd': '/publish/portal0/tab475/',\r\n\r\n    // 政策法规 - 国家科学技术相关法律法规 https://www.nsfc.gov.cn/publish/portal0/tab609/\r\n    'zcfg-flfg': '/publish/portal0/tab609/',\r\n\r\n    // 管理科学部 - 工作动态 https://www.nsfc.gov.cn/publish/portal0/tab1210/\r\n    'glkxb-gzdt': '/publish/portal0/tab1210/',\r\n\r\n    // 管理科学部 - 通知公告 https://www.nsfc.gov.cn/publish/portal0/tab1212/\r\n    'glkxb-tzgg': '/publish/portal0/tab1212/',\r\n\r\n    // 管理科学部 - 资助成果 https://www.nsfc.gov.cn/publish/portal0/tab1213/\r\n    'glkxb-zzcg': '/publish/portal0/tab1213/',\r\n\r\n    // 国际合作局 - 项目指南 https://www.nsfc.gov.cn/publish/portal0/tab1356/\r\n    'gjhzj-xmzn': '/publish/portal0/tab1356/',\r\n\r\n    // 国际合作局 - 初审结果 https://www.nsfc.gov.cn/publish/portal0/tab1361/\r\n    'gjhzj-csjg': '/publish/portal0/tab1361/',\r\n\r\n    // 国际合作局 - 批准通知 https://www.nsfc.gov.cn/publish/portal0/tab1362/\r\n    'gjhzj-pztz': '/publish/portal0/tab1362/',\r\n\r\n    // 国际合作局 - 进程简表 https://www.nsfc.gov.cn/publish/portal0/tab1366/\r\n    'gjhzj-jcjb': '/publish/portal0/tab1366/',\r\n\r\n    // 国际合作局 - 信息公开 https://www.nsfc.gov.cn/publish/portal0/tab1386/\r\n    'gjhzj-xxgk': '/publish/portal0/tab1386/',\r\n};\r\n","import { Route } from '@/types';\r\nimport { getSubPath } from '@/utils/common-utils';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport shortcuts from './shortcuts';\r\n\r\nexport const route: Route = {\r\n    path: '/nsfc/*',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let thePath = getSubPath(ctx).replace(/^\\/nsfc/, '');\r\n\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 30;\r\n\r\n    const shortcutMatches = thePath.match(/(\\/news)?\\/([\\w-]+)/);\r\n\r\n    if (shortcutMatches) {\r\n        const shortcut = shortcutMatches[2];\r\n        if (Object.hasOwn(shortcuts, shortcut)) {\r\n            thePath = shortcuts[shortcut];\r\n        }\r\n    }\r\n\r\n    const rootUrl = 'https://www.nsfc.gov.cn';\r\n    const currentUrl = new URL((/\\/more$/.test(thePath) ? `${thePath}.htm` : thePath) || 'publish/portal0/tab442/', rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl, {\r\n        https: {\r\n            rejectUnauthorized: false,\r\n        },\r\n    });\r\n\r\n    const $ = load(response);\r\n\r\n    let items = $('span.fl a, ul.dp_lia li a')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.prop('title') ?? item.text(),\r\n                link: new URL(item.prop('href'), rootUrl).href,\r\n                guid: `nsfc-${item.prop('id')}`,\r\n                pubDate: parseDate(item.next().text().replace(/\\[]/g, '', ['YYYY-MM-DD', 'YY-MM-DD'])),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link, {\r\n                    https: {\r\n                        rejectUnauthorized: false,\r\n                    },\r\n                });\r\n\r\n                const content = load(detailResponse);\r\n\r\n                item.title = content('div.title_xilan').text();\r\n                item.description = content('#zoom').html();\r\n                item.author = content('meta[name=\"docauthor\"]').prop('content');\r\n                item.category = [content('meta[name=\"channel\"]').prop('content'), content('meta[name=\"docsource\"]').prop('content')];\r\n                item.pubDate = parseDate(\r\n                    content('div.line_xilan')\r\n                        .text()\r\n                        .match(/日期 (\\d{4}-\\d{2}-\\d{2})/)[1]\r\n                );\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        item: items,\r\n        title: `国家自然科学基金委员会 - ${$('#ess_essBREADCRUMB_lblBreadCrumb a.break')\r\n            .toArray()\r\n            .slice(1)\r\n            .map((a) => $(a).text())\r\n            .join(' - ')}`,\r\n        link: currentUrl,\r\n        description: $('meta[name=\"DESCRIPTION\"]').prop('content'),\r\n        language: 'zh-cn',\r\n        subtitle: $('meta[name=\"KEYWORDS\"]').prop('content'),\r\n        author: $('meta[name=\"AUTHOR\"]').prop('content'),\r\n    };\r\n}\r\n"],"mappings":"gaAAA,IAAA,EAAe,CAEX,KAAM,2BAGN,KAAM,2BAGN,KAAM,2BAGN,KAAM,2BAGN,KAAM,2BAGN,YAAa,2BAGb,YAAa,2BAGb,YAAa,2BAGb,YAAa,2BAGb,aAAc,4BAGd,aAAc,4BAGd,aAAc,4BAGd,aAAc,4BAGd,aAAc,4BAGd,aAAc,4BAGd,aAAc,4BAGd,aAAc,6BCzClB,MAAaA,EAAe,CACxB,KAAM,UACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAI,EAAU,EAAW,GAAK,QAAQ,UAAW,IAE3C,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAkB,EAAQ,MAAM,uBAEtC,GAAI,EAAiB,CACjB,IAAM,EAAW,EAAgB,GAC7B,OAAO,OAAOC,EAAW,KACzB,EAAUA,EAAU,IAI5B,IAAM,EAAU,0BACV,EAAa,IAAI,KAAK,UAAU,KAAK,GAAW,GAAG,EAAQ,MAAQ,IAAY,0BAA2B,GAAS,KAEnH,CAAE,KAAM,GAAa,MAAMC,EAAI,EAAY,CAC7C,MAAO,CACH,mBAAoB,MAItB,EAAI,EAAK,GAEX,EAAQ,EAAE,6BACT,MAAM,EAAG,GACT,UACA,IAAK,IACF,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,KAAK,UAAY,EAAK,OAClC,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAS,KAC1C,KAAM,QAAQ,EAAK,KAAK,QACxB,QAAS,EAAU,EAAK,OAAO,OAAO,QAAQ,OAAQ,GAAI,CAAC,aAAc,iBA8BrF,MA1BA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAMD,EAAI,EAAK,KAAM,CAClD,MAAO,CACH,mBAAoB,MAItB,EAAU,EAAK,GAYrB,MAVA,GAAK,MAAQ,EAAQ,mBAAmB,OACxC,EAAK,YAAc,EAAQ,SAAS,OACpC,EAAK,OAAS,EAAQ,0BAA0B,KAAK,WACrD,EAAK,SAAW,CAAC,EAAQ,wBAAwB,KAAK,WAAY,EAAQ,0BAA0B,KAAK,YACzG,EAAK,QAAU,EACX,EAAQ,kBACH,OACA,MAAM,0BAA0B,IAGlC,MAKZ,CACH,KAAM,EACN,MAAO,iBAAiB,EAAE,4CACrB,UACA,MAAM,GACN,IAAK,GAAM,EAAE,GAAG,QAChB,KAAK,SACV,KAAM,EACN,YAAa,EAAE,4BAA4B,KAAK,WAChD,SAAU,QACV,SAAU,EAAE,yBAAyB,KAAK,WAC1C,OAAQ,EAAE,uBAAuB,KAAK"}