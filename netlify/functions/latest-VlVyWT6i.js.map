{"version":3,"file":"latest-VlVyWT6i.js","names":[],"sources":["../../lib/routes/tribalfootball/latest.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst rssUrl = 'https://www.tribalfootball.com/rss/mediafed/general/rss.xml';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    radar: [\r\n        {\r\n            source: ['tribalfootball.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['Rongronggg9'],\r\n    handler,\r\n    url: 'tribalfootball.com/',\r\n};\r\n\r\nasync function handler() {\r\n    const rss = await got(rssUrl);\r\n    const $ = load(rss.data, { xmlMode: true });\r\n    const items = $('rss > channel > item')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            let link = $item.find('link').text();\r\n            link = new URL(link);\r\n            link.search = '';\r\n            link = link.href;\r\n            return {\r\n                title: $item.find('title').text(),\r\n                description: $item.find('description').text(),\r\n                link,\r\n                guid: $item.find('guid').text(),\r\n                pubDate: parseDate($item.find('pubDate').text()),\r\n                author: $item.find(String.raw`dc\\:creator`).text(),\r\n                _header_image: $item.find('enclosure').attr('url'),\r\n            };\r\n        });\r\n\r\n    await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await got(item.link);\r\n                const $ = load(response.data);\r\n\r\n                const title = $('head > title').text().replace(' - Tribal Football', '');\r\n\r\n                let desc = $('.articleBody');\r\n                desc.find('.ad').remove();\r\n                // <p><br><i>AD</i><span></span></p>\r\n                const ad = desc.find('p > br:first-child').next('i');\r\n                const adNextSpan = ad.next('span');\r\n                if (adNextSpan.length && !adNextSpan.text() && !adNextSpan.next().length) {\r\n                    ad.parent().remove();\r\n                }\r\n                desc = desc.html();\r\n                desc = art(path.join(__dirname, 'templates/plus_header.art'), {\r\n                    desc,\r\n                    header_image: item._header_image,\r\n                });\r\n\r\n                item.title = title || item.title;\r\n                item.description = desc || item.description;\r\n                delete item._header_image;\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: 'Tribal Football - Latest',\r\n        description: 'Tribal Football - Football News, Soccer News, Transfers & Rumours',\r\n        link: 'https://www.tribalfootball.com/articles',\r\n        image: 'https://www.tribalfootball.com/images/tribal-logo-rss.png',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wdASA,MAEa,EAAe,CACxB,KAAM,IACN,MAAO,CACH,CACI,OAAQ,CAAC,uBACT,OAAQ,KAGhB,KAAM,UACN,YAAa,CAAC,eACd,UACA,IAAK,uBAGT,eAAe,GAAU,CACrB,IAAM,EAAM,MAAM,EAAI,+DAChB,EAAI,EAAK,EAAI,KAAM,CAAE,QAAS,KAC9B,EAAQ,EAAE,wBACX,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GACZ,EAAO,EAAM,KAAK,QAAQ,OAI9B,MAHA,GAAO,IAAI,IAAI,GACf,EAAK,OAAS,GACd,EAAO,EAAK,KACL,CACH,MAAO,EAAM,KAAK,SAAS,OAC3B,YAAa,EAAM,KAAK,eAAe,OACvC,OACA,KAAM,EAAM,KAAK,QAAQ,OACzB,QAAS,EAAU,EAAM,KAAK,WAAW,QACzC,OAAQ,EAAM,KAAK,OAAO,GAAG,eAAe,OAC5C,cAAe,EAAM,KAAK,aAAa,KAAK,UAkCxD,OA9BA,MAAM,QAAQ,IACV,EAAM,IAAK,GACP,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAW,MAAM,EAAI,EAAK,MAC1B,EAAI,EAAK,EAAS,MAElB,EAAQ,EAAE,gBAAgB,OAAO,QAAQ,qBAAsB,IAEjE,EAAO,EAAE,gBACb,EAAK,KAAK,OAAO,SAEjB,IAAM,EAAK,EAAK,KAAK,sBAAsB,KAAK,KAC1C,EAAa,EAAG,KAAK,QAa3B,OAZI,EAAW,QAAU,CAAC,EAAW,QAAU,CAAC,EAAW,OAAO,QAC9D,EAAG,SAAS,SAEhB,EAAO,EAAK,OACZ,EAAO,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAC1D,OACA,aAAc,EAAK,gBAGvB,EAAK,MAAQ,GAAS,EAAK,MAC3B,EAAK,YAAc,GAAQ,EAAK,YAChC,OAAO,EAAK,cACL,MAKZ,CACH,MAAO,2BACP,YAAa,oEACb,KAAM,0CACN,MAAO,4DACP,KAAM"}