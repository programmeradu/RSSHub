{"version":3,"file":"shxyj-hpQVTqz7.js","names":["route: Route","response","got","$"],"sources":["../../lib/routes/ajcass/shxyj.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/shxyj/:year?/:issue?',\r\n    categories: ['journal'],\r\n    example: '/ajcass/shxyj/2024/1',\r\n    parameters: { year: 'Year of the issue, `null` for the lastest', issue: 'Issue number, `null` for the lastest' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '社会学研究',\r\n    maintainers: ['CNYoki'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let { year, issue } = ctx.req.param();\r\n\r\n    if (!year) {\r\n        const response = await got('https://shxyj.ajcass.com/');\r\n        const $ = load(response.body);\r\n        const latestIssueText = $('p.hod.pop').first().text();\r\n\r\n        const match = latestIssueText.match(/(\\d{4}) Vol\\.(\\d+):/);\r\n        if (match) {\r\n            year = match[1];\r\n            issue = match[2];\r\n        } else {\r\n            throw new Error('无法获取最新的 year 和 issue');\r\n        }\r\n    }\r\n\r\n    const url = `https://shxyj.ajcass.com/Magazine/?Year=${year}&Issue=${issue}`;\r\n    const response = await got(url);\r\n    const $ = load(response.body);\r\n\r\n    const items = $('#tab tr')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            const articleTitle = $item.find('a').first().text().trim();\r\n            const articleLink = $item.find('a').first().attr('href');\r\n            const summary = $item.find('li').eq(1).text().replace('[摘要]', '').trim();\r\n            const authors = $item.find('li').eq(2).text().replace('作者：', '').trim();\r\n            const pubDate = parseDate(`${year}-${Number.parseInt(issue) * 2}`);\r\n\r\n            if (articleTitle && articleLink) {\r\n                return {\r\n                    title: articleTitle,\r\n                    link: `https://shxyj.ajcass.com${articleLink}`,\r\n                    description: summary,\r\n                    author: authors,\r\n                    pubDate,\r\n                };\r\n            }\r\n            return null;\r\n        })\r\n        .filter((item) => item !== null);\r\n\r\n    return {\r\n        title: `社会学研究 ${year}年第${issue}期`,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"oTAKA,MAAaA,EAAe,CACxB,KAAM,wBACN,WAAY,CAAC,WACb,QAAS,uBACT,WAAY,CAAE,KAAM,4CAA6C,MAAO,wCACxE,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,QACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAI,CAAE,OAAM,SAAU,EAAI,IAAI,QAE9B,GAAI,CAAC,EAAM,CACP,IAAMC,EAAW,MAAMC,EAAI,6BACrBC,EAAI,EAAKF,EAAS,MAClB,EAAkBE,EAAE,aAAa,QAAQ,OAEzC,EAAQ,EAAgB,MAAM,uBACpC,GAAI,EACA,EAAO,EAAM,GACb,EAAQ,EAAM,QAEd,MAAU,MAAM,wBAIxB,IAAM,EAAM,2CAA2C,EAAK,SAAS,IAC/D,EAAW,MAAMD,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAQ,EAAE,WACX,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GACV,EAAe,EAAM,KAAK,KAAK,QAAQ,OAAO,OAC9C,EAAc,EAAM,KAAK,KAAK,QAAQ,KAAK,QAC3C,EAAU,EAAM,KAAK,MAAM,GAAG,GAAG,OAAO,QAAQ,OAAQ,IAAI,OAC5D,EAAU,EAAM,KAAK,MAAM,GAAG,GAAG,OAAO,QAAQ,MAAO,IAAI,OAC3D,EAAU,EAAU,GAAG,EAAK,GAAG,OAAO,SAAS,GAAS,KAW9D,OATI,GAAgB,EACT,CACH,MAAO,EACP,KAAM,2BAA2B,IACjC,YAAa,EACb,OAAQ,EACR,WAGD,OAEV,OAAQ,GAAS,IAAS,MAE/B,MAAO,CACH,MAAO,SAAS,EAAK,IAAI,EAAM,GAC/B,KAAM,EACN,KAAM"}