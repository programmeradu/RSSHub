import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import o from"node:path";import{load as s}from"cheerio";t();const c={path:`/:what?/:id?/:needTorrents?/:needImages?`,name:`Unknown`,maintainers:[],features:{nsfw:!0},handler:l};async function l(t){let c=t.req.param(`id`)??``,l=t.req.param(`what`)??``,u=/t|y/i.test(t.req.param(`needTorrents`)??`true`),d=/t|y/i.test(t.req.param(`needImages`)??`true`),f=`https://e-hentai.org/${c?l===`search`?`?${c}`:l===`category`?c:`${l}/${c}`:l}`,p=await a({method:`get`,url:f}),m=s(p.data);m(`.itd`).parent().remove();let h=m(`table.gltc tbody tr`).slice(1,t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`))+1:d?16:26).toArray().map(e=>(e=m(e),{title:e.find(`div.glink`).text(),author:e.find(`td.glhide div a`).text(),link:e.find(`td.glname a`).attr(`href`),pubDate:i(e.find(`div.ir`).prev().text()),category:e.find(`div.gt`).toArray().map(e=>m(e).attr(`title`).replace(/^:/,``)),description:d?``:`<img src="${e.find(`div.glthumb div img`).attr(`data-src`)??e.find(`div.glthumb div img`).attr(`src`)}">`,enclosure_url:u&&e.find(`div.gldown a img[title="Show torrents"]`).length>0?e.find(`.gldown a`).attr(`href`):void 0}));return h=await Promise.all(h.map(async t=>{if(t.enclosure_url){let e=``,r=await n.get(t.enclosure_url);if(!r){let i=await a({method:`get`,url:t.enclosure_url}),o=s(i.data);o(`h1, input[name="torrent_info"]`).remove(),e=o(`form`).parent().html(),r=o(`table tbody tr td a`).toArray().map(e=>(e=o(e),{link:e.attr(`href`),title:e.text()})),n.set(t.enclosure_url,r)}t.description+=e,t.enclosure_url=r[0].link,t.enclosure_type=`application/x-bittorrent`}if(d){let i=await n.get(t.link);if(!i){let e=await a({method:`get`,url:t.link}),r=s(e.data);i=await Promise.all(r(`.gdtm a`).toArray().map(e=>n.tryGet(r(e).attr(`href`),async()=>{let t=await a({method:`get`,url:r(e).attr(`href`)}),n=s(t.data);return n(`#img`).attr(`src`)}))),n.set(t.link,i)}t.description+=r(o.join(e,`templates/images-c6dc562b.art`),{images:i})}return t})),{title:`${c||l||`Front Page`} - E-Hentai Galleries`,link:f,item:h}}export{c as route};
//# sourceMappingURL=e-hentai-B8PONecN.js.map