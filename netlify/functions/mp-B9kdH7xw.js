import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import{ofetch_default as a}from"./ofetch-Bzt0BXUH.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import s from"node:path";import*as c from"cheerio";import l from"crypto-js";t();const u={path:`/mp/:xpt`,categories:[`new-media`],example:`/sohu/mp/c29odXptdGhnbjZ3NEBzb2h1LmNvbQ==`,parameters:{xpt:`搜狐号 xpt ，可在URL中找到或搜狐号 ID`},radar:[{source:[`mp.sohu.com/profile`],target:(e,t)=>`/sohu/mp/${new URL(t).searchParams.get(`xpt`)}`}],name:`最新`,maintainers:[`HenryQW`],handler:h,description:"搜狐号 ID 可以通过以下方式获取：\n  1.  通过浏览器搜索相关搜狐号 `果壳 site: mp.sohu.com`。\n  2.  通过浏览器控制台执行 `window.globalConst.mkeyConst_mkey`，返回的即为搜狐号 ID。"};function d(e=32){let t=``;for(let n=0;n<e;n++)t+=`ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678`.charAt(Math.floor(Math.random()*48));return t}function f(e){let t=l.enc.Utf8.parse(`www.sohu.com6666`),n=l.AES.decrypt(e,t,{mode:l.mode.ECB,padding:l.pad.Pkcs7});return n.toString(l.enc.Utf8)}function p(){let e=Date.now(),t=`t`+e;return`v1`+e+l.HmacSHA1(t,`439642a904ef43d092d45509cdc4391c`).toString()}function m(t){return n.tryGet(t.link,async()=>{let n=await a(t.link),l=c.load(n);if(l(`.original-title, .lookall-box`).remove(),t.author=t.author||l(`span[data-role="original-link"] a`).text(),t.pubDate=o(i(l(`meta[itemprop="dateUpdate"]`).attr(`content`)),8),/window\.sohu_mp\.article_video/.test(l(`script`).text())){let n=l(`script`).text().match(/\s*url: "(.*?)",/)?.[1];t.description=r(s.join(e,`templates/video-932ff8ed.art`),{poster:l(`script`).text().match(/cover: "(.*?)",/)?.[1],src:n,type:n?.split(`.`).pop()?.toLowerCase()})}else{let e=l(`#mp-editor`);e.find(`#backsohucom, p[data-role="editor-name"]`).each((e,t)=>{l(t).remove()}),e.find(`img`).each((e,t)=>{let n=l(t);n.attr(`data-src`)&&!n.attr(`src`)&&(n.attr(`src`,f(n.attr(`data-src`))),n.removeAttr(`data-src`))}),t.description=e.html()}return t})}async function h(e){let t=e.req.param(`xpt`),n=/^\d+$/.test(t);if(n)return g(e);let r=await a.raw(`https://mp.sohu.com/profile`,{query:{xpt:t}}),i=r.headers?.getSetCookie().find(e=>e.startsWith(`SUV`))?.split(`;`)[0],o=c.load(r._data),s=JSON.parse(o(`script:contains("CBDRenderConst")`).text().trim().match(/CBDRenderConst\s=\s(.*)/)?.[1]||`{}`),l=JSON.parse(o(`script:contains("contentData")`).toArray().map(e=>o(e).text().match(/contentData = (.*)/)?.[1]).sort((e,t)=>t.length-e.length)[0]||`{}`),u=JSON.parse(o(`script:contains("column_2_text")`).text().match(/({.*})/)?.[1]),f=u[Object.keys(u).find(e=>e.startsWith(`FeedSlideloadAuthor`))],h=u[Object.keys(u).find(e=>e.startsWith(`BriefIntroductionCard`))].param.data.list[0],_=JSON.parse(o(`script:contains("globalConst")`).text().match(/globalConst\s=\s(.*)/)?.[1]||`{}`),v=JSON.parse(o(`script:contains("originalRequest")`).text().match(/originalRequest\s=\s(.*)/)?.[1]||`{}`),y=await a(`https://odin.sohu.com/odin/api/blockdata`,{method:`POST`,headers:{Cookie:Object.entries({SUV:i,itssohu:`true`,reqtype:`pc`,t:Date.now()}).map(([e,t])=>`${e}=${t}`).join(`; `)},body:{pvId:s.COMMONCONFIG.pvId||`${Date.now()}_${d(7)}`,pageId:`${Date.now()}_${`1612268936507kas0gk`?.slice(0,-5)}_${d(3)}`,mainContent:{productType:l.businessType||`13`,productId:l.id||`324`,secureScore:l.secureScore||`5`,categoryId:l.categoryId||`47`,adTags:l.adTags||`11111111`,authorId:l.account.id||121135924},resourceList:[{tplCompKey:f.param.data2.reqParam.tplCompKey||`FeedSlideloadAuthor_2_0_pc_1655965929143_data2`,isServerRender:f.param.data2.reqParam.isServerRender||!1,isSingleAd:f.param.data2.reqParam.isSingleAd||!1,configSource:f.param.data2.reqParam.configSource||`mp`,content:{productId:f.param.data2.reqParam.content.productId||`325`,productType:f.param.data2.reqParam.content.productType||`13`,size:20,pro:f.param.pro||`0,1,3,4,5`,feedType:f.param.feedType||`XTOPIC_SYNTHETICAL`,view:`operateFeedMode`,innerTag:f.param.data2.reqParam.content.innerTag||`work`,spm:f.param.data2.reqParam.content.spm||`smpc.channel_248.block3_308_hHsK47_2_fd`,page:1,requestId:`${Date.now()}${d(7)}_${l.id}`},adInfo:{},context:{mkey:_.mkeyConst_mkey}}],asId:p()}}),b=y.data[f.param.data2.reqParam.tplCompKey].list.map(e=>({title:e.title,description:e.brief,link:`https://www.sohu.com/a/${e.id}_${_.mkeyConst_mkey}`})),x=await Promise.all(b.map(e=>m(e)));return{title:`搜狐号 - ${_.title}`,description:h.column_9_text,link:v.url,image:`https:${h.column_2_image}`,item:x}}async function g(e){let t=e.req.param(`xpt`),n=`https://v2.sohu.com/author-page-api/author-articles/pc/${t}`,r=await a(n),o=r.data.pcArticleVOS.map(e=>({title:e.title,link:e.link.startsWith(`http`)?e.link:`https://${e.link}`,pubDate:i(e.publicTime)})),s=await Promise.all(o.map(e=>m(e)));return{title:`搜狐号 - ${t}`,item:s}}export{u as route};
//# sourceMappingURL=mp-B9kdH7xw.js.map