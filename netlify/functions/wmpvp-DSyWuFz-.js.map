{"version":3,"file":"wmpvp-DSyWuFz-.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/wmpvp/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:type',\r\n    categories: ['game'],\r\n    example: '/wmpvp/news/1',\r\n    parameters: { type: '资讯分类，见下表' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '资讯列表',\r\n    maintainers: ['tssujt'],\r\n    handler,\r\n    description: `| DOTA2 | CS2 |\r\n| ----- | --- |\r\n| 1     | 2   |`,\r\n};\r\n\r\nconst TYPE_MAP = {\r\n    '1': 'DOTA2',\r\n    '2': 'CS2',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type');\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `https://appengine.wmpvp.com/steamcn/community/homepage/getHomeInformation?gameTypeStr=${type}&pageNum=1&pageSize=20`,\r\n    });\r\n    const data = response.data.result.filter((item) => item.news !== undefined);\r\n\r\n    const items = await Promise.all(\r\n        data.map((item) => {\r\n            const entity = item.news;\r\n            const newsId = entity.newsId;\r\n            const newsLink = `https://news.wmpvp.com/news.html?id=${newsId}&gameTypeStr=${type}`;\r\n\r\n            return cache.tryGet(newsLink, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: `https://appactivity.wmpvp.com/steamcn/app/news/getAppNewsById?gameType=${type}&newsId=${newsId}`,\r\n                });\r\n                return {\r\n                    title: entity.title,\r\n                    pubDate: parseDate(entity.publishTime),\r\n                    link: newsLink,\r\n                    guid: newsLink,\r\n                    author: entity.author,\r\n                    description: detailResponse.data.result.news.content,\r\n                };\r\n            });\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: `完美世界电竞 - ${TYPE_MAP[type]} 资讯`,\r\n        link: `https://news.wmpvp.com/`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"yUAKA,MAAaA,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,QACb,QAAS,gBACT,WAAY,CAAE,KAAM,YACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,UACd,UACA,YAAa;;kBAKX,EAAW,CACb,EAAK,QACL,EAAK,OAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QAErB,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,yFAAyF,EAAK,0BAEjG,EAAO,EAAS,KAAK,OAAO,OAAQ,GAAS,EAAK,OAAS,IAAA,IAE3D,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GAAS,CACf,IAAM,EAAS,EAAK,KACd,EAAS,EAAO,OAChB,EAAW,uCAAuC,EAAO,eAAe,IAE9E,OAAOC,EAAM,OAAO,EAAU,SAAY,CACtC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,0EAA0E,EAAK,UAAU,MAElG,MAAO,CACH,MAAO,EAAO,MACd,QAAS,EAAU,EAAO,aAC1B,KAAM,EACN,KAAM,EACN,OAAQ,EAAO,OACf,YAAa,EAAe,KAAK,OAAO,KAAK,cAM7D,MAAO,CACH,MAAO,YAAY,EAAS,GAAM,KAClC,KAAM,0BACN,KAAM"}