import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import{ViewType as s}from"./types-A5bA50Mg.js";import c from"node:path";import{load as l}from"cheerio";import u from"iconv-lite";t();const d={path:`/book/:id?`,categories:[`reading`],view:s.Notifications,example:`/jjwxc/book/7013024`,parameters:{id:`作品 id，可在对应作品页中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`作品章节`,maintainers:[`nczitzk`],handler:f};async function f(t){let s=t.req.param(`id`),d=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):100,f=`https://www.jjwxc.net`,p=new URL(`onebook.php?novelid=${s}`,f).href,{data:m}=await a(p,{responseType:`buffer`}),h=l(u.decode(m,`gbk`)),g=h(`meta[name="Author"]`).prop(`content`),_=h(`meta[name="Keywords"]`).prop(`content`).split(/,/);_.pop();let v=_.pop(),y=h(`tr[itemprop="chapter"]`).toArray().map(t=>{t=h(t);let n=t.find(`td`).first().text().trim(),a=t.find(`span[itemprop="headline"]`).text().trim(),l=t.find(`td`).eq(2).text().trim(),u=new URL(`onebook.php?novelid=${s}&chapterid=${n}`,f).href,d=t.find(`td[itemprop="wordCount"]`).text(),p=t.find(`td.chapterclick`).text(),m=t.find(`td`).last().text().trim(),_=t.find(`span[itemprop="headline"] font`).last().text()===`[VIP]`,y=t.find(`td`).eq(1).last().text().trim()===`[锁]`;return{title:`${a} ${l}`,link:u,description:r(c.join(e,`templates/book-692b3788.art`),{chapterId:n,chapterName:a,chapterIntro:l,chapterUrl:u,chapterWords:d,chapterClicks:p,chapterUpdatedTime:m}),author:g,category:[_?`VIP`:void 0,...v?.split(/\s/)??[]].filter(Boolean),guid:`jjwxc-${s}#${n}`,pubDate:o(i(m),8),isVip:_,isLock:y}});y.reverse(),y=await Promise.all(y.slice(0,d).map(t=>t.isLock?Promise.resolve(t):n.tryGet(t.link,async()=>{if(!t.isVip){let{data:n}=await a(t.link,{responseType:`buffer`}),i=l(u.decode(n,`gbk`));i(`span.favorite_novel`).parent().remove(),t.description+=r(c.join(e,`templates/book-692b3788.art`),{description:i(`div.novelbody`).html()})}return delete t.isVip,t})));let b=h(`div.logo a img`),x=`https:${b.prop(`src`)}`,S=new URL(`favicon.ico`,f).href;return{item:y,title:`${b.prop(`alt`).replace(/logo/,``)} | ${g}${_[0]}`,link:p,description:h(`span[itemprop="description"]`).text(),language:`zh`,image:x,icon:S,logo:S,subtitle:h(`meta[name="Description"]`).prop(`content`),author:h(`meta[name="Author"]`).prop(`content`)}}export{d as route};
//# sourceMappingURL=book-D8XuuUqQ.js.map