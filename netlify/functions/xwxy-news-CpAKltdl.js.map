{"version":3,"file":"xwxy-news-CpAKltdl.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/gdufs/xwxy/xwxy-news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/xwxy-news',\r\n    categories: ['university'],\r\n    example: '/gdufs/xwxy-news',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['xwxy.gdufs.edu.cn/xwzx/xyxw', 'xwxy.gdufs.edu.cn/'],\r\n        },\r\n    ],\r\n    name: '新闻学院-学院新闻',\r\n    maintainers: ['gz4zzxc'],\r\n    handler,\r\n    url: 'xwxy.gdufs.edu.cn/xwzx/xyxw',\r\n};\r\n\r\nasync function handler() {\r\n    const BASE_URL = 'https://xwxy.gdufs.edu.cn';\r\n    const link = `${BASE_URL}/xwzx/xyxw.htm`;\r\n\r\n    const response = await got(link);\r\n    if (!response.body) {\r\n        throw new Error('No response body');\r\n    }\r\n    const $ = load(response.body);\r\n    const list = $('div.flex-center a.clearfix');\r\n\r\n    const items = list.toArray().map((element) => {\r\n        const item = $(element);\r\n        const href = item.attr('href') || '';\r\n        const dateText = item.find('i').text().trim();\r\n        const pubDate = parseDate(dateText).toUTCString();\r\n        return {\r\n            title: item.find('h5').text().trim(),\r\n            link: href.startsWith('http') ? href : new URL(href, BASE_URL).href,\r\n            pubDate,\r\n        };\r\n    });\r\n\r\n    const enhancedItems = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                try {\r\n                    const articleResponse = await got(item.link);\r\n                    if (!articleResponse.body) {\r\n                        throw new Error('No article body');\r\n                    }\r\n                    const $$ = load(articleResponse.body);\r\n                    const content = $$('#vsb_content .v_news_content').html() || '';\r\n                    const authors = $$('.show01 p i')\r\n                        .toArray()\r\n                        .map((el) => $$(el).text().trim());\r\n\r\n                    return {\r\n                        ...item,\r\n                        description: content,\r\n                        author: authors.join(' '),\r\n                    };\r\n                } catch {\r\n                    return {\r\n                        ...item,\r\n                        description: '无法获取内容',\r\n                        author: '',\r\n                    };\r\n                }\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '广外新传学院-学院新闻',\r\n        link,\r\n        description: '广东外语外贸大学新闻与传播学院官网-学院新闻',\r\n        item: enhancedItems,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,cACb,QAAS,mBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,8BAA+B,wBAGhD,KAAM,YACN,YAAa,CAAC,WACd,UACA,IAAK,+BAGT,eAAe,GAAU,CACrB,IAAM,EAAW,4BACX,EAAO,GAAG,EAAS,gBAEnB,EAAW,MAAMC,EAAI,GAC3B,GAAI,CAAC,EAAS,KACV,MAAU,MAAM,oBAEpB,IAAM,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,8BAET,EAAQ,EAAK,UAAU,IAAK,GAAY,CAC1C,IAAM,EAAO,EAAE,GACT,EAAO,EAAK,KAAK,SAAW,GAC5B,EAAW,EAAK,KAAK,KAAK,OAAO,OACjC,EAAU,EAAU,GAAU,cACpC,MAAO,CACH,MAAO,EAAK,KAAK,MAAM,OAAO,OAC9B,KAAM,EAAK,WAAW,QAAU,EAAO,IAAI,IAAI,EAAM,GAAU,KAC/D,aAIF,EAAgB,MAAM,QAAQ,IAChC,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,CACA,IAAM,EAAkB,MAAMD,EAAI,EAAK,MACvC,GAAI,CAAC,EAAgB,KACjB,MAAU,MAAM,mBAEpB,IAAM,EAAK,EAAK,EAAgB,MAC1B,EAAU,EAAG,gCAAgC,QAAU,GACvD,EAAU,EAAG,eACd,UACA,IAAK,GAAO,EAAG,GAAI,OAAO,QAE/B,MAAO,CACH,GAAG,EACH,YAAa,EACb,OAAQ,EAAQ,KAAK,WAErB,CACJ,MAAO,CACH,GAAG,EACH,YAAa,SACb,OAAQ,SAO5B,MAAO,CACH,MAAO,cACP,OACA,YAAa,yBACb,KAAM"}