{"version":3,"file":"pjsekai-DMiZw6Eo.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/sega/pjsekai.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport * as cheerio from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport cache from '@/utils/cache';\r\nexport const route: Route = {\r\n    path: '/pjsekai/news',\r\n    categories: ['game'],\r\n    example: '/sega/pjsekai/news',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['pjsekai.sega.jp/news/index.html'],\r\n        },\r\n    ],\r\n    name: '世界计划 多彩舞台 ｜ ProjectSekai ｜ プロセカ',\r\n    maintainers: ['15x15G'],\r\n    handler,\r\n    url: 'pjsekai.sega.jp/news/index.html',\r\n};\r\n\r\nasync function handler() {\r\n    // 从仓库 Sekai-World/sekai-master-db-diff 获取最新公告\r\n    const response = await got.get(`https://cdn.jsdelivr.net/gh/Sekai-World/sekai-master-db-diff@master/userInformations.json`);\r\n    const posts = response.data || [];\r\n    const list = await Promise.all(\r\n        posts.map(async (post) => {\r\n            let link = '';\r\n            let description = '';\r\n            const guid = post.displayOrder.toString() + post.id.toString(); // 双ID\r\n            if (post.path.startsWith('information/')) {\r\n                // information 公告\r\n                const path = post.path.replace(/information\\/index.html\\?id=/, '');\r\n                link = `https://production-web.sekai.colorfulpalette.org/${post.path}`;\r\n                try {\r\n                    description = await cache.tryGet(guid, async () => {\r\n                        const result = await got.get(`https://production-web.sekai.colorfulpalette.org/html/${path}.html`);\r\n                        const $ = cheerio.load(result.data);\r\n                        return $.html();\r\n                    });\r\n                } catch {\r\n                    description = link;\r\n                }\r\n            } else {\r\n                // 外链\r\n                link = post.path;\r\n                description = post.title;\r\n            }\r\n\r\n            const item = {\r\n                title: post.title,\r\n                link,\r\n                pubDate: timezone(new Date(post.startAt), +8), // +8时区\r\n                description,\r\n                category: post.informationTag, // event,gacha,music,bug,information\r\n                guid,\r\n            };\r\n            return item;\r\n        })\r\n    );\r\n    return {\r\n        title: 'Project Sekai - News',\r\n        link: 'https://pjsekai.sega.jp/',\r\n        description: 'プロジェクトセカイ カラフルステージ！ feat.初音ミク',\r\n        item: list,\r\n    };\r\n}\r\n"],"mappings":"gWAKA,MAAaA,EAAe,CACxB,KAAM,gBACN,WAAY,CAAC,QACb,QAAS,qBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,qCAGjB,KAAM,kCACN,YAAa,CAAC,UACd,UACA,IAAK,mCAGT,eAAe,GAAU,CAErB,IAAM,EAAW,MAAMC,EAAI,IAAI,6FACzB,EAAQ,EAAS,MAAQ,GACzB,EAAO,MAAM,QAAQ,IACvB,EAAM,IAAI,KAAO,IAAS,CACtB,IAAI,EAAO,GACP,EAAc,GACZ,EAAO,EAAK,aAAa,WAAa,EAAK,GAAG,WACpD,GAAI,EAAK,KAAK,WAAW,gBAAiB,CAEtC,IAAM,EAAO,EAAK,KAAK,QAAQ,+BAAgC,IAC/D,EAAO,oDAAoD,EAAK,OAChE,GAAI,CACA,EAAc,MAAMC,EAAM,OAAO,EAAM,SAAY,CAC/C,IAAM,EAAS,MAAMD,EAAI,IAAI,yDAAyD,EAAK,QACrF,EAAI,EAAQ,KAAK,EAAO,MAC9B,OAAO,EAAE,cAET,CACJ,EAAc,QAIlB,EAAO,EAAK,KACZ,EAAc,EAAK,MAGvB,IAAM,EAAO,CACT,MAAO,EAAK,MACZ,OACA,QAAS,EAAS,IAAI,KAAK,EAAK,SAAU,GAC1C,cACA,SAAU,EAAK,eACf,QAEJ,OAAO,KAGf,MAAO,CACH,MAAO,uBACP,KAAM,2BACN,YAAa,gCACb,KAAM"}