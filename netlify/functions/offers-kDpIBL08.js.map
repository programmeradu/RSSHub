{"version":3,"file":"offers-kDpIBL08.js","names":[],"sources":["../../lib/routes/openrice/offers.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nconst baseUrl = 'https://www.openrice.com';\r\n\r\nexport const route: Route = {\r\n    path: '/:lang/hongkong/offers',\r\n    maintainers: ['after9'],\r\n    handler,\r\n    categories: ['shopping'],\r\n    example: '/openrice/zh/hongkong/offers',\r\n    parameters: { lang: '语言，缺省为 zh' },\r\n    name: '香港餐廳精選優惠券',\r\n    description: `\r\n| 简体 | 繁體 | EN |\r\n| ----- | ------ | ----- |\r\n| zh-cn | zh | en |\r\n  `,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const lang = ctx.req.param('lang') ?? 'zh';\r\n\r\n    const apiPath = '/api/offers';\r\n    let urlPath: string;\r\n    switch (lang) {\r\n        case 'zh-cn':\r\n            urlPath = '/zh-cn/hongkong/offers';\r\n            break;\r\n        case 'en':\r\n            urlPath = '/en/hongkong/offers';\r\n            break;\r\n        case 'zh':\r\n        default:\r\n            urlPath = '/zh/hongkong/offers';\r\n            break;\r\n    }\r\n    const response = await ofetch(baseUrl + apiPath, {\r\n        headers: {\r\n            accept: 'application/json',\r\n        },\r\n        query: {\r\n            uiLang: lang,\r\n            uiCity: 'hongkong',\r\n            page: 1,\r\n            sortBy: 'PublishTime',\r\n            couponTypeId: 1,\r\n        },\r\n    });\r\n    const pageInfo = response.pageInfo;\r\n    const highlightedOffers = response.highlightedOffers;\r\n    const normalOffers = response.searchResult.paginationResult.results;\r\n    const data = [...highlightedOffers, ...normalOffers];\r\n\r\n    const resultList = data.map((item) => {\r\n        const title = item.title ?? '';\r\n        const link = baseUrl + item.urlUI;\r\n        const coverImg = item.doorPhotoUI.urls.full ?? '';\r\n        const descriptionText = item.couponType === 0 ? item.poiNameUI : `${item.desc} (${item.startTimeUI} - ${item.expireTimeUI}) [${item.multiplePoiDistrictName}]`;\r\n        const description = art(path.join(__dirname, 'templates/description.art'), {\r\n            description: descriptionText,\r\n            image: coverImg,\r\n        });\r\n        return {\r\n            title,\r\n            description,\r\n            link,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: pageInfo.seoInfo.title ?? 'OpenRice Hong Kong Offers',\r\n        link: baseUrl + urlPath,\r\n        description: pageInfo.seoInfo.metadataDictionary.name.find((item: { key: string; value: string }) => item.key === 'description')?.value ?? 'OpenRice Hong Kong Offers',\r\n        item: resultList,\r\n    };\r\n}\r\n"],"mappings":"2RAIA,MAAM,EAAU,2BAEH,EAAe,CACxB,KAAM,yBACN,YAAa,CAAC,UACd,UACA,WAAY,CAAC,YACb,QAAS,+BACT,WAAY,CAAE,KAAM,aACpB,KAAM,YACN,YAAa;;;;KAOjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,KAGlC,EACJ,OAAQ,EAAR,CACI,IAAK,QACD,EAAU,yBACV,MACJ,IAAK,KACD,EAAU,sBACV,MACJ,IAAK,KACL,QACI,EAAU,sBACV,MAER,IAAM,EAAW,MAAM,EAAO,EAAU,cAAS,CAC7C,QAAS,CACL,OAAQ,oBAEZ,MAAO,CACH,OAAQ,EACR,OAAQ,WACR,KAAM,EACN,OAAQ,cACR,aAAc,KAGhB,EAAW,EAAS,SACpB,EAAoB,EAAS,kBAC7B,EAAe,EAAS,aAAa,iBAAiB,QACtD,EAAO,CAAC,GAAG,EAAmB,GAAG,GAEjC,EAAa,EAAK,IAAK,GAAS,CAClC,IAAM,EAAQ,EAAK,OAAS,GACtB,EAAO,EAAU,EAAK,MACtB,EAAW,EAAK,YAAY,KAAK,MAAQ,GACzC,EAAkB,EAAK,aAAe,EAAI,EAAK,UAAY,GAAG,EAAK,KAAK,IAAI,EAAK,YAAY,KAAK,EAAK,aAAa,KAAK,EAAK,wBAAwB,GACtJ,EAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACvE,YAAa,EACb,MAAO,IAEX,MAAO,CACH,QACA,cACA,UAIR,MAAO,CACH,MAAO,EAAS,QAAQ,OAAS,4BACjC,KAAM,EAAU,EAChB,YAAa,EAAS,QAAQ,mBAAmB,KAAK,KAAM,GAAyC,EAAK,MAAQ,gBAAgB,OAAS,4BAC3I,KAAM"}