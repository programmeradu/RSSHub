{"version":3,"file":"projects-DdOT2pFA.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/instructables/projects.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/projects/:category?',\r\n    categories: ['other'],\r\n    example: '/instructables/projects/circuits',\r\n    parameters: { category: 'Category, empty by default, can be found in URL or see the table below' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['instructables.com/projects'],\r\n            target: '/projects',\r\n        },\r\n    ],\r\n    name: 'Projects',\r\n    maintainers: ['wolfg1969'],\r\n    handler,\r\n    url: 'instructables.com/projects',\r\n    description: `| All | Circuits | Workshop | Craft | Cooking | Living | Outside | Teachers |\r\n| --- | -------- | -------- | ----- | ------- | ------ | ------- | -------- |\r\n|     | circuits | workshop | craft | cooking | living | outside | teachers |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'all' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 50;\r\n\r\n    const siteDomain = 'instructables.com';\r\n\r\n    let pathPrefix, projectFilter;\r\n    if (category === 'all') {\r\n        pathPrefix = '';\r\n        projectFilter = '';\r\n    } else {\r\n        pathPrefix = `${category}/`;\r\n        const filterValue = `${category.charAt(0).toUpperCase()}${category.slice(1)}`;\r\n        projectFilter = category === 'teachers' ? `&& teachers:=${filterValue}` : ` && category:=${filterValue}`;\r\n    }\r\n\r\n    const pageLink = `https://${siteDomain}/${pathPrefix}projects`;\r\n\r\n    const pageResponse = await ofetch(pageLink);\r\n    const $ = load(pageResponse);\r\n    const { typesenseProxy, typesenseApiKey } = JSON.parse($('script#js-page-context').text());\r\n\r\n    const data = await ofetch(`${typesenseProxy}/collections/projects/documents/search`, {\r\n        method: 'get',\r\n        baseURL: `https://${siteDomain}`,\r\n        headers: {\r\n            Referer: pageLink,\r\n            Host: siteDomain,\r\n            'x-typesense-api-key': typesenseApiKey,\r\n        },\r\n        query: {\r\n            q: '*',\r\n            query_by: 'title,stepBody,screenName',\r\n            page: 1,\r\n            per_page: limit,\r\n            sort_by: 'publishDate:desc',\r\n            include_fields: 'title,urlString,coverImageUrl,screenName,publishDate,favorites,views,primaryClassification,featureFlag,prizeLevel,IMadeItCount',\r\n            filter_by: `featureFlag:=true${projectFilter}`,\r\n        },\r\n        parseResponse: JSON.parse,\r\n    });\r\n\r\n    return {\r\n        title: 'Instructables Projects', // 项目的标题\r\n        link: `https://${siteDomain}/projects`, // 指向项目的链接\r\n        description: 'Instructables Projects', // 描述项目\r\n        language: 'en', // 频道语言\r\n        item: data.hits.map((item) => ({\r\n            title: item.document.title,\r\n            link: `https://${siteDomain}/${item.document.urlString}`,\r\n            author: item.document.screenName,\r\n            description: `<img src=\"${item.document.coverImageUrl}?auto=webp&crop=1.2%3A1&frame=1&width=500\" width=\"500\">`,\r\n            pubDate: parseDate(item.document.publishDate),\r\n            category: item.document.primaryClassification,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"+PAKA,MAAaA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,SACb,QAAS,mCACT,WAAY,CAAE,SAAU,0EACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,8BACT,OAAQ,cAGhB,KAAM,WACN,YAAa,CAAC,aACd,UACA,IAAK,6BACL,YAAa;;gFAKjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,OAAU,EAAI,IAAI,QAC/B,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAa,oBAEf,EAAY,EAChB,GAAI,IAAa,MACb,EAAa,GACb,EAAgB,OACb,CACH,EAAa,GAAG,EAAS,GACzB,IAAM,EAAc,GAAG,EAAS,OAAO,GAAG,gBAAgB,EAAS,MAAM,KACzE,EAAgB,IAAa,WAAa,gBAAgB,IAAgB,iBAAiB,IAG/F,IAAM,EAAW,WAAW,EAAW,GAAG,EAAW,UAE/C,EAAe,MAAMC,EAAO,GAC5B,EAAI,EAAK,GACT,CAAE,iBAAgB,mBAAoB,KAAK,MAAM,EAAE,0BAA0B,QAE7E,EAAO,MAAMA,EAAO,GAAG,EAAe,wCAAyC,CACjF,OAAQ,MACR,QAAS,WAAW,IACpB,QAAS,CACL,QAAS,EACT,KAAM,EACN,sBAAuB,GAE3B,MAAO,CACH,EAAG,IACH,SAAU,4BACV,KAAM,EACN,SAAU,EACV,QAAS,mBACT,eAAgB,iIAChB,UAAW,oBAAoB,KAEnC,cAAe,KAAK,QAGxB,MAAO,CACH,MAAO,yBACP,KAAM,WAAW,EAAW,WAC5B,YAAa,yBACb,SAAU,KACV,KAAM,EAAK,KAAK,IAAK,IAAU,CAC3B,MAAO,EAAK,SAAS,MACrB,KAAM,WAAW,EAAW,GAAG,EAAK,SAAS,YAC7C,OAAQ,EAAK,SAAS,WACtB,YAAa,aAAa,EAAK,SAAS,cAAc,yDACtD,QAAS,EAAU,EAAK,SAAS,aACjC,SAAU,EAAK,SAAS"}