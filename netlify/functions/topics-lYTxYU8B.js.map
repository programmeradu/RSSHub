{"version":3,"file":"topics-lYTxYU8B.js","names":["route: Route","got","items: DataItem[]","cache","$"],"sources":["../../lib/routes/sankei/topics.ts"],"sourcesContent":["import { Route, Data, DataItem } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { Context } from 'hono';\r\n\r\nexport const route: Route = {\r\n    path: ['/topics/:topic'],\r\n    categories: ['traditional-media'],\r\n    example: '/sankei/topics/etc_100',\r\n    parameters: {\r\n        topic: 'Topic name (format included in URL). For example, for \"Expo 2025 Osaka, Kansai, Japan Special Feature\" https://www.sankei.com/tag/topic/etc_100, the value would be etc_100.',\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.sankei.com/tag/topic/:topic'],\r\n            target: '/topics/:topic',\r\n        },\r\n    ],\r\n    name: 'Topic',\r\n    maintainers: ['yuikisaito'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const baseUrl = 'https://www.sankei.com';\r\n    const { topic } = ctx.req.param();\r\n    const url = `${baseUrl}/tag/topic/${topic}/`;\r\n\r\n    const response = await got(url);\r\n    const $ = load(response.body);\r\n    const categoryName = $('li.breadcrumb-list-item:nth-of-type(3) > a').text();\r\n\r\n    const listSelector = $('div.story-card-feed.grid.hide_on_mobile > div > article');\r\n\r\n    const items: DataItem[] = await Promise.all(\r\n        listSelector.toArray().map((el) => {\r\n            const item = $(el);\r\n            item.find('p a').remove();\r\n\r\n            const title = item.find('div.story-card-flex > h3.headline > a').text();\r\n            const link = baseUrl + (item.find('div.story-card-flex > h3.headline > a').attr('href') || '');\r\n            const pubDate = parseDate(item.find('div.story-card-flex > div > time').attr('datetime') || '');\r\n\r\n            return cache.tryGet(link, async () => {\r\n                const detail = await got(link);\r\n                const $ = load(detail.body);\r\n                $('.inline-gptAd, .figure_image_sizer').remove();\r\n                const articleHTML = $('div.article-body').html() || '';\r\n\r\n                return {\r\n                    title,\r\n                    link,\r\n                    pubDate,\r\n                    description: articleHTML,\r\n                };\r\n            });\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: '産経ニュース - ' + categoryName,\r\n        description: $('meta[name=\"description\"]').attr('content'),\r\n        link: url,\r\n        image: $('meta[property=\"og:image\"]').attr('content'),\r\n        language: 'ja',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAQA,MAAaA,EAAe,CACxB,KAAM,CAAC,kBACP,WAAY,CAAC,qBACb,QAAS,yBACT,WAAY,CACR,MAAO,gLAEX,MAAO,CACH,CACI,OAAQ,CAAC,mCACT,OAAQ,mBAGhB,KAAM,QACN,YAAa,CAAC,cACd,WAGJ,eAAe,EAAQ,EAA6B,CAChD,IAAM,EAAU,yBACV,CAAE,SAAU,EAAI,IAAI,QACpB,EAAM,GAAG,EAAQ,aAAa,EAAM,GAEpC,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,MAClB,EAAe,EAAE,8CAA8C,OAE/D,EAAe,EAAE,2DAEjBC,EAAoB,MAAM,QAAQ,IACpC,EAAa,UAAU,IAAK,GAAO,CAC/B,IAAM,EAAO,EAAE,GACf,EAAK,KAAK,OAAO,SAEjB,IAAM,EAAQ,EAAK,KAAK,yCAAyC,OAC3D,EAAO,GAAW,EAAK,KAAK,yCAAyC,KAAK,SAAW,IACrF,EAAU,EAAU,EAAK,KAAK,oCAAoC,KAAK,aAAe,IAE5F,OAAOC,EAAM,OAAO,EAAM,SAAY,CAClC,IAAM,EAAS,MAAMF,EAAI,GACnBG,EAAI,EAAK,EAAO,MACtB,EAAE,sCAAsC,SACxC,IAAM,EAAcA,EAAE,oBAAoB,QAAU,GAEpD,MAAO,CACH,QACA,OACA,UACA,YAAa,QAM7B,MAAO,CACH,MAAO,YAAc,EACrB,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,EACN,MAAO,EAAE,6BAA6B,KAAK,WAC3C,SAAU,KACV,KAAM"}