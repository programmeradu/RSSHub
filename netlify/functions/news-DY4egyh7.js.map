{"version":3,"file":"news-DY4egyh7.js","names":["got","route: Route","cache"],"sources":["../../lib/routes/jseea/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\n// 参考 bit/jwc 北京理工大学的的页面写成\r\n\r\nconst baseUrl = 'https://www.jseea.cn';\r\nconst siteTitle = ' - 江苏省教育考试院';\r\n\r\n// 专门定义一个function用于加载文章内容\r\nasync function loadContent(link) {\r\n    // 异步请求文章\r\n    const { data: response } = await got(link);\r\n    // 加载文章内容\r\n    const $ = load(response);\r\n    // 提取文章内容\r\n    $('strong').remove();\r\n    const description = $('#content').html();\r\n    // 返回解析的结果\r\n    return description;\r\n}\r\n\r\nexport const route: Route = {\r\n    path: '/news/:type?',\r\n    radar: [\r\n        {\r\n            source: ['jseea.cn/webfile/news/:type'],\r\n            target: '/news/:type',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['schen1024'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    // 默认 正常规定 然后获取列表页面\r\n    const type = ctx.req.param('type') ?? 'zkyw';\r\n    const listPageUrl = `${baseUrl}/webfile/news/${type}/`;\r\n    const { data: response } = await got(listPageUrl);\r\n    const $ = load(response);\r\n\r\n    // console.log(type+\":\"+listPageUrl);\r\n    // 获取当前页面的 list\r\n    const list = $('div.content-list-div ul li a')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item\r\n                    .contents()\r\n                    .filter((_, e) => e.nodeType === 3)\r\n                    .text()\r\n                    .trim(),\r\n                link: `https:${item.attr('href')}`,\r\n                pubDate: timezone(parseDate(item.find('span').text(), 'YYYY-MM-DD'), 8),\r\n            };\r\n        });\r\n\r\n    const result = await Promise.all(\r\n        // 遍历每一篇文章\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                item.description = await loadContent(item.link);\r\n                // 合并解析后的结果集作为该篇文章最终的输出结果\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head title').text() + siteTitle,\r\n        link: listPageUrl,\r\n        item: result,\r\n    };\r\n}\r\n"],"mappings":"0ZAaA,eAAe,EAAY,EAAM,CAE7B,GAAM,CAAE,KAAM,GAAa,MAAMA,EAAI,GAE/B,EAAI,EAAK,GAEf,EAAE,UAAU,SACZ,IAAM,EAAc,EAAE,YAAY,OAElC,OAAO,EAGX,MAAaC,EAAe,CACxB,KAAM,eACN,MAAO,CACH,CACI,OAAQ,CAAC,+BACT,OAAQ,gBAGhB,KAAM,UACN,YAAa,CAAC,aACd,WAGJ,eAAe,EAAQ,EAAK,CAExB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,OAChC,EAAc,qCAA2B,EAAK,GAC9C,CAAE,KAAM,GAAa,MAAMD,EAAI,GAC/B,EAAI,EAAK,GAIT,EAAO,EAAE,gCACV,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EACF,WACA,QAAQ,EAAG,IAAM,EAAE,WAAa,GAChC,OACA,OACL,KAAM,SAAS,EAAK,KAAK,UACzB,QAAS,EAAS,EAAU,EAAK,KAAK,QAAQ,OAAQ,cAAe,MAI3E,EAAS,MAAM,QAAQ,IAEzB,EAAK,IAAK,GACNE,EAAM,OAAO,EAAK,KAAM,UACpB,EAAK,YAAc,MAAM,EAAY,EAAK,MAEnC,MAKnB,MAAO,CACH,MAAO,EAAE,cAAc,OAAS,cAChC,KAAM,EACN,KAAM"}