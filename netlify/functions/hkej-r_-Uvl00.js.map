{"version":3,"file":"hkej-r_-Uvl00.js","names":[],"sources":["../../lib/routes/hkej/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate, parseRelativeDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { CookieJar } from 'tough-cookie';\r\n\r\nconst cookieJar = new CookieJar();\r\n\r\nconst categories = {\r\n    index: {\r\n        name: '',\r\n        link: '/instantnews/',\r\n        title: '即時香港中國 國際金融 股市經濟新聞',\r\n        description: '全天候即時港股、香港財經、國際金融和經濟新聞、中國經濟新聞資訊和分析',\r\n    },\r\n    stock: {\r\n        name: '港股直擊',\r\n        link: '/instantnews/stock',\r\n        title: '即時香港股市 股份板塊 攻略分析',\r\n        description: '全天候即時港股追蹤和直擊分析，股份異動、大行報告、沽空、速評',\r\n    },\r\n    hongkong: {\r\n        name: '香港財經',\r\n        link: '/instantnews/hongkong',\r\n        title: '即時香港經濟 中港經濟融合追蹤分析',\r\n        description: '香港經濟和焦點行業 中港融合和商機的分析',\r\n    },\r\n    china: {\r\n        name: '中國財經',\r\n        link: '/instantnews/china',\r\n        title: '即時中國經濟 國策焦點 中港融合追蹤分析',\r\n        description: '香港經濟和焦點行業 中港融合和商機的分析',\r\n    },\r\n    international: {\r\n        name: '國際財經',\r\n        link: '/instantnews/international',\r\n        title: '即時國際財經 股市匯市 央行政策',\r\n        description: '國際財經 金融股市 央行政策的新聞和分析',\r\n    },\r\n    property: {\r\n        name: '地產新聞',\r\n        link: '/property/news',\r\n        title: '地產投資',\r\n        description: '即時地產新聞, 新盤資訊, 樓市分析, 藍籌屋苑數據及室內設計鑑賞',\r\n    },\r\n    current: {\r\n        name: '時事脈搏',\r\n        link: '/instantnews/current',\r\n        title: '即時香港中國 國際金融 股市經濟新聞',\r\n        description: '全天候即時香港股市、金融、經濟新聞資訊和分析，致力與讀者一起剖釋香港、關注兩岸、放眼全球政經格局',\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    categories: ['traditional-media'],\r\n    example: '/hkej/index',\r\n    parameters: { category: '分类，默认为全部新闻' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['hkej.com/'],\r\n        },\r\n    ],\r\n    name: '即时新闻',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'hkej.com/',\r\n    description: `| index    | stock    | hongkong | china    | international | property | current  |\r\n| -------- | -------- | -------- | -------- | ------------- | -------- | -------- |\r\n| 全部新闻 | 港股直击 | 香港财经 | 中国财经 | 国际财经      | 地产新闻 | 时事脉搏 |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? 'index';\r\n    const cat = categories[category];\r\n    const baseUrl = 'https://www2.hkej.com';\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: baseUrl + cat.link,\r\n        headers: {\r\n            Referer: baseUrl,\r\n        },\r\n        cookieJar,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    const list = $('h3.in_news_u_t a, h4.hkej_hl-news_topic_2014 a, div.hkej_toc_listingAll_news2_2014 h3 a, div.hkej_toc_cat_top_detail h3 a, div.allNews div.news h1 a, div#div_listingAll div.news2 h3 a')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item.text().trim(),\r\n                link: baseUrl + item.attr('href').slice(0, item.attr('href').lastIndexOf('/')),\r\n            };\r\n        });\r\n\r\n    const renderArticleImg = (pics) =>\r\n        art(path.join(__dirname, 'templates/articleImg.art'), {\r\n            pics,\r\n        });\r\n\r\n    const renderDesc = (pics, desc) =>\r\n        art(path.join(__dirname, 'templates/description.art'), {\r\n            pics: renderArticleImg(pics),\r\n            desc,\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list &&\r\n            list.map((item) =>\r\n                cache.tryGet(item.link, async () => {\r\n                    const article = await got({\r\n                        method: 'get',\r\n                        url: item.link,\r\n                        headers: {\r\n                            Referer: cat.link,\r\n                        },\r\n                        cookieJar,\r\n                    });\r\n                    const content = load(article.data);\r\n\r\n                    // remove unwanted elements\r\n                    content('#ad_popup').remove();\r\n                    content('[class^=ad-]').remove();\r\n                    content('[id^=ad-]').remove();\r\n                    content('[id^=div-gpt-ad-]').remove();\r\n                    content('.hkej_sub_ex_article_nonsubscriber_ad_2014').remove();\r\n\r\n                    // fix article image\r\n                    const articleImg = (content('div.hkej_detail_thumb_2014 td a').length ? content('div.hkej_detail_thumb_2014 td a') : content('div.thumb td a')).toArray().map((e) => {\r\n                        e = $(e);\r\n                        return {\r\n                            href: e.attr('href'),\r\n                            title: e.attr('title'),\r\n                        };\r\n                    });\r\n\r\n                    const pubDate = content('p.info span.date').text().trim();\r\n\r\n                    item.category = content('p.info span.cate a')\r\n                        .toArray()\r\n                        .map((e) => content(e).text().trim());\r\n                    item.description = renderDesc(articleImg, content('div#article-content').html());\r\n                    item.pubDate = timezone(/(今|昨)/.test(pubDate) ? parseRelativeDate(pubDate) : parseDate(pubDate, 'YYYY M D'), +8);\r\n\r\n                    return item;\r\n                })\r\n            )\r\n    );\r\n\r\n    const ret = {\r\n        title: `信報網站 - ${cat.title} - 信報網站 hkej.com`,\r\n        link: baseUrl + cat.link,\r\n        description: `信報網站(www.hkej.com)即時新聞${cat.name}，提供${cat.description}。`,\r\n        item: items,\r\n        language: 'zh-hk',\r\n    };\r\n\r\n    ctx.set('json', {\r\n        ...ret,\r\n        cookieJar,\r\n    });\r\n    return ret;\r\n}\r\n"],"mappings":"0kBAWA,MAAM,EAAY,IAAI,EAEhB,EAAa,CACf,MAAO,CACH,KAAM,GACN,KAAM,gBACN,MAAO,qBACP,YAAa,sCAEjB,MAAO,CACH,KAAM,OACN,KAAM,qBACN,MAAO,mBACP,YAAa,kCAEjB,SAAU,CACN,KAAM,OACN,KAAM,wBACN,MAAO,oBACP,YAAa,wBAEjB,MAAO,CACH,KAAM,OACN,KAAM,qBACN,MAAO,uBACP,YAAa,wBAEjB,cAAe,CACX,KAAM,OACN,KAAM,6BACN,MAAO,mBACP,YAAa,wBAEjB,SAAU,CACN,KAAM,OACN,KAAM,iBACN,MAAO,OACP,YAAa,qCAEjB,QAAS,CACL,KAAM,OACN,KAAM,uBACN,MAAO,qBACP,YAAa,qDAIR,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,qBACb,QAAS,cACT,WAAY,CAAE,SAAU,cACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,eAGjB,KAAM,OACN,YAAa,CAAC,UACd,UACA,IAAK,YACL,YAAa;;0DAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,QACxC,EAAM,EAAW,GACjB,EAAU,wBAEV,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,EAAU,EAAI,KACnB,QAAS,CACL,QAAS,GAEb,cAGE,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,2LACV,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,OAAO,OACnB,KAAM,EAAU,EAAK,KAAK,QAAQ,MAAM,EAAG,EAAK,KAAK,QAAQ,YAAY,SAI/E,EAAoB,GACtB,EAAI,EAAA,KAAA,EAAA,qCAAkD,CAClD,SAGF,GAAc,EAAM,IACtB,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACnD,KAAM,EAAiB,GACvB,SAGF,EAAQ,MAAM,QAAQ,IACxB,GACI,EAAK,IAAK,GACN,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAU,MAAM,EAAI,CACtB,OAAQ,MACR,IAAK,EAAK,KACV,QAAS,CACL,QAAS,EAAI,MAEjB,cAEE,EAAU,EAAK,EAAQ,MAG7B,EAAQ,aAAa,SACrB,EAAQ,gBAAgB,SACxB,EAAQ,aAAa,SACrB,EAAQ,qBAAqB,SAC7B,EAAQ,8CAA8C,SAGtD,IAAM,GAAc,EAAQ,mCAAmC,OAAS,EAAQ,mCAAqC,EAAQ,mBAAmB,UAAU,IAAK,IAC3J,EAAI,EAAE,GACC,CACH,KAAM,EAAE,KAAK,QACb,MAAO,EAAE,KAAK,YAIhB,EAAU,EAAQ,oBAAoB,OAAO,OAQnD,MANA,GAAK,SAAW,EAAQ,sBACnB,UACA,IAAK,GAAM,EAAQ,GAAG,OAAO,QAClC,EAAK,YAAc,EAAW,EAAY,EAAQ,uBAAuB,QACzE,EAAK,QAAU,EAAS,QAAQ,KAAK,GAAW,EAAkB,GAAW,EAAU,EAAS,YAAa,GAEtG,MAKjB,EAAM,CACR,MAAO,UAAU,EAAI,MAAM,kBAC3B,KAAM,EAAU,EAAI,KACpB,YAAa,yBAAyB,EAAI,KAAK,KAAK,EAAI,YAAY,GACpE,KAAM,EACN,SAAU,SAOd,OAJA,EAAI,IAAI,OAAQ,CACZ,GAAG,EACH,cAEG"}