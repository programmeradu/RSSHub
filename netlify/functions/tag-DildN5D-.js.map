{"version":3,"file":"tag-DildN5D-.js","names":["route: Route","utils","ConfigNotFoundError","got"],"sources":["../../lib/routes/mastodon/tag.ts"],"sourcesContent":["import { Route, ViewType, Data } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { Context } from 'hono';\r\nimport utils from './utils';\r\nimport { config } from '@/config';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nexport const route: Route = {\r\n    path: '/tag/:site/:hashtag/:only_media?',\r\n    categories: ['social-media'],\r\n    view: ViewType.SocialMedia,\r\n    example: '/mastodon/tag/mastodon.social/gochisou/true',\r\n    parameters: {\r\n        site: 'instance address, only domain, no `http://` or `https://` protocol header',\r\n        hashtag: 'Hashtag you want to subscribe to (without the # symbol)',\r\n        only_media: {\r\n            description: 'whether only display media content, default to false, any value to true',\r\n            options: [\r\n                { value: 'true', label: 'true' },\r\n                { value: 'false', label: 'false' },\r\n            ],\r\n            default: 'false',\r\n        },\r\n    },\r\n    name: 'Hashtag timeline',\r\n    maintainers: ['yuikisaito'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const { site, hashtag } = ctx.req.param();\r\n    const only_media = ctx.req.param('only_media') === 'true' ? 'true' : 'false';\r\n    if (!config.feature.allow_user_supply_unsafe_domain && !utils.allowSiteList.includes(site)) {\r\n        throw new ConfigNotFoundError(`This RSS is disabled unless 'ALLOW_USER_SUPPLY_UNSAFE_DOMAIN' is set to 'true'.`);\r\n    }\r\n\r\n    const url = `http://${site}/api/v1/timelines/tag/${hashtag}?only_media=${only_media}`;\r\n\r\n    const response = await got.get(url, { headers: utils.apiHeaders(site) });\r\n    const list = response.data;\r\n\r\n    return {\r\n        title: `#${hashtag} ${only_media === 'true' ? ' Media' : ''} Timeline on ${site}`,\r\n        link: `https://${site}`,\r\n        item: utils.parseStatuses(list),\r\n    };\r\n}\r\n"],"mappings":"2dAQA,MAAaA,EAAe,CACxB,KAAM,mCACN,WAAY,CAAC,gBACb,KAAM,EAAS,YACf,QAAS,8CACT,WAAY,CACR,KAAM,4EACN,QAAS,0DACT,WAAY,CACR,YAAa,0EACb,QAAS,CACL,CAAE,MAAO,OAAQ,MAAO,QACxB,CAAE,MAAO,QAAS,MAAO,UAE7B,QAAS,UAGjB,KAAM,mBACN,YAAa,CAAC,cACd,WAGJ,eAAe,EAAQ,EAA6B,CAChD,GAAM,CAAE,OAAM,WAAY,EAAI,IAAI,QAC5B,EAAa,EAAI,IAAI,MAAM,gBAAkB,OAAS,OAAS,QACrE,GAAI,CAAC,EAAO,QAAQ,iCAAmC,CAACC,EAAM,cAAc,SAAS,GACjF,MAAM,IAAIC,EAAoB,mFAGlC,IAAM,EAAM,UAAU,EAAK,wBAAwB,EAAQ,cAAc,IAEnE,EAAW,MAAMC,EAAI,IAAI,EAAK,CAAE,QAASF,EAAM,WAAW,KAC1D,EAAO,EAAS,KAEtB,MAAO,CACH,MAAO,IAAI,EAAQ,GAAG,IAAe,OAAS,SAAW,GAAG,eAAe,IAC3E,KAAM,WAAW,IACjB,KAAMA,EAAM,cAAc"}