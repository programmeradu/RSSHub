{"version":3,"file":"listed-notice-BH9Dc-dv.js","names":["limit: number","baseUrl: string","staticBaseUrl: string","apiUrl: string","targetUrl: string","ofetch","$: CheerioAPI","items: DataItem[]","title: string","pubDate: number | string","linkUrl: string | undefined","categories: string[]","guid: string","updated: number | string","processedItem: DataItem","enclosureUrl: string | undefined","enclosureType: string","route: Route"],"sources":["../../lib/routes/szse/disclosure/listed-notice.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nimport { type CheerioAPI, load } from 'cheerio';\r\nimport { type Context } from 'hono';\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const { category = '' } = ctx.req.param();\r\n    const limit: number = Number.parseInt(ctx.req.query('limit') ?? '50', 10);\r\n\r\n    const baseUrl: string = 'https://www.szse.cn';\r\n    const staticBaseUrl: string = 'https://disc.static.szse.cn';\r\n    const apiUrl: string = new URL('api/disc/announcement/annList', baseUrl).href;\r\n    const targetUrl: string = new URL(`disclosure/listed/notice${category}`, baseUrl).href;\r\n\r\n    const targetResponse = await ofetch(targetUrl);\r\n    const $: CheerioAPI = load(targetResponse);\r\n    const language = $('html').attr('lang') ?? 'zh-CN';\r\n\r\n    const response = await ofetch(apiUrl, {\r\n        method: 'POST',\r\n        body: {\r\n            seDate: ['', ''],\r\n            channelCode: ['listedNotice_disc'],\r\n            pageSize: limit,\r\n            pageNum: 1,\r\n        },\r\n    });\r\n\r\n    const items: DataItem[] = response.data\r\n        .slice(0, limit)\r\n        .map((item): DataItem => {\r\n            const title: string = item.title;\r\n            const pubDate: number | string = item.publishTime;\r\n            const linkUrl: string | undefined = `disclosure/listed/bulletinDetail/index.html?${item.id}`;\r\n            const categories: string[] = [...new Set([...item.secCode, ...item.secName, item.bigCategoryId, item.bigIndustryCode, item.smallCategoryId].filter(Boolean))];\r\n            const guid: string = `szse-${item.id}`;\r\n            const updated: number | string = item.publishTime;\r\n\r\n            let processedItem: DataItem = {\r\n                title,\r\n                pubDate: pubDate ? timezone(parseDate(pubDate), +8) : undefined,\r\n                link: new URL(linkUrl, baseUrl).href,\r\n                category: categories,\r\n                guid,\r\n                id: guid,\r\n                updated: updated ? timezone(parseDate(updated), +8) : undefined,\r\n                language,\r\n            };\r\n\r\n            const enclosureUrl: string | undefined = new URL(`download${item.attachPath}`, staticBaseUrl).href;\r\n\r\n            if (enclosureUrl) {\r\n                const enclosureType: string = `application/${item.attachFormat}`;\r\n\r\n                processedItem = {\r\n                    ...processedItem,\r\n                    enclosure_url: enclosureUrl,\r\n                    enclosure_type: enclosureType,\r\n                    enclosure_title: title,\r\n                    enclosure_length: undefined,\r\n                };\r\n            }\r\n\r\n            return processedItem;\r\n        })\r\n        .filter((_): _ is DataItem => true);\r\n\r\n    return {\r\n        title: '深圳证券交易所 - 上市公司公告',\r\n        description: $('meta[name=\"description\"]').attr('content'),\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: $('a.navbar-brand img').attr('src'),\r\n        author: $('meta[name=\"author\"]').attr('content'),\r\n        language,\r\n        id: targetUrl,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/disclosure/listed/notice',\r\n    name: '上市公司公告',\r\n    url: 'www.szse.cn',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/szse/disclosure/listed/notice',\r\n    parameters: undefined,\r\n    description: undefined,\r\n    categories: ['finance'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.szse.cn/disclosure/listed/notice/index.html'],\r\n            target: '/disclosure/listed/notice',\r\n        },\r\n    ],\r\n    view: ViewType.Articles,\r\n};\r\n"],"mappings":"gWASA,MAAa,EAAU,KAAO,IAAgC,CAC1D,GAAM,CAAE,WAAW,IAAO,EAAI,IAAI,QAC5BA,EAAgB,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IAEhEC,EAAkB,sBAElBE,EAAiB,IAAI,IAAI,gCAAiC,GAAS,KACnEC,EAAoB,IAAI,IAAI,2BAA2B,IAAY,GAAS,KAE5E,EAAiB,MAAMC,EAAO,GAC9BC,EAAgB,EAAK,GACrB,EAAW,EAAE,QAAQ,KAAK,SAAW,QAErC,EAAW,MAAMD,EAAO,EAAQ,CAClC,OAAQ,OACR,KAAM,CACF,OAAQ,CAAC,GAAI,IACb,YAAa,CAAC,qBACd,SAAU,EACV,QAAS,KAIXE,EAAoB,EAAS,KAC9B,MAAM,EAAG,GACT,IAAK,GAAmB,CACrB,IAAMC,EAAgB,EAAK,MACrBC,EAA2B,EAAK,YAChCC,EAA8B,+CAA+C,EAAK,KAClFC,EAAuB,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,EAAK,QAAS,GAAG,EAAK,QAAS,EAAK,cAAe,EAAK,gBAAiB,EAAK,iBAAiB,OAAO,WAC7IC,EAAe,QAAQ,EAAK,KAC5BC,EAA2B,EAAK,YAElCC,EAA0B,CAC1B,QACA,QAAS,EAAU,EAAS,EAAU,GAAU,GAAM,IAAA,GACtD,KAAM,IAAI,IAAI,EAAS,GAAS,KAChC,SAAU,EACV,OACA,GAAI,EACJ,QAAS,EAAU,EAAS,EAAU,GAAU,GAAM,IAAA,GACtD,YAGEC,EAAmC,IAAI,IAAI,WAAW,EAAK,aAAc,+BAAe,KAE9F,GAAI,EAAc,CACd,IAAMC,EAAwB,eAAe,EAAK,eAElD,EAAgB,CACZ,GAAG,EACH,cAAe,EACf,eAAgB,EAChB,gBAAiB,EACjB,iBAAkB,IAAA,IAI1B,OAAO,IAEV,OAAQ,GAAqB,IAElC,MAAO,CACH,MAAO,mBACP,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,EACN,KAAM,EACN,WAAY,GACZ,MAAO,EAAE,sBAAsB,KAAK,OACpC,OAAQ,EAAE,uBAAuB,KAAK,WACtC,WACA,GAAI,IAICC,EAAe,CACxB,KAAM,4BACN,KAAM,SACN,IAAK,cACL,YAAa,CAAC,WACd,UACA,QAAS,iCACT,WAAY,IAAA,GACZ,YAAa,IAAA,GACb,WAAY,CAAC,WACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,mDACT,OAAQ,8BAGhB,KAAM,EAAS"}