{"version":3,"file":"6park-DR1J3tvS.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/6park/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/index/:id?/:type?/:keyword?',\r\n    name: '首页',\r\n    maintainers: ['nczitzk', 'cscnk52'],\r\n    handler,\r\n    example: '/6park/index',\r\n    parameters: { id: '分站，见下表，默认为史海钩沉', type: '类型，可选值为 gold、type，默认为空', keyword: '关键词，可选，默认为空' },\r\n    radar: [\r\n        {\r\n            source: ['club.6parkbbs.com/:id/index.php', 'club.6parkbbs.com/'],\r\n            target: '/:id?',\r\n        },\r\n    ],\r\n    description: `| 婚姻家庭 | 魅力时尚 | 女性频道 | 生活百态 | 美食厨房 | 非常影音 | 车迷沙龙 | 游戏天地 | 卡通漫画 | 体坛纵横 | 运动健身 | 电脑前线 | 数码家电 | 旅游风向 | 摄影部落 | 奇珍异宝 | 笑口常开 | 娱乐八卦 | 吃喝玩乐 | 文化长廊 | 军事纵横 | 百家论坛 | 科技频道 | 爱子情怀 | 健康人生 | 博论天下 | 史海钩沉 | 网际谈兵 | 经济观察 | 谈股论金 | 杂论闲侃 | 唯美乐园 | 学习园地 | 命理玄机 | 宠物情缘 | 网络歌坛 | 音乐殿堂 | 情感世界 |\r\n|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|----------|\r\n| life9    | life1    | chan10   | life2    | life6    | fr       | enter7   | enter3   | enter6   | enter5   | sport    | know1    | chan6    | life7    | chan8    | page     | enter1   | enter8   | netstar  | life10   | nz       | other    | chan2    | chan5    | life5    | bolun    | chan1    | military | finance  | chan4    | pk       | gz1      | gz2      | gz3      | life8    | chan7    | enter4   | life3    |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id') ?? 'chan1';\r\n    const type = ctx.req.param('type') ?? '';\r\n    const keyword = ctx.req.param('keyword') ?? '';\r\n\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 50;\r\n\r\n    const rootUrl = 'https://club.6parkbbs.com';\r\n    const indexUrl = `${rootUrl}/${id}/index.php`;\r\n    const currentUrl = `${indexUrl}${type === '' || keyword === '' ? '' : type === 'gold' ? '?app=forum&act=gold' : `?action=search&act=threadsearch&app=forum&${type}=${keyword}&submit=${type === 'type' ? '查询' : '栏目搜索'}`}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    let items = $('#d_list ul li, #thread_list li, .t_l .t_subject')\r\n        .toArray()\r\n        .slice(0, limit)\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('a').first();\r\n\r\n            return {\r\n                link: `${rootUrl}/${id}/${a.attr('href')}`,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n\r\n                const content = load(detailResponse.data);\r\n\r\n                item.title = content('title').text().replace(' -6park.com', '');\r\n                item.author = detailResponse.data.match(/送交者: .*>(.*)<.*\\[/)[1];\r\n                item.pubDate = timezone(parseDate(detailResponse.data.match(/于 (.*) 已读/)[1], 'YYYY-MM-DD h:m'), +8);\r\n                item.description = content('pre')\r\n                    .html()\r\n                    .replaceAll('<p></p>', '')\r\n                    .replaceAll(/<font color=\"#E6E6DD\">6park.com<\\/font>/g, '');\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAaA,EAAe,CACxB,KAAM,+BACN,KAAM,KACN,YAAa,CAAC,UAAW,WACzB,UACA,QAAS,eACT,WAAY,CAAE,GAAI,iBAAkB,KAAM,yBAA0B,QAAS,eAC7E,MAAO,CACH,CACI,OAAQ,CAAC,kCAAmC,sBAC5C,OAAQ,UAGhB,YAAa;;saAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,OAAS,QAC5B,EAAO,EAAI,IAAI,MAAM,SAAW,GAChC,EAAU,EAAI,IAAI,MAAM,YAAc,GAEtC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GAE3E,EAAU,4BACV,EAAW,GAAG,EAAQ,GAAG,EAAG,YAC5B,EAAa,GAAG,IAAW,IAAS,IAAM,IAAY,GAAK,GAAK,IAAS,OAAS,sBAAwB,6CAA6C,EAAK,GAAG,EAAQ,UAAU,IAAS,OAAS,KAAO,WAE1M,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAEpB,EAAQ,EAAE,mDACT,UACA,MAAM,EAAG,GACT,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAI,EAAK,KAAK,KAAK,QAEzB,MAAO,CACH,KAAM,GAAG,EAAQ,GAAG,EAAG,GAAG,EAAE,KAAK,aA2B7C,MAvBA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGR,EAAU,EAAK,EAAe,MAUpC,MARA,GAAK,MAAQ,EAAQ,SAAS,OAAO,QAAQ,cAAe,IAC5D,EAAK,OAAS,EAAe,KAAK,MAAM,qBAAqB,GAC7D,EAAK,QAAU,EAAS,EAAU,EAAe,KAAK,MAAM,aAAa,GAAI,kBAAmB,GAChG,EAAK,YAAc,EAAQ,OACtB,OACA,WAAW,UAAW,IACtB,WAAW,2CAA4C,IAErD,MAKZ,CACH,MAAO,EAAE,SAAS,OAClB,KAAM,EACN,KAAM"}