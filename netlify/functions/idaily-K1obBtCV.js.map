{"version":3,"file":"idaily-K1obBtCV.js","names":[],"sources":["../../lib/routes/idaily/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: ['/:language?'],\r\n    name: '每日环球视野',\r\n    example: '/idaily',\r\n    maintainers: ['zphw', 'nczitzk'],\r\n    parameters: { language: '语言，见下表，默认为简体中文' },\r\n    radar: [\r\n        {\r\n            source: ['idai.ly/'],\r\n        },\r\n    ],\r\n    handler,\r\n    description: `| 简体中文 | 繁体中文 |\r\n| -------- | -------- |\r\n| zh-hans  | zh-hant  |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { language = 'zh-hans' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 100;\r\n\r\n    const rootUrl = 'https://idaily-cdn.idailycdn.com';\r\n    const apiUrl = new URL(`api/list/v3/iphone/${language}`, rootUrl).href;\r\n    const currentUrl = 'https://idai.ly';\r\n\r\n    const { data: response } = await got(apiUrl);\r\n\r\n    const items = response\r\n        .filter((item) => item.ui_sets?.caption_subtitle)\r\n        .slice(0, limit)\r\n        .map((item) => {\r\n            const image = item.ui_sets?.cover_landscape_hd_4k ?? item.cover_landscape_hd;\r\n\r\n            return {\r\n                title: `${item.ui_sets?.caption_subtitle} - ${item.title}`,\r\n                link: item.link_share,\r\n                description: art(path.join(__dirname, 'templates/description.art'), {\r\n                    images: image\r\n                        ? [\r\n                              {\r\n                                  src: image,\r\n                                  alt: item.ui_sets?.caption_subtitle ?? item.title,\r\n                              },\r\n                          ]\r\n                        : undefined,\r\n                    intro: item.content,\r\n                }),\r\n                author: item.location,\r\n                category: item.tags?.map((c) => c.name),\r\n                guid: `idaily-${item.guid}`,\r\n                pubDate: parseDate(item.pubdate_timestamp, 'X'),\r\n                updated: parseDate(item.lastupdate_timestamp, 'X'),\r\n                enclosure_url: image,\r\n                enclosure_type: `image/${image.split(/\\./).pop()}`,\r\n            };\r\n        });\r\n\r\n    const { data: currentResponse } = await got(currentUrl);\r\n\r\n    const $ = load(currentResponse);\r\n\r\n    const title = $('title').text();\r\n    const image = new URL('img/idaily/logo_2x.png', currentUrl).href;\r\n\r\n    return {\r\n        item: items,\r\n        title,\r\n        link: currentUrl,\r\n        description: $('meta[name=\"description\"]').prop('content'),\r\n        language: 'zh',\r\n        image,\r\n        subtitle: $('meta[name=\"keywords\"]').prop('content'),\r\n        author: title.split(/\\s/)[0],\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"oaAOA,MAAa,EAAe,CACxB,KAAM,CAAC,eACP,KAAM,SACN,QAAS,UACT,YAAa,CAAC,OAAQ,WACtB,WAAY,CAAE,SAAU,kBACxB,MAAO,CACH,CACI,OAAQ,CAAC,cAGjB,UACA,YAAa;;0BAKjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,WAAc,EAAI,IAAI,QACnC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,IAG/E,EAAS,IAAI,IAAI,sBAAsB,IAAY,oCAAS,KAC5D,EAAa,kBAEb,CAAE,KAAM,GAAa,MAAM,EAAI,GAE/B,EAAQ,EACT,OAAQ,GAAS,EAAK,SAAS,kBAC/B,MAAM,EAAG,GACT,IAAK,GAAS,CACX,IAAM,EAAQ,EAAK,SAAS,uBAAyB,EAAK,mBAE1D,MAAO,CACH,MAAO,GAAG,EAAK,SAAS,iBAAiB,KAAK,EAAK,QACnD,KAAM,EAAK,WACX,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,OAAQ,EACF,CACI,CACI,IAAK,EACL,IAAK,EAAK,SAAS,kBAAoB,EAAK,QAGpD,IAAA,GACN,MAAO,EAAK,UAEhB,OAAQ,EAAK,SACb,SAAU,EAAK,MAAM,IAAK,GAAM,EAAE,MAClC,KAAM,UAAU,EAAK,OACrB,QAAS,EAAU,EAAK,kBAAmB,KAC3C,QAAS,EAAU,EAAK,qBAAsB,KAC9C,cAAe,EACf,eAAgB,SAAS,EAAM,MAAM,MAAM,WAIjD,CAAE,KAAM,GAAoB,MAAM,EAAI,GAEtC,EAAI,EAAK,GAET,EAAQ,EAAE,SAAS,OACnB,EAAQ,IAAI,IAAI,yBAA0B,GAAY,KAE5D,MAAO,CACH,KAAM,EACN,QACA,KAAM,EACN,YAAa,EAAE,4BAA4B,KAAK,WAChD,SAAU,KACV,QACA,SAAU,EAAE,yBAAyB,KAAK,WAC1C,OAAQ,EAAM,MAAM,MAAM,GAC1B,WAAY"}