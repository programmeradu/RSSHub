import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import"./md5-4BNsOP-F.js";import"./ofetch-Bzt0BXUH.js";import{got_default as n}from"./got-CdvI2yKX.js";import{config_not_found_default as r}from"./config-not-found-BVqhRP9D.js";import{processImage as i}from"./utils-DNrWGW3Z.js";const a={path:`/timeline`,categories:[`social-media`],example:`/zhihu/timeline`,parameters:{},features:{requireConfig:[{name:`ZHIHU_COOKIES`,description:``}],requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`用户关注时间线`,maintainers:[`SeanChao`],handler:o,description:`::: warning
  用户关注动态需要登录后的 Cookie 值，所以只能自建，详情见部署页面的配置模块。
:::`};async function o(a){let o=e.zhihu.cookies;if(o===void 0)throw new r(`缺少知乎用户登录后的 Cookie 值`);let s=await n({method:`get`,url:`https://www.zhihu.com/api/v3/moments`,headers:{Cookie:o},searchParams:{desktop:!0,limit:a.req.query(`limit`)?Number.parseInt(a.req.query(`limit`)):15}}),c=s.data.data,l=`https://zhihu.com`,u=e=>{if(!e||!e.target||!e.target.type)return``;let t=e.target.id;switch(e.target.type){case`answer`:{let n=e.target.question.id;return`${l}/question/${n}/answer/${t}`}case`pin`:case`article`:return e.target.url;case`question`:return`${l}/question/${t}`;default:return}},d=e=>e.find(e=>e!=null),f=e=>{let t=e.actors;return t?t.map(e=>e.name).join(`, `):``},p=e=>!e||!Array.isArray(e)?e:e.map(e=>e.content).filter(e=>!!e&&typeof e==`string`).map(e=>`<div>${e}</div>`).join(``),m=e=>{if(!e||!e.target)return{};let n=u(e);return{title:`${e.action_text_tpl.replace(`{}`,f(e))}: ${d([e.target.title,e.target.question?e.target.question.title:``])}`,description:i(`<div>${d([e.target.content_html,p(e.target.content),e.target.detail,e.target.excerpt,``])}</div>`),pubDate:t(e.updated_time*1e3),link:n,author:e.target.author?e.target.author.name:``,guid:n,category:[e.verb]}},h=c.filter(e=>e.verb).map(e=>{if(e&&e.type&&e.type===`feed_group`){let n=e.group_text.replace(`{LIST_COUNT}`,e.list.length),r=e.list&&Array.isArray(e.list)?e.list.map(e=>m(e)).map(e=>`<a href="${e.link}"><b>${e.title}</b></a><br><p>${e.description}</p><br>`).join(``):``,i=e.list&&Array.isArray(e.list)&&e.list.length>0?t(e.list[0].updated_time*1e3):new Date,a=e.link;return{title:n,description:r,pubDate:i,guid:a,category:[e.verb]}}return m(e)});return{title:`知乎关注动态`,link:`https://www.zhihu.com/follow`,item:h}}export{a as route};
//# sourceMappingURL=timeline-CtjE5Mhr.js.map