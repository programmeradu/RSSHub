{"version":3,"file":"jwc-D6clFCQw.js","names":["route: Route","got","cache","$"],"sources":["../../lib/routes/ecnu/jwc.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst type = (filename) => filename.split('.').pop();\r\n\r\nexport const route: Route = {\r\n    path: '/jwc',\r\n    categories: ['university'],\r\n    example: '/ecnu/jwc',\r\n    radar: [\r\n        {\r\n            source: ['www.jwc.ecnu.edu.cn'],\r\n            target: '/tzgg',\r\n        },\r\n        {\r\n            source: ['www.ecnu.edu.cn'],\r\n            target: '/tzgg',\r\n        },\r\n    ],\r\n    name: '教务处通知',\r\n    maintainers: ['markbang'],\r\n    handler: async () => {\r\n        const baseUrl = 'http://www.jwc.ecnu.edu.cn/';\r\n\r\n        const response = await got(`${baseUrl}tzggwwxsgg/list.htm`);\r\n        const $ = load(response.data);\r\n        const links = $('.col_news_con ul.news_list > li')\r\n            .toArray()\r\n            .map((el) => ({\r\n                pubDate: timezone(parseDate($(el).find('.news_date').text()), 8),\r\n                link: new URL($(el).find('a').attr('href'), baseUrl).toString(),\r\n                title: $(el).find('a').text(),\r\n            }));\r\n        const items = await Promise.all(\r\n            links.map((item) =>\r\n                cache.tryGet(item.link, async () => {\r\n                    if (type(item.link) === 'htm') {\r\n                        try {\r\n                            const { data } = await got(item.link, {\r\n                                https: {\r\n                                    rejectUnauthorized: false,\r\n                                },\r\n                            });\r\n                            const $ = load(data);\r\n                            item.description = $('div.article')?.html()?.replaceAll('src=\"/', `src=\"${baseUrl}/`)?.replaceAll('href=\"/', `href=\"${baseUrl}/`)?.trim();\r\n                            return item;\r\n                        } catch {\r\n                            // intranet\r\n                            item.description = '请进行统一身份认证之后再访问';\r\n                            return item;\r\n                        }\r\n                    } else {\r\n                        // file to download\r\n                        item.description = '点击认证后访问内容';\r\n                        return item;\r\n                    }\r\n                })\r\n            )\r\n        );\r\n\r\n        return {\r\n            title: '教务处通知',\r\n            link: 'http://www.jwc.ecnu.edu.cn/tzggwwxsgg/list.htm',\r\n            item: items,\r\n        };\r\n    },\r\n};\r\n"],"mappings":"0ZAOA,MAAM,EAAQ,GAAa,EAAS,MAAM,KAAK,MAElCA,EAAe,CACxB,KAAM,OACN,WAAY,CAAC,cACb,QAAS,YACT,MAAO,CACH,CACI,OAAQ,CAAC,uBACT,OAAQ,SAEZ,CACI,OAAQ,CAAC,mBACT,OAAQ,UAGhB,KAAM,QACN,YAAa,CAAC,YACd,QAAS,SAAY,CACjB,IAAM,EAAU,8BAEV,EAAW,MAAMC,EAAI,GAAG,EAAQ,sBAChC,EAAI,EAAK,EAAS,MAClB,EAAQ,EAAE,mCACX,UACA,IAAK,IAAQ,CACV,QAAS,EAAS,EAAU,EAAE,GAAI,KAAK,cAAc,QAAS,GAC9D,KAAM,IAAI,IAAI,EAAE,GAAI,KAAK,KAAK,KAAK,QAAS,GAAS,WACrD,MAAO,EAAE,GAAI,KAAK,KAAK,UAEzB,EAAQ,MAAM,QAAQ,IACxB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,EAAK,EAAK,QAAU,MACpB,GAAI,CACA,GAAM,CAAE,QAAS,MAAMD,EAAI,EAAK,KAAM,CAClC,MAAO,CACH,mBAAoB,MAGtBE,EAAI,EAAK,GAEf,MADA,GAAK,YAAcA,EAAE,gBAAgB,QAAQ,WAAW,SAAU,QAAQ,EAAQ,KAAK,WAAW,UAAW,SAAS,EAAQ,KAAK,OAC5H,OACH,CAGJ,MADA,GAAK,YAAc,iBACZ,OAKX,MADA,GAAK,YAAc,YACZ,MAMvB,MAAO,CACH,MAAO,QACP,KAAM,iDACN,KAAM"}