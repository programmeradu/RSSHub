{"version":3,"file":"category-4LYtGNG2.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/qq/weread/category.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nexport const route: Route = {\r\n    path: '/weread/:category',\r\n    categories: ['new-media'],\r\n    example: '/qq/weread/newbook',\r\n    parameters: {\r\n        category: '榜单名，见下表',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '微信读书榜单',\r\n    maintainers: ['gogo-100'],\r\n    handler,\r\n    description: `| 榜单                  | 榜单名     |\r\n| ---------------------- | ---------- |\r\n| Top50飙升榜           | rising     |\r\n| Top50热搜榜           | hot_search |\r\n| Top50新书榜           | newbook    |\r\n| Top50小说榜           | general_novel_rising |\r\n| Top200总榜            | all        |\r\n| 神作榜                 | newrating_publish |\r\n| 神作潜力榜            | newrating_potential_publish |\r\n| 精品小说              | 100000     |\r\n| 历史                  | 200000     |\r\n| 文学                  | 300000     |\r\n| 艺术                  | 400000     |\r\n| 人物传记              | 500000     |\r\n| 哲学宗教              | 600000     |\r\n| 计算机                | 700000     |\r\n| 心理                  | 800000     |\r\n| 社会文化              | 900000     |\r\n| 个人成长              | 1000000    |\r\n| 经济理财              | 1100000    |\r\n| 政治军事              | 1200000    |\r\n| 童书                  | 1300000    |\r\n| 教育学习              | 1400000    |\r\n| 科学技术              | 1500000    |\r\n| 生活百科              | 1600000    |\r\n| 期刊杂志              | 1700000    |\r\n| 原版书                | 1800000    |\r\n| 男生小说              | 1900000    |\r\n| 女生小说              | 2000000    |\r\n| 医学健康              | 2100000    |\r\n\r\n还可以分得更细 见 https://weread.qq.com/web/category/100000 的小标题栏\r\n`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category');\r\n\r\n    // 检查 category 是否是榜单，若否则全部为阿拉伯数字\r\n    const isRank = /^\\d+$/.test(category) ? 0 : 1;\r\n\r\n    const LIMIT = category === 'all' ? 180 : 40;\r\n    const SIZE = 20;\r\n\r\n    const urls = Array.from({ length: Math.ceil((LIMIT + 1) / SIZE) }, (_, index) => `https://weread.qq.com/web/bookListInCategory/${category}?maxIndex=${index * SIZE}&rank=${isRank}`);\r\n\r\n    const responses = await Promise.all(urls.map((url) => ofetch(url)));\r\n\r\n    const results = responses.flatMap((response) =>\r\n        response.books.map((book) => {\r\n            const bookInfo = book.bookInfo;\r\n            return {\r\n                title: bookInfo.title,\r\n                description: `推荐值 ${bookInfo.newRating / 10}% ${bookInfo.newRatingDetail.title}|| ` + bookInfo.intro,\r\n                author: bookInfo.author,\r\n                guid: bookInfo.bookId,\r\n                itunes_item_image: bookInfo.cover,\r\n            };\r\n        })\r\n    );\r\n\r\n    const title = categoryTitles[category] || '书籍列表';\r\n    return {\r\n        title: '微信读书 - ' + title,\r\n        link: `https://weread.qq.com/web/category/${category}`,\r\n        item: results,\r\n    };\r\n}\r\n\r\nconst categoryTitles = {\r\n    rising: 'Top50飙升榜',\r\n    hot_search: 'Top50热搜榜',\r\n    newbook: 'Top50新书榜',\r\n    general_novel_rising: 'Top50小说榜',\r\n    all: 'Top200总榜',\r\n    newrating_publish: '神作榜',\r\n    newrating_potential_publish: '神作潜力榜',\r\n    '100000': '精品小说',\r\n    '200000': '历史',\r\n    '300000': '文学',\r\n    '400000': '艺术',\r\n    '500000': '人物传记',\r\n    '600000': '哲学宗教',\r\n    '700000': '计算机',\r\n    '800000': '心理',\r\n    '900000': '社会文化',\r\n    '1000000': '个人成长',\r\n    '1100000': '经济理财',\r\n    '1200000': '政治军事',\r\n    '1300000': '童书',\r\n    '1400000': '教育学习',\r\n    '1500000': '科学技术',\r\n    '1600000': '生活百科',\r\n    '1700000': '期刊杂志',\r\n    '1800000': '原版书',\r\n    '1900000': '男生小说',\r\n    '2000000': '女生小说',\r\n    '2100000': '医学健康',\r\n};\r\n"],"mappings":"2KAGA,MAAaA,EAAe,CACxB,KAAM,oBACN,WAAY,CAAC,aACb,QAAS,qBACT,WAAY,CACR,SAAU,WAEd,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,YACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAmCjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YAGzB,EAAS,QAAQ,KAAK,GAAY,EAAI,EAEtC,EAAQ,IAAa,MAAQ,IAAM,GAGnC,EAAO,MAAM,KAAK,CAAE,OAAQ,KAAK,MAAM,EAAQ,GAAK,MAAU,EAAG,IAAU,gDAAgD,EAAS,YAAY,EAAQ,GAAK,QAAQ,KAErK,EAAY,MAAM,QAAQ,IAAI,EAAK,IAAK,GAAQC,EAAO,KAEvD,EAAU,EAAU,QAAS,GAC/B,EAAS,MAAM,IAAK,GAAS,CACzB,IAAM,EAAW,EAAK,SACtB,MAAO,CACH,MAAO,EAAS,MAChB,YAAa,OAAO,EAAS,UAAY,GAAG,IAAI,EAAS,gBAAgB,MAAM,KAAO,EAAS,MAC/F,OAAQ,EAAS,OACjB,KAAM,EAAS,OACf,kBAAmB,EAAS,UAKlC,EAAQ,EAAe,IAAa,OAC1C,MAAO,CACH,MAAO,UAAY,EACnB,KAAM,sCAAsC,IAC5C,KAAM,GAId,MAAM,EAAiB,CACnB,OAAQ,WACR,WAAY,WACZ,QAAS,WACT,qBAAsB,WACtB,IAAK,WACL,kBAAmB,MACnB,4BAA6B,QAC7B,IAAU,OACV,IAAU,KACV,IAAU,KACV,IAAU,KACV,IAAU,OACV,IAAU,OACV,IAAU,MACV,IAAU,KACV,IAAU,OACV,IAAW,OACX,KAAW,OACX,KAAW,OACX,KAAW,KACX,KAAW,OACX,KAAW,OACX,KAAW,OACX,KAAW,OACX,KAAW,MACX,KAAW,OACX,IAAW,OACX,KAAW"}