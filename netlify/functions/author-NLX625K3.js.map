{"version":3,"file":"author-NLX625K3.js","names":["route: Route","cache","ofetch"],"sources":["../../lib/routes/inspirehep/author.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { AuthorResponse, LiteratureResponse } from './types';\r\nimport cache from '@/utils/cache';\r\n\r\nimport { baseUrl, parseLiterature } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/authors/:id',\r\n    example: '/inspirehep/authors/1696909',\r\n    parameters: { id: 'Author ID' },\r\n    name: 'Author Search',\r\n    maintainers: ['TonyRL'],\r\n    radar: [\r\n        {\r\n            source: ['inspirehep.net/authors/:id'],\r\n        },\r\n    ],\r\n    handler,\r\n};\r\n\r\nexport const getAuthorById = (id: string) =>\r\n    cache.tryGet(`inspirehep:author:${id}`, () =>\r\n        ofetch<AuthorResponse>(`${baseUrl}/api/authors/${id}`, {\r\n            headers: {\r\n                accept: 'application/vnd+inspire.record.ui+json',\r\n            },\r\n            parseResponse: JSON.parse,\r\n        })\r\n    );\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 25;\r\n\r\n    const authorInfo = (await getAuthorById(id)) as AuthorResponse;\r\n    const response = await ofetch<LiteratureResponse>(`${baseUrl}/api/literature`, {\r\n        query: {\r\n            sort: 'mostrecent',\r\n            size: limit,\r\n            page: 1,\r\n            search_type: 'hep-author-publication',\r\n            author: authorInfo.metadata.facet_author_name,\r\n        },\r\n    });\r\n\r\n    const items = parseLiterature(response.hits.hits);\r\n\r\n    return {\r\n        title: `${authorInfo.metadata.name.preferred_name} - INSPIRE`,\r\n        link: `${baseUrl}/authors/${id}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mUAOA,MAAaA,EAAe,CACxB,KAAM,eACN,QAAS,8BACT,WAAY,CAAE,GAAI,aAClB,KAAM,gBACN,YAAa,CAAC,UACd,MAAO,CACH,CACI,OAAQ,CAAC,gCAGjB,WAGS,EAAiB,GAC1BC,EAAM,OAAO,qBAAqB,QAC9BC,EAAuB,GAAG,EAAQ,eAAe,IAAM,CACnD,QAAS,CACL,OAAQ,0CAEZ,cAAe,KAAK,SAIhC,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GAE3E,EAAc,MAAM,EAAc,GAClC,EAAW,MAAMA,EAA2B,GAAG,EAAQ,iBAAkB,CAC3E,MAAO,CACH,KAAM,aACN,KAAM,EACN,KAAM,EACN,YAAa,yBACb,OAAQ,EAAW,SAAS,qBAI9B,EAAQ,EAAgB,EAAS,KAAK,MAE5C,MAAO,CACH,MAAO,GAAG,EAAW,SAAS,KAAK,eAAe,YAClD,KAAM,GAAG,EAAQ,WAAW,IAC5B,KAAM"}