{"version":3,"file":"dyh-Qt5AktSi.js","names":["route: Route","utils","got","InvalidParameterError"],"sources":["../../lib/routes/coolapk/dyh.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport utils from './utils';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: '/dyh/:dyhId',\r\n    categories: ['social-media'],\r\n    example: '/coolapk/dyh/1524',\r\n    parameters: { dyhId: '看看号ID' },\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'ALLOW_USER_HOTLINK_TEMPLATE',\r\n                optional: true,\r\n                description: '设置为`true`并添加`image_hotlink_template`参数来代理图片',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '看看号',\r\n    maintainers: ['xizeyoupan'],\r\n    handler,\r\n    description: `::: tip\r\n  仅限于采集**站内订阅**的看看号的内容。看看号 ID 可在看看号界面右上分享 - 复制链接得到。\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const dyhId = ctx.req.param('dyhId');\r\n    const full_url = utils.base_url + `/v6/dyhArticle/list?dyhId=${dyhId}&type=all&page=1`;\r\n    const r = await got(`${utils.base_url}/v6/dyh/detail?dyhId=${dyhId}`, {\r\n        headers: utils.getHeaders(),\r\n    });\r\n    let targetTitle = r.data.data.title;\r\n    const feedDescription = r.data.data.description;\r\n    const response = await got(full_url, {\r\n        headers: utils.getHeaders(),\r\n    });\r\n    const data = response.data.data;\r\n\r\n    let out = await Promise.all(\r\n        data.map((item) => {\r\n            if (!targetTitle) {\r\n                targetTitle = item.targetRow.title;\r\n            }\r\n\r\n            return utils.parseDynamic(item);\r\n        })\r\n    );\r\n\r\n    out = out.filter(Boolean); // 去除空值\r\n    if (out.length === 0) {\r\n        throw new InvalidParameterError('仅限于采集站内订阅的看看号的图文及动态内容。这个ID可能是站外订阅。');\r\n    }\r\n    return {\r\n        title: `酷安看看号-${targetTitle}`,\r\n        link: `https://www.coolapk.com/dyh/${dyhId}`,\r\n        description: feedDescription,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"ubAKA,MAAaA,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,gBACb,QAAS,oBACT,WAAY,CAAE,MAAO,SACrB,SAAU,CACN,cAAe,CACX,CACI,KAAM,8BACN,SAAU,GACV,YAAa,gDAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,MACN,YAAa,CAAC,cACd,UACA,YAAa;;MAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAQ,EAAI,IAAI,MAAM,SACtB,EAAWC,EAAM,SAAW,6BAA6B,EAAM,kBAC/D,EAAI,MAAMC,EAAI,GAAGD,EAAM,SAAS,uBAAuB,IAAS,CAClE,QAASA,EAAM,eAEf,EAAc,EAAE,KAAK,KAAK,MACxB,EAAkB,EAAE,KAAK,KAAK,YAC9B,EAAW,MAAMC,EAAI,EAAU,CACjC,QAASD,EAAM,eAEb,EAAO,EAAS,KAAK,KAEvB,EAAM,MAAM,QAAQ,IACpB,EAAK,IAAK,IACD,IACD,EAAc,EAAK,UAAU,OAG1BA,EAAM,aAAa,MAKlC,GADA,EAAM,EAAI,OAAO,SACb,EAAI,SAAW,EACf,MAAM,IAAIE,EAAsB,sCAEpC,MAAO,CACH,MAAO,SAAS,IAChB,KAAM,+BAA+B,IACrC,YAAa,EACb,KAAM"}