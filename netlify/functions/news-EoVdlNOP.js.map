{"version":3,"file":"news-EoVdlNOP.js","names":[],"sources":["../../lib/routes/nikkei/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:category/:article_type?',\r\n    categories: ['traditional-media'],\r\n    example: '/nikkei/news/news',\r\n    parameters: { category: 'Category, see table below', article_type: 'Only includes free articles, set `free` to enable, disabled by default' },\r\n    radar: [\r\n        {\r\n            source: ['www.nikkei.com/:category/archive', 'www.nikkei.com/:category'],\r\n            target: '/:category',\r\n        },\r\n    ],\r\n    name: 'News',\r\n    maintainers: ['Arracc', 'ladeng07'],\r\n    handler,\r\n    description: `| 総合 | オピニオン | 経済    | 政治     | 金融      | マーケット | ビジネス | マネーのまなび | テック     | 国際          | スポーツ | 社会・調査 | 地域  | 文化    | ライフスタイル |\r\n| ---- | ---------- | ------- | -------- | --------- | ---------- | -------- | -------------- | ---------- | ------------- | -------- | ---------- | ----- | ------- | -------------- |\r\n| news | opinion    | economy | politics | financial | business   | 不支持   | 不支持         | technology | international | sports   | society    | local | culture | lifestyle      |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://www.nikkei.com';\r\n    const { category, article_type = 'paid' } = ctx.req.param();\r\n    let url = '';\r\n    url = category === 'news' ? `${baseUrl}/news/category/` : `${baseUrl}/${category}/archive/`;\r\n\r\n    const response = await got(url);\r\n    const data = response.data;\r\n    const $ = load(data);\r\n\r\n    let categoryName = '';\r\n    const listSelector = $('[class^=\"container_\"]  [class^=\"default_\"]:has(article)');\r\n    const paidSelector = 'img[class^=\"icon_\"]';\r\n\r\n    let list = listSelector.toArray().map((item) => {\r\n        item = $(item);\r\n        item.find('p a').remove();\r\n        return {\r\n            title: item.find('[class^=\"titleLink_\"]').text(),\r\n            link: `${baseUrl}${item.find('[class^=\"title_\"] a').attr('href')}`,\r\n            image: item.find('[class^=\"image_\"] img').removeAttr('style').removeAttr('width').removeAttr('height').parent().html(),\r\n            category: item\r\n                .find('[class^=\"topicItem_\"] a')\r\n                .toArray()\r\n                .map((item) => $(item).text()),\r\n            paywall: !!item.find(paidSelector).length,\r\n        };\r\n    });\r\n\r\n    if (category === 'news') {\r\n        categoryName = '総合';\r\n        list = [\r\n            ...list,\r\n            ...$('div#CONTENTS_MAIN .m-miM32_itemTitle')\r\n                .toArray()\r\n                .map((item) => {\r\n                    item = $(item);\r\n                    const a = item.find('a').first();\r\n                    return {\r\n                        title: a.text(),\r\n                        link: `${baseUrl}${a.attr('href')}`,\r\n                        category: item\r\n                            .find('.m-miM32_itemkeyword a')\r\n                            .toArray()\r\n                            .map((item) => $(item).text()),\r\n                        paywall: !!item.find(paidSelector).length,\r\n                    };\r\n                }),\r\n        ];\r\n    } else {\r\n        categoryName = $('h1.l-miH11_title').text().trim();\r\n    }\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n\r\n                $('.notFloated_n1oadkwi').remove();\r\n\r\n                item.pubDate = parseDate($('meta[property=\"article:published_time\"]').attr('content'));\r\n                item.description = art(path.join(__dirname, 'templates/news.art'), {\r\n                    item,\r\n                    description: $('section[class^=container_]').html(),\r\n                });\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '日本経済新聞 - ' + categoryName,\r\n        description: $('meta[name=\"description\"]').attr('content'),\r\n        link: url,\r\n        image: $('meta[property=\"og:image\"]').attr('content'),\r\n        language: 'ja',\r\n        item: article_type === 'free' ? items.filter((item) => !item.paywall) : items,\r\n    };\r\n}\r\n"],"mappings":"wdASA,MAAa,EAAe,CACxB,KAAM,iCACN,WAAY,CAAC,qBACb,QAAS,oBACT,WAAY,CAAE,SAAU,4BAA6B,aAAc,0EACnE,MAAO,CACH,CACI,OAAQ,CAAC,mCAAoC,4BAC7C,OAAQ,eAGhB,KAAM,OACN,YAAa,CAAC,SAAU,YACxB,UACA,YAAa;;oLAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,yBACV,CAAE,WAAU,eAAe,QAAW,EAAI,IAAI,QAChD,EAAM,GACV,EAAM,IAAa,OAAS,GAAG,EAAQ,iBAAmB,GAAG,EAAQ,GAAG,EAAS,WAEjF,IAAM,EAAW,MAAM,EAAI,GACrB,EAAO,EAAS,KAChB,EAAI,EAAK,GAEX,EAAe,GACb,EAAe,EAAE,2DACjB,EAAe,sBAEjB,EAAO,EAAa,UAAU,IAAK,IACnC,EAAO,EAAE,GACT,EAAK,KAAK,OAAO,SACV,CACH,MAAO,EAAK,KAAK,yBAAyB,OAC1C,KAAM,GAAG,IAAU,EAAK,KAAK,uBAAuB,KAAK,UACzD,MAAO,EAAK,KAAK,yBAAyB,WAAW,SAAS,WAAW,SAAS,WAAW,UAAU,SAAS,OAChH,SAAU,EACL,KAAK,2BACL,UACA,IAAK,GAAS,EAAE,GAAM,QAC3B,QAAS,CAAC,CAAC,EAAK,KAAK,GAAc,UAIvC,IAAa,QACb,EAAe,KACf,EAAO,CACH,GAAG,EACH,GAAG,EAAE,wCACA,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAI,EAAK,KAAK,KAAK,QACzB,MAAO,CACH,MAAO,EAAE,OACT,KAAM,GAAG,IAAU,EAAE,KAAK,UAC1B,SAAU,EACL,KAAK,0BACL,UACA,IAAK,GAAS,EAAE,GAAM,QAC3B,QAAS,CAAC,CAAC,EAAK,KAAK,GAAc,YAKnD,EAAe,EAAE,oBAAoB,OAAO,OAGhD,IAAM,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACN,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAa,MAAM,EAAI,EAAK,MACpC,EAAI,EAAK,GAUf,OARA,EAAE,wBAAwB,SAE1B,EAAK,QAAU,EAAU,EAAE,2CAA2C,KAAK,YAC3E,EAAK,YAAc,EAAI,EAAA,KAAA,EAAA,+BAA4C,CAC/D,OACA,YAAa,EAAE,8BAA8B,SAG1C,MAKnB,MAAO,CACH,MAAO,YAAc,EACrB,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,EACN,MAAO,EAAE,6BAA6B,KAAK,WAC3C,SAAU,KACV,KAAM,IAAiB,OAAS,EAAM,OAAQ,GAAS,CAAC,EAAK,SAAW"}