import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as a}from"./got-CdvI2yKX.js";import o from"node:path";import{load as s}from"cheerio";t();const c={path:`/:region?/:category{.+}?`,name:`Unknown`,maintainers:[],handler:l};async function l(t){let{region:c=`cn-en`,category:l=`news`}=t.req.param(),u=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):30,d=`https://www.kantarworldpanel.com/`,f=new URL(`${c}/${l}`,d).href,{data:p}=await a(f),m=s(p),h=m(`ul.slide, #newssource`).find(`li`).slice(0,u).toArray().map(t=>{t=m(t);let n=t.find(`a`),a=t.find(`img`),s=t.find(`h3.mediumFont`).text().trim(),c=n.prop(`href`);return c=c===`#`?f:c,{title:s,link:c,description:r(o.join(e,`templates/description-921130b5.art`),{description:t.find(`p.gowhite`).text(),image:a.prop(`src`)?{src:a.prop(`src`),alt:a.prop(`alt`)}:void 0}),guid:c.startsWith(d)?`${c}#${s}`:c,pubDate:i(t.find(`p.medGrey`).text(),`DD/MM/YYYY`)}});h=await Promise.all(h.map(e=>n.tryGet(e.link,async()=>{if(e.link===f||!e.link.startsWith(d))return e;if(/dwl\.php/.test(e.link))return e.enclosure_url=e.link,e.enclosure_type=`application/pdf`,e;let t=await a(e.link);if(!t.url.startsWith(d))return e;let n=s(t.data);return e.title=n(`h1.newshead`).text(),e.description=n(`div.center-content div.left-layout-col`).html(),e.category=n(`meta[name="keywords"]`).prop(`content`)?.split(/,\s?/)??[],e.pubDate=i(n(`p.newsdateshare`).text(),`DD/MM/YYYY`),e})));let g=new URL(`favicon.ico`,d).href;return{item:h,title:m(`title`).text(),link:f,description:m(`meta[name="description"]`).prop(`content`),language:m(`html`).prop(`lang`),image:m(`#logoprint img`).prop(`src`),icon:g,logo:g,subtitle:m(`meta[name="keywords"]`).prop(`content`),allowEmpty:!0}}export{c as route};
//# sourceMappingURL=kantarworldpanel-D_ymubRw.js.map