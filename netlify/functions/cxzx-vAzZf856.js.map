{"version":3,"file":"cxzx-vAzZf856.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/jsu/cxzx.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\n// 导入必要的模组\r\nimport got from '@/utils/got'; // 自订的 got\r\nimport { load } from 'cheerio'; // 可以使用类似 jQuery 的 API HTML 解析器\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { getPageItemAndDate } from './utils/index';\r\n\r\nexport const route: Route = {\r\n    path: '/cxzx/:types?',\r\n    name: 'Unknown',\r\n    maintainers: ['wenjia03'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    // 在此处编写您的逻辑\r\n    const { types = 'xkjs' } = ctx.req.param();\r\n    const baseUrl = 'https://cxzx.jsu.edu.cn/';\r\n    const urls = {\r\n        tzgg: {\r\n            url: 'https://cxzx.jsu.edu.cn/xwzx.htm',\r\n            title: '通知公告',\r\n        }, // 通知公告页面\r\n        xkjs: {\r\n            url: 'https://cxzx.jsu.edu.cn/xwzx/zxdt.htm',\r\n            title: '学科竞赛公告',\r\n        },\r\n        cxtz: {\r\n            url: 'https://cxzx.jsu.edu.cn/cxlt/xsjz1.htm',\r\n            title: '创新项目公告',\r\n        },\r\n        jsxw: {\r\n            url: 'https://cxzx.jsu.edu.cn/cxjs.htm',\r\n            title: '竞赛新闻',\r\n        },\r\n        jstz: {\r\n            url: 'https://cxzx.jsu.edu.cn/cxjs/xkjs.htm',\r\n            title: '竞赛新闻 -> 通知公告',\r\n        },\r\n    };\r\n    // 获取页面中所有的 body > div.cx_big_container > div.cx_content_container > div.cx_right_part > div.cx_article_list_box > table > tbody > tr\r\n    const response = await got({\r\n        method: 'get',\r\n        url: urls[types].url,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n    const list = $('tr[height=\"20\"]').toArray();\r\n\r\n    const out = await Promise.all(\r\n        list.map((item) => {\r\n            item = $(item);\r\n            const link = new URL(item.find('td:nth-child(2) > a').attr('href'), baseUrl).href;\r\n            return cache.tryGet(link, async () => {\r\n                const title = item.find('td:nth-child(2) > a').text() || '无标题';\r\n\r\n                const category = urls[types].title;\r\n                const description = await getPageItemAndDate(\r\n                    '#vsb_newscontent',\r\n                    link,\r\n                    'body > div.cx_big_container > div.cx_content_container > div.cx_right_part > div.viewbox > form > table > tbody > tr:nth-child(1) > td',\r\n                    'body > div.cx_big_container > div.cx_content_container > div.cx_right_part > div.viewbox > form > table > tbody > tr:nth-child(2) > td > span.timestyle134612'\r\n                );\r\n                const pubDate = parseDate(description.date);\r\n                return {\r\n                    title,\r\n                    link,\r\n                    pubDate,\r\n                    description: description.pageInfo,\r\n                    category,\r\n                };\r\n            });\r\n        })\r\n    );\r\n\r\n    return {\r\n        // 在此处输出您的 RSS\r\n        title: `吉首大学创新中心 - ${urls[types].title}`,\r\n        link: urls[types].url,\r\n        description: '吉首大学创新中心',\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"iaAQA,MAAaA,EAAe,CACxB,KAAM,gBACN,KAAM,UACN,YAAa,CAAC,YACd,WAGJ,eAAe,EAAQ,EAAK,CAExB,GAAM,CAAE,QAAQ,QAAW,EAAI,IAAI,QAE7B,EAAO,CACT,KAAM,CACF,IAAK,mCACL,MAAO,QAEX,KAAM,CACF,IAAK,wCACL,MAAO,UAEX,KAAM,CACF,IAAK,yCACL,MAAO,UAEX,KAAM,CACF,IAAK,mCACL,MAAO,QAEX,KAAM,CACF,IAAK,wCACL,MAAO,iBAIT,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,EAAK,GAAO,MAGf,EAAI,EAAK,EAAS,MAClB,EAAO,EAAE,mBAAmB,UAE5B,EAAM,MAAM,QAAQ,IACtB,EAAK,IAAK,GAAS,CACf,EAAO,EAAE,GACT,IAAM,EAAO,IAAI,IAAI,EAAK,KAAK,uBAAuB,KAAK,QAAS,4BAAS,KAC7E,OAAOC,EAAM,OAAO,EAAM,SAAY,CAClC,IAAM,EAAQ,EAAK,KAAK,uBAAuB,QAAU,MAEnD,EAAW,EAAK,GAAO,MACvB,EAAc,MAAM,EACtB,mBACA,EACA,yIACA,iKAEE,EAAU,EAAU,EAAY,MACtC,MAAO,CACH,QACA,OACA,UACA,YAAa,EAAY,SACzB,iBAMhB,MAAO,CAEH,MAAO,cAAc,EAAK,GAAO,QACjC,KAAM,EAAK,GAAO,IAClB,YAAa,WACb,KAAM"}