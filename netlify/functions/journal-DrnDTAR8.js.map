{"version":3,"file":"journal-DrnDTAR8.js","names":[],"sources":["../../lib/routes/acs/journal.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { config } from '@/config';\r\nimport puppeteer from '@/utils/puppeteer';\r\n\r\nexport const route: Route = {\r\n    path: '/journal/:id',\r\n    radar: [\r\n        {\r\n            source: ['pubs.acs.org/journal/:id', 'pubs.acs.org/'],\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id') ?? '';\r\n\r\n    const rootUrl = 'https://pubs.acs.org';\r\n    const currentUrl = `${rootUrl}/toc/${id}/0/0`;\r\n\r\n    let title = '';\r\n\r\n    const browser = await puppeteer();\r\n    const items = await cache.tryGet(\r\n        currentUrl,\r\n        async () => {\r\n            const page = await browser.newPage();\r\n            await page.setRequestInterception(true);\r\n            page.on('request', (request) => {\r\n                request.resourceType() === 'document' || request.resourceType() === 'script' ? request.continue() : request.abort();\r\n            });\r\n            await page.goto(currentUrl, {\r\n                waitUntil: 'domcontentloaded',\r\n            });\r\n            await page.waitForSelector('.toc');\r\n\r\n            const html = await page.evaluate(() => document.documentElement.innerHTML);\r\n            await page.close();\r\n\r\n            const $ = load(html);\r\n\r\n            title = $('meta[property=\"og:title\"]').attr('content');\r\n\r\n            return $('.issue-item')\r\n                .toArray()\r\n                .map((item) => {\r\n                    item = $(item);\r\n\r\n                    const a = item.find('.issue-item_title a');\r\n                    const doi = item.find('input[name=\"doi\"]').attr('value');\r\n\r\n                    return {\r\n                        doi,\r\n                        guid: doi,\r\n                        title: a.text(),\r\n                        link: `${rootUrl}${a.attr('href')}`,\r\n                        pubDate: parseDate(item.find('.pub-date-value').text(), 'MMMM D, YYYY'),\r\n                        author: item\r\n                            .find('.issue-item_loa li')\r\n                            .toArray()\r\n                            .map((a) => $(a).text())\r\n                            .join(', '),\r\n                        description: art(path.join(__dirname, 'templates/description.art'), {\r\n                            image: item.find('.issue-item_img').html(),\r\n                            description: item.find('.hlFld-Abstract').html(),\r\n                        }),\r\n                    };\r\n                });\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    );\r\n\r\n    await browser.close();\r\n\r\n    return {\r\n        title,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"2bAUA,MAAa,EAAe,CACxB,KAAM,eACN,MAAO,CACH,CACI,OAAQ,CAAC,2BAA4B,mBAG7C,KAAM,UACN,YAAa,CAAC,WACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,OAAS,GAE5B,EAAU,uBACV,EAAa,GAAG,EAAQ,OAAO,EAAG,MAEpC,EAAQ,GAEN,EAAU,MAAM,IAChB,EAAQ,MAAM,EAAM,OACtB,EACA,SAAY,CACR,IAAM,EAAO,MAAM,EAAQ,UAC3B,MAAM,EAAK,uBAAuB,IAClC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,YAAc,EAAQ,iBAAmB,SAAW,EAAQ,WAAa,EAAQ,UAEhH,MAAM,EAAK,KAAK,EAAY,CACxB,UAAW,qBAEf,MAAM,EAAK,gBAAgB,QAE3B,IAAM,EAAO,MAAM,EAAK,aAAe,SAAS,gBAAgB,WAChE,MAAM,EAAK,QAEX,IAAM,EAAI,EAAK,GAIf,MAFA,GAAQ,EAAE,6BAA6B,KAAK,WAErC,EAAE,eACJ,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAI,EAAK,KAAK,uBACd,EAAM,EAAK,KAAK,qBAAqB,KAAK,SAEhD,MAAO,CACH,MACA,KAAM,EACN,MAAO,EAAE,OACT,KAAM,GAAG,IAAU,EAAE,KAAK,UAC1B,QAAS,EAAU,EAAK,KAAK,mBAAmB,OAAQ,gBACxD,OAAQ,EACH,KAAK,sBACL,UACA,IAAK,GAAM,EAAE,GAAG,QAChB,KAAK,MACV,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,MAAO,EAAK,KAAK,mBAAmB,OACpC,YAAa,EAAK,KAAK,mBAAmB,aAK9D,EAAO,MAAM,YACb,IAKJ,OAFA,MAAM,EAAQ,QAEP,CACH,QACA,KAAM,EACN,KAAM"}