{"version":3,"file":"illustfollow-BWUtr3C1.js","names":["got","route: Route","ConfigNotFoundError","cache","getIllustFollows","pixivUtils"],"sources":["../../lib/routes/pixiv/api/get-illust-follows.ts","../../lib/routes/pixiv/illustfollow.ts"],"sourcesContent":["import got from '../pixiv-got';\r\nimport { maskHeader } from '../constants';\r\nimport queryString from 'query-string';\r\n\r\n/**\r\n * 获取用户关注的画师们的最新插画\r\n * @param {string} token pixiv oauth token\r\n * @returns {Promise<got.AxiosResponse<{illusts: illust[]}>>}\r\n */\r\nexport default function getUserIllustFollows(token) {\r\n    return got('https://app-api.pixiv.net/v2/illust/follow', {\r\n        headers: {\r\n            ...maskHeader,\r\n            Authorization: 'Bearer ' + token,\r\n        },\r\n        searchParams: queryString.stringify({\r\n            restrict: 'public',\r\n        }),\r\n    });\r\n}\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { getToken } from './token';\r\nimport getIllustFollows from './api/get-illust-follows';\r\nimport { config } from '@/config';\r\nimport pixivUtils from './utils';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nexport const route: Route = {\r\n    path: '/user/illustfollows',\r\n    categories: ['social-media'],\r\n    example: '/pixiv/user/illustfollows',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'PIXIV_REFRESHTOKEN',\r\n                description: '',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.pixiv.net/bookmark_new_illust.php'],\r\n        },\r\n    ],\r\n    name: 'Following timeline',\r\n    maintainers: ['ClarkeCheng'],\r\n    handler,\r\n    url: 'www.pixiv.net/bookmark_new_illust.php',\r\n    description: `::: warning\r\n  Only for self-hosted\r\n:::`,\r\n};\r\n\r\nasync function handler() {\r\n    if (!config.pixiv || !config.pixiv.refreshToken) {\r\n        throw new ConfigNotFoundError('pixiv RSS is disabled due to the lack of <a href=\"https://docs.rsshub.app/deploy/config#route-specific-configurations\">relevant config</a>');\r\n    }\r\n\r\n    const token = await getToken(cache.tryGet);\r\n    if (!token) {\r\n        throw new ConfigNotFoundError('pixiv not login');\r\n    }\r\n\r\n    const response = await getIllustFollows(token);\r\n    const illusts = response.data.illusts;\r\n    return {\r\n        title: `Pixiv关注的新作品`,\r\n        link: 'https://www.pixiv.net/bookmark_new_illust.php',\r\n        description: `Pixiv关注的画师们的最新作品`,\r\n        item: illusts.map((illust) => {\r\n            const images = pixivUtils.getImgs(illust);\r\n            return {\r\n                title: illust.title,\r\n                author: illust.user.name,\r\n                pubDate: parseDate(illust.create_date),\r\n                description: `${illust.caption}<br><p>画师：${illust.user.name} - 阅览数：${illust.total_view} - 收藏数：${illust.total_bookmarks}</p>${images.join('')}`,\r\n                link: `https://www.pixiv.net/artworks/${illust.id}`,\r\n                category: illust.tags.map((tag) => tag.name),\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"mhBASA,SAAwB,EAAqB,EAAO,CAChD,OAAOA,EAAI,6CAA8C,CACrD,QAAS,CACL,GAAG,EACH,cAAe,UAAY,GAE/B,aAAc,EAAY,UAAU,CAChC,SAAU,aCPtB,MAAaC,EAAe,CACxB,KAAM,sBACN,WAAY,CAAC,gBACb,QAAS,4BACT,WAAY,GACZ,SAAU,CACN,cAAe,CACX,CACI,KAAM,qBACN,YAAa,KAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,2CAGjB,KAAM,qBACN,YAAa,CAAC,eACd,UACA,IAAK,wCACL,YAAa;;MAKjB,eAAe,GAAU,CACrB,GAAI,CAAC,EAAO,OAAS,CAAC,EAAO,MAAM,aAC/B,MAAM,IAAIC,EAAoB,8IAGlC,IAAM,EAAQ,MAAM,EAASC,EAAM,QACnC,GAAI,CAAC,EACD,MAAM,IAAID,EAAoB,mBAGlC,IAAM,EAAW,MAAME,EAAiB,GAClC,EAAU,EAAS,KAAK,QAC9B,MAAO,CACH,MAAO,cACP,KAAM,gDACN,YAAa,mBACb,KAAM,EAAQ,IAAK,GAAW,CAC1B,IAAM,EAASC,EAAW,QAAQ,GAClC,MAAO,CACH,MAAO,EAAO,MACd,OAAQ,EAAO,KAAK,KACpB,QAAS,EAAU,EAAO,aAC1B,YAAa,GAAG,EAAO,QAAQ,YAAY,EAAO,KAAK,KAAK,SAAS,EAAO,WAAW,SAAS,EAAO,gBAAgB,MAAM,EAAO,KAAK,MACzI,KAAM,kCAAkC,EAAO,KAC/C,SAAU,EAAO,KAAK,IAAK,GAAQ,EAAI"}