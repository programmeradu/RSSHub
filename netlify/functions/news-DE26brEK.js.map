{"version":3,"file":"news-DE26brEK.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/gov/moj/aac/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nconst baseUrl = 'https://www.aac.moj.gov.tw';\r\n\r\nexport const route: Route = {\r\n    path: '/moj/aac/news/:type?',\r\n    categories: ['government'],\r\n    example: '/gov/moj/aac/news',\r\n    parameters: { type: '資料大類，留空為全部' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '最新消息',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    description: `| 全部 | 其他 | 採購公告 | 新聞稿 | 肅貪 | 預防 | 綜合 | 防疫專區 |\r\n| ---- | ---- | -------- | ------ | ---- | ---- | ---- | -------- |\r\n|      | 02   | 01       | 06     | 05   | 04   | 03   | 99       |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type');\r\n    const url = `${baseUrl}/7204/7246/?Page=1&PageSize=40${type ? `&type=${type}` : ''}`;\r\n    const response = await got(url);\r\n    const $ = load(response.data);\r\n    $('.num').remove();\r\n    const list = $('.list ul li a')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const isDownload = /檔案下載/.test(item.attr('title'));\r\n            const title = isDownload ? item.text().trim() : item.attr('title');\r\n            return {\r\n                title,\r\n                link: new URL(item.attr('href'), baseUrl).href,\r\n                isDownload,\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                if (!item.isDownload) {\r\n                    const response = await got(item.link);\r\n                    const $ = load(response.data);\r\n\r\n                    item.pubDate = timezone(parseDate($('.info time').attr('datetime'), 'YYYY-MM-DD HH:mm:ss'), +8);\r\n                    $('.info, button').remove();\r\n                    item.description = $('.cp').html() + ($('.lightbox_slider').length ? $('.lightbox_slider').html() : '') + ($('.file_download').length ? $('.file_download').html() : '');\r\n                }\r\n                delete item.isDownload;\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        link: url,\r\n        item: items,\r\n        language: 'zh-TW',\r\n    };\r\n}\r\n"],"mappings":"0ZAMA,MAAM,EAAU,6BAEHA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,cACb,QAAS,oBACT,WAAY,CAAE,KAAM,cACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,UACd,UACA,YAAa;;sEAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACrB,EAAM,GAAG,EAAQ,gCAAgC,EAAO,SAAS,IAAS,KAC1E,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,MACxB,EAAE,QAAQ,SACV,IAAM,EAAO,EAAE,iBACV,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAa,OAAO,KAAK,EAAK,KAAK,UACnC,EAAQ,EAAa,EAAK,OAAO,OAAS,EAAK,KAAK,SAC1D,MAAO,CACH,QACA,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAS,KAC1C,gBAIN,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,CAAC,EAAK,WAAY,CAClB,IAAMC,EAAW,MAAMF,EAAI,EAAK,MAC1BG,EAAI,EAAKD,EAAS,MAExB,EAAK,QAAU,EAAS,EAAUC,EAAE,cAAc,KAAK,YAAa,uBAAwB,GAC5F,EAAE,iBAAiB,SACnB,EAAK,YAAcA,EAAE,OAAO,QAAUA,EAAE,oBAAoB,OAASA,EAAE,oBAAoB,OAAS,KAAOA,EAAE,kBAAkB,OAASA,EAAE,kBAAkB,OAAS,IAGzK,OADA,OAAO,EAAK,WACL,MAKnB,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,KAAM,EACN,KAAM,EACN,SAAU"}