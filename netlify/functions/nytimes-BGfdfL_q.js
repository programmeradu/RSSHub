import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./proxy-D7ccvALx.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as n}from"./got-CdvI2yKX.js";import{ViewType as r}from"./types-A5bA50Mg.js";import{rss_parser_default as i}from"./rss-parser-1vyhErsD.js";import{puppeteer_default as a}from"./puppeteer-f0D6AISB.js";import{load as o}from"cheerio";const s=(e,t)=>{let n=e(t).find(`figure`).find(`picture`).find(`img`),r=`<figure><img src='${n.attr(`src`)}'><br><figcaption>`,i=e(t).find(`figcaption`);return r+=`${e(i[0]).text().trim()}</figcaption></figure>`,r},c=async(t,n,r)=>{let i=await e.tryGet(`nyt: ${r}`,async()=>{let e=await n.newPage();await e.setRequestInterception(!0),e.on(`request`,e=>{e.resourceType()===`document`?e.continue():e.abort()}),await e.goto(r,{waitUntil:`domcontentloaded`});let t=await e.evaluate(()=>document.querySelector(`body`).innerHTML);return t});return i},l=(e,n=!1)=>{let r=o(e),i,a={};if(n)i=r(`section[name="articleBody"]`),a.title=`「英」${r(`h1`).text().trim()}`,a.author=r(`article#story span[itemprop="name"]`).text(),r(`article#story > header`).find(`div[data-testid="photoviewer-wrapper"]`).each((e,t)=>{let n=s(r,t);r(n).insertBefore(i[0].firstChild)}),i.find(`div[data-testid="photoviewer-wrapper"]`).each((e,t)=>{let n=s(r,t);r(n).insertBefore(t),r(t).remove()}),i.find(`#CNB`).each((e,t)=>{r(t).next().remove()}),i.find(`div[id]`).each((e,t)=>{r(t).remove()}),i.find(`aside`).each((e,t)=>{r(t).remove()});else{if(i=r(`section.article-body`),i.find(`div.big_ad, div.article-body-aside`).each((e,t)=>{r(t).remove()}),i.find(`div.article-paragraph`).each((e,t)=>{r(t).html(`<p>${r(t).html()}</p>`)}),r(`figure.article-span-photo`).length>0){let e=r(`figure.article-span-photo`);r(e).insertBefore(i[0].firstChild)}if(r(`footer.author-info`).length>0){let e=r(`footer.author-info`);r(e).insertAfter(i[0].lastChild)}}let c=r(`time`).attr(`datetime`);return c&&(a.pubDate=t(c)),a.description=i.html(),a};var u={ProcessFeed:l,PuppeterGetter:c};const d={path:`/:lang?`,categories:[`traditional-media`],view:r.Articles,example:`/nytimes/dual`,parameters:{lang:{description:`language, default to Chinese`,options:[{value:`dual`,label:`Chinese-English`},{value:`en`,label:`English`},{value:`traditionalchinese`,label:`Traditional Chinese`},{value:`dual-traditionalchinese`,label:`Chinese-English (Traditional Chinese)`}]}},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`nytimes.com/`],target:``}],name:`News`,maintainers:[`HenryQW`,`pseudoyu`],handler:f,url:`nytimes.com/`,description:`By extracting the full text of articles, we provide a better reading experience (full text articles) over the official one.`};async function f(t){let{lang:r=``}=t.req.param();r=r.toLowerCase();let s=`纽约时报中文网`,c=`https://cn.nytimes.com/rss/`;switch(r){case`dual`:s+=` - 中英对照版`;break;case`en`:s+=` - 英文原版`;break;case`traditionalchinese`:s=`紐約時報中文網`,c=new URL(`zh-hant`,c).href;break;case`dual-traditionalchinese`:s=`紐約時報中文網 - 中英對照版`,c=new URL(`zh-hant`,c).href,r=`dual`;break;default:}let l=await a(),d=await i.parseURL(c),f=await Promise.all(d.items.splice(0,10).map(async i=>{let a=i.link,s,c=!1,d=!1;if(r===`dual`){a=a.replace(`/?utm_source=RSS`,``)+`/dual`;try{s=await e.tryGet(`nyt: ${a}`,async()=>{let e=await n(a);return e.data}),d=!0}catch{s=await e.tryGet(`nyt: ${i.link}`,async()=>{let e=await n(i.link);return e.data})}}else if(s=await e.tryGet(`nyt: ${i.link}`,async()=>{let e=await n(i.link);return e.data}),r===`en`){let e=o(s);e(`.dual-btn`).length>0&&(c=!0,a=e(`.dual-btn a`).last().attr().href,s=await u.PuppeterGetter(t,l,a))}let f={title:i.title,pubDate:i.pubDate,link:a,author:i[`dc:creator`]},p=u.ProcessFeed(s,c),m=/&#x611F;(&#x8C22|&#x8B1D);.*?cn\.letters@nytimes\.com&#x3002;/g;return f.description=p.description?.replace(m,``),c&&(f.title=p.title,f.author=p.author),d&&(f.title=`「中英」${f.title}`),f}));return await l.close(),{title:s,link:`https://cn.nytimes.com`,description:s,item:f}}export{d as route};
//# sourceMappingURL=nytimes-BGfdfL_q.js.map