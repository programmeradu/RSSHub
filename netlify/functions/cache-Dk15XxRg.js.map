{"version":3,"file":"cache-Dk15XxRg.js","names":["ConfigNotFoundError","cache","got"],"sources":["../../lib/routes/mihoyo/bbs/cache.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { config } from '@/config';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nconst getUserFullInfo = (ctx, uid) => {\r\n    if (!uid && !config.mihoyo.cookie) {\r\n        throw new ConfigNotFoundError('GetUserFullInfo is not available due to the absense of [Miyoushe Cookie]. Check <a href=\"https://docs.rsshub.app/deploy/config#route-specific-configurations\">relevant config tutorial</a>');\r\n    }\r\n    uid ||= '';\r\n    const key = 'mihoyo:user-full-info-uid-' + uid;\r\n    return cache.tryGet(key, async () => {\r\n        const query = new URLSearchParams({\r\n            uid,\r\n            gids: 2,\r\n        }).toString();\r\n        const url = `https://bbs-api.miyoushe.com/user/wapi/getUserFullInfo?${query}`;\r\n        const response = await got({\r\n            method: 'get',\r\n            url,\r\n            headers: {\r\n                Referer: `https://www.miyoushe.com/ys/accountCenter/postList?id=${uid}`,\r\n                Cookie: config.mihoyo.cookie,\r\n            },\r\n        });\r\n        const userInfo = response?.data?.data?.user_info;\r\n        if (!userInfo) {\r\n            throw new Error('未获取到数据！');\r\n        }\r\n        const { nickname, introduce, gender, certification, avatar_url, uid: userId } = userInfo;\r\n        return {\r\n            nickname,\r\n            introduce,\r\n            gender,\r\n            certification,\r\n            avatar_url,\r\n            uid: userId,\r\n        };\r\n    });\r\n};\r\n\r\nexport default { getUserFullInfo };\r\n"],"mappings":"4NAKA,MAAM,GAAmB,EAAK,IAAQ,CAClC,GAAI,CAAC,GAAO,CAAC,EAAO,OAAO,OACvB,MAAM,IAAIA,EAAoB,8LAElC,IAAQ,GACR,IAAM,EAAM,6BAA+B,EAC3C,OAAOC,EAAM,OAAO,EAAK,SAAY,CACjC,IAAM,EAAQ,IAAI,gBAAgB,CAC9B,MACA,KAAM,IACP,WACG,EAAM,0DAA0D,IAChE,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,MACA,QAAS,CACL,QAAS,yDAAyD,IAClE,OAAQ,EAAO,OAAO,UAGxB,EAAW,GAAU,MAAM,MAAM,UACvC,GAAI,CAAC,EACD,MAAU,MAAM,WAEpB,GAAM,CAAE,WAAU,YAAW,SAAQ,gBAAe,aAAY,IAAK,GAAW,EAChF,MAAO,CACH,WACA,YACA,SACA,gBACA,aACA,IAAK,MAKjB,IAAA,EAAe,CAAE"}