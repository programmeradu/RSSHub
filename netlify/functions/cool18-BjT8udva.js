import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{ofetch_default as n}from"./ofetch-Bzt0BXUH.js";import{load as r}from"cheerio";const i={path:`/:id?/:type?/:keyword?`,url:`cool18.com`,example:`cool18.com/bbs4`,parameters:{id:`the name of the bbs`,type:"the type of the post. Can be `home`, `gold` or `threadsearch`. Default: `home`",keyword:`the keyword to search.`,pageSize:`the number of posts to fetch. If the type is not in search, you can type any words. Default: 10`},categories:[`bbs`],radar:[{source:[`cool18.com/:id/`],target:`/:id/:type?/:keyword?`}],name:`禁忌书屋`,maintainers:[`nczitzk`,`Gabrlie`],handler:a,features:{nsfw:!0}};async function a(i){let{id:a=`bbs4`,type:o=`home`,keyword:s}=i.req.param(),c=`https://www.cool18.com/`+a+`/index.php`,l=o===`home`?``:o===`gold`?`?app=forum&act=gold`:`?action=search&act=threadsearch&app=forum&keywords=${s}&submit=查询`,u=c+l,d=await n(u),f=r(d),p=i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`)):20,m=o===`home`?JSON.parse(f(`script:contains("_PageData")`).text().match(/const\s+_PageData\s*=\s*(\[[\s\S]*?]);/)?.[1]||`[]`).slice(0,p).map(e=>({title:e.subject,link:`${c}?app=forum&act=threadview&tid=${e.tid}`,pubDate:t(e.dateline,`MM/DD/YY`),author:e.username,category:e.type,description:``})):f(`#d_list ul li, #thread_list li, .t_l .t_subject`).slice(0,p).toArray().map(e=>{let n=f(e).find(`a`).first();return{title:n.text(),link:`${c}/${n.attr(`href`)}`,pubDate:t(f(e).find(`i`).text(),`MM/DD/YY`),author:f(e).find(`a`).last().text(),category:n.find(`span`).first().text(),description:``}}),h=await Promise.all(m.map(t=>e.tryGet(t.link,async()=>{let e=await n(t.link),i=r(e),a=i(`pre`);if(a.length>0){let e=a.html();t.description=e?e.replaceAll(/<font color="#E6E6DD">cool18.com<\/font>/g,``):``}return t})));return{title:f(`title`).text(),link:u,item:h}}export{i as route};
//# sourceMappingURL=cool18-BjT8udva.js.map