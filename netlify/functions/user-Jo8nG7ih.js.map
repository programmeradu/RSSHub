{"version":3,"file":"user-Jo8nG7ih.js","names":["route: Route","got"],"sources":["../../lib/routes/miui/community/user.ts"],"sourcesContent":["import { Route, Data } from '@/types';\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/community/user/:uid',\r\n    categories: ['bbs'],\r\n    example: '/miui/community/user/1200057564',\r\n    parameters: {\r\n        uid: '小米用户 UID，可于网页版用户主页链接中 `uid` 项获取',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['web.vip.miui.com/page/info/mio/mio/homePage'],\r\n            target: (_, url) => `/miui/community/user/${new URL(url).searchParams.get('uid')}`,\r\n        },\r\n    ],\r\n    name: '小米社区用户发帖',\r\n    maintainers: ['abc1763613206'],\r\n    handler,\r\n};\r\n\r\nconst userRoot = 'https://web.vip.miui.com/page/info/mio/mio/homePage';\r\nconst apiRoot = 'https://api.vip.miui.com/api/community/user/announce/list';\r\nconst pageRoot = 'https://web.vip.miui.com/page/info/mio/mio/detail';\r\n\r\nasync function handler(ctx): Promise<Data> {\r\n    const uid = ctx.req.param('uid');\r\n    const apiLink = `${apiRoot}?uid=${uid}&limit=10`;\r\n    const userLink = `${userRoot}?uid=${uid}`;\r\n    const { data } = await got({\r\n        method: 'get',\r\n        url: apiLink,\r\n        headers: {\r\n            Referer: userLink,\r\n        },\r\n    });\r\n    if (data.code === 200) {\r\n        let authorName = '';\r\n        const records = data.entity.records;\r\n        const items = records.map((item) => {\r\n            authorName = item.author.name;\r\n            return {\r\n                title: item.title || `${authorName} 的动态`,\r\n                description: item.textContent,\r\n                pubDate: new Date(item.createTime).toUTCString(),\r\n                author: item.author.name,\r\n                link: `${pageRoot}?postId=${item.id}`,\r\n                image: item.pic || item.cover || '',\r\n            };\r\n        });\r\n        return {\r\n            title: `小米社区 - ${authorName} 的发帖`,\r\n            link: userLink,\r\n            description: `${authorName} 的发帖`,\r\n            item: items,\r\n            language: 'zh-cn',\r\n        };\r\n    } else {\r\n        throw new Error(data.message);\r\n    }\r\n}\r\n"],"mappings":"gOAGA,MAAaA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,OACb,QAAS,kCACT,WAAY,CACR,IAAK,mCAET,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,+CACT,QAAS,EAAG,IAAQ,wBAAwB,IAAI,IAAI,GAAK,aAAa,IAAI,WAGlF,KAAM,WACN,YAAa,CAAC,iBACd,WAOJ,eAAe,EAAQ,EAAoB,CACvC,IAAM,EAAM,EAAI,IAAI,MAAM,OACpB,EAAU,iEAAkB,EAAI,WAChC,EAAW,2DAAmB,IAC9B,CAAE,QAAS,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,KAGjB,GAAI,EAAK,OAAS,IAAK,CACnB,IAAI,EAAa,GACX,EAAU,EAAK,OAAO,QACtB,EAAQ,EAAQ,IAAK,IACvB,EAAa,EAAK,OAAO,KAClB,CACH,MAAO,EAAK,OAAS,GAAG,EAAW,MACnC,YAAa,EAAK,YAClB,QAAS,IAAI,KAAK,EAAK,YAAY,cACnC,OAAQ,EAAK,OAAO,KACpB,KAAM,4DAAsB,EAAK,KACjC,MAAO,EAAK,KAAO,EAAK,OAAS,MAGzC,MAAO,CACH,MAAO,UAAU,EAAW,MAC5B,KAAM,EACN,YAAa,GAAG,EAAW,MAC3B,KAAM,EACN,SAAU,cAGd,MAAU,MAAM,EAAK"}