import{config as e}from"./config-Dl8a1sIg.js";import{logger_default as t}from"./logger-CWOoofbD.js";import{got_default as n}from"./got-CdvI2yKX.js";import{timezone as r}from"./timezone-BrNu6iXe.js";import i from"node:path";import{load as a}from"cheerio";const o={},s=e.ehentai.ipb_member_id&&e.ehentai.ipb_pass_hash&&e.ehentai.sk,c=s&&e.ehentai.igneous;if(s)if(c){let{ipb_member_id:t,ipb_pass_hash:n,sk:r,igneous:i}=e.ehentai;o.cookie=`ipb_member_id=${t};ipb_pass_hash=${n};sk=${r};igneous=${i}`}else{let{ipb_member_id:t,ipb_pass_hash:n,sk:r}=e.ehentai;o.cookie=`ipb_member_id=${t};ipb_pass_hash=${n};sk=${r}`}e.ehentai.star&&(o.cookie+=`;star=${e.ehentai.star}`);function l(e){return n(c?{method:`get`,url:`https://exhentai.org/${e}`,headers:o}:{method:`get`,url:`https://e-hentai.org/${e}`,headers:o})}function u(e,r){return e.tryGet(r,async()=>{try{let e=await n({method:`get`,url:r,headers:o}),t=new Buffer.from(e.rawBody).toString(`base64`),a=i.extname(r).slice(1);return`data:image/${a};base64,${t}`}catch(e){return t.warn(`Cannot download thumbnail: `+r,e),r}})}async function d(t,n,i=!1,o=!1){let s=a(n),c=`t`,l=s(`div[class^="itg gld"]`);if(l.length<=0&&(l=s(`table[class^="itg gltm"] tbody`),c=`m`),l.length<=0&&(l=s(`table[class^="itg gltc"] tbody`),c=`l`),l.length<=0&&(l=s(`table[class^="itg glte"] tbody`),c=`e`),l.length<=0)return[];async function d(t,n){let a=s(n),l=a.find(`div.glink`).html(),d=a.find(`div[id^="posted_"]`).text(),f=d&&r(d,0),m,h;`mpl`.includes(c)?(m=a.find(`td[class^="gl3"] a`),h=a.find(`td[class^=gl2] div.glthumb div img`)):c===`e`?(m=a.find(`td[class^="gl1"] a`),h=m.find(`img`)):c===`t`&&(m=a.find(`div[class^="gl3t"] a`),h=m.find(`img`));let g=m.attr(`href`),_=h.data(`src`)??h.attr(`src`);if(e.ehentai.img_proxy&&_){let t=new URL(_);_=e.ehentai.img_proxy+t.pathname+t.search}o&&_&&(_=await u(t,_));let v=`<img src='${_}' alt='thumbnail'>`;if(l&&g){let e={title:l,description:v,pubDate:f,link:g};if(i){let n=a.find(`div.gldown`),r=n.find(`a`).attr(`href`);if(r){let n=await p(t,r);n&&(e.enclosure_url=n,e.enclosure_type=`application/x-bittorrent`,e.bittorrent_page_url=r)}}return`le`.includes(c)&&(e.author=s(a).find(`div.gt[title^="artist:"]`).toArray().map(e=>s(e).text()).join(` / `)),e}}let f=[];l.children().each((e,n)=>{f.push(d(t,n))});let m=await Promise.all(f),h=[];for(let e of m)e&&h.push(e);return h}let f=``;function p(e,t){return e.tryGet(t,async()=>{try{let e=await n({method:`get`,url:t,headers:o}),r=a(e.data),i=r(`form`).toArray(),s;for(let e of i){let t=r(e).find(`a`),n=t.attr(`onclick`);if(n){let e=n.match(/'(.*?)'/);if(e){s=e[1];let t=s.match(/torrent\?p=(.*?)$/);t&&(f=t[1])}}}return s}catch{return}})}function m(e,t){for(let n of t)n.enclosure_url&&(n.enclosure_url=n.enclosure_url.replace(/torrent\?p=.*$/,`torrent?p=${f}`),e.set(n.bittorrent_page_url,n.enclosure_url));return t}async function h(e,t,n=!1,r=!1){let i=await l(t),a=await d(e,i.data,n,r);return m(e,a)}async function g(e,t,n,r,i=!1,a=!1){let o=await l(`favorites.php?favcat=${t}&inline_set=${n}`);if(r)return h(e,`favorites.php?favcat=${t}&next=${r}`,i,a);{let t=await d(e,o.data,i,a);return m(e,t)}}function _(e,t,n,r=!1,i=!1){return n?h(e,`?${t}&next=${n}`,r,i):h(e,`?${t}`,r,i)}function v(e,t,n,r=!1,i=!1){return n?h(e,`tag/${t}?next=${n}`,r,i):h(e,`tag/${t}`,r,i)}var y={getFavoritesItems:g,getSearchItems:_,getTagItems:v,has_cookie:s,from_ex:c};export{y as ehapi_default};
//# sourceMappingURL=ehapi-Bo_it2g6.js.map