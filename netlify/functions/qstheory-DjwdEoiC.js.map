{"version":3,"file":"qstheory-DjwdEoiC.js","names":["rootUrl","route: Route","ofetch","cache"],"sources":["../../lib/routes/qstheory/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport * as cheerio from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport { baseUrl as rootUrl, getItem } from './utils';\r\n\r\nconst config = {\r\n    toutiao: {\r\n        title: '头条',\r\n        url: `${rootUrl}/v9zhuanqu/toutiao/index.htm`,\r\n    },\r\n    qswp: {\r\n        title: '网评',\r\n        url: `${rootUrl}/qswp.htm`,\r\n    },\r\n    qssp: {\r\n        title: '视频',\r\n        url: `${rootUrl}/qssp/index.htm`,\r\n    },\r\n    qslgxd: {\r\n        title: '原创',\r\n        url: `${rootUrl}/qslgxd/index.htm`,\r\n    },\r\n    economy: {\r\n        title: '经济',\r\n        url: `${rootUrl}/economy/index.htm`,\r\n    },\r\n    politics: {\r\n        title: '政治',\r\n        url: `${rootUrl}/politics/index.htm`,\r\n    },\r\n    culture: {\r\n        title: '文化',\r\n        url: `${rootUrl}/culture/index.htm`,\r\n    },\r\n    society: {\r\n        title: '社会',\r\n        url: `${rootUrl}/society/index.htm`,\r\n    },\r\n    cpc: {\r\n        title: '党建',\r\n        url: `${rootUrl}/cpc/index.htm`,\r\n    },\r\n    science: {\r\n        title: '科教',\r\n        url: `${rootUrl}/science/index.htm`,\r\n    },\r\n    zoology: {\r\n        title: '生态',\r\n        url: `${rootUrl}/zoology/index.htm`,\r\n    },\r\n    defense: {\r\n        title: '国防',\r\n        url: `${rootUrl}/defense/index.htm`,\r\n    },\r\n    international: {\r\n        title: '国际',\r\n        url: `${rootUrl}/international/index.htm`,\r\n    },\r\n    books: {\r\n        title: '图书',\r\n        url: `${rootUrl}/books/index.htm`,\r\n    },\r\n    xxbj: {\r\n        title: '学习笔记',\r\n        url: `${rootUrl}/qszq/xxbj/index.htm`,\r\n    },\r\n    llwx: {\r\n        title: '理论文选',\r\n        url: `${rootUrl}/qszq/llwx/index.htm`,\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    categories: ['traditional-media'],\r\n    example: '/qstheory',\r\n    parameters: { industry: '分类，见下表' },\r\n    radar: [\r\n        {\r\n            source: ['www.qstheory.cn/v9zhuanqu/:category/index.htm', 'www.qstheory.cn/qszq/:category/index.htm', 'www.qstheory.cn/:category/index.htm'],\r\n        },\r\n    ],\r\n    name: '分类',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `\r\n| 头条    | 网评 | 视频 | 原创   | 经济    | 政治     | 文化    | 社会    | 党建 | 科教    | 生态    | 国防    | 国际          | 图书  | 学习笔记 | 理论文选 |\r\n| ------- | ---- | ---- | ------ | ------- | -------- | ------- | ------- | ---- | ------- | ------- | ------- | ------------- | ----- | -------- | -------- |\r\n| toutiao | qswp | qssp | qslgxd | economy | politics | culture | society | cpc  | science | zoology | defense | international | books | xxbj     | llwx     |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'toutiao' } = ctx.req.param();\r\n    const limit = Number.parseInt(ctx.req.query('limit')) || 50;\r\n\r\n    const currentUrl = config[category].url;\r\n    const response = await ofetch(currentUrl);\r\n\r\n    const $ = cheerio.load(response);\r\n\r\n    const list = $('.list-style1 ul li a, .text h2 a, .no-pic ul li a')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            return {\r\n                title: $item.text(),\r\n                link: $item.attr('href')!,\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(list.map((item) => cache.tryGet(item.link, () => getItem(item))));\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"qVAOA,MAAM,EAAS,CACX,QAAS,CACL,MAAO,KACP,IAAK,GAAGA,EAAQ,+BAEpB,KAAM,CACF,MAAO,KACP,IAAK,GAAGA,EAAQ,YAEpB,KAAM,CACF,MAAO,KACP,IAAK,GAAGA,EAAQ,kBAEpB,OAAQ,CACJ,MAAO,KACP,IAAK,GAAGA,EAAQ,oBAEpB,QAAS,CACL,MAAO,KACP,IAAK,GAAGA,EAAQ,qBAEpB,SAAU,CACN,MAAO,KACP,IAAK,GAAGA,EAAQ,sBAEpB,QAAS,CACL,MAAO,KACP,IAAK,GAAGA,EAAQ,qBAEpB,QAAS,CACL,MAAO,KACP,IAAK,GAAGA,EAAQ,qBAEpB,IAAK,CACD,MAAO,KACP,IAAK,GAAGA,EAAQ,iBAEpB,QAAS,CACL,MAAO,KACP,IAAK,GAAGA,EAAQ,qBAEpB,QAAS,CACL,MAAO,KACP,IAAK,GAAGA,EAAQ,qBAEpB,QAAS,CACL,MAAO,KACP,IAAK,GAAGA,EAAQ,qBAEpB,cAAe,CACX,MAAO,KACP,IAAK,GAAGA,EAAQ,2BAEpB,MAAO,CACH,MAAO,KACP,IAAK,GAAGA,EAAQ,mBAEpB,KAAM,CACF,MAAO,OACP,IAAK,GAAGA,EAAQ,uBAEpB,KAAM,CACF,MAAO,OACP,IAAK,GAAGA,EAAQ,wBAIXC,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,qBACb,QAAS,YACT,WAAY,CAAE,SAAU,UACxB,MAAO,CACH,CACI,OAAQ,CAAC,gDAAiD,2CAA4C,yCAG9G,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa;;;iKAMjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,WAAc,EAAI,IAAI,QACnC,EAAQ,OAAO,SAAS,EAAI,IAAI,MAAM,WAAa,GAEnD,EAAa,EAAO,GAAU,IAC9B,EAAW,MAAMC,EAAO,GAExB,EAAI,EAAQ,KAAK,GAEjB,EAAO,EAAE,qDACV,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GAChB,MAAO,CACH,MAAO,EAAM,OACb,KAAM,EAAM,KAAK,WAIvB,EAAQ,MAAM,QAAQ,IAAI,EAAK,IAAK,GAASC,EAAM,OAAO,EAAK,SAAY,EAAQ,MAEzF,MAAO,CACH,MAAO,EAAE,SAAS,OAClB,KAAM,EACN,KAAM"}