import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{art as n}from"./render-CxhTJIsl.js";import{parseDate as r}from"./parse-date-Bgabdhlb.js";import{got_default as i}from"./got-CdvI2yKX.js";import{timezone as a}from"./timezone-BrNu6iXe.js";import o from"node:path";import{load as s}from"cheerio";t();const c=(e,t,n)=>i(`https://feed.mix.sina.com.cn/api/roll/get`,{headers:{referer:`https://news.sina.com.cn/`},searchParams:{pageid:e,lid:t,k:``,num:n,page:1,r:Math.random(),_:Date.now()}}),l=e=>e.map(e=>({title:e.title,description:e.intro,link:e.url.replace(`http://`,`https://`),author:e.media_name,pubDate:r(e.intime,`X`),updated:r(e.mtime,`X`)})),u=(t,c)=>c(t.link,async()=>{let c=await i(t.link),l=s(c.data);l(`#left_hzh_ad, .appendQr_wrap, .app-kaihu-qr, .tech-quotation`).remove();let u=l(`meta[property="article:published_time"]`),d=l(`#pub_date, .date`),f=d.length?a(r(d.text(),[`YYYY年MM月DD日 HH:mm`,`YYYY年MM月DD日HH:mm`]),8):null,p=u.length?r(u.attr(`content`)):f;if(t.pubDate=t.pubDate??p,t.author=l(`meta[property="article:author"]`).attr(`content`),t.link.startsWith(`https://slide.sports.sina.com.cn/`)||t.link.startsWith(`https://slide.tech.sina.com.cn/`)){let r=JSON.parse(l(`script`).text().match(/var slide_data = ({.*?})\s/)[1]);t.description=n(o.join(e,`templates/slide-0f06b2de.art`),{slideData:r})}else if(t.link.startsWith(`https://video.sina.com.cn/`)){let a=l(`script`).text().match(/video_id:'?(.*?)'?,/)[1],{data:s}=await i(`https://api.ivideo.sina.com.cn/public/video/play`,{searchParams:{video_id:a,appver:`V11220.210521.03`,appname:`sinaplayer_pc`,applt:`web`,tags:`sinaplayer_pc`,jsonp:``,plid:2021012801,prid:``,uid:``,tid:``,pid:1,ran:Math.random(),r:t.link,ssid:`gusr_pc_${Date.now()}`,preload:0,uu:``,isAuto:1}}),c=s.data,u=c.image,d=c.videos.find(e=>e.type===`mp4`).dispatch_result.url;t.description=n(o.join(e,`templates/video-9a2060b9.art`),{poster:u,videoUrl:d}),t.pubDate=r(c.create_time,`X`)}else t.link.startsWith(`https://news.sina.com.cn/`)||t.link.startsWith(`https://mil.news.sina.com.cn/`)?(t.description=l(`#article`).html(),t.category=l(`meta[name="keywords"]`).attr(`content`).split(`,`)):(t.description=l(`#artibody`).html(),t.category=l(`#keywords`).data(`wbkey`)?.split(`,`));return t});export{c as getRollNewsList,u as parseArticle,l as parseRollNewsList};
//# sourceMappingURL=utils-Cqb5RvVf.js.map