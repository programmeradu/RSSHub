{"version":3,"file":"status-sZT1UQ-e.js","names":["route: Route","cache","got"],"sources":["../../lib/routes/douban/people/status.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport querystring from 'node:querystring';\r\nimport got from '@/utils/got';\r\nimport { fallback, queryToBoolean, queryToInteger } from '@/utils/readable-social';\r\nimport { config } from '@/config';\r\nexport const route: Route = {\r\n    path: '/people/:userid/status/:routeParams?',\r\n    categories: ['social-media'],\r\n    view: ViewType.SocialMedia,\r\n    example: '/douban/people/75118396/status',\r\n    parameters: { userid: '整数型用户 id', routeParams: '额外参数；见下' },\r\n    name: '用户广播',\r\n    maintainers: ['alfredcai'],\r\n    handler,\r\n    description: `\r\n::: tip\r\n-   **目前只支持整数型 id**\r\n-   字母型的 id，可以通过头像图片链接来找到其整数型 id，图片命名规则\\`ul[userid]-*.jpg\\`或\\`u[userid]-*.jpg\\`，即取文件名中间的数字\r\n-   例如：用户 id: \\`MovieL\\`他的头像图片链接：\\`https://img1.doubanio.com/icon/ul1128221-98.jpg\\`他的整数型 id: \\`1128221\\`\r\n:::\r\n\r\n对于豆瓣用户广播内容，在 \\`routeParams\\` 参数中以 query string 格式设置如下选项可以控制输出的样式\r\n\r\n| 键                         | 含义                                                           | 接受的值       | 默认值 |\r\n| -------------------------- | -------------------------------------------------------------- | -------------- | ------ |\r\n| readable                   | 是否开启细节排版可读性优化                                     | 0/1/true/false | false  |\r\n| authorNameBold             | 是否加粗作者名字                                               | 0/1/true/false | false  |\r\n| showAuthorInTitle          | 是否在标题处显示作者                                           | 0/1/true/false | true   |\r\n| showAuthorInDesc           | 是否在正文处显示作者                                           | 0/1/true/false | false  |\r\n| showAuthorAvatarInDesc     | 是否在正文处显示作者头像（若阅读器会提取正文图片，不建议开启） | 0/1/true/false | false  |\r\n| showEmojiForRetweet        | 显示 “🔁” 取代 “Fw”（转发）                                    | 0/1/true/false | false  |\r\n| showRetweetTextInTitle     | 在标题出显示转发评论（置为 false 则在标题只显示被转发的广播）  | 0/1/true/false | false  |\r\n| addLinkForPics             | 为图片添加可点击的链接                                         | 0/1/true/false | false  |\r\n| showTimestampInDescription | 在正文处显示广播的时间戳                                       | 0/1/true/false | false  |\r\n| showComments               | 在正文处显示评论                                               | 0/1/true/false | false  |\r\n| widthOfPics                | 广播配图宽（生效取决于阅读器）                                 | 不指定 / 数字  | 不指定 |\r\n| heightOfPics               | 广播配图高（生效取决于阅读器）                                 | 不指定 / 数字  | 不指定 |\r\n| sizeOfAuthorAvatar         | 作者头像大小                                                   | 数字           | 48     |\r\n\r\n  指定更多与默认值不同的参数选项可以改善 RSS 的可读性，如\r\n\r\n  [https://rsshub.app/douban/people/113894409/status/readable=1&authorNameBold=1&showAuthorInTitle=1&showAuthorInDesc=1&showAuthorAvatarInDesc=1&showEmojiForRetweet=1&showRetweetTextInTitle=1&addLinkForPics=1&showTimestampInDescription=1&showComments=1&widthOfPics=100](https://rsshub.app/douban/people/113894409/status/readable=1&authorNameBold=1&showAuthorInTitle=1&showAuthorInDesc=1&showAuthorAvatarInDesc=1&showEmojiForRetweet=1&showRetweetTextInTitle=1&addLinkForPics=1&showTimestampInDescription=1&showComments=1&widthOfPics=100)\r\n\r\n  的效果为\r\n\r\n  <img loading=\"lazy\" src=\"/img/readable-douban.png\" alt=\"豆瓣读书的可读豆瓣广播 RSS\" />`,\r\n};\r\n\r\nconst headers = { Referer: `https://m.douban.com/` };\r\n\r\nfunction tryFixStatus(status) {\r\n    let result = { isFixSuccess: true, why: '' };\r\n    const now = new Date();\r\n\r\n    if (!status) {\r\n        result = {\r\n            isFixSuccess: false,\r\n            // 添加方括号，与 status.msg 的样式统一\r\n            why: '[ 无内容 ]',\r\n        };\r\n        status = {}; // dummy\r\n    } else if (status.deleted) {\r\n        result = {\r\n            isFixSuccess: false,\r\n            why: status.msg ?? '[ 内容已被删除 ]',\r\n        };\r\n    } else if (status.hidden) {\r\n        result = {\r\n            isFixSuccess: false,\r\n            why: status.msg ?? '[ 内容已被设为不可见 ]',\r\n        };\r\n    } else if (status.text === undefined || status.text === null || !status.uri) {\r\n        result = {\r\n            isFixSuccess: false,\r\n            why: status.msg ?? '[ 内容已不可访问 ]',\r\n        };\r\n    } else {\r\n        if (!status.author) {\r\n            status.author = {};\r\n        }\r\n        if (!status.author.url) {\r\n            status.author.url = 'https://www.douban.com/people/1/';\r\n        }\r\n        if (!status.author.name) {\r\n            status.author.name = '[作者不可见]';\r\n        }\r\n        if (!status.author.avatar) {\r\n            status.author.avatar = 'https://img1.doubanio.com/icon/user_normal.jpg';\r\n        }\r\n        if (!status.create_time) {\r\n            status.create_time = now.toLocaleString();\r\n        }\r\n        if (!status.entities) {\r\n            status.entities = [];\r\n        }\r\n    }\r\n\r\n    if (status.sharing_url) {\r\n        status.sharing_url = status.sharing_url.split('&')[0];\r\n    }\r\n\r\n    if (!result.isFixSuccess) {\r\n        status.sharing_url = 'https://www.douban.com?rsshub_failed=' + now.getTime().toString();\r\n        if (!status.create_time) {\r\n            status.create_time = now.toLocaleString();\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nfunction getContentByActivity(ctx, item, params = {}, picsPrefixes = []) {\r\n    const routeParams = querystring.parse(ctx.req.param('routeParams'));\r\n\r\n    const mergedParams = {\r\n        readable: fallback(params.readable, queryToBoolean(routeParams.readable), false),\r\n        authorNameBold: fallback(params.authorNameBold, queryToBoolean(routeParams.authorNameBold), false),\r\n        showAuthorInTitle: fallback(params.showAuthorInTitle, queryToBoolean(routeParams.showAuthorInTitle), true),\r\n        showAuthorInDesc: fallback(params.showAuthorInDesc, queryToBoolean(routeParams.showAuthorInDesc), false),\r\n        showAuthorAvatarInDesc: fallback(params.showAuthorAvatarInDesc, queryToBoolean(routeParams.showAuthorAvatarInDesc), false),\r\n        showEmojiForRetweet: fallback(params.showEmojiForRetweet, queryToBoolean(routeParams.showEmojiForRetweet), false),\r\n        showRetweetTextInTitle: fallback(params.showRetweetTextInTitle, queryToBoolean(routeParams.showRetweetTextInTitle), false),\r\n        addLinkForPics: fallback(params.addLinkForPics, queryToBoolean(routeParams.addLinkForPics), false),\r\n        showTimestampInDescription: fallback(params.showTimestampInDescription, queryToBoolean(routeParams.showTimestampInDescription), false),\r\n        showComments: fallback(params.showComments, queryToBoolean(routeParams.showComments), false),\r\n\r\n        showColonInDesc: fallback(params.showColonInDesc, null, false),\r\n\r\n        widthOfPics: fallback(params.widthOfPics, queryToInteger(routeParams.widthOfPics), -1),\r\n        heightOfPics: fallback(params.heightOfPics, queryToInteger(routeParams.heightOfPics), -1),\r\n        sizeOfAuthorAvatar: fallback(params.sizeOfAuthorAvatar, queryToInteger(routeParams.sizeOfAuthorAvatar), 48),\r\n    };\r\n\r\n    params = mergedParams;\r\n\r\n    const {\r\n        readable,\r\n        authorNameBold,\r\n        showAuthorInTitle,\r\n        showAuthorInDesc,\r\n        showAuthorAvatarInDesc,\r\n        showEmojiForRetweet,\r\n        showRetweetTextInTitle,\r\n        addLinkForPics,\r\n        showTimestampInDescription,\r\n        showComments,\r\n\r\n        showColonInDesc,\r\n\r\n        widthOfPics,\r\n        heightOfPics,\r\n        sizeOfAuthorAvatar,\r\n    } = params;\r\n\r\n    const { status, comments } = item;\r\n    const { isFixSuccess, why } = tryFixStatus(status);\r\n    if (!isFixSuccess) {\r\n        return {\r\n            title: why,\r\n            description: why,\r\n        };\r\n    }\r\n\r\n    let description = '';\r\n    let title = '';\r\n\r\n    let activityInDesc;\r\n    let activityInTitle;\r\n\r\n    const { isFixSuccess: isResharedFixSuccess, why: resharedWhy } = tryFixStatus(status.reshared_status);\r\n\r\n    if (status.activity === '转发') {\r\n        if (isResharedFixSuccess) {\r\n            activityInDesc = '转发 ';\r\n            if (readable) {\r\n                activityInDesc += `<a href=\"${status.reshared_status.author.url}\" target=\"_blank\" rel=\"noopener noreferrer\">`;\r\n            }\r\n            if (authorNameBold) {\r\n                activityInDesc += `<strong>`;\r\n            }\r\n            activityInDesc += status.reshared_status.author.name;\r\n            if (authorNameBold) {\r\n                activityInDesc += `</strong>`;\r\n            }\r\n            if (readable) {\r\n                activityInDesc += `</a>`;\r\n            }\r\n            activityInDesc += ` 的广播`;\r\n            activityInTitle = `转发 ${status.reshared_status.author.name} 的广播`;\r\n        } else {\r\n            activityInDesc = `转发广播`;\r\n            activityInTitle = `转发广播`;\r\n        }\r\n    } else {\r\n        activityInDesc = status.activity;\r\n        activityInTitle = status.activity;\r\n    }\r\n\r\n    if (showAuthorInDesc) {\r\n        let usernameAndAvatar = '';\r\n        if (readable) {\r\n            usernameAndAvatar += `<a href=\"${status.author.url}\" target=\"_blank\" rel=\"noopener noreferrer\">`;\r\n        }\r\n        if (showAuthorAvatarInDesc) {\r\n            usernameAndAvatar += `<img width=\"${sizeOfAuthorAvatar}\" height=\"${sizeOfAuthorAvatar}\" src=\"${status.author.avatar}\" ${readable ? 'hspace=\"8\" vspace=\"8\" align=\"left\"' : ''} />`;\r\n        }\r\n        if (authorNameBold) {\r\n            usernameAndAvatar += `<strong>`;\r\n        }\r\n        usernameAndAvatar += status.author.name;\r\n        if (authorNameBold) {\r\n            usernameAndAvatar += `</strong>`;\r\n        }\r\n        if (readable) {\r\n            usernameAndAvatar += `</a>`;\r\n        }\r\n        usernameAndAvatar += `&ensp;`;\r\n        description += usernameAndAvatar + activityInDesc + (showColonInDesc ? ': ' : '');\r\n    }\r\n\r\n    if (showAuthorInTitle) {\r\n        title += `${status.author.name} `;\r\n    }\r\n    title += `${activityInTitle}: `;\r\n\r\n    if (showTimestampInDescription) {\r\n        description += `<br><small>${status.create_time}</small><br>`;\r\n    }\r\n\r\n    let text = status.text;\r\n    let lastIndex = 0;\r\n    const replacedTextSegements = [];\r\n    for (const entity of status.entities) {\r\n        replacedTextSegements.push(\r\n            text.slice(lastIndex, entity.start),\r\n            `<a href=\"${entity.uri.replace('douban://douban.com', 'https://www.douban.com/doubanapp/dispatch?uri=')}\" target=\"_blank\" rel=\"noopener noreferrer\">${entity.title}</a>`\r\n        );\r\n        lastIndex = entity.end;\r\n    }\r\n    replacedTextSegements.push(text.slice(lastIndex));\r\n    text = replacedTextSegements.join('');\r\n\r\n    // text // images // video_info // parent status\r\n\r\n    description += text;\r\n\r\n    if (status.card) {\r\n        title += status.card.rating ? `《${status.card.title}》` : `「${status.card.title}」`;\r\n    }\r\n\r\n    if (status.activity !== '转发' || showRetweetTextInTitle) {\r\n        title += status.text.replace('\\n', '');\r\n    }\r\n\r\n    if (status.images && status.images.length) {\r\n        description += readable ? `<br clear=\"both\" /><div style=\"clear: both\"></div>` : `<br>`;\r\n\r\n        // 一些RSS Reader会识别所有<img>标签作为内含图片显示，我们不想要头像也作为内含图片之一\r\n        // 让所有配图在description的最前面再次出现一次，但宽高设为0\r\n        let picsPrefix = '';\r\n        for (const image of status.images) {\r\n            if (!(image.large && image.large.url)) {\r\n                continue;\r\n            }\r\n            picsPrefix += `<img width=\"0\" height=\"0\" hidden=\"true\" src=\"${image.large.url}\">`;\r\n        }\r\n        picsPrefixes.push(picsPrefix);\r\n\r\n        for (const image of status.images) {\r\n            if (!(image.large && image.large.url)) {\r\n                description += '[无法显示的图片]';\r\n                continue;\r\n            }\r\n\r\n            if (addLinkForPics) {\r\n                description += '<a href=\"' + image.large.url + '\" target=\"_blank\" rel=\"noopener noreferrer\">';\r\n            }\r\n            if (!readable) {\r\n                description += '<br>';\r\n            }\r\n            let style = '';\r\n            description += '<img ';\r\n            if (widthOfPics >= 0) {\r\n                description += ` width=\"${widthOfPics}\"`;\r\n                style += `width: ${widthOfPics}px;`;\r\n            }\r\n            if (heightOfPics >= 0) {\r\n                description += `height=\"${heightOfPics}\" `;\r\n                style += `height: ${heightOfPics}px;`;\r\n            }\r\n            description += ` style=\"${style}\" ` + (readable ? 'vspace=\"8\" hspace=\"4\" ' : '') + ' src=\"' + image.large.url + '\">';\r\n            if (addLinkForPics) {\r\n                description += '</a>';\r\n            }\r\n        }\r\n    }\r\n\r\n    if (status.video_info) {\r\n        description += readable ? `<br clear=\"both\" /><div style=\"clear: both\"></div>` : `<br>`;\r\n        const videoCover = status.video_info.cover_url;\r\n        const videoSrc = status.video_info.video_url;\r\n        if (videoSrc) {\r\n            description = `\r\n                ${description}\r\n                <video\r\n                    src=\"${videoSrc}\"\r\n                    ${videoCover ? `poster=\"${videoCover}\"` : ''}\r\n                >\r\n                </video>\r\n            `;\r\n        }\r\n    }\r\n\r\n    if (status.parent_status) {\r\n        description += showEmojiForRetweet ? ' 🔁 ' : ' Fw: ';\r\n        if (showRetweetTextInTitle) {\r\n            title += showEmojiForRetweet ? ' 🔁 ' : ' Fw: ';\r\n        }\r\n\r\n        const { isFixSuccess: isParentFixSuccess, why: parentWhy } = tryFixStatus(status.parent_status);\r\n\r\n        if (isParentFixSuccess) {\r\n            let usernameAndAvatar = '';\r\n\r\n            if (readable) {\r\n                usernameAndAvatar += `<a href=\"${status.parent_status.author.url}\">`;\r\n            }\r\n            if (authorNameBold) {\r\n                usernameAndAvatar += `<strong>`;\r\n            }\r\n            usernameAndAvatar += status.parent_status.author.name;\r\n            if (authorNameBold) {\r\n                usernameAndAvatar += `</strong>`;\r\n            }\r\n            if (readable) {\r\n                usernameAndAvatar += `</a>`;\r\n            }\r\n            usernameAndAvatar += `:&ensp;`;\r\n            description += usernameAndAvatar + status.parent_status.text;\r\n            if (showRetweetTextInTitle) {\r\n                title += status.parent_status.author.name + ': ' + status.parent_status.text;\r\n            }\r\n        } else {\r\n            description += parentWhy;\r\n            if (showRetweetTextInTitle) {\r\n                title += parentWhy;\r\n            }\r\n        }\r\n    }\r\n\r\n    // card\r\n    if (status.card) {\r\n        let image;\r\n        if (status.card.image && (status.card.image.large || status.card.image.normal)) {\r\n            image = status.card.image.large || status.card.image.normal;\r\n        }\r\n\r\n        description += readable ? `<br clear=\"both\" /><div style=\"clear: both\"></div><blockquote style=\"background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;\">` : `<br>`;\r\n        if (image) {\r\n            description += `<img src=\"${image.url}\" ${readable ? 'vspace=\"0\" hspace=\"12\" align=\"left\" height=\"75\" style=\"height: 75px;\"' : ''} />`;\r\n        }\r\n\r\n        if (!status.card.title) {\r\n            status.card.title = '[空]';\r\n        }\r\n        if (!status.card.subtitle) {\r\n            status.card.subtitle = '[空]';\r\n        }\r\n        if (!status.card.url) {\r\n            status.card.url = 'https://www.douban.com';\r\n        }\r\n\r\n        description += `<a href=\"${status.card.url}\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>${status.card.title}</strong><br><small>${status.card.subtitle}</small>`;\r\n        if (status.card.rating) {\r\n            description += `<br><small>评分：${status.card.rating.value}</small>`;\r\n        }\r\n        description += `</a>`;\r\n        if (readable) {\r\n            description += `<br clear=\"both\" /><div style=\"clear: both\"></div></blockquote>`;\r\n        }\r\n    }\r\n\r\n    // video_card\r\n    if (status.video_card) {\r\n        description += readable ? `<br clear=\"both\" /><div style=\"clear: both\"></div><blockquote style=\"background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;\">` : `<br>`;\r\n        const videoCover = status.video_card.video_info && status.video_card.video_info.cover_url;\r\n        const videoSrc = status.video_card.video_info && status.video_card.video_info.video_url;\r\n\r\n        if (!status.video_card.url) {\r\n            status.video_card.url = 'https://www.douban.com';\r\n        }\r\n\r\n        description += `${videoSrc ? `<video src=\"${videoSrc}\" ${videoCover ? `poster=\"${videoCover}\"` : ''}></video>` : ''}<br>${status.video_card.title ? `<a href=\"${status.video_card.url}\">${status.video_card.title}</a>` : ''}`;\r\n        if (readable) {\r\n            description += `</blockquote>`;\r\n        }\r\n    }\r\n\r\n    // reshared_status\r\n    if (status.reshared_status) {\r\n        description += readable ? `<br clear=\"both\" /><div style=\"clear: both\"></div><blockquote style=\"background: #80808010;border-top:1px solid #80808030;border-bottom:1px solid #80808030;margin:0;padding:5px 20px;\">` : `<br>`;\r\n\r\n        if (showRetweetTextInTitle) {\r\n            title += ' | ';\r\n        }\r\n\r\n        if (isResharedFixSuccess) {\r\n            description += getContentByActivity(\r\n                ctx,\r\n                { status: status.reshared_status, comments: [] },\r\n                {\r\n                    showAuthorInDesc: true,\r\n                    showAuthorAvatarInDesc: false,\r\n                    showComments: false,\r\n                    showColonInDesc: true,\r\n                },\r\n                picsPrefixes\r\n            ).description;\r\n            title += status.reshared_status.text;\r\n            const reshared_url = status.reshared_status.uri.replace('douban://douban.com', 'https://www.douban.com/doubanapp/dispatch?uri=');\r\n\r\n            if (readable) {\r\n                description += `<br><small>原动态：<a href=\"${reshared_url}\" target=\"_blank\" rel=\"noopener noreferrer\">${reshared_url}</a></small><br clear=\"both\" /><div style=\"clear: both\"></div></blockquote>`;\r\n            }\r\n        } else {\r\n            description += resharedWhy;\r\n            title += resharedWhy;\r\n        }\r\n    }\r\n\r\n    // comments\r\n    if (showComments) {\r\n        if (comments.length > 0) {\r\n            description += '<hr>';\r\n        }\r\n        for (const comment of comments) {\r\n            description += `<br>${comment.text} - <a href=\"${comment.author.url}\" target=\"_blank\" rel=\"noopener noreferrer\">${comment.author.name}</a>`;\r\n        }\r\n    }\r\n\r\n    if (showAuthorInDesc && showAuthorAvatarInDesc) {\r\n        description = picsPrefixes.join('') + description;\r\n    }\r\n    description = description.trim().replaceAll('\\n', '<br>');\r\n    return { title, description };\r\n}\r\n\r\nasync function getFullTextItems(items) {\r\n    const prefix = 'https://m.douban.com/rexxar/api/v2/status/';\r\n\r\n    await Promise.all(\r\n        items.map(async (item) => {\r\n            let url = prefix + item.status.id;\r\n            let cacheResult = await cache.get(url);\r\n            if (cacheResult) {\r\n                item.status.text = cacheResult;\r\n            } else {\r\n                const {\r\n                    data: { text },\r\n                } = await got({ url, headers });\r\n                cache.set(url, text);\r\n                item.status.text = text;\r\n            }\r\n            // retweet\r\n            if (!item.status.reshared_status) {\r\n                return;\r\n            }\r\n            url = prefix + item.status.reshared_status.id;\r\n            cacheResult = await cache.get(url);\r\n            if (cacheResult) {\r\n                item.status.reshared_status.text = cacheResult;\r\n            } else if (tryFixStatus(item.status.reshared_status).isFixSuccess) {\r\n                try {\r\n                    // 存在reshared_status字段正常，但尝试获取时返回403的情况。比如原po被炸号就可能这样。\r\n                    const {\r\n                        data: { text },\r\n                    } = await got({ url, headers });\r\n                    cache.set(url, text);\r\n                    item.status.reshared_status.text = text;\r\n                } catch {\r\n                    item.status.reshared_status.text += '\\n[获取原动态失败]';\r\n                }\r\n            }\r\n        })\r\n    );\r\n}\r\n\r\nasync function handler(ctx) {\r\n    const userid = ctx.req.param('userid');\r\n    const url = `https://m.douban.com/rexxar/api/v2/status/user_timeline/${userid}`;\r\n    const items = await cache.tryGet(\r\n        url,\r\n        async () => {\r\n            const _r = await got({ url, headers });\r\n            return _r.data.items;\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    );\r\n\r\n    if (items) {\r\n        await getFullTextItems(items);\r\n    }\r\n\r\n    return {\r\n        title: `豆瓣广播 - ${items ? items[0].status.author.name : userid}`,\r\n        link: `https://m.douban.com/people/${userid}/statuses`,\r\n        item:\r\n            items &&\r\n            items\r\n                .filter((item) => !item.deleted)\r\n                .map((item) => {\r\n                    const r = getContentByActivity(ctx, item);\r\n                    return {\r\n                        title: r.title,\r\n                        link: item.status.sharing_url.replace(/\\?_i=(.*)/, ''),\r\n                        pubDate: new Date(Date.parse(item.status.create_time + ' GMT+0800')).toUTCString(),\r\n                        description: r.description,\r\n                    };\r\n                }),\r\n    };\r\n}\r\n"],"mappings":"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"}