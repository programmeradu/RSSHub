{"version":3,"file":"topic-w-P5ufl0.js","names":[],"sources":["../../lib/routes/learnku/topic.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/:community/:category?',\r\n    categories: ['bbs'],\r\n    example: '/learnku/laravel/qa',\r\n    parameters: { community: '社区 标识，可在 <https://learnku.com/communities> 找到', category: '分类，如果不传 `category` 则获取全部分类' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['learnku.com/:community'],\r\n            target: '/:community',\r\n        },\r\n    ],\r\n    name: '社区',\r\n    maintainers: ['kayw-geek'],\r\n    handler,\r\n    description: `| 招聘 | 翻译         | 问答 | 链接  |\r\n| ---- | ------------ | ---- | ----- |\r\n| jobs | translations | qa   | links |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const community = ctx.req.param('community');\r\n    const category = ctx.req.param('category') || '';\r\n\r\n    let url = `https://learnku.com/${community}`;\r\n    if (category !== '') {\r\n        url = `https://learnku.com/${community}/c/${category}`;\r\n    }\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n    });\r\n\r\n    const data = response.data;\r\n    const $ = load(data);\r\n    const list = $('.simple-topic').toArray();\r\n    const item = await Promise.all(\r\n        list.map(async (item) => {\r\n            const $ = load(item);\r\n            const categoryName = $('.category-name span').text().trim();\r\n            if (['置顶', '广告'].includes(categoryName)) {\r\n                return '';\r\n            }\r\n            $('.topic-title i').remove();\r\n            const itemLink = $('.topic-title-wrap').attr('href');\r\n\r\n            const title = $('.topic-title').text().trim();\r\n            const content = await cache.tryGet(itemLink, async () => {\r\n                const result = await got.get(itemLink);\r\n\r\n                return load(result.data);\r\n            });\r\n            const article = content('.article-content .content-body').html();\r\n            const comment = content('#all-comments').html();\r\n\r\n            return {\r\n                title,\r\n                description: art(path.join(__dirname, 'templates/topic.art'), {\r\n                    article,\r\n                    comment,\r\n                }),\r\n                category: categoryName,\r\n                link: itemLink,\r\n                pubDate: parseDate($('.timeago').attr('title'), 'YYYY/MM/DD'),\r\n            };\r\n        })\r\n    );\r\n\r\n    const title = $('.sidebar .community-details .header span').text();\r\n    $('.sidebar .community-details .main div div a').remove();\r\n    const description = $('.sidebar .community-details .main div div').text();\r\n    const categoryTitle = new Map([\r\n        ['translations', { name: '翻译' }],\r\n        ['jobs', { name: '招聘' }],\r\n        ['qa', { name: '问答' }],\r\n        ['links', { name: '链接' }],\r\n        ['', { name: '最新' }],\r\n    ]);\r\n    return {\r\n        title: `LearnKu - ${title} - ${categoryTitle.get(category).name}`,\r\n        link: url,\r\n        description,\r\n        item: item.filter((item) => item !== ''),\r\n    };\r\n}\r\n"],"mappings":"wdASA,MAAa,EAAe,CACxB,KAAM,yBACN,WAAY,CAAC,OACb,QAAS,sBACT,WAAY,CAAE,UAAW,gDAAiD,SAAU,8BACpF,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,0BACT,OAAQ,gBAGhB,KAAM,KACN,YAAa,CAAC,aACd,UACA,YAAa;;yCAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAY,EAAI,IAAI,MAAM,aAC1B,EAAW,EAAI,IAAI,MAAM,aAAe,GAE1C,EAAM,uBAAuB,IAC7B,IAAa,KACb,EAAM,uBAAuB,EAAU,KAAK,KAGhD,IAAM,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,QAGE,EAAO,EAAS,KAChB,EAAI,EAAK,GACT,EAAO,EAAE,iBAAiB,UAC1B,EAAO,MAAM,QAAQ,IACvB,EAAK,IAAI,KAAO,IAAS,CACrB,IAAM,EAAI,EAAK,GACT,EAAe,EAAE,uBAAuB,OAAO,OACrD,GAAI,CAAC,KAAM,MAAM,SAAS,GACtB,MAAO,GAEX,EAAE,kBAAkB,SACpB,IAAM,EAAW,EAAE,qBAAqB,KAAK,QAEvC,EAAQ,EAAE,gBAAgB,OAAO,OACjC,EAAU,MAAM,EAAM,OAAO,EAAU,SAAY,CACrD,IAAM,EAAS,MAAM,EAAI,IAAI,GAE7B,OAAO,EAAK,EAAO,QAEjB,EAAU,EAAQ,kCAAkC,OACpD,EAAU,EAAQ,iBAAiB,OAEzC,MAAO,CACH,MAAA,EACA,YAAa,EAAI,EAAA,KAAA,EAAA,gCAA6C,CAC1D,UACA,YAEJ,SAAU,EACV,KAAM,EACN,QAAS,EAAU,EAAE,YAAY,KAAK,SAAU,kBAKtD,EAAQ,EAAE,4CAA4C,OAC5D,EAAE,+CAA+C,SACjD,IAAM,EAAc,EAAE,6CAA6C,OAC7D,EAAgB,IAAI,IAAI,CAC1B,CAAC,eAAgB,CAAE,KAAM,OACzB,CAAC,OAAQ,CAAE,KAAM,OACjB,CAAC,KAAM,CAAE,KAAM,OACf,CAAC,QAAS,CAAE,KAAM,OAClB,CAAC,GAAI,CAAE,KAAM,SAEjB,MAAO,CACH,MAAO,aAAa,EAAM,KAAK,EAAc,IAAI,GAAU,OAC3D,KAAM,EACN,cACA,KAAM,EAAK,OAAQ,GAAS,IAAS"}