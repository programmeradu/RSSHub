{"version":3,"file":"category-DGUsWpo5.js","names":["route: Route","InvalidParameterError","got","cache"],"sources":["../../lib/routes/caixin/category.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { isValidHost } from '@/utils/valid-host';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseArticle } from './utils';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nexport const route: Route = {\r\n    path: '/:column/:category',\r\n    categories: ['traditional-media'],\r\n    example: '/caixin/finance/regulation',\r\n    parameters: { column: '栏目名', category: '栏目下的子分类名' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: true,\r\n        supportScihub: false,\r\n    },\r\n    name: '新闻分类',\r\n    maintainers: ['idealclover'],\r\n    handler,\r\n    description: `Column 列表：\r\n\r\n| 经济    | 金融    | 政经  | 环科    | 世界          | 观点网  | 文化    | 周刊   |\r\n| ------- | ------- | ----- | ------- | ------------- | ------- | ------- | ------ |\r\n| economy | finance | china | science | international | opinion | culture | weekly |\r\n\r\n  以金融板块为例的 category 列表：（其余 column 以类似方式寻找）\r\n\r\n| 监管       | 银行 | 证券基金 | 信托保险         | 投资       | 创新       | 市场   |\r\n| ---------- | ---- | -------- | ---------------- | ---------- | ---------- | ------ |\r\n| regulation | bank | stock    | insurance\\_trust | investment | innovation | market |\r\n\r\n  Category 列表：\r\n\r\n| 封面报道   | 开卷  | 社论      | 时事             | 编辑寄语     | 经济    | 金融    | 商业     | 环境与科技              | 民生    | 副刊   |\r\n| ---------- | ----- | --------- | ---------------- | ------------ | ------- | ------- | -------- | ----------------------- | ------- | ------ |\r\n| coverstory | first | editorial | current\\_affairs | editor\\_desk | economy | finance | business | environment\\_technology | cwcivil | column |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category');\r\n    const column = ctx.req.param('column');\r\n    const url = `https://${column}.caixin.com/${category}`;\r\n    if (!isValidHost(column)) {\r\n        throw new InvalidParameterError('Invalid column');\r\n    }\r\n\r\n    const response = await got(url);\r\n\r\n    const $ = load(response.data);\r\n    const title = $('head title').text();\r\n    const entity = JSON.parse(\r\n        $('script')\r\n            .text()\r\n            .match(/var entity = ({.*?})/)[1]\r\n    );\r\n\r\n    const {\r\n        data: { datas: data },\r\n    } = await got('https://gateway.caixin.com/api/extapi/homeInterface.jsp', {\r\n        searchParams: {\r\n            subject: entity.id,\r\n            type: 0,\r\n            count: ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 25,\r\n            picdim: '_266_177',\r\n            start: 0,\r\n        },\r\n    });\r\n\r\n    const list = data.map((item) => ({\r\n        title: item.desc,\r\n        description: item.summ,\r\n        link: item.link.replace('http://', 'https://'),\r\n        pubDate: timezone(parseDate(item.time), +8),\r\n        category: item.keyword.split(' '),\r\n        audio: item.audioUrl,\r\n        audio_image_url: item.pict.imgs[0].url,\r\n    }));\r\n\r\n    const items = await Promise.all(list.map((item) => cache.tryGet(item.link, () => parseArticle(item))));\r\n\r\n    return {\r\n        title,\r\n        link: url,\r\n        description: '财新网 - 提供财经新闻及资讯服务',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"6mBAUA,MAAaA,EAAe,CACxB,KAAM,qBACN,WAAY,CAAC,qBACb,QAAS,6BACT,WAAY,CAAE,OAAQ,MAAO,SAAU,YACvC,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,eACd,UACA,YAAa;;;;;;;;;;;;;;;;gJAmBjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAS,EAAI,IAAI,MAAM,UACvB,EAAM,WAAW,EAAO,cAAc,IAC5C,GAAI,CAAC,EAAY,GACb,MAAM,IAAIC,EAAsB,kBAGpC,IAAM,EAAW,MAAMC,EAAI,GAErB,EAAI,EAAK,EAAS,MAClB,EAAQ,EAAE,cAAc,OACxB,EAAS,KAAK,MAChB,EAAE,UACG,OACA,MAAM,wBAAwB,IAGjC,CACF,KAAM,CAAE,MAAO,IACf,MAAMA,EAAI,0DAA2D,CACrE,aAAc,CACV,QAAS,EAAO,GAChB,KAAM,EACN,MAAO,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GAC1E,OAAQ,WACR,MAAO,KAIT,EAAO,EAAK,IAAK,IAAU,CAC7B,MAAO,EAAK,KACZ,YAAa,EAAK,KAClB,KAAM,EAAK,KAAK,QAAQ,UAAW,YACnC,QAAS,EAAS,EAAU,EAAK,MAAO,GACxC,SAAU,EAAK,QAAQ,MAAM,KAC7B,MAAO,EAAK,SACZ,gBAAiB,EAAK,KAAK,KAAK,GAAG,OAGjC,EAAQ,MAAM,QAAQ,IAAI,EAAK,IAAK,GAASC,EAAM,OAAO,EAAK,SAAY,EAAa,MAE9F,MAAO,CACH,QACA,KAAM,EACN,YAAa,oBACb,KAAM"}