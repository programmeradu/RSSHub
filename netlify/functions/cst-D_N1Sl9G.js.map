{"version":3,"file":"cst-D_N1Sl9G.js","names":["got","route: Route","cache"],"sources":["../../lib/routes/zju/cst/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst host = 'http://www.cst.zju.edu.cn/';\r\n\r\nconst map = new Map([\r\n    [0, { id: '', title: '浙大软件学院-全部通知' }],\r\n    [1, { id: '32178/list.htm', title: '浙大软件学院-招生信息' }],\r\n    [2, { id: '36216/list.htm', title: '浙大软件学院-教务管理' }],\r\n    [3, { id: '36217/list.htm', title: '浙大软件学院-论文管理' }],\r\n    [4, { id: '36224/list.htm', title: '浙大软件学院-思政工作' }],\r\n    [5, { id: '36228/list.htm', title: '浙大软件学院-评奖评优' }],\r\n    [6, { id: '36233/list.htm', title: '浙大软件学院-实习就业' }],\r\n    [7, { id: '36235/list.htm', title: '浙大软件学院-国际实习' }],\r\n    [8, { id: '36194/list.htm', title: '浙大软件学院-国内合作科研' }],\r\n    [9, { id: '36246/list.htm', title: '浙大软件学院-国际合作科研' }],\r\n    [10, { id: '36195/list.htm', title: '浙大软件学院-校园服务' }],\r\n]);\r\n\r\nasync function getPage(id) {\r\n    const res = await got({\r\n        method: 'get',\r\n        url: host + id,\r\n    });\r\n\r\n    const $ = load(res.data);\r\n    const list = $('.lm_new').find('li');\r\n\r\n    return list.toArray().map((item) => {\r\n        item = $(item);\r\n        return {\r\n            title: item.find('a').text(),\r\n            pubDate: parseDate(item.find('.fr').text()),\r\n            link: new URL(item.find('a').attr('href'), host).href,\r\n        };\r\n    });\r\n}\r\n\r\nexport const route: Route = {\r\n    path: '/cst/:type',\r\n    categories: ['university'],\r\n    example: '/zju/cst/0',\r\n    parameters: { type: '分类，见下表' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '软件学院',\r\n    description: `| 全部通知 | 招生信息 | 教务管理 | 论文管理 | 思政工作 | 评奖评优 | 实习就业 | 国际实习 | 国内合作科研 | 国际合作科研 | 校园服务 |\r\n| -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | ------------ | ------------ | -------- |\r\n| 0        | 1        | 2        | 3        | 4        | 5        | 6        | 7        | 8            | 9            | 10       |`,\r\n    maintainers: ['yonvenne', 'zwithz'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = Number.parseInt(ctx.req.param('type'));\r\n    const link = host + map.get(type).id;\r\n    let items = [];\r\n    if (type === 0) {\r\n        const tasks = [];\r\n        for (const value of map.values()) {\r\n            tasks.push(getPage(value.id));\r\n        }\r\n        const results = await Promise.all(tasks);\r\n        for (const result of results) {\r\n            items = [...items, ...result];\r\n        }\r\n    } else {\r\n        items = await getPage(map.get(type).id);\r\n    }\r\n\r\n    const out = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                    headers: {\r\n                        Referer: link,\r\n                    },\r\n                });\r\n                const $ = load(response.data);\r\n                item.description = $('.vid_wz').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: map.get(type).title,\r\n        link,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAM,EAAO,6BAEP,EAAM,IAAI,IAAI,CAChB,CAAC,EAAG,CAAE,GAAI,GAAI,MAAO,gBACrB,CAAC,EAAG,CAAE,GAAI,iBAAkB,MAAO,gBACnC,CAAC,EAAG,CAAE,GAAI,iBAAkB,MAAO,gBACnC,CAAC,EAAG,CAAE,GAAI,iBAAkB,MAAO,gBACnC,CAAC,EAAG,CAAE,GAAI,iBAAkB,MAAO,gBACnC,CAAC,EAAG,CAAE,GAAI,iBAAkB,MAAO,gBACnC,CAAC,EAAG,CAAE,GAAI,iBAAkB,MAAO,gBACnC,CAAC,EAAG,CAAE,GAAI,iBAAkB,MAAO,gBACnC,CAAC,EAAG,CAAE,GAAI,iBAAkB,MAAO,kBACnC,CAAC,EAAG,CAAE,GAAI,iBAAkB,MAAO,kBACnC,CAAC,GAAI,CAAE,GAAI,iBAAkB,MAAO,kBAGxC,eAAe,EAAQ,EAAI,CACvB,IAAM,EAAM,MAAMA,EAAI,CAClB,OAAQ,MACR,IAAK,EAAO,IAGV,EAAI,EAAK,EAAI,MACb,EAAO,EAAE,WAAW,KAAK,MAE/B,OAAO,EAAK,UAAU,IAAK,IACvB,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,KAAK,OACtB,QAAS,EAAU,EAAK,KAAK,OAAO,QACpC,KAAM,IAAI,IAAI,EAAK,KAAK,KAAK,KAAK,QAAS,GAAM,QAK7D,MAAaC,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,cACb,QAAS,aACT,WAAY,CAAE,KAAM,UACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa;;oIAGb,YAAa,CAAC,WAAY,UAC1B,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,OAAO,SAAS,EAAI,IAAI,MAAM,SACrC,EAAO,EAAO,EAAI,IAAI,GAAM,GAC9B,EAAQ,GACZ,GAAI,IAAS,EAAG,CACZ,IAAM,EAAQ,GACd,IAAK,IAAM,KAAS,EAAI,SACpB,EAAM,KAAK,EAAQ,EAAM,KAE7B,IAAM,EAAU,MAAM,QAAQ,IAAI,GAClC,IAAK,IAAM,KAAU,EACjB,EAAQ,CAAC,GAAG,EAAO,GAAG,QAG1B,EAAQ,MAAM,EAAQ,EAAI,IAAI,GAAM,IAGxC,IAAM,EAAM,MAAM,QAAQ,IACtB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAW,MAAMF,EAAI,CACvB,OAAQ,MACR,IAAK,EAAK,KACV,QAAS,CACL,QAAS,KAGX,EAAI,EAAK,EAAS,MAExB,MADA,GAAK,YAAc,EAAE,WAAW,OACzB,MAKnB,MAAO,CACH,MAAO,EAAI,IAAI,GAAM,MACrB,OACA,KAAM"}