{"version":3,"file":"utils-B3yphdlI.js","names":[],"sources":["../../lib/routes/jpxgmn/utils.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { art } from '@/utils/render';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport path from 'node:path';\r\n\r\nconst indexUrl = 'http://mei8.vip/';\r\n\r\nconst getOriginUrl = async () =>\r\n    await cache.tryGet('jpxgmn:originUrl', async () => {\r\n        const response = await got(indexUrl);\r\n        const $ = load(response.data);\r\n        const entries = $('ul > li > span');\r\n        return 'http://' + $(entries[Math.floor(Math.random() * entries.length)]).text();\r\n    });\r\nconst getImages = ($articleContent) =>\r\n    $articleContent('article > p img')\r\n        .toArray()\r\n        .map((img) => $articleContent(img).attr('src'));\r\n\r\nconst getArticleDesc = async (articleUrl) => {\r\n    const response = await got(articleUrl);\r\n    const $content = load(response.data);\r\n    let pageCnt = $content('div.pagination:first ul a').length - 1;\r\n    if (pageCnt === -1) {\r\n        pageCnt = 1;\r\n    }\r\n    const images = getImages($content);\r\n    const otherImages = await Promise.all(\r\n        [...Array.from({ length: pageCnt - 1 }).keys()].map(async (pageIndex) => {\r\n            const pageUrl = articleUrl.replace('.html', `_${pageIndex + 1}.html`);\r\n            const pageResponse = await got(pageUrl);\r\n            return getImages(load(pageResponse.data));\r\n        })\r\n    );\r\n    return art(path.join(__dirname, 'templates/description.art'), {\r\n        images: [...images, ...otherImages.flat()],\r\n    });\r\n};\r\n\r\nexport { getOriginUrl, getArticleDesc };\r\n"],"mappings":"mRAMA,MAEM,EAAe,SACjB,MAAM,EAAM,OAAO,mBAAoB,SAAY,CAC/C,IAAM,EAAW,MAAM,EAAI,oBACrB,EAAI,EAAK,EAAS,MAClB,EAAU,EAAE,kBAClB,MAAO,UAAY,EAAE,EAAQ,KAAK,MAAM,KAAK,SAAW,EAAQ,UAAU,SAE5E,EAAa,GACf,EAAgB,mBACX,UACA,IAAK,GAAQ,EAAgB,GAAK,KAAK,QAE1C,EAAiB,KAAO,IAAe,CACzC,IAAM,EAAW,MAAM,EAAI,GACrB,EAAW,EAAK,EAAS,MAC3B,EAAU,EAAS,6BAA6B,OAAS,EACzD,IAAY,KACZ,EAAU,GAEd,IAAM,EAAS,EAAU,GACnB,EAAc,MAAM,QAAQ,IAC9B,CAAC,GAAG,MAAM,KAAK,CAAE,OAAQ,EAAU,IAAK,QAAQ,IAAI,KAAO,IAAc,CACrE,IAAM,EAAU,EAAW,QAAQ,QAAS,IAAI,EAAY,EAAE,QACxD,EAAe,MAAM,EAAI,GAC/B,OAAO,EAAU,EAAK,EAAa,UAG3C,OAAO,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAC1D,OAAQ,CAAC,GAAG,EAAQ,GAAG,EAAY"}