{"version":3,"file":"da-Bl7PnkCv.js","names":["route: Route","got","cache","$"],"sources":["../../lib/routes/zjut/da/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\nimport iconv from 'iconv-lite';\r\n\r\nconst rootUrl = 'http://www.design.zjut.edu.cn/';\r\nconst host = 'http://www.design.zjut.edu.cn/BigClass.jsp?';\r\n\r\nconst map = new Map([\r\n    [1, { id: 'bigclassid=16', title: '学院新闻 - 浙工大设建学院' }],\r\n    [2, { id: 'bigclassid=18', title: '公告通知 - 浙工大设建学院' }],\r\n    [3, { id: 'bigclassid=5&sid=25', title: '科研申报 - 浙工大设建学院' }],\r\n    [4, { id: 'bigclassid=5&sid=26', title: '科研成果 - 浙工大设建学院' }],\r\n    [5, { id: 'bigclassid=5&sid=27', title: '文件与资源 - 浙工大设建学院' }],\r\n    [6, { id: 'bigclassid=20', title: '学术交流 - 浙工大设建学院' }],\r\n]);\r\n\r\nexport const route: Route = {\r\n    path: '/da/:type',\r\n    categories: ['university'],\r\n    example: '/zjut/da/1',\r\n    parameters: { type: '分类，见下表' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '设计与建筑学院',\r\n    maintainers: ['yikZero'],\r\n    url: 'www.design.zjut.edu.cn',\r\n    handler,\r\n    description: `| 学院新闻 | 公告通知 | 科研申报 | 科研成果 | 文件与资源 | 学术交流 |\r\n| -------- | -------- | -------- | -------- | -------- | -------- |\r\n| 1        | 2        | 3        | 4        | 5        | 6        |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = Number.parseInt(ctx.req.param('type'));\r\n    const id = map.get(type)?.id;\r\n    const listResponse = await got(`${host}${id}`, {\r\n        responseType: 'buffer',\r\n    });\r\n    listResponse.data = iconv.decode(listResponse.data, 'gbk');\r\n    const $ = load(listResponse.data);\r\n\r\n    const list = $(\"td[class='newstd'] .news2\")\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const title = item.find('a').text();\r\n\r\n            let link = item.find('a').attr('href');\r\n            if (!link) {\r\n                return null;\r\n            }\r\n            if (!link.startsWith('http')) {\r\n                link = rootUrl + link;\r\n            }\r\n\r\n            const date = item.next().text().replace('[', '').replace(']', '');\r\n\r\n            return {\r\n                title,\r\n                description: '',\r\n                pubDate: parseDate(date),\r\n                link,\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const itemsResponse = await got(item.link);\r\n                const $ = load(itemsResponse.data);\r\n                item.description = $('div[style=\"line-height:27px;\"]').html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: map.get(type)?.title,\r\n        link: `${host}${id}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"kYAOA,MACM,EAAO,8CAEP,EAAM,IAAI,IAAI,CAChB,CAAC,EAAG,CAAE,GAAI,gBAAiB,MAAO,mBAClC,CAAC,EAAG,CAAE,GAAI,gBAAiB,MAAO,mBAClC,CAAC,EAAG,CAAE,GAAI,sBAAuB,MAAO,mBACxC,CAAC,EAAG,CAAE,GAAI,sBAAuB,MAAO,mBACxC,CAAC,EAAG,CAAE,GAAI,sBAAuB,MAAO,oBACxC,CAAC,EAAG,CAAE,GAAI,gBAAiB,MAAO,qBAGzBA,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,cACb,QAAS,aACT,WAAY,CAAE,KAAM,UACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,UACN,YAAa,CAAC,WACd,IAAK,yBACL,UACA,YAAa;;sEAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,OAAO,SAAS,EAAI,IAAI,MAAM,SACrC,EAAK,EAAI,IAAI,IAAO,GACpB,EAAe,MAAMC,EAAI,GAAG,IAAO,IAAM,CAC3C,aAAc,WAElB,EAAa,KAAO,EAAM,OAAO,EAAa,KAAM,OACpD,IAAM,EAAI,EAAK,EAAa,MAEtB,EAAO,EAAE,6BACV,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAQ,EAAK,KAAK,KAAK,OAEzB,EAAO,EAAK,KAAK,KAAK,KAAK,QAC/B,GAAI,CAAC,EACD,OAAO,KAEN,EAAK,WAAW,UACjB,EAAO,iCAAU,GAGrB,IAAM,EAAO,EAAK,OAAO,OAAO,QAAQ,IAAK,IAAI,QAAQ,IAAK,IAE9D,MAAO,CACH,QACA,YAAa,GACb,QAAS,EAAU,GACnB,UAIN,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAgB,MAAMD,EAAI,EAAK,MAC/BE,EAAI,EAAK,EAAc,MAG7B,MAFA,GAAK,YAAcA,EAAE,kCAAkC,OAEhD,MAKnB,MAAO,CACH,MAAO,EAAI,IAAI,IAAO,MACtB,KAAM,GAAG,IAAO,IAChB,KAAM"}