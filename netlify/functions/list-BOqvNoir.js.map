{"version":3,"file":"list-BOqvNoir.js","names":[],"sources":["../../lib/routes/8264/list.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport iconv from 'iconv-lite';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/list/:id?',\r\n    categories: ['bbs'],\r\n    example: '/8264/list/751',\r\n    parameters: { id: '列表 id，见下表，默认为 751，即热门推荐' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '列表',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `| 热门推荐 | 户外知识 | 户外装备 |\r\n| -------- | -------- | -------- |\r\n| 751      | 238      | 204      |\r\n\r\n<details>\r\n<summary>更多列表</summary>\r\n\r\n#### 热门推荐\r\n\r\n| 业界 | 国际 | 专访 | 图说 | 户外 | 登山 | 攀岩 |\r\n| ---- | ---- | ---- | ---- | ---- | ---- | ---- |\r\n| 489  | 733  | 746  | 902  | 914  | 934  | 935  |\r\n\r\n#### 户外知识\r\n\r\n| 徒步 | 露营 | 安全急救 | 领队 | 登雪山 |\r\n| ---- | ---- | -------- | ---- | ------ |\r\n| 242  | 950  | 931    | 920  | 915  |\r\n\r\n| 攀岩 | 骑行 | 跑步 | 滑雪 | 水上运动 |\r\n| ---- | ---- | ---- | ---- | -------- |\r\n| 916  | 917  | 918  | 919  | 921    |\r\n\r\n| 钓鱼 | 潜水 | 攀冰 | 冲浪 | 网球 |\r\n| ---- | ---- | ---- | ---- | ---- |\r\n| 951  | 952  | 953  | 966  | 967  |\r\n\r\n| 绳索知识 | 高尔夫 | 马术 | 户外摄影 | 羽毛球 |\r\n| -------- | ------ | ---- | -------- | ------ |\r\n| 968    | 969  | 970  | 973    | 971  |\r\n\r\n| 游泳 | 溯溪 | 健身 | 瑜伽 |\r\n| ---- | ---- | ---- | ---- |\r\n| 974  | 975  | 976  | 977  |\r\n\r\n#### 户外装备\r\n\r\n| 服装 | 冲锋衣 | 抓绒衣 | 皮肤衣 | 速干衣 |\r\n| ---- | ------ | ------ | ------ | ------ |\r\n| 209  | 923  | 924  | 925  | 926  |\r\n\r\n| 羽绒服 | 软壳 | 户外鞋 | 登山鞋 | 徒步鞋 |\r\n| ------ | ---- | ------ | ------ | ------ |\r\n| 927  | 929  | 211  | 928  | 930  |\r\n\r\n| 越野跑鞋 | 溯溪鞋 | 登山杖 | 帐篷 | 睡袋 |\r\n| -------- | ------ | ------ | ---- | ---- |\r\n| 933    | 932  | 220  | 208  | 212  |\r\n\r\n| 炉具 | 灯具 | 水具 | 面料 | 背包 |\r\n| ---- | ---- | ---- | ---- | ---- |\r\n| 792  | 218  | 219  | 222  | 207  |\r\n\r\n| 防潮垫 | 电子导航 | 冰岩绳索 | 综合装备 |\r\n| ------ | -------- | -------- | -------- |\r\n| 214  | 216    | 215    | 223    |\r\n</details>`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { id = '751' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 30;\r\n\r\n    const rootUrl = 'https://www.8264.com';\r\n    const currentUrl = new URL(`list/${id}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl, {\r\n        responseType: 'buffer',\r\n    });\r\n\r\n    const $ = load(iconv.decode(response, 'gbk'));\r\n\r\n    $('div.newslist_info').remove();\r\n\r\n    let items = $('div.newlist_r, div.newslist_r, div.bbslistone_name, dt')\r\n        .find('a')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const link = item.prop('href');\r\n\r\n            return {\r\n                title: item.text(),\r\n                link: link.startsWith('http') ? link : new URL(link, rootUrl).href,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link, {\r\n                    responseType: 'buffer',\r\n                });\r\n\r\n                const content = load(iconv.decode(detailResponse, 'gbk'));\r\n\r\n                content('a.syq, a.xlsj, a.titleoverflow200, #fjump').remove();\r\n                content('i.pstatus').remove();\r\n                content('div.crly').remove();\r\n\r\n                const pubDate = content('span.pub-time').text() || content('span.fby span').first().prop('title') || content('span.fby').first().text().split('发表于').pop().trim();\r\n\r\n                content('img').each(function () {\r\n                    content(this).replaceWith(\r\n                        art(path.join(__dirname, 'templates/description.art'), {\r\n                            image: {\r\n                                src: content(this).prop('file'),\r\n                                alt: content(this).prop('alt'),\r\n                            },\r\n                        })\r\n                    );\r\n                });\r\n\r\n                item.title = content('h1').first().text();\r\n                item.description = content('div.art-content, td.t_f').first().html();\r\n                item.author = content('a.user-name, #author').first().text();\r\n                item.category = content('div.fl_dh a, div.site a')\r\n                    .toArray()\r\n                    .map((c) => content(c).text().trim());\r\n                item.pubDate = timezone(parseDate(pubDate, ['YYYY-MM-DD HH:mm', 'YYYY-M-D HH:mm']), +8);\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const description = $('meta[name=\"description\"]').prop('content').trim();\r\n    const icon = new URL('favicon', rootUrl).href;\r\n\r\n    return {\r\n        item: items,\r\n        title: `${$('span.country, h2').text()} - ${description.split(',').pop()}`,\r\n        link: currentUrl,\r\n        description,\r\n        language: 'zh-cn',\r\n        icon,\r\n        logo: icon,\r\n        subtitle: $('meta[name=\"keywords\"]').prop('content').trim(),\r\n        author: $('meta[name=\"author\"]').prop('content'),\r\n    };\r\n}\r\n"],"mappings":"oiBAWA,MAAa,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,OACb,QAAS,iBACT,WAAY,CAAE,GAAI,2BAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;aA2DjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,KAAK,OAAU,EAAI,IAAI,QACzB,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,uBACV,EAAa,IAAI,IAAI,QAAQ,IAAM,GAAS,KAE5C,CAAE,KAAM,GAAa,MAAM,EAAI,EAAY,CAC7C,aAAc,WAGZ,EAAI,EAAK,EAAM,OAAO,EAAU,QAEtC,EAAE,qBAAqB,SAEvB,IAAI,EAAQ,EAAE,0DACT,KAAK,KACL,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAO,EAAK,KAAK,QAEvB,MAAO,CACH,MAAO,EAAK,OACZ,KAAM,EAAK,WAAW,QAAU,EAAO,IAAI,IAAI,EAAM,GAAS,QAI1E,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACP,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAM,EAAI,EAAK,KAAM,CAClD,aAAc,WAGZ,EAAU,EAAK,EAAM,OAAO,EAAgB,QAElD,EAAQ,6CAA6C,SACrD,EAAQ,aAAa,SACrB,EAAQ,YAAY,SAEpB,IAAM,EAAU,EAAQ,iBAAiB,QAAU,EAAQ,iBAAiB,QAAQ,KAAK,UAAY,EAAQ,YAAY,QAAQ,OAAO,MAAM,OAAO,MAAM,OAqB3J,OAnBA,EAAQ,OAAO,KAAK,UAAY,CAC5B,EAAQ,MAAM,YACV,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACnD,MAAO,CACH,IAAK,EAAQ,MAAM,KAAK,QACxB,IAAK,EAAQ,MAAM,KAAK,aAMxC,EAAK,MAAQ,EAAQ,MAAM,QAAQ,OACnC,EAAK,YAAc,EAAQ,2BAA2B,QAAQ,OAC9D,EAAK,OAAS,EAAQ,wBAAwB,QAAQ,OACtD,EAAK,SAAW,EAAQ,2BACnB,UACA,IAAK,GAAM,EAAQ,GAAG,OAAO,QAClC,EAAK,QAAU,EAAS,EAAU,EAAS,CAAC,mBAAoB,mBAAoB,GAE7E,MAKnB,IAAM,EAAc,EAAE,4BAA4B,KAAK,WAAW,OAC5D,EAAO,IAAI,IAAI,UAAW,GAAS,KAEzC,MAAO,CACH,KAAM,EACN,MAAO,GAAG,EAAE,oBAAoB,OAAO,KAAK,EAAY,MAAM,KAAK,QACnE,KAAM,EACN,cACA,SAAU,QACV,OACA,KAAM,EACN,SAAU,EAAE,yBAAyB,KAAK,WAAW,OACrD,OAAQ,EAAE,uBAAuB,KAAK"}