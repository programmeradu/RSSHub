{"version":3,"file":"xkb-Bn32kjtX.js","names":[],"sources":["../../lib/routes/xkb/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/:channel',\r\n    categories: ['traditional-media'],\r\n    example: '/xkb/350',\r\n    parameters: { channel: '栏目 ID，点击对应栏目后在地址栏找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '新闻',\r\n    maintainers: ['TimWu007'],\r\n    handler,\r\n    description: `常用栏目 ID：\r\n\r\n| 栏目名 | ID  |\r\n| ------ | --- |\r\n| 首页   | 350 |\r\n| 重点   | 359 |\r\n| 广州   | 353 |\r\n| 湾区   | 360 |\r\n| 天下   | 355 |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const channel = ctx.req.param('channel') ?? 350;\r\n    const currentUrl = `https://www.xkb.com.cn/xkbapp/fundapi/article/api/articles?chnlId=${channel}&visibility=1&page=0&size=20&keyword=`;\r\n\r\n    const { data: response } = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n        headers: {\r\n            siteId: 35,\r\n        },\r\n    });\r\n\r\n    const list = response.data\r\n        .filter((i) => i.contentUrl) // Remove \"专题报道\" (special report)\r\n        .map((item) => ({\r\n            title: item.listTitle,\r\n            description: art(path.join(__dirname, 'templates/description.art'), {\r\n                thumb: item.shareImg,\r\n            }),\r\n            pubDate: timezone(parseDate(item.operTime), +8),\r\n            link: 'https://www.xkb.com.cn/detail?id=' + item.id,\r\n            contentUrl: item.contentUrl,\r\n            author: item.metaInfo.author,\r\n            chnlName: item.metaInfo.chnlName,\r\n        }));\r\n\r\n    let chnlName = '';\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.contentUrl, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.contentUrl,\r\n                });\r\n                item.description += detailResponse.data.htmlContent ?? '';\r\n                chnlName = chnlName === '' ? item.chnlName : chnlName;\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `新快报新快网 - ${chnlName}`,\r\n        link: `https://www.xkb.com.cn/home?id=${channel}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"2eASA,MAAa,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,qBACb,QAAS,WACT,WAAY,CAAE,QAAS,uBACvB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,YACd,UACA,YAAa;;;;;;;;iBAWjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,EAAI,IAAI,MAAM,YAAc,IACtC,EAAa,qEAAqE,EAAQ,uCAE1F,CAAE,KAAM,GAAa,MAAM,EAAI,CACjC,OAAQ,MACR,IAAK,EACL,QAAS,CACL,OAAQ,MAIV,EAAO,EAAS,KACjB,OAAQ,GAAM,EAAE,YAChB,IAAK,IAAU,CACZ,MAAO,EAAK,UACZ,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,MAAO,EAAK,WAEhB,QAAS,EAAS,EAAU,EAAK,UAAW,GAC5C,KAAM,oCAAsC,EAAK,GACjD,WAAY,EAAK,WACjB,OAAQ,EAAK,SAAS,OACtB,SAAU,EAAK,SAAS,YAG5B,EAAW,GAET,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACN,EAAM,OAAO,EAAK,WAAY,SAAY,CACtC,IAAM,EAAiB,MAAM,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,aAId,MAFA,GAAK,aAAe,EAAe,KAAK,aAAe,GACvD,EAAW,IAAa,GAAK,EAAK,SAAW,EACtC,MAKnB,MAAO,CACH,MAAO,YAAY,IACnB,KAAM,kCAAkC,IACxC,KAAM"}