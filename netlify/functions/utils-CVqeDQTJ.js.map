{"version":3,"file":"utils-CVqeDQTJ.js","names":[],"sources":["../../lib/routes/furstar/utils.ts"],"sourcesContent":["import { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst base = 'https://furstar.jp';\r\n\r\nconst langBase = (lang) => (lang ? `${base}/${lang}` : base); // en, cn, (none, for JP)\r\n\r\nconst renderAuthor = (author) => art(path.join(__dirname, 'templates/author.art'), author);\r\nconst renderDesc = (desc, pics, author) =>\r\n    art(path.join(__dirname, 'templates/description.art'), {\r\n        desc,\r\n        pics,\r\n        author: renderAuthor(author),\r\n    });\r\n\r\nconst authorDetail = (el) => {\r\n    const $ = load(el);\r\n    // if there is <a>\r\n    const a = $('a');\r\n    const result = {\r\n        name: null,\r\n        avatar: null,\r\n        link: null,\r\n    };\r\n\r\n    if (a.length > 0) {\r\n        const img = $('a img');\r\n        result.name = img.attr('alt');\r\n        result.avatar = img.attr('src');\r\n        result.link = a.attr('href');\r\n    } else {\r\n        const desc = $('img');\r\n        result.name = desc.attr('alt');\r\n        result.avatar = desc.attr('src');\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\nconst detailPage = (link, cache) =>\r\n    cache.tryGet(link, async () => {\r\n        const result = await got(link, {\r\n            https: {\r\n                rejectUnauthorized: false,\r\n            },\r\n        });\r\n        const $ = load(result.data);\r\n        const title = $('.row .panel-heading h2').text().trim(); // Get first title\r\n        const desc = $('.character-description p').text().trim();\r\n        const pics = $('.img-gallery .prettyPhoto')\r\n            .toArray()\r\n            .map((e) => {\r\n                const p = load(e);\r\n                const link = p('a').attr('href').trim();\r\n                return `${base}/${link.slice(2)}`;\r\n            });\r\n\r\n        return {\r\n            title,\r\n            pics,\r\n            desc,\r\n            author: authorDetail($('.character-description').html()),\r\n        };\r\n    });\r\n\r\nconst fetchAllCharacters = (data, base) => {\r\n    // All character page\r\n    const $ = load(data);\r\n    const characters = $('.character-article');\r\n    const info = characters.toArray().map((e) => {\r\n        const c = load(e);\r\n        const r = {\r\n            title: c('.character-headline').text().trim(),\r\n            headImage: c('.character-images img').attr('src').trim(),\r\n            detailPage: `${base}/${c('.character-images a').attr('href').trim()}`,\r\n            author: authorDetail(c('.character-description').html()),\r\n        };\r\n        return r;\r\n    });\r\n\r\n    return info;\r\n};\r\n\r\nexport default {\r\n    BASE: base,\r\n    langBase,\r\n    fetchAllCharacters,\r\n    detailPage,\r\n    authorDetail,\r\n    renderDesc,\r\n    renderAuthor,\r\n};\r\n"],"mappings":"+NAKA,MAAM,EAAO,qBAEP,EAAY,GAAU,EAAO,GAAG,EAAK,GAAG,IAAS,EAEjD,EAAgB,GAAW,EAAI,EAAA,KAAA,EAAA,iCAA8C,GAC7E,GAAc,EAAM,EAAM,IAC5B,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACnD,OACA,OACA,OAAQ,EAAa,KAGvB,EAAgB,GAAO,CACzB,IAAM,EAAI,EAAK,GAET,EAAI,EAAE,KACN,EAAS,CACX,KAAM,KACN,OAAQ,KACR,KAAM,MAGV,GAAI,EAAE,OAAS,EAAG,CACd,IAAM,EAAM,EAAE,SACd,EAAO,KAAO,EAAI,KAAK,OACvB,EAAO,OAAS,EAAI,KAAK,OACzB,EAAO,KAAO,EAAE,KAAK,YAClB,CACH,IAAM,EAAO,EAAE,OACf,EAAO,KAAO,EAAK,KAAK,OACxB,EAAO,OAAS,EAAK,KAAK,OAG9B,OAAO,GAGL,GAAc,EAAM,IACtB,EAAM,OAAO,EAAM,SAAY,CAC3B,IAAM,EAAS,MAAM,EAAI,EAAM,CAC3B,MAAO,CACH,mBAAoB,MAGtB,EAAI,EAAK,EAAO,MAChB,EAAQ,EAAE,0BAA0B,OAAO,OAC3C,EAAO,EAAE,4BAA4B,OAAO,OAC5C,EAAO,EAAE,6BACV,UACA,IAAK,GAAM,CACR,IAAM,EAAI,EAAK,GACT,EAAO,EAAE,KAAK,KAAK,QAAQ,OACjC,MAAO,GAAG,EAAK,GAAG,EAAK,MAAM,OAGrC,MAAO,CACH,QACA,OACA,OACA,OAAQ,EAAa,EAAE,0BAA0B,WAIvD,GAAsB,EAAM,IAAS,CAEvC,IAAM,EAAI,EAAK,GACT,EAAa,EAAE,sBACf,EAAO,EAAW,UAAU,IAAK,GAAM,CACzC,IAAM,EAAI,EAAK,GACT,EAAI,CACN,MAAO,EAAE,uBAAuB,OAAO,OACvC,UAAW,EAAE,yBAAyB,KAAK,OAAO,OAClD,WAAY,GAAG,EAAK,GAAG,EAAE,uBAAuB,KAAK,QAAQ,SAC7D,OAAQ,EAAa,EAAE,0BAA0B,SAErD,OAAO,IAGX,OAAO,GAGX,IAAA,EAAe,CACX,KAAM,EACN,WACA,qBACA,aACA,eACA,aACA"}