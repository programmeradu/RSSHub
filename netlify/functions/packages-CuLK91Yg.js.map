{"version":3,"file":"packages-CuLK91Yg.js","names":["baseUrl: string","targetUrl: string","ofetch","$: CheerioAPI","title: string","description: string | undefined","pubDateStr: string | undefined","categoryEls: Element[]","categories: string[]","authorEls: Element[]","authors: DataItem['author']","$authorEl: Cheerio<Element>","guid: string","image: string | undefined","upDatedStr: string | undefined","processedItem: DataItem","items: DataItem[]","route: Route","id: string"],"sources":["../../lib/routes/chocolatey/packages.ts"],"sourcesContent":["import { type Data, type DataItem, type Route, ViewType } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { type CheerioAPI, type Cheerio, load } from 'cheerio';\r\nimport type { Element } from 'domhandler';\r\nimport { type Context } from 'hono';\r\n\r\nexport const handler = async (ctx: Context): Promise<Data> => {\r\n    const { id } = ctx.req.param();\r\n\r\n    const baseUrl: string = 'https://community.chocolatey.org';\r\n    const targetUrl: string = new URL(`packages/${id}`, baseUrl).href;\r\n\r\n    const response = await ofetch(targetUrl);\r\n    const $: CheerioAPI = load(response);\r\n    const language = $('html').attr('lang') ?? 'en';\r\n\r\n    const title: string = $('meta[property=\"og:title\"]').attr('content');\r\n    const description: string | undefined = $('div#description').html();\r\n    const pubDateStr: string | undefined = $('h3.mt-0.mb-3').last().text();\r\n    const categoryEls: Element[] = $('a[data-package-tag]').toArray();\r\n    const categories: string[] = [...new Set(categoryEls.map((el) => $(el).text()).filter(Boolean))];\r\n    const authorEls: Element[] = $('img[alt=\"gravatar\"]').toArray();\r\n    const authors: DataItem['author'] = authorEls.map((authorEl) => {\r\n        const $authorEl: Cheerio<Element> = $(authorEl).parent();\r\n\r\n        return {\r\n            name: $authorEl.find('span').text(),\r\n            url: $authorEl.attr('href') ? new URL($authorEl.attr('href') as string, baseUrl).href : undefined,\r\n            avatar: $authorEl.attr('src'),\r\n        };\r\n    });\r\n    const guid: string = `chocolatey-${title}`;\r\n    const image: string | undefined = $('div.package-logo img').attr('src') ? new URL($('div.package-logo img').attr('src') as string, baseUrl).href : undefined;\r\n    const upDatedStr: string | undefined = pubDateStr;\r\n\r\n    const processedItem: DataItem = {\r\n        title,\r\n        description,\r\n        pubDate: pubDateStr ? parseDate(pubDateStr) : undefined,\r\n        link: targetUrl,\r\n        category: categories,\r\n        author: authors,\r\n        guid,\r\n        id: guid,\r\n        content: {\r\n            html: description,\r\n            text: description,\r\n        },\r\n        image,\r\n        banner: image,\r\n        updated: upDatedStr ? parseDate(upDatedStr) : undefined,\r\n        language,\r\n    };\r\n\r\n    const items: DataItem[] = [processedItem];\r\n\r\n    return {\r\n        title: $('title').first().text(),\r\n        description: $('meta[property=\"og:description\"]').attr('content'),\r\n        link: targetUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image: $('meta[property=\"og:image\"]').attr('content'),\r\n        author: $('meta[property=\"og:site_name\"]').attr('content'),\r\n        language,\r\n        id: $('meta[property=\"og:url\"]').attr('content'),\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/packages/:id',\r\n    name: 'Package',\r\n    url: 'community.chocolatey.org',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/chocolatey/packages/microsoft-edge',\r\n    parameters: {\r\n        id: {\r\n            description: 'Package ID',\r\n        },\r\n    },\r\n    description: undefined,\r\n    categories: ['program-update'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['community.chocolatey.org/packages'],\r\n            target: (params) => {\r\n                const id: string = params.id;\r\n\r\n                return `/chocolatey/package${id ? `/${id}` : ''}`;\r\n            },\r\n        },\r\n    ],\r\n    view: ViewType.Notifications,\r\n\r\n    zh: {\r\n        path: '/packages/:id',\r\n        name: '程序包',\r\n        url: 'community.chocolatey.org',\r\n        maintainers: ['nczitzk'],\r\n        handler,\r\n        example: '/chocolatey/package/microsoft-edge',\r\n        parameters: {\r\n            id: {\r\n                description: '程序包 ID',\r\n            },\r\n        },\r\n        description: undefined,\r\n    },\r\n};\r\n"],"mappings":"8SASA,MAAa,EAAU,KAAO,IAAgC,CAC1D,GAAM,CAAE,MAAO,EAAI,IAAI,QAEjBA,EAAkB,mCAClBC,EAAoB,IAAI,IAAI,YAAY,IAAM,GAAS,KAEvD,EAAW,MAAMC,EAAO,GACxBC,EAAgB,EAAK,GACrB,EAAW,EAAE,QAAQ,KAAK,SAAW,KAErCC,EAAgB,EAAE,6BAA6B,KAAK,WACpDC,EAAkC,EAAE,mBAAmB,OACvDC,EAAiC,EAAE,gBAAgB,OAAO,OAC1DC,EAAyB,EAAE,uBAAuB,UAClDC,EAAuB,CAAC,GAAG,IAAI,IAAI,EAAY,IAAK,GAAO,EAAE,GAAI,QAAQ,OAAO,WAChFC,EAAuB,EAAE,uBAAuB,UAChDC,EAA8B,EAAU,IAAK,GAAa,CAC5D,IAAMC,EAA8B,EAAE,GAAU,SAEhD,MAAO,CACH,KAAM,EAAU,KAAK,QAAQ,OAC7B,IAAK,EAAU,KAAK,QAAU,IAAI,IAAI,EAAU,KAAK,QAAmB,GAAS,KAAO,IAAA,GACxF,OAAQ,EAAU,KAAK,UAGzBC,EAAe,cAAc,IAC7BC,EAA4B,EAAE,wBAAwB,KAAK,OAAS,IAAI,IAAI,EAAE,wBAAwB,KAAK,OAAkB,GAAS,KAAO,IAAA,GAC7IC,EAAiC,EAEjCC,EAA0B,CAC5B,QACA,cACA,QAAS,EAAa,EAAU,GAAc,IAAA,GAC9C,KAAM,EACN,SAAU,EACV,OAAQ,EACR,OACA,GAAI,EACJ,QAAS,CACL,KAAM,EACN,KAAM,GAEV,QACA,OAAQ,EACR,QAAS,EAAa,EAAU,GAAc,IAAA,GAC9C,YAGEC,EAAoB,CAAC,GAE3B,MAAO,CACH,MAAO,EAAE,SAAS,QAAQ,OAC1B,YAAa,EAAE,mCAAmC,KAAK,WACvD,KAAM,EACN,KAAM,EACN,WAAY,GACZ,MAAO,EAAE,6BAA6B,KAAK,WAC3C,OAAQ,EAAE,iCAAiC,KAAK,WAChD,WACA,GAAI,EAAE,2BAA2B,KAAK,aAIjCC,EAAe,CACxB,KAAM,gBACN,KAAM,UACN,IAAK,2BACL,YAAa,CAAC,WACd,UACA,QAAS,sCACT,WAAY,CACR,GAAI,CACA,YAAa,eAGrB,YAAa,IAAA,GACb,WAAY,CAAC,kBACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,qCACT,OAAS,GAAW,CAChB,IAAMC,EAAa,EAAO,GAE1B,MAAO,sBAAsB,EAAK,IAAI,IAAO,QAIzD,KAAM,EAAS,cAEf,GAAI,CACA,KAAM,gBACN,KAAM,MACN,IAAK,2BACL,YAAa,CAAC,WACd,UACA,QAAS,qCACT,WAAY,CACR,GAAI,CACA,YAAa,WAGrB,YAAa,IAAA"}