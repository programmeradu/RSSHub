{"version":3,"file":"ipsw-DH7mz2BE.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/ipsw/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nconst host = 'https://ipsw.me/';\r\n\r\nexport const route: Route = {\r\n    path: '/index/:ptype/:pname',\r\n    categories: ['program-update'],\r\n    example: '/ipsw/index/ipsws/iPad8,11',\r\n    parameters: {\r\n        ptype: 'Fill in ipsws or otas to get different versions of firmware',\r\n        pname: 'Product name, `http://rsshub.app/ipsw/index/ipsws/iPod`, if you fill in the iPad, follow the entire iPad series(ptype default to ipsws).`http://rsshub.app/ipsw/index/ipsws/iPhone11,8`, if you fill in the specific iPhone11,8, submit to the ipsws firmware information of this model',\r\n    },\r\n    name: 'Apple Firmware Update-IPSWs/OTAs version',\r\n    maintainers: ['Jeason0228'],\r\n    handler,\r\n};\r\n\r\nfunction replaceurl(e) {\r\n    e = e.replace(\"';\", '');\r\n    e = e.replace(\"window.location = '/\", host);\r\n    return e;\r\n}\r\n\r\nasync function handler(ctx) {\r\n    const { pname, ptype } = ctx.req.param();\r\n    let link = `https://ipsw.me/product/${pname}`;\r\n    if (pname.includes(',')) {\r\n        // console.log('具体产品');\r\n        if (ptype === 'otas') {\r\n            // console.log('otas');\r\n            link = `https://ipsw.me/${ptype}/${pname}`;\r\n        } else if (ptype === 'ipsws') {\r\n            // console.log('ipsw');\r\n            link = `https://ipsw.me/${pname}`;\r\n        }\r\n    } else {\r\n        // console.log('产品线');\r\n        link = `https://ipsw.me/product/${pname}`;\r\n    }\r\n    // console.log(link);\r\n    const response = await got({\r\n        method: 'get',\r\n        url: link,\r\n        headers: {\r\n            Referer: host,\r\n        },\r\n    });\r\n    const $ = load(response.data);\r\n    const list = pname.includes(',')\r\n        ? $('.firmware')\r\n              .toArray()\r\n              .map((item) => {\r\n                  const info = {\r\n                      title: $(item).find('td').eq(1).text(),\r\n                      link: replaceurl($(item).attr('onclick')),\r\n                  };\r\n                  return info;\r\n              })\r\n        : $('.products a')\r\n              .toArray()\r\n              .map((item) => {\r\n                  const info = {\r\n                      title: $(item).find('img').attr('alt'),\r\n                      link: $(item).attr('href'),\r\n                  };\r\n                  return info;\r\n              });\r\n\r\n    const out = await Promise.all(\r\n        list.map((info) => {\r\n            const title = info.title;\r\n            const itemUrl = new URL(info.link, host).href;\r\n\r\n            return cache.tryGet(itemUrl, async () => {\r\n                const response = await got({\r\n                    method: 'get',\r\n                    url: itemUrl,\r\n                    headers: {\r\n                        Referer: host,\r\n                    },\r\n                });\r\n                const $ = load(response.data);\r\n                const description = $('div.selector__wizard').html();\r\n                let removeString;\r\n                removeString = pname.includes(',') ? $('div.table-responsive table tr').first().find('td').text().trim() : $('tr.firmware').first().find('td').eq(2).text().trim();\r\n                // 处理发布日期,以表格第一行的日期为最新的发布日期\r\n                removeString = removeString.replace('th', '').replace('nd', '').replace('st', '').replace('rd', '');\r\n                const rdate = removeString.replaceAll(' ', ',');\r\n                return {\r\n                    title,\r\n                    link: itemUrl,\r\n                    description,\r\n                    pubDate: new Date(rdate).toLocaleDateString(),\r\n                    guid: title,\r\n                };\r\n            });\r\n        })\r\n    );\r\n    return {\r\n        title: `${pname} - ${ptype} Released`,\r\n        link,\r\n        description: `查看Apple-${pname}- ${ptype} 固件-是否关闭验证`,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"mTAKA,MAAM,EAAO,mBAEAA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,kBACb,QAAS,6BACT,WAAY,CACR,MAAO,8DACP,MAAO,2RAEX,KAAM,2CACN,YAAa,CAAC,cACd,WAGJ,SAAS,EAAW,EAAG,CAGnB,MAFA,GAAI,EAAE,QAAQ,KAAM,IACpB,EAAI,EAAE,QAAQ,uBAAwB,GAC/B,EAGX,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,QAAO,SAAU,EAAI,IAAI,QAC7B,EAAO,2BAA2B,IAClC,EAAM,SAAS,KAEX,IAAU,OAEV,EAAO,mBAAmB,EAAM,GAAG,IAC5B,IAAU,UAEjB,EAAO,mBAAmB,KAI9B,EAAO,2BAA2B,IAGtC,IAAM,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,KAGX,EAAI,EAAK,EAAS,MAClB,EAAO,EAAM,SAAS,KACtB,EAAE,aACG,UACA,IAAK,GAAS,CACX,IAAM,EAAO,CACT,MAAO,EAAE,GAAM,KAAK,MAAM,GAAG,GAAG,OAChC,KAAM,EAAW,EAAE,GAAM,KAAK,aAElC,OAAO,IAEf,EAAE,eACG,UACA,IAAK,GAAS,CACX,IAAM,EAAO,CACT,MAAO,EAAE,GAAM,KAAK,OAAO,KAAK,OAChC,KAAM,EAAE,GAAM,KAAK,SAEvB,OAAO,IAGf,EAAM,MAAM,QAAQ,IACtB,EAAK,IAAK,GAAS,CACf,IAAM,EAAQ,EAAK,MACb,EAAU,IAAI,IAAI,EAAK,KAAM,GAAM,KAEzC,OAAOC,EAAM,OAAO,EAAS,SAAY,CACrC,IAAMC,EAAW,MAAMF,EAAI,CACvB,OAAQ,MACR,IAAK,EACL,QAAS,CACL,QAAS,KAGXG,EAAI,EAAKD,EAAS,MAClB,EAAcC,EAAE,wBAAwB,OAC1C,EACJ,EAAe,EAAM,SAAS,KAAOA,EAAE,iCAAiC,QAAQ,KAAK,MAAM,OAAO,OAASA,EAAE,eAAe,QAAQ,KAAK,MAAM,GAAG,GAAG,OAAO,OAE5J,EAAe,EAAa,QAAQ,KAAM,IAAI,QAAQ,KAAM,IAAI,QAAQ,KAAM,IAAI,QAAQ,KAAM,IAChG,IAAM,EAAQ,EAAa,WAAW,IAAK,KAC3C,MAAO,CACH,QACA,KAAM,EACN,cACA,QAAS,IAAI,KAAK,GAAO,qBACzB,KAAM,QAKtB,MAAO,CACH,MAAO,GAAG,EAAM,KAAK,EAAM,WAC3B,OACA,YAAa,WAAW,EAAM,IAAI,EAAM,YACxC,KAAM"}