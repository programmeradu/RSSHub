{"version":3,"file":"search-DwXZe3Qh.js","names":[],"sources":["../../lib/routes/baidu/search.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nconst renderDescription = (description, images) => art(path.join(__dirname, './templates/description.art'), { description, images });\r\nimport { config } from '@/config';\r\n\r\nexport const route: Route = {\r\n    path: '/search/:keyword',\r\n    categories: ['other'],\r\n    example: '/baidu/search/rss',\r\n    parameters: { keyword: '搜索关键词' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '搜索',\r\n    maintainers: ['CaoMeiYouRen'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const keyword = ctx.req.param('keyword');\r\n    const url = `https://www.baidu.com/s?wd=${encodeURIComponent(keyword)}`;\r\n    const key = `baidu-search:${url}`;\r\n\r\n    const items = await cache.tryGet(\r\n        key,\r\n        async () => {\r\n            const response = (await got(url)).data;\r\n            const visitedLinks = new Set();\r\n            const $ = load(response);\r\n            const contentLeft = $('#content_left');\r\n            const containers = contentLeft.find('.c-container');\r\n            return containers\r\n                .toArray()\r\n                .map((el) => {\r\n                    const element = $(el);\r\n                    const link = element.find('h3 a').first().attr('href');\r\n                    if (link && !visitedLinks.has(link)) {\r\n                        visitedLinks.add(link);\r\n                        const imgs = element\r\n                            .find('img')\r\n                            .toArray()\r\n                            .map((_el) => $(_el).attr('src'));\r\n                        const description = element.find('.c-gap-top-small [class^=\"content-right_\"]').first().text() || element.find('.c-row').first().text() || element.find('.cos-row').first().text();\r\n                        return {\r\n                            title: element.find('h3').first().text(),\r\n                            description: renderDescription(description, imgs),\r\n                            link: element.find('h3 a').first().attr('href'),\r\n                            author: element.find('.c-row .c-color-gray').first().text() || '',\r\n                        };\r\n                    }\r\n                    return null;\r\n                })\r\n                .filter((e) => e?.link);\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    );\r\n\r\n    return {\r\n        title: `${keyword} - 百度搜索`,\r\n        description: `${keyword} - 百度搜索`,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"obAOA,MAAM,GAAqB,EAAa,IAAW,EAAI,EAAA,KAAA,EAAA,sCAAqD,CAAE,cAAa,WAG9G,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,SACb,QAAS,oBACT,WAAY,CAAE,QAAS,SACvB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,gBACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,EAAI,IAAI,MAAM,WACxB,EAAM,8BAA8B,mBAAmB,KACvD,EAAM,gBAAgB,IAEtB,EAAQ,MAAM,EAAM,OACtB,EACA,SAAY,CACR,IAAM,GAAY,MAAM,EAAI,IAAM,KAC5B,EAAe,IAAI,IACnB,EAAI,EAAK,GACT,EAAc,EAAE,iBAChB,EAAa,EAAY,KAAK,gBACpC,OAAO,EACF,UACA,IAAK,GAAO,CACT,IAAM,EAAU,EAAE,GACZ,EAAO,EAAQ,KAAK,QAAQ,QAAQ,KAAK,QAC/C,GAAI,GAAQ,CAAC,EAAa,IAAI,GAAO,CACjC,EAAa,IAAI,GACjB,IAAM,EAAO,EACR,KAAK,OACL,UACA,IAAK,GAAQ,EAAE,GAAK,KAAK,QACxB,EAAc,EAAQ,KAAK,8CAA8C,QAAQ,QAAU,EAAQ,KAAK,UAAU,QAAQ,QAAU,EAAQ,KAAK,YAAY,QAAQ,OAC3K,MAAO,CACH,MAAO,EAAQ,KAAK,MAAM,QAAQ,OAClC,YAAa,EAAkB,EAAa,GAC5C,KAAM,EAAQ,KAAK,QAAQ,QAAQ,KAAK,QACxC,OAAQ,EAAQ,KAAK,wBAAwB,QAAQ,QAAU,IAGvE,OAAO,OAEV,OAAQ,GAAM,GAAG,OAE1B,EAAO,MAAM,YACb,IAGJ,MAAO,CACH,MAAO,GAAG,EAAQ,SAClB,YAAa,GAAG,EAAQ,SACxB,KAAM,EACN,KAAM"}