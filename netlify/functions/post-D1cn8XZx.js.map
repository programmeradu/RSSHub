{"version":3,"file":"post-D1cn8XZx.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/medieval-china/post.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    radar: [\r\n        {\r\n            source: ['medieval-china.club/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['artefaritaKuniklo'],\r\n    handler,\r\n    url: 'medieval-china.club/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://medieval-china.club';\r\n    const { data: response } = await got(baseUrl);\r\n    const $ = load(response);\r\n    const posts = JSON.parse(\r\n        $('script:contains(\"window.localPosts\")')\r\n            .text()\r\n            .match(/window\\.localPosts = JSON\\.parse\\('(.*)'\\);/)[1]\r\n    )\r\n        .slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 10)\r\n        .map((item) => ({\r\n            title: item.title,\r\n            link: `${baseUrl}${item.path}`,\r\n            pubDate: timezone(parseDate(item.date), +8),\r\n        }));\r\n    const items = await Promise.all(\r\n        posts.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                const $ = load(response);\r\n                const imgSrc = $('img').attr('data-original');\r\n                $('img').attr('src', `${baseUrl}${imgSrc}`);\r\n                $('.head-mask').remove();\r\n                $('div.lover-box').remove();\r\n                item.description = $('article').first().html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '中国的中古',\r\n        link: baseUrl,\r\n        item: items,\r\n        image: 'https://medieval-china.club/images/icons/favicon-144x144.png',\r\n        description:\r\n            '世界那么大，你无法去到每一个地方，感受每一处风景；时间那么长，那些逝去的人你也终将无法与之谋面。而通过古人之文字，今人之分享，你可以领略以前风光之奇绝瑰玮，感受逝人之人情冷暖。中古就是这么一个地方，大家来自全球各地，不同时区，不同性别，不同身份，不同职业，但是大家都被中古的绚烂华章聚集在一起，哀其所哀，乐其所乐。这是一个虚拟的世界，但是我们仿佛跨越千里而来，谈一场绝世爱恋，今夕何夕！仅以此网站献给中古club的每一位成员，契阔谈宴，西园不芜！',\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAaA,EAAe,CACxB,KAAM,IACN,MAAO,CACH,CACI,OAAQ,CAAC,wBACT,OAAQ,KAGhB,KAAM,UACN,YAAa,CAAC,qBACd,UACA,IAAK,wBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,8BACV,CAAE,KAAM,GAAa,MAAMC,EAAI,GAC/B,EAAI,EAAK,GACT,EAAQ,KAAK,MACf,EAAE,wCACG,OACA,MAAM,+CAA+C,IAEzD,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAC5E,IAAK,IAAU,CACZ,MAAO,EAAK,MACZ,KAAM,GAAG,IAAU,EAAK,OACxB,QAAS,EAAS,EAAU,EAAK,MAAO,MAE1C,EAAQ,MAAM,QAAQ,IACxB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpCG,EAAI,EAAKD,GACT,EAASC,EAAE,OAAO,KAAK,iBAK7B,OAJA,EAAE,OAAO,KAAK,MAAO,GAAG,IAAU,KAClC,EAAE,cAAc,SAChB,EAAE,iBAAiB,SACnB,EAAK,YAAcA,EAAE,WAAW,QAAQ,OACjC,MAKnB,MAAO,CACH,MAAO,QACP,KAAM,EACN,KAAM,EACN,MAAO,+DACP,YACI"}