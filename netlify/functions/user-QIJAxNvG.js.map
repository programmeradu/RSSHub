{"version":3,"file":"user-QIJAxNvG.js","names":["route: Route","cache","userData","got"],"sources":["../../lib/routes/vocus/user.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { processList, ProcessFeed, baseUrl, apiUrl } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/user/:id',\r\n    categories: ['social-media'],\r\n    example: '/vocus/user/tsetyan',\r\n    parameters: { id: '用户 id，可在用户主页的 URL 找到' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '用户个人文章',\r\n    maintainers: ['LogicJake'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const link = `${baseUrl}/user/@${id}`;\r\n    const userData = await cache.tryGet(`vocus:user:${id}`, async () => {\r\n        const { data: userData } = await got(`${apiUrl}/api/users/${id}`, {\r\n            headers: {\r\n                referer: link,\r\n            },\r\n        });\r\n        return {\r\n            _id: userData._id,\r\n            fullname: userData.fullname,\r\n            avatarUrl: userData.avatarUrl,\r\n            intro: userData.intro,\r\n        };\r\n    });\r\n\r\n    const {\r\n        data: { articles },\r\n    } = await got(`${apiUrl}/api/articles`, {\r\n        headers: {\r\n            referer: link,\r\n        },\r\n        searchParams: {\r\n            userId: userData._id,\r\n        },\r\n    });\r\n\r\n    const list = processList(articles);\r\n\r\n    const items = await ProcessFeed(list, cache.tryGet);\r\n\r\n    return {\r\n        title: `${userData.fullname}｜方格子 vocus`,\r\n        link,\r\n        description: userData.intro,\r\n        image: userData.avatarUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"iZAKA,MAAaA,EAAe,CACxB,KAAM,YACN,WAAY,CAAC,gBACb,QAAS,sBACT,WAAY,CAAE,GAAI,wBAClB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,aACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAO,GAAG,EAAQ,SAAS,IAC3B,EAAW,MAAMC,EAAM,OAAO,cAAc,IAAM,SAAY,CAChE,GAAM,CAAE,KAAMC,GAAa,MAAMC,EAAI,GAAG,EAAO,aAAa,IAAM,CAC9D,QAAS,CACL,QAAS,KAGjB,MAAO,CACH,IAAKD,EAAS,IACd,SAAUA,EAAS,SACnB,UAAWA,EAAS,UACpB,MAAOA,EAAS,SAIlB,CACF,KAAM,CAAE,aACR,MAAMC,EAAI,GAAG,EAAO,eAAgB,CACpC,QAAS,CACL,QAAS,GAEb,aAAc,CACV,OAAQ,EAAS,OAInB,EAAO,EAAY,GAEnB,EAAQ,MAAM,EAAY,EAAMF,EAAM,QAE5C,MAAO,CACH,MAAO,GAAG,EAAS,SAAS,YAC5B,OACA,YAAa,EAAS,MACtB,MAAO,EAAS,UAChB,KAAM"}