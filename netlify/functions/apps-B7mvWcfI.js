import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{parseDate as e}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as t}from"./got-CdvI2yKX.js";import{ViewType as n}from"./types-A5bA50Mg.js";import{load as r}from"cheerio";const i={osx:`macOS`,ios:`iOS`,appletvos:`tvOS`},a={macos:`osx`,ios:`ios`,tvos:`appletvos`},o={path:`/apps/update/:country/:id/:platform?`,categories:[`program-update`],view:n.Notifications,example:`/apple/apps/update/us/id408709785`,parameters:{country:`App Store Country, obtain from the app URL, see below`,id:`App id, obtain from the app URL`,platform:{description:`App Platform, see below, all by default`,options:[{value:`All`,label:`all`},{value:`iOS`,label:`iOS`},{value:`macOS`,label:`macOS`},{value:`tvOS`,label:`tvOS`}]}},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`apps.apple.com/:country/app/:appSlug/:id`,`apps.apple.com/:country/app/:id`],target:`/apps/update/:country/:id`}],name:`App Update`,maintainers:[`EkkoG`,`nczitzk`],handler:s,description:"\n::: tip\n  For example, the URL of [GarageBand](https://apps.apple.com/us/app/messages/id408709785) in the App Store is `https://apps.apple.com/us/app/messages/id408709785`. In this case, the `App Store Country` parameter for the route is `us`, and the `App id` parameter is `id1146560473`. So the route should be [`/apple/apps/update/us/id408709785`](https://rsshub.app/apple/apps/update/us/id408709785).\n:::"};async function s(n){let{country:o,id:s}=n.req.param(),{platform:c}=n.req.param(),l;c&&c!==`all`&&(c=c.toLowerCase(),l=Object.hasOwn(a,c)?a[c]:c),c=void 0;let u=n.req.query(`limit`)?Number.parseInt(n.req.query(`limit`),10):100,d=`https://apps.apple.com`,f=new URL(`${o}/app/${s}`,d).href,{data:p}=await t(f),m=r(p),h=JSON.parse(Object.values(JSON.parse(m(`script#shoebox-media-api-cache-apps`).text()))[0]),g=h.d[0].attributes,_=g.name,v=g.artistName,y=g.platformAttributes,b=[],x=``,S=``;if(l&&Object.hasOwn(y,l)){c=Object.hasOwn(i,l)?i[l]:l;let e=y[l];b=e.versionHistory,x=`${_}${c?` for ${c} `:` `}`,S=e.description.standard}else{x=_;for(let e of Object.keys(y)){let t=y[e];b=[...b,...t.versionHistory.map(t=>({...t,platformId:e}))],S+=t.description.standard}}b=b.slice(0,u).map(t=>{let n=t.platformId??l,r=c??(Object.hasOwn(i,n)?i[n]:n);return{title:`${_} ${t.versionDisplay} for ${r}`,link:f,description:t.releaseNotes?.replace(/\n/g,`<br>`),category:[r],guid:`apple/apps/${o}/${s}/${n}#${t.versionDisplay}`,pubDate:e(t.releaseTimestamp)}});let C=new URL(`favicon.ico`,d).href;return n.set(`json`,{appData:h}),{item:b,title:`${x} - Apple App Store`,link:f,description:S?.replace(/\n/g,` `),language:m(`html`).prop(`lang`),image:m(`meta[property="og:image"]`).prop(`content`),icon:C,logo:C,subtitle:_,author:v,allowEmpty:!0}}export{o as route};
//# sourceMappingURL=apps-B7mvWcfI.js.map