{"version":3,"file":"cnljxh-hg7EZ0IJ.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/cnljxh/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst defaultIds = {\r\n    collect: '10039',\r\n    date: '5575',\r\n    info: '575',\r\n    news: '10',\r\n    price: '299',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category?/:id?',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'news', id = Object.hasOwn(defaultIds, category) ? defaultIds[category] : '10' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 10;\r\n\r\n    const rootUrl = 'http://www.cnljxh.com';\r\n    const currentUrl = new URL(`${category}/?classid=${id}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    let items = $('div.main_left ul li a')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            return {\r\n                title: item.prop('title') || item.text(),\r\n                link: new URL(item.prop('href'), currentUrl).href,\r\n                pubDate: parseDate(item.next().text()),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const content = load(detailResponse);\r\n\r\n                item.title = content('div.content_title h2').text() || item.title;\r\n                item.description = content('div.content_div').html();\r\n                item.enclosure_url = content('div.content_div embed').length === 0 ? undefined : new URL(content('div.content_div embed').prop('src'), currentUrl).href;\r\n                item.enclosure_type = item.enclosure_url ? `application/${item.enclosure_url.split(/\\./).pop()}` : undefined;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const author = $('title').text();\r\n    const subtitle = $('div.mianbao').contents().last().text().split(/>/).pop().trim() || $('div.mianbao a').last().text();\r\n    const image = new URL($('div.logo a img').prop('src'), currentUrl).href;\r\n    const icon = new URL($('link[rel=\"shortcut icon\"]').prop('href'), rootUrl).href;\r\n\r\n    return {\r\n        item: items,\r\n        title: `${author} - ${subtitle}`,\r\n        link: currentUrl,\r\n        description: $('meta[name=\"description\"]').prop('content'),\r\n        language: $('html').prop('lang'),\r\n        image,\r\n        icon,\r\n        logo: icon,\r\n        subtitle,\r\n        author,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAM,EAAa,CACf,QAAS,QACT,KAAM,OACN,KAAM,MACN,KAAM,KACN,MAAO,OAGEA,EAAe,CACxB,KAAM,mBACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,OAAQ,KAAK,OAAO,OAAO,EAAY,GAAY,EAAW,GAAY,MAAS,EAAI,IAAI,QACxG,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,wBACV,EAAa,IAAI,IAAI,GAAG,EAAS,YAAY,IAAM,GAAS,KAE5D,CAAE,KAAM,GAAa,MAAMC,EAAI,GAE/B,EAAI,EAAK,GAEX,EAAQ,EAAE,yBACT,MAAM,EAAG,GACT,UACA,IAAK,IACF,EAAO,EAAE,GAEF,CACH,MAAO,EAAK,KAAK,UAAY,EAAK,OAClC,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAY,KAC7C,QAAS,EAAU,EAAK,OAAO,WAI3C,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAMD,EAAI,EAAK,MAE1C,EAAU,EAAK,GAOrB,MALA,GAAK,MAAQ,EAAQ,wBAAwB,QAAU,EAAK,MAC5D,EAAK,YAAc,EAAQ,mBAAmB,OAC9C,EAAK,cAAgB,EAAQ,yBAAyB,SAAW,EAAI,IAAA,GAAY,IAAI,IAAI,EAAQ,yBAAyB,KAAK,OAAQ,GAAY,KACnJ,EAAK,eAAiB,EAAK,cAAgB,eAAe,EAAK,cAAc,MAAM,MAAM,QAAU,IAAA,GAE5F,MAKnB,IAAM,EAAS,EAAE,SAAS,OACpB,EAAW,EAAE,eAAe,WAAW,OAAO,OAAO,MAAM,KAAK,MAAM,QAAU,EAAE,iBAAiB,OAAO,OAC1G,EAAQ,IAAI,IAAI,EAAE,kBAAkB,KAAK,OAAQ,GAAY,KAC7D,EAAO,IAAI,IAAI,EAAE,6BAA6B,KAAK,QAAS,GAAS,KAE3E,MAAO,CACH,KAAM,EACN,MAAO,GAAG,EAAO,KAAK,IACtB,KAAM,EACN,YAAa,EAAE,4BAA4B,KAAK,WAChD,SAAU,EAAE,QAAQ,KAAK,QACzB,QACA,OACA,KAAM,EACN,WACA"}