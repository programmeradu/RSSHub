{"version":3,"file":"page-DgRJpPou.js","names":["route: Route","ofetch"],"sources":["../../lib/routes/fanqienovel/page.ts"],"sourcesContent":["import type { Data, Route } from '@/types';\r\nimport type { Context } from 'hono';\r\nimport ofetch from '@/utils/ofetch';\r\nimport * as cheerio from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\ninterface Chapter {\r\n    itemId: string;\r\n    needPay: number;\r\n    title: string;\r\n    isChapterLock: boolean;\r\n    isPaidPublication: boolean;\r\n    isPaidStory: boolean;\r\n    volume_name: string;\r\n    firstPassTime: string;\r\n}\r\n\r\ninterface Page {\r\n    hasFetch: boolean;\r\n    author: string;\r\n    authorId: string;\r\n    bookId: string;\r\n    mediaId: string;\r\n    bookName: string;\r\n    status: number;\r\n    category: string;\r\n    categoryV2: string;\r\n    abstract: string;\r\n    thumbUri: string;\r\n    creationStatus: number;\r\n    wordNumber: number;\r\n    readCount: number;\r\n    description: string;\r\n    avatarUri: string;\r\n    creatorId: string;\r\n    lastPublishTime: string;\r\n    lastChapterItemId: string;\r\n    lastChapterTitle: string;\r\n    volumeNameList: string[];\r\n    chapterListWithVolume: Chapter[][];\r\n    chapterTotal: number;\r\n    followStatus: number;\r\n    itemIds: string[];\r\n    hasFetchDirectory: boolean;\r\n    chapterList: any[];\r\n    serverRendered: boolean;\r\n    genre: string;\r\n    platform: string;\r\n    type: string;\r\n    originalAuthors: string;\r\n    completeCategory: string;\r\n}\r\n\r\nexport const route: Route = {\r\n    path: '/page/:bookId',\r\n    example: '/fanqienovel/page/6621052928482348040',\r\n    parameters: { bookId: '小说 ID，可在 URL 中找到' },\r\n    maintainers: ['TonyRL'],\r\n    name: '小说更新',\r\n    handler,\r\n    radar: [\r\n        {\r\n            source: ['fanqienovel.com/page/:bookId'],\r\n        },\r\n    ],\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const { bookId } = ctx.req.param();\r\n    const link = `https://fanqienovel.com/page/${bookId}`;\r\n\r\n    const response = await ofetch(link);\r\n    const $ = cheerio.load(response);\r\n\r\n    const initialState = JSON.parse(\r\n        $('script:contains(\"window.__INITIAL_STATE__\")')\r\n            .text()\r\n            .match(/window\\.__INITIAL_STATE__\\s*=\\s*(.*);/)?.[1] ?? '{}'\r\n    );\r\n\r\n    const page = initialState.page as Page;\r\n    const items = page.chapterListWithVolume.flatMap((volume) =>\r\n        volume.map((chapter) => ({\r\n            title: chapter.title,\r\n            link: `https://fanqienovel.com/reader/${chapter.itemId}`,\r\n            description: chapter.volume_name,\r\n            pubDate: parseDate(chapter.firstPassTime, 'X'),\r\n            author: page.author,\r\n        }))\r\n    );\r\n\r\n    return {\r\n        title: `${page.bookName} - ${page.author}`,\r\n        description: page.abstract,\r\n        link,\r\n        language: 'zh-CN',\r\n        image: page.thumbUri,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0PAqDA,MAAaA,EAAe,CACxB,KAAM,gBACN,QAAS,wCACT,WAAY,CAAE,OAAQ,oBACtB,YAAa,CAAC,UACd,KAAM,OACN,UACA,MAAO,CACH,CACI,OAAQ,CAAC,mCAKrB,eAAe,EAAQ,EAA6B,CAChD,GAAM,CAAE,UAAW,EAAI,IAAI,QACrB,EAAO,gCAAgC,IAEvC,EAAW,MAAMC,EAAO,GACxB,EAAI,EAAQ,KAAK,GAEjB,EAAe,KAAK,MACtB,EAAE,+CACG,OACA,MAAM,2CAA2C,IAAM,MAG1D,EAAO,EAAa,KACpB,EAAQ,EAAK,sBAAsB,QAAS,GAC9C,EAAO,IAAK,IAAa,CACrB,MAAO,EAAQ,MACf,KAAM,kCAAkC,EAAQ,SAChD,YAAa,EAAQ,YACrB,QAAS,EAAU,EAAQ,cAAe,KAC1C,OAAQ,EAAK,WAIrB,MAAO,CACH,MAAO,GAAG,EAAK,SAAS,KAAK,EAAK,SAClC,YAAa,EAAK,SAClB,OACA,SAAU,QACV,MAAO,EAAK,SACZ,KAAM"}