import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as n}from"./got-CdvI2yKX.js";import{timezone as r}from"./timezone-BrNu6iXe.js";import{load as i}from"cheerio";const a={path:`/rail/:category?/:topic?`,categories:[`new-media`],example:`/ally/rail/hyzix/chengguijiaotong`,parameters:{category:`分类，可在 URL 中找到；略去则抓取首页`,topic:`话题，可在 URL 中找到；并非所有页面均有此字段`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`rail.ally.net.cn/`,`rail.ally.net.cn/html/:category?/:topic?`]}],name:`世界轨道交通资讯网`,maintainers:[`Rongronggg9`],handler:o,url:`rail.ally.net.cn/`,description:`::: tip
  默认抓取前 20 条，可通过 \`?limit=\` 改变。
:::`};async function o(a){let{category:o,topic:s}=a.req.param(),c=`http://rail.ally.net.cn`,l=o?s?`${c}/html/${o}/${s}/`:`${c}/html/${o}/`:c,u=await n.get(l),d=i(u.data),f=``,p=d(`.container .regsiter a`).toArray().slice(1);for(let e of p){let t=d(e).text();f=f?`${f} - ${t}`:t}f=f||(o&&s?`${o} - ${s}`:o)||`首页`;let m=[d(`.left .hynewsO h2 a`).toArray(),d(`.left .list_content_c`).find(`.new_hy_focus_con_tit a, .new_hy_list_name a`).toArray(),d(`.left`).find(`.nnewslistpic a, .nnewslistinfo dd a`).toArray(),d(`.left .list_con .datacountTit a`).toArray(),d(`.container_left`).find(`dd a, h1 a, ul.slideshow li a`).toArray()].flat();m.length||(m=d(`.left a, .container_left a`).toArray());let h=m.map(e=>{e=d(e);let n=e.attr(`href`),i=n&&n.match(/\/html\/(\d{4})\/\w+_(\d{4})\/\d+\.html/);if(!i)return null;let a=e.text();return{title:a,link:n.startsWith(`/`)?`${c}${n}`:n,pubDate:r(t(`${i[1]}${i[2]}`),8)}}).filter(Boolean),g=[];for(let e of h)g.some(t=>t.link===e?.link)||g.push(e);return h=g.sort((e,t)=>t.pubDate-e.pubDate).slice(0,a.req.query(`limit`)||20),h=await Promise.all(h.map(t=>e.tryGet(t.link,async()=>{let e=await n(t.link),r=i(e.data),a=``,o=r(`div.content_all`);o.length?o.eq(o.length-1).contents().each((e,t)=>{let n=r(t),i;t.name===`div`?(i=n.html(),i=i&&i.trim(),a+=!i||i===`&nbsp;`?a?`<br>`:``:i):a+=n.toString().trim()}):a=r(`div.content div`).first().html(),a=a.replace(/\s*<br ?\/?>\s*$/,``);let s=r(`.content > em span`);return{title:r(`.content > h2`).text()||t.title,description:a,pubDate:t.pubDate,author:s.eq(1).text().replace(/^来源：/,``),link:t.link}}))),{title:`世界轨道交通资讯网 - ${f}`,link:l,item:h,description:d(`head > meta[name="description"]`).attr(`content`)}}export{a as route};
//# sourceMappingURL=rail-DhAPbX5Z.js.map