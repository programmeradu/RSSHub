{"version":3,"file":"hqsz-DCBzP9rV.js","names":["route: Route","got","cache","data"],"sources":["../../lib/routes/ouc/hqsz.ts"],"sourcesContent":["import { parseDate } from '@/utils/parse-date';\r\nimport got from '@/utils/got';\r\nimport cache from '@/utils/cache';\r\nimport CryptoJS from 'crypto-js/crypto-js';\r\nimport { Route } from '@/types';\r\n\r\nexport const route: Route = {\r\n    path: '/hqsz',\r\n    categories: ['university'],\r\n    example: '/ouc/hqsz',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['hqsz.ouc.edu.cn/news.html'],\r\n        },\r\n    ],\r\n    name: '后勤公告通知',\r\n    maintainers: ['ladeng07'],\r\n    handler,\r\n    url: 'hqsz.ouc.edu.cn/news.html?typeId=02',\r\n};\r\n\r\nfunction Decrypt(word, keyStr = '1974051005060708', ivStr = '1974051005060708') {\r\n    const key = CryptoJS.enc.Utf8.parse(keyStr); // \"\"中与后台一样  密码\r\n    const iv = CryptoJS.enc.Utf8.parse(ivStr); // \"\"中与后台一样\r\n    const base64 = CryptoJS.enc.Base64.parse(word);\r\n    const src = CryptoJS.enc.Base64.stringify(base64);\r\n\r\n    const decrypt = CryptoJS.AES.decrypt(src, key, {\r\n        iv,\r\n        mode: CryptoJS.mode.CBC,\r\n        padding: CryptoJS.pad.Pkcs7,\r\n    });\r\n\r\n    const decryptedStr = decrypt.toString(CryptoJS.enc.Utf8);\r\n    return decryptedStr;\r\n}\r\n\r\nasync function handler() {\r\n    const base = 'http://hqsz.ouc.edu.cn/';\r\n    const link = base + 'api/website/frontendWebsite/lists';\r\n    const { data } = await got.post(link, {\r\n        form: {\r\n            schoolCode: '10423',\r\n            website: '89e97da117d547128283cf9d12891fa9',\r\n            code: '0202',\r\n            pageSize: '10',\r\n            pageIndex: '1',\r\n        },\r\n    });\r\n    const list = JSON.parse(Decrypt(data)).data.list.map((item) => ({\r\n        title: item.title,\r\n        id: item.id,\r\n        author: item.author,\r\n        link: base + 'news_detail.html?id=' + item.id,\r\n        pubDate: parseDate(item.publishTime),\r\n    }));\r\n\r\n    const out = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data } = await got.post(base + 'api/website/frontendWebsite/info', {\r\n                    form: {\r\n                        schoolCode: '10423',\r\n                        website: '89e97da117d547128283cf9d12891fa9',\r\n                        id: item.id,\r\n                    },\r\n                });\r\n                item.description = Decrypt(JSON.parse(Decrypt(data)).data.content);\r\n                delete item.id;\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '中国海洋大学后勤公告通知',\r\n        link,\r\n        description: '中国海洋大学后勤公告通知',\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"4WAMA,MAAaA,EAAe,CACxB,KAAM,QACN,WAAY,CAAC,cACb,QAAS,YACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,+BAGjB,KAAM,SACN,YAAa,CAAC,YACd,UACA,IAAK,uCAGT,SAAS,EAAQ,EAAM,EAAS,mBAAoB,EAAQ,mBAAoB,CAC5E,IAAM,EAAM,EAAS,IAAI,KAAK,MAAM,GAC9B,EAAK,EAAS,IAAI,KAAK,MAAM,GAC7B,EAAS,EAAS,IAAI,OAAO,MAAM,GACnC,EAAM,EAAS,IAAI,OAAO,UAAU,GAEpC,EAAU,EAAS,IAAI,QAAQ,EAAK,EAAK,CAC3C,KACA,KAAM,EAAS,KAAK,IACpB,QAAS,EAAS,IAAI,QAGpB,EAAe,EAAQ,SAAS,EAAS,IAAI,MACnD,OAAO,EAGX,eAAe,GAAU,CACrB,IAAM,EAAO,0BACP,EAAO,EAAO,oCACd,CAAE,QAAS,MAAMC,EAAI,KAAK,EAAM,CAClC,KAAM,CACF,WAAY,QACZ,QAAS,mCACT,KAAM,OACN,SAAU,KACV,UAAW,OAGb,EAAO,KAAK,MAAM,EAAQ,IAAO,KAAK,KAAK,IAAK,IAAU,CAC5D,MAAO,EAAK,MACZ,GAAI,EAAK,GACT,OAAQ,EAAK,OACb,KAAM,EAAO,uBAAyB,EAAK,GAC3C,QAAS,EAAU,EAAK,gBAGtB,EAAM,MAAM,QAAQ,IACtB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAA,GAAS,MAAMD,EAAI,KAAK,EAAO,mCAAoC,CACvE,KAAM,CACF,WAAY,QACZ,QAAS,mCACT,GAAI,EAAK,MAKjB,MAFA,GAAK,YAAc,EAAQ,KAAK,MAAM,EAAQE,IAAO,KAAK,SAC1D,OAAO,EAAK,GACL,MAKnB,MAAO,CACH,MAAO,eACP,OACA,YAAa,eACb,KAAM"}