{"version":3,"file":"csie-CDKcnbNM.js","names":["route: Route","ofetch","item"],"sources":["../../lib/routes/ncku/csie.ts"],"sourcesContent":["import type { Route } from '@/types';\r\nimport { CheerioAPI, load } from 'cheerio';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nconst currentURL = (catagory: string, page: number) => (catagory === '_all' ? `https://www.csie.ncku.edu.tw/zh-hant/news?page=${page}` : `https://www.csie.ncku.edu.tw/zh-hant/news/${catagory}?page=${page}`);\r\n\r\nconst catagories = {\r\n    _all: '全部資訊',\r\n    normal: '一般資訊',\r\n    bachelorAdmission: '大學部招生',\r\n    masterAdmission: '研究所招生',\r\n    speeches: '演講及活動資訊',\r\n    awards: '獲獎資訊',\r\n    scholarship: '獎助學金',\r\n    jobs: '徵人資訊',\r\n};\r\n\r\nexport const route: Route = {\r\n    'zh-TW': {\r\n        name: '國立成功大學資訊系公告',\r\n        description: '可用分類：_all, normal, bachelorAdmission, masterAdmission, speeches, awards, scholarship, jobs',\r\n    },\r\n    name: 'CSIE News',\r\n    description: 'Availible catagories：_all, normal, bachelorAdmission, masterAdmission, speeches, awards, scholarship, jobs',\r\n    path: '/csie/:catagory?',\r\n    categories: ['university'],\r\n    example: '/ncku/csie/normal',\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.csie.ncku.edu.tw/zh-hant/news/'],\r\n            target: '/csie/_all',\r\n        },\r\n        {\r\n            source: ['www.csie.ncku.edu.tw/zh-hant/news/:catagory'],\r\n            target: '/csie/:catagory',\r\n        },\r\n    ],\r\n    maintainers: ['simbafs'],\r\n    handler: async (ctx) => {\r\n        let catagory = ctx.req.param('catagory') ?? '_all';\r\n        if (catagories[catagory] === undefined) {\r\n            catagory = 'normal';\r\n        }\r\n\r\n        const base = 1; // get from query\r\n        const limit = 3; // get from query\r\n\r\n        const item = (\r\n            await Promise.allSettled(\r\n                Array.from({ length: limit }).map(async (_, i) => {\r\n                    const $ = await ofetch<CheerioAPI>(currentURL(catagory, base + i), {\r\n                        parseResponse: load,\r\n                    });\r\n\r\n                    return $('.list-title > li')\r\n                        .toArray()\r\n                        .map((e) => ({\r\n                            title: $('a', e).text(),\r\n                            pubDate: new Date($('small', e).text()),\r\n                            link: `https://www.csie.ncku.edu.tw${$('a', e).attr('href')}`,\r\n                            catagory: $('span:nth-child(2)', e).text(),\r\n                        }));\r\n                })\r\n            )\r\n        )\r\n            .filter((item) => item.status === 'fulfilled')\r\n            .flatMap((item) => item.value);\r\n\r\n        return {\r\n            title: `成大資訊系公告 - ${catagories[catagory]}`,\r\n            link: currentURL(catagory, base),\r\n            item,\r\n        };\r\n    },\r\n};\r\n"],"mappings":"0MAIA,MAAM,GAAc,EAAkB,IAAkB,IAAa,OAAS,kDAAkD,IAAS,6CAA6C,EAAS,QAAQ,IAEjM,EAAa,CACf,KAAM,OACN,OAAQ,OACR,kBAAmB,QACnB,gBAAiB,QACjB,SAAU,UACV,OAAQ,OACR,YAAa,OACb,KAAM,QAGGA,EAAe,CACxB,QAAS,CACL,KAAM,cACN,YAAa,8FAEjB,KAAM,YACN,YAAa,6GACb,KAAM,mBACN,WAAY,CAAC,cACb,QAAS,oBACT,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,sCACT,OAAQ,cAEZ,CACI,OAAQ,CAAC,+CACT,OAAQ,oBAGhB,YAAa,CAAC,WACd,QAAS,KAAO,IAAQ,CACpB,IAAI,EAAW,EAAI,IAAI,MAAM,aAAe,OACxC,EAAW,KAAc,IAAA,KACzB,EAAW,UAGf,IAGM,GACF,MAAM,QAAQ,WACV,MAAM,KAAK,CAAE,OAAQ,IAAS,IAAI,MAAO,EAAG,IAAM,CAC9C,IAAM,EAAI,MAAMC,EAAmB,EAAW,EAAU,EAAO,GAAI,CAC/D,cAAe,IAGnB,OAAO,EAAE,oBACJ,UACA,IAAK,IAAO,CACT,MAAO,EAAE,IAAK,GAAG,OACjB,QAAS,IAAI,KAAK,EAAE,QAAS,GAAG,QAChC,KAAM,+BAA+B,EAAE,IAAK,GAAG,KAAK,UACpD,SAAU,EAAE,oBAAqB,GAAG,cAKnD,OAAQ,GAASC,EAAK,SAAW,aACjC,QAAS,GAASA,EAAK,OAE5B,MAAO,CACH,MAAO,aAAa,EAAW,KAC/B,KAAM,EAAW,EAAU,GAC3B"}