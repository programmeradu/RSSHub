{"version":3,"file":"pincong-DgLX5lP6.js","names":["route: Route","cache"],"sources":["../../lib/routes/pincong/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { baseUrl, puppeteerGet } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/category/:category?/:sort?',\r\n    categories: ['bbs'],\r\n    example: '/pincong/category/1/new',\r\n    parameters: { category: '分类，与官网分类 URL `category-` 后的数字对应，默认为全部', sort: '排序方式，参数可见下表，默认为推荐' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: true,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '发现',\r\n    maintainers: ['zphw'],\r\n    handler,\r\n    description: `| 最新 | 推荐      | 热门 |\r\n| ---- | --------- | ---- |\r\n| new  | recommend | hot  |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let url = `${baseUrl}/`;\r\n\r\n    const sortMap = {\r\n        new: 'sort_type-new',\r\n        recommend: 'recommend-1',\r\n        hot: 'sort_type-hot__day2',\r\n    };\r\n\r\n    url += (ctx.req.param('sort') && sortMap[ctx.req.param('sort')]) || 'recommend-1';\r\n    url += ctx.req.param('category') ? '__category-' + ctx.req.param('category') : '';\r\n\r\n    // use Puppeteer due to the obstacle by cloudflare challenge\r\n    const html = await puppeteerGet(url, cache);\r\n\r\n    const $ = load(html);\r\n    const list = $('div.aw-item');\r\n\r\n    return {\r\n        title: '品葱 - 发现',\r\n        link: url,\r\n        item: list.toArray().map((item) => ({\r\n            title: $(item).find('h4 a').text().trim(),\r\n            link: baseUrl + $(item).find('h4 a').attr('href'),\r\n            pubDate: parseDate($(item).attr('data-created-at') * 1000),\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"8TAMA,MAAaA,EAAe,CACxB,KAAM,8BACN,WAAY,CAAC,OACb,QAAS,0BACT,WAAY,CAAE,SAAU,wCAAyC,KAAM,qBACvE,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,QACd,UACA,YAAa;;8BAKjB,eAAe,EAAQ,EAAK,CACxB,IAAI,EAAM,GAAG,EAAQ,GAEf,EAAU,CACZ,IAAK,gBACL,UAAW,cACX,IAAK,uBAGT,GAAQ,EAAI,IAAI,MAAM,SAAW,EAAQ,EAAI,IAAI,MAAM,UAAa,cACpE,GAAO,EAAI,IAAI,MAAM,YAAc,cAAgB,EAAI,IAAI,MAAM,YAAc,GAG/E,IAAM,EAAO,MAAM,EAAa,EAAKC,GAE/B,EAAI,EAAK,GACT,EAAO,EAAE,eAEf,MAAO,CACH,MAAO,UACP,KAAM,EACN,KAAM,EAAK,UAAU,IAAK,IAAU,CAChC,MAAO,EAAE,GAAM,KAAK,QAAQ,OAAO,OACnC,KAAM,EAAU,EAAE,GAAM,KAAK,QAAQ,KAAK,QAC1C,QAAS,EAAU,EAAE,GAAM,KAAK,mBAAqB"}