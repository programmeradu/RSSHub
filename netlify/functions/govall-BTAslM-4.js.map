{"version":3,"file":"govall-BTAslM-4.js","names":["route: Route","got","cache","$"],"sources":["../../lib/routes/gov/zhengce/govall.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nexport const route: Route = {\r\n    path: '/zhengce/govall/:advance?',\r\n    categories: ['government'],\r\n    example: '/gov/zhengce/govall/orpro=555&notpro=2&search_field=title',\r\n    parameters: { advance: '高级搜索选项，将作为请求参数直接添加到url后。目前已知的选项及其意义如下。' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.gov.cn/'],\r\n            target: '/zhengce/govall',\r\n        },\r\n    ],\r\n    name: '信息稿件',\r\n    maintainers: ['ciaranchen'],\r\n    handler,\r\n    url: 'www.gov.cn/',\r\n    description: `|               选项              |                       意义                       |              备注              |\r\n| :-----------------------------: | :----------------------------------------------: | :----------------------------: |\r\n|              orpro              |             包含以下任意一个关键词。             |          用空格分隔。          |\r\n|              allpro             |                包含以下全部关键词                |                                |\r\n|              notpro             |                 不包含以下关键词                 |                                |\r\n|              inpro              |                完整不拆分的关键词                |                                |\r\n|           searchfield           | title: 搜索词在标题中；content: 搜索词在正文中。 |  默认为空，即网页的任意位置。  |\r\n| pubmintimeYear, pubmintimeMonth |                    从某年某月                    | 单独使用月份参数无法只筛选月份 |\r\n| pubmaxtimeYear, pubmaxtimeMonth |                    到某年某月                    | 单独使用月份参数无法只筛选月份 |\r\n|              colid              |                       栏目                       |      比较复杂，不建议使用      |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const advance = ctx.req.param('advance');\r\n    const link = `http://sousuo.gov.cn/list.htm`;\r\n    const params = new URLSearchParams({\r\n        n: 20,\r\n        t: 'govall',\r\n        sort: 'pubtime',\r\n        advance: 'true',\r\n    });\r\n    const query = `${params.toString()}&${advance}`;\r\n    const res = await got.get(link, {\r\n        searchParams: query.replaceAll(/([\\u4E00-\\u9FA5])/g, (str) => encodeURIComponent(str)),\r\n    });\r\n    const $ = load(res.data);\r\n\r\n    const list = $('body > div.dataBox > table > tbody > tr')\r\n        .slice(1)\r\n        .toArray()\r\n        .map((elem) => {\r\n            elem = $(elem);\r\n            return {\r\n                title: elem.find('td:nth-child(2) > a').text(),\r\n                link: elem.find('td:nth-child(2) > a').attr('href'),\r\n                pubDate: timezone(parseDate(elem.find('td:nth-child(5)').text()), 8),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                let description = '';\r\n                try {\r\n                    const contentData = await got(item.link);\r\n                    const $ = load(contentData.data);\r\n                    description = $('#UCAP-CONTENT').html();\r\n                } catch {\r\n                    description = '文章已被删除';\r\n                }\r\n                item.description = description;\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '信息稿件 - 中国政府网',\r\n        link: `${link}?${query}`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0ZAOA,MAAaA,EAAe,CACxB,KAAM,4BACN,WAAY,CAAC,cACb,QAAS,4DACT,WAAY,CAAE,QAAS,0CACvB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,eACT,OAAQ,oBAGhB,KAAM,OACN,YAAa,CAAC,cACd,UACA,IAAK,cACL,YAAa;;;;;;;;;8GAYjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,EAAI,IAAI,MAAM,WACxB,EAAO,gCACP,EAAS,IAAI,gBAAgB,CAC/B,EAAG,GACH,EAAG,SACH,KAAM,UACN,QAAS,SAEP,EAAQ,GAAG,EAAO,WAAW,GAAG,IAChC,EAAM,MAAMC,EAAI,IAAI,EAAM,CAC5B,aAAc,EAAM,WAAW,qBAAuB,GAAQ,mBAAmB,MAE/E,EAAI,EAAK,EAAI,MAEb,EAAO,EAAE,2CACV,MAAM,GACN,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,uBAAuB,OACxC,KAAM,EAAK,KAAK,uBAAuB,KAAK,QAC5C,QAAS,EAAS,EAAU,EAAK,KAAK,mBAAmB,QAAS,MAIxE,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAI,EAAc,GAClB,GAAI,CACA,IAAM,EAAc,MAAMD,EAAI,EAAK,MAC7BE,EAAI,EAAK,EAAY,MAC3B,EAAcA,EAAE,iBAAiB,YAC7B,CACJ,EAAc,SAGlB,MADA,GAAK,YAAc,EACZ,MAKnB,MAAO,CACH,MAAO,eACP,KAAM,GAAG,EAAK,GAAG,IACjB,KAAM"}