{"version":3,"file":"mobile-C5p4-8FU.js","names":["route: Route","ofetch","cache","response","$","result: any[]"],"sources":["../../lib/routes/sohu/mobile.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport cache from '@/utils/cache';\r\nimport * as cheerio from 'cheerio';\r\nimport logger from '@/utils/logger';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/mobile',\r\n    categories: ['new-media'],\r\n    example: '/sohu/mobile',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['m.sohu.com/limit'],\r\n            target: '/mobile',\r\n        },\r\n    ],\r\n    name: '首页新闻',\r\n    maintainers: ['asqwe1'],\r\n    handler,\r\n    description: '订阅手机搜狐网的首页新闻',\r\n};\r\n\r\nasync function handler() {\r\n    const response = await ofetch('https://m.sohu.com/limit');\r\n    // 从HTML中提取JSON数据\r\n    const $ = cheerio.load(response);\r\n    const jsonScript = $('script:contains(\"WapHomeRenderData\")').text();\r\n    const jsonMatch = jsonScript?.match(/window\\.WapHomeRenderData\\s*=\\s*({.*})/s);\r\n    if (!jsonMatch?.[1]) {\r\n        throw new Error('WapHomeRenderData 数据未找到');\r\n    }\r\n    const renderData = JSON.parse(jsonMatch[1]);\r\n    const list = extractPlateBlockNewsLists(renderData)\r\n        .filter((item) => item.id && item.url?.startsWith('//'))\r\n        .map((item) => ({\r\n            title: item.title,\r\n            link: new URL(item.url.split('?')[0], 'https://m.sohu.com').href,\r\n        }));\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                try {\r\n                    const detailResp = await ofetch(item.link);\r\n                    const $d = cheerio.load(detailResp);\r\n\r\n                    let description = '';\r\n                    let pubDate = '';\r\n                    if (item.link.includes('/xtopic/')) {\r\n                        const fullArticleUrl = $d('.tpl-top-text-item-content').prop('href')?.split('?')[0]?.replace('www.sohu.com/', 'm.sohu.com/');\r\n                        const response = await ofetch(`https:${fullArticleUrl}`);\r\n                        const $ = cheerio.load(response);\r\n                        description = getDescription($);\r\n                        pubDate = extractPubDate($);\r\n                    }\r\n\r\n                    return {\r\n                        ...item,\r\n                        description: description || getDescription($d) || item.title,\r\n                        pubDate: pubDate || extractPubDate($d),\r\n                    };\r\n                } catch (error) {\r\n                    logger.error(`获取详情失败: ${item.link}`, error);\r\n                    return item;\r\n                }\r\n            })\r\n        )\r\n    );\r\n    return {\r\n        title: '手机搜狐新闻',\r\n        link: 'https://m.sohu.com/limit',\r\n        item: items.filter(Boolean),\r\n    };\r\n}\r\n\r\nfunction extractPlateBlockNewsLists(jsonData: any) {\r\n    const result: any[] = [];\r\n    for (const key of Object.keys(jsonData)) {\r\n        if (key.startsWith('PlateBlock')) {\r\n            const plateBlock = jsonData[key];\r\n            // 处理新闻列表\r\n            if (plateBlock?.param?.newsData?.list) {\r\n                result.push(...plateBlock.param.newsData.list);\r\n            }\r\n            // 处理焦点图数据\r\n            if (plateBlock?.param?.focusData?.list) {\r\n                result.push(...plateBlock.param.focusData.list);\r\n            }\r\n            if (plateBlock?.param?.feedData0?.list) {\r\n                result.push(...plateBlock.param.feedData0.list);\r\n            }\r\n            if (plateBlock?.param?.feedData1?.list) {\r\n                result.push(...plateBlock.param.feedData1.list);\r\n            }\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nfunction extractPubDate($: cheerio.CheerioAPI): string {\r\n    const timeElements = ['.time', '#videoPublicTime'];\r\n    let date;\r\n    for (const selector of timeElements) {\r\n        const text = $(selector).first().text().trim();\r\n        if (!text) {\r\n            continue;\r\n        }\r\n\r\n        date = parseDate(text);\r\n        if (date) {\r\n            return date;\r\n        }\r\n    }\r\n\r\n    const img = $('meta[name=\"share_img\"]')\r\n        .toArray()\r\n        .map((i) => $(i).attr('src'))\r\n        .find((i) => i.includes('images01'));\r\n    date = img ? parseDate(img?.match(/images01\\/(\\d{8})\\//i)?.[1]) : '';\r\n    if (date) {\r\n        return date;\r\n    }\r\n}\r\n\r\nfunction getDescription($: cheerio.CheerioAPI): string | null {\r\n    const content = $('#articleContent');\r\n    if (content.length) {\r\n        return content.first().html()?.trim();\r\n    }\r\n    const video = $('#videoPlayer div');\r\n    if (video.length) {\r\n        return `<video controls preload=\"auto\" poster=\"${video.attr('data-thumbnail')}\"><source src=\"${video.attr('data-url')}\" /></video>`;\r\n    }\r\n    const imageList = $('script:contains(\"imageList\")').text();\r\n    if (imageList) {\r\n        const list = JSON.parse(imageList.match(/(\\[.*\\])/s)?.[1].replaceAll(/(\"description\": \".*\"),/g, '$1') || '[]');\r\n        return list.map((item: any) => `<img src=\"${item.url}\" alt=\"${item.description || ''}\" />`).join('');\r\n    }\r\n    return '';\r\n}\r\n"],"mappings":"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"}