{"version":3,"file":"subject-Bzn2-JAE.js","names":["route: Route","got"],"sources":["../../lib/routes/douban/channel/subject.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\n\r\nexport const route: Route = {\r\n    path: '/channel/:id/subject/:nav',\r\n    categories: ['social-media'],\r\n    example: '/douban/channel/30168934/subject/0',\r\n    parameters: { id: '频道id', nav: '书影音分类' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '频道书影音',\r\n    maintainers: ['umm233'],\r\n    handler,\r\n    description: `| 电影 | 电视剧 | 图书 | 唱片 |\r\n| ---- | ------ | ---- | ---- |\r\n| 0    | 1      | 2    | 3    |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n    const nav = ctx.req.param('nav');\r\n    const link = `https://www.douban.com/subject/${id}`;\r\n\r\n    const channel_info_response = await got({\r\n        method: 'get',\r\n        url: `https://m.douban.com/rexxar/api/v2/elessar/channel/${id}`,\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `https://m.douban.com/rexxar/api/v2/elessar/channel/${id}/subjects?ck=null&for_mobile=1`,\r\n        headers: {\r\n            Referer: link,\r\n        },\r\n    });\r\n\r\n    const channel_name = channel_info_response.data.title;\r\n    const data = response.data.modules[nav].payload.subjects;\r\n    let nav_name = '';\r\n\r\n    switch (nav) {\r\n        case '0':\r\n            nav_name = '电影';\r\n            break;\r\n        case '1':\r\n            nav_name = '电视剧';\r\n            break;\r\n        case '2':\r\n            nav_name = '书籍';\r\n            break;\r\n        case '3':\r\n            nav_name = '唱片';\r\n            break;\r\n    }\r\n\r\n    return {\r\n        title: `豆瓣${channel_name}频道-${nav_name}推荐`,\r\n        link,\r\n        description: `豆瓣${channel_name}频道书影音下的${nav_name}推荐`,\r\n\r\n        item: data.map(({ title, extra, cover_img, url }) => {\r\n            const rate = extra.rating_group.rating ? `${extra.rating_group.rating.value.toFixed(1)}分` : extra.rating_group.null_rating_reason;\r\n\r\n            const description = `标题：${title} <br> 信息：${extra.short_info} <br> 评分：${rate} <br> <img src=\"${cover_img.url}\">`;\r\n\r\n            return {\r\n                title,\r\n                description,\r\n                link: url,\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"gOAGA,MAAaA,EAAe,CACxB,KAAM,4BACN,WAAY,CAAC,gBACb,QAAS,qCACT,WAAY,CAAE,GAAI,OAAQ,IAAK,SAC/B,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,QACN,YAAa,CAAC,UACd,UACA,YAAa;;kCAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,MACnB,EAAM,EAAI,IAAI,MAAM,OACpB,EAAO,kCAAkC,IAEzC,EAAwB,MAAMC,EAAI,CACpC,OAAQ,MACR,IAAK,sDAAsD,IAC3D,QAAS,CACL,QAAS,KAIX,EAAW,MAAMA,EAAI,CACvB,OAAQ,MACR,IAAK,sDAAsD,EAAG,gCAC9D,QAAS,CACL,QAAS,KAIX,EAAe,EAAsB,KAAK,MAC1C,EAAO,EAAS,KAAK,QAAQ,GAAK,QAAQ,SAC5C,EAAW,GAEf,OAAQ,EAAR,CACI,IAAK,IACD,EAAW,KACX,MACJ,IAAK,IACD,EAAW,MACX,MACJ,IAAK,IACD,EAAW,KACX,MACJ,IAAK,IACD,EAAW,KACX,MAGR,MAAO,CACH,MAAO,KAAK,EAAa,KAAK,EAAS,IACvC,OACA,YAAa,KAAK,EAAa,SAAS,EAAS,IAEjD,KAAM,EAAK,KAAK,CAAE,QAAO,QAAO,YAAW,SAAU,CACjD,IAAM,EAAO,EAAM,aAAa,OAAS,GAAG,EAAM,aAAa,OAAO,MAAM,QAAQ,GAAG,GAAK,EAAM,aAAa,mBAEzG,EAAc,MAAM,EAAM,WAAW,EAAM,WAAW,WAAW,EAAK,kBAAkB,EAAU,IAAI,IAE5G,MAAO,CACH,QACA,cACA,KAAM"}