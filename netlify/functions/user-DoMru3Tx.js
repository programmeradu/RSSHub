import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as r}from"./got-CdvI2yKX.js";import{config_not_found_default as i}from"./config-not-found-BVqhRP9D.js";import{load as a}from"cheerio";const o=`https://sehuatang.org/`,s={path:`/user/:uid`,categories:[`multimedia`],example:`/sehuatang/user/411096`,parameters:{uid:`用户 uid, 可在用户主页 URL 中找到`},features:{requireConfig:[{name:`SEHUATANG_COOKIE`,description:``}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`作者文章`,maintainers:[`JamYiz`],handler:c};async function c(s){if(!e.sehuatang.cookie)throw new i(`Sehuatang RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let c=s.req.param(`uid`),l=`${o}home.php?mod=space&uid=${c}&do=thread&view=me&from=space`,u=await r(l,{headers:{Cookie:e.sehuatang.cookie,"Accept-Encoding":`gzip, deflate, br`,"Accept-Language":`zh-CN,zh;q=0.9,en;q=0.8`}}),d=a(u.data),f=d(`#delform tr:not(.th)`).slice(0,s.req.query(`limit`)?Number.parseInt(s.req.query(`limit`)):25).toArray().map(e=>{e=d(e);let t=e.find(`th>a`).first(),n=e.find(`.xg1`).first().text();return{title:`[${n}] ${t.text()}`,link:o+t.attr(`href`),author:d(`.mt`).first().text()}}),p=await Promise.all(f.map(i=>t.tryGet(i.link,async()=>{let t=await r(i.link,{headers:{Cookie:e.sehuatang.cookie,"Accept-Encoding":`gzip, deflate, br`,"Accept-Language":`zh-CN,zh;q=0.9,en;q=0.8`}}),s=a(t.data),c=s(`[id^='postmessage']`).slice(0,1),l=s(c).find(`img`);for(let e of l){let t=s(e).attr(`file`);!t||t===`undefined`?s(e).replaceWith(``):s(e).replaceWith(s(`<img src="${t}">`))}let u=s(`.pattl`),d=s(u).find(`img`);for(let e of d){let t=s(e).attr(`file`);!t||t===`undefined`?s(e).replaceWith(``):s(e).replaceWith(s(`<img src="${t}" />`))}c.append(s(u)),s(`em[onclick]`).remove(),i.description=(c.html()||`抓取原帖失败`).replaceAll(`ignore_js_op`,`div`);let f=s(`.authi em`).first().text(),p=f.split(` `)[1],m=f.split(` `)[2],h=`${p} ${m}`,g=new Date(h).getTime();i.pubDate=s(`.authi em span`).length>0?n(s(`.authi em span`).attr(`title`)):n(g);let _=c.find(`div.blockcode li`).first().text(),v=_.startsWith(`magnet`),y=c.find(`p.attnm a`).attr(`href`),b=v||y!==void 0;if(b){let e=v?_:new URL(y,o).href;i.enclosure_url=e,i.enclosure_type=v?`application/x-bittorrent`:`application/octet-stream`}return i})));return{title:`${d(`.mt`).text()}的帖子-色花堂`,link:l,item:p}}export{s as route};
//# sourceMappingURL=user-DoMru3Tx.js.map