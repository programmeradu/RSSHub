{"version":3,"file":"news-DJVMWXTS.js","names":["route: Route","ofetch","cache","response"],"sources":["../../lib/routes/warhammer-community/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/news',\r\n    categories: ['game'],\r\n    example: '/warhammer-community/news',\r\n    radar: [\r\n        {\r\n            source: ['www.warhammer-community.com/en-gb/all-news-and-features/', 'www.warhammer-community.com/en-gb/'],\r\n        },\r\n    ],\r\n    name: 'News',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'www.warhammer-community.com/en-gb/all-news-and-features/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://www.warhammer-community.com';\r\n    const limit = Number.parseInt(ctx.req.query('limit') || '16', 10);\r\n\r\n    const response = await ofetch(`${baseUrl}/api/search/news/`, {\r\n        method: 'POST',\r\n        body: {\r\n            sortBy: 'date_desc',\r\n            category: '',\r\n            collections: ['articles'],\r\n            game_systems: [],\r\n            index: 'news',\r\n            locale: 'en-gb',\r\n            page: 0,\r\n            perPage: limit,\r\n            topics: [],\r\n        },\r\n    });\r\n\r\n    const list = response.news.map((item) => ({\r\n        title: item.title,\r\n        link: `${baseUrl}/en-gb${item.uri}/`,\r\n        description: item.excerpt,\r\n        image: `https://assets.warhammer-community.com/${item.image.path}`,\r\n        pubDate: parseDate(item.date),\r\n        category: item.topics.map((topic) => topic.title),\r\n    }));\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await ofetch(item.link);\r\n                const $ = load(response);\r\n\r\n                const content = $('.article-content');\r\n                content.find('button').remove();\r\n\r\n                item.description = content.html() || item.description;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: 'All News and Features - Warhammer Community',\r\n        link: `${baseUrl}/en-gb/all-news-and-features/`,\r\n        image: `${baseUrl}/images/apple-favicon.png`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mTAOA,MAAaA,EAAe,CACxB,KAAM,QACN,WAAY,CAAC,QACb,QAAS,4BACT,MAAO,CACH,CACI,OAAQ,CAAC,2DAA4D,wCAG7E,KAAM,OACN,YAAa,CAAC,UACd,UACA,IAAK,4DAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,sCACV,EAAQ,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,KAAM,IAExD,EAAW,MAAMC,EAAO,GAAG,EAAQ,mBAAoB,CACzD,OAAQ,OACR,KAAM,CACF,OAAQ,YACR,SAAU,GACV,YAAa,CAAC,YACd,aAAc,GACd,MAAO,OACP,OAAQ,QACR,KAAM,EACN,QAAS,EACT,OAAQ,MAIV,EAAO,EAAS,KAAK,IAAK,IAAU,CACtC,MAAO,EAAK,MACZ,KAAM,GAAG,EAAQ,QAAQ,EAAK,IAAI,GAClC,YAAa,EAAK,QAClB,MAAO,0CAA0C,EAAK,MAAM,OAC5D,QAAS,EAAU,EAAK,MACxB,SAAU,EAAK,OAAO,IAAK,GAAU,EAAM,UAGzC,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAW,MAAMF,EAAO,EAAK,MAC7B,EAAI,EAAKE,GAET,EAAU,EAAE,oBAKlB,OAJA,EAAQ,KAAK,UAAU,SAEvB,EAAK,YAAc,EAAQ,QAAU,EAAK,YAEnC,MAKnB,MAAO,CACH,MAAO,8CACP,KAAM,GAAG,EAAQ,+BACjB,MAAO,GAAG,EAAQ,2BAClB,KAAM"}