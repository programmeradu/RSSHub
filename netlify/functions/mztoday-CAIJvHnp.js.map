{"version":3,"file":"mztoday-CAIJvHnp.js","names":[],"sources":["../../lib/routes/gov/sichuan/deyang/mztoday.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst rootUrl = 'http://www.mztoday.gov.cn';\r\nconst basicInfoDict = {\r\n    zx: {\r\n        name: '最新',\r\n        url: '/news.html?page=1',\r\n    },\r\n    tj: {\r\n        name: '推荐',\r\n        url: '/list/42.html?page=1',\r\n    },\r\n    sz: {\r\n        name: '时政',\r\n        url: '/list/39.html?page=1',\r\n    },\r\n    jy: {\r\n        name: '教育',\r\n        url: '/list/40.html?page=1',\r\n    },\r\n    ms: {\r\n        name: '民生',\r\n        url: '/list/41.html?page=1',\r\n    },\r\n    wl: {\r\n        name: '文旅',\r\n        url: '/list/41.html?page=1',\r\n    },\r\n    jj: {\r\n        name: '经济',\r\n        url: '/list/53.html?page=1',\r\n    },\r\n    wwcj: {\r\n        name: '文明创建',\r\n        url: '/list/54.html?page=1',\r\n    },\r\n    bxsh: {\r\n        name: '文明创建',\r\n        url: '/list/55.html?page=1',\r\n    },\r\n    bm: {\r\n        name: '部门',\r\n        url: '/list/56.html?page=1',\r\n    },\r\n    zj: {\r\n        name: '镇（街道）',\r\n        url: '/list/57.html?page=1',\r\n    },\r\n    jkmz: {\r\n        name: '健康绵竹',\r\n        url: '/list/59.html?page=1',\r\n    },\r\n    nxjt: {\r\n        name: '南轩讲堂',\r\n        url: '/list/70.html?page=1',\r\n    },\r\n    sp: {\r\n        name: '视频',\r\n        url: '/vlist.html?page=1',\r\n    },\r\n    wmsj: {\r\n        name: '文明实践',\r\n        url: '/list/71.html?page=1',\r\n    },\r\n    lhzg: {\r\n        name: '领航中国',\r\n        url: '/list/74.html?page=1',\r\n    },\r\n    mznh: {\r\n        name: '绵竹年画',\r\n        url: '/list/36.html?page=1',\r\n    },\r\n    mzls: {\r\n        name: '绵竹历史',\r\n        url: '/list/16.html?page=1',\r\n    },\r\n    mzly: {\r\n        name: '绵竹旅游',\r\n        url: '/list/37.html?page=1',\r\n    },\r\n    wwkmz: {\r\n        name: '外媒看绵竹',\r\n        url: '/list/50.html?page=1',\r\n    },\r\n};\r\n\r\nconst getInfoUrlList = async (url) => {\r\n    const response = await got(url);\r\n    const $ = load(response.data);\r\n    const infoList = $('div.sl')\r\n        .toArray()\r\n        .map((item) => ({\r\n            title: $('a', item).attr('title'),\r\n            url: `${rootUrl}${$('a', item).attr('href')}`,\r\n            pubDate: parseDate(timezone($('div > div:nth-child(4)', item).html().trim()), +8),\r\n        }));\r\n    return infoList;\r\n};\r\n\r\n// 获取信息正文内容\r\nconst getInfoContent = (item) =>\r\n    cache.tryGet(item.url, async () => {\r\n        const response = await got(item.url);\r\n        const $ = load(response.data);\r\n        return {\r\n            title: item.title,\r\n            content: $('td:nth-child(2)').html(),\r\n            link: item.url,\r\n            pubDate: item.pubDate,\r\n        };\r\n    });\r\n\r\nexport const route: Route = {\r\n    path: '/sichuan/deyang/mztoday/:infoType?',\r\n    categories: ['government'],\r\n    example: '/gov/sichuan/deyang/mztoday/zx',\r\n    parameters: { infoType: '信息栏目名称。默认最新(zx)' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.mztoday.gov.cn/*'],\r\n            target: '/sichuan/deyang/mztoday',\r\n        },\r\n    ],\r\n    name: '今日绵竹',\r\n    maintainers: ['zytomorrow'],\r\n    handler,\r\n    url: 'www.mztoday.gov.cn/*',\r\n    description: `| 最新 | 推荐 | 时政 | 教育 | 民生 | 文旅 | 经济 | 文明创建 | 部门 | 镇（街道） | 健康绵竹 | 南轩讲堂 | 视频 | 文明实践 | 领航中国 | 绵竹年画 | 绵竹历史 | 绵竹旅游 | 外媒看绵竹 |\r\n| ---- | ---- | ---- | ---- | ---- | ---- | ---- | -------- | ---- | ---------- | -------- | -------- | ---- | -------- | -------- | -------- | -------- | -------- | ---------- |\r\n| zx   | tj   | sz   | jy   | ms   | wl   | jj   | wmcj     | bm   | zj         | jkmz     | nxjt     | sp   | wmsj     | lhzg     | mznh     | mzls     | mzly     | wmkmz      |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const infoType = ctx.req.param('infoType') || 'zx';\r\n    const infoBasicUrl = `${rootUrl}${basicInfoDict[infoType].url}`;\r\n    const infoUrlList = await getInfoUrlList(infoBasicUrl);\r\n    const items = await Promise.all(infoUrlList.map((item) => getInfoContent(item)));\r\n\r\n    return {\r\n        title: `今日绵竹-${basicInfoDict[infoType].name}`,\r\n        link: `${infoBasicUrl}1`,\r\n        item: items.map((item) => ({\r\n            title: item.title,\r\n            description: art(path.join(__dirname, './templates/mztoday.art'), { item }),\r\n            link: item.link,\r\n            pubDate: item.pubDate,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"0gBAUA,MAAM,EAAU,4BACV,EAAgB,CAClB,GAAI,CACA,KAAM,KACN,IAAK,qBAET,GAAI,CACA,KAAM,KACN,IAAK,wBAET,GAAI,CACA,KAAM,KACN,IAAK,wBAET,GAAI,CACA,KAAM,KACN,IAAK,wBAET,GAAI,CACA,KAAM,KACN,IAAK,wBAET,GAAI,CACA,KAAM,KACN,IAAK,wBAET,GAAI,CACA,KAAM,KACN,IAAK,wBAET,KAAM,CACF,KAAM,OACN,IAAK,wBAET,KAAM,CACF,KAAM,OACN,IAAK,wBAET,GAAI,CACA,KAAM,KACN,IAAK,wBAET,GAAI,CACA,KAAM,QACN,IAAK,wBAET,KAAM,CACF,KAAM,OACN,IAAK,wBAET,KAAM,CACF,KAAM,OACN,IAAK,wBAET,GAAI,CACA,KAAM,KACN,IAAK,sBAET,KAAM,CACF,KAAM,OACN,IAAK,wBAET,KAAM,CACF,KAAM,OACN,IAAK,wBAET,KAAM,CACF,KAAM,OACN,IAAK,wBAET,KAAM,CACF,KAAM,OACN,IAAK,wBAET,KAAM,CACF,KAAM,OACN,IAAK,wBAET,MAAO,CACH,KAAM,QACN,IAAK,yBAIP,EAAiB,KAAO,IAAQ,CAClC,IAAM,EAAW,MAAM,EAAI,GACrB,EAAI,EAAK,EAAS,MAClB,EAAW,EAAE,UACd,UACA,IAAK,IAAU,CACZ,MAAO,EAAE,IAAK,GAAM,KAAK,SACzB,IAAK,GAAG,IAAU,EAAE,IAAK,GAAM,KAAK,UACpC,QAAS,EAAU,EAAS,EAAE,yBAA0B,GAAM,OAAO,QAAS,MAEtF,OAAO,GAIL,EAAkB,GACpB,EAAM,OAAO,EAAK,IAAK,SAAY,CAC/B,IAAM,EAAW,MAAM,EAAI,EAAK,KAC1B,EAAI,EAAK,EAAS,MACxB,MAAO,CACH,MAAO,EAAK,MACZ,QAAS,EAAE,mBAAmB,OAC9B,KAAM,EAAK,IACX,QAAS,EAAK,WAIb,EAAe,CACxB,KAAM,qCACN,WAAY,CAAC,cACb,QAAS,iCACT,WAAY,CAAE,SAAU,mBACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,wBACT,OAAQ,4BAGhB,KAAM,OACN,YAAa,CAAC,cACd,UACA,IAAK,uBACL,YAAa;;qLAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,KACxC,EAAe,GAAG,IAAU,EAAc,GAAU,MACpD,EAAc,MAAM,EAAe,GACnC,EAAQ,MAAM,QAAQ,IAAI,EAAY,IAAK,GAAS,EAAe,KAEzE,MAAO,CACH,MAAO,QAAQ,EAAc,GAAU,OACvC,KAAM,GAAG,EAAa,GACtB,KAAM,EAAM,IAAK,IAAU,CACvB,MAAO,EAAK,MACZ,YAAa,EAAI,EAAA,KAAA,EAAA,kCAAiD,CAAE,SACpE,KAAM,EAAK,KACX,QAAS,EAAK"}