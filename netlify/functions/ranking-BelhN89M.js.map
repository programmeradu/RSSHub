{"version":3,"file":"ranking-BelhN89M.js","names":["route: Route","got","InvalidParameterError","cache"],"sources":["../../lib/routes/ithome/ranking.ts"],"sourcesContent":["import InvalidParameterError from '@/errors/types/invalid-parameter';\r\nimport { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/ranking/:type',\r\n    categories: ['new-media'],\r\n    example: '/ithome/ranking/24h',\r\n    parameters: { type: '类别' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '热榜',\r\n    maintainers: ['immmortal', 'luyuhuang'],\r\n    handler,\r\n    description: `| 24h           | 7days    | monthly |\r\n| ------------- | -------- | ------- |\r\n| 24 小时阅读榜 | 7 天最热 | 月榜    |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const option = ctx.req.param('type');\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: 'https://www.ithome.com/block/rank.html',\r\n    });\r\n    const $ = load(response.data);\r\n\r\n    const config = {\r\n        '24h': '24 小时最热',\r\n        '7days': '7 天最热',\r\n        monthly: '月榜',\r\n    };\r\n\r\n    const type2id = {\r\n        '24h': 'd-1',\r\n        '7days': 'd-2',\r\n        monthly: 'd-3',\r\n    };\r\n\r\n    const title = config[option];\r\n    const id = type2id[option];\r\n\r\n    if (!id) {\r\n        throw new InvalidParameterError('Bad type. See <a href=\"https://docs.rsshub.app/routes/new-media#it-zhi-jia\">https://docs.rsshub.app/routes/new-media#it-zhi-jia</a>');\r\n    }\r\n\r\n    const list = $(`#${id} > li`)\r\n        .toArray()\r\n        .map((item) => {\r\n            const info = {\r\n                title: $(item).find('a').text(),\r\n                link: $(item).find('a').attr('href'),\r\n            };\r\n            return info;\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const res = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n                const content = load(res.data);\r\n                const paragraph = content('#paragraph');\r\n                paragraph.find('img[data-original]').each((_, ele) => {\r\n                    ele = $(ele);\r\n                    ele.attr('src', ele.attr('data-original'));\r\n                    ele.removeAttr('class');\r\n                    ele.removeAttr('data-original');\r\n                });\r\n                item.description = paragraph.html();\r\n                item.pubDate = new Date(content('#pubtime_baidu').text() + ' GMT+8').toUTCString();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `IT之家-${title}`,\r\n        link: 'https://www.ithome.com',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"+XAMA,MAAaA,EAAe,CACxB,KAAM,iBACN,WAAY,CAAC,aACb,QAAS,sBACT,WAAY,CAAE,KAAM,MACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,YAAa,aAC3B,UACA,YAAa;;+BAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAS,EAAI,IAAI,MAAM,QAEvB,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,2CAEH,EAAI,EAAK,EAAS,MAElB,EAAS,CACX,MAAO,UACP,QAAS,QACT,QAAS,MAGP,EAAU,CACZ,MAAO,MACP,QAAS,MACT,QAAS,OAGP,EAAQ,EAAO,GACf,EAAK,EAAQ,GAEnB,GAAI,CAAC,EACD,MAAM,IAAIC,EAAsB,uIAGpC,IAAM,EAAO,EAAE,IAAI,EAAG,QACjB,UACA,IAAK,GAAS,CACX,IAAM,EAAO,CACT,MAAO,EAAE,GAAM,KAAK,KAAK,OACzB,KAAM,EAAE,GAAM,KAAK,KAAK,KAAK,SAEjC,OAAO,IAGT,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAM,MAAMF,EAAI,CAClB,OAAQ,MACR,IAAK,EAAK,OAER,EAAU,EAAK,EAAI,MACnB,EAAY,EAAQ,cAS1B,OARA,EAAU,KAAK,sBAAsB,MAAM,EAAG,IAAQ,CAClD,EAAM,EAAE,GACR,EAAI,KAAK,MAAO,EAAI,KAAK,kBACzB,EAAI,WAAW,SACf,EAAI,WAAW,mBAEnB,EAAK,YAAc,EAAU,OAC7B,EAAK,QAAU,IAAI,KAAK,EAAQ,kBAAkB,OAAS,UAAU,cAC9D,MAKnB,MAAO,CACH,MAAO,QAAQ,IACf,KAAM,yBACN,KAAM"}