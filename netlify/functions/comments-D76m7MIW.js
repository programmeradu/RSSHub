import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{ofetch_default as n}from"./ofetch-Bzt0BXUH.js";import r from"markdown-it";const i=r({html:!0}),a=`https://api.github.com`,o={issue:{title:`Issue`},issues:{title:`Issue`},pull:{title:`Pull request`}},s={path:`/comments/:user/:repo/:number?`,categories:[`programming`],example:`/github/comments/DIYgod/RSSHub/8116`,parameters:{user:`User / Org name`,repo:`Repo name`,number:`Issue or pull number (if omitted: all)`},radar:[{source:[`github.com/:user/:repo/:type`,`github.com/:user/:repo/:type/:number`],target:`/comments/:user/:repo/:number?`}],name:`Issue / Pull Request comments`,maintainers:[`TonyRL`,`FliegendeWurst`],handler:c};async function c(t){let n=t.req.param(`user`),r=t.req.param(`repo`),i=t.req.param(`number`)&&Number.isNaN(Number.parseInt(t.req.param(`number`)))?1:Number.parseInt(t.req.param(`number`)),a=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):100,o=e.github&&e.github.access_token?{Accept:`application/vnd.github.v3+json`,Authorization:`token ${e.github.access_token}`}:{Accept:`application/vnd.github.v3+json`};return await(Number.isNaN(i)?l(t,n,r,a,o):u(t,n,r,i,a,o))}async function l(e,r,s,c,l){let u=await n.raw(`${a}/repos/${r}/${s}/issues/comments`,{headers:l,query:{sort:`updated`,direction:`desc`,per_page:c}}),d=u._data,f=d.map(e=>{let n=e.actor?.login??e.user?.login??`ghost`,a=e.issue_url.split(`/`),c=a.at(-1),l=e.html_url.split(`/`),u=o[l.at(-2)].title;return{title:`${n} commented on ${r}/${s}: ${u} #${c}`,author:n,pubDate:t(e.created_at),link:e.html_url,description:e.body?i.render(e.body):null}}),p={limit:Number.parseInt(u.headers.get(`x-ratelimit-limit`)),remaining:Number.parseInt(u.headers.get(`x-ratelimit-remaining`)),reset:t(Number.parseInt(u.headers.get(`x-ratelimit-reset`))*1e3),resoure:u.headers.get(`x-ratelimit-resource`),used:Number.parseInt(u.headers.get(`x-ratelimit-used`))},m={title:`${r}/${s}: Issue & Pull request comments`,link:`https://github.com/${r}/${s}`,item:f};return e.set(`json`,{...m,rateLimit:p}),m}async function u(e,r,s,c,l,u){let d=await n.raw(`${a}/repos/${r}/${s}/issues/${c}`,{headers:u}),f=d._data,p=f.pull_request?`pull`:`issue`,m=await n.raw(f.timeline_url,{headers:u,query:{per_page:l}}),h=[],g=m.headers.get(`link`)?.match(/<(\S+?)>; rel="last"/)?.[1];g?m=await n.raw(g,{headers:u}):h.push({title:`${f.user.login} created ${r}/${s}: ${o[p].title} #${f.number}`,description:f.body?i.render(f.body):null,author:f.user.login,pubDate:t(f.created_at),link:`${f.html_url}#issue-${f.id}`});let _=m._data;for(let e of _){let n=e.actor?.login??e.user?.login??`ghost`;switch(e.event){case`closed`:h.push({title:`${n} ${e.event} ${r}/${s}: ${o[p].title} #${f.number}`,author:n,pubDate:t(e.created_at),link:e.url});break;case`commented`:h.push({title:`${n} ${e.event} on ${r}/${s}: ${o[p].title} #${f.number}`,description:i.render(e.body),author:n,pubDate:t(e.created_at),link:e.html_url});break;case`cross-referenced`:h.push({title:`${n} ${e.event} on ${r}/${s}: ${o[p].title} #${f.number}`,description:`${n} mentioned this issue in <a href='${e.source.issue.html_url}'><b>${e.source.issue.title}</b> #${e.source.issue.number}</a>`,author:n,pubDate:t(e.created_at),guid:`${n} ${e.event} on ${r}/${s}: ${o[p].title} #${f.number} on ${e.created_at}`,link:`${n} ${e.event} on ${r}/${s}: ${o[p].title} #${f.number} on ${e.created_at}`});break;case`renamed`:h.push({title:`${n} ${e.event} on ${r}/${s}: ${o[p].title} #${f.number}`,description:`${n} changed the title <del>${e.rename.from}</del> ${e.rename.to}`,author:n,pubDate:t(e.created_at),link:e.url});break;case`reviewed`:h.push({title:`${e.user.login} ${e.event} on ${r}/${s}: ${o[p].title} #${f.number}`,description:e.body?i.render(e.body):e.state.replace(`_`,` `),author:e.user.login,pubDate:t(e.submitted_at),link:e.html_url});break;default:break}}let v={title:`${r}/${s}: ${o[p].title} #${c} - ${f.title}`,link:f.html_url,item:h};return e.set(`json`,{...v,rateLimit:{limit:Number.parseInt(d.headers.get(`x-ratelimit-limit`)),remaining:Number.parseInt(d.headers.get(`x-ratelimit-remaining`)),reset:t(Number.parseInt(d.headers.get(`x-ratelimit-reset`))*1e3),resoure:d.headers.get(`x-ratelimit-resource`),used:Number.parseInt(d.headers.get(`x-ratelimit-used`))}}),v}export{s as route};
//# sourceMappingURL=comments-D76m7MIW.js.map