{"version":3,"file":"report-ClEj4vD0.js","names":[],"sources":["../../lib/routes/questmobile/report.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\n/**\r\n * Parses a tree array and returns an array of objects containing the key-value pairs.\r\n * @param {Array} tree - The tree to parse.\r\n * @param {Array} result - The result array to store the parsed key-value pairs. Default is an empty array.\r\n *\r\n * @returns {Array} - An array of objects containing the key-value pairs.\r\n */\r\nconst parseTree = (tree, result = []) => {\r\n    for (const obj of tree) {\r\n        const { key, value, children } = obj;\r\n        result.push({ key, value });\r\n\r\n        if (children && children.length > 0) {\r\n            parseTree(children, result);\r\n        }\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/report/:industry?/:label?',\r\n    categories: ['new-media'],\r\n    example: '/questmobile/report',\r\n    parameters: { industry: '行业，见下表，默认为 `-1`，即全部行业', label: '标签，见下表，默认为 `-1`，即全部标签' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '行业研究报告',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `::: tip\r\n  若订阅行业 [互联网行业](https://www.questmobile.com.cn/research/reports/1/-1)，网址为 \\`https://www.questmobile.com.cn/research/reports/1/-1\\`\r\n  参数 industry 为 \\`互联网行业\\` 或 \\`1\\`，此时路由为 [\\`/questmobile/report/互联网行业\\`](https://rsshub.app/questmobile/report/互联网行业) 或 [\\`/questmobile/report/1/-1\\`](https://rsshub.app/questmobile/report/1/-1)。\r\n\r\n  若订阅标签 [榜单](https://www.questmobile.com.cn/research/reports/-1/11)，网址为 \\`https://www.questmobile.com.cn/research/reports/-1/11\\`\r\n  参数 label 为 \\`榜单\\` 或 \\`11\\`，此时路由为 [\\`/questmobile/report/榜单\\`](https://rsshub.app/questmobile/report/榜单) 或 [\\`/questmobile/report/-1/11\\`](https://rsshub.app/questmobile/report/-1/11)。\r\n\r\n  若订阅行业和标签 [品牌领域 - 互联网经济](https://www.questmobile.com.cn/research/reports/2/1)，网址为 \\`https://www.questmobile.com.cn/research/reports/2/1\\`\r\n  参数 industry 为 \\`品牌领域\\` 或 \\`2\\`，参数 label 为 \\`互联网经济\\` 或 \\`1\\`，此时路由为 [\\`/questmobile/report/品牌领域/互联网经济\\`](https://rsshub.app/questmobile/report/品牌领域/互联网经济) 或 [\\`/questmobile/report/2/1\\`](https://rsshub.app/questmobile/report/2/1)，甚至 [\\`/questmobile/report/品牌领域/1\\`](https://rsshub.app/questmobile/report/品牌领域/1)。\r\n:::\r\n\r\n<details>\r\n<summary>全部行业和标签</summary>\r\n\r\n#### 行业\r\n\r\n| 互联网行业 | 移动社交 | 移动视频 | 移动购物 | 系统工具 |\r\n| ---------- | -------- | -------- | -------- | -------- |\r\n| 1          | 1001     | 1002     | 1003     | 1004     |\r\n\r\n| 出行服务 | 金融理财 | 生活服务 | 移动音乐 | 新闻资讯 |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| 1005     | 1006     | 1007     | 1008     | 1009     |\r\n\r\n| 办公商务 | 手机游戏 | 实用工具 | 数字阅读 | 教育学习 |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| 1010     | 1011     | 1012     | 1013     | 1014     |\r\n\r\n| 汽车服务 | 拍摄美化 | 智能设备 | 旅游服务 | 健康美容 |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| 1015     | 1016     | 1017     | 1018     | 1020     |\r\n\r\n| 育儿母婴 | 主题美化 | 医疗服务 | 品牌领域 | 美妆品牌 |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| 1022     | 1023     | 1024     | 2        | 2001     |\r\n\r\n| 母婴品牌 | 家电品牌 | 食品饮料品牌 | 汽车品牌 | 服饰箱包品牌 |\r\n| -------- | -------- | ------------ | -------- | ------------ |\r\n| 2002     | 2003     | 2004         | 2005     | 2006         |\r\n\r\n#### 标签\r\n\r\n| 互联网经济 | 圈层经济 | 粉丝经济 | 银发经济 | 儿童经济 |\r\n| ---------- | -------- | -------- | -------- | -------- |\r\n| 1          | 1001     | 1002     | 1004     | 1005     |\r\n\r\n| 萌宠经济 | 她经济 | 他经济 | 泛娱乐经济 | 下沉市场经济 |\r\n| -------- | ------ | ------ | ---------- | ------------ |\r\n| 1007     | 1009   | 1010   | 1011       | 1012         |\r\n\r\n| 内容经济 | 订阅经济 | 会员经济 | 居家经济 | 到家经济 |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| 1013     | 1014     | 1015     | 1016     | 1017     |\r\n\r\n| 颜值经济 | 闲置经济 | 旅游经济            | 人群洞察 | 00 后 |\r\n| -------- | -------- | ------------------- | -------- | ----- |\r\n| 1018     | 1020     | 1622842051677753346 | 2        | 2002  |\r\n\r\n| Z 世代 | 银发族 | 宝妈宝爸 | 萌宠人群 | 运动达人 |\r\n| ------ | ------ | -------- | -------- | -------- |\r\n| 2003   | 2004   | 2005     | 2007     | 2008     |\r\n\r\n| 女性消费 | 男性消费 | 游戏人群 | 二次元 | 新中产 |\r\n| -------- | -------- | -------- | ------ | ------ |\r\n| 2009     | 2010     | 2012     | 2013   | 2014   |\r\n\r\n| 下沉市场用户 | 大学生 | 数字化营销 | 广告效果 | 品牌营销 |\r\n| ------------ | ------ | ---------- | -------- | -------- |\r\n| 2018         | 2022   | 3          | 3001     | 3002     |\r\n\r\n| 全域营销 | 私域流量 | 新媒体营销 | KOL 生态 | 内容营销 |\r\n| -------- | -------- | ---------- | -------- | -------- |\r\n| 3003     | 3004     | 3005       | 3006     | 3008     |\r\n\r\n| 直播电商 | 短视频带货 | 娱乐营销            | 营销热点 | 双 11 电商大促 |\r\n| -------- | ---------- | ------------------- | -------- | -------------- |\r\n| 3009     | 3010       | 1630464311158738945 | 4        | 4001           |\r\n\r\n| 618 电商大促 | 春节营销 | 五一假期营销 | 热点事件盘点 | 消费热点 |\r\n| ------------ | -------- | ------------ | ------------ | -------- |\r\n| 4002         | 4003     | 4004         | 4007         | 5        |\r\n\r\n| 时尚品牌 | 连锁餐饮 | 新式茶饮 | 智能家电 | 国潮品牌 |\r\n| -------- | -------- | -------- | -------- | -------- |\r\n| 5001     | 5002     | 5003     | 5004     | 5007     |\r\n\r\n| 白酒品牌            | 精益运营 | 媒介策略 | 用户争夺 | 精细化运营 |\r\n| ------------------- | -------- | -------- | -------- | ---------- |\r\n| 1622841828310093825 | 6        | 6001     | 6002     | 6003       |\r\n\r\n| 用户分层 | 增长黑马 | 社交裂变 | 新兴领域 | 新能源汽车 |\r\n| -------- | -------- | -------- | -------- | ---------- |\r\n| 6004     | 6005     | 6007     | 7        | 7001       |\r\n\r\n| 智能汽车 | 新消费 | AIoT | 产业互联网 | AIGC                |\r\n| -------- | ------ | ---- | ---------- | ------------------- |\r\n| 7002     | 7003   | 7004 | 7005       | 1645677998450511873 |\r\n\r\n| OTT 应用            | 智能电视            | 全景数据 | 全景生态 | 微信小程序 |\r\n| ------------------- | ------------------- | -------- | -------- | ---------- |\r\n| 1676063510499528705 | 1676063630293045249 | 8        | 8001     | 8002       |\r\n\r\n| 支付宝小程序 | 百度智能小程序 | 企业流量            | 抖音小程序          | 手机终端 |\r\n| ------------ | -------------- | ------------------- | ------------------- | -------- |\r\n| 8003         | 8004           | 1671052842096496642 | 1676063017220018177 | 9        |\r\n\r\n| 智能终端 | 国产终端 | 5G 手机 | 盘点 | 季度报告 |\r\n| -------- | -------- | ------- | ---- | -------- |\r\n| 9001     | 9002     | 9003    | 10   | 10001    |\r\n</details>`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { industry, label } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 50;\r\n\r\n    const rootUrl = 'https://www.questmobile.com.cn';\r\n    const apiUrl = new URL('api/v2/report/article-list', rootUrl).href;\r\n    const apiTreeUrl = new URL('api/v2/report/industry-label-tree', rootUrl).href;\r\n\r\n    const {\r\n        data: {\r\n            data: { industryTree, labelTree },\r\n        },\r\n    } = await got(apiTreeUrl);\r\n\r\n    const industries = parseTree(industryTree);\r\n    const labels = parseTree(labelTree);\r\n\r\n    const industryObj = industry ? industries.find((i) => i.key === industry || i.value === industry) : undefined;\r\n    const labelObj = label ? labels.find((i) => i.key === label || i.value === label) : industryObj ? undefined : labels.find((i) => i.key === industry || i.value === industry);\r\n\r\n    const industryId = industryObj?.key ?? -1;\r\n    const labelId = labelObj?.key ?? -1;\r\n\r\n    const currentUrl = new URL(`research/reports/${industryObj?.key ?? -1}/${labelObj?.key ?? -1}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(apiUrl, {\r\n        searchParams: {\r\n            version: 0,\r\n            pageSize: limit,\r\n            pageNo: 1,\r\n            industryId,\r\n            labelId,\r\n        },\r\n    });\r\n\r\n    let items = response.data.slice(0, limit).map((item) => ({\r\n        title: item.title,\r\n        link: new URL(`research/report/${item.id}`, rootUrl).href,\r\n        description: art(path.join(__dirname, 'templates/description.art'), {\r\n            image: {\r\n                src: item.coverImgUrl,\r\n                alt: item.title,\r\n            },\r\n            introduction: item.introduction,\r\n            description: item.content,\r\n        }),\r\n        category: [...(item.industryList ?? []), ...(item.labelList ?? [])],\r\n        guid: `questmobile-report#${item.id}`,\r\n        pubDate: parseDate(item.publishTime),\r\n    }));\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const content = load(detailResponse);\r\n\r\n                content('div.text div.daoyu').remove();\r\n\r\n                item.title = content('div.title h1').text();\r\n                item.description += art(path.join(__dirname, 'templates/description.art'), {\r\n                    description: content('div.text').html(),\r\n                });\r\n                item.author = content('div.source')\r\n                    .text()\r\n                    .replace(/^.*?：/, '');\r\n                item.category = content('div.hy, div.keyword')\r\n                    .find('span')\r\n                    .toArray()\r\n                    .map((c) => content(c).text());\r\n                item.pubDate = parseDate(content('div.data span').prop('datetime'));\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const { data: currentResponse } = await got(currentUrl);\r\n\r\n    const $ = load(currentResponse);\r\n\r\n    const author = $('meta[property=\"og:title\"]').prop('content').split(/-/)[0];\r\n    const categories = [industryObj?.value, labelObj?.value].filter(Boolean);\r\n    const image = $(`img[alt=\"${author}\"]`).prop('src');\r\n    const icon = $('link[rel=\"shortcut icon\"]').prop('href');\r\n\r\n    return {\r\n        item: items,\r\n        title: `${author}${categories.length === 0 ? '' : ` - ${categories.join(' - ')}`}`,\r\n        link: currentUrl,\r\n        description: $('meta[property=\"og:description\"]').prop('content'),\r\n        language: 'zh',\r\n        image,\r\n        icon,\r\n        logo: icon,\r\n        subtitle: $('meta[name=\"keywords\"]').prop('content'),\r\n        author,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"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"}