import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as n}from"./got-CdvI2yKX.js";import{timezone as r}from"./timezone-BrNu6iXe.js";import{load as i}from"cheerio";import a from"query-string";const o={path:`/thread/:tid`,categories:[`bbs`],example:`/saraba1st/thread/751272`,parameters:{tid:`帖子 id`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`帖子`,maintainers:[`zengxs`],handler:s,description:"帖子网址如果为 `https://stage1st.com/2b/thread-751272-1-1.html` 那么帖子 id 就是 `751272`。"};async function s(o){let s=o.req.param(`tid`),c=e.saraba1st.cookie??``,l=e.saraba1st.host,u=await n(`${l}/2b/forum.php`,{searchParams:a.stringify({mod:`viewthread`,tid:s,ordertype:1}),headers:{Cookie:c}}),d=i(u.data),f=d(`#thread_subject`).text(),p=d(`#postlist > div[id^=post_]:not(:first-of-type)`),m=[];for(let e=0;e<Math.min(p.length,20);e++)m.push(e);let h=new URL(`/image/common/none.gif`,l);h.hostname=`static.${h.hostname.split(`.`).slice(-2).join(`.`)}`;let g=m.map(e=>{let n=d(p[e]),i=n.find(`td.plc .pi a > em`).text(),a=n.find(`td.plc .pi a`).attr(`href`),o=d(n.find(`td.t_f`)),s=o.find(`img`);for(let e of s)if(e.attribs.src===h.href){e.attribs.src=e.attribs.file;let t=d(e);t.removeAttr(`zoomfile`),t.removeAttr(`file`),t.removeAttr(`onmouseover`),t.removeAttr(`onclick`)}return o.find(`div.aimg_tip`).remove(),{title:`${f} #${i}`,link:new URL(a,`${l}/2b/`).href,description:o.html(),author:n.find(`.authi .xw1`).text(),pubDate:r(t(n.find(`.authi em`).text()),8)}});return{title:`Stage1 论坛 - ${f}`,link:`${l}/2b/thread-${s}-1-1.html`,item:g}}export{o as route};
//# sourceMappingURL=thread-BbQ2nijp.js.map