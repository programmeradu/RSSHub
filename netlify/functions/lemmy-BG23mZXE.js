import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as r}from"./got-CdvI2yKX.js";import{invalid_parameter_default as i}from"./invalid-parameter-CUJdROXf.js";import{config_not_found_default as a}from"./config-not-found-BVqhRP9D.js";import o from"markdown-it";const s=o({html:!0}),c={path:`/:community/:sort?`,categories:[`social-media`],example:`/lemmy/technology@lemmy.world/Hot`,parameters:{community:`Lemmmy community, for example technology@lemmy.world`,sort:{description:`Sort by`,options:[{value:`Active`,label:`Active`},{value:`Hot`,label:`Hot`},{value:`New`,label:`New`},{value:`Old`,label:`Old`},{value:`TopDay`,label:`TopDay`},{value:`TopWeek`,label:`TopWeek`},{value:`TopMonth`,label:`TopMonth`},{value:`TopYear`,label:`TopYear`},{value:`TopAll`,label:`TopAll`},{value:`MostComments`,label:`MostComments`},{value:`NewComments`,label:`NewComments`},{value:`TopHour`,label:`TopHour`},{value:`TopSixHour`,label:`TopSixHour`},{value:`TopTwelveHour`,label:`TopTwelveHour`},{value:`TopThreeMonths`,label:`TopThreeMonths`},{value:`TopSixMonths`,label:`TopSixMonths`},{value:`TopNineMonths`,label:`TopNineMonths`},{value:`Controversial`,label:`Controversial`},{value:`Scaled`,label:`Scaled`}],default:`Active`}},features:{requireConfig:[{name:`ALLOW_USER_SUPPLY_UNSAFE_DOMAIN`,description:``}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Community`,maintainers:[`wb14123`,`pseudoyu`],handler:l};async function l(o){let c=o.req.param(`sort`)??`Active`,l=o.req.param(`community`),u=l.split(`@`);if(u.length!==2)throw new i(`Invalid community: ${l}`);let d=l.split(`@`)[1],f=[`lemmy.world`,`lemm.ee`,`lemmy.ml`,`sh.itjust.works`,`feddit.de`,`hexbear.net`,`beehaw.org`,`lemmynsfw.com`,`lemmy.ca`,`programming.dev`];if(!e.feature.allow_user_supply_unsafe_domain&&!f.includes(new URL(`http://${d}/`).hostname))throw new a(`This RSS is disabled unless 'ALLOW_USER_SUPPLY_UNSAFE_DOMAIN' is set to 'true'.`);let p=`https://${d}/api/v3/community?name=${l}`,m=await t.tryGet(p,async()=>{let e=await r({method:`get`,url:p,headers:{"Content-Type":`application/json`}});return e.data.community_view.community}),h=`https://${d}/api/v3/post/list?type_=All&sort=${c}&community_name=${l}&limit=50`,g=await t.tryGet(h,async()=>{let e=await r({method:`get`,url:h,headers:{"Content-Type":`application/json`}});return e.data},e.cache.routeExpire,!1),_=g.posts.map(e=>{let t=e.post,r=e.creator,i=e.counts,a={};a.title=t.name,a.author=r.name,a.pubDate=n(t.published),a.link=t.ap_id;let o=t.url,c=o?`<p><a href="${o}">${o}</a></p>`:``,l=t.body?s.render(t.body):``;return a.description=c+l,a.comments=i.comments,a.upvotes=i.upvotes,a.downvotes=i.downvotes,a});return{title:`${l} - ${c} posts`,description:m.description,link:m.actor_id,item:_}}export{c as route};
//# sourceMappingURL=lemmy-BG23mZXE.js.map