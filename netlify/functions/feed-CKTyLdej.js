import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import"./md5-4BNsOP-F.js";import"./ofetch-Bzt0BXUH.js";import{got_default as n}from"./got-CdvI2yKX.js";import"./config-not-found-BVqhRP9D.js";import{_access_default as r,_constants_default as i,getFilteredLanguages as a,getMangaMetaByIds as o,toQueryString as s}from"./_feed-BTGNS7pd.js";const c={name:`MDList Feed`,path:`/mdlist/:id/:lang?`,radar:[{source:[`mangadex.org/list/:id/:suffix`],target:`/mdlist/:id`}],description:`Sepcific MangaDex MDList Feed`,example:`/mangadex/mdlist/10cca803-8dc9-4f0e-86a8-6659a3ce5188?limit=10&private=true`,maintainers:[`chrisis58`],categories:[`anime`],parameters:{id:{description:`The list id of the manga list`},private:{description:`(Query Param) Needed to access private lists, any value will be treated as true`}},features:{requireConfig:[{name:`MANGADEX_USERNAME`,description:`MangaDex Username, required when refresh-token is not set and the list is private`,optional:!0},{name:`MANGADEX_PASSWORD`,description:`MangaDex Password, required when refresh-token is not set and the list is private`,optional:!0},{name:`MANGADEX_CLIENT_ID`,description:`MangaDex Client ID, required when the list is private`,optional:!0},{name:`MANGADEX_CLIENT_SECRET`,description:`MangaDex Client Secret, required when the list is private`,optional:!0},{name:`MANGADEX_REFRESH_TOKEN`,description:`MangaDex Refresh Token, required when username and password are not set and the list is private`,optional:!0}]},handler:l};async function l(c){let{id:l,lang:u}=c.req.param(),d=c.req.query(`limit`)?Number.parseInt(c.req.query(`limit`)):25,f=!!c.req.query(`private`),p=f?await r():void 0,m=new Set([...typeof u==`string`?[u]:u||[],...await a()].filter(Boolean)),{listName:h,listAuthor:g}=await t.tryGet(`mangadex:mdlist-info-${l}`,async()=>{let t=await n.get(`${i.API.BASE}/list/${l}${s({includes:[`user`]})}`,{headers:{Authorization:String(f?`Bearer ${p}`:``),"User-Agent":e.trueUA}}),r=t?.data?.data;if(!r)throw Error(`Failed to retrieve user follows from MangaDex API.`);let a=r.attributes.name,o=r.relationships.find(e=>e.type===`user`)?.attributes.username;return{listName:a,listAuthor:o}},e.cache.contentExpire),_=await t.tryGet(`mangadex:mdlist-feed-${l}`,async()=>{let t=await n.get(`${i.API.BASE}/list/${l}/feed${s({limit:d,translatedLanguage:m,order:{publishAt:`desc`}})}`,{headers:{Authorization:String(f?`Bearer ${p}`:``),"User-Agent":e.trueUA}}),r=t?.data?.data;if(!r)throw Error(`Failed to retrieve user follows from MangaDex API.`);return r},e.cache.routeExpire,!1),v=_.map(e=>e?.relationships.find(e=>e.type===`manga`)?.id),y=await o(v);return{title:`MDList - ${h} by ${g}`,link:`https://mangadex.org/list/${l}?tab=feed`,description:`The latest updates of all the manga in a sepcific list`,item:_.map(e=>{let t=e.relationships.find(e=>e.type===`manga`)?.id,n=y.get(t),r=[e.attributes.volume?`Vol. ${e.attributes.volume}`:null,e.attributes.chapter?`Ch. ${e.attributes.chapter}`:null,e.attributes.title].filter(Boolean).join(` `);return{title:n?.title||`Unknown`,link:`${i.API.MANGA_CHAPTERS}${e.id}`,pubDate:new Date(e.attributes.publishAt),description:r,image:n?.cover}})}}export{c as route};
//# sourceMappingURL=feed-CKTyLdej.js.map