{"version":3,"file":"pencilnews-at1V9IwM.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/pencilnews/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/',\r\n    categories: ['new-media'],\r\n    example: '/pencilnews',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '文章列表',\r\n    maintainers: ['defp'],\r\n    handler,\r\n    description: '获取铅笔道最新文章',\r\n};\r\n\r\nasync function handler() {\r\n    const baseUrl = 'https://www.pencilnews.cn';\r\n    const apiUrl = 'https://api.pencilnews.cn/articles';\r\n\r\n    const response = await got(apiUrl, {\r\n        searchParams: {\r\n            page: 0,\r\n            page_size: 20,\r\n        },\r\n    });\r\n\r\n    const {\r\n        data: { articles },\r\n    } = response.data;\r\n\r\n    const items = await Promise.all(\r\n        articles.map((article) => {\r\n            const info = article.article_info;\r\n            const articleId = info.article_id;\r\n            const link = `${baseUrl}/p/${articleId}.html`;\r\n\r\n            return cache.tryGet(link, async () => {\r\n                const detailResponse = await got(link);\r\n                const $ = load(detailResponse.data);\r\n                const content = $('.article_content').html();\r\n\r\n                return {\r\n                    title: info.title,\r\n                    description: content,\r\n                    link,\r\n                    author: article.author?.profile?.name || '',\r\n                    pubDate: parseDate(info.create_at, 'YYYY-MM-DD HH:mm:ss'),\r\n                    category: [],\r\n                    guid: articleId,\r\n                };\r\n            });\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: '铅笔道',\r\n        link: baseUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAaA,EAAe,CACxB,KAAM,IACN,WAAY,CAAC,aACb,QAAS,cACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,QACd,UACA,YAAa,aAGjB,eAAe,GAAU,CACrB,IAAM,EAAU,4BAGV,EAAW,MAAMC,EAAI,qCAAQ,CAC/B,aAAc,CACV,KAAM,EACN,UAAW,MAIb,CACF,KAAM,CAAE,aACR,EAAS,KAEP,EAAQ,MAAM,QAAQ,IACxB,EAAS,IAAK,GAAY,CACtB,IAAM,EAAO,EAAQ,aACf,EAAY,EAAK,WACjB,EAAO,GAAG,EAAQ,KAAK,EAAU,OAEvC,OAAOC,EAAM,OAAO,EAAM,SAAY,CAClC,IAAM,EAAiB,MAAMD,EAAI,GAC3B,EAAI,EAAK,EAAe,MACxB,EAAU,EAAE,oBAAoB,OAEtC,MAAO,CACH,MAAO,EAAK,MACZ,YAAa,EACb,OACA,OAAQ,EAAQ,QAAQ,SAAS,MAAQ,GACzC,QAAS,EAAU,EAAK,UAAW,uBACnC,SAAU,GACV,KAAM,QAMtB,MAAO,CACH,MAAO,MACP,KAAM,EACN,KAAM"}