{"version":3,"file":"asiantolick-Bd4cg7NE.js","names":[],"sources":["../../lib/routes/asiantolick/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/:category{.+}?',\r\n    radar: [\r\n        {\r\n            source: ['asiantolick.com/'],\r\n            target: '',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n    url: 'asiantolick.com/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category');\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 24;\r\n\r\n    const rootUrl = 'https://asiantolick.com';\r\n    const apiUrl = new URL('ajax/buscar_posts.php', rootUrl).href;\r\n    const currentUrl = new URL(category?.replace(/^(tag|category)?\\/(\\d+)/, '$1-$2') ?? '', rootUrl).href;\r\n\r\n    const searchParams = {};\r\n    const matches = category?.match(/^(tag|category|search|page)?[/-]?(\\w+)/) ?? undefined;\r\n\r\n    if (matches) {\r\n        const key = matches[1] === 'category' ? 'cat' : matches[1];\r\n        const value = matches[2];\r\n        searchParams[key] = value;\r\n    } else if (category) {\r\n        searchParams.page = 'news';\r\n    }\r\n\r\n    const { data: response } = await got(apiUrl, {\r\n        searchParams,\r\n    });\r\n\r\n    let $ = load(response);\r\n\r\n    let items = $('a.miniatura')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const image = item.find('div.background_miniatura img');\r\n\r\n            return {\r\n                title: item.find('div.base_tt').text(),\r\n                link: item.prop('href'),\r\n                description: art(path.join(__dirname, 'templates/description.art'), {\r\n                    images: image\r\n                        ? [\r\n                              {\r\n                                  src: image.prop('data-src').split(/\\?/)[0],\r\n                                  alt: image.prop('alt'),\r\n                              },\r\n                          ]\r\n                        : undefined,\r\n                }),\r\n                author: item.find('.author').text(),\r\n                category: item\r\n                    .find('.category')\r\n                    .toArray()\r\n                    .map((c) => $(c).text()),\r\n                guid: image ? image.prop('post-id') : item.link.match(/\\/(\\d+)/)[1],\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const content = load(detailResponse);\r\n\r\n                item.title = content('h1').first().text();\r\n                item.description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    description: content('#metadata_qrcode').html(),\r\n                    images: content('div.miniatura')\r\n                        .toArray()\r\n                        .map((i) => ({\r\n                            src: content(i).prop('data-src'),\r\n                            alt: content(i).find('img').prop('alt'),\r\n                        })),\r\n                });\r\n                item.author = content('.author').text();\r\n                item.category = content('#categoria_tags_post a')\r\n                    .toArray()\r\n                    .map((c) => content(c).text().trim().replace(/^#/, ''));\r\n                item.pubDate = parseDate(detailResponse.match(/\"pubDate\":\\s\"((?!http)[^\"]*)\"/)[1]);\r\n                item.updated = parseDate(detailResponse.match(/\"upDate\":\\s\"((?!http)[^\"]*)\"/)[1]);\r\n                item.enclosure_url = new URL(`ajax/download_post.php?ver=3&dir=/down/new_${item.guid}&post_id=${item.guid}&post_name=${detailResponse.match(/\"title\":\\s\"((?!http)[^\"]*)\"/)[1]}`, rootUrl).href;\r\n\r\n                item.guid = `asiantolick-${item.guid}`;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const { data: currentResponse } = await got(currentUrl);\r\n\r\n    $ = load(currentResponse);\r\n\r\n    const title = $('title').text().split(/-/)[0].trim();\r\n    const icon = $('link[rel=\"icon\"]').first().prop('href');\r\n\r\n    return {\r\n        item: items,\r\n        title: title === 'Asian To Lick' ? title : `Asian To Lick - ${title}`,\r\n        link: currentUrl,\r\n        description: $('meta[property=\"og:description\"]').prop('content'),\r\n        language: $('html').prop('lang'),\r\n        image: $('meta[name=\"msapplication-TileImage\"]').prop('content'),\r\n        icon,\r\n        logo: icon,\r\n        subtitle: title,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"wdASA,MAAa,EAAe,CACxB,KAAM,kBACN,MAAO,CACH,CACI,OAAQ,CAAC,oBACT,OAAQ,KAGhB,KAAM,UACN,YAAa,GACb,UACA,IAAK,oBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,0BACV,EAAS,IAAI,IAAI,wBAAyB,GAAS,KACnD,EAAa,IAAI,IAAI,GAAU,QAAQ,0BAA2B,UAAY,GAAI,GAAS,KAE3F,EAAe,GACf,EAAU,GAAU,MAAM,2CAA6C,IAAA,GAE7E,GAAI,EAAS,CACT,IAAM,EAAM,EAAQ,KAAO,WAAa,MAAQ,EAAQ,GAClD,EAAQ,EAAQ,GACtB,EAAa,GAAO,OACb,IACP,EAAa,KAAO,QAGxB,GAAM,CAAE,KAAM,GAAa,MAAM,EAAI,EAAQ,CACzC,iBAGA,EAAI,EAAK,GAET,EAAQ,EAAE,eACT,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAQ,EAAK,KAAK,gCAExB,MAAO,CACH,MAAO,EAAK,KAAK,eAAe,OAChC,KAAM,EAAK,KAAK,QAChB,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,OAAQ,EACF,CACI,CACI,IAAK,EAAM,KAAK,YAAY,MAAM,MAAM,GACxC,IAAK,EAAM,KAAK,SAGxB,IAAA,KAEV,OAAQ,EAAK,KAAK,WAAW,OAC7B,SAAU,EACL,KAAK,aACL,UACA,IAAK,GAAM,EAAE,GAAG,QACrB,KAAM,EAAQ,EAAM,KAAK,WAAa,EAAK,KAAK,MAAM,WAAW,MAI7E,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACP,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAM,EAAI,EAAK,MAE1C,EAAU,EAAK,GAsBrB,MApBA,GAAK,MAAQ,EAAQ,MAAM,QAAQ,OACnC,EAAK,YAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACtE,YAAa,EAAQ,oBAAoB,OACzC,OAAQ,EAAQ,iBACX,UACA,IAAK,IAAO,CACT,IAAK,EAAQ,GAAG,KAAK,YACrB,IAAK,EAAQ,GAAG,KAAK,OAAO,KAAK,YAG7C,EAAK,OAAS,EAAQ,WAAW,OACjC,EAAK,SAAW,EAAQ,0BACnB,UACA,IAAK,GAAM,EAAQ,GAAG,OAAO,OAAO,QAAQ,KAAM,KACvD,EAAK,QAAU,EAAU,EAAe,MAAM,iCAAiC,IAC/E,EAAK,QAAU,EAAU,EAAe,MAAM,gCAAgC,IAC9E,EAAK,cAAgB,IAAI,IAAI,8CAA8C,EAAK,KAAK,WAAW,EAAK,KAAK,aAAa,EAAe,MAAM,+BAA+B,KAAM,GAAS,KAE1L,EAAK,KAAO,eAAe,EAAK,OAEzB,MAKnB,GAAM,CAAE,KAAM,GAAoB,MAAM,EAAI,GAE5C,EAAI,EAAK,GAET,IAAM,EAAQ,EAAE,SAAS,OAAO,MAAM,KAAK,GAAG,OACxC,EAAO,EAAE,oBAAoB,QAAQ,KAAK,QAEhD,MAAO,CACH,KAAM,EACN,MAAO,IAAU,gBAAkB,EAAQ,mBAAmB,IAC9D,KAAM,EACN,YAAa,EAAE,mCAAmC,KAAK,WACvD,SAAU,EAAE,QAAQ,KAAK,QACzB,MAAO,EAAE,wCAAwC,KAAK,WACtD,OACA,KAAM,EACN,SAAU,EACV,WAAY"}