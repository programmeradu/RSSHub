{"version":3,"file":"medsci-CEH77Dyg.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/medsci/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate, parseRelativeDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/:sid?/:tid?',\r\n    categories: ['new-media'],\r\n    example: '/medsci',\r\n    parameters: { sid: '科室，见下表，默认为推荐', tid: '亚专业，可在对应科室页 URL 中找到，默认为该科室的全部' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '资讯',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `::: tip\r\n  下表为科室对应的 sid，若想获得 tid，可以到对应科室页面 URL 中寻找 \\`t_id\\` 字段的值，下面是一个例子：\r\n\r\n  如 [肿瘤 - NSCLC](https://www.medsci.cn/department/details?s_id=5\\&t_id=277) 的 URL 为 \\`https://www.medsci.cn/department/details?s_id=5&t_id=277\\`，可以看到此时 \\`s_id\\` 对应 \\`sid\\` 的值为 5， \\`t_id\\` 对应 \\`tid\\` 的值为 277，所以可以得到路由 [\\`/medsci/5/277\\`](https://rsshub.app/medsci/5/277)\r\n:::\r\n\r\n| 心血管 | 内分泌 | 消化 | 呼吸 | 神经科 |\r\n| ------ | ------ | ---- | ---- | ------ |\r\n| 2      | 6      | 4    | 12   | 17     |\r\n\r\n| 传染科 | 精神心理 | 肾内科 | 风湿免疫 | 血液科 |\r\n| ------ | -------- | ------ | -------- | ------ |\r\n| 9      | 13       | 14     | 15       | 21     |\r\n\r\n| 老年医学 | 胃肠外科 | 血管外科 | 肝胆胰外 | 骨科 |\r\n| -------- | -------- | -------- | -------- | ---- |\r\n| 19       | 76       | 92       | 91       | 10   |\r\n\r\n| 普通外科 | 胸心外科 | 神经外科 | 泌尿外科 | 烧伤科 |\r\n| -------- | -------- | -------- | -------- | ------ |\r\n| 23       | 24       | 25       | 26       | 27     |\r\n\r\n| 整形科 | 麻醉疼痛 | 罕见病 | 康复医学 | 药械 |\r\n| ------ | -------- | ------ | -------- | ---- |\r\n| 28     | 29       | 304    | 95       | 11   |\r\n\r\n| 儿科 | 耳鼻咽喉 | 口腔科 | 眼科 | 政策人文 |\r\n| ---- | -------- | ------ | ---- | -------- |\r\n| 18   | 30       | 31     | 32   | 33       |\r\n\r\n| 营养全科 | 预防公卫 | 妇产科 | 中医科 | 急重症 |\r\n| -------- | -------- | ------ | ------ | ------ |\r\n| 34       | 35       | 36     | 37     | 38     |\r\n\r\n| 皮肤性病 | 影像放射 | 转化医学 | 检验病理 | 护理 |\r\n| -------- | -------- | -------- | -------- | ---- |\r\n| 39       | 40       | 42       | 69       | 79   |\r\n\r\n| 糖尿病 | 冠心病 | 肝病 | 乳腺癌 |\r\n| ------ | ------ | ---- | ------ |\r\n| 8      | 43     | 22   | 89     |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let sid = ctx.req.param('sid') ?? '';\r\n    const tid = ctx.req.param('tid') ?? '';\r\n\r\n    sid = sid === 'recommend' ? '' : sid;\r\n\r\n    const rootUrl = 'https://www.medsci.cn';\r\n    const currentUrl = `${rootUrl}${sid ? `/department/details?s_id=${sid}&module=article${tid ? `&t_id=${tid}` : ''}` : ''}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    let items = $('#articleList')\r\n        .find('.ms-link')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const pubDate = item.parent().parent().find('.item-meta-item').first().text();\r\n\r\n            return {\r\n                title: item.text(),\r\n                link: `${rootUrl}${item.attr('href').replace(/;jsessionid=[\\dA-Z]+/, '')}`,\r\n                pubDate: pubDate.indexOf('-') > 0 ? parseDate(pubDate) : parseRelativeDate(pubDate),\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n\r\n                const content = load(detailResponse.data);\r\n\r\n                const pubDateMatches = detailResponse.data.match(/\"publishedTime\":\"(.*)\",\"publishedTimeString\"/);\r\n\r\n                item.author = content('.name').text();\r\n                item.description = content('#content').html();\r\n                item.pubDate = pubDateMatches ? parseDate(pubDateMatches[1]) : item.pubDate;\r\n                item.category =\r\n                    content('meta[name=\"keywords\"]')\r\n                        .attr('content')\r\n                        ?.split(/,|，/)\r\n                        .filter((c) => c !== '' && c !== 'undefined') ?? [];\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${sid ? $('.department-header-active').text() : '推荐'} -${tid ? ` ${$('.department-keywords-ul .active').text()} -` : ''} MedSci.cn`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"+XAMA,MAAaA,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,aACb,QAAS,UACT,WAAY,CAAE,IAAK,eAAgB,IAAK,iCACxC,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;sCA2CjB,eAAe,EAAQ,EAAK,CACxB,IAAI,EAAM,EAAI,IAAI,MAAM,QAAU,GAC5B,EAAM,EAAI,IAAI,MAAM,QAAU,GAEpC,EAAM,IAAQ,YAAc,GAAK,EAEjC,IAAM,EAAU,wBACV,EAAa,GAAG,IAAU,EAAM,4BAA4B,EAAI,iBAAiB,EAAM,SAAS,IAAQ,KAAO,KAE/G,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAEpB,EAAQ,EAAE,gBACT,KAAK,YACL,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAU,EAAK,SAAS,SAAS,KAAK,mBAAmB,QAAQ,OAEvE,MAAO,CACH,MAAO,EAAK,OACZ,KAAM,GAAG,IAAU,EAAK,KAAK,QAAQ,QAAQ,uBAAwB,MACrE,QAAS,EAAQ,QAAQ,KAAO,EAAI,EAAU,GAAW,EAAkB,MA8BvF,MA1BA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGR,EAAU,EAAK,EAAe,MAE9B,EAAiB,EAAe,KAAK,MAAM,gDAWjD,MATA,GAAK,OAAS,EAAQ,SAAS,OAC/B,EAAK,YAAc,EAAQ,YAAY,OACvC,EAAK,QAAU,EAAiB,EAAU,EAAe,IAAM,EAAK,QACpE,EAAK,SACD,EAAQ,yBACH,KAAK,YACJ,MAAM,OACP,OAAQ,GAAM,IAAM,IAAM,IAAM,cAAgB,GAElD,MAKZ,CACH,MAAO,GAAG,EAAM,EAAE,6BAA6B,OAAS,KAAK,IAAI,EAAM,IAAI,EAAE,mCAAmC,OAAO,IAAM,GAAG,YAChI,KAAM,EACN,KAAM"}