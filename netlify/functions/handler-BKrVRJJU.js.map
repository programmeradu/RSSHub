{"version":3,"file":"handler-BKrVRJJU.js","names":["NEWS_TYPES: Record<string, NewsCategory>","handler: Route['handler']","got","cache","dataItems: DataItem[]","route: Route"],"sources":["../../lib/routes/cpta/handler.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport pMap from 'p-map';\r\n\r\ntype NewsCategory = {\r\n    title: string;\r\n    baseUrl: string;\r\n    description: string;\r\n};\r\n\r\nconst WEBSITE_URL = 'http://www.cpta.com.cn';\r\n\r\nconst NEWS_TYPES: Record<string, NewsCategory> = {\r\n    notice: {\r\n        title: '通知公告',\r\n        baseUrl: 'http://www.cpta.com.cn/notice.html',\r\n        description: '中国人事考试网 考试通知公告汇总',\r\n    },\r\n    performance: {\r\n        title: '成绩公布',\r\n        baseUrl: 'http://www.cpta.com.cn/performance.html',\r\n        description: '中国人事考试网 考试成绩公布汇总',\r\n    },\r\n};\r\n\r\nconst handler: Route['handler'] = async (ctx) => {\r\n    const category = ctx.req.param('category');\r\n    const BASE_URL = NEWS_TYPES[category].baseUrl;\r\n    // Fetch the index page\r\n    const { data: listResponse } = await got(BASE_URL);\r\n    const $ = load(listResponse);\r\n\r\n    // Select all list items containing news information\r\n    const ITEM_SELECTOR = 'ul[class*=\"list_14\"] > li:has(*)';\r\n    const listItems = $(ITEM_SELECTOR);\r\n\r\n    // Map through each list item to extract details\r\n    const contentLinkList = listItems\r\n        .toArray()\r\n        .map((element) => {\r\n            const title = $(element).find('a').attr('title')!;\r\n            const date = $(element).find('i').text()!.replaceAll(/[[\\]]/g, '');\r\n            const relativeLink = $(element).find('a').attr('href')!;\r\n            const absoluteLink = new URL(relativeLink, WEBSITE_URL).href;\r\n            return {\r\n                title,\r\n                date,\r\n                link: absoluteLink,\r\n            };\r\n        })\r\n        .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())\r\n        .slice(0, 10);\r\n\r\n    const fetchDataItem = (item: { title: string; date: string; link: string }) =>\r\n        cache.tryGet(item.link, async () => {\r\n            const CONTENT_SELECTOR = '#p_content';\r\n            const { data: contentResponse } = await got(item.link);\r\n            const contentPage = load(contentResponse);\r\n            const content = contentPage(CONTENT_SELECTOR).html() || '';\r\n            return {\r\n                title: item.title,\r\n                pubDate: item.date,\r\n                link: item.link,\r\n                description: content,\r\n                category: ['study'],\r\n                guid: item.link,\r\n                id: item.link,\r\n                image: 'https://www.gov.cn/images/gtrs_logo_lt.png',\r\n                content: {\r\n                    html: content,\r\n                    text: content,\r\n                },\r\n                updated: item.date,\r\n                language: 'zh-CN',\r\n            } as DataItem;\r\n        });\r\n\r\n    const dataItems: DataItem[] = await pMap(contentLinkList, fetchDataItem, { concurrency: 1 });\r\n\r\n    return {\r\n        title: `中国人事考试网-${NEWS_TYPES[category].title}`,\r\n        description: NEWS_TYPES[category].description,\r\n        link: BASE_URL,\r\n        image: 'https://www.gov.cn/images/gtrs_logo_lt.png',\r\n        item: dataItems,\r\n        allowEmpty: true,\r\n        language: 'zh-CN',\r\n        feedLink: `https://rsshub.app/cpta/${category}`,\r\n        id: `https://rsshub.app/cpta/${category}`,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category',\r\n    name: '中国人事考试网发布',\r\n    maintainers: ['PrinOrange'],\r\n    parameters: {\r\n        category: '栏目参数，可见下表描述。',\r\n    },\r\n    description: `\r\n| Category    | Title     | Description                         |\r\n|-------------|-----------|-------------------------------------|\r\n| notice      | 通知公告  | 中国人事考试网 考试通知公告汇总    |\r\n| performance | 成绩公布  | 中国人事考试网 考试成绩公布汇总    |\r\n`,\r\n    handler,\r\n    categories: ['study'],\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n        supportRadar: true,\r\n        antiCrawler: true,\r\n    },\r\n    radar: [\r\n        {\r\n            title: '中国人事考试网通知公告',\r\n            source: ['www.cpta.com.cn/notice.html', 'www.cpta.com.cn'],\r\n            target: `/notice`,\r\n        },\r\n        {\r\n            title: '中国人事考试网成绩发布',\r\n            source: ['www.cpta.com.cn/performance.html', 'www.cpta.com.cn'],\r\n            target: `/performance`,\r\n        },\r\n    ],\r\n    example: '/cpta/notice',\r\n};\r\n"],"mappings":"wUAYA,MAEMA,EAA2C,CAC7C,OAAQ,CACJ,MAAO,OACP,QAAS,qCACT,YAAa,oBAEjB,YAAa,CACT,MAAO,OACP,QAAS,0CACT,YAAa,qBAIfC,EAA4B,KAAO,IAAQ,CAC7C,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAW,EAAW,GAAU,QAEhC,CAAE,KAAM,GAAiB,MAAMC,EAAI,GACnC,EAAI,EAAK,GAIT,EAAY,EAAE,oCAGd,EAAkB,EACnB,UACA,IAAK,GAAY,CACd,IAAM,EAAQ,EAAE,GAAS,KAAK,KAAK,KAAK,SAClC,EAAO,EAAE,GAAS,KAAK,KAAK,OAAQ,WAAW,SAAU,IACzD,EAAe,EAAE,GAAS,KAAK,KAAK,KAAK,QACzC,EAAe,IAAI,IAAI,EAAc,0BAAa,KACxD,MAAO,CACH,QACA,OACA,KAAM,KAGb,MAAM,EAAG,IAAM,IAAI,KAAK,EAAE,MAAM,UAAY,IAAI,KAAK,EAAE,MAAM,WAC7D,MAAM,EAAG,IAER,EAAiB,GACnBC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GACM,CAAE,KAAM,GAAoB,MAAMD,EAAI,EAAK,MAC3C,EAAc,EAAK,GACnB,EAAU,EAAY,cAAkB,QAAU,GACxD,MAAO,CACH,MAAO,EAAK,MACZ,QAAS,EAAK,KACd,KAAM,EAAK,KACX,YAAa,EACb,SAAU,CAAC,SACX,KAAM,EAAK,KACX,GAAI,EAAK,KACT,MAAO,6CACP,QAAS,CACL,KAAM,EACN,KAAM,GAEV,QAAS,EAAK,KACd,SAAU,WAIhBE,EAAwB,MAAM,EAAK,EAAiB,EAAe,CAAE,YAAa,IAExF,MAAO,CACH,MAAO,WAAW,EAAW,GAAU,QACvC,YAAa,EAAW,GAAU,YAClC,KAAM,EACN,MAAO,6CACP,KAAM,EACN,WAAY,GACZ,SAAU,QACV,SAAU,2BAA2B,IACrC,GAAI,2BAA2B,MAI1BC,EAAe,CACxB,KAAM,aACN,KAAM,YACN,YAAa,CAAC,cACd,WAAY,CACR,SAAU,gBAEd,YAAa;;;;;EAMb,UACA,WAAY,CAAC,SACb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,UAAW,GACX,eAAgB,GAChB,cAAe,GACf,aAAc,GACd,YAAa,IAEjB,MAAO,CACH,CACI,MAAO,cACP,OAAQ,CAAC,8BAA+B,mBACxC,OAAQ,WAEZ,CACI,MAAO,cACP,OAAQ,CAAC,mCAAoC,mBAC7C,OAAQ,iBAGhB,QAAS"}