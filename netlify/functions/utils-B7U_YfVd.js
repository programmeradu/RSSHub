import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{ofetch_default as n}from"./ofetch-Bzt0BXUH.js";import{timezone as r}from"./timezone-BrNu6iXe.js";import{load as i}from"cheerio";async function a(a,o,s,c,l,u){let d=await n(o,{rejectUnauthorized:!1}).catch(()=>null);if(!d)return[];let f=i(d),p=f(`tr[height=20]`).toArray().map(e=>(e=f(e),{title:e.find(c).attr(`title`),link:new URL(e.find(c).attr(`href`),s).href,pubDate:r(t(e.find(l).text().trim(),`YYYY-MM-DD`),8)})),m=await Promise.all(p.map(a=>e.tryGet(a.link,async()=>{if(a.link.includes(`.jsp`))return{...a,description:`该通知无法直接预览，请点击原文链接↑查看`};let e=await n(a.link,{rejectUnauthorized:!1}).catch(()=>null);if(!e||e.status>=300&&e.status<400)a.description=`该通知无法直接预览，请点击原文链接↑查看`;else{let n=i(e);a.title=n(u.title).text();let o=n(`script:contains("showVsbpdfIframe")`).length>0;if(o)a.description=`该通知无法直接预览，请点击原文链接↑查看`;else{let e=i(n(u.content).html());e(`a`).each(function(){let e=n(this),t=e.attr(`href`);t&&!t.startsWith(`http`)&&e.attr(`href`,new URL(t,s).href)}),a.description=e.html()}let c=n(u.date).text().replaceAll(/年|月/g,`-`).replaceAll(`日`,``);a.pubDate=r(t(c),8)}return a})));return m}export{a as getNoticeList};
//# sourceMappingURL=utils-B7U_YfVd.js.map