{"version":3,"file":"bdys-BDGUMGvm.js","names":[],"sources":["../../lib/routes/bdys/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport pMap from 'p-map';\r\nimport { config } from '@/config';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\n// Visit https://www.bdys.me for the list of domains\r\nconst allowDomains = new Set(['52bdys.com', 'bde4.icu', 'bdys01.com']);\r\n\r\nexport const route: Route = {\r\n    path: '/:caty?/:type?/:area?/:year?/:order?',\r\n    categories: ['multimedia'],\r\n    example: '/bdys',\r\n    parameters: {\r\n        caty: '影视类型，见下表，默认为 `all` 即不限',\r\n        type: '资源分类，见下表，默认为 `all` 即不限',\r\n        area: '制片地区，见下表，默认为 `all` 即不限',\r\n        year: '上映时间，此处填写年份不小于2000，默认为 `all` 即不限',\r\n        order: '影视排序，见下表，默认为更新时间',\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '首页',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `#### 资源分类\r\n\r\n| 不限 | 电影 | 电视剧 |\r\n| ---- | ---- | ------ |\r\n| all  | 0    | 1      |\r\n\r\n#### 影视类型\r\n\r\n| 不限 | 动作    | 爱情   | 喜剧 | 科幻   | 恐怖   |\r\n| ---- | ------- | ------ | ---- | ------ | ------ |\r\n| all  | dongzuo | aiqing | xiju | kehuan | kongbu |\r\n\r\n| 战争      | 武侠  | 魔幻   | 剧情   | 动画    | 惊悚     |\r\n| --------- | ----- | ------ | ------ | ------- | -------- |\r\n| zhanzheng | wuxia | mohuan | juqing | donghua | jingsong |\r\n\r\n| 3D | 灾难   | 悬疑   | 警匪    | 文艺  | 青春     |\r\n| -- | ------ | ------ | ------- | ----- | -------- |\r\n| 3D | zainan | xuanyi | jingfei | wenyi | qingchun |\r\n\r\n| 冒险    | 犯罪   | 纪录 | 古装     | 奇幻   | 国语  |\r\n| ------- | ------ | ---- | -------- | ------ | ----- |\r\n| maoxian | fanzui | jilu | guzhuang | qihuan | guoyu |\r\n\r\n| 综艺   | 历史  | 运动    | 原创压制   |\r\n| ------ | ----- | ------- | ---------- |\r\n| zongyi | lishi | yundong | yuanchuang |\r\n\r\n| 美剧  | 韩剧  | 国产电视剧 | 日剧 | 英剧   | 德剧 |\r\n| ----- | ----- | ---------- | ---- | ------ | ---- |\r\n| meiju | hanju | guoju      | riju | yingju | deju |\r\n\r\n| 俄剧 | 巴剧 | 加剧  | 西剧    | 意大利剧 | 泰剧  |\r\n| ---- | ---- | ----- | ------- | -------- | ----- |\r\n| eju  | baju | jiaju | spanish | yidaliju | taiju |\r\n\r\n| 港台剧    | 法剧 | 澳剧 |\r\n| --------- | ---- | ---- |\r\n| gangtaiju | faju | aoju |\r\n\r\n#### 制片地区\r\n\r\n| 大陆 | 中国香港 | 中国台湾 |\r\n| ---- | -------- | -------- |\r\n\r\n| 美国 | 英国 | 日本 | 韩国 | 法国 |\r\n| ---- | ---- | ---- | ---- | ---- |\r\n\r\n| 印度 | 德国 | 西班牙 | 意大利 | 澳大利亚 |\r\n| ---- | ---- | ------ | ------ | -------- |\r\n\r\n| 比利时 | 瑞典 | 荷兰 | 丹麦 | 加拿大 | 俄罗斯 |\r\n| ------ | ---- | ---- | ---- | ------ | ------ |\r\n\r\n#### 影视排序\r\n\r\n| 更新时间 | 豆瓣评分 |\r\n| -------- | -------- |\r\n| 0        | 1        |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const caty = ctx.req.param('caty') || 'all';\r\n    const type = ctx.req.param('type') || 'all';\r\n    const area = ctx.req.param('area') || 'all';\r\n    const year = ctx.req.param('year') || 'all';\r\n    const order = ctx.req.param('order') || '0';\r\n\r\n    const site = ctx.req.query('domain') || 'bdys01.com';\r\n    if (!config.feature.allow_user_supply_unsafe_domain && !allowDomains.has(new URL(`https://${site}`).hostname)) {\r\n        throw new ConfigNotFoundError(`This RSS is disabled unless 'ALLOW_USER_SUPPLY_UNSAFE_DOMAIN' is set to 'true'.`);\r\n    }\r\n\r\n    const rootUrl = `https://www.${site}`;\r\n    const currentUrl = `${rootUrl}/s/${caty}?${type === 'all' ? '' : '&type=' + type}${area === 'all' ? '' : '&area=' + area}${year === 'all' ? '' : '&year=' + year}&order=${order}`;\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    let jsessionid = '';\r\n\r\n    const list = $('.card-body .card a')\r\n        .slice(0, 15)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const link = item.attr('href').split(';jsessionid=');\r\n            jsessionid = link[1];\r\n            const next = item.next();\r\n            return {\r\n                title: next.find('h3').text(),\r\n                link: `${rootUrl}${link[0]}`,\r\n                pubDate: parseDate(next.find('.text-muted').text()),\r\n            };\r\n        });\r\n\r\n    const headers = {\r\n        cookie: `JSESSIONID=${jsessionid}`,\r\n    };\r\n\r\n    const items = await pMap(\r\n        list,\r\n        (item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                    headers,\r\n                });\r\n                const downloadResponse = await got({\r\n                    method: 'get',\r\n                    url: `${rootUrl}/downloadInfo/list?mid=${item.link.split('/')[4].split('.')[0]}`,\r\n                    headers,\r\n                });\r\n                const content = load(detailResponse.data);\r\n\r\n                content('svg').remove();\r\n                const torrents = content('.download-list .list-group');\r\n\r\n                item.description = art(path.join(__dirname, 'templates/desc.art'), {\r\n                    info: content('.row.mt-3').html(),\r\n                    synopsis: content('#synopsis').html(),\r\n                    links: downloadResponse.data,\r\n                    torrents: torrents.html(),\r\n                });\r\n\r\n                item.pubDate = timezone(parseDate(content('.bg-purple-lt').text().replace('更新时间：', '')), +8);\r\n                item.guid = `${item.link}#${content('.card h1').text()}`;\r\n\r\n                item.enclosure_url = torrents.html() ? `${rootUrl}${torrents.find('a').first().attr('href')}` : downloadResponse.data.pop().url;\r\n                item.enclosure_type = 'application/x-bittorrent';\r\n\r\n                return item;\r\n            }),\r\n        { concurrency: 1 }\r\n    );\r\n\r\n    return {\r\n        title: '哔嘀影视',\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"0nBAcA,MAAM,EAAe,IAAI,IAAI,CAAC,aAAc,WAAY,eAE3C,EAAe,CACxB,KAAM,uCACN,WAAY,CAAC,cACb,QAAS,QACT,WAAY,CACR,KAAM,yBACN,KAAM,yBACN,KAAM,yBACN,KAAM,mCACN,MAAO,oBAEX,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BA6DjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,MAChC,EAAO,EAAI,IAAI,MAAM,SAAW,MAChC,EAAO,EAAI,IAAI,MAAM,SAAW,MAChC,EAAO,EAAI,IAAI,MAAM,SAAW,MAChC,EAAQ,EAAI,IAAI,MAAM,UAAY,IAElC,EAAO,EAAI,IAAI,MAAM,WAAa,aACxC,GAAI,CAAC,EAAO,QAAQ,iCAAmC,CAAC,EAAa,IAAI,IAAI,IAAI,WAAW,KAAQ,UAChG,MAAM,IAAI,EAAoB,mFAGlC,IAAM,EAAU,eAAe,IACzB,EAAa,GAAG,EAAQ,KAAK,EAAK,GAAG,IAAS,MAAQ,GAAK,SAAW,IAAO,IAAS,MAAQ,GAAK,SAAW,IAAO,IAAS,MAAQ,GAAK,SAAW,EAAK,SAAS,IACpK,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAI,EAAK,EAAS,MAEpB,EAAa,GAEX,EAAO,EAAE,sBACV,MAAM,EAAG,IACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAO,EAAK,KAAK,QAAQ,MAAM,gBACrC,EAAa,EAAK,GAClB,IAAM,EAAO,EAAK,OAClB,MAAO,CACH,MAAO,EAAK,KAAK,MAAM,OACvB,KAAM,GAAG,IAAU,EAAK,KACxB,QAAS,EAAU,EAAK,KAAK,eAAe,WAIlD,EAAU,CACZ,OAAQ,cAAc,KAGpB,EAAQ,MAAM,EAChB,EACC,GACG,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAM,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,KACV,YAEE,EAAmB,MAAM,EAAI,CAC/B,OAAQ,MACR,IAAK,GAAG,EAAQ,yBAAyB,EAAK,KAAK,MAAM,KAAK,GAAG,MAAM,KAAK,KAC5E,YAEE,EAAU,EAAK,EAAe,MAEpC,EAAQ,OAAO,SACf,IAAM,EAAW,EAAQ,8BAezB,MAbA,GAAK,YAAc,EAAI,EAAA,KAAA,EAAA,+BAA4C,CAC/D,KAAM,EAAQ,aAAa,OAC3B,SAAU,EAAQ,aAAa,OAC/B,MAAO,EAAiB,KACxB,SAAU,EAAS,SAGvB,EAAK,QAAU,EAAS,EAAU,EAAQ,iBAAiB,OAAO,QAAQ,QAAS,KAAM,GACzF,EAAK,KAAO,GAAG,EAAK,KAAK,GAAG,EAAQ,YAAY,SAEhD,EAAK,cAAgB,EAAS,OAAS,GAAG,IAAU,EAAS,KAAK,KAAK,QAAQ,KAAK,UAAY,EAAiB,KAAK,MAAM,IAC5H,EAAK,eAAiB,2BAEf,IAEf,CAAE,YAAa,IAGnB,MAAO,CACH,MAAO,OACP,KAAM,EACN,KAAM"}