import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{ofetch_default as n}from"./ofetch-Bzt0BXUH.js";import{invalid_parameter_default as r}from"./invalid-parameter-CUJdROXf.js";import{load as i}from"cheerio";import{NarouNovelFetch as a,NovelType as o,SearchBuilder as s,SearchBuilderR18 as c}from"narou";async function l(e){let t=new a,[n,i]=await Promise.all([new s({gzip:5,of:`t-s-k-ga-nt-nu`},t).ncode(e).execute(),new c({gzip:5,of:`t-s-k-ga-nt-nu`},t).ncode(e).execute()]),o=n.allcount!==0,l=o?n:i,u=o?`https://ncode.syosetu.com`:`https://novel18.syosetu.com`;if(l.allcount===0)throw new r(`Novel not found in both APIs`);return{baseUrl:u,novel:l.values[0]}}async function u(r,a){return await t.tryGet(r,async()=>{let t=await n(r,{headers:{Cookie:`over18=yes`,"User-Agent":e.ua}}),o=i(t),s=`${a?`#${a} `:``}${o(`.p-novel__title`).html()||``}`,c=o(`.p-novel__body`).html()||``,l=o(`meta[name=WWWC]`).attr(`content`);return{title:s,description:c,link:r,pubDate:l,language:`ja`}})}const d={path:`/:ncode`,categories:[`reading`],example:`/syosetu/n9292ii`,parameters:{ncode:`Novel code, can be found in URL`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Novel Updates`,maintainers:[`eternasuno`,`SnowAgar25`],handler:f,radar:[{title:`Novel Updates`,source:[`ncode.syosetu.com/:ncode`,`ncode.syosetu.com/:ncode/:chapter`],target:`/:ncode`},{title:`Novel Updates`,source:[`novel18.syosetu.com/:ncode`,`novel18.syosetu.com/:ncode/:chapter`],target:`/:ncode`}]};async function f(e){let{ncode:t}=e.req.param(),n=Math.min(Number(e.req.query(`limit`)??5),20),{baseUrl:r,novel:i}=await l(t);if(i.story=i.story.replaceAll(`
`,`<br>`)||``,i.noveltype===o.Tanpen){let e=`${r}/${t}`,n=await u(e);return n.pubDate=i.novelupdated_at,{title:i.title,description:i.story,link:e,item:[n],language:`ja`}}let a=i.general_all_no??1,s=Math.max(a-n+1,1),c=await Promise.all(Array.from({length:Math.min(n,a)},async(e,n)=>{let i=s+n,a=`${r}/${t}/${i}`,o=await u(a,i);return o}).toReversed());return{title:i.title,description:i.story,link:`${r}/${t}`,item:c,language:`ja`}}export{d as route};
//# sourceMappingURL=syosetu-Dnk6_IO0.js.map