{"version":3,"file":"notice-CpVUUSSN.js","names":["got","cache","$","route: Route","parseList"],"sources":["../../lib/routes/hfut/hf/utils.ts","../../lib/routes/hfut/hf/notice.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst typeMap = {\r\n    tzgg: { name: 'tzgg', url: 'https://news.hfut.edu.cn/tzgg2.htm', root: 'https://news.hfut.edu.cn', title: '合肥工业大学 - 通知公告' },\r\n    jxky: { name: 'jxky', url: 'https://news.hfut.edu.cn/tzgg2.htm', root: 'https://news.hfut.edu.cn', title: '合肥工业大学 - 通知公告 - 教学科研' },\r\n    qttz: { name: 'qttz', url: 'https://news.hfut.edu.cn/tzgg2.htm', root: 'https://news.hfut.edu.cn', title: '合肥工业大学 - 通知公告 - 其它通知' },\r\n};\r\n\r\nconst commLink = 'https://news.hfut.edu.cn/';\r\n\r\nconst parseList = async (ctx, type) => {\r\n    const link = typeMap[type].url;\r\n    const title = typeMap[type].title;\r\n\r\n    const response = await got(link);\r\n    const $ = load(response.data);\r\n\r\n    const resultList = await parseArticle(typeMap[type].name, $);\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        resultList,\r\n    };\r\n};\r\n\r\nasync function parseArticle(type, $) {\r\n    let data = $('#tzz').find('li').toArray();\r\n\r\n    if (type === 'jxky') {\r\n        data = $('#c01').find('li').toArray();\r\n    } else if (type === 'qttz') {\r\n        data = $('#c02').find('li').toArray();\r\n    }\r\n\r\n    const items = data.map((item) => {\r\n        item = $(item);\r\n        const oriLink = item.find('a').attr('href');\r\n        let linkRes = oriLink;\r\n        if (!oriLink.startsWith('http')) {\r\n            linkRes = commLink + item.find('a').attr('href');\r\n        }\r\n        const pubDate = parseDate(item.find('i').text(), 'YYYY-MM-DD');\r\n\r\n        return {\r\n            title: item.find('p').text(),\r\n            pubDate,\r\n            link: linkRes,\r\n        };\r\n    });\r\n\r\n    const resultItems = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                let description;\r\n                try {\r\n                    const response = await got(item.link);\r\n                    const $ = load(response.data);\r\n                    description = $('.wp_articlecontent').html() ?? $('.v_news_content').html() ?? item.link;\r\n                } catch {\r\n                    description = item.link;\r\n                }\r\n\r\n                return {\r\n                    title: item.title,\r\n                    link: item.link,\r\n                    description,\r\n                    pubDate: item.pubDate,\r\n                };\r\n            })\r\n        )\r\n    );\r\n\r\n    return resultItems;\r\n}\r\n\r\nexport default parseList;\r\n","import { Route } from '@/types';\r\nimport parseList from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/hf/notice/:type?',\r\n    categories: ['university'],\r\n    example: '/hfut/hf/notice/tzgg',\r\n    parameters: { type: '分类，见下表（默认为 `tzgg`)' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportRadar: true,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['news.hfut.edu.cn'],\r\n        },\r\n    ],\r\n    name: '合肥校区通知',\r\n    maintainers: ['batemax'],\r\n    handler,\r\n    description: `| 通知公告(https://news.hfut.edu.cn/tzgg2.htm) | 教学科研(https://news.hfut.edu.cn/tzgg2/jxky.htm) | 其他通知(https://news.hfut.edu.cn/tzgg2/qttz.htm) |\r\n| ------------ | -------------- | ------------------ |\r\n| tzgg         | jxky            | qttz              |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    // set default router type\r\n    const type = ctx.req.param('type') ?? 'tzgg';\r\n\r\n    const { link, title, resultList } = await parseList(ctx, type);\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        description: '合肥工业大学 - 通知公告',\r\n        item: resultList,\r\n    };\r\n}\r\n"],"mappings":"wWAKA,MAAM,EAAU,CACZ,KAAM,CAAE,KAAM,OAAQ,IAAK,qCAAsC,KAAM,2BAA4B,MAAO,iBAC1G,KAAM,CAAE,KAAM,OAAQ,IAAK,qCAAsC,KAAM,2BAA4B,MAAO,wBAC1G,KAAM,CAAE,KAAM,OAAQ,IAAK,qCAAsC,KAAM,2BAA4B,MAAO,yBAKxG,EAAY,MAAO,EAAK,IAAS,CACnC,IAAM,EAAO,EAAQ,GAAM,IACrB,EAAQ,EAAQ,GAAM,MAEtB,EAAW,MAAMA,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAa,MAAM,EAAa,EAAQ,GAAM,KAAM,GAE1D,MAAO,CACH,QACA,OACA,eAIR,eAAe,EAAa,EAAM,EAAG,CACjC,IAAI,EAAO,EAAE,QAAQ,KAAK,MAAM,UAE5B,IAAS,OACT,EAAO,EAAE,QAAQ,KAAK,MAAM,UACrB,IAAS,SAChB,EAAO,EAAE,QAAQ,KAAK,MAAM,WAGhC,IAAM,EAAQ,EAAK,IAAK,GAAS,CAC7B,EAAO,EAAE,GACT,IAAM,EAAU,EAAK,KAAK,KAAK,KAAK,QAChC,EAAU,EACT,EAAQ,WAAW,UACpB,EAAU,4BAAW,EAAK,KAAK,KAAK,KAAK,SAE7C,IAAM,EAAU,EAAU,EAAK,KAAK,KAAK,OAAQ,cAEjD,MAAO,CACH,MAAO,EAAK,KAAK,KAAK,OACtB,UACA,KAAM,KAIR,EAAc,MAAM,QAAQ,IAC9B,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAI,EACJ,GAAI,CACA,IAAM,EAAW,MAAMD,EAAI,EAAK,MAC1BE,EAAI,EAAK,EAAS,MACxB,EAAcA,EAAE,sBAAsB,QAAUA,EAAE,mBAAmB,QAAU,EAAK,UAChF,CACJ,EAAc,EAAK,KAGvB,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EAAK,KACX,cACA,QAAS,EAAK,aAM9B,OAAO,EAGX,IAAA,EAAe,EC5Ef,MAAaC,EAAe,CACxB,KAAM,oBACN,WAAY,CAAC,cACb,QAAS,uBACT,WAAY,CAAE,KAAM,sBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,aAAc,GACd,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,sBAGjB,KAAM,SACN,YAAa,CAAC,WACd,UACA,YAAa;;yDAKjB,eAAe,EAAQ,EAAK,CAExB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,OAEhC,CAAE,OAAM,QAAO,cAAe,MAAMC,EAAU,EAAK,GAEzD,MAAO,CACH,QACA,OACA,YAAa,gBACb,KAAM"}