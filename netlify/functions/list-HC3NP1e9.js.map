{"version":3,"file":"list-HC3NP1e9.js","names":["got","categories: Record<Category, string>","route: Route","got","cache"],"sources":["../../lib/routes/tgbus/utils.ts","../../lib/routes/tgbus/list.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\nconst parseArticle = (item, tryGet) =>\r\n    tryGet(item.link, async () => {\r\n        const { data: response } = await got(item.link);\r\n        const $ = load(response as unknown as string);\r\n\r\n        const infoBox = $('div.info-box');\r\n        item.author = infoBox.find('b:nth-child(4)').text().trim();\r\n        item.pubDate = timezone(parseDate(infoBox.find('i:last-child').text()), 8);\r\n        item.description = $('.article-main-contentraw').html();\r\n\r\n        return item;\r\n    });\r\n\r\nexport { parseArticle };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseArticle } from './utils';\r\n\r\ntype Category = 'news' | 'review' | 'video' | 'special' | 'hardware';\r\n\r\nconst categories: Record<Category, string> = {\r\n    news: '最新资讯',\r\n    review: '游戏评测',\r\n    video: '游戏视频',\r\n    special: '巴士首页特稿',\r\n    hardware: '硬件资讯',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/list/:category',\r\n    parameters: {\r\n        category: '列表分类，见下表',\r\n    },\r\n    categories: ['game'],\r\n    example: '/tgbus/list/news',\r\n    radar: [\r\n        {\r\n            source: ['www.tgbus.com/list/:category/'],\r\n            target: '/list/:category',\r\n        },\r\n    ],\r\n    name: '文章列表',\r\n    maintainers: ['Xzonn'],\r\n    handler,\r\n    description: `| 最新资讯 | 游戏评测 | 游戏视频 | 巴士首页特稿 | 硬件资讯 |\r\n| -------- | -------- | -------- | ------------ | -------- |\r\n| news     | review   | video    | special      | hardware |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') as Category;\r\n    const listUrl = `https://www.tgbus.com/list/${category}/`;\r\n\r\n    const res = await got(listUrl);\r\n    const $ = load(res.data as unknown as string);\r\n    const list = $('div.special-infocard')\r\n        .toArray()\r\n        .map((item) => {\r\n            const element = $(item);\r\n            const a = element.find('a');\r\n            return {\r\n                title: element.find('div.title').text(),\r\n                link: `https://www.tgbus.com${a.attr('href')}`,\r\n                description: element.find('div.content').text(),\r\n                pubDate: timezone(parseDate(element.find('div.info span:nth-child(3)').text().trim()), 8),\r\n            };\r\n        });\r\n\r\n    const out = await Promise.all(list.map((item) => parseArticle(item, cache.tryGet)));\r\n\r\n    return {\r\n        title: `${categories[category]} - 电玩巴士`,\r\n        description: $('meta[name=\"description\"]').attr('content'),\r\n        link: listUrl,\r\n        item: out,\r\n    };\r\n}\r\n"],"mappings":"0ZAKA,MAAM,GAAgB,EAAM,IACxB,EAAO,EAAK,KAAM,SAAY,CAC1B,GAAM,CAAE,KAAM,GAAa,MAAMG,EAAI,EAAK,MACpC,EAAI,EAAK,GAET,EAAU,EAAE,gBAKlB,MAJA,GAAK,OAAS,EAAQ,KAAK,kBAAkB,OAAO,OACpD,EAAK,QAAU,EAAS,EAAU,EAAQ,KAAK,gBAAgB,QAAS,GACxE,EAAK,YAAc,EAAE,4BAA4B,OAE1C,ICLTF,EAAuC,CACzC,KAAM,OACN,OAAQ,OACR,MAAO,OACP,QAAS,SACT,SAAU,QAGDC,EAAe,CACxB,KAAM,kBACN,WAAY,CACR,SAAU,YAEd,WAAY,CAAC,QACb,QAAS,mBACT,MAAO,CACH,CACI,OAAQ,CAAC,iCACT,OAAQ,oBAGhB,KAAM,OACN,YAAa,CAAC,SACd,UACA,YAAa;;+DAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,YACzB,EAAU,8BAA8B,EAAS,GAEjD,EAAM,MAAMC,EAAI,GAChB,EAAI,EAAK,EAAI,MACb,EAAO,EAAE,wBACV,UACA,IAAK,GAAS,CACX,IAAM,EAAU,EAAE,GACZ,EAAI,EAAQ,KAAK,KACvB,MAAO,CACH,MAAO,EAAQ,KAAK,aAAa,OACjC,KAAM,wBAAwB,EAAE,KAAK,UACrC,YAAa,EAAQ,KAAK,eAAe,OACzC,QAAS,EAAS,EAAU,EAAQ,KAAK,8BAA8B,OAAO,QAAS,MAI7F,EAAM,MAAM,QAAQ,IAAI,EAAK,IAAK,GAAS,EAAa,EAAMC,EAAM,UAE1E,MAAO,CACH,MAAO,GAAG,EAAW,GAAU,SAC/B,YAAa,EAAE,4BAA4B,KAAK,WAChD,KAAM,EACN,KAAM"}