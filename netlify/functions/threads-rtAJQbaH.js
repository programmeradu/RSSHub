import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{ofetch_default as n}from"./ofetch-Bzt0BXUH.js";import{not_found_default as r}from"./not-found-CRS5K6wf.js";import{ViewType as i}from"./types-A5bA50Mg.js";import a from"dayjs";import{load as o}from"cheerio";import{JSDOM as s}from"jsdom";import{JSONPath as c}from"jsonpath-plus";const l=e=>`https://www.threads.com/@${e}`,u=e=>`https://www.threads.com/t/${e}`,d=`Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1`,f=async e=>{let t=await n(l(e),{headers:{"User-Agent":d,Accept:`text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7`,"Accept-Encoding":`gzip, br`,"Accept-Language":`zh-CN,zh;q=0.9`,"Cache-Control":`no-cache`,Pragma:`no-cache`,"Sec-Fetch-Dest":`document`,"Sec-Fetch-Mode":`navigate`,"Sec-Fetch-Site":`none`,"Sec-Fetch-User":`?1`,"Upgrade-Insecure-Requests":`1`}}),i=o(t),a=i(`script:contains("LSD"):first`).text(),s=a.match(/"LSD",\[],{"token":"([\w@-]+)"},/)?.[1];if(!s)throw new r(`LSD token not found`);return{lsd:s}},p=t=>e.tryGet(`threads:userId:${t}`,async()=>{let e=await n(l(t),{headers:{"User-Agent":d,Accept:`text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7`,"Accept-Encoding":`gzip, br`,"Accept-Language":`zh-CN,zh;q=0.9`,"Cache-Control":`no-cache`,Pragma:`no-cache`,"Sec-Fetch-Dest":`document`,"Sec-Fetch-Mode":`navigate`,"Sec-Fetch-Site":`none`,"Sec-Fetch-User":`?1`,"Upgrade-Insecure-Requests":`1`}}),i=new s(e);for(let e of i.window.document.querySelectorAll(`script[data-sjs]`))try{let t=c({path:`$..user_id`,json:JSON.parse(e.textContent||``)});if(t?.[0])return t[0]}catch{}throw new r(`User ID not found`)}).then(e=>{if(!e||typeof e!=`string`)throw TypeError(`Invalid user ID type`);return e}),m=e=>e.image_versions2||e.carousel_media||e.video_versions,h=e=>{let t=``;if(e.carousel_media)for(let n of e.carousel_media){let e=n.image_versions2?.candidates[0],r=n.video_versions?.[0];t+=r?`<video controls autoplay loop poster="${e.url}"><source src="${r.url}"/></video>`:`<img src="${e.url}"/>`}else{let n=e.image_versions2?.candidates?.[0],r=e.video_versions?.[0];n&&(t+=r?`<video controls autoplay loop poster="${n.url}"><source src="${r.url}"/></video>`:`<img src="${n.url}"/>`)}return t},g=(e,t)=>{let n=``,r=``,i=e.post.text_post_app_info?.share_info?.quoted_post,o=e.post.text_post_app_info?.share_info?.reposted_post,s=e.post.text_post_app_info?.reply_to_author,c=i??o;return t.showAuthorInTitle&&(n+=`@${e.post.user?.username}: `),t.showAuthorInDesc&&(r+=`<p>`,t.showAuthorAvatarInDesc&&(r+=`<img src="${e.post.user?.profile_pic_url}" width="48px" height="48px"> `),r+=`<strong>@${e.post.user?.username}</strong>`,c?r+=t.showEmojiForQuotesAndReply?` üîÅ`:` quoted`:s&&(r+=t.showEmojiForQuotesAndReply?` ‚Ü©Ô∏è`:` replied`),r+=`:</p>`),e.post.caption?.text&&(n+=e.post.caption?.text,r+=`<p>${e.post.caption?.text}</p>`),m(e.post)&&(r+=`<p>${h(e.post)}</p>`),c&&(t.showQuotedInTitle&&(n+=t.showEmojiForQuotesAndReply?` üîÅ `:` QT: `,n+=`@${c.user?.username}: `,n+=`"${c.caption?.text}"`),r+=`<blockquote>`,r+=`<p>${c.caption?.text}</p>`,m(c)&&(r+=`<p>${h(c)}</p>`),r+=`‚Äî `,t.showQuotedAuthorAvatarInDesc&&(r+=`<img src="${c.user?.profile_pic_url}" width="24px" height="24px"> `),r+=`@${c.user?.username} ‚Äî `,r+=`<a href="${u(c.code)}">${a(c.taken_at,`X`).toString()}</a>`,r+=`</blockquote>`),{title:n,description:r}},_={path:`/:user/:routeParams?`,categories:[`social-media`],view:i.SocialMedia,example:`/threads/zuck`,parameters:{user:`Username`,routeParams:{description:'Extra parameters, see the table below\nSpecify options (in the format of query string) in parameter `routeParams` to control some extra features for threads\n\n| Key                            | Description                                                                                                                  | Accepts                | Defaults to |\n| ------------------------------ | ---------------------------------------------------------------------------------------------------------------------------- | ---------------------- | ----------- |\n| `showAuthorInTitle`            | Show author name in title                                                                                                    | `0`/`1`/`true`/`false` | `true`      |\n| `showAuthorInDesc`             | Show author name in description (RSS body)                                                                                   | `0`/`1`/`true`/`false` | `true`      |\n| `showQuotedAuthorAvatarInDesc` | Show avatar of quoted author in description (RSS body) (Not recommended if your RSS reader extracts images from description) | `0`/`1`/`true`/`false` | `false`     |\n| `showAuthorAvatarInDesc`       | Show avatar of author in description (RSS body) (Not recommended if your RSS reader extracts images from description)        | `0`/`1`/`true`/`false` | `falseP`    |\n| `showEmojiForQuotesAndReply`   | Use "üîÅ" instead of "QT", "‚Ü©Ô∏è" instead of "Re"                                                                               | `0`/`1`/`true`/`false` | `true`      |\n| `showQuotedInTitle`            | Show quoted tweet in title                                                                                                   | `0`/`1`/`true`/`false` | `true`      |\n| `replies`                      | Show replies                                                                                                                 | `0`/`1`/`true`/`false` | `true`      |'}},name:`User timeline`,maintainers:[`ninboy`,`pseudoyu`],handler:v};async function v(e){let{user:r,routeParams:i}=e.req.param(),{lsd:a}=await f(r),o=await p(r),d=new URLSearchParams(i),m={params:i,lsd:a},h={showAuthorInTitle:d.get(`showAuthorInTitle`)??!0,showAuthorInDesc:d.get(`showAuthorInDesc`)??!0,showAuthorAvatarInDesc:d.get(`showAuthorAvatarInDesc`)??!1,showQuotedInTitle:d.get(`showQuotedInTitle`)??!0,showQuotedAuthorAvatarInDesc:d.get(`showQuotedAuthorAvatarInDesc`)??!1,showEmojiForQuotesAndReply:d.get(`showEmojiForQuotesAndReply`)??!0,replies:d.get(`replies`)??!1},_=await n(l(r),{headers:{"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1`,Accept:`text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7`,"Accept-Encoding":`gzip, br`,"Accept-Language":`zh-CN,zh;q=0.9`,"Cache-Control":`no-cache`,Pragma:`no-cache`,"Sec-Fetch-Dest":`document`,"Sec-Fetch-Mode":`navigate`,"Sec-Fetch-Site":`none`,"Sec-Fetch-User":`?1`,"Upgrade-Insecure-Requests":`1`}}),v=new s(_),y=null;for(let e of v.window.document.querySelectorAll(`script[data-sjs]`))try{let t=c({path:`$..thread_items[0]`,json:JSON.parse(e.textContent||``)});if(t?.length>0){y=t;break}}catch{}if(!y)throw Error(`Failed to fetch thread data`);m.profileId=o,m.response={response:y};let b=y[0]?.post?.user||{username:r,profile_pic_url:``},x=y.filter(e=>r===e.post.user?.username).map(e=>({author:r,title:g(e,h).title,description:g(e,h).description,pubDate:t(e.post.taken_at,`X`),link:u(e.post.code)}));return m.items=x,e.set(`json`,m),{title:`${r} (@${r}) on Threads`,link:l(r),image:b?.profile_pic_url,item:x}}export{_ as route};
//# sourceMappingURL=threads-rtAJQbaH.js.map