{"version":3,"file":"update-w2uO17RH.js","names":[],"sources":["../../lib/routes/winstall/update.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { config } from '@/config';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/:appId',\r\n    categories: ['program-update'],\r\n    example: '/winstall/Mozilla.Firefox',\r\n    parameters: { appId: 'Application ID' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['winstall.app/apps/:appId'],\r\n        },\r\n    ],\r\n    name: 'Apps Update',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const baseUrl = 'https://winstall.app';\r\n    const appId = ctx.req.param('appId');\r\n\r\n    const buildId = await cache.tryGet(\r\n        'winget:buildId',\r\n        async () => {\r\n            const { data } = await got(baseUrl);\r\n            const $ = load(data);\r\n\r\n            return JSON.parse($('#__NEXT_DATA__').text()).buildId;\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    );\r\n\r\n    const { data: response } = await got(`${baseUrl}/_next/data/${buildId}/apps/${appId}.json`);\r\n    const { app } = response.pageProps;\r\n    const items = app.versions.map((item) => ({\r\n        title: `${app.name} ${item.version}`,\r\n        description: art(path.join(__dirname, 'templates/desc.art'), {\r\n            installers: item.installers,\r\n        }),\r\n        author: app.publisher,\r\n        category: app.tags,\r\n        guid: `winstall:${appId}:${item.version}`,\r\n    }));\r\n\r\n    return {\r\n        title: `${app.name} - winstall`,\r\n        description: app.desc,\r\n        link: `${baseUrl}/apps/${appId}`,\r\n        image: `https://api.winstall.app/icons/next/${appId}.webp`,\r\n        language: 'en',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"obASA,MAAa,EAAe,CACxB,KAAM,UACN,WAAY,CAAC,kBACb,QAAS,4BACT,WAAY,CAAE,MAAO,kBACrB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,8BAGjB,KAAM,cACN,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAU,uBACV,EAAQ,EAAI,IAAI,MAAM,SAEtB,EAAU,MAAM,EAAM,OACxB,iBACA,SAAY,CACR,GAAM,CAAE,QAAS,MAAM,EAAI,GACrB,EAAI,EAAK,GAEf,OAAO,KAAK,MAAM,EAAE,kBAAkB,QAAQ,SAElD,EAAO,MAAM,YACb,IAGE,CAAE,KAAM,GAAa,MAAM,EAAI,GAAG,EAAQ,cAAc,EAAQ,QAAQ,EAAM,QAC9E,CAAE,OAAQ,EAAS,UACnB,EAAQ,EAAI,SAAS,IAAK,IAAU,CACtC,MAAO,GAAG,EAAI,KAAK,GAAG,EAAK,UAC3B,YAAa,EAAI,EAAA,KAAA,EAAA,+BAA4C,CACzD,WAAY,EAAK,aAErB,OAAQ,EAAI,UACZ,SAAU,EAAI,KACd,KAAM,YAAY,EAAM,GAAG,EAAK,aAGpC,MAAO,CACH,MAAO,GAAG,EAAI,KAAK,aACnB,YAAa,EAAI,KACjB,KAAM,GAAG,EAAQ,QAAQ,IACzB,MAAO,uCAAuC,EAAM,OACpD,SAAU,KACV,KAAM"}