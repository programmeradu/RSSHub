{"version":3,"file":"utils-Bt61_L-j.js","names":["ofetch","cache","response","$"],"sources":["../../lib/routes/njxzc/utils/index.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport ofetch from '@/utils/ofetch'; // 使用默认导出的方式导入ofetch\r\n\r\nasync function getNoticeList(ctx, url, host, titleSelector, dateSelector, contentSelector, listSelector) {\r\n    const response = await ofetch(url).catch(() => null);\r\n    if (!response) {\r\n        return [];\r\n    }\r\n    const $ = load(response);\r\n\r\n    const list = $(listSelector)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item.find(titleSelector).attr('title'),\r\n                link: host + item.find(titleSelector).attr('href'),\r\n                pubDate: timezone(parseDate(item.find(dateSelector).text(), 'YYYY-MM-DD'), +8),\r\n            };\r\n        });\r\n\r\n    const out = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await ofetch(item.link).catch(() => null);\r\n                if (!response || (response.status >= 300 && response.status < 400)) {\r\n                    return {\r\n                        ...item,\r\n                        description: '该通知无法直接预览，请点击原文链接↑查看',\r\n                    };\r\n                }\r\n                const $ = load(response);\r\n\r\n                if ($('.wp_error_msg').length > 0) {\r\n                    item.description = '您当前ip并非校内地址，该信息仅允许校内地址访问';\r\n                } else if ($('.wp_pdf_player').length > 0) {\r\n                    item.description = '该通知无法直接预览，请点击原文链接↑查看';\r\n                } else {\r\n                    const contentHtml = $(contentSelector.content).html();\r\n                    const $content = load(contentHtml);\r\n                    $content('a').each(function () {\r\n                        const a = $(this);\r\n                        const href = a.attr('href');\r\n                        if (href && !href.startsWith('http')) {\r\n                            a.attr('href', new URL(href, host).href);\r\n                        }\r\n                    });\r\n                    item.description = $content.html();\r\n                    item.title = $(contentSelector.title).text();\r\n                    const dateText = $(contentSelector.date).text().replace('编辑：', '').replace('发布日期：', '').replace('发布时间：', '');\r\n                    item.pubDate = timezone(parseDate(dateText, 'YYYY-MM-DD'), +8);\r\n                }\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return out;\r\n}\r\n\r\nexport { getNoticeList };\r\n"],"mappings":"gPAMA,eAAe,EAAc,EAAK,EAAK,EAAM,EAAe,EAAc,EAAiB,EAAc,CACrG,IAAM,EAAW,MAAMA,EAAO,GAAK,UAAY,MAC/C,GAAI,CAAC,EACD,MAAO,GAEX,IAAM,EAAI,EAAK,GAET,EAAO,EAAE,GACV,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,GAAe,KAAK,SACrC,KAAM,EAAO,EAAK,KAAK,GAAe,KAAK,QAC3C,QAAS,EAAS,EAAU,EAAK,KAAK,GAAc,OAAQ,cAAe,MAIjF,EAAM,MAAM,QAAQ,IACtB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAMC,EAAW,MAAMF,EAAO,EAAK,MAAM,UAAY,MACrD,GAAI,CAACE,GAAaA,EAAS,QAAU,KAAOA,EAAS,OAAS,IAC1D,MAAO,CACH,GAAG,EACH,YAAa,wBAGrB,IAAMC,EAAI,EAAKD,GAEf,GAAIC,EAAE,iBAAiB,OAAS,EAC5B,EAAK,YAAc,mCACZA,EAAE,kBAAkB,OAAS,EACpC,EAAK,YAAc,2BAChB,CACH,IAAM,EAAcA,EAAE,EAAgB,SAAS,OACzC,EAAW,EAAK,GACtB,EAAS,KAAK,KAAK,UAAY,CAC3B,IAAM,EAAIA,EAAE,MACN,EAAO,EAAE,KAAK,QAChB,GAAQ,CAAC,EAAK,WAAW,SACzB,EAAE,KAAK,OAAQ,IAAI,IAAI,EAAM,GAAM,QAG3C,EAAK,YAAc,EAAS,OAC5B,EAAK,MAAQA,EAAE,EAAgB,OAAO,OACtC,IAAM,EAAWA,EAAE,EAAgB,MAAM,OAAO,QAAQ,MAAO,IAAI,QAAQ,QAAS,IAAI,QAAQ,QAAS,IACzG,EAAK,QAAU,EAAS,EAAU,EAAU,cAAe,GAG/D,OAAO,MAKnB,OAAO"}