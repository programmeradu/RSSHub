import{config as e}from"./config-Dl8a1sIg.js";import{got_default as t}from"./got-CdvI2yKX.js";import{config_not_found_default as n}from"./config-not-found-BVqhRP9D.js";import{load as r}from"cheerio";const i=`pianyuan-security_session_verify`,a=`pianyuan-PHPSESSID`,o=`pianyuan-py_loginauth`,s=async(e,t)=>{let n=await Promise.all(e.map(async e=>{let n=new URL(e,`https://pianyuan.org`).href,i=await t.tryGet(n,async()=>{let e=await l(n,t),i=r(e.data),a=i(`.btn-primary`).attr(`href`),o=i(`body > div.jumbotron.masthead > div > div > div.col-sm-10.col-md-10.col-lg-10.text-left > h1`).text(),s=i(`body > div.jumbotron.masthead > div > div > div.col-sm-10.col-md-10.col-lg-10.text-left > h2 > a`).text(),c=i(`#main-container > div > div.col-sm-10.col-md-8.col-lg-8 > div > ul > li:nth-child(2)`).text(),u;return c.includes(`MB`)?u=c.replace(`MB`,``)*1024:c.includes(`GB`)&&(u=c.replace(`GB`,``)*1024*1024),{title:`${o} [${s}] [${c}]`,size:u,enclosure_url:a,enclosure_type:`application/x-bittorrent`,enclosure_length:u}});return i}));return n};async function c(t){let r=await t.get(i),s=await t.get(a),c=await t.get(o);if(!c){if(!e.pianyuan||!e.pianyuan.cookie)throw new n(`pianyuan is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);c=e.pianyuan.cookie}return`${c};${r};${s};`}async function l(e,r){let s=await c(r),l=await t({method:`get`,url:e,headers:{Cookie:s}}),u=l.headers[`set-cookie`];if(u)for(let e of u)e.includes(`security_session_verify`)?r.set(i,e.split(`;`)[0]):e.includes(`PHPSESSID`)?r.set(a,e.split(`;`)[0]):e.includes(`py_loginauth`)&&r.set(o,e.split(`;`)[0]);if(l.data.includes(`会员登录后才能访问`))throw new n(`pianyuan Cookie已失效`);return l}var u={ProcessFeed:s,request:l};export{u as utils_default};
//# sourceMappingURL=utils-BTJM9wSK.js.map