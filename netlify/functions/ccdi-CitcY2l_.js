import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{getSubPath as n}from"./common-utils-CvkwbCD5.js";import"./ofetch-Bzt0BXUH.js";import{got_default as r}from"./got-CdvI2yKX.js";import{timezone as i}from"./timezone-BrNu6iXe.js";import{load as a}from"cheerio";import{Cookie as o,CookieJar as s}from"tough-cookie";const c=new s,l=`中央纪委国家监委网站`,u=`https://www.ccdi.gov.cn`,d=/(?<key>[A-Z_]+)=(?<value>(?:.*?(?=; max-age)|[\dA-Fa-f]+))/gm,f=async e=>{let t,n=[];for(;(t=d.exec(e))!==null;){t.index===d.lastIndex&&d.lastIndex++;let{key:e,value:r}=t.groups;n.push(new o({key:e,value:r}))}await Promise.all(n.map(e=>c.setCookie(e,u)))},p=async(e,n,i)=>{let o=await r(e,{cookieJar:c}),s=o.data;await f(s);let u=a(s),d=u(n).slice(0,i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`)):20).toArray().map(n=>(n=u(n),{title:n.find(`a`).first().text().trim(),link:new URL(n.find(`a`).first().attr(`href`),e).href,pubDate:t(n.find(`.more`).text(),`YYYY-MM-DD`)})),p=u(`.other_Location`).text().replace(/(.+)首页/,l);return{list:d,title:p}},m=async()=>{let e=await c.getCookies(u),t=e.find(e=>e.key===`HOY_TR`);if(t){let e=t.value,n=e.split(`,`),r=n[0],i=[...n[1]],a=[...n[2]];a[0]=r.charAt(Number.parseInt(i[0],16));let s=new o({key:`HOY_TR`,value:r+`,`+i.join(``)+`,`+a.join(``)+`,0`});await c.setCookie(s,u)}},h=async n=>(await m(),e.tryGet(n.link,async()=>{let e=await r(n.link,{cookieJar:c}),o=e.data;await f(o);let s=a(o),u=s(`.daty, .source-box`).text().trim();return n.author=u.match(/来源：(.*)发布时间/s)?.[1].trim()??l,n.pubDate=i(t(u.match(/发布时间：(.*)分享/s)?.[1].trim()??n.pubDate),8),s(`.content, .bom-box`).find(`img`).each((e,t)=>{s(t).attr(`src`,new URL(s(t).attr(`src`),n.link).href),s(t).removeAttr(`oldsrc`).removeAttr(`alt`)}),n.description=s(`.content, .bom-box`).html(),n})),g={path:`/ccdi/*`,name:`Unknown`,maintainers:[],handler:_};async function _(e){let t=n(e).replaceAll(/(^\/ccdi|\/$)/g,``);t=t===``?`/yaowenn/`:t.endsWith(`/`)?t:t+`/`;let r=`${u}${t}`,{list:i,title:a}=await p(r,`.list_news_dl2 li`,e),o=await Promise.all(i.map(e=>h(e)));return{title:a,link:r,item:o}}export{g as route};
//# sourceMappingURL=ccdi-CitcY2l_.js.map