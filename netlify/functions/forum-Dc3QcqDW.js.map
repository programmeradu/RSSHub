{"version":3,"file":"forum-Dc3QcqDW.js","names":[],"sources":["../../lib/routes/baidu/tieba/forum.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: ['/tieba/forum/good/:kw/:cid?/:sortBy?', '/tieba/forum/:kw/:sortBy?'],\r\n    categories: ['bbs'],\r\n    example: '/baidu/tieba/forum/good/女图',\r\n    parameters: { kw: '吧名', cid: '精品分类，默认为 `0`（全部分类），如果不传 `cid` 则获取全部分类', sortBy: '排序方式：`created`, `replied`。默认为 `created`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '精品帖子',\r\n    maintainers: ['u3u'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    // sortBy: created, replied\r\n    const { kw, cid = '0', sortBy = 'created' } = ctx.req.param();\r\n\r\n    // PC端：https://tieba.baidu.com/f?kw=${encodeURIComponent(kw)}\r\n    // 移动端接口：https://tieba.baidu.com/mo/q/m?kw=${encodeURIComponent(kw)}&lp=5024&forum_recommend=1&lm=0&cid=0&has_url_param=1&pn=0&is_ajax=1\r\n    const params = { kw: encodeURIComponent(kw) };\r\n    ctx.req.path.includes('good') && (params.tab = 'good');\r\n    cid && (params.cid = cid);\r\n    const { data } = await got(`https://tieba.baidu.com/f`, {\r\n        headers: {\r\n            Referer: 'https://tieba.baidu.com/',\r\n        },\r\n        searchParams: params,\r\n    });\r\n\r\n    const threadListHTML = load(data)('code[id=\"pagelet_html_frs-list/pagelet/thread_list\"]')\r\n        .contents()\r\n        .filter((e) => e.nodeType === '8');\r\n\r\n    const $ = load(threadListHTML.prevObject[0].data);\r\n    const list = $('#thread_list > .j_thread_list[data-field]')\r\n        .toArray()\r\n        .map((element) => {\r\n            const item = $(element);\r\n            const { id, author_name } = item.data('field');\r\n            const time = sortBy === 'created' ? item.find('.is_show_create_time').text().trim() : item.find('.threadlist_reply_date').text().trim();\r\n            const title = item.find('a.j_th_tit').text().trim();\r\n            const details = item.find('.threadlist_abs').text().trim();\r\n            const medias = item\r\n                .find('.threadlist_media img')\r\n                .toArray()\r\n                .map((element) => {\r\n                    const item = $(element);\r\n                    return `<img src=\"${item.attr('bpic')}\">`;\r\n                })\r\n                .join('');\r\n\r\n            return {\r\n                title,\r\n                description: art(path.join(__dirname, '../templates/forum.art'), {\r\n                    details,\r\n                    medias,\r\n                    author_name,\r\n                }),\r\n                pubDate: timezone(parseDate(time, ['HH:mm', 'M-D', 'YYYY-MM'], true), +8),\r\n                link: `https://tieba.baidu.com/p/${id}`,\r\n            };\r\n        });\r\n\r\n    return {\r\n        title: `${kw}吧`,\r\n        description: load(data)('meta[name=\"description\"]').attr('content'),\r\n        link: `https://tieba.baidu.com/f?kw=${encodeURIComponent(kw)}`,\r\n        item: list,\r\n    };\r\n}\r\n"],"mappings":"sdASA,MAAa,EAAe,CACxB,KAAM,CAAC,uCAAwC,6BAC/C,WAAY,CAAC,OACb,QAAS,6BACT,WAAY,CAAE,GAAI,KAAM,IAAK,wCAAyC,OAAQ,2CAC9E,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,OACd,WAGJ,eAAe,EAAQ,EAAK,CAExB,GAAM,CAAE,KAAI,MAAM,IAAK,SAAS,WAAc,EAAI,IAAI,QAIhD,EAAS,CAAE,GAAI,mBAAmB,IACxC,EAAI,IAAI,KAAK,SAAS,UAAY,EAAO,IAAM,QAC/C,IAAQ,EAAO,IAAM,GACrB,GAAM,CAAE,QAAS,MAAM,EAAI,4BAA6B,CACpD,QAAS,CACL,QAAS,4BAEb,aAAc,IAGZ,EAAiB,EAAK,GAAM,wDAC7B,WACA,OAAQ,GAAM,EAAE,WAAa,KAE5B,EAAI,EAAK,EAAe,WAAW,GAAG,MACtC,EAAO,EAAE,6CACV,UACA,IAAK,GAAY,CACd,IAAM,EAAO,EAAE,GACT,CAAE,KAAI,eAAgB,EAAK,KAAK,SAChC,EAAO,IAAW,UAAY,EAAK,KAAK,wBAAwB,OAAO,OAAS,EAAK,KAAK,0BAA0B,OAAO,OAC3H,EAAQ,EAAK,KAAK,cAAc,OAAO,OACvC,EAAU,EAAK,KAAK,mBAAmB,OAAO,OAC9C,EAAS,EACV,KAAK,yBACL,UACA,IAAK,GAAY,CACd,IAAM,EAAO,EAAE,GACf,MAAO,aAAa,EAAK,KAAK,QAAQ,MAEzC,KAAK,IAEV,MAAO,CACH,QACA,YAAa,EAAI,EAAA,KAAA,EAAA,gCAAgD,CAC7D,UACA,SACA,gBAEJ,QAAS,EAAS,EAAU,EAAM,CAAC,QAAS,MAAO,WAAY,IAAO,GACtE,KAAM,6BAA6B,OAI/C,MAAO,CACH,MAAO,GAAG,EAAG,GACb,YAAa,EAAK,GAAM,4BAA4B,KAAK,WACzD,KAAM,gCAAgC,mBAAmB,KACzD,KAAM"}