{"version":3,"file":"bjsk-DwmJGA6A.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/bjsk/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst baseUrl = 'https://www.bjsk.org.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/:path?',\r\n    categories: ['government'],\r\n    example: '/bjsk/newslist-1394-1474-0',\r\n    parameters: { path: '路径，默认为 `newslist-1486-0-0`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '通用',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    description: `::: tip\r\n  路径处填写对应页面 URL 中 \\`https://www.bjsk.org.cn/\\` 和 \\`.html\\` 之间的字段。下面是一个例子。\r\n\r\n  若订阅 [社科资讯 > 社科要闻](https://www.bjsk.org.cn/newslist-1394-1474-0.html) 则将对应页面 URL \\`https://www.bjsk.org.cn/newslist-1394-1474-0.html\\` 中 \\`https://www.bjsk.org.cn/\\` 和 \\`.html\\` 之间的字段 \\`newslist-1394-1474-0\\` 作为路径填入。此时路由为 [\\`/bjsk/newslist-1394-1474-0\\`](https://rsshub.app/bjsk/newslist-1394-1474-0)\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { path = 'newslist-1486-0-0' } = ctx.req.param();\r\n    const link = `${baseUrl}/${path}.html`;\r\n    const { data: response } = await got(link, {\r\n        https: {\r\n            rejectUnauthorized: false,\r\n        },\r\n    });\r\n    const $ = load(response);\r\n\r\n    const list = $('.article-list a')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item.attr('title'),\r\n                link: `${baseUrl}${item.attr('href')}`,\r\n                pubDate: parseDate(item.find('.time').text(), 'YYYY.MM.DD'),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link, {\r\n                    https: {\r\n                        rejectUnauthorized: false,\r\n                    },\r\n                });\r\n                const $ = load(response);\r\n                item.description = $('.article-main').html();\r\n                item.author = $('.info')\r\n                    .text()\r\n                    .match(/作者：(.*)\\s+来源/)[1];\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: $('head title').text(),\r\n        link,\r\n        image: 'https://www.bjsk.org.cn/favicon.ico',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAMA,MAAM,EAAU,0BAEHA,EAAe,CACxB,KAAM,UACN,WAAY,CAAC,cACb,QAAS,6BACT,WAAY,CAAE,KAAM,8BACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,UACd,UACA,YAAa,8XAOjB,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAO,qBAAwB,EAAI,IAAI,QACzC,EAAO,GAAG,EAAQ,GAAG,EAAK,OAC1B,CAAE,KAAM,GAAa,MAAMC,EAAI,EAAM,CACvC,MAAO,CACH,mBAAoB,MAGtB,EAAI,EAAK,GAET,EAAO,EAAE,mBACV,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,SACjB,KAAM,GAAG,IAAU,EAAK,KAAK,UAC7B,QAAS,EAAU,EAAK,KAAK,SAAS,OAAQ,iBAIpD,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,KAAM,CAC5C,MAAO,CACH,mBAAoB,MAGtBG,EAAI,EAAKD,GAKf,MAJA,GAAK,YAAcC,EAAE,iBAAiB,OACtC,EAAK,OAASA,EAAE,SACX,OACA,MAAM,gBAAgB,GACpB,MAKnB,MAAO,CACH,MAAO,EAAE,cAAc,OACvB,OACA,MAAO,sCACP,KAAM"}