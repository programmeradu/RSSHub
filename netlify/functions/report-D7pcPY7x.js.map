{"version":3,"file":"report-D7pcPY7x.js","names":["route: Route","got","cache","description"],"sources":["../../lib/routes/tokeninsight/report.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nconst baseURL = 'https://www.tokeninsight.com/';\r\nconst title = 'TokenInsight';\r\nconst link = 'https://www.tokeninsight.com/';\r\n\r\nexport const route: Route = {\r\n    path: '/report/:lang?',\r\n    categories: ['finance'],\r\n    example: '/tokeninsight/report/en',\r\n    parameters: { lang: 'Language, see below, Chinese by default' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['tokeninsight.com/:lang/report'],\r\n            target: '/report/:lang',\r\n        },\r\n    ],\r\n    name: 'Research',\r\n    maintainers: [],\r\n    handler,\r\n    description: `Language:\r\n\r\n| Chinese | English |\r\n| ------- | ------- |\r\n| zh      | en      |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const lang = ctx.req.param('lang') ?? 'zh';\r\n\r\n    const getReports = async () => {\r\n        const url = `${baseURL}api/user/search/getAllList`;\r\n        const response = (\r\n            await got.post(url, {\r\n                form: {\r\n                    isRecommend: 2,\r\n                    language: lang === 'zh' ? 'cn' : lang,\r\n                },\r\n            })\r\n        ).data;\r\n        return response.data.reportList;\r\n    };\r\n\r\n    const getReportInfomation = async (report) => {\r\n        const { publishDate, title, id } = report;\r\n        const reportUrl = `${baseURL}${lang}/report/${id}`;\r\n        const description = await cache.tryGet(reportUrl, async () => {\r\n            const res = await got(reportUrl);\r\n            const $ = load(res.data);\r\n            const description = $('.detail_html_box').html();\r\n            return description;\r\n        });\r\n        return {\r\n            // 文章标题\r\n            title,\r\n            // 文章正文\r\n            description,\r\n            // 文章发布时间\r\n            pubDate: parseDate(publishDate),\r\n            // 文章链接\r\n            link: reportUrl,\r\n        };\r\n    };\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 30;\r\n    const reports = (await getReports()).slice(0, limit);\r\n    const list = await Promise.all(reports.map((element) => getReportInfomation(element)));\r\n    return {\r\n        title: `${lang === 'zh' ? '报告' : 'Research'} | ${title}`,\r\n        link: `${link}${lang}/report`,\r\n        item: list,\r\n    };\r\n}\r\n"],"mappings":"wWAKA,MAAM,EAAU,gCAIHA,EAAe,CACxB,KAAM,iBACN,WAAY,CAAC,WACb,QAAS,0BACT,WAAY,CAAE,KAAM,2CACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,iCACT,OAAQ,kBAGhB,KAAM,WACN,YAAa,GACb,UACA,YAAa;;;;wBAOjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,KAEhC,EAAa,SAAY,CAC3B,IAAM,EAAM,GAAG,EAAQ,4BACjB,GACF,MAAMC,EAAI,KAAK,EAAK,CAChB,KAAM,CACF,YAAa,EACb,SAAU,IAAS,KAAO,KAAO,MAG3C,KACF,OAAO,EAAS,KAAK,YAGnB,EAAsB,KAAO,IAAW,CAC1C,GAAM,CAAE,cAAa,MAAA,EAAO,MAAO,EAC7B,EAAY,GAAG,IAAU,EAAK,UAAU,IACxC,EAAc,MAAMC,EAAM,OAAO,EAAW,SAAY,CAC1D,IAAM,EAAM,MAAMD,EAAI,GAChB,EAAI,EAAK,EAAI,MACbE,EAAc,EAAE,oBAAoB,OAC1C,OAAOA,IAEX,MAAO,CAEH,MAAA,EAEA,cAEA,QAAS,EAAU,GAEnB,KAAM,IAGR,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GAC3E,GAAW,MAAM,KAAc,MAAM,EAAG,GACxC,EAAO,MAAM,QAAQ,IAAI,EAAQ,IAAK,GAAY,EAAoB,KAC5E,MAAO,CACH,MAAO,GAAG,IAAS,KAAO,KAAO,WAAW,iBAC5C,KAAM,gCAAU,EAAK,SACrB,KAAM"}