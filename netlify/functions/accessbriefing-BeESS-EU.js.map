{"version":3,"file":"accessbriefing-BeESS-EU.js","names":[],"sources":["../../lib/routes/accessbriefing/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { category = 'latest/news' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 30;\r\n\r\n    const rootUrl = 'https://www.accessbriefing.com';\r\n    const currentUrl = new URL(category, rootUrl).href;\r\n    const apiUrl = new URL('Ajax/GetPagedArticles', rootUrl).href;\r\n\r\n    const { data: currentResponse } = await got(currentUrl);\r\n\r\n    const brandId = currentResponse.match(/'BrandID':\\s(\\d+)/)?.[1] ?? '32';\r\n    const moreID = currentResponse.match(/'MoreID':\\s(\\d+)/)?.[1] ?? '9282';\r\n\r\n    const { data: response } = await got(apiUrl, {\r\n        searchParams: {\r\n            navcontentid: moreID,\r\n            brandid: brandId,\r\n            page: 0,\r\n            lastpage: 0,\r\n            pagesize: limit,\r\n        },\r\n    });\r\n\r\n    const $ = load(currentResponse);\r\n\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = response.slice(0, limit).map((item) => {\r\n        const title = item.Article_Headline;\r\n        const image = new URL(item.Image, rootUrl).href;\r\n        const description = art(path.join(__dirname, 'templates/description.art'), {\r\n            images: image\r\n                ? [\r\n                      {\r\n                          src: image,\r\n                          alt: title,\r\n                      },\r\n                  ]\r\n                : undefined,\r\n            intro: item.Article_Intro_Plaintext,\r\n        });\r\n        const guid = `accessbriefing-${item.Article_ID}`;\r\n\r\n        return {\r\n            title,\r\n            description,\r\n            pubDate: parseDate(item.Article_PublishedDate),\r\n            link: new URL(item.URL, rootUrl).href,\r\n            author: item.Authors.join('/'),\r\n            guid,\r\n            id: guid,\r\n            content: {\r\n                html: description,\r\n                text: item.Article_Intro_Plaintext,\r\n            },\r\n            image,\r\n            banner: image,\r\n            language,\r\n        };\r\n    });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const title = $$('h1.khl-article-page-title').text();\r\n                const description =\r\n                    item.description +\r\n                    art(path.join(__dirname, 'templates/description.art'), {\r\n                        description: $$('div.khl-article-page-storybody').html(),\r\n                    });\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.category = $$('a.badge[data-id]')\r\n                    .toArray()\r\n                    .map((c) => $$(c).text());\r\n                item.author = $$('div.authorDetails a span b').text();\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.khl-article-page-storybody').text(),\r\n                };\r\n                item.language = language;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('a.navbar-brand img').prop('src'), rootUrl).href;\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        description: $('meta[property=\"og:description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: $('meta[property=\"og:site_name\"]').prop('content'),\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:category{.+}?',\r\n    name: 'Articles',\r\n    url: 'accessbriefing.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/accessbriefing/latest/news',\r\n    parameters: { category: 'Category, Latest News by default' },\r\n    description: `::: tip\r\n  If you subscribe to [Latest News](https://www.accessbriefing.com/latest/news)ï¼Œwhere the URL is \\`https://www.accessbriefing.com/latest/news\\`, extract the part \\`https://www.accessbriefing.com/\\` to the end, and use it as the parameter to fill in. Therefore, the route will be [\\`/accessbriefing/latest/news\\`](https://rsshub.app/accessbriefing/latest/news).\r\n:::\r\n\r\n#### Latest\r\n\r\n| Category                                                                               | ID                                                                                              |\r\n| -------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |\r\n| [News](https://www.accessbriefing.com/latest/news)                                     | [latest/news](https://rsshub.app/target/site/latest/news)                                       |\r\n| [Products & Technology](https://www.accessbriefing.com/latest/products-and-technology) | [latest/products-and-technology](https://rsshub.app/target/site/latest/products-and-technology) |\r\n| [Rental News](https://www.accessbriefing.com/latest/rental-news)                       | [latest/rental-news](https://rsshub.app/target/site/latest/rental-news)                         |\r\n| [People](https://www.accessbriefing.com/latest/people)                                 | [latest/people](https://rsshub.app/target/site/latest/people)                                   |\r\n| [Regualtions & Safety](https://www.accessbriefing.com/latest/regualtions-safety)       | [latest/regualtions-safety](https://rsshub.app/target/site/latest/regualtions-safety)           |\r\n| [Finance](https://www.accessbriefing.com/latest/finance)                               | [latest/finance](https://rsshub.app/target/site/latest/finance)                                 |\r\n| [Sustainability](https://www.accessbriefing.com/latest/sustainability)                 | [latest/sustainability](https://rsshub.app/target/site/latest/sustainability)                   |\r\n\r\n#### Insight\r\n\r\n| Category                                                                          | ID                                                                                        |\r\n| --------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |\r\n| [Interviews](https://www.accessbriefing.com/insight/interviews)                   | [insight/interviews](https://rsshub.app/target/site/insight/interviews)                   |\r\n| [Longer reads](https://www.accessbriefing.com/insight/longer-reads)               | [insight/longer-reads](https://rsshub.app/target/site/insight/longer-reads)               |\r\n| [Videos and podcasts](https://www.accessbriefing.com/insight/videos-and-podcasts) | [insight/videos-and-podcasts](https://rsshub.app/target/site/insight/videos-and-podcasts) |\r\n  `,\r\n    categories: ['new-media'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['accessbriefing.com/:category*'],\r\n            target: '/:category',\r\n        },\r\n        {\r\n            title: 'Latest - News',\r\n            source: ['accessbriefing.com/latest/news'],\r\n            target: '/latest/news',\r\n        },\r\n        {\r\n            title: 'Latest - Products & Technology',\r\n            source: ['accessbriefing.com/latest/products-and-technology'],\r\n            target: '/latest/products-and-technology',\r\n        },\r\n        {\r\n            title: 'Latest - Rental News',\r\n            source: ['accessbriefing.com/latest/rental-news'],\r\n            target: '/latest/rental-news',\r\n        },\r\n        {\r\n            title: 'Latest - People',\r\n            source: ['accessbriefing.com/latest/people'],\r\n            target: '/latest/people',\r\n        },\r\n        {\r\n            title: 'Latest - Regualtions & Safety',\r\n            source: ['accessbriefing.com/latest/regualtions-safety'],\r\n            target: '/latest/regualtions-safety',\r\n        },\r\n        {\r\n            title: 'Latest - Finance',\r\n            source: ['accessbriefing.com/latest/finance'],\r\n            target: '/latest/finance',\r\n        },\r\n        {\r\n            title: 'Latest - Sustainability',\r\n            source: ['accessbriefing.com/latest/sustainability'],\r\n            target: '/latest/sustainability',\r\n        },\r\n        {\r\n            title: 'Insight - Interviews',\r\n            source: ['accessbriefing.com/insight/interviews'],\r\n            target: '/insight/interviews',\r\n        },\r\n        {\r\n            title: 'Insight - Longer reads',\r\n            source: ['accessbriefing.com/insight/longer-reads'],\r\n            target: '/insight/longer-reads',\r\n        },\r\n        {\r\n            title: 'Insight - Videos and podcasts',\r\n            source: ['accessbriefing.com/insight/videos-and-podcasts'],\r\n            target: '/insight/videos-and-podcasts',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}