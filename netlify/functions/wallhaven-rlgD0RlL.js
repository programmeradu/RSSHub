import"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import{got_default as n}from"./got-CdvI2yKX.js";import{load as r}from"cheerio";const i={path:[`/search/:filter?/:needDetails?`,`/:filter?/:needDetails?`],categories:[`picture`],example:`/wallhaven/search/categories=110&purity=110&sorting=date_added&order=desc`,parameters:{filter:`Filter, empty by default`,needDetails:"Need Details, `true`/`yes` as yes, no by default"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`wallhaven.cc/`]}],name:`Search`,maintainers:[`nczitzk`,`Fatpandac`],handler:a,url:`wallhaven.cc/`,description:"::: tip\n  Subscribe pages starting with `https://wallhaven.cc/search`, fill the text after `?` as `filter` in the route. The following is an example:\n\n  The text after `?` is `q=id%3A711&sorting=random&ref=fp&seed=8g0dgd` for [Wallpaper Search: #landscape - wallhaven.cc](https://wallhaven.cc/search?q=id%3A711&sorting=random&ref=fp&seed=8g0dgd), so the route is [/wallhaven/q=id%3A711&sorting=random&ref=fp&seed=8g0dgd](https://rsshub.app/wallhaven/q=id%3A711&sorting=random&ref=fp&seed=8g0dgd)\n:::"};async function a(i){let a=i.req.param(`filter`)??`latest`,o=/t|y/i.test(i.req.param(`needDetails`)??`false`),s=`https://wallhaven.cc/${a.indexOf(`=`)>0?`search?${a.replaceAll(/page=\d+/g,`page=1`)}`:a}`,c=await n.get(s),l=r(c.data),u=l(`li > figure.thumb`).slice(0,i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`)):24).toArray().map(e=>({title:l(e).find(`img.lazyload`).attr(`data-src`).split(`/`).pop(),description:l(e).html().match(/<img.*?>/)[0],link:l(e).find(`a.preview`).attr(`href`)}));return o&&(u=await Promise.all(u.map(i=>e.tryGet(i.link,async()=>{let e=await n({method:`get`,url:i.link}),a=r(e.data);return i.title=a(`meta[name="title"]`).attr(`content`),i.author=a(`.username`).text(),i.pubDate=t(a(`time`).attr(`datetime`)),i.category=a(`.tagname`).toArray().map(e=>a(e).text()),i.description=a(`div.scrollbox`).html(),i})))),{title:l(`title`).text(),link:s,item:u}}export{i as route};
//# sourceMappingURL=wallhaven-rlgD0RlL.js.map