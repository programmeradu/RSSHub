{"version":3,"file":"cbirc-KEz8qTEO.js","names":["got","route: Route","cache"],"sources":["../../lib/routes/cbirc/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\n\r\nconst categories = {\r\n    jgdt: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '监管动态',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=915,pageIndex=1,pageSize=18.json`,\r\n        title: '监管动态',\r\n    },\r\n    ggtz: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '公告通知',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=925,pageIndex=1,pageSize=18.json`,\r\n        title: '公告通知',\r\n    },\r\n    zcfg: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '政策法规',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=926,pageIndex=1,pageSize=18.json`,\r\n        title: '政策法规',\r\n    },\r\n    zcjd: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '政策解读',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=916,pageIndex=1,pageSize=18.json`,\r\n        title: '政策解读',\r\n    },\r\n    zqyj: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '征求意见',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=951,pageIndex=1,pageSize=18.json`,\r\n        title: '征求意见',\r\n    },\r\n    xzxk: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '行政许可',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=930,pageIndex=1,pageSize=18.json`,\r\n        title: '行政许可',\r\n    },\r\n    xzcf: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '行政处罚',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=931,pageIndex=1,pageSize=18.json`,\r\n        title: '行政处罚',\r\n    },\r\n    xzjgcs: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '行政监管措施',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=932,pageIndex=1,pageSize=18.json`,\r\n        title: '行政监管措施',\r\n    },\r\n    gzlw: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '工作论文',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=934,pageIndex=1,pageSize=18.json`,\r\n        title: '工作论文',\r\n    },\r\n    jrzgyj: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '金融监管研究',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=935,pageIndex=1,pageSize=18.json`,\r\n        title: '金融监管研究',\r\n    },\r\n    tjxx: {\r\n        baseUrl: `http://www.cbirc.gov.cn`,\r\n        description: '统计信息',\r\n        link: `http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectDocByItemIdAndChild/data_itemId=954,pageIndex=1,pageSize=18.json`,\r\n        title: '统计信息',\r\n    },\r\n};\r\n\r\nasync function getContent(item) {\r\n    const response = await got({\r\n        method: 'get',\r\n        url: 'http://www.cbirc.gov.cn/cn/static/data/DocInfo/SelectByDocId/data_docId=' + item.docId + '.json',\r\n    });\r\n    return response.data.data.docClob;\r\n}\r\n\r\nexport const route: Route = {\r\n    path: '/:category?',\r\n    radar: [\r\n        {\r\n            source: ['cbirc.gov.cn/:category', 'cbirc.gov.cn/'],\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['JkCheung'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? 'ggtz';\r\n    const cat = categories[category];\r\n\r\n    // 请求集合\r\n    const response = await cache.tryGet(cat.link, async () => {\r\n        const resp = await got({\r\n            method: 'get',\r\n            url: cat.link,\r\n            headers: {\r\n                Referer: `http://www.cbirc.gov.cn`,\r\n            },\r\n        });\r\n        return resp.data;\r\n    });\r\n\r\n    // 遍历数据集合\r\n    const dataLs = await Promise.all(\r\n        response.data.rows.map(async (item) => {\r\n            const content = await getContent(item);\r\n            return {\r\n                title: item.docTitle,\r\n                // 文章正文\r\n                description: content,\r\n                // 文章发布时间\r\n                pubDate: item.publishDate,\r\n                // 文章链接\r\n                link: `http://www.cbirc.gov.cn/cn/view/pages/ItemDetail.html?docId=${item.docId}&itemId=925&generaltype=0`,\r\n            };\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: `中国银保监会-${cat.title}`,\r\n        link: cat.link,\r\n        description: `中国银保监会-${cat.title}`,\r\n        item: dataLs,\r\n        language: 'zh-CN',\r\n    };\r\n}\r\n"],"mappings":"oRAIA,MAAM,EAAa,CACf,KAAM,CACF,QAAS,0BACT,YAAa,OACb,KAAM,wHACN,MAAO,QAEX,KAAM,CACF,QAAS,0BACT,YAAa,OACb,KAAM,wHACN,MAAO,QAEX,KAAM,CACF,QAAS,0BACT,YAAa,OACb,KAAM,wHACN,MAAO,QAEX,KAAM,CACF,QAAS,0BACT,YAAa,OACb,KAAM,wHACN,MAAO,QAEX,KAAM,CACF,QAAS,0BACT,YAAa,OACb,KAAM,wHACN,MAAO,QAEX,KAAM,CACF,QAAS,0BACT,YAAa,OACb,KAAM,wHACN,MAAO,QAEX,KAAM,CACF,QAAS,0BACT,YAAa,OACb,KAAM,wHACN,MAAO,QAEX,OAAQ,CACJ,QAAS,0BACT,YAAa,SACb,KAAM,wHACN,MAAO,UAEX,KAAM,CACF,QAAS,0BACT,YAAa,OACb,KAAM,wHACN,MAAO,QAEX,OAAQ,CACJ,QAAS,0BACT,YAAa,SACb,KAAM,wHACN,MAAO,UAEX,KAAM,CACF,QAAS,0BACT,YAAa,OACb,KAAM,wHACN,MAAO,SAIf,eAAe,EAAW,EAAM,CAC5B,IAAM,EAAW,MAAMA,EAAI,CACvB,OAAQ,MACR,IAAK,2EAA6E,EAAK,MAAQ,UAEnG,OAAO,EAAS,KAAK,KAAK,QAG9B,MAAaC,EAAe,CACxB,KAAM,cACN,MAAO,CACH,CACI,OAAQ,CAAC,yBAA0B,mBAG3C,KAAM,UACN,YAAa,CAAC,YACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,OACxC,EAAM,EAAW,GAGjB,EAAW,MAAMC,EAAM,OAAO,EAAI,KAAM,SAAY,CACtD,IAAM,EAAO,MAAMF,EAAI,CACnB,OAAQ,MACR,IAAK,EAAI,KACT,QAAS,CACL,QAAS,6BAGjB,OAAO,EAAK,OAIV,EAAS,MAAM,QAAQ,IACzB,EAAS,KAAK,KAAK,IAAI,KAAO,IAAS,CACnC,IAAM,EAAU,MAAM,EAAW,GACjC,MAAO,CACH,MAAO,EAAK,SAEZ,YAAa,EAEb,QAAS,EAAK,YAEd,KAAM,+DAA+D,EAAK,MAAM,+BAK5F,MAAO,CACH,MAAO,UAAU,EAAI,QACrB,KAAM,EAAI,KACV,YAAa,UAAU,EAAI,QAC3B,KAAM,EACN,SAAU"}