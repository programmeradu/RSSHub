{"version":3,"file":"user-Miqa4IdQ.js","names":["route: Route","got","id","data"],"sources":["../../lib/routes/jike/user.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/user/:id',\r\n    categories: ['social-media'],\r\n    view: ViewType.SocialMedia,\r\n    example: '/jike/user/3EE02BC9-C5B3-4209-8750-4ED1EE0F67BB',\r\n    parameters: { id: '用户 id, 可在即刻分享出来的单条动态页点击用户头像进入个人主页，然后在个人主页的 URL 中找到，或者在单条动态页使用 RSSHub Radar 插件' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['web.okjike.com/u/:uid'],\r\n            target: '/user/:uid',\r\n        },\r\n    ],\r\n    name: '用户动态',\r\n    maintainers: ['DIYgod', 'prnake'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id');\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: `https://m.okjike.com/users/${id}`,\r\n        headers: {\r\n            Referer: `https://m.okjike.com/users/${id}`,\r\n        },\r\n    });\r\n\r\n    const html = response.data;\r\n    const $ = load(html);\r\n    const raw = $('[type = \"application/json\"]').html();\r\n    const data = JSON.parse(raw).props.pageProps;\r\n\r\n    const getLink = (id, type) => {\r\n        switch (type) {\r\n            case 'REPOST':\r\n                return `https://m.okjike.com/reposts/${id}`;\r\n            case 'MEDIUM':\r\n                return `https://www.okjike.com/medium/${id}`;\r\n            default:\r\n                return `https://m.okjike.com/originalPosts/${id}`;\r\n        }\r\n    };\r\n\r\n    const items = await Promise.all(\r\n        data.posts.map(async (item) => {\r\n            const typeMap = {\r\n                ORIGINAL_POST: '发布',\r\n                REPOST: '转发',\r\n                ANSWER: '回答',\r\n                QUESTION: '提问',\r\n                PERSONAL_UPDATE: '创建新主题',\r\n            };\r\n\r\n            let linkTemplate = '';\r\n            if (item.linkInfo && item.linkInfo.linkUrl) {\r\n                linkTemplate = `<a href=\"${item.linkInfo.linkUrl}\">${item.linkInfo.title}</a><br>`;\r\n            }\r\n\r\n            let imgTemplate = '';\r\n            if (item.pictures) {\r\n                for (const picture of item.pictures) {\r\n                    imgTemplate += `<br><img src=\"${picture.picUrl}\">`;\r\n                }\r\n            }\r\n\r\n            let content = item.content || (item.linkInfo && item.linkInfo.title) || (item.question && item.question.title) || item.title || '';\r\n            content = content.replaceAll(/\\r\\n|\\n|\\r/g, '<br>');\r\n\r\n            let shortenTitle = '一条动态';\r\n            if (content) {\r\n                shortenTitle = content.replaceAll(/(<br>)+/g, ' ');\r\n                content = `${content}<br><br>`;\r\n            }\r\n\r\n            let repostContent;\r\n            if (item.type === 'REPOST') {\r\n                const screenNameTemplate = item.target.user ? `<a href=\"https://m.okjike.com/users/${item.target.user.username}\" target=\"_blank\">@${item.target.user.screenName}</a>` : '';\r\n\r\n                let repostImgTemplate = '';\r\n                if (item.target.pictures) {\r\n                    for (const picture of item.target.pictures) {\r\n                        repostImgTemplate += `<br><img src=\"${picture.thumbnailUrl}\">`;\r\n                    }\r\n                }\r\n\r\n                repostContent = `<div class=\"rsshub-quote\">转发 ${screenNameTemplate}: ${item.target.content}${repostImgTemplate}</div>`.replaceAll(/\\r\\n|\\n|\\r/g, '<br>');\r\n                content = `${content}${repostContent}`;\r\n            }\r\n            // 部分功能未知\r\n            /* else if (item.type === 'ANSWER') {\r\n            let answerTextTemplate = '';\r\n            let answerImgTemplate = '';\r\n            let answerImgKeys = [];\r\n            item.richtextContent.blocks &&\r\n                item.richtextContent.blocks.forEach((item) => {\r\n                    if (item.entityRanges.length && item.text === '[图片]') {\r\n                        answerImgKeys = [...answerImgKeys, ...Object.keys(item.entityRanges)];\r\n                    } else {\r\n                        answerTextTemplate += item.text;\r\n                    }\r\n                });\r\n\r\n            if (answerImgKeys.length) {\r\n                answerImgKeys.forEach((key) => {\r\n                    const entity = item.richtextContent.entityMap[key];\r\n                    if (entity.type.toUpperCase() === 'IMAGE') {\r\n                        answerImgTemplate += `<br><img src=\"${entity.data.pictureUrl.middlePicUrl}\">`;\r\n                    }\r\n                });\r\n            }\r\n            const answerContent = `回答: ${answerTextTemplate}${answerImgTemplate}`;\r\n            content = `${content}${answerContent}`.replace(/\\n|\\r/g, '<br>');\r\n        } else if (item.type === 'QUESTION') {\r\n            content = `在主题 <a href=\"https://web.okjike.com/topic/${item.topic.id}/official\" target=\"_blank\">${item.topic.content}</a> 提出了一个问题：<br><br>${content}`;\r\n        } else if (item.type === 'PERSONAL_UPDATE') {\r\n            shortenTitle = item.topic.content;\r\n            content = `<img src=\"${item.topic.squarePicture.picUrl}\"> 主题简介：<br>${item.topic.briefIntro.replace(/(?:\\r\\n|\\r|\\n)/g, '<br>')}`;\r\n        }*/\r\n\r\n            const single = {\r\n                title: `${typeMap[item.type]}了: ${shortenTitle}`,\r\n                description: `${content}${linkTemplate}${imgTemplate}`.replace(/(<br>|\\s)+$/, ''),\r\n                pubDate: parseDate(item.createdAt),\r\n                link: getLink(item.id, item.type),\r\n                _extra: repostContent && {\r\n                    links: [\r\n                        {\r\n                            url: getLink(item.target.id, item.target.type),\r\n                            type: 'quote',\r\n                        },\r\n                    ],\r\n                },\r\n            };\r\n\r\n            if (id === 'wenhao1996' && item.topic.id === '553870e8e4b0cafb0a1bef68') {\r\n                single.link = item.urlsInText[0].url;\r\n\r\n                const { data } = await got({\r\n                    method: 'get',\r\n                    url: single.link,\r\n                    headers: {\r\n                        Referer: `https://m.okjike.com/users/${id}`,\r\n                    },\r\n                });\r\n                const $$ = load(data);\r\n                $$('span.num,span.arrow').remove();\r\n\r\n                single.title = `一觉醒来世界发生了什么 ${$$('title').text()}`;\r\n\r\n                single.description = '';\r\n                $$('div.container')\r\n                    .find('li.item')\r\n                    // eslint-disable-next-line array-callback-return\r\n                    .map((i, j) => {\r\n                        single.description += `<a href=\"${$$(j).find('a').attr('href')}\">${$$(j).find('a').text()}</a><br>`;\r\n                    });\r\n            }\r\n\r\n            return single;\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: `${data.user.screenName}的即刻动态`,\r\n        description: data.user.bio,\r\n        link: `https://m.okjike.com/users/${id}`,\r\n        image: data.user.avatarImage.picUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"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"}