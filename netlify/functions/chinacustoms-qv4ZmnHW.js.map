{"version":3,"file":"chinacustoms-qv4ZmnHW.js","names":["got","title","image","cache","route: Route"],"sources":["../../lib/routes/gmcmonline/chinacustoms.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const handler = async (ctx) => {\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 10;\r\n\r\n    const rootUrl = 'http://chinacustoms.gmcmonline.com';\r\n    const magRootUrl = 'http://manager.gmcmonline.com';\r\n\r\n    const { data: response } = await got(rootUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const author = $('p.copyright a').text();\r\n    const language = $('html').prop('lang');\r\n\r\n    let items = $('ul.booklist li a')\r\n        .toArray()\r\n        .slice(0, limit)\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const title = item.find('p.txt').text();\r\n            const image = new URL(item.find('img').prop('src'), rootUrl).href;\r\n\r\n            return {\r\n                title,\r\n                link: new URL(item.prop('href'), rootUrl).href,\r\n                pubDate: parseDate(title, 'YYYY年MM期'),\r\n                author,\r\n                image,\r\n                banner: image,\r\n                language,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                $$('ol.breadcrumb li a').first().remove();\r\n\r\n                const current = $$('ol.breadcrumb li a').first().text();\r\n                const pubDate = parseDate($$('div.title').text(), 'YYYY年MM月DD日');\r\n                const image = new URL($$('div.coverline img').prop('src'), rootUrl).href;\r\n\r\n                return $$('a.txt')\r\n                    .toArray()\r\n                    .map((i) => {\r\n                        i = $(i);\r\n\r\n                        const id = i.prop('href').match(/c\\/(\\d+)\\.shtml/)?.[1] ?? undefined;\r\n\r\n                        if (!id) {\r\n                            return;\r\n                        }\r\n\r\n                        const title = i.prop('title') || i.text();\r\n                        const guid = `gmcmonline-chinacustoms-${id}`;\r\n\r\n                        return {\r\n                            title,\r\n                            pubDate,\r\n                            link: new URL(i.prop('href'), item.link).href,\r\n                            category: [current, i.closest('div.class-box').find('div.title-box span').text().replaceAll(/【|】/g, '') || undefined].filter(Boolean),\r\n                            author,\r\n                            guid,\r\n                            id: guid,\r\n                            image,\r\n                            banner: image,\r\n                            language,\r\n                            enclosure_url: new URL(`front/article/${id}/pdf?magazineID=2`, magRootUrl).href,\r\n                            enclosure_type: 'application/pdf',\r\n                            enclosure_title: title,\r\n                        };\r\n                    })\r\n                    .filter(Boolean);\r\n            })\r\n        )\r\n    );\r\n\r\n    const title = $('title').text();\r\n    const image = new URL($('div.img-box img').prop('src'), rootUrl).href;\r\n\r\n    return {\r\n        title,\r\n        description: title,\r\n        link: rootUrl,\r\n        item: items.flat(),\r\n        allowEmpty: true,\r\n        image,\r\n        author: title,\r\n        language,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/chinacustoms',\r\n    name: '中国海关',\r\n    url: 'chinacustoms.gmcmonline.com',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/gmcmonline/chinacustoms',\r\n    parameters: undefined,\r\n    description: undefined,\r\n    categories: ['reading'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['chinacustoms.gmcmonline.com'],\r\n            target: '/chinacustoms',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"wWAOA,MAAa,EAAU,KAAO,IAAQ,CAClC,IAAM,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,qCAGV,CAAE,KAAM,GAAa,MAAMA,EAAI,GAE/B,EAAI,EAAK,GAET,EAAS,EAAE,iBAAiB,OAC5B,EAAW,EAAE,QAAQ,KAAK,QAE5B,EAAQ,EAAE,oBACT,UACA,MAAM,EAAG,GACT,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAMC,EAAQ,EAAK,KAAK,SAAS,OAC3BC,EAAQ,IAAI,IAAI,EAAK,KAAK,OAAO,KAAK,OAAQ,GAAS,KAE7D,MAAO,CACH,MAAA,EACA,KAAM,IAAI,IAAI,EAAK,KAAK,QAAS,GAAS,KAC1C,QAAS,EAAUD,EAAO,YAC1B,SACA,MAAA,EACA,OAAQC,EACR,cAIZ,EAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAmB,MAAMH,EAAI,EAAK,MAE1C,EAAK,EAAK,GAEhB,EAAG,sBAAsB,QAAQ,SAEjC,IAAM,EAAU,EAAG,sBAAsB,QAAQ,OAC3C,EAAU,EAAU,EAAG,aAAa,OAAQ,eAC5CE,EAAQ,IAAI,IAAI,EAAG,qBAAqB,KAAK,OAAQ,GAAS,KAEpE,OAAO,EAAG,SACL,UACA,IAAK,GAAM,CACR,EAAI,EAAE,GAEN,IAAM,EAAK,EAAE,KAAK,QAAQ,MAAM,qBAAqB,IAAM,IAAA,GAE3D,GAAI,CAAC,EACD,OAGJ,IAAMD,EAAQ,EAAE,KAAK,UAAY,EAAE,OAC7B,EAAO,2BAA2B,IAExC,MAAO,CACH,MAAA,EACA,UACA,KAAM,IAAI,IAAI,EAAE,KAAK,QAAS,EAAK,MAAM,KACzC,SAAU,CAAC,EAAS,EAAE,QAAQ,iBAAiB,KAAK,sBAAsB,OAAO,WAAW,OAAQ,KAAO,IAAA,IAAW,OAAO,SAC7H,SACA,OACA,GAAI,EACJ,MAAA,EACA,OAAQC,EACR,WACA,cAAe,IAAI,IAAI,iBAAiB,EAAG,mBAAoB,iCAAY,KAC3E,eAAgB,kBAChB,gBAAiBD,KAGxB,OAAO,aAKxB,IAAM,EAAQ,EAAE,SAAS,OACnB,EAAQ,IAAI,IAAI,EAAE,mBAAmB,KAAK,OAAQ,GAAS,KAEjE,MAAO,CACH,QACA,YAAa,EACb,KAAM,EACN,KAAM,EAAM,OACZ,WAAY,GACZ,QACA,OAAQ,EACR,aAIKG,EAAe,CACxB,KAAM,gBACN,KAAM,OACN,IAAK,8BACL,YAAa,CAAC,WACd,UACA,QAAS,2BACT,WAAY,IAAA,GACZ,YAAa,IAAA,GACb,WAAY,CAAC,WAEb,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,aAAc,GACd,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,+BACT,OAAQ"}