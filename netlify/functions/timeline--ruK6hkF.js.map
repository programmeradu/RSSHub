{"version":3,"file":"timeline--ruK6hkF.js","names":["route: Route","ConfigNotFoundError","got","cache"],"sources":["../../lib/routes/mihoyo/bbs/timeline.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport cache from './cache';\r\nimport { config } from '@/config';\r\nimport { post2item } from './utils';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\n\r\nexport const route: Route = {\r\n    path: '/bbs/timeline',\r\n    categories: ['game'],\r\n    example: '/mihoyo/bbs/timeline',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'MIHOYO_COOKIE',\r\n                description: '',\r\n            },\r\n        ],\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['miyoushe.com/:game/timeline'],\r\n        },\r\n    ],\r\n    name: '米游社 - 用户关注动态',\r\n    maintainers: ['CaoMeiYouRen'],\r\n    handler,\r\n    description: `::: warning\r\n  用户关注动态需要米游社登录后的 Cookie 值，所以只能自建，详情见部署页面的配置模块。\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    if (!config.mihoyo.cookie) {\r\n        throw new ConfigNotFoundError('Miyoushe Timeline is not available due to the absense of [Miyoushe Cookie]. Check <a href=\"https://docs.rsshub.app/deploy/config#route-specific-configurations\">relevant config tutorial</a>');\r\n    }\r\n\r\n    const page_size = ctx.req.query('limit') || '20';\r\n    const searchParams = {\r\n        gids: 2,\r\n        page_size,\r\n    };\r\n    const link = 'https://www.miyoushe.com/ys/timeline';\r\n    const url = 'https://bbs-api.miyoushe.com/painter/wapi/timeline/list';\r\n    const response = await got({\r\n        method: 'get',\r\n        url,\r\n        searchParams,\r\n        headers: {\r\n            Referer: link,\r\n            Cookie: config.mihoyo.cookie,\r\n        },\r\n    });\r\n    const list = response?.data?.data?.list;\r\n    if (!list) {\r\n        throw new Error('未获取到数据！');\r\n    }\r\n    const { nickname: username } = await cache.getUserFullInfo(ctx, '');\r\n    const title = `米游社 - ${username} 的关注动态`;\r\n    const items = list.map((e) => post2item(e));\r\n\r\n    const data = {\r\n        title,\r\n        link,\r\n        item: items,\r\n    };\r\n    return data;\r\n}\r\n"],"mappings":"yfAOA,MAAaA,EAAe,CACxB,KAAM,gBACN,WAAY,CAAC,QACb,QAAS,uBACT,WAAY,GACZ,SAAU,CACN,cAAe,CACX,CACI,KAAM,gBACN,YAAa,KAGrB,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,iCAGjB,KAAM,eACN,YAAa,CAAC,gBACd,UACA,YAAa;;MAKjB,eAAe,EAAQ,EAAK,CACxB,GAAI,CAAC,EAAO,OAAO,OACf,MAAM,IAAIC,EAAoB,gMAGlC,IAAM,EAAY,EAAI,IAAI,MAAM,UAAY,KACtC,EAAe,CACjB,KAAM,EACN,aAEE,EAAO,uCAEP,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,8DACA,eACA,QAAS,CACL,QAAS,EACT,OAAQ,EAAO,OAAO,UAGxB,EAAO,GAAU,MAAM,MAAM,KACnC,GAAI,CAAC,EACD,MAAU,MAAM,WAEpB,GAAM,CAAE,SAAU,GAAa,MAAMC,EAAM,gBAAgB,EAAK,IAC1D,EAAQ,SAAS,EAAS,QAC1B,EAAQ,EAAK,IAAK,GAAM,EAAU,IAElC,EAAO,CACT,QACA,OACA,KAAM,GAEV,OAAO"}