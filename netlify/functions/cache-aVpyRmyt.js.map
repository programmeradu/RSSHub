{"version":3,"file":"cache-aVpyRmyt.js","names":["cache","got","data"],"sources":["../../lib/routes/qq/kg/cache.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { JSDOM } from 'jsdom';\r\n\r\nexport default {\r\n    getPlayInfo: async (ctx, shareId, ksong_mid = '') => {\r\n        const link = `https://node.kg.qq.com/play?s=${shareId}`;\r\n        const cache_key = ksong_mid ? `ksong:${ksong_mid}` : link;\r\n        const data = await cache.tryGet(cache_key, async () => {\r\n            const response = await got(link);\r\n            const { window } = new JSDOM(response.data, {\r\n                runScripts: 'dangerously',\r\n            });\r\n            const data = window.__DATA__;\r\n            const name = data.detail.song_name;\r\n            const description = data.detail.content;\r\n            const author = data.detail.nick;\r\n            const itunes_item_image = data.detail.cover;\r\n\r\n            const enclosure_url = data.detail.playurl;\r\n            ksong_mid = ksong_mid ?? data.detail.ksong_mid;\r\n            const ctime = data.detail.ctime;\r\n            const comments = data.detail.comments;\r\n\r\n            return { name, link, description, author, enclosure_url, ksong_mid, ctime, itunes_item_image, comments };\r\n        });\r\n        return data;\r\n    },\r\n};\r\n"],"mappings":"kIAIA,IAAA,EAAe,CACX,YAAa,MAAO,EAAK,EAAS,EAAY,KAAO,CACjD,IAAM,EAAO,iCAAiC,IACxC,EAAY,EAAY,SAAS,IAAc,EAC/C,EAAO,MAAMA,EAAM,OAAO,EAAW,SAAY,CACnD,IAAM,EAAW,MAAMC,EAAI,GACrB,CAAE,UAAW,IAAI,EAAM,EAAS,KAAM,CACxC,WAAY,gBAEVC,EAAO,EAAO,SACd,EAAOA,EAAK,OAAO,UACnB,EAAcA,EAAK,OAAO,QAC1B,EAASA,EAAK,OAAO,KACrB,EAAoBA,EAAK,OAAO,MAEhC,EAAgBA,EAAK,OAAO,QAClC,EAAY,GAAaA,EAAK,OAAO,UACrC,IAAM,EAAQA,EAAK,OAAO,MACpB,EAAWA,EAAK,OAAO,SAE7B,MAAO,CAAE,OAAM,OAAM,cAAa,SAAQ,gBAAe,YAAW,QAAO,oBAAmB,cAElG,OAAO"}