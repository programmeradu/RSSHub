{"version":3,"file":"tianshu-BlKOphIF.js","names":["route: Route","got","href: string","cache","response","$"],"sources":["../../lib/routes/imop/tianshu.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport { load } from 'cheerio';\r\nimport got from '@/utils/got';\r\nimport iconv from 'iconv-lite';\r\nimport cache from '@/utils/cache';\r\n\r\nconst baseUrl = 'http://t.imop.com';\r\n\r\nexport const route: Route = {\r\n    path: '/tianshu',\r\n    categories: ['game'],\r\n    example: '/imop/tianshu',\r\n    radar: [\r\n        {\r\n            source: ['t.imop.com'],\r\n            target: '/tianshu',\r\n        },\r\n    ],\r\n    name: '全部消息',\r\n    maintainers: ['zhkgo'],\r\n    handler,\r\n};\r\n\r\nasync function handler() {\r\n    const { data: response } = await got(`${baseUrl}/list/0-1.htm`, { responseType: 'buffer' });\r\n    const $ = load(iconv.decode(response, 'gbk'));\r\n    const list = $('.right .right_top .right_bot .list2 .ul1 ul')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            const href: string = item.find('a').attr('href');\r\n            return {\r\n                title: item.find('a').text(),\r\n                link: href.startsWith('http') ? href : `${baseUrl}${href}`,\r\n            };\r\n        });\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link, { responseType: 'buffer' });\r\n                const $ = load(iconv.decode(response, 'gbk'));\r\n                item.description = $('.right .right_top .right_bot .articlebox').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: '天书最新消息',\r\n        link: `${baseUrl}/list/0-1.htm`,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"6UAMA,MAAM,EAAU,oBAEHA,EAAe,CACxB,KAAM,WACN,WAAY,CAAC,QACb,QAAS,gBACT,MAAO,CACH,CACI,OAAQ,CAAC,cACT,OAAQ,aAGhB,KAAM,OACN,YAAa,CAAC,SACd,WAGJ,eAAe,GAAU,CACrB,GAAM,CAAE,KAAM,GAAa,MAAMC,EAAI,GAAG,EAAQ,eAAgB,CAAE,aAAc,WAC1E,EAAI,EAAK,EAAM,OAAO,EAAU,QAChC,EAAO,EAAE,+CACV,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAMC,EAAe,EAAK,KAAK,KAAK,KAAK,QACzC,MAAO,CACH,MAAO,EAAK,KAAK,KAAK,OACtB,KAAM,EAAK,WAAW,QAAU,EAAO,GAAG,IAAU,OAG1D,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMH,EAAI,EAAK,KAAM,CAAE,aAAc,WAC1DI,EAAI,EAAK,EAAM,OAAOD,EAAU,QAEtC,MADA,GAAK,YAAcC,EAAE,4CAA4C,OAC1D,MAKnB,MAAO,CACH,MAAO,SACP,KAAM,GAAG,EAAQ,eACjB,KAAM"}