import"./esm-shims-Dqvxr0BZ.js";import{config as e}from"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-kimkMTWJ.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import"./ofetch-Bzt0BXUH.js";import"./got-CdvI2yKX.js";import{ViewType as r}from"./types-A5bA50Mg.js";import{config_not_found_default as i}from"./config-not-found-BVqhRP9D.js";import{getToken as a,maskHeader as o,pixiv_got_default as s,utils_default as c}from"./utils-VPsgV-F2.js";import l from"query-string";function u(e,t){return s(`https://app-api.pixiv.net/v1/search/popular-preview/illust`,{headers:{...o,Authorization:`Bearer `+t},searchParams:l.stringify({word:e,search_target:`partial_match_for_tags`,filter:`for_ios`})})}function d(e,t){return s(`https://app-api.pixiv.net/v1/search/illust`,{headers:{...o,Authorization:`Bearer `+t},searchParams:l.stringify({word:e,search_target:`partial_match_for_tags`,sort:`date_desc`,filter:`for_ios`})})}const f={path:`/search/:keyword/:order?/:mode?/:include_ai?`,categories:[`social-media`],view:r.Pictures,example:`/pixiv/search/Nezuko/popular`,parameters:{keyword:`keyword`,order:{description:`rank mode, empty or other for time order, popular for popular order`,default:`date`,options:[{label:`time order`,value:`date`},{label:`popular order`,value:`popular`}]},mode:{description:`filte R18 content`,default:`no`,options:[{label:`only not R18`,value:`safe`},{label:`only R18`,value:`r18`},{label:`no filter`,value:`no`}]},include_ai:{description:`whether AI-generated content is included`,default:`yes`,options:[{label:`does not include AI-generated content`,value:`no`},{label:`include AI-generated content`,value:`yes`}]}},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Keyword`,maintainers:[`DIYgod`],handler:p};async function p(r){if(!e.pixiv||!e.pixiv.refreshToken)throw new i(`pixiv RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let o=r.req.param(`keyword`),s=r.req.param(`order`)||`date`,l=r.req.param(`mode`),f=r.req.param(`include_ai`),p=await a(t.tryGet);if(!p)throw new i(`pixiv not login`);let m=await(s===`popular`?u(o,p):d(o,p)),h=m.data.illusts;return l===`safe`||l===`1`?h=h.filter(e=>e.x_restrict===0):(l===`r18`||l===`2`)&&(h=h.filter(e=>e.x_restrict===1)),(f===`no`||f===`0`)&&(h=h.filter(e=>e.illust_ai_type<=1)),{title:`${o} 的 pixiv ${s===`popular`?`热门`:``}内容`,link:`https://www.pixiv.net/tags/${o}/artworks`,item:h.map(e=>{let t=c.getImgs(e);return{title:e.title,author:e.user.name,pubDate:n(e.create_date),description:`${e.caption}<br><p>画师：${e.user.name} - 阅览数：${e.total_view} - 收藏数：${e.total_bookmarks}</p>${t.join(``)}`,link:`https://www.pixiv.net/artworks/${e.id}`}}),allowEmpty:!0}}export{f as route};
//# sourceMappingURL=search-L4q-Nwo1.js.map