{"version":3,"file":"version-Bf6pY3GF.js","names":["route: Route","linkFormatter: any","response: any","got","data: VersionInManifest[]"],"sources":["../../lib/routes/minecraft/version.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { Context } from 'hono';\r\n\r\nexport const route: Route = {\r\n    path: '/version/:versionType?/:linkType?',\r\n    categories: ['game'],\r\n    example: '/minecraft/version',\r\n    parameters: {\r\n        versionType: `Game version type, \\`all\\` by default`,\r\n        linkType: `Link added to feed, \\`official\\` by default`,\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['minecraft.net/'],\r\n        },\r\n    ],\r\n    name: 'Java Game Update',\r\n    maintainers: ['TheresaQWQ', 'xtexChooser'],\r\n    handler,\r\n    url: 'minecraft.net/',\r\n    description: `\r\n| Version                    | versionType |\r\n| -------------------------- | ----------- |\r\n| 正式版                     | release     |\r\n| 快照                       | snapshot    |\r\n| Alpha 及更早的版本         | old_alpha  |\r\n| Beta 版                    | old_beta   |\r\n| Target                     | linkType    |\r\n| -------------------------- | --------    |\r\n| minecraft.net              | official    |\r\n| 英文 Minecraft Wiki 版本页 | enwiki      |\r\n| 中文 Minecraft Wiki 版本页 | zhwiki      |\r\n`,\r\n    zh: {\r\n        name: 'Java版游戏更新',\r\n    },\r\n};\r\n\r\ninterface VersionInManifest {\r\n    id: string;\r\n    type: string;\r\n    releaseTime: string;\r\n}\r\n\r\nconst typeName = {\r\n    release: '正式版',\r\n    snapshot: '快照',\r\n    old_alpha: 'Alpha及更早的版本',\r\n    old_beta: 'Beta版',\r\n};\r\n\r\nconst linkFormatter: any = {\r\n    official: () => `https://www.minecraft.net`,\r\n    enwiki: (item: VersionInManifest) => {\r\n        let id = item.id;\r\n        if (item.type === 'old_beta' && id.startsWith('b')) {\r\n            id = `Beta ${id.slice(1)}`;\r\n        }\r\n        if (item.type === 'old_alpha') {\r\n            if (id.startsWith('a')) {\r\n                id = `Alpha ${id.slice(1)}`;\r\n            } else if (id.startsWith('c')) {\r\n                id = `Classic ${id.slice(1)}`;\r\n            } else if (id.startsWith('inf-')) {\r\n                id = `Infdev`;\r\n            } else if (id.startsWith('rd-')) {\r\n                id = `pre-Classic ${id}`;\r\n            }\r\n        }\r\n        return `https://minecraft.wiki/w/Java Edition ${id}`;\r\n    },\r\n    zhwiki: (item: VersionInManifest) => {\r\n        let id = item.id;\r\n        if (item.type === 'release') {\r\n            id = `Java版${id}`;\r\n        }\r\n        if (item.type === 'old_beta' && id.startsWith('b')) {\r\n            id = `Java版Beta ${id.slice(1)}`;\r\n        }\r\n        if (item.type === 'old_alpha') {\r\n            if (id.startsWith('a')) {\r\n                id = `Java版Alpha ${id.slice(1)}`;\r\n            } else if (id.startsWith('c')) {\r\n                id = `Java版Classic ${id.slice(1)}`;\r\n            } else if (id.startsWith('inf-')) {\r\n                id = `Java版Infdev`;\r\n            } else if (id.startsWith('rd-')) {\r\n                id = `Java版pre-Classic ${id}`;\r\n            }\r\n        }\r\n        return `https://zh.minecraft.wiki/w/${id}`;\r\n    },\r\n};\r\n\r\nasync function handler(ctx?: Context) {\r\n    const url = ctx?.req.query('mcmanifest') ?? 'https://piston-meta.mojang.com/mc/game/version_manifest_v2.json';\r\n\r\n    const response: any = await got({\r\n        method: 'get',\r\n        url,\r\n        responseType: 'json',\r\n    });\r\n\r\n    let data: VersionInManifest[] = response.data.versions;\r\n\r\n    const versionType = ctx?.req.param('versionType') ?? 'all';\r\n    const linkType = ctx?.req.param('linkType') ?? 'official';\r\n    const linker = linkFormatter[linkType] ?? linkFormatter.official;\r\n\r\n    if (versionType !== 'all') {\r\n        data = data.filter((item) => item.type === versionType);\r\n    }\r\n\r\n    const title = `Minecraft Java版${versionType === 'all' ? '' : (typeName[versionType] ?? versionType)}游戏更新`;\r\n\r\n    return {\r\n        title,\r\n        link: `https://www.minecraft.net/`,\r\n        description: title,\r\n        item: data.map((item) => ({\r\n            title: `${item.id} ${typeName[item.type] || ''}更新`,\r\n            description: `${item.id} ${typeName[item.type] || ''}更新`,\r\n            pubDate: new Date(item.releaseTime).toUTCString(),\r\n            link: linker(item),\r\n            guid: item.id + item.type,\r\n        })),\r\n    };\r\n}\r\n"],"mappings":"gOAIA,MAAaA,EAAe,CACxB,KAAM,oCACN,WAAY,CAAC,QACb,QAAS,qBACT,WAAY,CACR,YAAa,sCACb,SAAU,6CAEd,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,oBAGjB,KAAM,mBACN,YAAa,CAAC,aAAc,eAC5B,UACA,IAAK,iBACL,YAAa;;;;;;;;;;;;EAab,GAAI,CACA,KAAM,cAUR,EAAW,CACb,QAAS,MACT,SAAU,KACV,UAAW,cACX,SAAU,SAGRC,EAAqB,CACvB,aAAgB,4BAChB,OAAS,GAA4B,CACjC,IAAI,EAAK,EAAK,GAed,OAdI,EAAK,OAAS,YAAc,EAAG,WAAW,OAC1C,EAAK,QAAQ,EAAG,MAAM,MAEtB,EAAK,OAAS,cACV,EAAG,WAAW,KACd,EAAK,SAAS,EAAG,MAAM,KAChB,EAAG,WAAW,KACrB,EAAK,WAAW,EAAG,MAAM,KAClB,EAAG,WAAW,QACrB,EAAK,SACE,EAAG,WAAW,SACrB,EAAK,eAAe,MAGrB,yCAAyC,KAEpD,OAAS,GAA4B,CACjC,IAAI,EAAK,EAAK,GAkBd,OAjBI,EAAK,OAAS,YACd,EAAK,QAAQ,KAEb,EAAK,OAAS,YAAc,EAAG,WAAW,OAC1C,EAAK,aAAa,EAAG,MAAM,MAE3B,EAAK,OAAS,cACV,EAAG,WAAW,KACd,EAAK,cAAc,EAAG,MAAM,KACrB,EAAG,WAAW,KACrB,EAAK,gBAAgB,EAAG,MAAM,KACvB,EAAG,WAAW,QACrB,EAAK,cACE,EAAG,WAAW,SACrB,EAAK,oBAAoB,MAG1B,+BAA+B,MAI9C,eAAe,EAAQ,EAAe,CAClC,IAAM,EAAM,GAAK,IAAI,MAAM,eAAiB,kEAEtCC,EAAgB,MAAMC,EAAI,CAC5B,OAAQ,MACR,MACA,aAAc,SAGdC,EAA4B,EAAS,KAAK,SAExC,EAAc,GAAK,IAAI,MAAM,gBAAkB,MAC/C,EAAW,GAAK,IAAI,MAAM,aAAe,WACzC,EAAS,EAAc,IAAa,EAAc,SAEpD,IAAgB,QAChB,EAAO,EAAK,OAAQ,GAAS,EAAK,OAAS,IAG/C,IAAM,EAAQ,kBAAkB,IAAgB,MAAQ,GAAM,EAAS,IAAgB,EAAa,MAEpG,MAAO,CACH,QACA,KAAM,6BACN,YAAa,EACb,KAAM,EAAK,IAAK,IAAU,CACtB,MAAO,GAAG,EAAK,GAAG,GAAG,EAAS,EAAK,OAAS,GAAG,IAC/C,YAAa,GAAG,EAAK,GAAG,GAAG,EAAS,EAAK,OAAS,GAAG,IACrD,QAAS,IAAI,KAAK,EAAK,aAAa,cACpC,KAAM,EAAO,GACb,KAAM,EAAK,GAAK,EAAK"}