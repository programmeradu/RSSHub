{"version":3,"file":"column-DFEGLKog.js","names":[],"sources":["../../lib/routes/southcn/nfapp/column.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { parseArticle } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/nfapp/column/:column?',\r\n    categories: ['traditional-media'],\r\n    example: '/southcn/nfapp/column/38',\r\n    parameters: { column: '栏目或南方号 ID' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '南方 +（按栏目 ID）',\r\n    maintainers: ['TimWu007'],\r\n    handler,\r\n    description: `::: tip\r\n  若此处输入的是栏目 ID（而非南方号 ID），则该接口会返回与输入栏目相关联栏目的文章。例如，输入栏目 ID \\`38\\`（广州），则返回的结果还会包含 ID 为 \\`3547\\`（市长报道集）的文章。\r\n:::\r\n\r\n  1.  \\`pc.nfapp.southcn.com\\` 下的文章页面，可通过 url 查看，例：\\`http://pc.nfapp.southcn.com/13707/7491109.html\\` 的栏目 ID 为 \\`13707\\`。\r\n  2.  \\`static.nfapp.southcn.com\\` 下的文章页面，可查看网页源代码，搜索 \\`columnid\\`。\r\n  3.  [https://m.nfapp.southcn.com/column/all](https://m.nfapp.southcn.com/column/all) 列出了部分栏目，\\`id\\` 即为栏目 ID。`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const columnId = ctx.req.param('column') ?? 38;\r\n\r\n    const getColumnDetail = `https://api.nfapp.southcn.com/nanfang_if/getColumn?columnId=${columnId}`;\r\n    const { data: responseColumn } = await got(getColumnDetail);\r\n    const columnName = responseColumn.columnName === '' ? `南方+` : `南方+ - ${responseColumn.columnName}`;\r\n    const columnLink = responseColumn.linkUrl === '' ? `https://m.nfapp.southcn.com/${columnId}` : responseColumn.linkUrl;\r\n\r\n    /* Notes of columnLink:\r\n    1) 南方号 uses responseColumn.linkUrl, e.g. https://static.nfapp.southcn.com/nfh/shareNFNum/index.html?nfhId=3392;\r\n    2) 栏目/频道's responseColumn.linkUrl is empty, we use its subpage on 南方+ mobile site, e.g. https://m.nfapp.southcn.com/38;\r\n    3) But https://m.nfapp.southcn.com/${columnId} may still be invalid for some higher-level columns, e.g. 20.\r\n    */\r\n\r\n    const getArticleList = `https://api.nfapp.southcn.com/nfplus-manuscript-web/article/list?columnId=${columnId}&nfhSubCount=1&pageNum=1&pageSize=20`; // this api only returns up to 20 articles\r\n    const { data: responseArticle } = await got(getArticleList);\r\n    const list = responseArticle.data.list\r\n        .filter((i) => i.articleType === 0)\r\n        .map((item) => ({\r\n            title: '【' + item.columnName + '】' + item.title,\r\n            description: art(path.join(__dirname, '../templates/description.art'), {\r\n                thumb: item.picMiddle,\r\n                description: item.summary === '详见内文' ? '' : item.summary,\r\n            }),\r\n            pubDate: timezone(parseDate(item.updateTime), +8),\r\n            link: `http://pc.nfapp.southcn.com/${item.columnId}/${item.articleId}.html`,\r\n            articleId: item.articleId,\r\n            shareUrl: item.shareUrl,\r\n        }));\r\n\r\n    const items = await Promise.all(list.map((item) => parseArticle(item, cache.tryGet)));\r\n\r\n    return {\r\n        title: columnName,\r\n        link: columnLink,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"8hBAUA,MAAa,EAAe,CACxB,KAAM,yBACN,WAAY,CAAC,qBACb,QAAS,2BACT,WAAY,CAAE,OAAQ,aACtB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,eACN,YAAa,CAAC,YACd,UACA,YAAa,2ZASjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,WAAa,GAEtC,EAAkB,+DAA+D,IACjF,CAAE,KAAM,GAAmB,MAAM,EAAI,GACrC,EAAa,EAAe,aAAe,GAAK,MAAQ,SAAS,EAAe,aAChF,EAAa,EAAe,UAAY,GAAK,+BAA+B,IAAa,EAAe,QAQxG,EAAiB,6EAA6E,EAAS,sCACvG,CAAE,KAAM,GAAoB,MAAM,EAAI,GACtC,EAAO,EAAgB,KAAK,KAC7B,OAAQ,GAAM,EAAE,cAAgB,GAChC,IAAK,IAAU,CACZ,MAAO,IAAM,EAAK,WAAa,IAAM,EAAK,MAC1C,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAsD,CACnE,MAAO,EAAK,UACZ,YAAa,EAAK,UAAY,OAAS,GAAK,EAAK,UAErD,QAAS,EAAS,EAAU,EAAK,YAAa,GAC9C,KAAM,+BAA+B,EAAK,SAAS,GAAG,EAAK,UAAU,OACrE,UAAW,EAAK,UAChB,SAAU,EAAK,YAGjB,EAAQ,MAAM,QAAQ,IAAI,EAAK,IAAK,GAAS,EAAa,EAAM,EAAM,UAE5E,MAAO,CACH,MAAO,EACP,KAAM,EACN,KAAM"}