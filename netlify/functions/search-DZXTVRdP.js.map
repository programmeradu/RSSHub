{"version":3,"file":"search-DZXTVRdP.js","names":["route: Route","utils","cache","link"],"sources":["../../lib/routes/pianyuan/search.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport utils from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/indexers/pianyuan/results/search/api',\r\n    radar: [\r\n        {\r\n            source: ['pianyuan.org/'],\r\n            target: '/index',\r\n        },\r\n    ],\r\n    name: 'Unknown',\r\n    maintainers: ['jerry1119'],\r\n    handler,\r\n    url: 'pianyuan.org/',\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const link_base = 'https://pianyuan.org/';\r\n    const description = '搜索';\r\n    // 适配jackett 搜索api, eg: https://rsshub.app/pianyuan/indexers/pianyuan/results/search/api?t=test&q=halo\r\n    const searchKey = ctx.originalUrl.split('&q=')[1];\r\n    const link = link_base + `search?q=${searchKey}`;\r\n\r\n    const response = await utils.request(link, cache);\r\n    const $ = load(response.data);\r\n    // 只获取第一页的搜索结果\r\n    const searchLinks = $('.nomt > a')\r\n        .toArray()\r\n        .map((a) => $(a).attr('href'));\r\n    if (searchLinks.length === 0) {\r\n        throw new Error('pianyuan 搜索失败');\r\n    }\r\n\r\n    const detailLinks = [];\r\n\r\n    await Promise.all(\r\n        searchLinks.map(async (e) => {\r\n            const link = new URL(e, link_base).href;\r\n            const single = await cache.tryGet(link, async () => {\r\n                const res = await utils.request(link, cache);\r\n                const content = load(res.data);\r\n                content('.ico.ico_bt')\r\n                    .toArray()\r\n                    .map((a) => detailLinks.push($(a).attr('href')));\r\n            });\r\n            return single;\r\n        })\r\n    );\r\n\r\n    const items = await utils.ProcessFeed(detailLinks, cache);\r\n\r\n    return {\r\n        title: '片源网',\r\n        description,\r\n        link: link_base,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wXAKA,MAAaA,EAAe,CACxB,KAAM,wCACN,MAAO,CACH,CACI,OAAQ,CAAC,iBACT,OAAQ,WAGhB,KAAM,UACN,YAAa,CAAC,aACd,UACA,IAAK,iBAGT,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAY,wBAGZ,EAAY,EAAI,YAAY,MAAM,OAAO,GACzC,EAAO,iCAAwB,IAE/B,EAAW,MAAMC,EAAM,QAAQ,EAAMC,GACrC,EAAI,EAAK,EAAS,MAElB,EAAc,EAAE,aACjB,UACA,IAAK,GAAM,EAAE,GAAG,KAAK,SAC1B,GAAI,EAAY,SAAW,EACvB,MAAU,MAAM,iBAGpB,IAAM,EAAc,GAEpB,MAAM,QAAQ,IACV,EAAY,IAAI,KAAO,IAAM,CACzB,IAAMC,EAAO,IAAI,IAAI,EAAG,GAAW,KAC7B,EAAS,MAAMD,EAAM,OAAOC,EAAM,SAAY,CAChD,IAAM,EAAM,MAAMF,EAAM,QAAQE,EAAMD,GAChC,EAAU,EAAK,EAAI,MACzB,EAAQ,eACH,UACA,IAAK,GAAM,EAAY,KAAK,EAAE,GAAG,KAAK,YAE/C,OAAO,KAIf,IAAM,EAAQ,MAAMD,EAAM,YAAY,EAAaC,GAEnD,MAAO,CACH,MAAO,MACP,iBACA,KAAM,EACN,KAAM"}