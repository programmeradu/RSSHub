{"version":3,"file":"zhitongcaijing-CbM6zh5v.js","names":[],"sources":["../../lib/routes/zhitongcaijing/index.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nconst ids = {\r\n    recommend: {\r\n        url: 'content/recommend',\r\n        title: '推荐',\r\n    },\r\n    hkstock: {\r\n        url: 'content/hkstock',\r\n        title: '港股',\r\n    },\r\n    meigu: {\r\n        url: 'content/meigu',\r\n        title: '美股',\r\n    },\r\n    agu: {\r\n        url: 'content/agu',\r\n        title: '沪深',\r\n    },\r\n    ct: {\r\n        url: 'content/ct',\r\n        title: '创投',\r\n    },\r\n    esg: {\r\n        url: 'content/esg',\r\n        title: 'ESG',\r\n    },\r\n    aqs: {\r\n        url: 'content/aqs',\r\n        title: '券商',\r\n    },\r\n    ajj: {\r\n        url: 'content/ajj',\r\n        title: '基金',\r\n    },\r\n    focus: {\r\n        url: 'focus',\r\n        title: '要闻',\r\n    },\r\n    announcement: {\r\n        url: 'announcement',\r\n        title: '公告',\r\n    },\r\n    research: {\r\n        url: 'research',\r\n        title: '研究',\r\n    },\r\n    shares: {\r\n        url: 'shares',\r\n        title: '新股',\r\n    },\r\n    bazaar: {\r\n        url: 'bazaar',\r\n        title: '市场',\r\n    },\r\n    company: {\r\n        url: 'company',\r\n        title: '公司',\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:id?/:category?',\r\n    categories: ['finance'],\r\n    view: ViewType.Articles,\r\n    example: '/zhitongcaijing',\r\n    parameters: { id: '栏目 id，可在对应栏目页 URL 中找到，默认为 recommend，即推荐', category: '分类 id，可在对应栏目子分类页 URL 中找到，默认为全部' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '推荐',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `| id           | 栏目 |\r\n| ------------ | ---- |\r\n| recommend    | 推荐 |\r\n| hkstock      | 港股 |\r\n| meigu        | 美股 |\r\n| agu          | 沪深 |\r\n| ct           | 创投 |\r\n| esg          | ESG  |\r\n| aqs          | 券商 |\r\n| ajj          | 基金 |\r\n| focus        | 要闻 |\r\n| announcement | 公告 |\r\n| research     | 研究 |\r\n| shares       | 新股 |\r\n| bazaar       | 市场 |\r\n| company      | 公司 |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const id = ctx.req.param('id') ?? 'recommend';\r\n    const category = ctx.req.param('category') ?? '';\r\n\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 20;\r\n\r\n    const rootUrl = 'https://www.zhitongcaijing.com';\r\n    const currentUrl = `${rootUrl}/${ids[id].url}.html${category === '' ? '' : `?category_key=${category}`}`;\r\n    const apiUrl = `${rootUrl}/${ids[id].url}.html?data_type=1&page=1${category === '' ? '' : `&category_key=${category}`}`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: apiUrl,\r\n    });\r\n\r\n    let items = response.data.data.slice(0, limit).map((item) => ({\r\n        title: item.title,\r\n        link: `${rootUrl}${item.url}`,\r\n        description: item.digest,\r\n        author: item.author_info.author_name,\r\n        pubDate: parseDate((item.create_time ?? Number.parseInt(item.original_time)) * 1000),\r\n        category: [...(item.keywords?.split(',') ?? []), item.category_name ?? item.type_tag],\r\n    }));\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n\r\n                const content = load(detailResponse.data);\r\n\r\n                content('#subscribe-vip-box').remove();\r\n                content('#news-content').remove();\r\n\r\n                item.description = art(path.join(__dirname, 'templates/description.art'), {\r\n                    digest: content('.digetst-box').html() || content('.telegram-origin-contentn').html(),\r\n                    description: content('.news-body-content').html(),\r\n                });\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `智通财经 - ${ids[id].title}`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"ugBASA,MAAM,EAAM,CACR,UAAW,CACP,IAAK,oBACL,MAAO,MAEX,QAAS,CACL,IAAK,kBACL,MAAO,MAEX,MAAO,CACH,IAAK,gBACL,MAAO,MAEX,IAAK,CACD,IAAK,cACL,MAAO,MAEX,GAAI,CACA,IAAK,aACL,MAAO,MAEX,IAAK,CACD,IAAK,cACL,MAAO,OAEX,IAAK,CACD,IAAK,cACL,MAAO,MAEX,IAAK,CACD,IAAK,cACL,MAAO,MAEX,MAAO,CACH,IAAK,QACL,MAAO,MAEX,aAAc,CACV,IAAK,eACL,MAAO,MAEX,SAAU,CACN,IAAK,WACL,MAAO,MAEX,OAAQ,CACJ,IAAK,SACL,MAAO,MAEX,OAAQ,CACJ,IAAK,SACL,MAAO,MAEX,QAAS,CACL,IAAK,UACL,MAAO,OAIF,EAAe,CACxB,KAAM,mBACN,WAAY,CAAC,WACb,KAAM,EAAS,SACf,QAAS,kBACT,WAAY,CAAE,GAAI,0CAA2C,SAAU,kCACvE,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;;;;;;;;;;wBAkBjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAK,EAAI,IAAI,MAAM,OAAS,YAC5B,EAAW,EAAI,IAAI,MAAM,aAAe,GAExC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,GAE3E,EAAU,iCACV,EAAa,GAAG,EAAQ,GAAG,EAAI,GAAI,IAAI,OAAO,IAAa,GAAK,GAAK,iBAAiB,MACtF,EAAS,GAAG,EAAQ,GAAG,EAAI,GAAI,IAAI,0BAA0B,IAAa,GAAK,GAAK,iBAAiB,MAErG,EAAW,MAAM,EAAI,CACvB,OAAQ,MACR,IAAK,IAGL,EAAQ,EAAS,KAAK,KAAK,MAAM,EAAG,GAAO,IAAK,IAAU,CAC1D,MAAO,EAAK,MACZ,KAAM,GAAG,IAAU,EAAK,MACxB,YAAa,EAAK,OAClB,OAAQ,EAAK,YAAY,YACzB,QAAS,GAAW,EAAK,aAAe,OAAO,SAAS,EAAK,gBAAkB,KAC/E,SAAU,CAAC,GAAI,EAAK,UAAU,MAAM,MAAQ,GAAK,EAAK,eAAiB,EAAK,aA0BhF,MAvBA,GAAQ,MAAM,QAAQ,IAClB,EAAM,IAAK,GACP,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAM,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAGR,EAAU,EAAK,EAAe,MAUpC,OARA,EAAQ,sBAAsB,SAC9B,EAAQ,iBAAiB,SAEzB,EAAK,YAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACtE,OAAQ,EAAQ,gBAAgB,QAAU,EAAQ,6BAA6B,OAC/E,YAAa,EAAQ,sBAAsB,SAGxC,MAKZ,CACH,MAAO,UAAU,EAAI,GAAI,QACzB,KAAM,EACN,KAAM"}