{"version":3,"file":"news-D4V_rRm1.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/chaping/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst titles = {\r\n    0: '全部',\r\n    15: '直播',\r\n    3: '科技新鲜事',\r\n    7: '互联网槽点',\r\n    5: '趣味科技',\r\n    6: 'DEBUG TIME',\r\n    1: '游戏',\r\n    8: '视频',\r\n    9: '公里每小时',\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/news/:caty?',\r\n    categories: ['new-media'],\r\n    example: '/chaping/news/15',\r\n    parameters: { caty: '分类，默认为全部资讯' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '资讯',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `| 编号 | 分类       |\r\n| ---- | ---------- |\r\n| 15   | 直播       |\r\n| 3    | 科技新鲜事 |\r\n| 7    | 互联网槽点 |\r\n| 5    | 趣味科技   |\r\n| 6    | DEBUG TIME |\r\n| 1    | 游戏       |\r\n| 8    | 视频       |\r\n| 9    | 公里每小时 |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const caty = ctx.req.param('caty') ?? '';\r\n\r\n    const targetUrl = `https://chaping.cn/news?cate=${caty}`;\r\n    const currentUrl = `https://chaping.cn/api/official/information/news?page=1&limit=16&cate=${caty}`;\r\n    const apiResponse = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const list = apiResponse.data.data.map((item) => ({\r\n        title: item.title,\r\n        link: `https://chaping.cn/news/${item.id}`,\r\n        pubDate: parseDate(item.time_publish_timestamp * 1000),\r\n    }));\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const detailResponse = await got({\r\n                    method: 'get',\r\n                    url: item.link,\r\n                });\r\n                const content = JSON.parse(detailResponse.data.match(/\"current\":(.*?),\"optionsList\":/)[1]);\r\n\r\n                item.description = content.content;\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `差评资讯 - ${titles[ctx.req.param('caty') === '' ? 0 : ctx.req.param('caty')]}`,\r\n        link: targetUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"yUAKA,MAAM,EAAS,CACX,EAAG,KACH,GAAI,KACJ,EAAG,QACH,EAAG,QACH,EAAG,OACH,EAAG,aACH,EAAG,KACH,EAAG,KACH,EAAG,SAGMA,EAAe,CACxB,KAAM,eACN,WAAY,CAAC,aACb,QAAS,mBACT,WAAY,CAAE,KAAM,cACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,KACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;;;;mBAYjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,GAEhC,EAAY,gCAAgC,IAC5C,EAAa,yEAAyE,IACtF,EAAc,MAAMC,EAAI,CAC1B,OAAQ,MACR,IAAK,IAGH,EAAO,EAAY,KAAK,KAAK,IAAK,IAAU,CAC9C,MAAO,EAAK,MACZ,KAAM,2BAA2B,EAAK,KACtC,QAAS,EAAU,EAAK,uBAAyB,QAG/C,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAiB,MAAMD,EAAI,CAC7B,OAAQ,MACR,IAAK,EAAK,OAER,EAAU,KAAK,MAAM,EAAe,KAAK,MAAM,kCAAkC,IAIvF,MAFA,GAAK,YAAc,EAAQ,QAEpB,MAKnB,MAAO,CACH,MAAO,UAAU,EAAO,EAAI,IAAI,MAAM,UAAY,GAAK,EAAI,EAAI,IAAI,MAAM,WACzE,KAAM,EACN,KAAM"}