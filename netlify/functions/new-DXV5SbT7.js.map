{"version":3,"file":"new-DXV5SbT7.js","names":["route: Route","InvalidParameterError","got","title","link","element","description"],"sources":["../../lib/routes/dlsite/new.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nconst host = 'https://www.dlsite.com';\r\nconst infos = {\r\n    // 全年齢向け\r\n    home: {\r\n        type: 'home',\r\n        name: '「DLsite 同人」',\r\n        url: '/home/new',\r\n    },\r\n    comic: {\r\n        type: 'comic',\r\n        name: '「DLsite コミック」',\r\n        url: '/comic/new',\r\n    },\r\n    soft: {\r\n        type: 'soft',\r\n        name: '「DLsite PCソフト」',\r\n        url: '/soft/new',\r\n    },\r\n    // 成人向け( R18 )\r\n    maniax: {\r\n        type: 'maniax',\r\n        name: '「DLsite 同人 - R18」',\r\n        url: '/maniax/new',\r\n    },\r\n    books: {\r\n        type: 'books',\r\n        name: '「DLsite 成年コミック - R18」',\r\n        url: '/books/new',\r\n    },\r\n    pro: {\r\n        type: 'pro',\r\n        name: '「DLsite 美少女ゲーム」',\r\n        url: '/pro/new',\r\n    },\r\n    // 女性向け\r\n    girls: {\r\n        type: 'girls',\r\n        name: '「DLsite 乙女」',\r\n        url: '/girls/new',\r\n    },\r\n    bl: {\r\n        type: 'bl',\r\n        name: '「DLsite BL」',\r\n        url: '/bl/new',\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/new/:type',\r\n    categories: ['anime'],\r\n    view: ViewType.Articles,\r\n    example: '/dlsite/new/home',\r\n    parameters: {\r\n        type: {\r\n            description: '类型',\r\n            options: Object.values(infos).map((info) => ({ value: info.type, label: info.name })),\r\n        },\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'Current Release',\r\n    maintainers: ['cssxsh'],\r\n    handler,\r\n    description: `| Doujin | Comics | PC Games | Doujin (R18) | Adult Comics | H Games | Otome | BL |\r\n| ------ | ------ | -------- | ------------ | ------------ | ------- | ----- | -- |\r\n| home   | comic  | soft     | maniax       | books        | pro     | girls | bl |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const info = infos[ctx.req.param('type')];\r\n    // 判断参数是否合理\r\n    if (info === undefined) {\r\n        throw new InvalidParameterError('不支持指定类型！');\r\n    }\r\n\r\n    const link = info.url.slice(1);\r\n\r\n    const response = await got(new URL(link, host), {\r\n        method: 'GET',\r\n    });\r\n    const data = response.data;\r\n    const $ = load(data);\r\n\r\n    const title = $('title').text();\r\n    const description = $('meta[name=\"description\"]').attr('content');\r\n    const list = $('.n_worklist_item');\r\n    const dateText = $('.work_update')\r\n        .text()\r\n        .trim()\r\n        .replaceAll(/（.*）/g, '');\r\n    const pubDate = parseDate(dateText, 'YYYY年M月D日');\r\n    const item = list.toArray().map((element) => {\r\n        const title = $('.work_name', element).text();\r\n        const link = $('.work_name > a', element).attr('href');\r\n        // 使链接\r\n        $('a', element).each((_index, element) => {\r\n            $(element).attr('target', '_blank');\r\n        });\r\n        const description = $(element).html();\r\n        const arr = $('.search_tag', element);\r\n        const category = $('a', arr)\r\n            .toArray()\r\n            .map((a) => $(a).text());\r\n        const author = $('.maker_name', element).text();\r\n\r\n        const signle = {\r\n            title,\r\n            link,\r\n            description,\r\n            category,\r\n            author,\r\n            pubDate,\r\n        };\r\n        return signle;\r\n    });\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        description,\r\n        language: 'ja-jp',\r\n        item,\r\n    };\r\n}\r\n"],"mappings":"+aAMA,MACM,EAAQ,CAEV,KAAM,CACF,KAAM,OACN,KAAM,cACN,IAAK,aAET,MAAO,CACH,KAAM,QACN,KAAM,gBACN,IAAK,cAET,KAAM,CACF,KAAM,OACN,KAAM,iBACN,IAAK,aAGT,OAAQ,CACJ,KAAM,SACN,KAAM,oBACN,IAAK,eAET,MAAO,CACH,KAAM,QACN,KAAM,wBACN,IAAK,cAET,IAAK,CACD,KAAM,MACN,KAAM,kBACN,IAAK,YAGT,MAAO,CACH,KAAM,QACN,KAAM,cACN,IAAK,cAET,GAAI,CACA,KAAM,KACN,KAAM,cACN,IAAK,YAIAA,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,SACb,KAAM,EAAS,SACf,QAAS,mBACT,WAAY,CACR,KAAM,CACF,YAAa,KACb,QAAS,OAAO,OAAO,GAAO,IAAK,IAAU,CAAE,MAAO,EAAK,KAAM,MAAO,EAAK,UAGrF,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,kBACN,YAAa,CAAC,UACd,UACA,YAAa;;sFAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAM,EAAI,IAAI,MAAM,SAEjC,GAAI,IAAS,IAAA,GACT,MAAM,IAAIC,EAAsB,YAGpC,IAAM,EAAO,EAAK,IAAI,MAAM,GAEtB,EAAW,MAAMC,EAAI,IAAI,IAAI,EAAM,0BAAO,CAC5C,OAAQ,QAEN,EAAO,EAAS,KAChB,EAAI,EAAK,GAET,EAAQ,EAAE,SAAS,OACnB,EAAc,EAAE,4BAA4B,KAAK,WACjD,EAAO,EAAE,oBACT,EAAW,EAAE,gBACd,OACA,OACA,WAAW,QAAS,IACnB,EAAU,EAAU,EAAU,aAC9B,EAAO,EAAK,UAAU,IAAK,GAAY,CACzC,IAAMC,EAAQ,EAAE,aAAc,GAAS,OACjCC,EAAO,EAAE,iBAAkB,GAAS,KAAK,QAE/C,EAAE,IAAK,GAAS,MAAM,EAAQ,IAAY,CACtC,EAAEC,GAAS,KAAK,SAAU,YAE9B,IAAMC,EAAc,EAAE,GAAS,OACzB,EAAM,EAAE,cAAe,GACvB,EAAW,EAAE,IAAK,GACnB,UACA,IAAK,GAAM,EAAE,GAAG,QACf,EAAS,EAAE,cAAe,GAAS,OAEnC,EAAS,CACX,MAAA,EACA,KAAA,EACA,YAAA,EACA,WACA,SACA,WAEJ,OAAO,IAGX,MAAO,CACH,QACA,OACA,cACA,SAAU,QACV"}