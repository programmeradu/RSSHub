{"version":3,"file":"jwc-BcFCOhSl.js","names":["got","route: Route","got","cache"],"sources":["../../lib/routes/njnu/jwc/utils.ts","../../lib/routes/njnu/jwc/jwc.ts"],"sourcesContent":["import got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\n// 专门定义一个function用于加载文章内容\r\nasync function loadContent(link) {\r\n    // 异步请求文章\r\n    const response = await got.get(link, {\r\n        https: {\r\n            rejectUnauthorized: false,\r\n        },\r\n    });\r\n    // 加载文章内容\r\n    const $ = load(response.data);\r\n    const dateStr = $('span+ span').text();\r\n    // 解析日期\r\n    const pubDate = timezone(parseDate(dateStr, 'YYYY-MM-DD', 'zh-cn'), +8);\r\n    // 提取内容\r\n    const description = $('form > div').html();\r\n\r\n    // 返回解析的结果\r\n    return { description, pubDate };\r\n}\r\n\r\nconst ProcessFeed = (list, caches) => {\r\n    const host = 'http://jwc.njnu.edu.cn/';\r\n\r\n    // 使用 Promise.all() 进行 async 并发\r\n    return Promise.all(\r\n        // 遍历每一篇文章\r\n        list.map(async (item) => {\r\n            const $ = load(item);\r\n\r\n            const $title = $('a');\r\n            // 还原相对链接为绝对链接\r\n            const itemUrl = new URL($title.attr('href'), host);\r\n\r\n            // 列表上提取到的信息\r\n            const single = {\r\n                title: $title.text(),\r\n                link: itemUrl,\r\n                author: '教务处',\r\n                guid: itemUrl,\r\n            };\r\n\r\n            // 使用tryGet方法从缓存获取内容。\r\n            // 当缓存中无法获取到链接内容的时候，则使用load方法加载文章内容。\r\n            const other = await caches.tryGet(itemUrl, () => loadContent(itemUrl));\r\n\r\n            // 合并解析后的结果集作为该篇文章最终的输出结果\r\n            return { ...single, ...other };\r\n        })\r\n    );\r\n};\r\n\r\nexport { ProcessFeed };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { ProcessFeed } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/jwc/:type',\r\n    categories: ['university'],\r\n    example: '/njnu/jwc/xstz',\r\n    parameters: { type: '分类名' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '教务通知',\r\n    maintainers: ['Shujakuinkuraudo'],\r\n    handler,\r\n    description: `| 教师通知 | 新闻动态 | 学生通知 |\r\n| -------- | -------- | -------- |\r\n| jstz     | xwdt     | xstz     |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const type = ctx.req.param('type');\r\n    let title, path;\r\n    switch (type) {\r\n        case 'jstz':\r\n            title = '教师通知';\r\n            path = 'jstz.htm';\r\n            break;\r\n        case 'xwdt':\r\n            title = '新闻动态';\r\n            path = 'xwdt.htm';\r\n            break;\r\n        case 'xstz':\r\n            title = '学生通知';\r\n            path = 'xstz.htm';\r\n    }\r\n    const base = 'http://jwc.njnu.edu.cn/index/' + path;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: base,\r\n        https: {\r\n            rejectUnauthorized: false,\r\n        },\r\n    });\r\n\r\n    const $ = load(response.data);\r\n\r\n    const list = $('.list_txt a').toArray();\r\n\r\n    const result = await ProcessFeed(list, cache);\r\n\r\n    return {\r\n        title: '南京师范大学教务处 - ' + title,\r\n        link: 'http://jwc.njnu.edu.cn/',\r\n        description: '南京师范大学教务处',\r\n        item: result,\r\n    };\r\n}\r\n"],"mappings":"0ZAMA,eAAe,EAAY,EAAM,CAE7B,IAAM,EAAW,MAAME,EAAI,IAAI,EAAM,CACjC,MAAO,CACH,mBAAoB,MAItB,EAAI,EAAK,EAAS,MAClB,EAAU,EAAE,cAAc,OAE1B,EAAU,EAAS,EAAU,EAAS,aAAc,SAAU,GAE9D,EAAc,EAAE,cAAc,OAGpC,MAAO,CAAE,cAAa,WAG1B,MAAM,GAAe,EAAM,IAIhB,QAAQ,IAEX,EAAK,IAAI,KAAO,IAAS,CACrB,IAAM,EAAI,EAAK,GAET,EAAS,EAAE,KAEX,EAAU,IAAI,IAAI,EAAO,KAAK,QAAS,2BAGvC,EAAS,CACX,MAAO,EAAO,OACd,KAAM,EACN,OAAQ,MACR,KAAM,GAKJ,EAAQ,MAAM,EAAO,OAAO,MAAe,EAAY,IAG7D,MAAO,CAAE,GAAG,EAAQ,GAAG,MC7CtBD,EAAe,CACxB,KAAM,aACN,WAAY,CAAC,cACb,QAAS,iBACT,WAAY,CAAE,KAAM,OACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,oBACd,UACA,YAAa;;qCAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAO,EAAI,IAAI,MAAM,QACvB,EAAO,EACX,OAAQ,EAAR,CACI,IAAK,OACD,EAAQ,OACR,EAAO,WACP,MACJ,IAAK,OACD,EAAQ,OACR,EAAO,WACP,MACJ,IAAK,OACD,EAAQ,OACR,EAAO,WAEf,IAAM,EAAO,gCAAkC,EAEzC,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,EACL,MAAO,CACH,mBAAoB,MAItB,EAAI,EAAK,EAAS,MAElB,EAAO,EAAE,eAAe,UAExB,EAAS,MAAM,EAAY,EAAMC,GAEvC,MAAO,CACH,MAAO,eAAiB,EACxB,KAAM,0BACN,YAAa,YACb,KAAM"}