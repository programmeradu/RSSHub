{"version":3,"file":"usr-videos-D4CrtzP9.js","names":[],"sources":["../../lib/routes/vimeo/usr-videos.ts"],"sourcesContent":["import { Route, ViewType } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/user/:username/:cat?',\r\n    categories: ['social-media'],\r\n    view: ViewType.Videos,\r\n    example: '/vimeo/user/filmsupply/picks',\r\n    parameters: {\r\n        username: 'In this example [https://vimeo.com/filmsupply](https://vimeo.com/filmsupply)  is `filmsupply`',\r\n        cat: \"deafult for all latest videos, others categories in this example such as `Docmentary`, `Narrative`, `Drama`. Set `picks` for promote orders, just orderd like web page. When `picks` added, published date won't show up\",\r\n    },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'User Profile',\r\n    maintainers: ['MisteryMonster'],\r\n    handler,\r\n    description: `::: tip Special category name attention\r\n  Some of the categories contain slash like \\`3D/CG\\` , must change the slash \\`/\\` to the vertical bar\\`|\\`.\r\n:::`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const tokenresponse = await got({\r\n        method: 'get',\r\n        url: 'https://vimeo.com/_rv/viewer',\r\n    });\r\n    const VimeoAuthorization = tokenresponse.data.jwt;\r\n\r\n    const { username, cat } = ctx.req.param();\r\n\r\n    const profileresponse = await got({\r\n        method: 'get',\r\n        url: `https://api.vimeo.com/users/${username}?fields=name,gender,bio,uri,link,categories&fetch_user_profile=1`,\r\n        headers: {\r\n            Authorization: `jwt ${VimeoAuthorization}`,\r\n        },\r\n    });\r\n\r\n    const profilesjs = profileresponse.data;\r\n    const catjs = profileresponse.data.categories;\r\n\r\n    let catword;\r\n    if (cat && catjs.length > 0) {\r\n        for (const catj of catjs) {\r\n            if (decodeURIComponent(cat).replaceAll('|', '/') === catj.name) {\r\n                catword = catj.word;\r\n            }\r\n        }\r\n    }\r\n\r\n    let urlfilter = `&filter=category&filter_category=${catword}`;\r\n    if (!cat) {\r\n        urlfilter = '';\r\n    }\r\n    if (!catword && cat && cat !== 'picks') {\r\n        return '';\r\n    }\r\n    const picked = cat && cat === 'picks';\r\n\r\n    const Vimeocat = `${profilesjs.uri}/videos?fields=name,uri,description,created_time&include_videos=1&page=1&per_page=10${urlfilter}`;\r\n    const Vimeoallpicks = `/users/${username}/profile_sections?fields=videos.data.clip.name,videos.data.clip.uri,videos.data.clip.description,videos.data.clip.created_time&include_videos=1&badge=1&page=1&per_page=10`;\r\n\r\n    const contentresponse = await got({\r\n        method: 'get',\r\n        url: `https://api.vimeo.com${picked ? Vimeoallpicks : Vimeocat}`,\r\n        headers: {\r\n            Authorization: `jwt ${VimeoAuthorization}`,\r\n        },\r\n    });\r\n    const vimeojs = picked ? contentresponse.data.data[0].videos.data : contentresponse.data.data;\r\n\r\n    return {\r\n        title: `${profilesjs.name} ${catword ? cat.replace('|', '/') : ''} ${picked ? 'picks' : ''} | Vimeo `,\r\n        link: profilesjs.link,\r\n        description: profilesjs.bio,\r\n\r\n        item: vimeojs.map((item) => {\r\n            const vdescription = picked ? item.clip.description : item.description;\r\n\r\n            return {\r\n                title: picked ? item.clip.name : item.name,\r\n                description: art(path.join(__dirname, 'templates/description.art'), {\r\n                    videoUrl: picked ? item.clip.uri.replace('/videos', '') : item.uri.replace('/videos', ''),\r\n                    vdescription: vdescription ? vdescription.replaceAll('\\n', '<br>') : '',\r\n                }),\r\n                pubDate: parseDate(picked || cat ? '' : item.created_time),\r\n                link: `https://vimeo.com${picked ? item.clip.uri.replace('videos/', '') : item.uri.replace('videos/', '')}`,\r\n                author: profilesjs.name,\r\n            };\r\n        }),\r\n    };\r\n}\r\n"],"mappings":"obAOA,MAAa,EAAe,CACxB,KAAM,wBACN,WAAY,CAAC,gBACb,KAAM,EAAS,OACf,QAAS,+BACT,WAAY,CACR,SAAU,gGACV,IAAK,4NAET,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,eACN,YAAa,CAAC,kBACd,UACA,YAAa,yJAKjB,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAgB,MAAM,EAAI,CAC5B,OAAQ,MACR,IAAK,iCAEH,EAAqB,EAAc,KAAK,IAExC,CAAE,WAAU,OAAQ,EAAI,IAAI,QAE5B,EAAkB,MAAM,EAAI,CAC9B,OAAQ,MACR,IAAK,+BAA+B,EAAS,kEAC7C,QAAS,CACL,cAAe,OAAO,OAIxB,EAAa,EAAgB,KAC7B,EAAQ,EAAgB,KAAK,WAE/B,EACJ,GAAI,GAAO,EAAM,OAAS,MACjB,IAAM,KAAQ,EACX,mBAAmB,GAAK,WAAW,IAAK,OAAS,EAAK,OACtD,EAAU,EAAK,MAK3B,IAAI,EAAY,oCAAoC,IAIpD,GAHK,IACD,EAAY,IAEZ,CAAC,GAAW,GAAO,IAAQ,QAC3B,MAAO,GAEX,IAAM,EAAS,GAAO,IAAQ,QAExB,EAAW,GAAG,EAAW,IAAI,sFAAsF,IACnH,EAAgB,UAAU,EAAS,4KAEnC,EAAkB,MAAM,EAAI,CAC9B,OAAQ,MACR,IAAK,wBAAwB,EAAS,EAAgB,IACtD,QAAS,CACL,cAAe,OAAO,OAGxB,EAAU,EAAS,EAAgB,KAAK,KAAK,GAAG,OAAO,KAAO,EAAgB,KAAK,KAEzF,MAAO,CACH,MAAO,GAAG,EAAW,KAAK,GAAG,EAAU,EAAI,QAAQ,IAAK,KAAO,GAAG,GAAG,EAAS,QAAU,GAAG,WAC3F,KAAM,EAAW,KACjB,YAAa,EAAW,IAExB,KAAM,EAAQ,IAAK,GAAS,CACxB,IAAM,EAAe,EAAS,EAAK,KAAK,YAAc,EAAK,YAE3D,MAAO,CACH,MAAO,EAAS,EAAK,KAAK,KAAO,EAAK,KACtC,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,SAAU,EAAS,EAAK,KAAK,IAAI,QAAQ,UAAW,IAAM,EAAK,IAAI,QAAQ,UAAW,IACtF,aAAc,EAAe,EAAa,WAAW;EAAM,QAAU,KAEzE,QAAS,EAAU,GAAU,EAAM,GAAK,EAAK,cAC7C,KAAM,oBAAoB,EAAS,EAAK,KAAK,IAAI,QAAQ,UAAW,IAAM,EAAK,IAAI,QAAQ,UAAW,MACtG,OAAQ,EAAW"}