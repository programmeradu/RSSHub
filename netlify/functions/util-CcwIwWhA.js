import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import{cache_default as n}from"./cache-kimkMTWJ.js";import{art as r}from"./render-CxhTJIsl.js";import{parseDate as i}from"./parse-date-Bgabdhlb.js";import{ofetch_default as a}from"./ofetch-Bzt0BXUH.js";import o from"node:path";import{load as s}from"cheerio";t();const c=`https://www.tmtpost.com`,l=`https://api.tmtpost.com`,u=new URL(`v1/posts/`,l).href,d={"app-version":`web1.0`},f=async(t,l,f,p)=>{let m=await a(f,{query:{limit:t,...l},headers:d}),h=await a(p),g=s(h),_=g(`html`).attr(`lang`)??`zh-CN`,v=[];v=m.data.slice(0,t).map(t=>{let n=t.title,a=r(o.join(e,`templates/description-d37ebf7e.art`),{intro:t.summary}),s=t.time_published,c=t.share_link,l=t.guid,u=t.thumb_image?.original?.url,d=t.updated??s,f={title:n,description:a,pubDate:s?i(s,`X`):void 0,link:c,guid:l,id:l,content:{html:a,text:t.content??a},image:u,banner:u,updated:d?i(d,`X`):void 0,language:_};return f}),v=(await Promise.all(v.map(t=>t.link?n.tryGet(t.link,async()=>{let n=new URL(t.guid,u).href,s=await a(n,{query:{fields:[`authors`,`tags`,`featured_image`,`categories`,`stock_list`,`big_plate`,`concept_plate`,`plate`,`plate_list`,`share_link`].join(`;`)},headers:d}),l=s.data;if(!l)return t;let f=l.title,p=r(o.join(e,`templates/description-d37ebf7e.art`),{intro:l.summary,description:l.main}),m=l.time_published,h=l.share_link,g=[...new Set([...l.categories??[],...l.stock_list??[],...l.big_plate??[],...l.concept_plate??[],...l.plate??[],...l.plate_list??[],...l.tags??[]].map(e=>e.title??e.name??e.tag).filter(Boolean))],v=l.authors?.map(e=>({name:e.username,url:new URL(`user/${e.guid}`,c).href,avatar:e.avatar})),y=`tmtpost-${l.post_guid}`,b=l.images?.[0]?.url,x=l.time_updated,S={title:f,description:p,pubDate:m?i(m,`X`):void 0,link:h??t.link,category:g,author:v,guid:y,id:y,content:{html:p,text:p},image:b,banner:b,updated:x?i(x,`X`):void 0,language:_},C=l.audio;if(C){let e=`audio/${C.split(/\./).pop()}`,t=l.duration;S={...S,enclosure_url:C,enclosure_type:e,enclosure_title:f,enclosure_length:void 0,itunes_duration:t,itunes_item_image:b}}let w={};if(l.full_size_images??l.images){let e=l.full_size_images??l.images;for(let t of e){let e=t.url??t;if(!e)continue;let n=`image`,r=Object.values(w).filter(e=>e.medium===n).length+1,i=`${n}${r}`;w[i]={url:e,medium:n,title:f,thumbnail:t.thumbnail??e}}}return S={...S,media:w},{...t,...S}}):t))).filter(e=>!0);let y=g(`title`).text(),b=y.split(/-/).pop();return{title:y,description:g(`meta[property="og:description"]`).attr(`content`),link:p,item:v,allowEmpty:!0,image:g(`meta[property="og:image"]`).attr(`content`),author:y.split(/-/).pop(),language:_,itunes_author:b,itunes_category:`Technology`,id:p}};export{l as apiBaseUrl,c as baseUrl,f as processItems};
//# sourceMappingURL=util-CcwIwWhA.js.map