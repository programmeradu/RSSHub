{"version":3,"file":"cisia-BCagMedC.js","names":["got","cache","route: Route"],"sources":["../../lib/routes/cisia/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const handler = async (ctx) => {\r\n    const { id = '9' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 20;\r\n\r\n    const domain = 'www.cisia.org';\r\n    const rootUrl = `http://${domain}`;\r\n    const currentUrl = new URL(`site/term/${id}.html`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    let items = $('ul.list_first li')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('a');\r\n\r\n            return {\r\n                title: a.text(),\r\n                pubDate: parseDate(item.find('span.time').text()),\r\n                link: new URL(a.prop('href'), rootUrl).href,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                if (!/^https?:\\/\\/www\\.cisia\\.org(\\/[^\\s]*)?$/.test(item.link)) {\r\n                    return item;\r\n                }\r\n\r\n                const { data: detailResponse } = await got(item.link);\r\n\r\n                const $$ = load(detailResponse);\r\n\r\n                const title = $$('div.TextTitle').text();\r\n                const description = $$('div.NewsText').html();\r\n                const pubDate = $$('div.shar')\r\n                    .text()\r\n                    .match(/(\\d{4}-\\d{2}-\\d{2})/)?.[1];\r\n\r\n                item.title = title;\r\n                item.description = description;\r\n                item.pubDate = pubDate ? parseDate(pubDate) : item.pubDate;\r\n                item.author = $$('meta[name=\"Description\"]').prop('content');\r\n                item.content = {\r\n                    html: description,\r\n                    text: $$('div.NewsText').text(),\r\n                };\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    const image = new URL($('div.logo img').prop('src'), rootUrl).href;\r\n\r\n    return {\r\n        title: $('title').text(),\r\n        description: $('meta[name=\"Description\"]').prop('content'),\r\n        link: currentUrl,\r\n        item: items,\r\n        allowEmpty: true,\r\n        image,\r\n        author: $('meta[name=\"Keywords\"]').prop('content'),\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/:id?',\r\n    name: '栏目',\r\n    url: 'www.cisia.org',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    example: '/cisia/9',\r\n    parameters: { id: '栏目 id，默认为 `9`，即协会动态，可在对应分类页 URL 中找到' },\r\n    description: `::: tip\r\n  若订阅 [市场信息](http://www.cisia.org/site/term/12.html)，网址为 \\`http://www.cisia.org/site/term/12.html\\`。截取 \\`https://www.cisia.org/site/term/\\` 到末尾 \\`.html\\` 的部分 \\`12\\` 作为参数填入，此时路由为 [\\`/cisia/12\\`](https://rsshub.app/cisia/12)。\r\n:::\r\n\r\n<details>\r\n<summary>更多分类</summary>\r\n\r\n#### [分支机构信息](http://www.cisia.org/site/term/14.html)\r\n\r\n| [企业动态](http://www.cisia.org/site/term/17.html) | [产品展示](http://www.cisia.org/site/term/18.html) |\r\n| -------------------------------------------------- | -------------------------------------------------- |\r\n| [17](https://rsshub.app/cisia/17)                  | [18](https://rsshub.app/cisia/18)                  |\r\n\r\n#### [新闻中心](http://www.cisia.org/site/term/8.html)\r\n\r\n| [协会动态](http://www.cisia.org/site/term/9.html) | [行业新闻](http://www.cisia.org/site/term/10.html) | [通知公告](http://www.cisia.org/site/term/11.html) | [市场信息](http://www.cisia.org/site/term/12.html) |\r\n| ------------------------------------------------- | -------------------------------------------------- | -------------------------------------------------- | -------------------------------------------------- |\r\n| [9](https://rsshub.app/cisia/9)                   | [10](https://rsshub.app/cisia/10)                  | [11](https://rsshub.app/cisia/11)                  | [12](https://rsshub.app/cisia/12)                  |\r\n\r\n#### [政策法规](http://www.cisia.org/site/term/19.html)\r\n\r\n| [宏观聚焦](http://www.cisia.org/site/term/20.html) | [技术园区](http://www.cisia.org/site/term/396.html) |\r\n| -------------------------------------------------- | --------------------------------------------------- |\r\n| [20](https://rsshub.app/cisia/20)                  | [396](https://rsshub.app/cisia/396)                 |\r\n\r\n#### [合作交流](http://www.cisia.org/site/term/22.html)\r\n\r\n| [国际交流](http://www.cisia.org/site/term/23.html) | [行业交流](http://www.cisia.org/site/term/24.html) | [企业调研](http://www.cisia.org/site/term/25.html) | [会展信息](http://www.cisia.org/site/term/84.html) | [宣传专题](http://www.cisia.org/site/term/430.html) |\r\n| -------------------------------------------------- | -------------------------------------------------- | -------------------------------------------------- | -------------------------------------------------- | --------------------------------------------------- |\r\n| [23](https://rsshub.app/cisia/23)                  | [24](https://rsshub.app/cisia/24)                  | [25](https://rsshub.app/cisia/25)                  | [84](https://rsshub.app/cisia/84)                  | [430](https://rsshub.app/cisia/430)                 |\r\n\r\n#### [党建工作](http://www.cisia.org/site/term/26.html)\r\n\r\n| [党委文件](http://www.cisia.org/site/term/27.html) | [学习园地](http://www.cisia.org/site/term/28.html) | [两会专题](http://www.cisia.org/site/term/443.html) |\r\n| -------------------------------------------------- | -------------------------------------------------- | --------------------------------------------------- |\r\n| [27](https://rsshub.app/cisia/27)                  | [28](https://rsshub.app/cisia/28)                  | [443](https://rsshub.app/cisia/443)                 |\r\n\r\n#### [网上服务平台](http://www.cisia.org/site/term/29.html)\r\n\r\n| [前沿科技](http://www.cisia.org/site/term/31.html) | [新材料新技术](http://www.cisia.org/site/term/133.html) | [文件共享](http://www.cisia.org/site/term/30.html) |\r\n| -------------------------------------------------- | ------------------------------------------------------- | -------------------------------------------------- |\r\n| [31](https://rsshub.app/cisia/31)                  | [133](https://rsshub.app/cisia/133)                     | [30](https://rsshub.app/cisia/30)                  |\r\n\r\n#### [会员社区](http://www.cisia.org/site/term/34.html)\r\n\r\n| [会员分布](http://www.cisia.org/site/term/35.html) | [会员风采](http://www.cisia.org/site/term/68.html) |\r\n| -------------------------------------------------- | -------------------------------------------------- |\r\n| [35](https://rsshub.app/cisia/35)                  | [68](https://rsshub.app/cisia/68)                  |\r\n\r\n</details>\r\n    `,\r\n    categories: ['government'],\r\n\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportRadar: true,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['www.cisia.org/site/term/:id'],\r\n            target: (params) => {\r\n                const id = params.id.replace(/\\.html/, '');\r\n\r\n                return id ? `/${id}` : '';\r\n            },\r\n        },\r\n        {\r\n            title: '分支机构信息 - 企业动态',\r\n            source: ['www.cisia.org/site/term/17.html'],\r\n            target: '/17',\r\n        },\r\n        {\r\n            title: '分支机构信息 - 产品展示',\r\n            source: ['www.cisia.org/site/term/18.html'],\r\n            target: '/18',\r\n        },\r\n        {\r\n            title: '新闻中心 - 协会动态',\r\n            source: ['www.cisia.org/site/term/9.html'],\r\n            target: '/9',\r\n        },\r\n        {\r\n            title: '新闻中心 - 行业新闻',\r\n            source: ['www.cisia.org/site/term/10.html'],\r\n            target: '/10',\r\n        },\r\n        {\r\n            title: '新闻中心 - 通知公告',\r\n            source: ['www.cisia.org/site/term/11.html'],\r\n            target: '/11',\r\n        },\r\n        {\r\n            title: '新闻中心 - 市场信息',\r\n            source: ['www.cisia.org/site/term/12.html'],\r\n            target: '/12',\r\n        },\r\n        {\r\n            title: '政策法规 - 宏观聚焦',\r\n            source: ['www.cisia.org/site/term/20.html'],\r\n            target: '/20',\r\n        },\r\n        {\r\n            title: '政策法规 - 技术园区',\r\n            source: ['www.cisia.org/site/term/396.html'],\r\n            target: '/396',\r\n        },\r\n        {\r\n            title: '合作交流 - 国际交流',\r\n            source: ['www.cisia.org/site/term/23.html'],\r\n            target: '/23',\r\n        },\r\n        {\r\n            title: '合作交流 - 行业交流',\r\n            source: ['www.cisia.org/site/term/24.html'],\r\n            target: '/24',\r\n        },\r\n        {\r\n            title: '合作交流 - 企业调研',\r\n            source: ['www.cisia.org/site/term/25.html'],\r\n            target: '/25',\r\n        },\r\n        {\r\n            title: '合作交流 - 会展信息',\r\n            source: ['www.cisia.org/site/term/84.html'],\r\n            target: '/84',\r\n        },\r\n        {\r\n            title: '合作交流 - 宣传专题',\r\n            source: ['www.cisia.org/site/term/430.html'],\r\n            target: '/430',\r\n        },\r\n        {\r\n            title: '党建工作 - 党委文件',\r\n            source: ['www.cisia.org/site/term/27.html'],\r\n            target: '/27',\r\n        },\r\n        {\r\n            title: '党建工作 - 学习园地',\r\n            source: ['www.cisia.org/site/term/28.html'],\r\n            target: '/28',\r\n        },\r\n        {\r\n            title: '党建工作 - 两会专题',\r\n            source: ['www.cisia.org/site/term/443.html'],\r\n            target: '/443',\r\n        },\r\n        {\r\n            title: '网上服务平台 - 前沿科技',\r\n            source: ['www.cisia.org/site/term/31.html'],\r\n            target: '/31',\r\n        },\r\n        {\r\n            title: '网上服务平台 - 新材料新技术',\r\n            source: ['www.cisia.org/site/term/133.html'],\r\n            target: '/133',\r\n        },\r\n        {\r\n            title: '网上服务平台 - 文件共享',\r\n            source: ['www.cisia.org/site/term/30.html'],\r\n            target: '/30',\r\n        },\r\n        {\r\n            title: '会员社区 - 会员分布',\r\n            source: ['www.cisia.org/site/term/35.html'],\r\n            target: '/35',\r\n        },\r\n        {\r\n            title: '会员社区 - 会员风采',\r\n            source: ['www.cisia.org/site/term/68.html'],\r\n            target: '/68',\r\n        },\r\n    ],\r\n};\r\n"],"mappings":"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"}