{"version":3,"file":"publish-oZQJb-m3.js","names":[],"sources":["../../lib/routes/wmc-bj/publish.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport timezone from '@/utils/timezone';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/publish/:category{.+}?',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'CRA-Reanalysis/2m-Temperature/6-hour/index.html' } = ctx.req.param();\r\n\r\n    const rootUrl = 'http://www.wmc-bj.net';\r\n    const currentUrl = new URL(`publish/${category}`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    const title = $('title').text();\r\n    const author = 'World Meteorological Centre BeiJing';\r\n\r\n    const img = $('#imgpath');\r\n    const datetime = img.prop('data-time');\r\n    const categories = $('ol.breadcrumb li')\r\n        .slice(2)\r\n        .toArray()\r\n        .map((b) => $(b).text());\r\n\r\n    const items = [\r\n        {\r\n            title: `${datetime} ${title}`,\r\n            link: currentUrl,\r\n            description: art(path.join(__dirname, 'templates/description.art'), {\r\n                image: {\r\n                    src: img.prop('src').replace(/\\/medium\\//, '/'),\r\n                },\r\n            }),\r\n            category: categories,\r\n            guid: `${currentUrl}#${datetime}`,\r\n            pubDate: timezone(parseDate(/^[A-Za-z]{3}/.test(datetime) ? datetime.replace(/^\\w+/, '') : datetime, ['DD MMM HH:mm', 'MM/DD HH:mm']), +0),\r\n        },\r\n    ];\r\n\r\n    const image = 'http://image.nmc.cn/static/wmc/img/logo-cma.png';\r\n    const icon = $('link[rel=\"shortcut icon\"]').prop('href');\r\n\r\n    return {\r\n        item: items,\r\n        title,\r\n        link: currentUrl,\r\n        language: 'en',\r\n        image,\r\n        icon,\r\n        logo: icon,\r\n        subtitle: categories.join(' > '),\r\n        author,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"sdASA,MAAa,EAAe,CACxB,KAAM,0BACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,mDAAsD,EAAI,IAAI,QAG3E,EAAa,IAAI,IAAI,WAAW,IAAY,yBAAS,KAErD,CAAE,KAAM,GAAa,MAAM,EAAI,GAE/B,EAAI,EAAK,GAET,EAAQ,EAAE,SAAS,OAGnB,EAAM,EAAE,YACR,EAAW,EAAI,KAAK,aACpB,EAAa,EAAE,oBAChB,MAAM,GACN,UACA,IAAK,GAAM,EAAE,GAAG,QAEf,EAAQ,CACV,CACI,MAAO,GAAG,EAAS,GAAG,IACtB,KAAM,EACN,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,MAAO,CACH,IAAK,EAAI,KAAK,OAAO,QAAQ,aAAc,QAGnD,SAAU,EACV,KAAM,GAAG,EAAW,GAAG,IACvB,QAAS,EAAS,EAAU,eAAe,KAAK,GAAY,EAAS,QAAQ,OAAQ,IAAM,EAAU,CAAC,eAAgB,gBAAiB,KAKzI,EAAO,EAAE,6BAA6B,KAAK,QAEjD,MAAO,CACH,KAAM,EACN,QACA,KAAM,EACN,SAAU,KACV,wDACA,OACA,KAAM,EACN,SAAU,EAAW,KAAK,OAC1B,6CACA,WAAY"}