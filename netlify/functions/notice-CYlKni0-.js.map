{"version":3,"file":"notice-CYlKni0-.js","names":["got","cache","$","route: Route","parseList"],"sources":["../../lib/routes/hfut/xc/utils.ts","../../lib/routes/hfut/xc/notice.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nconst typeMap = {\r\n    tzgg: { name: 'tzgg', url: 'https://xc.hfut.edu.cn/1955/list.htm', root: 'https://xc.hfut.edu.cn', title: '合肥工业大学宣城校区 - 通知公告' },\r\n    gztz: { name: 'gztz', url: 'https://xc.hfut.edu.cn/gztz/list.htm', root: 'https://xc.hfut.edu.cn', title: '合肥工业大学宣城校区 - 院系动态 - 工作通知' },\r\n};\r\n\r\nconst commLink = 'https://xc.hfut.edu.cn/';\r\n\r\nconst parseList = async (ctx, type) => {\r\n    const link = typeMap[type].url;\r\n    const title = typeMap[type].title;\r\n\r\n    const response = await got(link);\r\n    const $ = load(response.data);\r\n\r\n    const resultList = await parseArticle($);\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        resultList,\r\n    };\r\n};\r\n\r\nasync function parseArticle($) {\r\n    const data = $('#wp_news_w6').find('li').toArray();\r\n\r\n    const items = data.map((item) => {\r\n        item = $(item);\r\n        const oriLink = item.find('a').attr('href');\r\n        let linkRes = oriLink;\r\n        if (!oriLink.startsWith('http')) {\r\n            linkRes = commLink + item.find('a').attr('href');\r\n        }\r\n        const pubDate = parseDate(item.find('.news_meta').text(), 'YYYY-MM-DD');\r\n\r\n        return {\r\n            title: item.find('a').attr('title'),\r\n            pubDate,\r\n            link: linkRes,\r\n        };\r\n    });\r\n\r\n    const resultItems = await Promise.all(\r\n        items.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                let description;\r\n                try {\r\n                    const response = await got(item.link);\r\n                    const $ = load(response.data);\r\n                    description = $('.wp_articlecontent').html() ?? $('.v_news_content').html() ?? item.link;\r\n                } catch {\r\n                    description = item.link;\r\n                }\r\n\r\n                return {\r\n                    title: item.title,\r\n                    link: item.link,\r\n                    description,\r\n                    pubDate: item.pubDate,\r\n                };\r\n            })\r\n        )\r\n    );\r\n\r\n    return resultItems;\r\n}\r\n\r\nexport default parseList;\r\n","import { Route } from '@/types';\r\nimport parseList from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/xc/notice/:type?',\r\n    categories: ['university'],\r\n    example: '/hfut/xc/notice/tzgg',\r\n    parameters: { type: '分类，见下表（默认为 `tzgg`)' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportRadar: true,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['xc.hfut.edu.cn'],\r\n        },\r\n    ],\r\n    name: '宣城校区通知',\r\n    maintainers: ['batemax'],\r\n    handler,\r\n    description: `| 通知公告(https://xc.hfut.edu.cn/1955/list.htm) | 院系动态-工作通知(https://xc.hfut.edu.cn/gztz/list.htm) |\r\n| ------------ | -------------- |\r\n| tzgg         | gztz           |`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    // set default router type\r\n    const type = ctx.req.param('type') ?? 'tzgg';\r\n\r\n    const { link, title, resultList } = await parseList(ctx, type);\r\n\r\n    return {\r\n        title,\r\n        link,\r\n        description: '合肥工业大学宣城校区 - 通知公告',\r\n        item: resultList,\r\n    };\r\n}\r\n"],"mappings":"wWAKA,MAAM,EAAU,CACZ,KAAM,CAAE,KAAM,OAAQ,IAAK,uCAAwC,KAAM,yBAA0B,MAAO,qBAC1G,KAAM,CAAE,KAAM,OAAQ,IAAK,uCAAwC,KAAM,yBAA0B,MAAO,6BAKxG,EAAY,MAAO,EAAK,IAAS,CACnC,IAAM,EAAO,EAAQ,GAAM,IACrB,EAAQ,EAAQ,GAAM,MAEtB,EAAW,MAAMA,EAAI,GACrB,EAAI,EAAK,EAAS,MAElB,EAAa,MAAM,EAAa,GAEtC,MAAO,CACH,QACA,OACA,eAIR,eAAe,EAAa,EAAG,CAC3B,IAAM,EAAO,EAAE,eAAe,KAAK,MAAM,UAEnC,EAAQ,EAAK,IAAK,GAAS,CAC7B,EAAO,EAAE,GACT,IAAM,EAAU,EAAK,KAAK,KAAK,KAAK,QAChC,EAAU,EACT,EAAQ,WAAW,UACpB,EAAU,0BAAW,EAAK,KAAK,KAAK,KAAK,SAE7C,IAAM,EAAU,EAAU,EAAK,KAAK,cAAc,OAAQ,cAE1D,MAAO,CACH,MAAO,EAAK,KAAK,KAAK,KAAK,SAC3B,UACA,KAAM,KAIR,EAAc,MAAM,QAAQ,IAC9B,EAAM,IAAK,GACPC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAI,EACJ,GAAI,CACA,IAAM,EAAW,MAAMD,EAAI,EAAK,MAC1BE,EAAI,EAAK,EAAS,MACxB,EAAcA,EAAE,sBAAsB,QAAUA,EAAE,mBAAmB,QAAU,EAAK,UAChF,CACJ,EAAc,EAAK,KAGvB,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EAAK,KACX,cACA,QAAS,EAAK,aAM9B,OAAO,EAGX,IAAA,EAAe,ECrEf,MAAaC,EAAe,CACxB,KAAM,oBACN,WAAY,CAAC,cACb,QAAS,uBACT,WAAY,CAAE,KAAM,sBACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,aAAc,GACd,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,oBAGjB,KAAM,SACN,YAAa,CAAC,WACd,UACA,YAAa;;oCAKjB,eAAe,EAAQ,EAAK,CAExB,IAAM,EAAO,EAAI,IAAI,MAAM,SAAW,OAEhC,CAAE,OAAM,QAAO,cAAe,MAAMC,EAAU,EAAK,GAEzD,MAAO,CACH,QACA,OACA,YAAa,oBACb,KAAM"}