{"version":3,"file":"apnic-BYiHG_ei.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/apnic/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nexport const route: Route = {\r\n    path: '/blog',\r\n    categories: ['blog'],\r\n    example: '/apnic/blog',\r\n    url: 'blog.apnic.net',\r\n    name: 'Blog',\r\n    maintainers: ['p3psi-boo'],\r\n    handler,\r\n};\r\n\r\nasync function handler() {\r\n    const baseUrl = 'https://blog.apnic.net';\r\n    const feedUrl = `${baseUrl}/feed/`;\r\n\r\n    const response = await got(feedUrl);\r\n    const $ = load(response.data, { xmlMode: true });\r\n\r\n    // 从 RSS XML 中直接提取文章信息\r\n    const list = $('item')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            return {\r\n                title: $item.find('title').text(),\r\n                link: $item.find('link').text(),\r\n                author: $item.find(String.raw`dc\\:creator`).text(),\r\n                category:\r\n                    $item\r\n                        .find('category')\r\n                        .text()\r\n                        .match(/>([^<]+)</)?.[1] || '',\r\n                pubDate: parseDate($item.find('pubDate').text()),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: articleData } = await got(item.link);\r\n                const $article = load(articleData);\r\n\r\n                // 获取文章正文内容\r\n                item.description = $article('.entry-content').html();\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: 'APNIC Blog',\r\n        link: baseUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"wWAOA,MAAaA,EAAe,CACxB,KAAM,QACN,WAAY,CAAC,QACb,QAAS,cACT,IAAK,iBACL,KAAM,OACN,YAAa,CAAC,aACd,WAGJ,eAAe,GAAU,CACrB,IAAM,EAAU,yBACV,EAAU,GAAG,EAAQ,QAErB,EAAW,MAAMC,EAAI,GACrB,EAAI,EAAK,EAAS,KAAM,CAAE,QAAS,KAGnC,EAAO,EAAE,QACV,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GAChB,MAAO,CACH,MAAO,EAAM,KAAK,SAAS,OAC3B,KAAM,EAAM,KAAK,QAAQ,OACzB,OAAQ,EAAM,KAAK,OAAO,GAAG,eAAe,OAC5C,SACI,EACK,KAAK,YACL,OACA,MAAM,eAAe,IAAM,GACpC,QAAS,EAAU,EAAM,KAAK,WAAW,WAI/C,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAM,GAAgB,MAAMD,EAAI,EAAK,MACvC,EAAW,EAAK,GAItB,MADA,GAAK,YAAc,EAAS,kBAAkB,OACvC,MAKnB,MAAO,CACH,MAAO,aACP,KAAM,EACN,KAAM"}