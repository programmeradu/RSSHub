{"version":3,"file":"channel-CT5yl8Ef.js","names":["parser","cache","got","route: Route","utils"],"sources":["../../lib/routes/ftchinese/utils.ts","../../lib/routes/ftchinese/channel.ts"],"sourcesContent":["import cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport parser from '@/utils/rss-parser';\r\nimport { load } from 'cheerio';\r\n\r\nconst ProcessFeed = (i, $, link) => {\r\n    const title = $('h1').text();\r\n    let content = $('div.story-container').eq(i);\r\n\r\n    // 处理封面图片\r\n    content.find('div.story-image > figure').each((_, e) => {\r\n        const src = `https://thumbor.ftacademy.cn/unsafe/1340x754/${e.attribs['data-url']}`;\r\n\r\n        $(`<img src=${src}>`).insertAfter(content.find('div.story-lead')[0]);\r\n    });\r\n\r\n    // 付费文章跳转\r\n    content.find('div#subscribe-now-container').each((_, e) => {\r\n        $(`<br/><p>此文章为付费文章，会员<a href='${link}'>请访问网站阅读</a>。</p>`).insertAfter(content.find('div.story-body')[0]);\r\n        $(e).remove();\r\n    });\r\n\r\n    // 获取作者\r\n    let author = '';\r\n    content.find('span.story-author > a').each((_, e) => {\r\n        author += `${$(e).text()} `;\r\n    });\r\n    author = author.trim();\r\n\r\n    // 去除头部主题, 头部重复标题, 冗余元数据, 植入广告, 植入 js, 社交分享按钮, 底部版权声明, 空白 DOM\r\n    content\r\n        .find(\r\n            'div.story-theme, h1.story-headline, div.story-byline, div.mpu-container-instory,script, div#story-action-placeholder, div.copyrightstatement-container, div.clearfloat, div.o-ads, h2.list-title, div.allcomments, div.logincomment, div.nologincomment'\r\n        )\r\n        .each((_, e) => {\r\n            $(e).remove();\r\n        });\r\n    content = content.html();\r\n\r\n    return { content, author, title };\r\n};\r\n\r\nconst getData = async ({ site = 'www', channel }) => {\r\n    let feed;\r\n\r\n    if (channel) {\r\n        channel = channel.toLowerCase();\r\n        channel = channel.split('-').join('/');\r\n\r\n        try {\r\n            feed = await parser.parseURL(`https://${site}.ftchinese.com/rss/${channel}`);\r\n        } catch {\r\n            return {\r\n                title: `FT 中文网 ${channel} 不存在`,\r\n                description: `FT 中文网 ${channel} 不存在`,\r\n            };\r\n        }\r\n    } else {\r\n        feed = await parser.parseURL(`https://${site}.ftchinese.com/rss/feed`);\r\n    }\r\n\r\n    const items = await Promise.all(\r\n        feed.items.map((item) => {\r\n            item.link = item.link.replace('http://', 'https://');\r\n            return cache.tryGet(item.link, async () => {\r\n                const response = await got.get(`${item.link}?full=y&archive`);\r\n\r\n                const $ = load(response.data);\r\n                const results = [];\r\n                for (let i = 0; i < $('div.story-container').length; i++) {\r\n                    results.push(ProcessFeed(i, $, item.link));\r\n                }\r\n\r\n                item.title = results[0].title;\r\n                item.description = results.map((result) => result.content).join('');\r\n                item.author = results[0].author;\r\n                return item;\r\n            });\r\n        })\r\n    );\r\n\r\n    return {\r\n        title: feed.title,\r\n        link: feed.link,\r\n        description: feed.description,\r\n        item: items,\r\n    };\r\n};\r\n\r\nexport default { getData };\r\n","import { Route } from '@/types';\r\nimport utils from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/:language/:channel?',\r\n    categories: ['traditional-media'],\r\n    example: '/ftchinese/simplified/hotstoryby7day',\r\n    parameters: { language: '语言，简体 `simplified`，繁体 `traditional`', channel: '频道，缺省为每日更新' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'FT 中文网',\r\n    maintainers: ['HenryQW', 'xyqfer'],\r\n    handler,\r\n    description: `::: tip\r\n  -   不支持付费文章。\r\n:::\r\n\r\n  通过提取文章全文，以提供比官方源更佳的阅读体验。\r\n\r\n  支持所有频道，频道名称见 [官方频道 RSS](http://www.ftchinese.com/channel/rss.html).\r\n\r\n  -   频道为单一路径，如 \\`http://www.ftchinese.com/rss/news\\` 则为 \\`/ftchinese/simplified/news\\`.\r\n  -   频道包含多重路径，如 \\`http://www.ftchinese.com/rss/column/007000002\\` 则替换 \\`/\\` 为 \\`-\\` \\`/ftchinese/simplified/column-007000002\\`.`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    return await utils.getData({\r\n        site: ctx.req.param('language') === 'simplified' ? 'www' : 'big5',\r\n        channel: ctx.req.param('channel'),\r\n        ctx,\r\n    });\r\n}\r\n"],"mappings":"iXAKA,MAAM,GAAe,EAAG,EAAG,IAAS,CAChC,IAAM,EAAQ,EAAE,MAAM,OAClB,EAAU,EAAE,uBAAuB,GAAG,GAG1C,EAAQ,KAAK,4BAA4B,MAAM,EAAG,IAAM,CACpD,IAAM,EAAM,gDAAgD,EAAE,QAAQ,cAEtE,EAAE,YAAY,EAAI,IAAI,YAAY,EAAQ,KAAK,kBAAkB,MAIrE,EAAQ,KAAK,+BAA+B,MAAM,EAAG,IAAM,CACvD,EAAE,+BAA+B,EAAK,qBAAqB,YAAY,EAAQ,KAAK,kBAAkB,IACtG,EAAE,GAAG,WAIT,IAAI,EAAS,GAgBb,OAfA,EAAQ,KAAK,yBAAyB,MAAM,EAAG,IAAM,CACjD,GAAU,GAAG,EAAE,GAAG,OAAO,KAE7B,EAAS,EAAO,OAGhB,EACK,KACG,2PAEH,MAAM,EAAG,IAAM,CACZ,EAAE,GAAG,WAEb,EAAU,EAAQ,OAEX,CAAE,UAAS,SAAQ,UAGxB,EAAU,MAAO,CAAE,OAAO,MAAO,aAAc,CACjD,IAAI,EAEJ,GAAI,EAAS,CACT,EAAU,EAAQ,cAClB,EAAU,EAAQ,MAAM,KAAK,KAAK,KAElC,GAAI,CACA,EAAO,MAAMA,EAAO,SAAS,WAAW,EAAK,qBAAqB,UAC9D,CACJ,MAAO,CACH,MAAO,UAAU,EAAQ,MACzB,YAAa,UAAU,EAAQ,aAIvC,EAAO,MAAMA,EAAO,SAAS,WAAW,EAAK,0BAGjD,IAAM,EAAQ,MAAM,QAAQ,IACxB,EAAK,MAAM,IAAK,IACZ,EAAK,KAAO,EAAK,KAAK,QAAQ,UAAW,YAClCC,EAAM,OAAO,EAAK,KAAM,SAAY,CACvC,IAAM,EAAW,MAAMC,EAAI,IAAI,GAAG,EAAK,KAAK,kBAEtC,EAAI,EAAK,EAAS,MAClB,EAAU,GAChB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAE,uBAAuB,OAAQ,IACjD,EAAQ,KAAK,EAAY,EAAG,EAAG,EAAK,OAMxC,MAHA,GAAK,MAAQ,EAAQ,GAAG,MACxB,EAAK,YAAc,EAAQ,IAAK,GAAW,EAAO,SAAS,KAAK,IAChE,EAAK,OAAS,EAAQ,GAAG,OAClB,OAKnB,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EAAK,KACX,YAAa,EAAK,YAClB,KAAM,IAId,IAAA,EAAe,CAAE,WCtFjB,MAAaC,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,qBACb,QAAS,uCACT,WAAY,CAAE,SAAU,sCAAuC,QAAS,cACxE,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,SACN,YAAa,CAAC,UAAW,UACzB,UACA,YAAa,yVAYjB,eAAe,EAAQ,EAAK,CACxB,OAAO,MAAMC,EAAM,QAAQ,CACvB,KAAM,EAAI,IAAI,MAAM,cAAgB,aAAe,MAAQ,OAC3D,QAAS,EAAI,IAAI,MAAM,WACvB"}