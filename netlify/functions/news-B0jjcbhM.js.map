{"version":3,"file":"news-B0jjcbhM.js","names":["route: Route","got","cache","response"],"sources":["../../lib/routes/blizzard/news.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\n\r\nexport const route: Route = {\r\n    path: '/news/:language?/:category?',\r\n    categories: ['game'],\r\n    example: '/blizzard/news',\r\n    parameters: { language: 'Language code, see below, en-US by default', category: 'Category, see below, All News by default' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'News',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `Categories\r\n\r\n| Category               | Slug                |\r\n| ---------------------- | ------------------- |\r\n| All News               |                     |\r\n| Diablo II: Resurrected | diablo2             |\r\n| Diablo III             | diablo3             |\r\n| Diablo IV              | diablo4             |\r\n| Diablo Immortal        | diablo-immortal     |\r\n| Hearthstone            | hearthstone         |\r\n| Heroes of the Storm    | heroes-of-the-storm |\r\n| Overwatch 2            | overwatch           |\r\n| StarCraft: Remastered  | starcraft           |\r\n| StarCraft II           | starcraft2          |\r\n| World of Warcraft      | world-of-warcraft   |\r\n| Warcraft 3: Reforged   | warcraft3           |\r\n| Warcraft Rumble        | warcraft-rumble     |\r\n| Battle.net             | battlenet           |\r\n| BlizzCon               | blizzcon            |\r\n| Inside Blizzard        | blizzard            |\r\n\r\n  Language codes\r\n\r\n| Language           | Code  |\r\n| ------------------ | ----- |\r\n| Deutsch            | de-de |\r\n| English (US)       | en-us |\r\n| English (EU)       | en-gb |\r\n| Español (EU)       | es-es |\r\n| Español (Latino)   | es-mx |\r\n| Français           | fr-fr |\r\n| Italiano           | it-it |\r\n| Português (Brasil) | pt-br |\r\n| Polski             | pl-pl |\r\n| Русский            | ru-ru |\r\n| 한국어             | ko-kr |\r\n| ภาษาไทย            | th-th |\r\n| 日本語             | ja-jp |\r\n| 繁體中文           | zh-tw |`,\r\n};\r\n\r\nconst GAME_MAP = {\r\n    diablo2: {\r\n        key: 'diablo2',\r\n        value: 'diablo-2-resurrected',\r\n        id: 'blt54fbd3787a705054',\r\n    },\r\n    diablo3: {\r\n        key: 'diablo3',\r\n        value: 'diablo-3',\r\n        id: 'blt2031aef34200656d',\r\n    },\r\n    diablo4: {\r\n        key: 'diablo4',\r\n        value: 'diablo-4',\r\n        id: 'blt795c314400d7ded9',\r\n    },\r\n    'diablo-immortal': {\r\n        key: 'diablo-immortal',\r\n        value: 'diablo-immortal',\r\n        id: 'blt525c436e4a1b0a97',\r\n    },\r\n    hearthstone: {\r\n        key: 'hearthstone',\r\n        value: 'hearthstone',\r\n        id: 'blt5cfc6affa3ca0638',\r\n    },\r\n    'heroes-of-the-storm': {\r\n        key: 'heroes-of-the-storm',\r\n        value: 'heroes-of-the-storm',\r\n        id: 'blt2e50e1521bb84dc6',\r\n    },\r\n    overwatch: {\r\n        key: 'overwatch',\r\n        value: 'overwatch',\r\n        id: 'blt376fb94931906b6f',\r\n    },\r\n    starcraft: {\r\n        key: 'starcraft',\r\n        value: 'starcraft',\r\n        id: 'blt81d46fcb05ab8811',\r\n    },\r\n    starcraft2: {\r\n        key: 'starcraft2',\r\n        value: 'starcraft-2',\r\n        id: 'bltede2389c0a8885aa',\r\n    },\r\n    'world-of-warcraft': {\r\n        key: 'world-of-warcraft',\r\n        value: 'world-of-warcraft',\r\n        id: 'blt2caca37e42f19839',\r\n    },\r\n    warcraft3: {\r\n        key: 'warcraft3',\r\n        value: 'warcraft-3',\r\n        id: 'blt24859ba8086fb294',\r\n    },\r\n    'warcraft-rumble': {\r\n        key: 'warcraft-rumble',\r\n        value: 'warcraft-rumble',\r\n        id: 'blte27d02816a8ff3e1',\r\n    },\r\n    battlenet: {\r\n        key: 'battlenet',\r\n        value: 'battle-net',\r\n        id: 'blt90855744d00cd378',\r\n    },\r\n    blizzcon: {\r\n        key: 'blizzcon',\r\n        value: 'blizzcon',\r\n        id: 'bltec70ad0ea4fd6d1d',\r\n    },\r\n    blizzard: {\r\n        key: 'blizzard',\r\n        value: 'blizzard',\r\n        id: 'blt500c1f8b5470bfdb',\r\n    },\r\n};\r\n\r\nfunction getSearchParams(category = 'all') {\r\n    return category === 'all'\r\n        ? Object.values(GAME_MAP)\r\n              .map((item) => `feedCxpProductIds[]=${item.id}`)\r\n              .join('&')\r\n        : `feedCxpProductIds[]=${GAME_MAP[category].id}`;\r\n}\r\n\r\nasync function handler(ctx) {\r\n    const category = GAME_MAP[ctx.req.param('category')]?.key || 'all';\r\n    const language = ctx.req.param('language') || 'en-us';\r\n    const rootUrl = `https://news.blizzard.com/${language}`;\r\n    const currentUrl = category === 'all' ? rootUrl : `${rootUrl}/?filter=${GAME_MAP[category].value}`;\r\n    const apiUrl = `${rootUrl}/api/news/blizzard`;\r\n    let rssTitle = '';\r\n\r\n    const {\r\n        data: {\r\n            feed: { contentItems: response },\r\n        },\r\n    } = await got(`${apiUrl}?${getSearchParams(category)}`);\r\n\r\n    const list = response.map((item) => {\r\n        const content = item.properties;\r\n        rssTitle = category === 'all' ? 'All News' : content.cxpProduct.title; // 这个是用来填充 RSS 订阅源频道级别 title，没别的地方能拿到了(而且会根据语言切换)\r\n        return {\r\n            title: content.title,\r\n            link: content.newsUrl,\r\n            author: content.author,\r\n            category: content.category,\r\n            guid: content.newsId,\r\n            description: content.summary,\r\n            pubDate: content.lastUpdated,\r\n        };\r\n    });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                try {\r\n                    const { data: response } = await got(item.link);\r\n                    const $ = load(response);\r\n                    item.description = $('.Content').html();\r\n                    return item;\r\n                } catch {\r\n                    return item;\r\n                }\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: rssTitle,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"mTAKA,MAAaA,EAAe,CACxB,KAAM,8BACN,WAAY,CAAC,QACb,QAAS,iBACT,WAAY,CAAE,SAAU,6CAA8C,SAAU,4CAChF,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,OACN,YAAa,CAAC,WACd,UACA,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;6BAyCX,EAAW,CACb,QAAS,CACL,IAAK,UACL,MAAO,uBACP,GAAI,uBAER,QAAS,CACL,IAAK,UACL,MAAO,WACP,GAAI,uBAER,QAAS,CACL,IAAK,UACL,MAAO,WACP,GAAI,uBAER,kBAAmB,CACf,IAAK,kBACL,MAAO,kBACP,GAAI,uBAER,YAAa,CACT,IAAK,cACL,MAAO,cACP,GAAI,uBAER,sBAAuB,CACnB,IAAK,sBACL,MAAO,sBACP,GAAI,uBAER,UAAW,CACP,IAAK,YACL,MAAO,YACP,GAAI,uBAER,UAAW,CACP,IAAK,YACL,MAAO,YACP,GAAI,uBAER,WAAY,CACR,IAAK,aACL,MAAO,cACP,GAAI,uBAER,oBAAqB,CACjB,IAAK,oBACL,MAAO,oBACP,GAAI,uBAER,UAAW,CACP,IAAK,YACL,MAAO,aACP,GAAI,uBAER,kBAAmB,CACf,IAAK,kBACL,MAAO,kBACP,GAAI,uBAER,UAAW,CACP,IAAK,YACL,MAAO,aACP,GAAI,uBAER,SAAU,CACN,IAAK,WACL,MAAO,WACP,GAAI,uBAER,SAAU,CACN,IAAK,WACL,MAAO,WACP,GAAI,wBAIZ,SAAS,EAAgB,EAAW,MAAO,CACvC,OAAO,IAAa,MACd,OAAO,OAAO,GACT,IAAK,GAAS,uBAAuB,EAAK,MAC1C,KAAK,KACV,uBAAuB,EAAS,GAAU,KAGpD,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAS,EAAI,IAAI,MAAM,cAAc,KAAO,MACvD,EAAW,EAAI,IAAI,MAAM,aAAe,QACxC,EAAU,6BAA6B,IACvC,EAAa,IAAa,MAAQ,EAAU,GAAG,EAAQ,WAAW,EAAS,GAAU,QACrF,EAAS,GAAG,EAAQ,oBACtB,EAAW,GAET,CACF,KAAM,CACF,KAAM,CAAE,aAAc,KAE1B,MAAMC,EAAI,GAAG,EAAO,GAAG,EAAgB,MAErC,EAAO,EAAS,IAAK,GAAS,CAChC,IAAM,EAAU,EAAK,WAErB,MADA,GAAW,IAAa,MAAQ,WAAa,EAAQ,WAAW,MACzD,CACH,MAAO,EAAQ,MACf,KAAM,EAAQ,QACd,OAAQ,EAAQ,OAChB,SAAU,EAAQ,SAClB,KAAM,EAAQ,OACd,YAAa,EAAQ,QACrB,QAAS,EAAQ,eAInB,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAI,CACA,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACpC,EAAI,EAAKE,GAEf,MADA,GAAK,YAAc,EAAE,YAAY,OAC1B,OACH,CACJ,OAAO,OAMvB,MAAO,CACH,MAAO,EACP,KAAM,EACN,KAAM"}