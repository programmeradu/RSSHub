{"version":3,"file":"hyxt-CU_5Jp4W.js","names":["route: Route","got","cache"],"sources":["../../lib/routes/whu/hyxt.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { domain, processMeta, getMeta, processItems } from './util';\r\n\r\nexport const route: Route = {\r\n    path: '/hyxt/:category{.+}?',\r\n    name: 'Unknown',\r\n    maintainers: [],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { category = 'tzgg' } = ctx.req.param();\r\n    const limit = ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit'), 10) : 30;\r\n\r\n    const rootUrl = `https://hyxt.${domain}`;\r\n    const currentUrl = new URL(`${category}.htm`, rootUrl).href;\r\n\r\n    const { data: response } = await got(currentUrl);\r\n\r\n    const $ = load(response);\r\n\r\n    let items = $('tr.content-title')\r\n        .slice(0, limit)\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n\r\n            const a = item.find('td a');\r\n\r\n            return {\r\n                title: a.text(),\r\n                link: new URL(a.prop('href'), rootUrl).href,\r\n                pubDate: parseDate(item.find('td').last().text()),\r\n            };\r\n        });\r\n\r\n    items = await processItems(items, cache.tryGet, rootUrl);\r\n\r\n    const meta = processMeta(response);\r\n    const siteName = getMeta(meta, 'SiteName');\r\n    const columnName = getMeta(meta, 'ColumnName');\r\n\r\n    return {\r\n        item: items,\r\n        title: `${siteName} - ${columnName}`,\r\n        link: currentUrl,\r\n        description: getMeta(meta, 'ColumnKeywords'),\r\n        language: $('html').prop('lang'),\r\n        image: new URL($('div.top-logo img').prop('src'), rootUrl).href,\r\n        subtitle: columnName,\r\n        author: siteName,\r\n        allowEmpty: true,\r\n    };\r\n}\r\n"],"mappings":"ggBAQA,MAAaA,EAAe,CACxB,KAAM,uBACN,KAAM,UACN,YAAa,GACb,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,QAAW,EAAI,IAAI,QAChC,EAAQ,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,IAAM,GAE/E,EAAU,gBAAgB,IAC1B,EAAa,IAAI,IAAI,GAAG,EAAS,MAAO,GAAS,KAEjD,CAAE,KAAM,GAAa,MAAMC,EAAI,GAE/B,EAAI,EAAK,GAEX,EAAQ,EAAE,oBACT,MAAM,EAAG,GACT,UACA,IAAK,GAAS,CACX,EAAO,EAAE,GAET,IAAM,EAAI,EAAK,KAAK,QAEpB,MAAO,CACH,MAAO,EAAE,OACT,KAAM,IAAI,IAAI,EAAE,KAAK,QAAS,GAAS,KACvC,QAAS,EAAU,EAAK,KAAK,MAAM,OAAO,WAItD,EAAQ,MAAM,EAAa,EAAOC,EAAM,OAAQ,GAEhD,IAAM,EAAO,EAAY,GACnB,EAAW,EAAQ,EAAM,YACzB,EAAa,EAAQ,EAAM,cAEjC,MAAO,CACH,KAAM,EACN,MAAO,GAAG,EAAS,KAAK,IACxB,KAAM,EACN,YAAa,EAAQ,EAAM,kBAC3B,SAAU,EAAE,QAAQ,KAAK,QACzB,MAAO,IAAI,IAAI,EAAE,oBAAoB,KAAK,OAAQ,GAAS,KAC3D,SAAU,EACV,OAAQ,EACR,WAAY"}