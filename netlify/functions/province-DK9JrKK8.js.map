{"version":3,"file":"province-DK9JrKK8.js","names":[],"sources":["../../lib/routes/chinadegrees/province.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport { config } from '@/config';\r\nimport puppeteer from '@/utils/puppeteer';\r\nconst baseUrl = 'http://www.chinadegrees.com.cn';\r\n\r\nexport const route: Route = {\r\n    path: '/:province?',\r\n    categories: ['study'],\r\n    example: '/chinadegrees/11',\r\n    parameters: { province: '省市代号，见下表，亦可在 [这里](http://www.chinadegrees.com.cn/help/provinceSwqk.html) 找到，默认为 `11`' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: true,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '各学位授予单位学位证书上网进度',\r\n    description: `| 省市             | 代号 |\r\n| ---------------- | ---- |\r\n| 北京市           | 11   |\r\n| 天津市           | 12   |\r\n| 河北省           | 13   |\r\n| 山西省           | 14   |\r\n| 内蒙古自治区     | 15   |\r\n| 辽宁省           | 21   |\r\n| 吉林省           | 22   |\r\n| 黑龙江省         | 23   |\r\n| 上海市           | 31   |\r\n| 江苏省           | 32   |\r\n| 浙江省           | 33   |\r\n| 安徽省           | 34   |\r\n| 福建省           | 35   |\r\n| 江西省           | 36   |\r\n| 山东省           | 37   |\r\n| 河南省           | 41   |\r\n| 湖北省           | 42   |\r\n| 湖南省           | 43   |\r\n| 广东省           | 44   |\r\n| 广西壮族自治区   | 45   |\r\n| 海南省           | 46   |\r\n| 重庆市           | 50   |\r\n| 四川省           | 51   |\r\n| 贵州省           | 52   |\r\n| 云南省           | 53   |\r\n| 西藏自治区       | 54   |\r\n| 陕西省           | 61   |\r\n| 甘肃省           | 62   |\r\n| 青海省           | 63   |\r\n| 宁夏回族自治区   | 64   |\r\n| 新疆维吾尔自治区 | 65   |\r\n| 台湾             | 71   |`,\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { province = '11' } = ctx.req.param();\r\n    const url = `${baseUrl}/help/unitSwqk${province}.html`;\r\n\r\n    const data = await cache.tryGet(\r\n        url,\r\n        async () => {\r\n            const browser = await puppeteer();\r\n            const page = await browser.newPage();\r\n            await page.setRequestInterception(true);\r\n            page.on('request', (request) => {\r\n                request.resourceType() === 'document' || request.resourceType() === 'script' ? request.continue() : request.abort();\r\n            });\r\n            await page.goto(url, {\r\n                waitUntil: 'domcontentloaded',\r\n            });\r\n            await page.waitForSelector('.datalist');\r\n\r\n            const html = await page.evaluate(() => document.documentElement.innerHTML);\r\n            await browser.close();\r\n\r\n            const $ = load(html);\r\n            return {\r\n                title: $('caption').text().trim(),\r\n                items: $('.datalist tr')\r\n                    .toArray()\r\n                    .slice(1)\r\n                    .map((item) => {\r\n                        item = $(item);\r\n                        const title = item.find('td').eq(1).text();\r\n                        const pubDate = item.find('td').eq(2).text();\r\n                        return {\r\n                            title,\r\n                            pubDate,\r\n                            guid: `${title}:${pubDate}`,\r\n                        };\r\n                    })\r\n                    .filter((item) => item.title !== 'null'),\r\n            };\r\n        },\r\n        config.cache.routeExpire,\r\n        false\r\n    );\r\n\r\n    const items = data.items.map((item) => {\r\n        item.description = art(path.join(__dirname, 'templates/description.art'), {\r\n            title: item.title,\r\n            pubDate: item.pubDate,\r\n        });\r\n        item.pubDate = parseDate(item.pubDate, 'YYYY-MM-DD');\r\n        return item;\r\n    });\r\n\r\n    return {\r\n        title: data.title,\r\n        link: url,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"2bASA,MAEa,EAAe,CACxB,KAAM,cACN,WAAY,CAAC,SACb,QAAS,mBACT,WAAY,CAAE,SAAU,wFACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,kBACN,YAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2BAkCb,YAAa,CAAC,UACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,WAAW,MAAS,EAAI,IAAI,QAC9B,EAAM,+CAA2B,EAAS,OAE1C,EAAO,MAAM,EAAM,OACrB,EACA,SAAY,CACR,IAAM,EAAU,MAAM,IAChB,EAAO,MAAM,EAAQ,UAC3B,MAAM,EAAK,uBAAuB,IAClC,EAAK,GAAG,UAAY,GAAY,CAC5B,EAAQ,iBAAmB,YAAc,EAAQ,iBAAmB,SAAW,EAAQ,WAAa,EAAQ,UAEhH,MAAM,EAAK,KAAK,EAAK,CACjB,UAAW,qBAEf,MAAM,EAAK,gBAAgB,aAE3B,IAAM,EAAO,MAAM,EAAK,aAAe,SAAS,gBAAgB,WAChE,MAAM,EAAQ,QAEd,IAAM,EAAI,EAAK,GACf,MAAO,CACH,MAAO,EAAE,WAAW,OAAO,OAC3B,MAAO,EAAE,gBACJ,UACA,MAAM,GACN,IAAK,GAAS,CACX,EAAO,EAAE,GACT,IAAM,EAAQ,EAAK,KAAK,MAAM,GAAG,GAAG,OAC9B,EAAU,EAAK,KAAK,MAAM,GAAG,GAAG,OACtC,MAAO,CACH,QACA,UACA,KAAM,GAAG,EAAM,GAAG,OAGzB,OAAQ,GAAS,EAAK,QAAU,UAG7C,EAAO,MAAM,YACb,IAGE,EAAQ,EAAK,MAAM,IAAK,IAC1B,EAAK,YAAc,EAAI,EAAA,KAAA,EAAA,sCAAmD,CACtE,MAAO,EAAK,MACZ,QAAS,EAAK,UAElB,EAAK,QAAU,EAAU,EAAK,QAAS,cAChC,IAGX,MAAO,CACH,MAAO,EAAK,MACZ,KAAM,EACN,KAAM"}