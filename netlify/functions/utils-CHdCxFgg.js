import{cache_default as e}from"./cache-kimkMTWJ.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import{got_default as n}from"./got-CdvI2yKX.js";import{load as r}from"cheerio";import{JSDOM as i}from"jsdom";const a=e=>(e(`div.video`).each((t,n)=>{let r=new URL(n.attribs.src);if(r.host===`m.miguvideo.com`)e(`<a href="${r.href}"> ▶️ 观看视频 </a><br>`).insertAfter(n),e(n).remove();else switch(r=n.attribs.src,n.attribs.site){case`qiniu`:e(`<video width="100%" controls="controls"> <source src="${r}" type="video/mp4"> Your RSS reader does not support video playback. </video>`).insertAfter(n),e(n).remove();break;case`youku`:e(`<iframe height='100%' width='100%' src='${r}' frameborder=0 scrolling=no webkitallowfullscreen=true allowfullscreen=true></iframe>`).insertAfter(n),e(n).remove();break;default:break}}),e(`iframe.media-iframe, .edui-faked-video`).each((t,n)=>{let r=n.attribs.src;r.startsWith(`http://ssports.iqiyi.com/`)&&e(`<a href="${r.link}"> ▶️ 观看视频 </a><br>`).insertAfter(n),e(n).remove()}),e),o=e=>{e.each((e,t)=>{t.attribs.href&&(t.attribs.href=t.attribs.href.replace(`dongqiudi:///news`,`https://www.dongqiudi.com/article`))})},s=e=>{e.each((e,t)=>{t.attribs[`data-gif-src`]&&t.attribs[`data-gif-src`].length&&(t.attribs={src:t.attribs[`data-gif-src`]}),t.attribs[`orig-src`]&&t.attribs[`orig-src`].length&&(t.attribs.src=t.attribs[`orig-src`],delete t.attribs[`orig-src`],delete t.attribs[`data-src`]),t.attribs.src=t.attribs.src.includes(`?watermark`)?t.attribs.src.split(`?watermark`)[0]:t.attribs.src})},c=async(r,a,o)=>{let s=`https://www.dongqiudi.com/${a}/${o}.html`,{data:c}=await n(s),u,{window:d}=new i(c,{runScripts:`dangerously`}),f=d.__NUXT__.data[0][`${a}Detail`].base_info;a===`team`?u=f.team_name:a===`player`&&(u=f.person_name);let{data:p}=await n(`https://api.dongqiudi.com/v3/archive/app/channel/feeds`,{searchParams:{id:o,type:a,size:20,platform:`web`,version:``}}),m=p.data.articles.map(e=>({title:e.title,link:`https://www.dongqiudi.com/articles/${e.id}.html`,category:[e.category,...e.secondary_category??[]],pubDate:t(e.show_time)})),h=await Promise.all(m.map(t=>e.tryGet(t.link,async()=>{let{data:e}=await n(t.link);return l(t,e),t})));return{title:`${u} - 相关新闻`,link:s,image:a===`team`?f.team_logo:f.person_logo,item:h}},l=(e,n)=>{let c=new i(n,{runScripts:`dangerously`}),l=c.window.__NUXT__.data[0].newData;if(l&&Object.keys(l).length>0){let n=a(r(l.body,null,!1));o(n(`a`)),s(n(`img`)),e.description=n.html(),e.author=l.writer,e.pubDate=t(l.show_time,`X`)}},u=(e,t)=>{let n=r(t),i=JSON.parse(n(`script:contains("window.__INITIAL_STATE__")`).text().match(/window\.__INITIAL_STATE__\s*=\s*(.*?);\(/)[1]);if(i&&Object.keys(i.articleContent).length){let t=Object.values(i.articleContent)[0],n=a(r(t.body,null,!1));o(n(`a`)),s(n(`img`)),e.description=n.html(),e.author=t.writer}};var d={ProcessVideo:a,ProcessFeed:c,ProcessFeedType2:l,ProcessFeedType3:u,ProcessHref:o,ProcessImg:s};export{d as utils_default};
//# sourceMappingURL=utils-CHdCxFgg.js.map