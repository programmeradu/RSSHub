{"version":3,"file":"transformer-circuits-B0y8p-PL.js","names":[],"sources":["../../lib/routes/transformer-circuits/index.ts"],"sourcesContent":["import { Route, DataItem } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nimport logger from '@/utils/logger';\r\n\r\n// Define the main route path\r\nexport const route: Route = {\r\n    path: '/',\r\n    categories: ['programming'],\r\n    example: '/transformer-circuits',\r\n    parameters: {},\r\n    radar: [\r\n        {\r\n            source: ['transformer-circuits.pub/'],\r\n            target: '/',\r\n        },\r\n    ],\r\n    name: 'Articles',\r\n    maintainers: ['shinmohuang'],\r\n    handler,\r\n};\r\n\r\nasync function handler() {\r\n    const rootUrl = 'https://transformer-circuits.pub';\r\n\r\n    // Fetch the main page\r\n    const response = await ofetch(rootUrl);\r\n    const $ = load(response);\r\n\r\n    // Get all article links and basic info\r\n    const articlePromises = $('.toc a')\r\n        .toArray()\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            const currentElement = $item;\r\n            const dateElement = $item.prevAll('.date').first();\r\n            const currentDate = dateElement.text().trim();\r\n\r\n            // Check if this is an article (either paper or note)\r\n            if (currentElement.hasClass('paper') || currentElement.hasClass('note')) {\r\n                const articleType = currentElement.hasClass('paper') ? 'Paper' : 'Note';\r\n\r\n                // Extract title and metadata from the list page\r\n                const title = currentElement.find('h3').text().trim();\r\n                let author = '';\r\n                const byline = currentElement.find('.byline');\r\n                if (byline.length) {\r\n                    author = byline.text().trim();\r\n                }\r\n                const description = currentElement.find('.description').text().trim();\r\n                const href = currentElement.attr('href');\r\n                const articleUrl = href ? (href.startsWith('http') ? href : `${rootUrl}/${href}`) : rootUrl;\r\n\r\n                // Cache the whole article object instead of just the content\r\n                return cache.tryGet(articleUrl, async () => {\r\n                    const fullContent = await fetchArticleContent(articleUrl);\r\n                    return {\r\n                        title,\r\n                        link: articleUrl,\r\n                        pubDate: parseDate(currentDate, 'MMMM YYYY'),\r\n                        author,\r\n                        description: fullContent || `${articleType}: ${description}`,\r\n                        category: ['AI', 'Machine Learning', 'Anthropic', 'Transformer Circuits'],\r\n                    };\r\n                });\r\n            }\r\n            return null;\r\n        });\r\n\r\n    // Wait for all article fetches to complete\r\n    const articlesWithContent = (await Promise.all(articlePromises)).filter(Boolean) as DataItem[];\r\n\r\n    return {\r\n        title: 'Transformer Circuits Thread',\r\n        link: rootUrl,\r\n        item: articlesWithContent,\r\n        description: 'Research on reverse engineering transformer language models into human-understandable programs',\r\n    };\r\n}\r\n\r\n// Function to fetch and parse article content\r\nasync function fetchArticleContent(url) {\r\n    try {\r\n        const response = await ofetch(url);\r\n        const $ = load(response);\r\n\r\n        // Remove navigation and other unnecessary elements\r\n        $('.article-header, .tooltip, modal, script, style, d-front-matter, .visual-toc').remove();\r\n\r\n        // Get the main content - d-article is the custom tag used by this site\r\n        let content = $('d-article').html();\r\n\r\n        // If d-article not found, try more specific fallback selectors\r\n        if (!content) {\r\n            // Try to find content in common article containers, but avoid selecting the entire body\r\n            content = $('main article, .article-content, .post-content, .content-area').html() || $('.content, .article, .post').html() || $('main').html();\r\n\r\n            // If still no content found, log a warning\r\n            if (!content) {\r\n                logger.warn(`No suitable content container found for ${url}`);\r\n                content = `<p>Could not extract content. Please visit <a href=\"${url}\">the original page</a>.</p>`;\r\n            }\r\n        }\r\n\r\n        // Create an HTML fragment (not a full document) for the RSS description\r\n        return art(path.join(__dirname, 'templates/article.art'), {\r\n            content,\r\n            link: url,\r\n        });\r\n    } catch (error: unknown) {\r\n        const errorMessage = error instanceof Error ? error.message : String(error);\r\n        logger.error(`Error fetching article content from ${url}: ${errorMessage}`);\r\n        return null; // Return null on error, we'll fall back to description\r\n    }\r\n}\r\n"],"mappings":"4bAUA,MAAa,EAAe,CACxB,KAAM,IACN,WAAY,CAAC,eACb,QAAS,wBACT,WAAY,GACZ,MAAO,CACH,CACI,OAAQ,CAAC,6BACT,OAAQ,MAGhB,KAAM,WACN,YAAa,CAAC,eACd,WAGJ,eAAe,GAAU,CACrB,IAAM,EAAU,mCAGV,EAAW,MAAM,EAAO,GACxB,EAAI,EAAK,GAGT,EAAkB,EAAE,UACrB,UACA,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GACV,EAAiB,EACjB,EAAc,EAAM,QAAQ,SAAS,QACrC,EAAc,EAAY,OAAO,OAGvC,GAAI,EAAe,SAAS,UAAY,EAAe,SAAS,QAAS,CACrE,IAAM,EAAc,EAAe,SAAS,SAAW,QAAU,OAG3D,EAAQ,EAAe,KAAK,MAAM,OAAO,OAC3C,EAAS,GACP,EAAS,EAAe,KAAK,WAC/B,EAAO,SACP,EAAS,EAAO,OAAO,QAE3B,IAAM,EAAc,EAAe,KAAK,gBAAgB,OAAO,OACzD,EAAO,EAAe,KAAK,QAC3B,EAAa,EAAQ,EAAK,WAAW,QAAU,EAAO,GAAG,EAAQ,GAAG,IAAU,EAGpF,OAAO,EAAM,OAAO,EAAY,SAAY,CACxC,IAAM,EAAc,MAAM,EAAoB,GAC9C,MAAO,CACH,QACA,KAAM,EACN,QAAS,EAAU,EAAa,aAChC,SACA,YAAa,GAAe,GAAG,EAAY,IAAI,IAC/C,SAAU,CAAC,KAAM,mBAAoB,YAAa,2BAI9D,OAAO,OAIT,GAAuB,MAAM,QAAQ,IAAI,IAAkB,OAAO,SAExE,MAAO,CACH,MAAO,8BACP,KAAM,EACN,KAAM,EACN,YAAa,kGAKrB,eAAe,EAAoB,EAAK,CACpC,GAAI,CACA,IAAM,EAAW,MAAM,EAAO,GACxB,EAAI,EAAK,GAGf,EAAE,gFAAgF,SAGlF,IAAI,EAAU,EAAE,aAAa,OAe7B,OAZK,IAED,EAAU,EAAE,gEAAgE,QAAU,EAAE,6BAA6B,QAAU,EAAE,QAAQ,OAGpI,IACD,EAAO,KAAK,2CAA2C,KACvD,EAAU,uDAAuD,EAAI,gCAKtE,EAAI,EAAA,KAAA,EAAA,kCAA+C,CACtD,UACA,KAAM,UAEL,EAAgB,CACrB,IAAM,EAAe,aAAiB,MAAQ,EAAM,QAAU,OAAO,GAErE,OADA,EAAO,MAAM,uCAAuC,EAAI,IAAI,KACrD"}