{"version":3,"file":"hot-list-BPqLRS7R.js","names":["route: Route","InvalidParameterError","got","cache"],"sources":["../../lib/routes/36kr/hot-list.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\n\r\nimport { rootUrl, ProcessItem } from './utils';\r\nimport InvalidParameterError from '@/errors/types/invalid-parameter';\r\n\r\nconst categories = {\r\n    24: {\r\n        title: '24小时热榜',\r\n        key: 'homeData.data.hotlist.data',\r\n    },\r\n    renqi: {\r\n        title: '资讯人气榜',\r\n        key: 'hotListData.topList',\r\n    },\r\n    zonghe: {\r\n        title: '资讯综合榜',\r\n        key: 'hotListData.hotList',\r\n    },\r\n    shoucang: {\r\n        title: '资讯综合榜',\r\n        key: 'hotListData.collectList',\r\n    },\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/hot-list/:category?',\r\n    categories: ['new-media'],\r\n    example: '/36kr/hot-list',\r\n    parameters: { category: '分类，默认为24小时热榜' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['36kr.com/hot-list/:category', '36kr.com/'],\r\n            target: '/hot-list/:category',\r\n        },\r\n    ],\r\n    name: '资讯热榜',\r\n    maintainers: ['nczitzk'],\r\n    handler,\r\n    description: `| 24 小时热榜 | 资讯人气榜 | 资讯综合榜 | 资讯收藏榜 |\r\n| ----------- | ---------- | ---------- | ---------- |\r\n| 24          | renqi      | zonghe     | shoucang   |`,\r\n};\r\n\r\nconst getProperty = (object, key) => {\r\n    let result = object;\r\n    const keys = key.split('.');\r\n    for (const k of keys) {\r\n        result = result && result[k];\r\n    }\r\n    return result;\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const category = ctx.req.param('category') ?? '24';\r\n\r\n    if (!categories[category]) {\r\n        throw new InvalidParameterError('This category does not exist. Please refer to the documentation for the correct usage.');\r\n    }\r\n\r\n    const currentUrl = category === '24' ? rootUrl : `${rootUrl}/hot-list/catalog`;\r\n\r\n    const response = await got({\r\n        method: 'get',\r\n        url: currentUrl,\r\n    });\r\n\r\n    const data = getProperty(JSON.parse(response.data.match(/window.initialState=({.*})/)[1]), categories[category].key);\r\n\r\n    let items = data\r\n        .slice(0, ctx.req.query('limit') ? Number.parseInt(ctx.req.query('limit')) : 10)\r\n        .filter((item) => item.itemType !== 0)\r\n        .map((item) => {\r\n            item = item.templateMaterial ?? item;\r\n            return {\r\n                title: item.widgetTitle.replaceAll(/<\\/?em>/g, ''),\r\n                author: item.authorName,\r\n                pubDate: parseDate(item.publishTime),\r\n                link: `${rootUrl}/p/${item.itemId}`,\r\n                description: item.summary,\r\n            };\r\n        });\r\n\r\n    items = await Promise.all(items.map((item) => ProcessItem(item, cache.tryGet)));\r\n\r\n    return {\r\n        title: `36氪 - ${categories[category].title}`,\r\n        link: currentUrl,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"odAQA,MAAM,EAAa,CACf,GAAI,CACA,MAAO,SACP,IAAK,8BAET,MAAO,CACH,MAAO,QACP,IAAK,uBAET,OAAQ,CACJ,MAAO,QACP,IAAK,uBAET,SAAU,CACN,MAAO,QACP,IAAK,4BAIAA,EAAe,CACxB,KAAM,uBACN,WAAY,CAAC,aACb,QAAS,iBACT,WAAY,CAAE,SAAU,gBACxB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,8BAA+B,aACxC,OAAQ,wBAGhB,KAAM,OACN,YAAa,CAAC,WACd,UACA,YAAa;;yDAKX,GAAe,EAAQ,IAAQ,CACjC,IAAI,EAAS,EACP,EAAO,EAAI,MAAM,KACvB,IAAK,IAAM,KAAK,EACZ,EAAS,GAAU,EAAO,GAE9B,OAAO,GAGX,eAAe,EAAQ,EAAK,CACxB,IAAM,EAAW,EAAI,IAAI,MAAM,aAAe,KAE9C,GAAI,CAAC,EAAW,GACZ,MAAM,IAAIC,EAAsB,0FAGpC,IAAM,EAAa,IAAa,KAAO,EAAU,GAAG,EAAQ,mBAEtD,EAAW,MAAMC,EAAI,CACvB,OAAQ,MACR,IAAK,IAGH,EAAO,EAAY,KAAK,MAAM,EAAS,KAAK,MAAM,8BAA8B,IAAK,EAAW,GAAU,KAE5G,EAAQ,EACP,MAAM,EAAG,EAAI,IAAI,MAAM,SAAW,OAAO,SAAS,EAAI,IAAI,MAAM,UAAY,IAC5E,OAAQ,GAAS,EAAK,WAAa,GACnC,IAAK,IACF,EAAO,EAAK,kBAAoB,EACzB,CACH,MAAO,EAAK,YAAY,WAAW,WAAY,IAC/C,OAAQ,EAAK,WACb,QAAS,EAAU,EAAK,aACxB,KAAM,GAAG,EAAQ,KAAK,EAAK,SAC3B,YAAa,EAAK,WAM9B,MAFA,GAAQ,MAAM,QAAQ,IAAI,EAAM,IAAK,GAAS,EAAY,EAAMC,EAAM,UAE/D,CACH,MAAO,SAAS,EAAW,GAAU,QACrC,KAAM,EACN,KAAM"}