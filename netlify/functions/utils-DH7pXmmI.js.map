{"version":3,"file":"utils-DH7pXmmI.js","names":["ofetch","cache","item"],"sources":["../../lib/routes/gamersky/utils.ts"],"sourcesContent":["import type { DataItem } from '@/types';\r\n\r\nimport ofetch from '@/utils/ofetch';\r\nimport { load } from 'cheerio';\r\nimport cache from '@/utils/cache';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\n\r\ninterface idNameMap {\r\n    type: string;\r\n    name: string;\r\n    nodeId: string;\r\n    suffix?: string;\r\n}\r\ninterface ArticleList {\r\n    status: string;\r\n    totalPages: number;\r\n    body: string;\r\n}\r\n\r\nexport const getArticleList = async (nodeId) => {\r\n    const response = await ofetch<ArticleList>(\r\n        `https://db2.gamersky.com/LabelJsonpAjax.aspx?${new URLSearchParams({\r\n            jsondata: JSON.stringify({\r\n                type: 'updatenodelabel',\r\n                isCache: true,\r\n                cacheTime: 60,\r\n                nodeId,\r\n                isNodeId: 'true',\r\n                page: 1,\r\n            }),\r\n        })}`,\r\n        {\r\n            parseResponse: (txt) => JSON.parse(txt.match(/\\((.+)\\);/)?.[1] ?? '{}'),\r\n        }\r\n    );\r\n    return response.body;\r\n};\r\n\r\nexport const parseArticleList = (response: string) => {\r\n    const $ = load(response);\r\n    return $('li')\r\n        .toArray()\r\n        .map((item) => {\r\n            const ele = $(item);\r\n            const a = ele.find('.tt').length ? ele.find('.tt') : ele.find('a');\r\n            const title = a.text();\r\n            const link = a.attr('href');\r\n            const pubDate = timezone(parseDate(ele.find('.time').text()), 8);\r\n            const description = ele.find('.txt').text();\r\n            if (!link) {\r\n                return;\r\n            }\r\n            return {\r\n                title,\r\n                link,\r\n                pubDate,\r\n                description,\r\n            };\r\n        })\r\n        .filter((item) => item !== undefined) satisfies DataItem[];\r\n};\r\n\r\nexport const getArticle = (item) =>\r\n    cache.tryGet(item.link, async () => {\r\n        const response = await ofetch(item.link);\r\n        const $ = load(response);\r\n        const content = $('.Mid2L_con, .MidLcon');\r\n        content.find('.appGameBuyCardIframe, .GSAppButton, .Mid2L_down').remove();\r\n        content.find('a').each((_, item) => {\r\n            if (item.attribs.href?.startsWith('https://www.gamersky.com/showimage/id_gamersky.shtml?')) {\r\n                item.attribs.href = item.attribs.href.replace('https://www.gamersky.com/showimage/id_gamersky.shtml?', '');\r\n            }\r\n        });\r\n        content.find('img').each((_, item) => {\r\n            if (item.attribs.src === 'http://image.gamersky.com/webimg13/zhuanti/common/blank.png') {\r\n                item.attribs.src = item.attribs['data-origin'];\r\n            } else if (item.attribs.src.endsWith('_S.jpg')) {\r\n                item.attribs.src = item.attribs.src.replace('_S.jpg', '.jpg');\r\n            }\r\n        });\r\n        content.find('.Slides li').each((_, item) => {\r\n            if (item.attribs.style === 'display: none;') {\r\n                item.attribs.style = 'display: list-item;';\r\n            }\r\n        });\r\n        item.description = content.html() || item.description;\r\n        return item satisfies DataItem;\r\n    }) as Promise<DataItem>;\r\n\r\nexport function mdTableBuilder(data: idNameMap[]) {\r\n    const table = '|' + data.map((item) => `${item.type}|`).join('') + '\\n|' + Array.from({ length: data.length }).fill('---|').join('') + '\\n|' + data.map((item) => `${item.name}|`).join('') + '\\n';\r\n    return table;\r\n}\r\n"],"mappings":"gPAoBA,MAAa,EAAiB,KAAO,IAAW,CAC5C,IAAM,EAAW,MAAMA,EACnB,gDAAgD,IAAI,gBAAgB,CAChE,SAAU,KAAK,UAAU,CACrB,KAAM,kBACN,QAAS,GACT,UAAW,GACX,SACA,SAAU,OACV,KAAM,QAGd,CACI,cAAgB,GAAQ,KAAK,MAAM,EAAI,MAAM,eAAe,IAAM,QAG1E,OAAO,EAAS,MAGP,EAAoB,GAAqB,CAClD,IAAM,EAAI,EAAK,GACf,OAAO,EAAE,MACJ,UACA,IAAK,GAAS,CACX,IAAM,EAAM,EAAE,GACR,EAAI,EAAI,KAAK,OAAO,OAAS,EAAI,KAAK,OAAS,EAAI,KAAK,KACxD,EAAQ,EAAE,OACV,EAAO,EAAE,KAAK,QACd,EAAU,EAAS,EAAU,EAAI,KAAK,SAAS,QAAS,GACxD,EAAc,EAAI,KAAK,QAAQ,OAChC,KAGL,MAAO,CACH,QACA,OACA,UACA,iBAGP,OAAQ,GAAS,IAAS,IAAA,KAGtB,EAAc,GACvBC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAM,EAAW,MAAMD,EAAO,EAAK,MAC7B,EAAI,EAAK,GACT,EAAU,EAAE,wBAoBlB,OAnBA,EAAQ,KAAK,oDAAoD,SACjE,EAAQ,KAAK,KAAK,MAAM,EAAG,IAAS,CAC5BE,EAAK,QAAQ,MAAM,WAAW,2DAC9B,EAAK,QAAQ,KAAOA,EAAK,QAAQ,KAAK,QAAQ,wDAAyD,OAG/G,EAAQ,KAAK,OAAO,MAAM,EAAG,IAAS,CAC9BA,EAAK,QAAQ,MAAQ,8DACrB,EAAK,QAAQ,IAAMA,EAAK,QAAQ,eACzBA,EAAK,QAAQ,IAAI,SAAS,YACjC,EAAK,QAAQ,IAAMA,EAAK,QAAQ,IAAI,QAAQ,SAAU,WAG9D,EAAQ,KAAK,cAAc,MAAM,EAAG,IAAS,CACrCA,EAAK,QAAQ,QAAU,mBACvB,EAAK,QAAQ,MAAQ,yBAG7B,EAAK,YAAc,EAAQ,QAAU,EAAK,YACnC,IAGf,SAAgB,EAAe,EAAmB,CAC9C,IAAM,EAAQ,IAAM,EAAK,IAAK,GAAS,GAAG,EAAK,KAAK,IAAI,KAAK,IAAM;GAAQ,MAAM,KAAK,CAAE,OAAQ,EAAK,SAAU,KAAK,QAAQ,KAAK,IAAM;GAAQ,EAAK,IAAK,GAAS,GAAG,EAAK,KAAK,IAAI,KAAK,IAAM;EAC9L,OAAO"}