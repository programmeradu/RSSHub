{"version":3,"file":"blog-jpZfQzj_.js","names":["route: Route","ofetch","items: DataItem[]"],"sources":["../../lib/routes/devolverdigital/blog.ts"],"sourcesContent":["import { DataItem, Route } from '@/types';\r\nimport { load } from 'cheerio';\r\nimport ofetch from '@/utils/ofetch';\r\n\r\nexport const route: Route = {\r\n    path: '/blog',\r\n    categories: ['game'],\r\n    example: '/devolverdigital/blog',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['devolverdigital.com/blog'],\r\n        },\r\n    ],\r\n    name: 'Official Blogs',\r\n    maintainers: ['XXY233'],\r\n    handler,\r\n    url: 'devolverdigital.com/blog',\r\n};\r\n\r\nasync function handler() {\r\n    const items = await fetchPage();\r\n\r\n    return {\r\n        title: 'DevolverDigital Blog',\r\n        language: 'en-us',\r\n        link: 'https://www.devolverdigital.com/blog',\r\n        item: items,\r\n    };\r\n}\r\n\r\nasync function fetchPage() {\r\n    const baseUrl = 'https://www.devolverdigital.com/blog';\r\n    const response = await ofetch(baseUrl);\r\n    const $ = load(response, { scriptingEnabled: false });\r\n\r\n    // Extract all posts of this page\r\n    const $titleDivs = $('div.w-full.flex.justify-center.py-4.bg-red-400.undefined');\r\n    const $contentDivs = $('div.bg-gray-800.flex.justify-center.font-sm.py-4');\r\n    const items: DataItem[] = $titleDivs.toArray().map((titleDiv, index) => {\r\n        const content = $contentDivs[index];\r\n        const postAuthor = parsePostAuthor($, titleDiv);\r\n        const postDate = parsePostDate($, titleDiv);\r\n        const postTitle = $(titleDiv).find('h1').text();\r\n        const postLink = $(content).find('div.ml-auto.flex.items-center a').attr('href');\r\n        // Modify the src attribute of the image\r\n        parsePostImages($, content);\r\n        const postContent = $.html($(content).find('div.cms-content'));\r\n        return {\r\n            title: postTitle,\r\n            link: postLink,\r\n            author: postAuthor,\r\n            pubDate: postDate,\r\n            description: postContent,\r\n        };\r\n    });\r\n\r\n    return items;\r\n}\r\n\r\nfunction parsePostAuthor($, titleDiv) {\r\n    const $postAuthorElement = $(titleDiv).find('div.font-xs.leading-none.mb-1');\r\n    return $postAuthorElement.text().replace('By ', '') || 'Devolver Digital';\r\n}\r\n\r\nfunction parsePostDate($, titleDiv) {\r\n    const dateStr = $(titleDiv).find('div.font-2xs.leading-none.mb-1').text();\r\n    const cleanedDateStr = dateStr.replace(/(\\d+)(st|nd|rd|th)/, '$1');\r\n    return new Date(cleanedDateStr);\r\n}\r\n\r\nfunction parsePostImages($, content) {\r\n    $(content)\r\n        .find('img')\r\n        .each((index, img) => {\r\n            const $img = $(img);\r\n            const src = $img.attr('src') || '';\r\n            if (src.startsWith('/_next/image')) {\r\n                const srcSet = $img.attr('srcset') || '';\r\n                const actualSrc = srcSet.split(',').pop()?.split(' ')[0] || src;\r\n                $img.attr('src', actualSrc);\r\n            }\r\n            $img.removeAttr('loading').removeAttr('decoding').removeAttr('data-nimg').removeAttr('style').removeAttr('sizes').removeAttr('srcset').removeAttr('referrerpolicy');\r\n        });\r\n}\r\n"],"mappings":"0MAIA,MAAaA,EAAe,CACxB,KAAM,QACN,WAAY,CAAC,QACb,QAAS,wBACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,8BAGjB,KAAM,iBACN,YAAa,CAAC,UACd,UACA,IAAK,4BAGT,eAAe,GAAU,CACrB,IAAM,EAAQ,MAAM,IAEpB,MAAO,CACH,MAAO,uBACP,SAAU,QACV,KAAM,uCACN,KAAM,GAId,eAAe,GAAY,CACvB,IACM,EAAW,MAAMC,EAAO,wCACxB,EAAI,EAAK,EAAU,CAAE,iBAAkB,KAGvC,EAAa,EAAE,4DACf,EAAe,EAAE,oDACjBC,EAAoB,EAAW,UAAU,KAAK,EAAU,IAAU,CACpE,IAAM,EAAU,EAAa,GACvB,EAAa,EAAgB,EAAG,GAChC,EAAW,EAAc,EAAG,GAC5B,EAAY,EAAE,GAAU,KAAK,MAAM,OACnC,EAAW,EAAE,GAAS,KAAK,mCAAmC,KAAK,QAEzE,EAAgB,EAAG,GACnB,IAAM,EAAc,EAAE,KAAK,EAAE,GAAS,KAAK,oBAC3C,MAAO,CACH,MAAO,EACP,KAAM,EACN,OAAQ,EACR,QAAS,EACT,YAAa,KAIrB,OAAO,EAGX,SAAS,EAAgB,EAAG,EAAU,CAClC,IAAM,EAAqB,EAAE,GAAU,KAAK,iCAC5C,OAAO,EAAmB,OAAO,QAAQ,MAAO,KAAO,mBAG3D,SAAS,EAAc,EAAG,EAAU,CAChC,IAAM,EAAU,EAAE,GAAU,KAAK,kCAAkC,OAC7D,EAAiB,EAAQ,QAAQ,qBAAsB,MAC7D,OAAO,IAAI,KAAK,GAGpB,SAAS,EAAgB,EAAG,EAAS,CACjC,EAAE,GACG,KAAK,OACL,MAAM,EAAO,IAAQ,CAClB,IAAM,EAAO,EAAE,GACT,EAAM,EAAK,KAAK,QAAU,GAChC,GAAI,EAAI,WAAW,gBAAiB,CAChC,IAAM,EAAS,EAAK,KAAK,WAAa,GAChC,EAAY,EAAO,MAAM,KAAK,OAAO,MAAM,KAAK,IAAM,EAC5D,EAAK,KAAK,MAAO,GAErB,EAAK,WAAW,WAAW,WAAW,YAAY,WAAW,aAAa,WAAW,SAAS,WAAW,SAAS,WAAW,UAAU,WAAW"}