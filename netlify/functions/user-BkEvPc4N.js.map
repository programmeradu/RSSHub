{"version":3,"file":"user-BkEvPc4N.js","names":["route: Route","ConfigNotFoundError"],"sources":["../../lib/routes/zsxq/user.ts"],"sourcesContent":["import type { Data, Route } from '@/types';\r\nimport type { Context } from 'hono';\r\nimport { config } from '@/config';\r\nimport ConfigNotFoundError from '@/errors/types/config-not-found';\r\nimport type { TopicsResponse, UserInfoResponse } from './types';\r\nimport { customFetch, generateTopicDataItem } from './utils';\r\n\r\nexport const route: Route = {\r\n    name: '用户足迹',\r\n    categories: ['social-media'],\r\n    path: '/user/:id',\r\n    example: '/zsxq/user/2414218251',\r\n    parameters: {\r\n        id: '用户id，从网页端url中获取',\r\n    },\r\n    maintainers: ['KarasuShin'],\r\n    radar: [\r\n        {\r\n            source: ['wx.zsxq.com/dweb2/index/footprint/:id'],\r\n        },\r\n    ],\r\n    features: {\r\n        requireConfig: [\r\n            {\r\n                name: 'ZSXQ_ACCESS_TOKEN',\r\n                description:\r\n                    '知识星球访问令牌,获取方式：\\n1. 登录知识星球网页版\\n2. 打开浏览器开发者工具，切换到 Application 面板\\n3. 点击侧边栏中的Storage -> Cookies -> https://wx.zsxq.com\\n4. 复制 Cookie 中的 zsxq_access_token 值',\r\n            },\r\n        ],\r\n    },\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx: Context): Promise<Data> {\r\n    const uid = ctx.req.param('id');\r\n    const accessToken = config.zsxq.accessToken;\r\n\r\n    if (!accessToken) {\r\n        throw new ConfigNotFoundError('该 RSS 源由于配置不正确而被禁用：令牌丢失。');\r\n    }\r\n\r\n    let count = Number(ctx.req.query('limit')) || 20;\r\n    if (count > 30) {\r\n        count = 30;\r\n    }\r\n\r\n    const userInfo = await customFetch<UserInfoResponse>(`/users/${uid}`);\r\n\r\n    const { topics } = await customFetch<TopicsResponse>(`/users/${uid}/topics/footprint?count=${count}`);\r\n\r\n    return {\r\n        title: `知识星球 - ${userInfo.user.name}`,\r\n        description: userInfo.user.introduction,\r\n        image: userInfo.user.avatar_url,\r\n        link: `https://wx.zsxq.com/dweb2/index/footprint/${uid}`,\r\n        item: generateTopicDataItem(topics),\r\n    };\r\n}\r\n"],"mappings":"mZAOA,MAAaA,EAAe,CACxB,KAAM,OACN,WAAY,CAAC,gBACb,KAAM,YACN,QAAS,wBACT,WAAY,CACR,GAAI,mBAER,YAAa,CAAC,cACd,MAAO,CACH,CACI,OAAQ,CAAC,2CAGjB,SAAU,CACN,cAAe,CACX,CACI,KAAM,oBACN,YACI;;;;wCAIhB,WAGJ,eAAe,EAAQ,EAA6B,CAChD,IAAM,EAAM,EAAI,IAAI,MAAM,MACpB,EAAc,EAAO,KAAK,YAEhC,GAAI,CAAC,EACD,MAAM,IAAIC,EAAoB,4BAGlC,IAAI,EAAQ,OAAO,EAAI,IAAI,MAAM,WAAa,GAC1C,EAAQ,KACR,EAAQ,IAGZ,IAAM,EAAW,MAAM,EAA8B,UAAU,KAEzD,CAAE,UAAW,MAAM,EAA4B,UAAU,EAAI,0BAA0B,KAE7F,MAAO,CACH,MAAO,UAAU,EAAS,KAAK,OAC/B,YAAa,EAAS,KAAK,aAC3B,MAAO,EAAS,KAAK,WACrB,KAAM,6CAA6C,IACnD,KAAM,EAAsB"}