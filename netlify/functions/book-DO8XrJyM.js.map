{"version":3,"file":"book-DO8XrJyM.js","names":["cache","ofetch","response","$","route: Route"],"sources":["../../lib/routes/freexcomic/book.ts"],"sourcesContent":["import { Route } from '@/types';\r\nimport ofetch from '@/utils/ofetch';\r\nimport * as cheerio from 'cheerio';\r\nimport cache from '@/utils/cache';\r\n\r\nconst jjmhw = 'http://www.jjmhw.cc';\r\n\r\nconst getLatestAddress = () =>\r\n    cache.tryGet('freexcomic:getLatestAddress', async () => {\r\n        const portalResponse = await ofetch('https://www.freexcomic.com');\r\n        const $portal = cheerio.load(portalResponse);\r\n        const portalUrl = new URL($portal('.alert-btn').attr('href')).href.replace('http:', 'https:');\r\n\r\n        const addressList = await ofetch(portalUrl);\r\n        const $address = cheerio.load(addressList);\r\n\r\n        return $address('p.ta-c.mb10 a')\r\n            .toArray()\r\n            .map((item) => $address(item).attr('href'));\r\n    });\r\n\r\nconst handler = async (ctx) => {\r\n    const { id } = ctx.req.param();\r\n    const limit = Number.parseInt(ctx.req.query('limit'), 10) || 10;\r\n    const addresses = (await getLatestAddress()) as string[];\r\n    const link = `${addresses[0]}book/${id}`;\r\n\r\n    const response = await ofetch(link);\r\n    const $ = cheerio.load(response);\r\n\r\n    const list = $('#detail-list-select > li > a')\r\n        .toArray()\r\n        .toReversed()\r\n        .slice(0, limit)\r\n        .map((item) => {\r\n            const $item = $(item);\r\n            return {\r\n                title: $item.text(),\r\n                link: new URL($item.attr('href'), addresses[Math.floor(Math.random() * addresses.length)]).href,\r\n                guid: new URL($item.attr('href'), jjmhw).href,\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const response = await ofetch(item.link);\r\n                const $ = cheerio.load(response);\r\n\r\n                const comicpage = $('.comicpage');\r\n                comicpage.find('img').each((_, ele) => {\r\n                    ele.attribs.src = ele.attribs['data-original'];\r\n                });\r\n\r\n                item.description = comicpage.html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `漫小肆 ${$('div.info > h1').text()}`,\r\n        link,\r\n        description: `漫小肆 ${$('div.info .content span span').text()}`,\r\n        image: $('.banner_detail .cover img').attr('src'),\r\n        item: items,\r\n    };\r\n};\r\n\r\nexport const route: Route = {\r\n    path: '/book/:id',\r\n    example: '/freexcomic/book/90',\r\n    parameters: { id: '漫画id，漫画主页的地址栏中' },\r\n    radar: [\r\n        {\r\n            source: ['www.jjmhw.cc/book/:id'],\r\n        },\r\n    ],\r\n    name: '漫画更新',\r\n    maintainers: ['junfengP'],\r\n    handler,\r\n    url: 'www.jjmhw.cc',\r\n    features: {\r\n        nsfw: true,\r\n    },\r\n};\r\n"],"mappings":"yPAKA,MAEM,MACFA,EAAM,OAAO,8BAA+B,SAAY,CACpD,IAAM,EAAiB,MAAMC,EAAO,8BAC9B,EAAU,EAAQ,KAAK,GACvB,EAAY,IAAI,IAAI,EAAQ,cAAc,KAAK,SAAS,KAAK,QAAQ,QAAS,UAE9E,EAAc,MAAMA,EAAO,GAC3B,EAAW,EAAQ,KAAK,GAE9B,OAAO,EAAS,iBACX,UACA,IAAK,GAAS,EAAS,GAAM,KAAK,WAGzC,EAAU,KAAO,IAAQ,CAC3B,GAAM,CAAE,MAAO,EAAI,IAAI,QACjB,EAAQ,OAAO,SAAS,EAAI,IAAI,MAAM,SAAU,KAAO,GACvD,EAAa,MAAM,IACnB,EAAO,GAAG,EAAU,GAAG,OAAO,IAE9B,EAAW,MAAMA,EAAO,GACxB,EAAI,EAAQ,KAAK,GAEjB,EAAO,EAAE,gCACV,UACA,aACA,MAAM,EAAG,GACT,IAAK,GAAS,CACX,IAAM,EAAQ,EAAE,GAChB,MAAO,CACH,MAAO,EAAM,OACb,KAAM,IAAI,IAAI,EAAM,KAAK,QAAS,EAAU,KAAK,MAAM,KAAK,SAAW,EAAU,UAAU,KAC3F,KAAM,IAAI,IAAI,EAAM,KAAK,QAAS,uBAAO,QAI/C,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACND,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,IAAME,EAAW,MAAMD,EAAO,EAAK,MAC7BE,EAAI,EAAQ,KAAKD,GAEjB,EAAYC,EAAE,cAOpB,OANA,EAAU,KAAK,OAAO,MAAM,EAAG,IAAQ,CACnC,EAAI,QAAQ,IAAM,EAAI,QAAQ,mBAGlC,EAAK,YAAc,EAAU,OAEtB,MAKnB,MAAO,CACH,MAAO,OAAO,EAAE,iBAAiB,SACjC,OACA,YAAa,OAAO,EAAE,+BAA+B,SACrD,MAAO,EAAE,6BAA6B,KAAK,OAC3C,KAAM,IAIDC,EAAe,CACxB,KAAM,YACN,QAAS,sBACT,WAAY,CAAE,GAAI,kBAClB,MAAO,CACH,CACI,OAAQ,CAAC,2BAGjB,KAAM,OACN,YAAa,CAAC,YACd,UACA,IAAK,eACL,SAAU,CACN,KAAM"}