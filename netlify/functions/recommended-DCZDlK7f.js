import{__dirname as e,init_esm_shims as t}from"./esm-shims-Dqvxr0BZ.js";import"./config-Dl8a1sIg.js";import"./logger-CWOoofbD.js";import"./dist-IvUHtNe1.js";import"./helpers-DzX-lcQO.js";import{art as n}from"./render-CxhTJIsl.js";import"./ofetch-Bzt0BXUH.js";import{got_default as r}from"./got-CdvI2yKX.js";import{fallback as i,queryToInteger as a}from"./readable-social-D7TWDGpz.js";import o from"node:path";t();const s={path:`/recommended/:type?/:routeParams?`,categories:[`social-media`],example:`/douban/recommended/tv`,parameters:{type:`片单类型剧集/电影，tv或movie，默认为tv`,routeParams:`额外参数；请参阅以下说明和表格`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`豆瓣每月推荐片单`,maintainers:[`honue`],handler:c,description:`| 额外参数 | 含义                   | 接受的值 | 默认值 |
| -------- | ---------------------- | -------- | ------ |
| playable | 仅看有可播放片源的影片 | 0/1      | 0      |
| score    | 筛选评分               | 0-10     | 0      |

  用例：\`/douban/recommended/tv/playable=0&score=8\`

::: tip
  整合了 /douban/list/ 路由，省去每月手动更新 id 参数，因为当月推荐剧集片单中，会有还未播出 / 开评分剧集、海外平台播出剧集，请自行考虑是否使用额外参数。
:::`};async function c(t){let s=t.req.param(`type`)||`tv`,c=`https://frodo.douban.com/api/v2/skynet/new_playlists?apikey=0ac44ae016490db2204ce0a042db2916&subject_type=${s}`,l=await r({method:`get`,url:c,headers:{"User-Agent":`MicroMessenger/`,Referer:`https://servicewechat.com/wx2f9b06c1de1ccfca/91/page-frame.html`}}),u=new Date,d=u.getFullYear(),f=u.getMonth()+1,p=f<10?`0`+f:f.toString(),m=l.data.data[0].items,h=m.find(e=>e.title.startsWith(`${d}年${p}月`)).id,g=Object.fromEntries(new URLSearchParams(t.req.param(`routeParams`))),_=i(void 0,a(g.playable),0),v=i(void 0,a(g.score),0);c=`https://m.douban.com/rexxar/api/v2/subject_collection/${h}/items?playable=${_}`,l=await r({method:`get`,url:c,headers:{Referer:`https://m.douban.com/subject_collection/${h}`}});let y=l.data.subject_collection.description;return m=l.data.subject_collection_items.filter(e=>{let t=e.rating?e.rating.value:0;return t>=v}).map(t=>{let r=t.title,i=t.url,a=n(o.join(e,`templates/list_description-48b9ab53.art`),{ranking_value:t.ranking_value,title:r,original_title:t.original_title,rate:t.rating?t.rating.value:null,card_subtitle:t.card_subtitle,description:t.cards?t.cards[0].content:t.abstract,cover:t.cover_url||t.cover?.url});return{title:r,link:i,description:a}}),{title:`豆瓣 - ${l.data.subject_collection.name}`,link:`https://m.douban.com/subject_collection/${h}`,item:m,description:y}}export{s as route};
//# sourceMappingURL=recommended-DCZDlK7f.js.map