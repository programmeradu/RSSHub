{"version":3,"file":"career-CPBkIV9a.js","names":["route: Route","got","cache","response","$"],"sources":["../../lib/routes/csu/utils.ts","../../lib/routes/csu/career.ts"],"sourcesContent":["import { inflateSync } from 'node:zlib';\r\n\r\nconst unzip = (b64Data) => {\r\n    const strData = Buffer.from(b64Data, 'base64').toString('binary');\r\n    const charData = [...strData].map((x) => x.charCodeAt(0));\r\n    const binData = new Uint8Array(charData);\r\n    const data = inflateSync(binData);\r\n    let ret = '';\r\n    for (const c of data) {\r\n        ret += String.fromCharCode(c);\r\n    }\r\n    return ret;\r\n};\r\n\r\nexport { unzip };\r\n","import { Route } from '@/types';\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { load } from 'cheerio';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport timezone from '@/utils/timezone';\r\nimport { unzip } from './utils';\r\n\r\nexport const route: Route = {\r\n    path: '/career',\r\n    categories: ['university'],\r\n    example: '/csu/career',\r\n    parameters: {},\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    radar: [\r\n        {\r\n            source: ['career.csu.edu.cn/campus/index/category/1', 'career.csu.edu.cn/campus', 'career.csu.edu.cn/'],\r\n        },\r\n    ],\r\n    name: '就业信息网招聘信息',\r\n    maintainers: ['TonyRL'],\r\n    handler,\r\n    url: 'career.csu.edu.cn/campus/index/category/1',\r\n};\r\n\r\nasync function handler() {\r\n    const baseUrl = 'https://career.csu.edu.cn';\r\n    const link = `${baseUrl}/campus/index/category/1`;\r\n    const { data: response } = await got(link);\r\n    const $ = load(response);\r\n\r\n    const list = $('.infoList')\r\n        .toArray()\r\n        .map((item) => {\r\n            item = $(item);\r\n            return {\r\n                title: item.find('a').text(),\r\n                link: `${baseUrl}${item.find('a').attr('href')}`,\r\n                pubDate: timezone(parseDate(item.find('.span4').text()), 8),\r\n            };\r\n        });\r\n\r\n    const items = await Promise.all(\r\n        list.map((item) =>\r\n            cache.tryGet(item.link, async () => {\r\n                const { data: response } = await got(item.link);\r\n                let $ = load(response);\r\n\r\n                const zipped = $('script[type=\"text/javascript\"]')\r\n                    .text()\r\n                    .match(/Base64\\.decode\\(unzip\\(\"(.*)\"\\)\\./)[1];\r\n                const { slice1, slice2 } = $('script[type=\"text/javascript\"]')\r\n                    .text()\r\n                    .match(/\"\\)\\.substr\\((?<slice1>\\d+)\\)\\)\\.substr\\((?<slice2>\\d+)\\)\\);/).groups;\r\n                const unzipped = Buffer.from(unzip(zipped).slice(slice1), 'base64').toString().slice(slice2);\r\n\r\n                $ = load(unzipped, null, false);\r\n                item.description = $.html();\r\n\r\n                return item;\r\n            })\r\n        )\r\n    );\r\n\r\n    return {\r\n        title: `${$('.curr').text()} - ${$('head title').text()}`,\r\n        link,\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"kcAEA,MAAM,EAAS,GAAY,CACvB,IAAM,EAAU,OAAO,KAAK,EAAS,UAAU,SAAS,UAClD,EAAW,CAAC,GAAG,GAAS,IAAK,GAAM,EAAE,WAAW,IAChD,EAAU,IAAI,WAAW,GACzB,EAAO,EAAY,GACrB,EAAM,GACV,IAAK,IAAM,KAAK,EACZ,GAAO,OAAO,aAAa,GAE/B,OAAO,GCHEA,EAAe,CACxB,KAAM,UACN,WAAY,CAAC,cACb,QAAS,cACT,WAAY,GACZ,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,MAAO,CACH,CACI,OAAQ,CAAC,4CAA6C,2BAA4B,wBAG1F,KAAM,YACN,YAAa,CAAC,UACd,UACA,IAAK,6CAGT,eAAe,GAAU,CACrB,IAAM,EAAU,4BACV,EAAO,GAAG,EAAQ,0BAClB,CAAE,KAAM,GAAa,MAAMC,EAAI,GAC/B,EAAI,EAAK,GAET,EAAO,EAAE,aACV,UACA,IAAK,IACF,EAAO,EAAE,GACF,CACH,MAAO,EAAK,KAAK,KAAK,OACtB,KAAM,GAAG,IAAU,EAAK,KAAK,KAAK,KAAK,UACvC,QAAS,EAAS,EAAU,EAAK,KAAK,UAAU,QAAS,MAI/D,EAAQ,MAAM,QAAQ,IACxB,EAAK,IAAK,GACNC,EAAM,OAAO,EAAK,KAAM,SAAY,CAChC,GAAM,CAAE,KAAMC,GAAa,MAAMF,EAAI,EAAK,MACtCG,EAAI,EAAKD,GAEP,EAASC,EAAE,kCACZ,OACA,MAAM,qCAAqC,GAC1C,CAAE,SAAQ,UAAWA,EAAE,kCACxB,OACA,MAAM,gEAAgE,OACrE,EAAW,OAAO,KAAK,EAAM,GAAQ,MAAM,GAAS,UAAU,WAAW,MAAM,GAKrF,MAHA,GAAI,EAAK,EAAU,KAAM,IACzB,EAAK,YAAcA,EAAE,OAEd,MAKnB,MAAO,CACH,MAAO,GAAG,EAAE,SAAS,OAAO,KAAK,EAAE,cAAc,SACjD,OACA,KAAM"}