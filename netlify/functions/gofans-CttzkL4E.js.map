{"version":3,"file":"gofans-CttzkL4E.js","names":[],"sources":["../../lib/routes/gofans/index.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\n\r\nexport const route: Route = {\r\n    path: '/:kind?',\r\n    categories: ['program-update'],\r\n    example: '/gofans',\r\n    parameters: { kind: 'Platform, either `macos` or `ios`, empty means both (default)' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: '最新限免 / 促销应用',\r\n    maintainers: ['HenryQW'],\r\n    handler,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    const { kind = '' } = ctx.req.param();\r\n    const baseUrl = 'https://gofans.cn';\r\n\r\n    const { data: response } = await got('https://api.gofans.cn/v1/web/app_records', {\r\n        headers: {\r\n            origin: baseUrl,\r\n        },\r\n        searchParams: {\r\n            limit: 20,\r\n            kind: kind && (kind === 'macos' ? 1 : 2),\r\n            page: 1,\r\n        },\r\n    });\r\n\r\n    const items = response.data.map((item) => ({\r\n        title: `「${item.price === '0.00' ? '免费' : '降价'}」-「${item.kind === 1 ? 'macOS' : 'iOS'}」${item.name}`,\r\n        description: art(path.join(__dirname, 'templates/description.art'), {\r\n            icon: item.icon,\r\n            originalPrice: item.original_price,\r\n            price: item.price,\r\n            kind: item.kind,\r\n            description: item.description.replaceAll('\\n', '<br>'),\r\n        }),\r\n        pubDate: parseDate(item.updated_at, 'X'),\r\n        link: new URL(`/app/${item.uuid}`, baseUrl).href,\r\n        category: item.primary_genre_name,\r\n    }));\r\n\r\n    return {\r\n        title: '最新限免 / 促销应用',\r\n        link: baseUrl,\r\n        description: 'GoFans：最新限免 / 促销应用',\r\n        item: items,\r\n    };\r\n}\r\n"],"mappings":"qYAOA,MAAa,EAAe,CACxB,KAAM,UACN,WAAY,CAAC,kBACb,QAAS,UACT,WAAY,CAAE,KAAM,iEACpB,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,cACN,YAAa,CAAC,WACd,WAGJ,eAAe,EAAQ,EAAK,CACxB,GAAM,CAAE,OAAO,IAAO,EAAI,IAAI,QACxB,EAAU,oBAEV,CAAE,KAAM,GAAa,MAAM,EAAI,2CAA4C,CAC7E,QAAS,CACL,OAAQ,GAEZ,aAAc,CACV,MAAO,GACP,KAAM,IAAS,IAAS,QAAU,EAAI,GACtC,KAAM,KAIR,EAAQ,EAAS,KAAK,IAAK,IAAU,CACvC,MAAO,IAAI,EAAK,QAAU,OAAS,KAAO,KAAK,KAAK,EAAK,OAAS,EAAI,QAAU,MAAM,GAAG,EAAK,OAC9F,YAAa,EAAI,EAAA,KAAA,EAAA,sCAAmD,CAChE,KAAM,EAAK,KACX,cAAe,EAAK,eACpB,MAAO,EAAK,MACZ,KAAM,EAAK,KACX,YAAa,EAAK,YAAY,WAAW;EAAM,UAEnD,QAAS,EAAU,EAAK,WAAY,KACpC,KAAM,IAAI,IAAI,QAAQ,EAAK,OAAQ,GAAS,KAC5C,SAAU,EAAK,sBAGnB,MAAO,CACH,MAAO,cACP,KAAM,EACN,YAAa,qBACb,KAAM"}