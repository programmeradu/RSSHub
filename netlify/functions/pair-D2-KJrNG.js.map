{"version":3,"file":"pair-D2-KJrNG.js","names":[],"sources":["../../lib/routes/wise/pair.ts"],"sourcesContent":["import { Route } from '@/types';\r\n\r\nimport cache from '@/utils/cache';\r\nimport got from '@/utils/got';\r\nimport { parseDate } from '@/utils/parse-date';\r\nimport dayjs from 'dayjs';\r\nimport customParseFormat from 'dayjs/plugin/customParseFormat.js';\r\ndayjs.extend(customParseFormat);\r\nimport { art } from '@/utils/render';\r\nimport path from 'node:path';\r\nconst renderDesc = (content) => art(path.join(__dirname, 'templates/description.art'), content);\r\n\r\nexport const route: Route = {\r\n    path: '/pair/:source/:target',\r\n    categories: ['other'],\r\n    example: '/wise/pair/GBP/USD',\r\n    parameters: { source: 'Base currency abbreviation', target: 'Quote currency abbreviation' },\r\n    features: {\r\n        requireConfig: false,\r\n        requirePuppeteer: false,\r\n        antiCrawler: false,\r\n        supportBT: false,\r\n        supportPodcast: false,\r\n        supportScihub: false,\r\n    },\r\n    name: 'FX Pair Yesterday',\r\n    maintainers: ['HenryQW'],\r\n    handler,\r\n    description: `Refer to [the list of supported currencies](https://wise.com/tools/exchange-rate-alerts/).`,\r\n};\r\n\r\nasync function handler(ctx) {\r\n    let yesterday = dayjs().subtract(1, 'day');\r\n    const dayBefore = yesterday.subtract(1, 'day').format('YYYY-MM-DD');\r\n    yesterday = yesterday.format('YYYY-MM-DD');\r\n\r\n    const source = ctx.req.param('source').toUpperCase();\r\n    const target = ctx.req.param('target').toUpperCase();\r\n\r\n    const link = 'https://wise.com/tools/exchange-rate-alerts/';\r\n    const guid = `wise:rates:${ctx.req.param('source')}-${ctx.req.param('target')}-${yesterday}`;\r\n    const single = await cache.tryGet(guid, async () => {\r\n        const { data } = await got('https://wise.com/rates/history', {\r\n            searchParams: {\r\n                source,\r\n                target,\r\n                length: 1,\r\n                unit: 'year',\r\n                resolution: 'daily',\r\n            },\r\n            headers: {\r\n                referer: link,\r\n            },\r\n        });\r\n\r\n        const yData = data.at(-1);\r\n        const byDate = data.at(-2);\r\n        const yRate = yData.value;\r\n        const byRate = byDate.value;\r\n        const trend = yRate > byRate;\r\n        const diff = (yRate - byRate) / yRate;\r\n\r\n        const percent = (Math.abs(diff) * 100).toFixed(4);\r\n\r\n        return {\r\n            title: `${source}/${target} ${trend ? 'ðŸ“ˆ' : 'ðŸ“‰'} @${yRate} ${diff > 0 ? '' : '-'}${percent}%`,\r\n            description: renderDesc({\r\n                source,\r\n                target,\r\n                yesterday,\r\n                yRate,\r\n                dayBefore,\r\n                byRate,\r\n            }),\r\n            pubDate: parseDate(yData.time, 'x'),\r\n            guid,\r\n            link,\r\n        };\r\n    });\r\n\r\n    return {\r\n        title: `${source} to ${target} by Wise`,\r\n        link,\r\n        description: `Exchange Rate from Wise`,\r\n        item: [single],\r\n    };\r\n}\r\n"],"mappings":"+fAOA,EAAM,OAAO,GAGb,MAAM,EAAc,GAAY,EAAI,EAAA,KAAA,EAAA,sCAAmD,GAE1E,EAAe,CACxB,KAAM,wBACN,WAAY,CAAC,SACb,QAAS,qBACT,WAAY,CAAE,OAAQ,6BAA8B,OAAQ,+BAC5D,SAAU,CACN,cAAe,GACf,iBAAkB,GAClB,YAAa,GACb,UAAW,GACX,eAAgB,GAChB,cAAe,IAEnB,KAAM,oBACN,YAAa,CAAC,WACd,UACA,YAAa,8FAGjB,eAAe,EAAQ,EAAK,CACxB,IAAI,EAAY,IAAQ,SAAS,EAAG,OAC9B,EAAY,EAAU,SAAS,EAAG,OAAO,OAAO,cACtD,EAAY,EAAU,OAAO,cAE7B,IAAM,EAAS,EAAI,IAAI,MAAM,UAAU,cACjC,EAAS,EAAI,IAAI,MAAM,UAAU,cAEjC,EAAO,+CACP,EAAO,cAAc,EAAI,IAAI,MAAM,UAAU,GAAG,EAAI,IAAI,MAAM,UAAU,GAAG,IAC3E,EAAS,MAAM,EAAM,OAAO,EAAM,SAAY,CAChD,GAAM,CAAE,QAAS,MAAM,EAAI,iCAAkC,CACzD,aAAc,CACV,SACA,SACA,OAAQ,EACR,KAAM,OACN,WAAY,SAEhB,QAAS,CACL,QAAS,KAIX,EAAQ,EAAK,GAAG,IAChB,EAAS,EAAK,GAAG,IACjB,EAAQ,EAAM,MACd,EAAS,EAAO,MAChB,EAAQ,EAAQ,EAChB,GAAQ,EAAQ,GAAU,EAE1B,GAAW,KAAK,IAAI,GAAQ,KAAK,QAAQ,GAE/C,MAAO,CACH,MAAO,GAAG,EAAO,GAAG,EAAO,GAAG,EAAQ,KAAO,KAAK,IAAI,EAAM,GAAG,EAAO,EAAI,GAAK,MAAM,EAAQ,GAC7F,YAAa,EAAW,CACpB,SACA,SACA,YACA,QACA,YACA,WAEJ,QAAS,EAAU,EAAM,KAAM,KAC/B,OACA,UAIR,MAAO,CACH,MAAO,GAAG,EAAO,MAAM,EAAO,UAC9B,OACA,YAAa,0BACb,KAAM,CAAC"}